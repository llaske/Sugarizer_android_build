/*! Sugarizer 2020-03-14 */
define(["settings","sugar-web/datastore"],function(a,b){function c(b,c,d,e){var g={};return g.user_id=a.getNetworkId(),g.user_agent=navigator.userAgent,g.timestamp=(new Date).getTime(),g.client_type=util.getClientName(),g.event_source=f,g.event_object=b,g.event_action=c,g.event_label=d,g.event_value=e,g}function d(a,b,c){myserver.postStats(a,function(){b&&b()},function(a,b){20!=a.code&&console.log("Error sending log"),c&&c()})}var e={},f="Sugarizer";return e.isActive=function(){if(!a.getOptions("stats"))return!1;if(!a.isConnected())return!1;var b=a.getServer();return!!(b&&b.options&&b.options.statistics)},e.trace=function(a,g,h,i){if(e.isActive()){console.log(f+": "+g+"("+a+", "+h+", "+i+")");var j=c(a,g,h,i),k=b.localStorage.getValue("sugar_stats");k||(k=[]),k.push(j),b.localStorage.setValue("sugar_stats",k),k.length>=constant.statPackageSize&&(console.log(f+": Send stat to server"),d(k,function(){b.localStorage.setValue("sugar_stats",[])},function(){k.length>constant.statMaxLocalSize&&(k.shift(),b.localStorage.setValue("sugar_stats",k))}))}},e});