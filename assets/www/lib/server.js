/*! Sugarizer 2018-07-01 */
define(["settings"],function(a){var b={},c=function(a,b){a.setHeaders({"x-key":b.x_key,"x-access-token":b.access_token})},d=function(a){if(!a||!a.xhrResponse||!a.xhrResponse.body)return 404;try{var b=JSON.parse(a.xhrResponse.body);return b.code}catch(a){return 500}},e=function(){if(util.getClientType()==constant.webAppType)return util.cleanDatastore(),util.restartApp(),!0;window.setTimeout(function(){humane.log(l10n.get("SessionExpired"))},500);var b=a.getToken();return b.expired=!0,a.setToken(b),!1};return b.getServer=function(){var b=a.getServer();return null!=b&&b.url?b.url:util.getClientType()==constant.webAppType?util.getCurrentServerUrl():constant.http+"localhost"},b.getServerUrl=function(){return b.getServer()},b.getActivitiesUrl=function(){var c=a.getToken();return c?b.getServerUrl()+constant.dynamicInitActivitiesURL+"?x_key="+c.x_key+"&access_token="+c.access_token:(e(),"")},b.getServerInformation=function(a,b,c){var e=new enyo.Ajax({url:a+constant.serverInformationURL,method:"GET",handleAs:"json"});e.response(function(a,c){b&&b(a,c)}),e.error(function(a){c&&c(a,d(a))}),e.go()},b.getActivities=function(f,g){var h=new enyo.Ajax({url:b.getServerUrl()+constant.dynamicInitActivitiesURL,method:"GET",handleAs:"json"});c(h,a.getToken()),h.response(function(a,b){var c={data:b};f&&f(a,c)}),h.error(function(a){var b=d(a);3==b&&e()||g&&g(a,b)}),h.go()},b.getUser=function(f,g,h,i){var j=new enyo.Ajax({url:(i?i:b.getServerUrl())+constant.initNetworkURL+f,method:"GET",handleAs:"json"});c(j,a.getToken()),j.response(g),j.error(function(a){var b=d(a);3==b&&e()||h&&h(a,b)}),j.go()},b.postUser=function(c,f,g){var h=new enyo.Ajax({url:b.getServerUrl()+constant.signupURL,method:"POST",handleAs:"json",postBody:{user:JSON.stringify(c)}});h.response(function(d,e){var g={name:c.name,password:c.password};b.loginUser(g,function(b,c){a.setToken({x_key:e._id,access_token:c.token})}),f&&f(d,e)}),h.error(function(a){var b=d(a);3==b&&e()||g&&g(a,b)}),h.go()},b.loginUser=function(a,c,f){var g=new enyo.Ajax({url:b.getServerUrl()+constant.loginURL,method:"POST",handleAs:"json",postBody:{user:JSON.stringify(a)}});g.response(c),g.error(function(a){var b=d(a);3==b&&e()||f&&f(a,b)}),g.go()},b.putUser=function(f,g,h,i){var j=new enyo.Ajax({url:b.getServerUrl()+constant.initNetworkURL+f,method:"PUT",handleAs:"json",postBody:{user:JSON.stringify(g)}});c(j,a.getToken()),j.response(h),j.error(function(a){var b=d(a);3==b&&e()||i&&i(a,b)}),j.go()},b.getJournal=function(f,g,h,i){var j=g.typeactivity,k=g.stime,l=g.favorite,m=(g.field,g.limit),n=g.offset,o=g.title,p=b.getServerUrl()+constant.sendCloudURL+f+"?limit="+m+"&sort=-timestamp",q={};void 0!==j&&(q.aid=j),void 0!==k&&(q.stime=k),void 0!==l&&(q.favorite=l),void 0!==n&&(q.offset=n),void 0!==o&&(q.title=o);var r=new enyo.Ajax({url:p,method:"GET",handleAs:"json"});c(r,a.getToken()),r.response(h),r.error(function(a){var b=d(a);3==b&&e()||i&&i(a,b)}),r.go(q)},b.getJournalEntry=function(f,g,h,i){var j={},k=new enyo.Ajax({url:b.getServerUrl()+constant.sendCloudURL+f,method:"GET",handleAs:"json"});j.oid=g,j.fields="text,metadata",c(k,a.getToken()),k.response(h),k.error(function(a){var b=d(a);3==b&&e()||i&&i(a,b)}),k.go(j)},b.postJournalEntry=function(f,g,h,i){var j=a.getToken();g.metadata.user_id=j.x_key;var k=new enyo.Ajax({url:b.getServerUrl()+constant.sendCloudURL+f,method:"POST",handleAs:"json",postBody:{journal:JSON.stringify(g)}});c(k,j),k.response(h),k.error(function(a){var b=d(a);3==b&&e()||i&&i(a,b)}),k.go()},b.putJournalEntry=function(f,g,h,i,j){var k={},l=a.getToken();h.metadata.user_id=l.x_key;var m=new enyo.Ajax({url:b.getServerUrl()+constant.sendCloudURL+f,method:"PUT",handleAs:"json",postBody:{journal:JSON.stringify(h)}});c(m,l),m.response(i),m.error(function(a){var b=d(a);3==b&&e()||j&&j(a,b)}),k.oid=g,m.go(k)},b.deleteJournalEntry=function(f,g,h,i){var j={},k=new enyo.Ajax({url:b.getServerUrl()+constant.sendCloudURL+f,method:"DELETE",handleAs:"json"});c(k,a.getToken()),k.response(h),k.error(function(a){var b=d(a);3==b&&e()||i&&i(a,b)}),j.oid=g,j.type="partial",k.go(j)},b.postStats=function(e,f,g){var h=new enyo.Ajax({url:b.getServerUrl()+constant.statsURL,method:"POST",handleAs:"json",postBody:{stats:JSON.stringify(e)}});c(h,a.getToken()),h.response(function(a,b){f&&f(a,b)}),h.error(function(a){var b=d(a);g&&g(a,b)}),h.go()},b});