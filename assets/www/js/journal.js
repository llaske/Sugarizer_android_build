/*! Sugarizer 2020-03-14 */
enyo.kind({name:"Sugar.Journal",published:{journal:null},kind:"FittableRows",components:[{name:"warningbox",kind:"Sugar.GenericDialogBox",showing:!1,classes:"journal-dialogbox",onCancel:"dialogSelectedCancel",onOk:"dialogSelectedOk"},{name:"content",kind:"Scroller",fit:!0,classes:"journal-content",onresize:"draw",onScroll:"onscroll",components:[{name:"empty",classes:"journal-empty",showing:!0},{name:"message",classes:"journal-message",showing:!0},{name:"nofilter",kind:"Sugar.IconButton",icon:{directory:"icons",icon:"dialog-cancel.svg"},classes:"listview-button",ontap:"nofilter",showing:!1},{name:"journalList",classes:"journal-list",kind:"Repeater",onSetupItem:"setupItem",components:[{name:"item",classes:"journal-list-item",components:[{name:"check",kind:"Input",type:"checkbox",classes:"toggle journal-check",onchange:"switchCheck"},{name:"favorite",kind:"Sugar.Icon",x:40,y:4,size:constant.iconSizeLargeFavorite,ontap:"switchFavorite"},{name:"activity",kind:"Sugar.Icon",x:100,y:5,size:constant.iconSizeList,colorized:!0,ontap:"runActivity"},{name:"title",showing:!0,classes:"journal-title",ontap:"titleEditStart"},{name:"titleEdit",showing:!1,kind:"enyo.Input",classes:"journal-title-edit",onblur:"titleEditEnd"},{name:"time",classes:"journal-time"},{name:"goright",kind:"Sugar.Icon",classes:"journal-goright",size:constant.iconSizeFavorite,ontap:"runActivity"}]}]},{name:"activityPopup",kind:"Sugar.Popup",showing:!1}]},{name:"footer",classes:"journal-footer toolbar",showing:!1,components:[{name:"journalbutton",kind:"Button",classes:"toolbutton view-localjournal-button active",title:"Journal",ontap:"showLocalJournal"},{name:"cloudonebutton",kind:"Button",classes:"toolbutton view-cloudone-button",title:"Private",ontap:"showPrivateCloud"},{name:"cloudallbutton",kind:"Button",classes:"toolbutton view-cloudall-button",title:"Shared",ontap:"showSharedCloud"},{name:"syncgear",classes:"sync-button sync-gear sync-gear-journal",showing:!1},{name:"syncbutton",kind:"Button",classes:"toolbutton sync-button sync-journal",title:"Sync",ontap:"syncJournal"},{name:"pageup",kind:"Button",classes:"toolbutton page-up",showing:!1,title:"Previous",ontap:"pagePrevious"},{name:"pagecount",content:"99/99",classes:"page-count",showing:!1},{name:"pagedown",kind:"Button",classes:"toolbutton page-down",showing:!1,title:"Next",ontap:"pageNext"}]}],create:function(){this.inherited(arguments),this.toolbar=null,this.empty=0==this.journal.length,this.realLength=0,this.loadResult={},this.loadingError=!1,this.journalType=constant.journalLocal,this.smallTime=!1,this.dialogAction=-1,this.journalChanged(),this.$.footer.setShowing(null!=preferences.getNetworkId()&&null!=preferences.getPrivateJournal()&&null!=preferences.getSharedJournal()),"rtl"==l10n.language.direction&&this.$.message.addClass("rtl-10"),this.draw()},rendered:function(){this.inherited(arguments),iconLib.colorize(this.$.journalbutton.hasNode(),preferences.getColor(),function(){}),iconLib.colorize(this.$.cloudonebutton.hasNode(),preferences.getColor(),function(){}),iconLib.colorize(this.$.cloudallbutton.hasNode(),preferences.getColor(),function(){}),this.$.syncbutton.setNodeProperty("title",l10n.get("Synchronize")),this.$.pageup.setNodeProperty("title",l10n.get("Back")),this.$.pagedown.setNodeProperty("title",l10n.get("Next")),this.journalChanged()},onscroll:function(a,b){var c=b.scrollBounds,d=c.maxTop-c.top<constant.journalScrollLimit,e=this.$.journalList.get("count");if(this.journalType==constant.journalLocal&&!this.getToolbar().hasFilter()&&d&&this.realLength>e){var f=this.getSelection(),g=Math.min(e+constant.journalStepCount,this.journal.length);humane.log(l10n.get("Loading")),this.$.journalList.set("count",g,!0),this.setSelection(f),this.updateSelectionCount()}},pageNext:function(){var a=this.loadResult;if(a.offset+a.limit<a.total){this.getToolbar().setMultiselectToolbarVisibility(!1),this.$.warningbox.setShowing(!1);var b=this.journalType==constant.journalRemotePrivate?preferences.getPrivateJournal():preferences.getSharedJournal(),c=a.offset+a.limit;a.total-c<a.limit&&(c=a.total-a.limit),humane.log(l10n.get("Loading")),this.getToolbar().hasFilter()?this.filterEntries(this.request.name,this.request.favorite,this.request.typeactivity,this.request.stime,c):this.loadRemoteJournal(b,c)}},pagePrevious:function(){var a=this.loadResult;if(a.offset>0){this.getToolbar().setMultiselectToolbarVisibility(!1),this.$.warningbox.setShowing(!1);var b=this.journalType==constant.journalRemotePrivate?preferences.getPrivateJournal():preferences.getSharedJournal(),c=a.offset-a.limit;c<a.limit&&(c=0),humane.log(l10n.get("Loading")),this.getToolbar().hasFilter()?this.filterEntries(this.request.name,this.request.favorite,this.request.typeactivity,this.request.stime,c):this.loadRemoteJournal(b,c)}},showPageButton:function(){var a=this.loadResult;if(this.journalType==constant.journalLocal||!a)return this.$.pagedown.setShowing(!1),this.$.pageup.setShowing(!1),void this.$.pagecount.setShowing(!1);var b=a.offset>0;this.$.pageup.setShowing(b);var c=a.offset+a.limit<a.total;this.$.pagedown.setShowing(c);var d=(a.total?1:0)+Math.ceil(a.offset/a.limit),e=Math.ceil(a.total/a.limit);this.$.pagecount.setContent(d+"/"+e),this.$.pagecount.setShowing(c||b)},getToolbar:function(){return null==this.toolbar&&(this.toolbar=new Sugar.JournalToolbar),this.toolbar},draw:function(){var a=util.getCanvasCenter(),b=this.$.footer.getShowing()?55:0;this.smallTime=a.dx<660;var c=enyo.platform.android?3:0;this.$.content.applyStyle("height",a.dy-b-c+"px"),this.$.empty.applyStyle("margin-left",a.x-constant.sizeEmpty/4+"px");var d=a.y-constant.sizeEmpty/4-80;this.$.empty.applyStyle("margin-top",d+"px"),this.$.message.setContent(l10n.get("JournalEmpty")),null!=preferences.getNetworkId()&&null!=preferences.getPrivateJournal()&&null!=preferences.getSharedJournal()&&(tutorial.setElement("journalbutton",this.$.journalbutton.getAttribute("id")),tutorial.setElement("cloudonebutton",this.$.cloudonebutton.getAttribute("id")),tutorial.setElement("cloudallbutton",this.$.cloudallbutton.getAttribute("id")))},updateNetworkBar:function(){this.$.footer.setShowing(null!=preferences.getNetworkId()&&null!=preferences.getPrivateJournal()&&null!=preferences.getSharedJournal()),this.draw()},journalChanged:function(){if(this.$.empty){this.$.empty.show(),this.$.message.show(),this.$.nofilter.show();var a=!this.getToolbar().hasFilter(),b=this.journalType==constant.journalLocal;if(this.empty=a&&!this.loadingError&&0==this.journal.length,null!=this.journal&&this.journal.length>0){var c=b&&a&&this.journal.length>constant.journalInitCount?constant.journalInitCount:this.journal.length;this.realLength=this.journal.length,this.$.journalList.set("count",c,!0),this.$.empty.hide(),this.$.message.hide(),this.$.nofilter.hide()}else this.$.journalList.set("count",0,!0),this.empty?(this.$.message.setContent(l10n.get("JournalEmpty")),this.$.nofilter.hide()):this.loadingError?(this.$.message.setContent(l10n.get("ErrorLoadingRemote")),this.$.nofilter.setText(l10n.get("Retry")),this.$.nofilter.setIcon({directory:"icons",icon:"system-restart.svg"})):(this.$.message.setContent(l10n.get("NoMatchingEntries")),this.$.nofilter.setText(l10n.get("ClearSearch")),this.$.nofilter.setIcon({directory:"icons",icon:"dialog-cancel.svg"}));this.showPageButton()}},setupItem:function(a,b){var c=this.journal[b.index];c.metadata.buddy_color&&b.item.$.activity.setColorizedColor(c.metadata.buddy_color);var d=preferences.getActivity(c.metadata.activity);d==preferences.genericActivity&&("text/plain"==c.metadata.mimetype?d={directory:"icons",icon:"application-x-txt.svg"}:"application/pdf"==c.metadata.mimetype?d={directory:"icons",icon:"application-x-pdf.svg"}:"application/msword"==c.metadata.mimetype?d={directory:"icons",icon:"application-x-doc.svg"}:"application/vnd.oasis.opendocument.text"==c.metadata.mimetype&&(d={directory:"icons",icon:"application-x-odt.svg"})),b.item.$.activity.setIcon(d),b.item.$.favorite.setIcon({directory:"icons",icon:"emblem-favorite-large.svg"});var e=c.metadata.keep;b.item.$.favorite.setColorized(void 0!==e&&1==e),b.item.$.title.setContent(c.metadata.title);var f=this.getToolbar().getSortType();1==f?b.item.$.time.setContent(util.timestampToElapsedString(c.metadata.creation_time,2,this.smallTime)):2==f?b.item.$.time.setContent(util.formatSize(c.metadata.textsize||0)):b.item.$.time.setContent(util.timestampToElapsedString(c.metadata.timestamp,2,this.smallTime)),b.item.$.goright.setIcon({directory:"icons",icon:"go-right.svg"}),b.item.$.activity.setPopupShow(enyo.bind(this,"showActivityPopup")),b.item.$.activity.setPopupHide(enyo.bind(this,"hideActivityPopup")),b.item.$.activity.setData(c),"rtl"==l10n.language.direction&&(b.item.$.title.addClass("rtl-14"),b.item.$.titleEdit.addClass("rtl-14"),b.item.$.time.addClass("rtl-14")),0==b.index&&(tutorial.setElement("checkitem",b.item.$.check.getAttribute("id")),tutorial.setElement("activityitem",b.item.$.activity.getAttribute("id")),tutorial.setElement("titleitem",b.item.$.title.getAttribute("id")),tutorial.setElement("timeitem",b.item.$.time.getAttribute("id")),tutorial.setElement("favoriteitem",b.item.$.favorite.getAttribute("id")))},switchFavorite:function(a,b){var c=this.journal[b.index].objectId,d=this.journal[b.index].metadata.keep;this.journal[b.index].metadata.keep=void 0===d?1:(d+1)%2,stats.trace(constant.viewNames[app.getView()],"switch_favorite",c,null);var e=new datastore.DatastoreObject(c);e.setMetadata(this.journal[b.index].metadata),e.save(),b.dispatchTarget.container.setColorized(1==this.journal[b.index].metadata.keep),b.dispatchTarget.container.render()},switchCheck:function(a,b){this.$.warningbox.setShowing(!1),this.getToolbar().setMultiselectToolbarVisibility(this.updateSelectionCount()>0)},updateSelectionCount:function(){var a=this.getSelection();return this.getToolbar().setSelectedCount(a.length,this.$.journalList.get("count")),a.length},getSelection:function(){for(var a=[],b=this.$.journalList.get("count"),c=0;c<b;c++)this.$.journalList.children[c].$.check.getNodeProperty("checked")&&a.push(c);return a},setSelection:function(a){for(var b=a.length,c=0;c<b;c++){var d=a[c];this.$.journalList.children[d].$.check.setNodeProperty("checked",!0)}},selectAll:function(){for(var a=this.$.journalList.get("count"),b=0;b<a;b++)this.$.journalList.children[b].$.check.setNodeProperty("checked",!0);this.getToolbar().setSelectedCount(a,a)},unselectAll:function(){for(var a=this.$.journalList.get("count"),b=0;b<a;b++)this.$.journalList.children[b].$.check.setNodeProperty("checked",!1);this.getToolbar().setMultiselectToolbarVisibility(!1)},removeSelected:function(){this.dialogAction=constant.journalRemove,this.$.warningbox.setTitle(l10n.get("Erase"));var a=this.getSelection().length;this.$.warningbox.setMessage(1==a?l10n.get("Erase_one",{count:a}):l10n.get("Erase_other",{count:a})),this.$.warningbox.setOkText(l10n.get("Ok")),this.$.warningbox.setCancelText(l10n.get("Cancel")),this.$.warningbox.setShowing(!0)},copySelected:function(a){this.dialogAction=a;var b=["CopyToLocal","CopyToPrivate","CopyToShared","","CopyToDevice"];this.$.warningbox.setTitle(l10n.get(b[a]));var c=this.getSelection().length;this.$.warningbox.setMessage(1==c?l10n.get(b[a]+"_one",{count:c}):l10n.get(b[a]+"_other",{count:c})),this.$.warningbox.setOkText(l10n.get("Ok")),this.$.warningbox.setCancelText(l10n.get("Cancel")),this.$.warningbox.setShowing(!0)},dialogSelectedOk:function(){this.$.warningbox.setShowing(!1),this.getToolbar().setMultiselectToolbarVisibility(!1);for(var a=this.getSelection(),b=[],c=0;c<a.length;c++)b.push(this.journal[a[c]]);var d=this,e=this.dialogAction==constant.journalDevice&&util.getClientType()==constant.appType&&enyo.platform.electron;e||humane.log(l10n.get(this.dialogAction==constant.journalRemove?"Erasing":"Copying")),window.setTimeout(function(){if(e)d.copyMultipleToDevice(b);else for(var a=0;a<b.length;a++)d.dialogAction==constant.journalDevice?d.copyToDevice(b[a]):d.dialogAction==constant.journalRemove?d.removeEntry(b[a],{isLast:a==b.length-1}):d.dialogAction==constant.journalLocal?d.copyToLocal(b[a]):d.copyToRemote(b[a],d.dialogAction==constant.journalRemotePrivate?preferences.getPrivateJournal():preferences.getSharedJournal());d.unselectAll()},100)},dialogSelectedCancel:function(){this.$.warningbox.setShowing(!1),this.getToolbar().setMultiselectToolbarVisibility(!0)},runActivity:function(a,b){this.runCurrentActivity(this.journal[b.index])},runCurrentActivity:function(a){var b=preferences.getActivity(a.metadata.activity);if(b!=preferences.genericActivity){var c=this;this.loadEntry(a,function(d,e,f){if(c.journalType!=constant.journalLocal){var g=new datastore.DatastoreObject(a.objectId);return g.setMetadata(e),g.setDataAsText(f),void g.save(function(){preferences.runActivity(b,a.objectId,e.title)})}preferences.runActivity(b,a.objectId,e.title)})}else if("application/pdf"==a.metadata.mimetype){var c=this;this.loadEntry(a,function(a,b,d){c.$.activityPopup.hidePopup(),util.openAsDocument(b,d)})}},filterEntries:function(a,b,c,d,e){var f=this.getToolbar().getSortType();if(this.journalType!=constant.journalLocal){var g=this.journalType==constant.journalRemotePrivate?preferences.getPrivateJournal():preferences.getSharedJournal(),h=this,i="-timestamp";1==f?i="-creation_time":2==f&&(i="-textsize");var j={typeactivity:c,title:void 0!==a?a:void 0,stime:void 0!==d?d:void 0,favorite:b,field:constant.fieldMetadata,limit:constant.pageJournalSize,sort:i,offset:void 0!==e?e:0};return void myserver.getJournal(g,j,function(a,b){h.loadResult={offset:b.offset,total:b.total,limit:b.limit},h.request=j,h.journal=b.entries,h.empty=!h.getToolbar().hasFilter()&&!this.loadingError&&0==h.journal.length,h.loadingError=!1,h.journalChanged()},function(){console.log("WARNING: Error filtering journal "+g),h.loadResult={},h.request={},h.journal=[],h.loadingError=!0,h.journalChanged()})}this.journal=datastore.find(c),this.loadingError=!1,this.journal=this.journal.filter(function(c){return(void 0===b||c.metadata.keep)&&(0==a.length||-1!=c.metadata.title.toLowerCase().indexOf(a.toLowerCase()))&&(void 0===d||c.metadata.timestamp>=d)});var h=this;this.journal=this.journal.sort(function(a,b){return 1==f?parseInt(b.metadata.creation_time)-parseInt(a.metadata.creation_time):2==f?parseInt(b.metadata.textsize||0)-parseInt(a.metadata.textsize||0):parseInt(b.metadata.timestamp)-parseInt(a.metadata.timestamp)}),this.journalChanged()},nofilter:function(){this.toolbar.removeFilter(),this.filterEntries("",void 0,void 0,void 0,void 0)},showActivityPopup:function(a){if(a.owner){var b=(a.icon,a.getData()),c=null;this.journalType!=constant.sharedJournal?b.metadata.textsize&&b.metadata.textsize>constant.minimumSizeDisplay&&(c=util.formatSize(b.metadata.textsize)):b.metadata.buddy_name&&(c=l10n.get("ByUser",{user:b.metadata.buddy_name})),this.$.activityPopup.setHeader({icon:a.icon,colorized:!0,colorizedColor:b.metadata.buddy_color?b.metadata.buddy_color:null,name:b.metadata.title,title:c,action:enyo.bind(this,"runCurrentActivity"),data:[b,null]}),this.$.activityPopup.setItems(null);var d=[];d.push({icon:{directory:"icons",icon:"activity-start.svg"},colorized:!1,name:l10n.get("RestartActivity"),action:enyo.bind(this,"runCurrentActivity"),disable:preferences.getActivity(b.metadata.activity)==preferences.genericActivity&&"application/pdf"!=b.metadata.mimetype,data:[b,null]}),d.push({icon:{directory:"icons",icon:"copy-journal.svg"},colorized:!1,name:l10n.get("CopyToLocal"),action:enyo.bind(this,"copyToLocal"),data:[b,null],disable:this.journalType==constant.journalLocal}),d.push({icon:{directory:"icons",icon:"copy-cloud-one.svg"},colorized:!1,name:l10n.get("CopyToPrivate"),action:enyo.bind(this,"copyToRemote"),data:[b,preferences.getPrivateJournal()],disable:!preferences.isConnected()||this.journalType==constant.journalRemotePrivate}),d.push({icon:{directory:"icons",icon:"copy-cloud-all.svg"},colorized:!1,name:l10n.get("CopyToShared"),action:enyo.bind(this,"copyToRemote"),data:[b,preferences.getSharedJournal()],disable:!preferences.isConnected()||this.journalType==constant.journalRemoteShared}),d.push({icon:{directory:"icons",icon:"copy-to-device.svg"},colorized:!1,name:l10n.get("CopyToDevice"),action:enyo.bind(this,"copyToDevice"),data:[b,null]}),d.push({icon:{directory:"icons",icon:"list-remove.svg"},colorized:!1,name:l10n.get("Erase"),action:enyo.bind(this,"removeEntry"),data:[b,null]}),this.$.activityPopup.setFooter(d),this.$.activityPopup.setMargin({left:0,top:60*a.owner.index+20-mouse.position.y}),this.$.activityPopup.showPopup()}},hideActivityPopup:function(a){return!this.$.activityPopup||!this.$.activityPopup.cursorIsInside()&&!a.cursorIsInside()&&(this.$.activityPopup.hidePopup(),!0)},copyToLocal:function(a){var b=this;stats.trace(constant.viewNames[app.getView()],"copy_to_local",a.objectId,null),this.loadEntry(a,function(c,d,e){var f=new datastore.DatastoreObject(a.objectId);f.setMetadata(d),f.setDataAsText(e),f.save(),b.$.activityPopup.hidePopup()})},copyToDevice:function(a,b){this.$.activityPopup.hidePopup(),this.loadEntry(a,function(a,c,d){util.writeFile(b,c,d,function(a,b){a?humane.log(l10n.get("ErrorWritingFile")):humane.log(l10n.get("FileWroteTo",{file:b}))})})},copyMultipleToDevice:function(a){var b=this;util.askDirectory(function(c){for(var d=0;d<a.length;d++)b.copyToDevice(a[d],c)})},copyToRemote:function(a,b){stats.trace(constant.viewNames[app.getView()],"copy_to_remote",a.objectId,b),this.loadEntry(a,function(c,d,e){var f={metadata:d,text:e,objectId:a.objectId};myserver.putJournalEntry(b,a.objectId,f,function(){},function(){console.log("WARNING: Error writing journal "+b)})}),this.$.activityPopup.hidePopup()},loadLocalJournal:function(){this.journal=datastore.find(),this.journal=this.journal.sort(function(a,b){return parseInt(b.metadata.timestamp)-parseInt(a.metadata.timestamp)}),this.journalChanged()},loadRemoteJournal:function(a,b){var c=this,d={field:constant.fieldMetadata,limit:constant.pageJournalSize,offset:void 0!==b?b:0,sort:"-timestamp"},e=this.getToolbar().getSortType();1==e?d.sort="-creation_time":2==e&&(d.sort="-textsize"),myserver.getJournal(a,d,function(a,b){c.loadResult={offset:b.offset,total:b.total,limit:b.limit},c.journal=b.entries,c.empty=!c.getToolbar().hasFilter()&&!this.loadingError&&0==c.journal.length,c.loadingError=!1,c.journalChanged()},function(){console.log("WARNING: Error reading journal "+a),c.loadResult={},c.journal=[],c.loadingError=!0,c.journalChanged()})},loadEntry:function(a,b){if(this.journalType==constant.journalLocal){new datastore.DatastoreObject(a.objectId).loadAsText(function(a,c,d){b(a,c,d)})}else{var c;this.journalType==constant.journalRemotePrivate?c=preferences.getPrivateJournal():this.journalType==constant.journalRemoteShared&&(c=preferences.getSharedJournal()),myserver.getJournalEntry(c,a.objectId,function(a,c){b(null,c.entries[0].metadata,c.entries[0].text)},function(){console.log("WARNING: Error loading entry "+objectId+" in journal "+c)})}},removeEntry:function(a,b){if(this.journalType!=constant.journalLocal){var c=this.journalType==constant.journalRemotePrivate?preferences.getPrivateJournal():preferences.getSharedJournal(),d=a.objectId,e=this;return this.toolbar.removeFilter(),stats.trace(constant.viewNames[app.getView()],"remove_entry",d,c),void myserver.deleteJournalEntry(c,d,function(a,b){e.loadRemoteJournal(c),e.$.activityPopup.hidePopup()},function(){console.log("WARNING: Error removing entry "+d+" in journal "+c),e.loadRemoteJournal(c),e.$.activityPopup.hidePopup()})}if(stats.trace(constant.viewNames[app.getView()],"remove_entry",a.objectId,null),datastore.remove(a.objectId),preferences.isConnected()&&preferences.getOptions("sync")){var c=preferences.getPrivateJournal(),d=a.objectId;myserver.deleteJournalEntry(c,d,function(a,b){},function(){console.log("WARNING: Error removing entry "+d+" in journal "+c)})}(!b||b.isLast)&&(this.toolbar.removeFilter(),this.loadLocalJournal(),preferences.updateEntries(),app.journal=this.journal,app.redraw()),this.$.activityPopup.hidePopup()},titleEditStart:function(a,b){var c=b.dispatchTarget.owner.$;c.title.setShowing(!1),c.titleEdit.setValue(c.title.getContent()),c.titleEdit.setShowing(!0),c.titleEdit.focus()},titleEditEnd:function(a,b){var c=b.dispatchTarget.owner.$;c.title.setShowing(!0),c.titleEdit.setShowing(!1);var d=c.titleEdit.getValue();if(d!=c.title.getContent()){var e=this.journal[b.index].objectId,f=this;this.loadEntry(this.journal[b.index],function(a,b,c){if(f.journalType==constant.journalLocal){b.title=d,stats.trace(constant.viewNames[app.getView()],"rename_entry",e,"local");var g=new datastore.DatastoreObject(e);g.setMetadata(b),g.setDataAsText(c),g.save(),f.loadLocalJournal(),preferences.updateEntries(),app.journal=f.journal,app.redraw()}else{b.title=d;var h=f.journalType==constant.journalRemotePrivate?preferences.getPrivateJournal():preferences.getSharedJournal(),i={metadata:b,text:c,objectId:e};stats.trace(constant.viewNames[app.getView()],"rename_entry",e,h),myserver.putJournalEntry(h,e,i,function(){f.loadRemoteJournal(h)},function(){console.log("WARNING: Error updating journal "+h),f.loadRemoteJournal(h)})}})}},showLocalJournal:function(){this.changeJournalType(constant.journalLocal),stats.trace(constant.viewNames[app.getView()],"show_journal","local",null),this.loadLocalJournal()},showPrivateCloud:function(){stats.trace(constant.viewNames[app.getView()],"show_journal","private",null),this.changeJournalType(constant.journalRemotePrivate),this.loadRemoteJournal(preferences.getPrivateJournal())},showSharedCloud:function(){stats.trace(constant.viewNames[app.getView()],"show_journal","shared",null),this.changeJournalType(constant.journalRemoteShared),this.loadRemoteJournal(preferences.getSharedJournal())},syncJournal:function(){var a=this;autosync.synchronizeJournal(function(b){b&&(humane.log(l10n.get("RetrievingJournal")),a.$.syncbutton.setShowing(!1),a.$.syncgear.setShowing(!0))},function(b,c,d){a.$.syncbutton&&(a.$.syncbutton.setShowing(!0),a.$.syncgear.setShowing(!1),b&&a.journalType==constant.journalLocal&&(a.loadLocalJournal(),app.journal=a.journal,preferences.updateEntries(),app.draw()),c&&a.journalType==constant.journalRemotePrivate&&a.loadRemoteJournal(preferences.getPrivateJournal()))})},changeJournalType:function(a){this.journalType=a,this.$.journalbutton.addRemoveClass("active",a==constant.journalLocal),this.$.cloudonebutton.addRemoveClass("active",a==constant.journalRemotePrivate),this.$.cloudallbutton.addRemoveClass("active",a==constant.journalRemoteShared),this.getToolbar().removeFilter(),this.getToolbar().setMultiselectToolbarVisibility(!1),this.$.warningbox.setShowing(!1)},getJournalType:function(){return this.journalType}}),enyo.kind({name:"Sugar.JournalToolbar",kind:enyo.Control,components:[{name:"unselallbutton",showing:!1,kind:"Sugar.Icon",classes:"journal-unselectall",x:0,y:0,icon:{directory:"icons",icon:"select-none.svg"},size:constant.iconSizeList,disabledBackground:"#282828",ontap:"unselectAll"},{name:"selallbutton",showing:!1,kind:"Sugar.Icon",classes:"journal-selectall",x:0,y:0,icon:{directory:"icons",icon:"select-all.svg"},size:constant.iconSizeList,disabledBackground:"#282828",ontap:"selectAll"},{name:"split1",showing:!1,classes:"splitbar"},{name:"copyjournalbutton",showing:!1,kind:"Sugar.Icon",classes:"journal-copy",x:0,y:0,icon:{directory:"icons",icon:"copy-journal.svg"},size:constant.iconSizeList,disabledBackground:"#282828",ontap:"copySelected"},{name:"copycloudonebutton",showing:!1,kind:"Sugar.Icon",classes:"journal-copy",x:0,y:0,icon:{directory:"icons",icon:"copy-cloud-one.svg"},size:constant.iconSizeList,disabledBackground:"#282828",ontap:"copySelected"},{name:"copycloudallbutton",showing:!1,kind:"Sugar.Icon",classes:"journal-copy",x:0,y:0,icon:{directory:"icons",icon:"copy-cloud-all.svg"},size:constant.iconSizeList,disabledBackground:"#282828",ontap:"copySelected"},{name:"copydevicebutton",showing:!1,kind:"Sugar.Icon",classes:"journal-copy",x:0,y:0,icon:{directory:"icons",icon:"copy-to-device.svg"},size:constant.iconSizeList,disabledBackground:"#282828",ontap:"copySelected"},{name:"removebutton",showing:!1,kind:"Sugar.Icon",classes:"journal-remove",x:0,y:0,icon:{directory:"icons",icon:"list-remove.svg"},size:constant.iconSizeList,disabledBackground:"#282828",ontap:"removeSelected"},{name:"split2",showing:!1,classes:"splitbar"},{name:"selectcount",showing:!1,classes:"journal-selectcount"},{name:"favoritebutton",kind:"Sugar.Icon",classes:"journal-filter-favorite",x:0,y:4,icon:{directory:"icons",icon:"emblem-favorite.svg"},size:constant.iconSizeList,ontap:"filterFavorite"},{name:"journalsearch",kind:"Sugar.SearchField",onTextChanged:"filterEntries",classes:"journal-filter-text"},{name:"radialbutton",kind:"Button",classes:"toolbutton view-desktop-button",title:"Home",ontap:"gotoDesktop"},{name:"typepalette",kind:"Sugar.Palette",ontap:"showTypePalette",icon:{directory:"icons",icon:"view-type.svg"},size:constant.iconSizeList,classes:"journal-filtertype-palette",contentsClasses:"journal-filtertype-content",contents:[]},{name:"datepalette",kind:"Sugar.Palette",ontap:"showDatePalette",icon:{directory:"icons",icon:"view-created.svg"},size:constant.iconSizeList,classes:"journal-filterdate-palette",contentsClasses:"journal-filterdate-content",contents:[]},{name:"sortpalette",kind:"Sugar.Palette",ontap:"showSortPalette",icon:{directory:"icons",icon:"view-lastedit.svg"},size:constant.iconSizeList,classes:"journal-sort-palette",contentsClasses:"journal-sort-content",contents:[]},{name:"split3",classes:"splitbar journal-split split3"},{name:"fromdevicebutton",kind:"Sugar.Icon",x:0,y:0,icon:{directory:"icons",icon:"copy-from-device.svg"},classes:"journal-fromdevice",size:constant.iconSizeList,ontap:"fromDeviceSelected"},{name:"split4",classes:"splitbar journal-split split4"},{name:"helpbutton",kind:"Button",classes:"toolbutton help-button-journal",title:"Help",ontap:"startTutorial"}],create:function(){this.inherited(arguments),this.localize(),this.typeselected=0,this.dateselected=0,this.sortfield=0,util.getClientType()!=constant.webAppType&&(util.getClientType()!=constant.appType||enyo.platform.android||enyo.platform.androidChrome||enyo.platform.ios||enyo.platform.electron)||this.createComponent({name:"file",kind:"Input",type:"file",showing:!1,onchange:"fileSelected"},{owner:this})},rendered:function(){this.inherited(arguments),this.localize()},localize:function(){this.$.favoritebutton.setNodeProperty("title",l10n.get("FilterFavorites")),this.$.radialbutton.setNodeProperty("title",l10n.get("Home")),this.$.helpbutton.setNodeProperty("title",l10n.get("Tutorial")),this.$.unselallbutton.setNodeProperty("title",l10n.get("UnselectAll")),this.$.selallbutton.setNodeProperty("title",l10n.get("SelectAll")),this.$.removebutton.setNodeProperty("title",l10n.get("Erase")),this.$.copyjournalbutton.setNodeProperty("title",l10n.get("CopyToLocal")),this.$.copycloudonebutton.setNodeProperty("title",l10n.get("CopyToPrivate")),this.$.copycloudallbutton.setNodeProperty("title",l10n.get("CopyToShared")),this.$.copydevicebutton.setNodeProperty("title",l10n.get("CopyToDevice")),this.$.journalsearch.setPlaceholder(l10n.get("SearchJournal")),this.$.typepalette.setText(l10n.get("AllType")),this.$.datepalette.setText(l10n.get("Anytime")),this.dates=[l10n.get("Anytime"),l10n.get("Today"),l10n.get("SinceYesterday"),l10n.get("PastWeek"),l10n.get("PastMonth")];var a=[];this.$.datepalette.setHeader(l10n.get("SelectFilter"));for(var b=0;b<this.dates.length;b++)a.push({id:""+(b+1),classes:"journal-filterdate-line",components:[{classes:"journal-filterdate-item",content:this.dates[b]}],ontap:"tapDate"});this.$.datepalette.setItems(a),a=[],this.$.typepalette.setHeader(l10n.get("SelectFilter")),a.push({id:"0",classes:"journal-filtertype-line",components:[{kind:"Sugar.Icon",icon:{directory:"icons",icon:"application-x-generic.svg"},x:5,y:3,size:constant.iconSizeFavorite},{classes:"item-name",content:l10n.get("AllType")}],ontap:"tapLine"});for(var c=preferences.getActivities(),d=[],b=0;b<c.length;b++)d.push({id:""+(b+1),classes:"journal-filtertype-line",components:[{kind:"Sugar.Icon",icon:c[b],x:5,y:3,size:constant.iconSizeFavorite},{classes:"item-name",content:c[b].name}],ontap:"tapLine"});d.sort(function(a,b){var c=a.components[1].content,d=b.components[1].content;return c>d?1:c<d?-1:0});for(var b=0;b<d.length;b++)a.push(d[b]);this.$.typepalette.setItems(a),this.sorts=[{text:l10n.get("SortByUpdated"),icon:"view-lastedit.svg"},{text:l10n.get("SortByCreated"),icon:"view-created.svg"},{text:l10n.get("SortBySize"),icon:"view-size.svg"}];var a=[];this.$.sortpalette.setHeader(l10n.get("SortDisplay"));for(var b=0;b<this.sorts.length;b++)a.push({id:""+(b+1),classes:"journal-sort-line",components:[{kind:"Sugar.Icon",icon:{directory:"icons",icon:this.sorts[b].icon},x:5,y:3,size:constant.iconSizeFavorite},{classes:"journal-sort-item",content:this.sorts[b].text}],ontap:"tapSort"});this.$.sortpalette.setItems(a)},gotoDesktop:function(){util.vibrate(),app.showView(constant.radialView)},filterFavorite:function(){this.$.favoritebutton.setColorized(!this.$.favoritebutton.getColorized()),this.$.favoritebutton.render(),this.filterEntries()},showTypePalette:function(){this.$.typepalette.switchPalette(app.otherview)},tapLine:function(a,b){var c=preferences.getActivities(),d={directory:"icons",icon:"application-x-generic.svg"};this.typeselected=a.getId(),this.$.typepalette.setIcon(0==this.typeselected?d:c[this.typeselected-1]),this.$.typepalette.setText(0==this.typeselected?l10n.get("AllType"):c[this.typeselected-1].name),this.filterEntries(),this.$.typepalette.switchPalette(app.otherview)},showDatePalette:function(){this.$.datepalette.switchPalette(app.otherview)},tapDate:function(a,b){this.dateselected=a.getId()-1,this.$.datepalette.setText(this.dates[this.dateselected]),this.filterEntries(),this.$.datepalette.switchPalette(app.otherview)},showSortPalette:function(){this.$.sortpalette.switchPalette(app.otherview)},tapSort:function(a,b){this.sortfield=a.getId()-1,this.$.sortpalette.setIcon({directory:"icons",icon:this.sorts[this.sortfield].icon}),this.filterEntries(),this.$.sortpalette.switchPalette(app.otherview)},selectAll:function(){this.$.selallbutton.getDisabled()||app.otherview.selectAll()},unselectAll:function(){this.$.unselallbutton.getDisabled()||app.otherview.unselectAll()},setSelectedCount:function(a,b){a<=1?this.$.selectcount.setContent(l10n.get("Selected_one",{count:a,total:b})):this.$.selectcount.setContent(l10n.get("Selected_other",{count:a,total:b}))},removeSelected:function(){this.$.removebutton.getDisabled()||(this.disableMultiselectToolbarVisibility(),app.otherview.removeSelected())},copySelected:function(a,b){if(!a.getDisabled()){this.disableMultiselectToolbarVisibility();var c;c="copydevicebutton"==a.name?constant.journalDevice:"copycloudonebutton"==a.name?constant.journalRemotePrivate:"copycloudallbutton"==a.name?constant.journalRemoteShared:constant.journalLocal,app.otherview.copySelected(c)}},fromDeviceSelected:function(){util.getClientType()!=constant.webAppType&&(util.getClientType()!=constant.appType||enyo.platform.android||enyo.platform.androidChrome||enyo.platform.ios||enyo.platform.electron)?util.askFiles(function(a,b,c,d){if(b)return void humane.log(l10n.get("ErrorLoadingFile",{file:a}));c.timestamp=(new Date).getTime(),c.creation_time=(new Date).getTime(),datastore.create(c,function(b){if(b)return void humane.log(l10n.get("ErrorLoadingFile",{file:a}));app.otherview.loadLocalJournal(),preferences.isConnected()&&app.otherview.syncJournal()},d)}):(this.$.file.setNodeProperty("accept",".png,.jpg,.wav,.webm,.json,.mp3,.mp4,.pdf,.txt,.doc,.odt"),this.$.file.setNodeProperty("multiple","true"),this.$.file.hasNode().click())},fileSelected:function(){for(var a=this.$.file.getNodeProperty("files"),b=0;b<a.length;b++)util.loadFile(a[b],function(a,b,c,d){if(b)return void humane.log(l10n.get("ErrorLoadingFile",{file:a}));c.timestamp=(new Date).getTime(),c.creation_time=(new Date).getTime(),datastore.create(c,function(){app.otherview.loadLocalJournal(),preferences.isConnected()&&app.otherview.syncJournal()},d)})},hasFilter:function(){return""!=this.$.journalsearch.getText()||this.$.favoritebutton.getColorized()||this.typeselected>0||this.dateselected>0},getSortType:function(){return this.sortfield},filterEntries:function(){var a=this.$.journalsearch.getText(),b=!!this.$.favoritebutton.getColorized()||void 0,c=this.typeselected,d=c<=0?void 0:preferences.getActivities()[c-1].id;c=this.dateselected;var e=c<=0?void 0:util.getDateRange(c).min,f="q="+a;b&&(f+="&favorite=true"),d&&(f+="&type="+d),e&&(f+="&time="+e),stats.trace(constant.viewNames[app.getView()],"search",f,null),app.otherview.filterEntries(a,b,d,e,void 0,this.sortfield)},removeFilter:function(){this.typeselected=0,this.$.typepalette.setIcon({directory:"icons",icon:"application-x-generic.svg"}),this.dateselected=0,this.sortfield=0,this.$.sortpalette.setIcon({directory:"icons",icon:"view-lastedit.svg"}),this.$.favoritebutton.setColorized(!1),this.$.journalsearch.setText(""),this.render()},setMultiselectToolbarVisibility:function(a){this.$.typepalette.isOpen()&&this.$.typepalette.switchPalette(app.otherview),this.$.datepalette.isOpen()&&this.$.datepalette.switchPalette(app.otherview),this.$.sortpalette.isOpen()&&this.$.sortpalette.switchPalette(app.otherview);var b=app.otherview.getJournalType();this.$.favoritebutton.setShowing(!a),this.$.journalsearch.setShowing(!a),this.$.radialbutton.setShowing(!a),this.$.typepalette.setShowing(!a),this.$.datepalette.setShowing(!a),this.$.sortpalette.setShowing(!a),this.$.split3.setShowing(!a&&b==constant.journalLocal),this.$.fromdevicebutton.setShowing(!a&&b==constant.journalLocal),this.$.split4.setShowing(!a),this.$.helpbutton.setShowing(!a),this.$.unselallbutton.setShowing(a),this.$.selallbutton.setShowing(a),this.$.split1.setShowing(a),this.$.removebutton.setShowing(a),this.$.copyjournalbutton.setShowing(a&&b!=constant.journalLocal),this.$.copycloudonebutton.setShowing(a&&b!=constant.journalRemotePrivate&&preferences.isConnected()),this.$.copycloudallbutton.setShowing(a&&b!=constant.journalRemoteShared&&preferences.isConnected()),this.$.copydevicebutton.setShowing(a),this.$.split2.setShowing(a),this.$.selectcount.setShowing(a),this.$.unselallbutton.setDisabled(!a),this.$.selallbutton.setDisabled(!a),this.$.removebutton.setDisabled(!a),this.$.copyjournalbutton.setDisabled(!a),this.$.copycloudonebutton.setDisabled(!a),this.$.copycloudallbutton.setDisabled(!a),this.$.copydevicebutton.setDisabled(!a),this.$.selectcount.addRemoveClass("journal-selectcount-disabled",!a)},disableMultiselectToolbarVisibility:function(){this.$.unselallbutton.setDisabled(!0),this.$.selallbutton.setDisabled(!0),this.$.removebutton.setDisabled(!0),this.$.copyjournalbutton.setDisabled(!0),this.$.copycloudonebutton.setDisabled(!0),this.$.copycloudallbutton.setDisabled(!0),this.$.copydevicebutton.setDisabled(!0),this.$.selectcount.addRemoveClass("journal-selectcount-disabled",!0)},startTutorial:function(){tutorial.setElement("favoritebutton",this.$.favoritebutton.getAttribute("id")),tutorial.setElement("searchtext",this.$.journalsearch.getAttribute("id")),tutorial.setElement("typeselect",this.$.typepalette.getAttribute("id")),tutorial.setElement("timeselect",this.$.datepalette.getAttribute("id")),tutorial.setElement("sortselect",this.$.sortpalette.getAttribute("id")),tutorial.setElement("fromdevicebutton",this.$.fromdevicebutton.getAttribute("id")),tutorial.setElement("radialbutton",this.$.radialbutton.getAttribute("id")),stats.trace(constant.viewNames[app.getView()],"tutorial","start",null),tutorial.start()}});