/*! Sugarizer 2020-03-14 */
enyo.kind({name:"Sugar.FirstScreen",kind:enyo.Control,components:[{name:"stopbutton",kind:"Sugar.Icon",size:constant.sizeEmpty,icon:{directory:"lib/sugar-web/graphics/icons/actions",icon:"activity-stop.svg"},colorized:!0,colorizedColor:{fill:"#666666",stroke:"#ffffff"},ontap:"quitApplication",classes:"first-quit"},{name:"helpbutton",kind:"Sugar.Icon",size:constant.sizeEmpty,icon:{directory:"icons",icon:"help.svg"},colorized:!0,colorizedColor:{stroke:"#666666",fill:"#ffffff"},ontap:"startTutorial",classes:"first-help"},{name:"namebox",classes:"first-namebox",onresize:"resize",showing:!1,components:[{name:"nameline",classes:"first-nameline",components:[{name:"nametext",content:"xxx",classes:"first-nametext"},{classes:"first-input",components:[{name:"name",kind:"Input",classes:"first-namevalue",onkeydown:"enterclick"}]}]}]},{name:"serverbox",classes:"first-serverbox",onresize:"resize",showing:!1,components:[{name:"serverline",classes:"first-serverline",components:[{name:"servertext",content:"xxx",classes:"first-servertext"},{classes:"first-input",components:[{name:"server",kind:"Input",classes:"first-servervalue",onkeydown:"enterclick",disabled:!0,ontap:"unlockURL"}]},{name:"qrbutton",kind:"Sugar.Icon",size:constant.sizeEmpty,icon:{directory:"icons",icon:"qrcode.svg"},ontap:"scanQR",classes:"first-qr"}]}]},{name:"passbox",classes:"first-passbox",onresize:"resize",showing:!1,components:[{name:"password",kind:"Sugar.Password",onEnter:"enterPassword"}]},{name:"historybox",classes:"first-historybox",kind:"Repeater",onSetupItem:"setupHistory",onresize:"resize",showing:!1,components:[{name:"history",kind:"Sugar.IconButton",icon:{directory:"icons",icon:"owner-icon.svg"},classes:"first-historybutton",ontap:"historyClicked"}]},{name:"previous",kind:"Sugar.IconButton",icon:{directory:"icons",icon:"go-left.svg"},classes:"first-leftbutton",ontap:"previous",showing:!1},{name:"next",kind:"Sugar.IconButton",icon:{directory:"icons",icon:"go-right.svg"},classes:"first-rightbutton",ontap:"next",showing:!1},{name:"colortext",content:"xxx",classes:"first-colortext",showing:!1},{name:"owner",kind:"Sugar.Icon",size:constant.sizeOwner,colorized:!0,classes:"first-owner-icon",showing:!1,onresize:"resize",ontap:"nextcolor"},{name:"newuser",kind:"Sugar.Icon",size:constant.sizeNewUser,colorized:!1,classes:"first-owner-icon",showing:!0,onresize:"resize",ontap:"newUser"},{name:"newusertext",content:"xxx",classes:"newuser-text"},{name:"login",kind:"Sugar.Icon",size:constant.sizeNewUser,colorized:!1,classes:"first-owner-icon",showing:!0,onresize:"resize",ontap:"login"},{name:"logintext",content:"xxx",classes:"newuser-text"},{name:"spinner",kind:"Image",src:"images/spinner-light.gif",classes:"spinner",showing:!1},{name:"warningmessage",content:"xxx",classes:"first-warningmessage",showing:!0}],create:function(){if(app=this,this.inherited(arguments),this.$.nametext.setContent(l10n.get("Name")),this.$.servertext.setContent(l10n.get("ServerUrl")),this.$.password.setLabel(l10n.get("Password")),this.$.previous.setText(l10n.get("Back")),this.$.next.setText(l10n.get("Next")),this.$.newusertext.setContent(l10n.get("NewUser")),this.$.logintext.setContent(l10n.get("Login")),this.$.owner.setIcon({directory:"icons",icon:"owner-icon.svg"}),this.$.colortext.setContent(l10n.get("ClickToColor")),this.history=preferences.getHistory(),this.history&&this.history.length||(this.history=[]),this.$.historybox.set("count",this.history.length,!0),this.resize(),this.ownerColor=Math.floor(Math.random()*xoPalette.colors.length),this.$.owner.setColorizedColor(xoPalette.colors[this.ownerColor]),this.$.newuser.setIcon({directory:"icons",icon:"newuser-icon.svg"}),this.$.login.setIcon({directory:"icons",icon:"login.svg"}),"rtl"==l10n.language.direction&&this.$.name.addClass("rtl-10"),this.createnew=!0,this.step=0,this.displayStep(),util.updateFavicon(),this.$.server.setValue(util.getClientType()==constant.appType?constant.defaultServer:util.getCurrentServerUrl()),util.getClientType()==constant.webAppType){var a=this;myserver.getServerInformation(myserver.getServerUrl(),function(b,c){c.url=util.getCurrentServerUrl(),preferences.setServer(c),a.$.server.setValue(c.url)})}var b=document.getElementById("toolbar");this.backgroundColor=b.style.backgroundColor,b.style.backgroundColor="white",document.getElementById("canvas").style.overflowY="hidden",util.hideNativeToolbar()},rendered:function(){this.inherited(arguments);var a=this;window.setTimeout(function(){0==a.history.length&&a.startTutorial()},constant.timerBeforeTutorial)},getView:function(){return constant.initView},setupHistory:function(a,b){var c=this.history[this.history.length-b.index-1];b.item.$.history.setColorizedColor(xoPalette.colors[c.color]),b.item.$.history.setColorized(!0),b.item.$.history.setText(c.name)},displayStep:function(){var a=!1,b=!1;vlogintext=!1,vnewuser=!1,vnewusertext=!1,vserverbox=!1,vnamebox=!1,vpassbox=!1,vcolortext=!1,vowner=!1,vnext=!1,vprevious=!1,vwarning=!1,vhistory=!1;switch(this.step){case 0:this.scrollToTop(),a=vlogintext=vnewuser=vnewusertext=!0,b=enyo.platform.electron,vhistory=!0,this.$.server.setValue(util.getClientType()==constant.appType?constant.defaultServer:util.getCurrentServerUrl()),this.$.server.setDisabled(!0);break;case 1:vserverbox=vnext=vprevious=!0,this.$.qrbutton.setShowing(enyo.platform.ios||enyo.platform.android||enyo.platform.androidChrome),this.$.next.setText(l10n.get("Next"));break;case 2:this.scrollToField(this.$.namebox),vnamebox=vnext=vprevious=!0,this.$.nametext.setContent(l10n.get(this.createnew?"ChooseName":"Name")),this.$.next.setText(l10n.get("Next"));break;case 3:this.scrollToField(this.$.passbox),vpassbox=vprevious=vnext=!0,this.$.password.setLabel(l10n.get(this.createnew?"ChoosePassword":"Password",{min:util.getMinPasswordSize()})),this.$.next.setText(l10n.get(this.createnew?"Next":"Done"));break;case 4:this.scrollToTop(),vcolortext=vprevious=vnext=vowner=!0,this.$.next.setText(l10n.get("Done"));break;case 5:return void this.createOrLogin()}this.$.stopbutton.setShowing(b),this.$.login.setShowing(a),this.$.logintext.setShowing(vlogintext),this.$.newuser.setShowing(vnewuser&&!constant.noSignupMode),this.$.newusertext.setShowing(vnewusertext&&!constant.noSignupMode),this.$.namebox.setShowing(vnamebox),this.$.name.setAttribute("readOnly",!vnamebox),vnamebox&&(this.$.name.focus(),this.$.name.hasNode().select()),this.$.serverbox.setShowing(vserverbox),vserverbox&&(this.$.server.focus(),this.$.server.hasNode().select()),this.$.passbox.setShowing(vpassbox),this.$.passbox&&this.$.password.giveFocus(),this.$.colortext.setShowing(vcolortext),this.$.owner.setShowing(vowner),this.$.previous.setShowing(vprevious),this.$.next.setShowing(vnext),this.$.historybox.setShowing(vhistory&&this.history.length),this.$.warningmessage.setShowing(vwarning)},newUser:function(){this.createnew=!0,this.step++,this.step++,this.displayStep()},login:function(){this.createnew=!1,this.step++,util.getClientType()==constant.webAppType&&this.step++,this.displayStep()},next:function(){if(!this.$.spinner.getShowing())if(1==this.step&&this.$.server.getValue()){this.$.spinner.setShowing(!0);var a=this;myserver.getServerInformation(this.$.server.getValue(),function(b,c){var d=c;d.url=a.$.server.getValue(),d.secure?d.url=d.url.replace(constant.http,constant.https):d.url=d.url.replace(constant.https,constant.http),preferences.setServer(d),a.step++,a.displayStep(),a.$.spinner.setShowing(!1),a.$.warningmessage.setShowing(!1)},function(){a.$.warningmessage.setContent(l10n.get("ErrorLoadingRemote")),a.$.warningmessage.setShowing(!0),a.$.spinner.setShowing(!1)})}else if(2==this.step){var b=this.$.name.getValue().trim();if(0==b.length)return;this.step++,util.getClientType()!=constant.appType||!this.createnew&&this.$.server.getValue()||this.step++,this.displayStep()}else if(3==this.step){var c=this.$.password.getPassword();if(0==c.length||c.length<util.getMinPasswordSize())return;this.step++,this.createnew||this.step++,this.displayStep()}else this.step++,this.displayStep()},previous:function(){if(!this.$.spinner.getShowing()){this.step--;var a=util.getClientType();(3==this.step&&a==constant.appType&&this.createnew||4==this.step&&!this.createnew||1==this.step&&(a==constant.webAppType||this.createnew))&&this.step--,this.displayStep()}},enterclick:function(a,b){if(13===b.keyCode)return this.next(),!0},unlockURL:function(){this.$.server.disabled&&(this.$.server.setDisabled(!this.$.server.disabled),this.scrollToField(this.$.serverbox),this.$.server.focus(),this.$.server.hasNode().select())},enterPassword:function(){this.next()},scrollToField:function(a){var b=a.hasNode();b&&(enyo.platform.android||enyo.platform.androidChrome)&&setTimeout(function(){b.scrollIntoView()},100)},scrollToTop:function(){var a=this.$.helpbutton.hasNode();a&&(enyo.platform.android||enyo.platform.androidChrome)&&setTimeout(function(){a.scrollIntoView(!0)},100)},nextcolor:function(){this.$.spinner.getShowing()||(this.ownerColor=this.ownerColor+1,this.ownerColor>=xoPalette.colors.length&&(this.ownerColor=0),this.$.owner.setColorizedColor(xoPalette.colors[this.ownerColor]),this.$.owner.render())},resize:function(){var a=util.getCanvasCenter();this.$.owner.applyStyle("margin-left",a.x-constant.sizeOwner/2+"px");var b=a.y-constant.sizeOwner/2;this.$.nameline.applyStyle("margin-top",b-15+"px"),this.$.serverline.applyStyle("margin-top",b-15+"px"),this.$.passbox.applyStyle("margin-top",b/2+"px"),this.$.owner.applyStyle("margin-top",b+"px"),this.$.warningmessage.applyStyle("left",a.x-100+"px"),this.$.colortext.applyStyle("margin-top",b-15+"px");var c=b-constant.sizeNewUser/2;if(this.$.newuser.applyStyle("margin-top",c+"px"),this.$.login.applyStyle("margin-top",c+"px"),this.$.historybox.applyStyle("margin-top",c+20+"px"),this.$.newusertext.applyStyle("margin-top",c+constant.sizeNewUser+20+"px"),this.$.newusertext.applyStyle("width",constant.sizeNewUser+"px"),this.$.logintext.applyStyle("margin-top",c+constant.sizeNewUser+20+"px"),this.$.logintext.applyStyle("width",constant.sizeNewUser+"px"),this.history.length){var d=a.x-1.5*constant.sizeNewUser-30;this.$.newuser.applyStyle("margin-left",d+"px"),this.$.newusertext.applyStyle("margin-left",d+"px"),d+=constant.sizeNewUser+30,this.$.login.applyStyle("margin-left",d+"px"),this.$.logintext.applyStyle("margin-left",d+"px"),d+=constant.sizeNewUser+30,this.$.historybox.applyStyle("margin-left",d+"px")}else{var e=constant.noSignupMode?-80:0;this.$.newuser.applyStyle("margin-left",a.x-constant.sizeNewUser-25+"px"),this.$.newusertext.applyStyle("margin-left",a.x-constant.sizeNewUser-25+"px"),this.$.login.applyStyle("margin-left",a.x+25+e+"px"),this.$.logintext.applyStyle("margin-left",a.x+25+e+"px")}},historyClicked:function(a,b){var c=this.history[this.history.length-b.index-1];if(this.$.name.setValue(c.name),this.$.server.setValue(c.server?c.server.url:""),c.server&&c.server.url){var d=this;myserver.getServerInformation(this.$.server.getValue(),function(a,b){b.url=d.$.server.getValue(),preferences.setServer(b)}),this.createnew=!1,this.step=3,this.displayStep()}else preferences.setName(c.name),preferences.setColor(c.color),this.launchDesktop()},createOrLogin:function(){if(preferences.setColor(this.ownerColor),preferences.setName(this.$.name.getValue().trim()),util.getClientType()!=constant.webAppType&&(this.createnew||!this.$.server.getValue()))return void this.launchDesktop();this.$.spinner.setShowing(!0),this.createnew?this.createUser():this.loginUser()},createUser:function(){var a=this;myserver.postUser({name:preferences.getName(),color:preferences.getColor(),language:preferences.getLanguage(),role:"student",password:this.$.password.getPassword(),options:{sync:preferences.getOptions("sync"),stats:preferences.getOptions("stats")}},function(b,c){a.loginUser()},function(b,c){a.$.spinner.setShowing(!1),22==c?a.$.warningmessage.setContent(l10n.get("UserAlreadyExist")):a.$.warningmessage.setContent(l10n.get("ServerError",{code:c})),a.$.warningmessage.setShowing(!0),a.step--})},loginUser:function(){var a=this,b={name:preferences.getName(),password:this.$.password.getPassword()};myserver.loginUser(b,function(b,c){preferences.setToken({x_key:c.user._id,access_token:c.token}),myserver.getUser(c.user._id,function(b,c){preferences.setNetworkId(c._id),preferences.setPrivateJournal(c.private_journal),preferences.setSharedJournal(c.shared_journal),preferences.setConnected(!0),l10n.language.code=c.language,preferences.merge(c)&&preferences.save(),a.$.spinner.setShowing(!1),a.launchDesktop()},function(b,c){a.$.warningmessage.setContent(l10n.get("ServerError",{code:c})),a.$.warningmessage.setShowing(!0),a.$.spinner.setShowing(!1),a.step--})},function(b,c){1==c?a.$.warningmessage.setContent(l10n.get("UserLoginInvalid")):a.$.warningmessage.setContent(l10n.get("ServerError",{code:c})),a.$.warningmessage.setShowing(!0),a.$.spinner.setShowing(!1),a.step--})},scanQR:function(){var a=this;a.scrollToField(a.$.helpbutton),util.scanQRCode(function(b){a.$.server.setValue(b)},function(){a.scrollToField(a.$.serverbox),a.$.server.focus(),a.$.server.hasNode().select()})},quitApplication:function(){util.quitApp()},startTutorial:function(){tutorial.setElement("newuser",this.$.newuser.getAttribute("id")),tutorial.setElement("login",this.$.login.getAttribute("id")),tutorial.setElement("historybox",this.$.historybox.getAttribute("id")),tutorial.setElement("helpbutton",this.$.helpbutton.getAttribute("id")),tutorial.setElement("stopbutton",this.$.stopbutton.getAttribute("id")),tutorial.setElement("serverbox",this.$.server.getAttribute("id")),tutorial.setElement("qrcode",this.$.qrbutton.getAttribute("id")),tutorial.setElement("namebox",this.$.name.getAttribute("id")),tutorial.setElement("passbox",this.$.password.children[0].id),tutorial.setElement("previous",this.$.previous.getAttribute("id")),tutorial.setElement("next",this.$.next.getAttribute("id")),tutorial.setElement("owner",this.$.owner.getAttribute("id")),tutorial.setElement("createnew",this.createnew),tutorial.setElement("currentstep",this.step),tutorial.start()},launchDesktop:function(){document.getElementById("toolbar").style.backgroundColor=this.backgroundColor,document.getElementById("canvas").style.overflowY="auto",isFirstLaunch=0==this.history.length&&this.createnew,app=new Sugar.Desktop,app.renderInto(document.getElementById("canvas")),preferences.save()}}),enyo.kind({name:"Sugar.EE",kind:enyo.Control,published:{mode:1},components:[{name:"endscreen",kind:"Image",src:"images/uiwarning.png",classes:"shutdownimage",showing:!1,ontap:"reload"},{name:"audio",kind:"Sugar.Audio"},{name:"owner",kind:"Sugar.Icon",size:constant.sizeOwner,icon:{directory:"icons",icon:"owner-icon.svg"},colorized:!0,colorizedColor:{stroke:"#666666",fill:"#FFFFFF"},classes:"owner-icon",showing:!1},{name:"dots"},{name:"lab",kind:"Image",src:"images/eelab.svg",classes:"eelab",showing:!1},{name:"fed",kind:"Image",src:"images/eefed.jpg",classes:"eefed",showing:!1}],create:function(){this.inherited(arguments),this.timer=null,this.step=0,app.noresize=!0},rendered:function(){this.inherited(arguments),this.draw()},modeChanged:function(){this.draw()},reload:function(){location.reload()},draw:function(){if(this.addRemoveClass("eedownscreen",!1),this.addRemoveClass("shutdownscreen",!1),1==this.mode){if(this.step)return;this.addRemoveClass("eescreen",!0),this.$.audio.play("audio/eeboot"),this.step=1,this.timer=window.setInterval(enyo.bind(this,"processStep"),1e3)}else 2==this.mode&&(this.addRemoveClass("shutdownscreen",!0),this.$.endscreen.setShowing(!0))},processStep:function(){var a={stroke:"#000000",fill:"#999999"},b={stroke:"#000000",fill:"#666666"};switch(this.step++){case 1:var c=util.getCanvasCenter();this.$.owner.setX(c.x-constant.sizeOwner/2),this.$.owner.setY(c.y-constant.sizeOwner/2),this.$.owner.setShowing(!0);break;case 11:this.dots=[];for(var d=24,e=this.$.owner.getSize(),f=this.$.owner.getX()+e/2-d/2,g=this.$.owner.getY()+e/2-d/2,h=2*Math.PI,i=1.5*e,j=Math.PI/2,k=h/parseFloat(24),l=0;l<24;l++){x=f+Math.cos(j)*i,y=g+Math.sin(j)*i;var m=this.$.dots.createComponent({kind:"Sugar.Icon",icon:{directory:"icons",icon:"dot.svg"},size:d,x:x,y:y,colorizedColor:a,colorized:!0,showing:0==l},{owner:this});m.render(),this.dots.push(m),j+=k}break;case 20:for(var l=0;l<24;l++)this.dots[l].setShowing(!0);this.$.fed.setShowing(!0),this.$.lab.setShowing(!0);break;case 21:for(var l=0;l<24;l+=4)this.dots[l].setColorizedColor(b);break;case 22:case 23:case 24:case 25:case 26:for(var n=[],l=0;l<24;l++)n.push(this.dots[l].getColorizedColor());for(var l=0;l<24;l++)this.dots[l].setColorizedColor(n[0==l?23:l-1]);break;case 27:for(var l=0;l<24;l++)this.dots[l].setColorizedColor(b);break;case 39:window.clearInterval(this.timer),this.reload()}},encoded:"5118425f65645b621642576961df1822183a57645f5b62164457686c575b701822183d65647057626516455a5f57685a1822184357646b5b6216476b5fe765645b69182218395e685f696a5f576416496a68655b6a635764641822184057696564164d5b576a5e5b6869586f182218466b645b5b6a1641576b68182218465f5b68685b164c5768626f1822184457605f1638656b6370656b5d5e182218495e5f68695e16505f58586b182218465f656a681637646a6569701822184a6f63656416462448575a705f6118221843576ae35769164357686ae3645b70182218395e5768625b691639656969df1822184c5f596a6568164a576157615f18221838685f576416495f626c5b686357641822185959682a581822184065685d5b163762585b686a65163de9635b701642e9665b70182218395e685f696a65665e163a5b68645a65685c5b68182218376f6b695e1642655e57645f18221838576a595e6b164c5b6461576a164c5f695e5762182218495764576a57641822183f5d6457595f651648655a68e35d6b5b70182218495764595e5f6a16415766656568182218495763696564163d655a5a6f1822184857605b5b6c1648576c5f645a685764182218466857585e6b164657646a18221846576b6265163c685764595f69596516496265636618221843655e5f6a16495e57686357182218435764615f68576a16495f645d5e1822186a68575a705f61182218435f595e57e16216455e576f656418221863576a5f57696357686a5f645b5b5b70182218495b5857696a5f576416495f626c57182218416b6457621643655e6a57182218496b6857601822186023695e6b585e1822184668576157695e164b60606d5762182218695a705f6b5a5718221857685f5b6969571822183e5768685f6965641641576a701822183764695e6b63576416385e57685a6d5760182218376c5f6457695e16375d57686d5762182218435f595e575b6216466b1822186266276a5b61182218435f5e5f6816495e575e1822183a5f645b695e16395e656b5a5e57686f1822183b6a5e576416445b6269656423436565685b182218465f656a681637646a656970182218486569571637645f62163d5b65685d5b1822183c685b5a5a5f5b441822183c685b5b163b5a6b59576a5f656457621649655c6a6d57685b165c6568164365585f625b163a5b6c5f595b691623164a6857646962576a5f656469166a6516386857705f625f5764164665686a6b5d6b5b695b18221857695e5f695e16575d5d57686d57621822186c6068601822183b685f59164f6565641822184957635b5b6816416b6357681649576a6f575a5768695e5f1822183762576416375d6b5f57681822186457655c6b6318221837645a685b57163d65647057625b691822183f586b616b6465626b6d57163c576a65615f1822184b6a615768695e1648576016495f645d5e1822184957636f656116445b665762182218385b686a163c685b6b5a5b64585b685d18221849576b68576c164668576a5f5e57681822184357686a5f641637585b646a5b1642575e576f5b1822183a576c5b1639686569696257645a182218445f616562576f163d656966655a5f64656c182218665e65685f5957621822183c685764596516396568685b571822183b6b57641645645d182218625b656457685a596018221837686f576416435b5a5f68576a6a571822184f57695e57695e6c5f163a576c5b1822183857696a5f5b641822184d57626a5b6816385b645a5b681853",contributors:function(){for(var a="",b=0;b<this.encoded.length;b+=2){var c=parseInt(this.encoded.substr(b,2),16);a+=String.fromCharCode(c+10)}for(var d=JSON.parse(a),e=[],b=0;b<d.length;b++){var f=b?xoPalette.colors[Math.floor(Math.random()*xoPalette.colors.length)]:{stroke:"#005FE4",fill:"#FF2B34"};e.push({networkId:"nxx"+b,name:d[b],colorvalue:f})}return e}});