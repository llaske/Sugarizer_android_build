enyo.kind({name:"Sugar.FirstScreen",kind:enyo.Control,components:[{name:"stopbutton",kind:"Sugar.Icon",size:constant.sizeEmpty,icon:{directory:"lib/sugar-web/graphics/icons/actions",icon:"activity-stop.svg"},colorized:!0,colorizedColor:{fill:"#666666",stroke:"#ffffff"},ontap:"quitApplication",classes:"first-quit"},{name:"helpbutton",kind:"Sugar.Icon",size:constant.sizeEmpty,icon:{directory:"icons",icon:"help.svg"},colorized:!0,colorizedColor:{stroke:"#666666",fill:"#ffffff"},ontap:"startTutorial",classes:"first-help"},{name:"namebox",classes:"first-namebox",onresize:"resize",showing:!1,components:[{name:"nameline",classes:"first-nameline",components:[{name:"nametext",content:"xxx",classes:"first-nametext"},{classes:"first-input",components:[{name:"name",kind:"Input",classes:"first-namevalue",onkeydown:"enterclick"}]}]}]},{name:"serverbox",classes:"first-serverbox",onresize:"resize",showing:!1,components:[{name:"serverline",classes:"first-serverline",components:[{name:"servertext",content:"xxx",classes:"first-servertext"},{classes:"first-input",components:[{name:"server",kind:"Input",classes:"first-servervalue",onkeydown:"enterclick",disabled:!0,ontap:"unlockURL"}]},{name:"qrbutton",kind:"Sugar.Icon",size:constant.sizeEmpty,icon:{directory:"icons",icon:"qrcode.svg"},ontap:"scanQR",classes:"first-qr"}]}]},{name:"passbox",classes:"first-passbox",onresize:"resize",showing:!1,components:[{name:"password",kind:"Sugar.Password",onEnter:"enterPassword"}]},{name:"historybox",classes:"first-historybox",kind:"Repeater",onSetupItem:"setupHistory",onresize:"resize",showing:!1,components:[{name:"history",kind:"Sugar.IconButton",icon:{directory:"icons",icon:"owner-icon.svg"},classes:"first-historybutton",ontap:"historyClicked"}]},{name:"previous",kind:"Sugar.IconButton",icon:{directory:"icons",icon:"go-left.svg"},classes:"first-leftbutton",ontap:"previous",showing:!1},{name:"next",kind:"Sugar.IconButton",icon:{directory:"icons",icon:"go-right.svg"},classes:"first-rightbutton",ontap:"next",showing:!1},{name:"colortext",content:"xxx",classes:"first-colortext",showing:!1},{name:"owner",kind:"Sugar.Icon",size:constant.sizeOwner,colorized:!0,classes:"first-owner-icon",showing:!1,onresize:"resize",ontap:"nextcolor"},{name:"newuser",kind:"Sugar.Icon",size:constant.sizeNewUser,colorized:!1,classes:"first-owner-icon",showing:!0,onresize:"resize",ontap:"newUser"},{name:"newusertext",content:"xxx",classes:"newuser-text"},{name:"login",kind:"Sugar.Icon",size:constant.sizeNewUser,colorized:!1,classes:"first-owner-icon",showing:!0,onresize:"resize",ontap:"login"},{name:"logintext",content:"xxx",classes:"newuser-text"},{name:"spinner",kind:"Image",src:"images/spinner-light.gif",classes:"spinner",showing:!1},{name:"warningmessage",content:"xxx",classes:"first-warningmessage",showing:!0}],create:function(){if(app=this,this.inherited(arguments),this.localize(),this.history=preferences.getHistory(),this.history&&this.history.length||(this.history=[]),this.$.historybox.set("count",this.history.length,!0),this.resize(),this.ownerColor=Math.floor(Math.random()*xoPalette.colors.length),this.$.owner.setColorizedColor(xoPalette.colors[this.ownerColor]),this.$.newuser.setIcon({directory:"icons",icon:"newuser-icon.svg"}),this.$.login.setIcon({directory:"icons",icon:"login.svg"}),"rtl"==l10n.language.direction&&this.$.name.addClass("rtl-10"),this.createnew=!0,this.step=0,this.displayStep(),util.updateFavicon(),this.$.server.setValue(util.getClientType()==constant.appType?constant.defaultServer:util.getCurrentServerUrl()),util.getClientType()==constant.webAppType){var e=this;myserver.getServerInformation(myserver.getServerUrl(),(function(t,s){s.url=util.getCurrentServerUrl(),preferences.setServer(s),e.$.server.setValue(s.url)}))}var t=document.getElementById("toolbar");this.backgroundColor=t.style.backgroundColor,t.style.backgroundColor="white",document.getElementById("canvas").style.overflowY="hidden",util.hideNativeToolbar()},rendered:function(){this.inherited(arguments);var e=this;window.setTimeout((function(){0==e.history.length&&e.startTutorial()}),constant.timerBeforeTutorial)},localize:function(){this.$.nametext.setContent(l10n.get("Name")),this.$.servertext.setContent(l10n.get("ServerUrl")),this.$.password.setLabel(l10n.get("Password")),this.$.previous.setText(l10n.get("Back")),this.$.next.setText(l10n.get("Next")),this.$.newusertext.setContent(l10n.get("NewUser")),this.$.logintext.setContent(l10n.get("Login")),this.$.owner.setIcon({directory:"icons",icon:"owner-icon.svg"}),this.$.colortext.setContent(l10n.get("ClickToColor"))},getView:function(){return constant.initView},setupHistory:function(e,t){var s=this.history[this.history.length-t.index-1];t.item.$.history.setColorizedColor(xoPalette.colors[s.color]),t.item.$.history.setColorized(!0),t.item.$.history.setText(s.name)},displayStep:function(){var e=!1,t=!1;switch(vlogintext=!1,vnewuser=!1,vnewusertext=!1,vserverbox=!1,vnamebox=!1,vpassbox=!1,vcolortext=!1,vowner=!1,vnext=!1,vprevious=!1,vwarning=!1,vhistory=!1,this.step){case 0:this.scrollToTop(),e=vlogintext=vnewuser=vnewusertext=!0,t=enyo.platform.electron,vhistory=!0,this.$.server.setValue(util.getClientType()==constant.appType?constant.defaultServer:util.getCurrentServerUrl()),this.$.server.setDisabled(!0);break;case 1:vserverbox=vnext=vprevious=!0,this.$.qrbutton.setShowing(enyo.platform.ios||enyo.platform.android||enyo.platform.androidChrome),this.$.next.setText(l10n.get("Next"));break;case 2:this.scrollToField(this.$.namebox),vnamebox=vnext=vprevious=!0,this.$.nametext.setContent(l10n.get(this.createnew?"ChooseName":"Name")),this.$.next.setText(l10n.get("Next"));break;case 3:this.scrollToField(this.$.passbox),vpassbox=vprevious=vnext=!0,this.$.password.setLabel(l10n.get(this.createnew?"ChoosePassword":"Password",{min:util.getMinPasswordSize()})),this.$.next.setText(l10n.get(this.createnew?"Next":"Done"));break;case 4:this.scrollToTop(),vcolortext=vprevious=vnext=vowner=!0,this.$.next.setText(l10n.get("Done"));break;case 5:return void this.createOrLogin()}this.$.stopbutton.setShowing(t),this.$.login.setShowing(e),this.$.logintext.setShowing(vlogintext),this.$.newuser.setShowing(vnewuser&&!constant.noSignupMode),this.$.newusertext.setShowing(vnewusertext&&!constant.noSignupMode),this.$.namebox.setShowing(vnamebox),this.$.name.setAttribute("readOnly",!vnamebox),vnamebox&&(this.$.name.focus(),this.$.name.hasNode().select()),this.$.serverbox.setShowing(vserverbox),vserverbox&&(this.$.server.focus(),this.$.server.hasNode().select()),this.$.passbox.setShowing(vpassbox),this.$.passbox&&this.$.password.giveFocus(),this.$.colortext.setShowing(vcolortext),this.$.owner.setShowing(vowner),this.$.previous.setShowing(vprevious),this.$.next.setShowing(vnext),this.$.historybox.setShowing(vhistory&&this.history.length),this.$.warningmessage.setShowing(vwarning)},newUser:function(){this.createnew=!0,this.step++,this.step++,this.displayStep()},login:function(){this.createnew=!1,this.step++,util.getClientType()==constant.webAppType&&this.step++,this.displayStep()},next:function(){if(!this.$.spinner.getShowing())if(1==this.step&&this.$.server.getValue()){this.$.spinner.setShowing(!0);var e=this;myserver.getServerInformation(this.$.server.getValue(),(function(t,s){var n=s;n.url=e.$.server.getValue(),n.secure?n.url=n.url.replace(constant.http,constant.https):n.url=n.url.replace(constant.https,constant.http),preferences.setServer(n),e.step++,e.displayStep(),e.$.spinner.setShowing(!1),e.$.warningmessage.setShowing(!1)}),(function(){e.$.warningmessage.setContent(l10n.get("ErrorLoadingRemote")),e.$.warningmessage.setShowing(!0),e.$.spinner.setShowing(!1)}))}else if(2==this.step){var t=this.$.name.getValue().trim();if(0==t.length)return;util.getClientType()!=constant.appType||!this.createnew&&this.$.server.getValue()?this.createnew?this.checkUsername(t):this.step++:(this.step+=2,this.displayStep()),this.displayStep()}else if(3==this.step){var s=this.$.password.getPassword();if(0==s.length||s.length<util.getMinPasswordSize())return;this.step++,this.createnew||this.step++,this.displayStep()}else this.step++,this.displayStep()},previous:function(){if(!this.$.spinner.getShowing()){this.step--;var e=util.getClientType();(3==this.step&&e==constant.appType&&this.createnew||4==this.step&&!this.createnew||1==this.step&&(e==constant.webAppType||this.createnew))&&this.step--,this.displayStep()}},enterclick:function(e,t){if(13===t.keyCode)return this.next(),!0},unlockURL:function(){this.$.server.disabled&&(this.$.server.setDisabled(!this.$.server.disabled),this.scrollToField(this.$.serverbox),this.$.server.focus(),this.$.server.hasNode().select())},enterPassword:function(){this.next()},scrollToField:function(e){var t=e.hasNode();t&&(enyo.platform.android||enyo.platform.androidChrome)&&setTimeout((function(){t.scrollIntoView()}),100)},scrollToTop:function(){var e=this.$.helpbutton.hasNode();e&&(enyo.platform.android||enyo.platform.androidChrome)&&setTimeout((function(){e.scrollIntoView(!0)}),100)},nextcolor:function(){this.$.spinner.getShowing()||(this.ownerColor=this.ownerColor+1,this.ownerColor>=xoPalette.colors.length&&(this.ownerColor=0),this.$.owner.setColorizedColor(xoPalette.colors[this.ownerColor]),this.$.owner.render())},resize:function(){var e=util.getCanvasCenter();this.$.owner.applyStyle("margin-left",e.x-constant.sizeOwner/2+"px");var t=e.y-constant.sizeOwner/2;this.$.nameline.applyStyle("margin-top",t-15+"px"),this.$.serverline.applyStyle("margin-top",t-15+"px"),this.$.passbox.applyStyle("margin-top",t/2+"px"),this.$.owner.applyStyle("margin-top",t+"px"),this.$.warningmessage.applyStyle("left",e.x-100+"px"),this.$.colortext.applyStyle("margin-top",t-15+"px");var s=t-constant.sizeNewUser/2;if(this.$.newuser.applyStyle("margin-top",s+"px"),this.$.login.applyStyle("margin-top",s+"px"),this.$.historybox.applyStyle("margin-top",s+20+"px"),this.$.newusertext.applyStyle("margin-top",s+constant.sizeNewUser+20+"px"),this.$.newusertext.applyStyle("width",constant.sizeNewUser+"px"),this.$.logintext.applyStyle("margin-top",s+constant.sizeNewUser+20+"px"),this.$.logintext.applyStyle("width",constant.sizeNewUser+"px"),this.history.length){var n=e.x-1.5*constant.sizeNewUser-30;this.$.newuser.applyStyle("margin-left",n+"px"),this.$.newusertext.applyStyle("margin-left",n+"px"),n+=constant.sizeNewUser+30,this.$.login.applyStyle("margin-left",n+"px"),this.$.logintext.applyStyle("margin-left",n+"px"),n+=constant.sizeNewUser+30,this.$.historybox.applyStyle("margin-left",n+"px")}else{var i=constant.noSignupMode?-80:0;this.$.newuser.applyStyle("margin-left",e.x-constant.sizeNewUser-25+"px"),this.$.newusertext.applyStyle("margin-left",e.x-constant.sizeNewUser-25+"px"),this.$.login.applyStyle("margin-left",e.x+25+i+"px"),this.$.logintext.applyStyle("margin-left",e.x+25+i+"px")}},historyClicked:function(e,t){var s=this.history[this.history.length-t.index-1];if(this.$.name.setValue(s.name),this.$.server.setValue(s.server?s.server.url:""),s.server&&s.server.url){var n=this;myserver.getServerInformation(this.$.server.getValue(),(function(e,t){t.url=n.$.server.getValue(),preferences.setServer(t)})),this.createnew=!1,this.step=3,this.displayStep()}else preferences.setName(s.name),preferences.setColor(s.color),this.launchDesktop()},createOrLogin:function(){if(preferences.setColor(this.ownerColor),preferences.setName(this.$.name.getValue().trim()),util.getClientType()!=constant.webAppType&&(this.createnew||!this.$.server.getValue()))return preferences.addUserInHistory(),void this.launchDesktop();this.$.spinner.setShowing(!0),this.createnew?this.createUser():this.loginUser()},checkUsername:function(e){var t=this;t.$.spinner.setShowing(!0),myserver.postUser({name:e,role:"student",beforeSignup:!0},(function(e,s){s.exists||(t.step++,t.displayStep()),t.$.spinner.setShowing(!1)}),(function(e,s){2==s?(t.step++,t.displayStep()):(22==s?t.$.warningmessage.setContent(l10n.get("UserAlreadyExist")):t.$.warningmessage.setContent(l10n.get("ServerError",{code:s})),t.$.warningmessage.setShowing(!0)),t.$.spinner.setShowing(!1)}))},createUser:function(){var e=this;myserver.postUser({name:preferences.getName(),color:preferences.getColor(),language:preferences.getLanguage(),role:"student",password:this.$.password.getPassword(),options:{sync:preferences.getOptions("sync"),stats:preferences.getOptions("stats")}},(function(t,s){e.loginUser()}),(function(t,s){e.$.spinner.setShowing(!1),22==s?e.$.warningmessage.setContent(l10n.get("UserAlreadyExist")):e.$.warningmessage.setContent(l10n.get("ServerError",{code:s})),e.$.warningmessage.setShowing(!0),e.step--}))},loginUser:function(){var e=this,t={name:preferences.getName(),password:this.$.password.getPassword()};myserver.loginUser(t,(function(t,s){preferences.setToken({x_key:s.user._id,access_token:s.token}),myserver.getUser(s.user._id,(function(t,s){preferences.setNetworkId(s._id),preferences.setPrivateJournal(s.private_journal),preferences.setSharedJournal(s.shared_journal),preferences.setConnected(!0),l10n.language.code=s.language,preferences.merge(s)&&preferences.save(),e.$.spinner.setShowing(!1),preferences.addUserInHistory(),e.launchDesktop()}),(function(t,s){e.$.warningmessage.setContent(l10n.get("ServerError",{code:s})),e.$.warningmessage.setShowing(!0),e.$.spinner.setShowing(!1),e.step--}))}),(function(t,s){1==s?e.$.warningmessage.setContent(l10n.get("UserLoginInvalid")):e.$.warningmessage.setContent(l10n.get("ServerError",{code:s})),e.$.warningmessage.setShowing(!0),e.$.spinner.setShowing(!1),e.step--}))},scanQR:function(){var e=this;e.scrollToField(e.$.helpbutton),util.scanQRCode((function(t){e.$.server.setValue(t)}),(function(){e.scrollToField(e.$.serverbox),e.$.server.focus(),e.$.server.hasNode().select()}))},quitApplication:function(){util.quitApp()},startTutorial:function(){tutorial.setElement("newuser",this.$.newuser.getAttribute("id")),tutorial.setElement("login",this.$.login.getAttribute("id")),tutorial.setElement("historybox",this.$.historybox.getAttribute("id")),tutorial.setElement("helpbutton",this.$.helpbutton.getAttribute("id")),tutorial.setElement("stopbutton",this.$.stopbutton.getAttribute("id")),tutorial.setElement("serverbox",this.$.server.getAttribute("id")),tutorial.setElement("qrcode",this.$.qrbutton.getAttribute("id")),tutorial.setElement("namebox",this.$.name.getAttribute("id")),tutorial.setElement("passbox",this.$.password.children[0].id),tutorial.setElement("previous",this.$.previous.getAttribute("id")),tutorial.setElement("next",this.$.next.getAttribute("id")),tutorial.setElement("owner",this.$.owner.getAttribute("id")),tutorial.setElement("createnew",this.createnew),tutorial.setElement("currentstep",this.step),tutorial.start()},launchDesktop:function(){document.getElementById("toolbar").style.backgroundColor=this.backgroundColor,document.getElementById("canvas").style.overflowY="auto",isFirstLaunch=0==this.history.length&&this.createnew,app=new Sugar.Desktop,app.renderInto(document.getElementById("canvas")),preferences.save()}}),enyo.kind({name:"Sugar.EE",kind:enyo.Control,published:{mode:1},components:[{name:"endscreen",kind:"Image",src:"images/uiwarning.png",classes:"shutdownimage",showing:!1,ontap:"reload"},{name:"audio",kind:"Sugar.Audio"},{name:"owner",kind:"Sugar.Icon",size:constant.sizeOwner,icon:{directory:"icons",icon:"owner-icon.svg"},colorized:!0,colorizedColor:{stroke:"#666666",fill:"#FFFFFF"},classes:"owner-icon",showing:!1},{name:"dots"},{name:"lab",kind:"Image",src:"images/eelab.svg",classes:"eelab",showing:!1},{name:"fed",kind:"Image",src:"images/eefed.jpg",classes:"eefed",showing:!1}],create:function(){this.inherited(arguments),this.timer=null,this.step=0,app.noresize=!0},rendered:function(){this.inherited(arguments),this.draw()},modeChanged:function(){this.draw()},reload:function(){location.reload()},draw:function(){if(this.addRemoveClass("eedownscreen",!1),this.addRemoveClass("shutdownscreen",!1),1==this.mode){if(this.step)return;this.addRemoveClass("eescreen",!0),this.$.audio.play("audio/eeboot"),this.step=1,this.timer=window.setInterval(enyo.bind(this,"processStep"),1e3)}else 2==this.mode&&(this.addRemoveClass("shutdownscreen",!0),this.$.endscreen.setShowing(!0))},processStep:function(){var e={stroke:"#000000",fill:"#999999"},t={stroke:"#000000",fill:"#666666"};switch(this.step++){case 1:var s=util.getCanvasCenter();this.$.owner.setX(s.x-constant.sizeOwner/2),this.$.owner.setY(s.y-constant.sizeOwner/2),this.$.owner.setShowing(!0);break;case 11:this.dots=[];for(var n=this.$.owner.getSize(),i=this.$.owner.getX()+n/2-12,o=this.$.owner.getY()+n/2-12,r=2*Math.PI,a=1.5*n,l=Math.PI/2,c=r/parseFloat(24),h=0;h<24;h++){x=i+Math.cos(l)*a,y=o+Math.sin(l)*a;var p=this.$.dots.createComponent({kind:"Sugar.Icon",icon:{directory:"icons",icon:"dot.svg"},size:24,x:x,y:y,colorizedColor:e,colorized:!0,showing:0==h},{owner:this});p.render(),this.dots.push(p),l+=c}break;case 20:for(h=0;h<24;h++)this.dots[h].setShowing(!0);this.$.fed.setShowing(!0),this.$.lab.setShowing(!0);break;case 21:for(h=0;h<24;h+=4)this.dots[h].setColorizedColor(t);break;case 22:case 23:case 24:case 25:case 26:var g=[];for(h=0;h<24;h++)g.push(this.dots[h].getColorizedColor());for(h=0;h<24;h++)this.dots[h].setColorizedColor(g[0==h?23:h-1]);break;case 27:for(h=0;h<24;h++)this.dots[h].setColorizedColor(t);break;case 39:window.clearInterval(this.timer),this.reload()}},encoded:"5118425f65645b621642576961df1822183a57645f5b62164457686c575b701822183d65647057626516455a5f57685a1822184357646b5b6216476b5fe765645b69182218395e685f696a5f576416496a68655b6a635764641822184057696564164d5b576a5e5b6869586f182218466b645b5b6a1641576b68182218465f5b68685b164c5768626f1822184457605f1638656b6370656b5d5e182218495e5f68695e16505f58586b182218465f656a681637646a6569701822184a6f63656416462448575a705f6118221843576ae35769164357686ae3645b70182218395e5768625b691639656969df1822184c5f596a6568164a576157615f18221838685f576416495f626c5b68635764182218495764576a5764182218435768596b6916395e65645d18221837645a685b57163d65647057625b6918221857695e5f695e16575d5d57686d5762182218695a705f6b5a571822184d57626a5b6816385b645a5b6818221863576a5f57696357686a5f645b5b5b7018221846576b6265163c685764595f6959651649626563661822184668576157695e164b60606d5762182218435764615f68576a16495f645d5e1822183c685b5a5a5f5b4418221843655e5f6a16495e57686357182218416b6357681649576b6857585e16485760182218435f595e57e16216455e576f65641822183a5e686b6c16435f69685718221857585e5f695e5b616a57646d5768182218695e5f615e57685d57685d272e2728182218696b665b685e57615768182218395e685f696a65665e163a5b68645a65685c5b681822184b5769615b5a2a5a576a18221844576a5e5764163a5f63635b6818221838576a595e6b164c5b6461576a164c5f695e57621822186266276a5b611822184065685d5b163762585b686a65163de9635b701642e9665b701822184b6a615768695e1648576016495f645d5e182218376257696a575f6843233b1822183c685b5b163b5a6b59576a5f656457621649655c6a6d57685b165c6568164365585f625b163a5b6c5f595b691623164a6857646962576a5f656469166a6516386857705f625f5764164665686a6b5d6b5b695b182218376c5f6457695e16375d57686d57621822183857696a5f5b641822186a68575a705f611822184c57645b696957163c685b6b5a5b64585b685d1822185b696a282d27182218495b5857696a5f576416495f626c571822183a5f645b695e16395e656b5a5e57686f182218665e65685f5957621822183b685f59164f6565641822183764695e6b63576416385e57685a6d5760182218495764595e5f6a164157666565681822185959682a58182218376f6b695e1642655e57645f1822183a5b6c57616b6357681822183b6a5e576416445b6269656423436565685b1822183e5b635764695e16415e57645b60571822183f5d6457595f651648655a68e35d6b5b701822184257685f6969571643656b6857182218465f656a681637646a6569701822184957635b5b6816416b6357681649576a6f575a5768695e5f1822184857605b5b6c1648576c5f645a685764182218495e57612826262618221857685f5b6969571822186023695e6b585e182218416b6457621643655e6a57182218496b68576018221837686f576416435b5a5f68576a6a571822183c685764596516396568685b571822186457655c6b631822183a5f6c6f5764695e164a685f66576a5e5f1822183762576416375d6b5f57681822183a576c5b1639686569696257645a1822183e5768685f6965641641576a701822183f586b616b6465626b6d57163c576a65615f182218435f595e575b6216466b1822184357686a5f641637585b646a5b1642575e576f5b182218486569571637645f62163d5b65685d5b182218445f616562576f163d656966655a5f64656c182218466857585e6b164657646a1822184957695e685b5b611643575d57641822184957636f656116445b6657621822184957686a5e5761165d6b666a5718221849576b68576c164668576a5f5e57681822184f57695e57695e6c5f163a576c5b182218435f5e5f6816495e575e1822183b6b57641645645d182218625b656457685a59601822186c606860182218495763696564163d655a5a6f1853",contributors:function(){for(var e="",t=0;t<this.encoded.length;t+=2){var s=parseInt(this.encoded.substr(t,2),16);e+=String.fromCharCode(s+10)}var n=JSON.parse(e),i=[];for(t=0;t<n.length;t++){var o=t?xoPalette.colors[Math.floor(Math.random()*xoPalette.colors.length)]:{stroke:"#005FE4",fill:"#FF2B34"};i.push({networkId:"nxx"+t,name:n[t],colorvalue:o})}return i}});