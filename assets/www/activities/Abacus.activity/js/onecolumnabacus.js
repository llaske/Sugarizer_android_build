/*! Sugarizer 2020-03-14 */
function OneColumnAbacus(a,b,c,d,e,f,g,h,i,j){void 0===f&&(f=b),void 0===g&&(g=!1),void 0===h&&(h=!1),void 0===i&&(i=!1),void 0===j&&(j=!1),this.blockScaleYFromX=25/33,this.topBottomBarScale=1.6,this.leftRightBarScale=1.6*this.blockScaleYFromX,this.middleBarScale=1,this.horizontalMargin=1/3,this.verticalMargin=.05,this.extraBeads=2,this.rods=b,this.blockHeight=0,this.blockWidth=0,this.abacusHeight=0,this.abacusWidth=0,this.upperBlockHeight=0,this.lowerBlockHeight=0,this.colHeight=0,this.stage=a,this.columns=[],this.rodtext=[],this.answertext=null,this.trix=null,this.startx=null,this.schetyColumns=[1e9,1e8,1e7,1e6,1e5,1e4,1e3,100,10,1,.25,.1,.01,.001,1e-4],this.fractionColumns=[1e5,1e4,1e3,100,10,1,[1,2],[1,3],[1,4],[1,5],[1,6],[1,8],[1,9],[1,10],[1,12]],this.rodsColumns=[[1,1],[1,2],[1,3],[1,4],[1,5],[1,6],[1,7],[1,8],[1,9],[1,10]],this.rodsColours=["#FFFFFF","#FC0D1B","#88FD31","#FC28FC","#FFFD38","#1FCC23","#000000","#AA6717","#23CCFC","#FD8824"],this.blockGivenWidth=function(a){return a/(2*this.leftRightBarScale+b+this.horizontalMargin*b)},this.blockGivenHeight=function(a){return a/(2*this.topBottomBarScale+(c+this.extraBeads)+this.verticalMargin*(c+this.extraBeads))},this.heightGivenBlockWidth=function(a){return this.blockScaleYFromX*a*(2*this.topBottomBarScale+(c+this.extraBeads)+this.verticalMargin*(c+this.extraBeads))},this.widthGivenBlockWidth=function(a){return a*(2*this.leftRightBarScale+b+this.horizontalMargin*b)},this.initValues=function(){var b=.85*a.canvas.height,d=.9*a.canvas.width,e=this.blockGivenWidth(d),f=this.blockScaleYFromX*e;this.heightGivenBlockWidth(e)>b&&(f=this.blockGivenHeight(b),e=f/this.blockScaleYFromX,console.log("Using height")),this.blockHeight=f,this.blockWidth=e,this.abacusHeight=this.heightGivenBlockWidth(this.blockWidth),this.abacusWidth=this.widthGivenBlockWidth(this.blockWidth),this.colHeight=this.blockHeight*(c+this.extraBeads+this.verticalMargin*(c+this.extraBeads)),console.log(this.blockHeight),console.log(this.blockWidth),console.log(this.abacusHeight),console.log(this.abacusWidth),this.startx=(a.canvas.width-this.abacusWidth)/2+this.leftRightBarScale*this.blockWidth+this.horizontalMargin*this.blockWidth/2+this.blockWidth/2},this.initRectangle=function(){var b=new createjs.Shape;b.graphics.beginStroke("#000000"),b.graphics.setStrokeStyle(this.leftRightBarScale*this.blockWidth),b.graphics.beginFill("#C0C0C0").drawRoundRect(this.leftRightBarScale*this.blockWidth/2,this.leftRightBarScale*this.blockWidth/2,this.abacusWidth-this.leftRightBarScale*this.blockWidth,this.abacusHeight-this.leftRightBarScale*this.blockWidth,2/3*this.blockWidth),b.x=(a.canvas.width-this.abacusWidth)/2,b.y=a.canvas.height/10,a.addChild(b)},this.initTriangle=function(){this.tri=new createjs.Shape;var c=this.blockWidth/4*3,d=a.canvas.height/10+this.leftRightBarScale*this.blockWidth*2/3,e=(a.canvas.width-this.abacusWidth)/2+this.leftRightBarScale*this.blockWidth+this.horizontalMargin*this.blockWidth/2+this.blockWidth/2,f=this.horizontalMargin*this.blockWidth+this.blockWidth,g=e+f*(b-1);this.tri.graphics.moveTo(0-c/2,0).beginFill("#FC0D1B").lineTo(0+c/2,0).lineTo(0,0+this.leftRightBarScale*this.blockWidth/3).lineTo(0-c/2,0).closePath(),this.tri.x=g-this.blockWidth/2,this.tri.y=d,this.trix=this.tri.x-this.startx,a.addChild(this.tri);var h=this.tri,i=this;this.tri.on("mousedown",function(a){this.offset={x:h.x-a.stageX,y:h.y-a.stageY}}),this.tri.on("pressmove",function(a){a.stageX+this.offset.x<e-i.blockWidth/2?h.x=e-i.blockWidth/2:a.stageX+this.offset.x>g+i.blockWidth/2?h.x=g+i.blockWidth/2:h.x=a.stageX+this.offset.x,i.trix=h.x-i.startx})},this.initColumns=function(){var k,l=(a.canvas.width-this.abacusWidth)/2+this.leftRightBarScale*this.blockWidth+this.horizontalMargin*this.blockWidth/2+this.blockWidth/2,m=this.horizontalMargin*this.blockWidth+this.blockWidth,n=a.canvas.height/10+this.leftRightBarScale*this.blockWidth,o=n+this.colHeight,p=["#A0A0A0","#6B6B6B"],q=["#000000","#000000"];console.log(e);var r,s,t=e.fill,u=e.stroke;if(0==g&&0==h&&0==i&&0==j)for(var v=0;v<b;v++){if(v%2==0?(k=q,r=t):(k=p,r=u),f-v-1<0){var w=new window.Fraction(1);s=new window.Fraction(Math.pow(d,Math.abs(f-v-1))),s=w.div(s)}else s=new window.Fraction(Math.pow(d,f-v-1));var x=new StandardAbacusColumn(l,n,o,0,c,c+this.extraBeads,r,k,this,s,!1);x.init(),this.columns.push(x),l+=m}else if(1==g)for(var y,z=c+this.extraBeads,v=0;v<b;v++){v%2==0?(k=q,r=t):(k=p,r=u),s=new window.Fraction(this.schetyColumns[v]),console.log(s),y=10==v?4:c;var x=new StandardAbacusColumn(l,n,o,0,y,z,r,k,this,s,!1,!1,!0);x.init(),this.columns.push(x),l+=m}else if(1==i||1==h)for(var y,z=c+this.extraBeads,v=0;v<b;v++){if(v%2==0?(k=q,r=t):(k=p,r=u),v>5&&(r="#000000"),s=new window.Fraction(this.fractionColumns[v]),console.log(s),y=v>5?this.fractionColumns[v][1]:10,1==i)var x=new PosNegColumn(l,n,o,y,z,r,k,this,s,!1,!1);else var x=new StandardAbacusColumn(l,n,o,0,y,z,r,k,this,s,!1,!1);x.init(),this.columns.push(x),l+=m}else{console.log("rods");for(var y,z=c+this.extraBeads,v=0;v<b;v++){k=v%2==0?q:p,r=this.rodsColours[v],s=new window.Fraction(this.rodsColumns[v]),console.log(s),y=this.rodsColumns[v][1];var x=new PosNegColumn(l,n,o,y,z,r,k,this,s,!1,!0);x.init(),this.columns.push(x),console.log(x),l+=m}}},this.restore=function(a){for(var b=0;b<a.length;b++)this.columns[b].restore(a[b]);for(var b=0;b<a.length;b++)this.columns[b].restoreAge(a[b])},this.save=function(){for(var a=[],b=0;b<this.columns.length;b++)a.push(this.columns[b].save());return a},this.saveTri=function(){return console.log(this.trix),this.trix/this.abacusWidth},this.restoreTri=function(a){console.log(a),this.tri.x=this.startx+a*this.abacusWidth,this.trix=this.tri.x-this.startx,console.log(this.tri.x)},this.initTextItems=function(){for(var c=(a.canvas.width-this.abacusWidth)/2+this.leftRightBarScale*this.blockWidth+this.horizontalMargin*this.blockWidth/2+this.blockWidth/2,d=this.horizontalMargin*this.blockWidth+this.blockWidth,e=0;e<b;e++){var f=new createjs.Text("",(a.canvas.width/70).toString()+"px Arial","#FFF");f.set({textAlign:"center"}),f.x=c,f.y=a.canvas.height/10+this.abacusHeight-this.leftRightBarScale*this.blockWidth/2,a.addChild(f),this.rodtext.push(f),c+=d}var f=new createjs.Text("",this.blockWidth.toString()+"px Arial","#000");f.set({textAlign:"center"}),f.x=a.canvas.width/2,f.y=a.canvas.height/40,a.addChild(f),this.answertext=f},this.updatePosNegTextItems=function(){if(this.columns.length==b){for(var a=[],c=new window.Fraction(0,1),d=0;d<b;d++){this.columns[d].updateAges();var e=this.columns[d].howManyInUse(),f=e[0],g=e[1],h=f.length-g.length;this.rodtext[d].text=0!=h?h.toString():"";var i=this.columns[d].value.mul(f.length),j=this.columns[d].value.mul(g.length),k=i.sub(j),l=new window.Fraction(0);k.equals(l)||(a.push(k.toFraction(!0)),c=c.add(k))}var l=new window.Fraction(0);if(1==a.length){var m=c.toFraction(!0);this.answertext.text=m}else if(c.equals(l))this.answertext.text="";else{for(var m="",d=0;d<a.length-1;d++)m+=a[d]+" + ";m+=a[a.length-1]+" = "+c.toFraction(!0),this.answertext.text=m}this.answertext.text.length>=40?this.answertext.font=parseInt(this.blockWidth/this.answertext.text.length*40)+"px Arial":this.answertext.font=this.blockWidth.toString()+"px Arial"}},this.updateTextItems=function(){if(1==i||1==j)this.updatePosNegTextItems();else if(this.columns.length==b){for(var a=[],c=new window.Fraction(0,1),d=0;d<b;d++){this.columns[d].updateAges();var e=this.columns[d].howManyInUse(),f=e.length;this.rodtext[d].text=0!=f?f.toString():"";var g=this.columns[d].value.mul(e.length),h=new window.Fraction(0);g.equals(h)||(a.push(g.toFraction(!0)),c=c.add(g))}var h=new window.Fraction(0);if(1==a.length){var k=c.toFraction(!0);this.answertext.text=k}else if(c.equals(h))this.answertext.text="";else{for(var k="",d=0;d<a.length-1;d++)k+=a[d]+" + ";k+=a[a.length-1]+" = "+c.toFraction(!0),this.answertext.text=k}this.answertext.text.length>=40?this.answertext.font=parseInt(this.blockWidth/this.answertext.text.length*40)+"px Arial":this.answertext.font=this.blockWidth.toString()+"px Arial"}},this.init=function(){this.initValues(),this.initRectangle(),this.initColumns(),this.initTextItems(),this.initTriangle()}}