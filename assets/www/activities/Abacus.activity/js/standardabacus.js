function StandardAbacus(t,i,h,s,e,a,o,l){void 0===l&&(l=i),this.blockScaleYFromX=25/33,this.topBottomBarScale=1.6,this.leftRightBarScale=1.6*this.blockScaleYFromX,this.middleBarScale=1,this.horizontalMargin=1/3,this.verticalMargin=.05,this.extraBeads=2,this.rods=i,this.blockHeight=0,this.blockWidth=0,this.abacusHeight=0,this.abacusWidth=0,this.upperBlockHeight=0,this.lowerBlockHeight=0,this.stage=t,this.topcolumns=[],this.bottomcolumns=[],this.rodtext=[],this.answertext=null,this.trix=null,this.startx=null,this.blockGivenWidth=function(t){return t/(2*this.leftRightBarScale+i+this.horizontalMargin*i)},this.blockGivenHeight=function(t){return t/(2*this.topBottomBarScale+(h+this.extraBeads)+this.verticalMargin*(h+this.extraBeads)+this.middleBarScale+(e+this.extraBeads)+this.verticalMargin*(e+this.extraBeads))},this.heightGivenBlockWidth=function(t){return this.blockScaleYFromX*t*(2*this.topBottomBarScale+(h+this.extraBeads)+this.verticalMargin*(h+this.extraBeads)+this.middleBarScale+(e+this.extraBeads)+this.verticalMargin*(e+this.extraBeads))},this.widthGivenBlockWidth=function(t){return t*(2*this.leftRightBarScale+i+this.horizontalMargin*i)},this.initValues=function(){var i=.85*t.canvas.height,s=.9*t.canvas.width,a=this.blockGivenWidth(s),o=this.blockScaleYFromX*a;this.heightGivenBlockWidth(a)>i&&(a=(o=this.blockGivenHeight(i))/this.blockScaleYFromX,console.log("Using height")),this.blockHeight=o,this.blockWidth=a,this.abacusHeight=this.heightGivenBlockWidth(this.blockWidth),this.abacusWidth=this.widthGivenBlockWidth(this.blockWidth),this.upperBlockHeight=this.blockHeight*(h+this.extraBeads+this.verticalMargin*(h+this.extraBeads)),this.lowerBlockHeight=this.blockHeight*(e+this.extraBeads+this.verticalMargin*(e+this.extraBeads)),console.log(this.blockHeight),console.log(this.blockWidth),console.log(this.abacusHeight),console.log(this.abacusWidth),this.startx=(t.canvas.width-this.abacusWidth)/2+this.leftRightBarScale*this.blockWidth+this.horizontalMargin*this.blockWidth/2+this.blockWidth/2},this.initRectangle=function(){var i=new createjs.Shape;i.graphics.beginStroke("#000000"),i.graphics.setStrokeStyle(this.leftRightBarScale*this.blockWidth),i.graphics.beginFill("#C0C0C0").drawRoundRect(this.leftRightBarScale*this.blockWidth/2,this.leftRightBarScale*this.blockWidth/2,this.abacusWidth-this.leftRightBarScale*this.blockWidth,this.abacusHeight-this.leftRightBarScale*this.blockWidth,2/3*this.blockWidth),i.x=(t.canvas.width-this.abacusWidth)/2,i.y=t.canvas.height/10,t.addChild(i)},this.initDivider=function(){var i=new createjs.Shape;i.graphics.beginFill("#000000").drawRect(0,0,this.abacusWidth-this.leftRightBarScale*this.blockWidth*2,this.middleBarScale*this.blockHeight),i.x=(t.canvas.width-this.abacusWidth)/2+this.leftRightBarScale*this.blockWidth,i.y=t.canvas.height/10+this.leftRightBarScale*this.blockWidth+this.upperBlockHeight,t.addChild(i),console.log(i)},this.initTriangle=function(){this.tri=new createjs.Shape;var h=this.blockWidth/4*3,s=t.canvas.height/10+this.leftRightBarScale*this.blockWidth*2/3,e=(t.canvas.width-this.abacusWidth)/2+this.leftRightBarScale*this.blockWidth+this.horizontalMargin*this.blockWidth/2+this.blockWidth/2,a=this.horizontalMargin*this.blockWidth+this.blockWidth,o=e+a*(i-1);this.tri.graphics.moveTo(0-h/2,0).beginFill("#FC0D1B").lineTo(0+h/2,0).lineTo(0,0+this.leftRightBarScale*this.blockWidth/3).lineTo(0-h/2,0).closePath(),this.tri.x=o-this.blockWidth/2,this.tri.y=s,t.addChild(this.tri),this.trix=this.tri.x-this.startx;var l=this.tri,n=this;this.tri.on("mousedown",(function(t){this.offset={x:l.x-t.stageX,y:l.y-t.stageY}})),this.tri.on("pressmove",(function(t){t.stageX+this.offset.x<e-n.blockWidth/2?l.x=e-n.blockWidth/2:t.stageX+this.offset.x>o+n.blockWidth/2?l.x=o+n.blockWidth/2:l.x=t.stageX+this.offset.x,n.trix=l.x-n.startx}))},this.initColumns=function(){var n,c=(t.canvas.width-this.abacusWidth)/2+this.leftRightBarScale*this.blockWidth+this.horizontalMargin*this.blockWidth/2+this.blockWidth/2,r=this.horizontalMargin*this.blockWidth+this.blockWidth,d=t.canvas.height/10+this.leftRightBarScale*this.blockWidth,g=d+this.upperBlockHeight,b=["#A0A0A0","#6B6B6B"],u=["#000000","#000000"];console.log(o);for(var k,x,w=o.fill,W=o.stroke,f=0;f<i;f++){if(f%2==0?(n=u,k=w):(n=b,k=W),l-f-1<0){var v=new window.Fraction(1);x=new window.Fraction(Math.pow(a,Math.abs(l-f-1))),x=v.div(x).mul(s)}else x=new window.Fraction(Math.pow(a,l-f-1)).mul(s);(B=new StandardAbacusColumn(c,d,g,h,0,h+this.extraBeads,k,n,this,x,!0)).init(),this.topcolumns.push(B),c+=r}g=(d=g+this.middleBarScale*this.blockHeight)+this.lowerBlockHeight,c=(t.canvas.width-this.abacusWidth)/2+this.leftRightBarScale*this.blockWidth+this.horizontalMargin*this.blockWidth/2+this.blockWidth/2;for(f=0;f<i;f++){if(f%2==0?(n=u,k=w):(n=b,k=W),l-f-1<0){v=new window.Fraction(1);x=new window.Fraction(Math.pow(a,Math.abs(l-f-1))),x=v.div(x)}else x=new window.Fraction(Math.pow(a,l-f-1));var B;(B=new StandardAbacusColumn(c,d,g,0,e,e+this.extraBeads,k,n,this,x,!1)).init(),this.bottomcolumns.push(B),c+=r}},this.initTextItems=function(){for(var h=(t.canvas.width-this.abacusWidth)/2+this.leftRightBarScale*this.blockWidth+this.horizontalMargin*this.blockWidth/2+this.blockWidth/2,s=this.horizontalMargin*this.blockWidth+this.blockWidth,e=0;e<i;e++){(a=new createjs.Text("",(t.canvas.width/70).toString()+"px Arial","#FFF")).set({textAlign:"center"}),a.x=h,a.y=t.canvas.height/10+this.abacusHeight-this.leftRightBarScale*this.blockWidth/2,t.addChild(a),this.rodtext.push(a),h+=s}var a;(a=new createjs.Text("",this.blockWidth.toString()+"px Arial","#000")).set({textAlign:"center"}),a.x=t.canvas.width/2,a.y=t.canvas.height/40,t.addChild(a),this.answertext=a},this.updateTextItems=function(){if(this.bottomcolumns.length==i){for(var t=[],h=new window.Fraction(0,1),e=0;e<i;e++){this.topcolumns[e].updateAges(),this.bottomcolumns[e].updateAges();var a=this.topcolumns[e].howManyInUse(),o=this.bottomcolumns[e].howManyInUse(),l=s*a.length;l+=o.length,this.rodtext[e].text=0!=l?l.toString():"";var n=new window.Fraction(0,1),c=this.topcolumns[e].value;c=c.mul(a.length),n=n.add(c),c=(c=this.bottomcolumns[e].value).mul(o.length),n=n.add(c);var r=new window.Fraction(0);n.equals(r)||(t.push(n.toFraction(!0)),h=h.add(n))}r=new window.Fraction(0);if(1==t.length){var d=h.toFraction(!0);this.answertext.text=d}else if(h.equals(r))this.answertext.text="";else{for(d="",e=0;e<t.length-1;e++)d+=t[e]+" + ";d+=t[t.length-1]+" = "+h.toFraction(!0),this.answertext.text=d}this.answertext.text.length>=40?this.answertext.font=parseInt(this.blockWidth/this.answertext.text.length*40)+"px Arial":this.answertext.font=this.blockWidth.toString()+"px Arial"}},this.restore=function(t){t[0],t[1];for(var i=0;i<t[0].length;i++)this.topcolumns[i].restore(t[0][i]);for(i=0;i<t[1].length;i++)this.bottomcolumns[i].restore(t[1][i]);for(i=0;i<t[0].length;i++)this.topcolumns[i].restoreAge(t[0][i]);for(i=0;i<t[1].length;i++)this.bottomcolumns[i].restoreAge(t[1][i])},this.save=function(){for(var t=[[],[]],i=0;i<this.topcolumns.length;i++)t[0].push(this.topcolumns[i].save());for(i=0;i<this.bottomcolumns.length;i++)t[1].push(this.bottomcolumns[i].save());return t},this.saveTri=function(){return console.log(this.trix),this.trix/this.abacusWidth},this.restoreTri=function(t){console.log(t),this.tri.x=this.startx+t*this.abacusWidth,this.trix=this.tri.x-this.startx,console.log(this.tri.x)},this.init=function(){this.initValues(),this.initRectangle(),this.initDivider(),this.initColumns(),this.initTextItems(),this.initTriangle()}}