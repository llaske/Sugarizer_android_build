/*! Sugarizer 2020-03-14 */
define(["sugar-web/activity/activity","sugar-web/env","activity/game","activity/resources","activity/paladict","data/en/dict.js","webL10n","tutorial"],function(a,b,c,d,e,f,g,h){requirejs(["domReady!"],function(i){function j(){A.key="LEFT",A.frameNo=4,A.PlayerStop=!1}function k(){A.key="UP",A.frameNo=9,A.PlayerStop=!1}function l(){A.key="RIGHT",A.frameNo=1,A.PlayerStop=!1}function m(){A.key="DOWN",A.frameNo=7,A.PlayerStop=!1}function n(a){A.menuAudio.play(),0==a?(A.homeScreen=!1,A.creditScreen=!1,A.playScreen=!0,display="playScreen",A.main()):1==a?(A.homeScreen=!1,A.creditScreen=!0,A.drawCreditScreen()):2==a?(A.homeScreen=!1,A.creditScreen=!1,A.settingScreen=!0,display="settingScreen",A.drawSettingScreen()):3==a&&E.click()}function o(a,b){switch(a.keyCode){case 13:A.homeScreen&&n(A.menuSelected);break;case 37:j();break;case 38:A.homeScreen?(0==A.menuSelected?A.menuSelected=3:A.menuSelected--,A.menuAudio.play(),A.drawHomeScreen()):k();break;case 39:l();break;case 40:A.homeScreen?(3==A.menuSelected?A.menuSelected=0:A.menuSelected++,A.menuAudio.play(),A.drawHomeScreen()):m()}}function p(a){D&&(a=a.changedTouches[0]);const b=x.getBoundingClientRect();B.x=a.clientX-b.left,B.y=a.clientY-b.top}function q(a){D&&(a=a.changedTouches[0]);const b=x.getBoundingClientRect();C.x=a.clientX-b.left,C.y=a.clientY-b.top;var c;if(A.homeScreen)for(var d=0;d<A.menuTexts.length;d++){var e=A.collides({x:A.menuTexts[d].x,y:A.menuTexts[d].y,width:y.measureText(A.menuTexts[d].text).width,height:A.homeScreenFontSize+10},{x:B.x,y:B.y,width:10,height:10});if(e){c=d,n(c);break}}if(A.playScreen){var f=Math.abs(C.y-B.y),g=Math.abs(C.x-B.x),h=Math.atan2(f,g);C.y<=B.y?C.x>=B.x?(h<15*Math.PI/180&&l(),h>75*Math.PI/180&&k()):(h<15*Math.PI/180&&j(),h>75*Math.PI/180&&k()):C.x>=B.x?(h<15*Math.PI/180&&l(),h>75*Math.PI/180&&m()):(h<15*Math.PI/180&&j(),h>75*Math.PI/180&&m())}}function r(a){if(A.wordInSetting=a.target.value,A.menuAudio.play(),""==A.wordInSetting&&(A.wordInSetting=null),A.customDictWordEdit){document.getElementById("dictionary").children[0].children[0].children[0].innerHTML=a.target.value}else A.drawSettingScreen()}function s(a){a=a||window.event,a.target=a.target||a.srcElement;for(var b=a.target,c=document.getElementById("addWord"),d=document.getElementById("deleteAllWords"),e=document.getElementById("saveDict"),f=document.getElementById("resetDict");b;){if("BUTTON"===b.nodeName&&/deleteWord/.test(b.className)){A.menuAudio.play();var g=A.customDict.filter(function(a,c,d){return a!=b.id});A.customDict=g,A.drawSettingScreen();break}if("BUTTON"===b.nodeName&&/editWord/.test(b.className)){A.menuAudio.play(),w.value=b.id,A.wordInSetting=w.value,A.wordToBeEdited=w.value,A.customDictWordEdit=!0,c.style.opacity=.5,d.style.opacity=.5,e.style.opacity=.5,f.style.opacity=.5,A.drawSettingScreen();break}if("BUTTON"===b.nodeName&&/saveEditWord/.test(b.className)){A.menuAudio.play(),null!=A.wordInSetting&&(A.customDict[A.customDict.indexOf(A.wordToBeEdited)]=A.wordInSetting,A.customDictWordEdit=!1,w.value="",A.wordInSetting=null,c.style.opacity=1,d.style.opacity=1,e.style.opacity=1,f.style.opacity=1,A.drawSettingScreen());break}if("BUTTON"===b.nodeName&&/resetEditWord/.test(b.className)){A.menuAudio.play(),A.customDict[A.customDict.indexOf(A.wordToBeEdited)]=A.wordToBeEdited,A.customDictWordEdit=!1,A.wordInSetting="",w.value=null,c.style.opacity=1,d.style.opacity=1,e.style.opacity=1,f.style.opacity=1,A.drawSettingScreen();break}b=b.parentNode}}a.setup();var t;display="homeScreen";var u=new d;u.load(["./images/barra.jpg","./images/creditos.jpg","./images/fondo.jpg","./images/ganaste.png","./images/grossini.png","./images/lago0.png","./images/lago1.png","./images/lago2.png","./images/lago3.png","./images/menu.jpg","./images/setting.jpg","./images/perdio.png","./images/splash.jpg","./images/spritesheet.png","./images/zeek0.png","./images/zeek1.png","./images/zeek2.png","./images/zeek3.png","./images/zeek4.png","./images/zeek5.png","./images/zeek6.png","./images/zeek7.png","./images/zeek8.png","./images/zeek9.png","./images/zeek10.png","./images/zeek11.png"]);var v=document.getElementById("main-toolbar"),w=document.getElementById("word");v.style.opacity=1;var x=document.getElementById("canvas"),y=x.getContext("2d");x.width=window.innerWidth,x.height=window.innerHeight-v.offsetHeight-3;var z=new e(f),A=new c(x,u,z,g);b.getEnvironment(function(b,c){t=c;var d="undefined"!=typeof chrome&&chrome.app&&chrome.app.runtime?chrome.i18n.getUILanguage():navigator.language,e=c.user?c.user.language:d;g.language.code=e,window.addEventListener("localized",function(){document.getElementById("WordHeading").innerHTML=g.get("Word"),document.getElementById("DictHeading").innerHTML=g.get("Dictionary"),u.onReady(function(){c.objectId?a.getDatastoreObject().loadAsText(function(a,b,c){null==a&&null!=c&&(A.customDict=c.customDict,A.useCustomDict=c.useCustomDict,A.useCustomDict&&z.changeDict(c.customDict),c.playScreen?(A.playScreen=!0,display="playScreen",A.homeScreen=!1,A.obstacles=c.obstacles,A.playerX=c.playerX,A.playerY=c.playerY,A.lives=c.lives,A.targetWordLetters=c.targetWordLetters,A.targetWord=c.targetWord,A.prevCanvasWidth=c.prevCanvasWidth,A.prevCanvasHeight=c.prevCanvasHeight,A.resizeGame(x.width,x.height),A.useCustomDict||A.initializeCustomDict(),A.run()):(A.homeScreen=!0,display="homeScreen",A.playScreen=!1,A.main()))}):(display="homeScreen",A.main())})})});var B={x:void 0,y:void 0},C={x:void 0,y:void 0};document.addEventListener("keyup",o,!1),document.getElementById("word").addEventListener("input",r);var D="ontouchstart"in document.documentElement;D?(x.addEventListener("touchstart",p,!1),x.addEventListener("touchend",q,!1)):(x.addEventListener("mousedown",p,!1),x.addEventListener("mouseup",q,!1)),document.getElementById("addWord").addEventListener("click",function(){var a=document.getElementById("dictionary"),b=0;if(!A.customDictWordEdit&&(A.menuAudio.play(),null!=A.wordInSetting)){for(var c=0;c<a.children.length;c++)if(a.children[c].children[0].children[0].innerHTML.toUpperCase()==A.wordInSetting.toUpperCase()){b=1;break}0==b&&(A.customDict.unshift(A.wordInSetting),w.value="",A.wordInSetting=null,A.drawSettingScreen())}}),document.getElementById("deleteAllWords").addEventListener("click",function(){if(!A.customDictWordEdit){A.menuAudio.play();var a=g.get("Play");A.customDict=[a],w.value="",A.wordInSetting=null,A.drawSettingScreen()}}),document.getElementById("saveDict").addEventListener("click",function(){A.customDictWordEdit||(A.menuAudio.play(),z.changeDict(A.customDict),A.useCustomDict=!0,A.drawSettingScreen())}),document.getElementById("resetDict").addEventListener("click",function(){A.customDictWordEdit||(A.menuAudio.play(),A.initializeCustomDict(),w.value="",A.wordInSetting=null,A.drawSettingScreen())}),document.addEventListener?document.addEventListener("click",s,!0):document.attachEvent&&document.attachEvent("onclick",s,!0),window.addEventListener("resize",function(){var a=window.innerWidth,b=1==v.style.opacity?v.offsetHeight+3:0,c=window.innerHeight-b;A.resizeGame(a,c)}),document.getElementById("restart-button").addEventListener("click",function(){A.homeScreen=!0,display="homeScreen",A.playScreen=!1,A.reset(!0),A.gameAudio.pause(),A.settingScreen&&(A.settingScreen=!1,w.value="",A.wordInSetting=null,A.customDict=[].concat(z.dict),A.customDictWordEdit=!1,document.getElementById("settingScreen").style.visibility="hidden",document.getElementById("addWord").style.opacity=1,document.getElementById("deleteAllWords").style.opacity=1,document.getElementById("saveDict").style.opacity=1,document.getElementById("resetDict").style.opacity=1,A.main())},!1);var E=document.getElementById("stop-button");E.addEventListener("click",function(b){var c={homeScreen:A.homeScreen,playScreen:A.playScreen,playerX:A.playerX,playerY:A.playerY,obstacles:A.obstacles,lives:A.lives,targetWordLetters:A.targetWordLetters,targetWord:A.targetWord,frameNo:A.frameNo,prevCanvasWidth:A.prevCanvasWidth,prevCanvasHeight:A.prevCanvasHeight,customDict:A.customDict,useCustomDict:A.useCustomDict,customDictLang:A.customDictLang};a.getDatastoreObject().setDataAsText(c),a.getDatastoreObject().save(function(a){null===a?console.log("write done."):console.log("write failed.")})}),document.getElementById("fullscreen-button").addEventListener("click",function(){document.getElementById("main-toolbar").style.opacity=0,document.getElementById("canvas").style.top="0px",document.getElementById("unfullscreen-button").style.visibility="visible";var a=window.innerWidth,b=window.innerHeight;A.resizeGame(a,b)}),document.getElementById("unfullscreen-button").addEventListener("click",function(){document.getElementById("main-toolbar").style.opacity=1,document.getElementById("canvas").style.top="55px",document.getElementById("unfullscreen-button").style.visibility="hidden";var a=window.innerWidth,b=window.innerHeight-v.offsetHeight-3;A.resizeGame(a,b)}),document.getElementById("help-button").addEventListener("click",function(a){h.start()})})});