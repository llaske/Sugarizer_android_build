define((function(){"use strict";var e={};function changeColors(e,o,r){var n;return o&&(n=/(<!ENTITY fill_color ")(.*)(">)/,e=e.replace(n,"$1"+o+"$3")),r&&(n=/(<!ENTITY stroke_color ")(.*)(">)/,e=e.replace(n,"$1"+r+"$3")),e}function getBackgroundURL(e){var o=(e.currentStyle||window.getComputedStyle(e,"")).backgroundImage.slice(4,-1),r=o.length-1;return'"'==o[0]&&'"'==o[r]&&(o=o.slice(1,r)),o}return e.load=function(e,o){var r;"uri"in e?r=e.uri:"name"in e&&(r="lib/graphics/icons/"+e.name+".svg");var n=e.fillColor,a=e.strokeColor;if("data"!=r.substring(0,4)){var t=new XMLHttpRequest;t.onload=function(){var e=changeColors(this.responseText,n,a);o("data:image/svg+xml,"+escape(e))},t.open("GET",r),t.send()}else{var l=changeColors(unescape(r.slice("data:image/svg+xml,".length)),n,a);o("data:image/svg+xml,"+escape(l))}},e.colorize=function(o,r,n){var a={uri:getBackgroundURL(o),strokeColor:r.stroke,fillColor:r.fill};e.load(a,(function(e){!function setBackgroundURL(e,o){e.style.backgroundImage="url('"+o+"')"}(o,e),n&&n()}))},e}));