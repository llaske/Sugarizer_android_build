/*! Sugarizer 2020-03-14 */
define(["sugar-web/graphics/palette","sugar-web/env","webL10n"],function(a,b,c){"use strict";function d(a){var b=k;return b=b.replace("#010101",a.stroke),b=b.replace("#FFFFFF",a.fill),"data:image/svg+xml;base64,"+btoa(b)}function e(a){null!=n&&n(a);var b=document.getElementById("presence-users"),c="<hr><ul style='list-style: none; padding:0;'>";for(var e in a)c+="<li><img style='height:30px;vertical-align:middle;' src='"+d(a[e].colorvalue)+"'>"+a[e].name+"</li>";c+="</ul>",b.innerHTML=c}function f(a,b){for(var c=[],d=0;d<a.users.length;d++)for(var e=0;e<b.length;e++)b[e].networkId===a.users[d]&&c.push(b[e]);return c}function g(a){null!==l&&(l.parentElement.removeChild(l),null!==m&&clearTimeout(m));var b=document.createElement("div");l=b,b.style.background="#000",b.style.color="#fff",b.style.bottom="5px",b.style.padding="15px",b.style.right="5px",b.style.position="absolute",b.innerHTML=a,document.body.appendChild(b),m=setTimeout(function(){m=null,b.parentElement.removeChild(b),l=null},3e3)}var h={},i=[];b.getEnvironment(function(a,b){var d="undefined"!=typeof chrome&&chrome.app&&chrome.app.runtime?chrome.i18n.getUILanguage():navigator.language,e=b.user?b.user.language:d;c.language.code=e}),h.PresencePalette=function(b,c,d){function e(a){m.popDown()}a.Palette.call(this,b,c),this.users=i,this.presence=d,this.sharedEvent=document.createEvent("CustomEvent"),this.sharedEvent.initCustomEvent("shared",!0,!0,{});var f=document.createElement("div"),g=document.createElement("span");g.innerHTML="Private",g.className="network-text";var h=document.createElement("hr"),j=document.createElement("button");j.className="toolbutton",j.setAttribute("id","private-button"),j.onclick=function(){m.setShared(!1)};var k=document.createElement("button");k.className="toolbutton",k.setAttribute("id","shared-button"),k.onclick=function(){m.setShared(!0)},this.setShared=function(a){a?(g.innerHTML="My neighborhood",j.disabled=!0,k.disabled=!0,b.style.backgroundImage="url(lib/sugar-web/graphics/icons/actions/zoom-neighborhood.svg)",m.getPalette().childNodes[0].style.backgroundImage="url(lib/sugar-web/graphics/icons/actions/zoom-neighborhood.svg)",m.getPalette().dispatchEvent(m.sharedEvent)):(g.innerHTML="Private",j.disabled=!1,k.disabled=!1)},f.appendChild(g),f.appendChild(h),f.appendChild(j),f.appendChild(k);var l=document.createElement("div");l.setAttribute("id","presence-users"),f.appendChild(l),this.setContent([f]),this.buttons=f.querySelectorAll("button");for(var m=this,n=0;n<this.buttons.length;n++)"shared-button"==this.buttons[n].id&&this.buttons[n].addEventListener("shared",e)};var j=function(a,b,c){return this.getPalette().addEventListener(a,b,c)};h.PresencePalette.prototype=Object.create(a.Palette.prototype,{addEventListener:{value:j,enumerable:!0,configurable:!0,writable:!0}}),h.PresencePalette.prototype.setShared=function(a){this.setShared(a)};var k='<?xml version="1.0" ?><!DOCTYPE svg  PUBLIC \'-//W3C//DTD SVG 1.1//EN\'  \'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\' [<!ENTITY stroke_color "#010101"><!ENTITY fill_color "#FFFFFF">]><svg enable-background="new 0 0 55 55" height="55px" version="1.1" viewBox="0 0 55 55" width="55px" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px"><g display="block" id="stock-xo_1_"><path d="M33.233,35.1l10.102,10.1c0.752,0.75,1.217,1.783,1.217,2.932   c0,2.287-1.855,4.143-4.146,4.143c-1.145,0-2.178-0.463-2.932-1.211L27.372,40.961l-10.1,10.1c-0.75,0.75-1.787,1.211-2.934,1.211   c-2.284,0-4.143-1.854-4.143-4.141c0-1.146,0.465-2.184,1.212-2.934l10.104-10.102L11.409,24.995   c-0.747-0.748-1.212-1.785-1.212-2.93c0-2.289,1.854-4.146,4.146-4.146c1.143,0,2.18,0.465,2.93,1.214l10.099,10.102l10.102-10.103   c0.754-0.749,1.787-1.214,2.934-1.214c2.289,0,4.146,1.856,4.146,4.145c0,1.146-0.467,2.18-1.217,2.932L33.233,35.1z" fill="&fill_color;" stroke="&stroke_color;" stroke-width="3.5"/><circle cx="27.371" cy="10.849" fill="&fill_color;" r="8.122" stroke="&stroke_color;" stroke-width="3.5"/></g></svg>',l=null,m=null;h.PresencePalette.prototype.onSharedActivityUserChanged=function(a){var b=a.user.name.replace("<","&lt;").replace(">","&gt;"),h="<img style='height:30px;vertical-align:middle;' src='"+d(a.user.colorvalue)+"'>";1===a.move&&g(h+c.get("PlayerJoin",{user:b})),-1===a.move&&g(h+c.get("PlayerLeave",{user:b}));var i=this;i.presence.listUsers(function(a){i.presence.listSharedActivities(function(b){for(var c=0;c<b.length;c++)if(b[c].id===i.presence.sharedInfo.id){var d=b[c];e(f(d,a));break}})})};var n=null;return h.PresencePalette.prototype.onUsersListChanged=function(a){n=a},h});