/*! Sugarizer 2019-01-12 */
function Game(a,b,c,d,e){this.margin=0,this.gridwidth=10,this.gridheight=6,this.circleswidth=0,this.circlesheight=0,this.radius=0,console.log(b),this.verticalline=null,this.horizontalline=null,this.mode=null,this.dotsarr=[],this.buddy=["#FFFFFF","#000000",b.fill,b.stroke],this.rainbow=["#FFFFFF","#000000","#FF0000","#FF8000","#FFFF00","#00FF00","#00FFFF","#0000FF","#FF00FF"],this.colours=this.buddy,this.robot=!1,this.gameOver=!1,this.radiusFromX=function(){return this.margin=.02*a.canvas.width,(a.canvas.width-this.margin*(this.gridwidth+1))/this.gridwidth/2},this.radiusFromY=function(){return this.margin=.02*a.canvas.height,(a.canvas.height-this.margin*(this.gridheight+1))/this.gridheight/2},this.canDoFromX=function(){var b=this.radiusFromX();return this.margin=.02*a.canvas.width,2*b*this.gridheight+this.margin*(this.gridheight+1)<=a.canvas.height&&b},this.removeLines=function(){null!=this.verticalline&&(a.removeChild(this.verticalline),this.verticalline=null),null!=this.horizontalline&&(a.removeChild(this.horizontalline),this.horizontalline=null)},this.addVerticalLine=function(){this.verticalline=new createjs.Shape,this.verticalline.graphics.beginFill("#000000").drawRect(0,0,this.margin/3,this.circlesheight-this.margin),this.verticalline.x=a.canvas.width/2-this.margin/6,this.verticalline.y=this.margin/2,a.addChild(this.verticalline)},this.addHorizontalLine=function(){this.horizontalline=new createjs.Shape,this.horizontalline.graphics.beginFill("#000000").drawRect(0,0,this.circleswidth-this.margin,this.margin/3),this.horizontalline.x=(a.canvas.width-this.circleswidth)/2+this.margin/2,this.horizontalline.y=this.circlesheight/2-this.margin/6,a.addChild(this.horizontalline)},this.initHorizontalGame=function(a){void 0===a&&(a=!1),this.gameOver=!1,this.removeLines(),this.addVerticalLine(),this.mode=0,0==a?this.initDots():this.initDotsFromSave(a)},this.initVerticalGame=function(a){void 0===a&&(a=!1),this.gameOver=!1,this.removeLines(),this.addHorizontalLine(),this.mode=1,0==a?this.initDots():this.initDotsFromSave(a)},this.initBilateralGame=function(a){void 0===a&&(a=!1),this.gameOver=!1,this.removeLines(),this.addHorizontalLine(),this.addVerticalLine(),this.mode=2,0==a?this.initDots():this.initDotsFromSave(a)},this.setBuddyStyle=function(){c.getElementById("buddy-button").style.backgroundColor="#808080",c.getElementById("rainbow-button").removeAttribute("style")},this.initBuddy=function(){switch(this.setBuddyStyle(),this.colours=this.buddy,this.mode){case 0:this.initHorizontalGame();break;case 1:this.initVerticalGame();break;case 2:this.initBilateralGame()}},this.setRainbowStyle=function(){c.getElementById("buddy-button").removeAttribute("style"),c.getElementById("rainbow-button").style.backgroundColor="#808080"},this.initRainbow=function(){switch(this.setRainbowStyle(),this.colours=this.rainbow,this.mode){case 0:this.initHorizontalGame();break;case 1:this.initVerticalGame();break;case 2:this.initBilateralGame()}},this.initDots=function(){this.dotsarr=[];for(var b=[],c=2*this.radius+this.margin,d=(a.canvas.width-this.circleswidth)/2+this.margin,e=this.margin,f=0;f<this.gridwidth;f++){b=[],e=this.margin;for(var g=0;g<this.gridheight;g++){var h=new SymmetryDot(a,!0,d+this.radius,e+this.radius,this.radius,this.colours,Math.floor(Math.random()*this.colours.length),this,f,g);h.init(),b.push(h),e+=c}this.dotsarr.push(b),d+=c}},this.initDotsFromSave=function(b){this.dotsarr=[];for(var c=[],d=2*this.radius+this.margin,e=(a.canvas.width-this.circleswidth)/2+this.margin,f=this.margin,g=0;g<this.gridwidth;g++){c=[],f=this.margin;for(var h=0;h<this.gridheight;h++){var i=new SymmetryDot(a,!0,e+this.radius,f+this.radius,this.radius,this.colours,b[g][h],this,g,h);i.init(),c.push(i),f+=d}this.dotsarr.push(c),e+=d}},this.checkHorizontalGame=function(){for(var a=!0,b=0;b<this.gridwidth/2;b++)for(var c=0;c<this.gridheight;c++)this.dotsarr[b][c].colour!=this.dotsarr[this.gridwidth-1-b][c].colour&&(a=!1);if(1==a)for(var b=0;b<this.gridwidth;b++)for(var c=0;c<this.gridheight;c++)this.gameOver=!0,this.dotsarr[b][c].clickable=!1,this.dotsarr[b][c].showSmile()},this.checkVerticalGame=function(){for(var a=!0,b=0;b<this.gridwidth;b++)for(var c=0;c<this.gridheight/2;c++)this.dotsarr[b][c].colour!=this.dotsarr[b][this.gridheight-1-c].colour&&(a=!1);if(1==a)for(var b=0;b<this.gridwidth;b++)for(var c=0;c<this.gridheight;c++)this.gameOver=!0,this.dotsarr[b][c].clickable=!1,this.dotsarr[b][c].showSmile()},this.checkBilateralGame=function(){for(var a=!0,b=0;b<this.gridwidth/2;b++)for(var c=0;c<this.gridheight/2;c++)this.dotsarr[b][c].colour==this.dotsarr[this.gridwidth-1-b][c].colour&&this.dotsarr[b][c].colour==this.dotsarr[b][this.gridheight-1-c].colour&&this.dotsarr[b][c].colour==this.dotsarr[this.gridwidth-1-b][this.gridheight-1-c].colour||(a=!1);if(1==a)for(var b=0;b<this.gridwidth;b++)for(var c=0;c<this.gridheight;c++)this.gameOver=!0,this.dotsarr[b][c].clickable=!1,this.dotsarr[b][c].showSmile()},this.checkColours=function(){switch(this.mode){case 0:this.checkHorizontalGame();break;case 1:this.checkVerticalGame();break;case 2:this.checkBilateralGame()}},this.robotOff=function(){var a=c.getElementById("robot-button");a.title="Turn on the Robot",a.style.backgroundImage="url('./icons/robot-off.svg')",this.robot=!1},this.robotOn=function(){var a=c.getElementById("robot-button");a.title="Turn off the Robot",a.style.backgroundImage="url('./icons/robot-on.svg')",this.robot=!0},this.toggleRobot=function(){this.robot?this.robotOff():this.robotOn()},this.robotColours=function(a,b,c){switch(this.mode){case 0:this.horizontalColour(a,b,c);break;case 1:this.verticalColour(a,b,c);break;case 2:this.bilateralColour(a,b,c)}},this.horizontalColour=function(a,b,c){this.dotsarr[this.gridwidth-1-a][b].setColour(c)},this.verticalColour=function(a,b,c){this.dotsarr[a][this.gridheight-1-b].setColour(c)},this.bilateralColour=function(a,b,c){this.dotsarr[this.gridwidth-1-a][b].setColour(c),this.dotsarr[a][this.gridheight-1-b].setColour(c),this.dotsarr[this.gridwidth-1-a][this.gridheight-1-b].setColour(c)},this.stop=function(a){void 0===a&&(a=!1);var b={};b.mode=this.mode;for(var c=[],d=[],f=0;f<this.gridwidth;f++){d=[];for(var g=0;g<this.gridheight;g++)d.push(this.dotsarr[f][g].colour);c.push(d)}b.dots=c,b.robot=this.robot,b.gameOver=this.gameOver,this.colours.length==this.buddy.length?b.buddy=!0:b.buddy=!1,console.log(b);var h=JSON.stringify(b);e.getDatastoreObject().setDataAsText(h),1==a?e.getDatastoreObject().save(function(){location.reload()}):e.getDatastoreObject().save(function(){e.close()})},this.resize=function(){this.circleswidth=0,this.circlesheight=0,this.radius=0,this.margin=0;var a=this.gameOver,b=this.canDoFromX();0==b&&(b=this.radiusFromY()),this.radius=b,this.circleswidth=2*this.radius*this.gridwidth+this.margin*(this.gridwidth+1),this.circlesheight=2*this.radius*this.gridheight+this.margin*(this.gridheight+1);for(var c=[],d=[],e=0;e<this.gridwidth;e++){d=[];for(var f=0;f<this.gridheight;f++)d.push(this.dotsarr[e][f].colour);c.push(d)}switch(this.mode){case 0:this.initHorizontalGame(c);break;case 1:this.initVerticalGame(c);break;case 2:this.initBilateralGame(c)}if(1==a){this.gameOver=!0;for(var e=0;e<this.gridwidth;e++)for(var f=0;f<this.gridheight;f++)this.dotsarr[e][f].clickable=!1,this.dotsarr[e][f].showSmile()}},this.init=function(){console.log("init"),console.log(e.getDatastoreObject()),e.getDatastoreObject().getMetadata(this.init_canaccessdatastore.bind(this))},this.init_canaccessdatastore=function(a,b){console.log("datastore check");var c=(new Date).getTime();Math.abs(c-b.creation_time)<2e3?(console.log("Time too short"),this.initActivity(!1,[])):e.getDatastoreObject().loadAsText(this.init_getdatastore.bind(this))},this.init_getdatastore=function(a,b,c){null==a&&null!=c?(c=JSON.parse(c),this.initActivity(!0,c)):this.initActivity(!1,[])},this.initActivity=function(a,b){console.log(a),console.log(b);var c=this.canDoFromX();if(0==c&&(console.log("position based on y"),c=this.radiusFromY()),this.radius=c,console.log(c),this.circleswidth=2*this.radius*this.gridwidth+this.margin*(this.gridwidth+1),this.circlesheight=2*this.radius*this.gridheight+this.margin*(this.gridheight+1),console.log(b),0==a||null==b)this.initHorizontalGame();else{switch(1==b.buddy?this.colours=this.buddy:this.colours=this.rainbow,b.mode){case 0:this.initHorizontalGame(b.dots);break;case 1:this.initVerticalGame(b.dots);break;case 2:this.initBilateralGame(b.dots)}if(1==b.gameOver){this.gameOver=!0;for(var d=0;d<this.gridwidth;d++)for(var e=0;e<this.gridheight;e++)this.dotsarr[d][e].clickable=!1,this.dotsarr[d][e].showSmile()}1==b.robot?this.robotOn():this.robotOff()}this.colours==this.buddy?this.setBuddyStyle():this.setRainbowStyle()}}