/*! Sugarizer 2019-09-21 */
"use strict";window.module=function(a){if(""===a)return window;var b=a.split("."),c=b.pop(),d=module(b.join(".")),e=d[c];return e||(d[c]=e={loaded:!1,pending:[],requires:function(a){return{toRun:function(b){function c(){b(),e.loaded=!0,e.pending.forEach(function(a){a()})}a&&!module(a).loaded?module(a).pending.push(c):c()}}}}),e},Object.extend=function(a){for(var b=1;b<arguments.length;b++)if("object"==typeof arguments[b])for(var c in arguments[b])a[c]=arguments[b][c]},Function.prototype.subclass=function(a){var b=function(){return this.initialize&&this.initialize.apply(this,arguments),this},c=function(){};c.prototype=this.prototype,b.prototype=new c;for(var d=1;d<arguments.length;d++)Object.extend(b.prototype,arguments[d]);var e=a.split("."),f=e.pop();return module(e.join("."))[f]=b,b},function(){var a=document.getElementsByTagName("script"),b=a[a.length-1],c=b.src.replace(/[^\/]*$/,"");b.src.match(/squeak\.min\.js$/)||["vm.js","jit.js","plugins/ADPCMCodecPlugin.js","plugins/B2DPlugin.js","plugins/BitBltPlugin.js","plugins/FFTPlugin.js","plugins/FloatArrayPlugin.js","plugins/GeniePlugin.js","plugins/JPEGReaderPlugin.js","plugins/KedamaPlugin.js","plugins/KedamaPlugin2.js","plugins/Klatt.js","plugins/LargeIntegers.js","plugins/Matrix2x3Plugin.js","plugins/MiscPrimitivePlugin.js","plugins/ScratchPlugin.js","plugins/SoundGenerationPlugin.js","plugins/StarSqueakPlugin.js","plugins/ZipPlugin.js","lib/lz-string.js"].forEach(function(a){var b=document.createElement("script");b.setAttribute("type","text/javascript"),b.setAttribute("src",c+a),document.getElementsByTagName("head")[0].appendChild(b)})}(),module("SqueakJS").requires("users.bert.SqueakJS.vm").toRun(function(){function a(a,b,c){function d(b){a.fullscreen=b,e.style.background=b?"black":"",c.header&&(c.header.style.display=b?"none":""),c.footer&&(c.footer.style.display=b?"none":""),c.fullscreenCheckbox&&(c.fullscreenCheckbox.checked=b),setTimeout(window.onresize,0)}var e=b.parentElement,f="fullscreenchange",g="fullscreenElement",h="fullscreenEnabled";e.requestFullscreen||[{req:e.webkitRequestFullscreen,exit:document.webkitExitFullscreen,evt:"webkitfullscreenchange",elem:"webkitFullscreenElement",enable:"webkitFullscreenEnabled"},{req:e.mozRequestFullScreen,exit:document.mozCancelFullScreen,evt:"mozfullscreenchange",elem:"mozFullScreenElement",enable:"mozFullScreenEnabled"},{req:e.msRequestFullscreen,exit:document.msExitFullscreen,evt:"MSFullscreenChange",elem:"msFullscreenElement",enable:"msFullscreenEnabled"}].forEach(function(a){a.req&&(e.requestFullscreen=a.req,document.exitFullscreen=a.exit,f=a.evt,g=a.elem,h=a.enable)});var i;if(e.requestFullscreen)document.addEventListener(f,function(){d(e==document[g])}),i=function(){document[h]&&e==document[g]!=a.fullscreen&&(a.fullscreen?e.requestFullscreen():document.exitFullscreen())};else{var j=!1;i=function(){(c.header||c.footer)&&j!=a.fullscreen&&(j=a.fullscreen,d(j))}}return c.fullscreenCheckbox&&(c.fullscreenCheckbox.onclick=function(){a.fullscreen=c.fullscreenCheckbox.checked,i()}),i}function b(a){if(a.swapCheckbox){var b=o.squeakImageName||"default",c=JSON.parse(o["squeakSettings:"+b]||"{}");"swapButtons"in c&&(a.swapButtons=c.swapButtons),a.swapCheckbox.checked=a.swapButtons,a.swapCheckbox.onclick=function(){a.swapButtons=a.swapCheckbox.checked,c.swapButtons=a.swapButtons,o["squeakSettings:"+b]=JSON.stringify(c)}}}function c(a,b){var c=a.shiftKey,d=a.ctrlKey&&!a.altKey,e=a.metaKey||a.altKey&&!a.ctrlKey,f=(c?Squeak.Keyboard_Shift:0)+(d?Squeak.Keyboard_Ctrl:0)+(e?Squeak.Keyboard_Cmd:0);return b.buttons=b.buttons&~Squeak.Keyboard_All|f,f}function d(a,b,c){var d=q?a.offsetX:a.layerX,e=q?a.offsetY:a.layerY;c.cursorCanvas.style.left=d+b.offsetLeft+c.cursorOffsetX+"px",c.cursorCanvas.style.top=e+b.offsetTop+c.cursorOffsetY+"px";var f=d*b.width/b.offsetWidth|0,g=e*b.height/b.offsetHeight|0;c.mouseX=Math.max(0,Math.min(c.width,f)),c.mouseY=Math.max(0,Math.min(c.height,g))}function e(a,b,e,f,g,h){if(d(b,e,f),f.vm){var i=f.buttons&Squeak.Mouse_All;switch(a){case"mousedown":switch(b.button||0){case 0:i=Squeak.Mouse_Red;break;case 1:i=Squeak.Mouse_Yellow;break;case 2:i=Squeak.Mouse_Blue}h.swapButtons&&(i==Squeak.Mouse_Yellow?i=Squeak.Mouse_Blue:i==Squeak.Mouse_Blue&&(i=Squeak.Mouse_Yellow));break;case"mousemove":break;case"mouseup":i=0}f.buttons=i|c(b,f),g&&(g.push([Squeak.EventTypeMouse,b.timeStamp,f.mouseX,f.mouseY,f.buttons&Squeak.Mouse_All,f.buttons>>3]),f.signalInputEvent&&f.signalInputEvent()),f.idle=0,"mouseup"==a?f.runFor&&f.runFor(100):f.runNow&&f.runNow()}}function f(a,b,c,d){if(c.vm){var e=c.buttons>>3<<8|a;e===c.vm.interruptKeycode?c.vm.interruptPending=!0:d?(d.push([Squeak.EventTypeKeyboard,b,a,Squeak.EventKeyChar,c.buttons>>3,a]),c.signalInputEvent&&c.signalInputEvent()):c.keys.push(e),c.idle=0,c.runNow&&c.runNow()}}function g(a,b,c,e,f){e.vm&&f&&(d(b,c,e),f.push([Squeak.EventTypeDragDropFiles,b.timeStamp,a,e.mouseX,e.mouseY,e.buttons>>3,e.droppedFiles.length]),e.signalInputEvent&&e.signalInputEvent())}function h(a,b,c,d){c.buttons&=~Squeak.Keyboard_All,c.buttons|=Squeak.Keyboard_Cmd|Squeak.Keyboard_Ctrl,c.keys=[],f(a,b,c,d)}function i(a,b,c){b[0]=a[0],b[1]=a[1]-c&Squeak.MillisecondClockMask;for(var d=2;d<a.length;d++)b[d]=a[d]}function j(d,j){function k(a){if(a.touches.length){v.x=v.y=0;for(var b=0;b<a.touches.length;b++)v.x+=a.touches[b].pageX/a.touches.length,v.y+=a.touches[b].pageY/a.touches.length}return{timeStamp:a.timeStamp,button:v.button,offsetX:v.x-d.offsetLeft,offsetY:v.y-d.offsetTop}}function l(a,b,c,d){var e=a-c,f=b-d;return Math.sqrt(e*e+f*f)}function m(a,b){return l(a.pageX,a.pageY,b.pageX,b.pageY)}function n(a,b,c,e){var f=s.cursorCanvas,g=c/d.width;d.style.left=(0|a)+"px",d.style.top=(0|b)+"px",d.style.width=(0|c)+"px",d.style.height=(0|e)+"px",f.style.left=(a+s.cursorOffsetX+s.mouseX*g|0)+"px",f.style.top=(b+s.cursorOffsetY+s.mouseY*g|0)+"px",f.style.width=(f.width*g|0)+"px",f.style.height=(f.height*g|0)+"px",j.pixelated||(g>=3?(d.classList.add("pixelated"),s.cursorCanvas.classList.add("pixelated")):(d.classList.remove("pixelated"),s.cursorCanvas.classList.remove("pixelated")))}function o(a){v.dist=m(a.touches[0],a.touches[1]),v.down.x=v.x,v.down.y=v.y,v.down.dist=v.dist,v.down.left=d.offsetLeft,v.down.top=d.offsetTop,v.down.width=d.offsetWidth,v.down.height=d.offsetHeight,v.orig||(v.orig={left:v.down.left,top:v.down.top,right:v.down.left+v.down.width,bottom:v.down.top+v.down.height,width:v.down.width,height:v.down.height})}function p(a){if(!(a.touches.length<2)){v.dist=m(a.touches[0],a.touches[1]);var b=v.orig.width/v.down.width,c=v.dist/v.down.dist,d=Math.min(Math.max(c,.95*b),b*w),e=v.down.width*d,f=v.orig.height*e/v.orig.width,g=v.down.left-(v.down.x-v.down.left)*(d-1)+(v.x-v.down.x),h=v.down.top-(v.down.y-v.down.top)*(d-1)+(v.y-v.down.y);g=Math.max(Math.min(g,v.orig.left+20),v.orig.right-e-20),h=Math.max(Math.min(h,v.orig.top+20),v.orig.bottom-f-20),n(g,h,e,f)}}function q(){var a=d.offsetLeft,b=d.offsetTop,c=d.offsetWidth,e=d.offsetHeight;c=Math.min(Math.max(c,v.orig.width),v.orig.width*w),e=v.orig.height*c/v.orig.width,a=Math.max(Math.min(a,v.orig.left),v.orig.right-c),b=Math.max(Math.min(b,v.orig.top),v.orig.bottom-e),n(a,b,c,e)}function r(a){for(var b=0;b<a.dataTransfer.types.length;b++)if("Files"==a.dataTransfer.types[b])return!0;return!1}j=j||{},j.fullscreen&&(document.body.style.margin=0,document.body.style.backgroundColor="black",document.ontouchmove=function(a){a.preventDefault()},j.header&&(j.header.style.display="none"),j.footer&&(j.footer.style.display="none"));var s={context:d.getContext("2d"),fullscreen:!1,width:0,height:0,mouseX:0,mouseY:0,buttons:0,keys:[],clipboardString:"",clipboardStringChanged:!1,cursorCanvas:document.createElement("canvas"),cursorOffsetX:0,cursorOffsetY:0,droppedFiles:[],signalInputEvent:null};b(j),j.pixelated&&(d.classList.add("pixelated"),s.cursorCanvas.classList.add("pixelated"));var t=null;s.reset=function(){t=null,s.signalInputEvent=null,s.lastTick=0,s.getNextEvent=function(a,b){t=[],t.push=function(a){t.offset=Date.now()-a[1],delete t.push,t.push(a)},s.getNextEvent=function(a,b){var c=t.shift();c?i(c,a,b-t.offset):a[0]=Squeak.EventTypeNone},s.getNextEvent(a,b)}},s.reset();var u=a(s,d,j);s.fullscreenRequest=function(a,b){s.fullscreen!=a?(s.fullscreen=a,s.resizeTodo=b,s.resizeTodoTimeout=setTimeout(s.resizeDone,1e3),u()):b()},s.resizeDone=function(){clearTimeout(s.resizeTodoTimeout);var a=s.resizeTodo;a&&(s.resizeTodo=null,a())},s.clear=function(){d.width=d.width},s.showBanner=function(a,b){b=b||{};var c=s.context;c.clearRect(0,0,d.width,d.height),c.fillStyle=b.color||"#F90",c.font=b.font||"bold 48px sans-serif",c.textAlign="center",c.textBaseline="middle",c.fillText(a,d.width/2,d.height/2)},s.showProgress=function(a,b){b=b||{};var c=s.context,e=d.width/3|0,f=24,g=.5*d.width-e/2,h=.5*d.height+2*f;c.fillStyle=b.background||"#000",c.fillRect(g,h,e,f),c.lineWidth=2,c.strokeStyle=b.color||"#F90",c.strokeRect(g,h,e,f),c.fillStyle=b.color||"#F90",c.fillRect(g,h,e*a,f)},s.executeClipboardPaste=function(a,b){if(!s.vm)return!0;try{s.clipboardString=a,h("v".charCodeAt(0),b,s,t)}catch(a){console.error("paste error "+a)}},s.executeClipboardCopy=function(a,b){if(!s.vm)return!0;s.clipboardStringChanged=!1,h((a||"c").charCodeAt(0),b,s,t);for(var c=Date.now();!s.clipboardStringChanged&&Date.now()-c<500;)s.vm.interpret(20);if(s.clipboardStringChanged)try{return s.clipboardString}catch(a){console.error("copy error "+a)}},d.onmousedown=function(a){return u(),e("mousedown",a,d,s,t,j),a.preventDefault(),!1},d.onmouseup=function(a){e("mouseup",a,d,s,t,j),u(),a.preventDefault()},d.onmousemove=function(a){e("mousemove",a,d,s,t,j),a.preventDefault()},d.oncontextmenu=function(){return!1};var v={state:"idle",button:0,x:0,y:0,dist:0,down:{}},w=5;return d.ontouchstart=function(a){a.preventDefault();for(var b=k(a),c=0;c<a.changedTouches.length;c++)switch(v.state){case"idle":v.state="got1stFinger",v.first=b,setTimeout(function(){"got1stFinger"===v.state&&(v.state="mousing",v.button=b.button=0,e("mousemove",b,d,s,t,j),e("mousedown",b,d,s,t,j))},100);break;case"got1stFinger":v.state="got2ndFinger",o(a),setTimeout(function(){if("got2ndFinger"===v.state){Math.abs(v.down.dist-v.dist)>10||l(v.down.x,v.down.y,v.x,v.y)>10?v.state="zooming":(v.state="mousing",v.button=b.button=2,e("mousemove",b,d,s,t,j),e("mousedown",b,d,s,t,j))}},200)}},d.ontouchmove=function(a){a.preventDefault();var b=k(a);switch(v.state){case"got1stFinger":v.state="mousing",v.button=b.button=0,e("mousemove",b,d,s,t,j),e("mousedown",b,d,s,t,j);break;case"mousing":return void e("mousemove",b,d,s,t,j);case"got2ndFinger":return void(a.touches.length>1&&(v.dist=m(a.touches[0],a.touches[1])));case"zooming":return void p(a)}},d.ontouchend=function(a){a.preventDefault(),u();for(var b=k(a),c=0;c<a.changedTouches.length;c++)switch(v.state){case"mousing":if(a.touches.length>0)break;return v.state="idle",void e("mouseup",b,d,s,t,j);case"got1stFinger":return v.state="idle",v.button=b.button=0,e("mousemove",b,d,s,t,j),e("mousedown",b,d,s,t,j),void e("mouseup",b,d,s,t,j);case"got2ndFinger":v.state="mousing",v.button=b.button=2,e("mousemove",b,d,s,t,j),e("mousedown",b,d,s,t,j);break;case"zooming":if(a.touches.length>0)break;return v.state="idle",void q(a)}},d.ontouchcancel=function(a){d.ontouchend(a)},s.cursorCanvas.style.display="block",s.cursorCanvas.style.position="absolute",s.cursorCanvas.style.cursor="none",s.cursorCanvas.style.background="transparent",s.cursorCanvas.style.pointerEvents="none",d.parentElement.appendChild(s.cursorCanvas),d.style.cursor="none",document.onkeypress=function(a){return!s.vm||(!!/[CXVR]/.test(String.fromCharCode(a.charCode+64))||(c(a,s),f(a.charCode,a.timeStamp,s,t),void a.preventDefault()))},document.onkeydown=function(a){if(u(),!s.vm)return!0;c(a,s);var b={8:8,9:9,13:13,27:27,33:11,34:12,35:4,36:1,37:28,38:30,39:29,40:31,45:5,46:127}[a.keyCode];if(b)return f(b,a.timeStamp,s,t),a.preventDefault();if(a.metaKey||a.altKey&&!a.ctrlKey){var d=a.key;if(!d&&a.keyIdentifier&&"U+"==a.keyIdentifier.slice(0,2)&&(d=String.fromCharCode(parseInt(a.keyIdentifier.slice(2),16))),d&&1==d.length){if(/[CXVR]/i.test(d))return!0;var e=d.charCodeAt(0);return/[A-Z]/.test(d)&&!a.shiftKey&&(e+=32),f(e,a.timeStamp,s,t),a.preventDefault()}}},document.onkeyup=function(a){return!s.vm||void c(a,s)},document.oncopy=function(a,b){var c=s.executeClipboardCopy(b,a.timeStamp);"string"==typeof c&&a.clipboardData.setData("Text",c),a.preventDefault()},document.oncut=function(a){return!s.vm||void document.oncopy(a,"x")},document.onpaste=function(a){var b=a.clipboardData.getData("Text");s.executeClipboardPaste(b,a.timeStamp),a.preventDefault()},document.ondragover=function(a){a.preventDefault(),r(a)?(a.dataTransfer.dropEffect="copy",g(Squeak.EventDragMove,a,d,s,t)):a.dataTransfer.dropEffect="none"},document.ondragenter=function(a){r(a)&&g(Squeak.EventDragEnter,a,d,s,t)},document.ondragleave=function(a){r(a)&&g(Squeak.EventDragLeave,a,d,s,t)},document.ondrop=function(a){if(a.preventDefault(),!r(a))return!1;var b,c=[].slice.call(a.dataTransfer.files),e=[],f=null;return s.droppedFiles=[],c.forEach(function(h){s.droppedFiles.push(h.name);var i=new FileReader;i.onload=function(){var i=this.result;Squeak.filePut(h.name,i),e.push(h.name),b||!/.*image$/.test(h.name)||s.vm&&!confirm("Run "+h.name+" now?\n(cancel to use as file)")||(b=i,f=h.name),e.length==c.length&&(b?(SqueakJS.appName=f.slice(0,-6),SqueakJS.runImage(b,f,s,j)):g(Squeak.EventDragDrop,a,d,s,t))},i.readAsArrayBuffer(h)}),!1},window.onresize=function(){if(!v.orig){var a=window.innerWidth,b=window.innerHeight;if(setTimeout(function(){a==window.innerWidth&&b==window.innerHeight&&s.resizeDone()},300),!(j.header&&j.footer||j.fullscreen))return s.width=d.width,void(s.height=d.height);var c=j.fullscreen||s.fullscreen,e=0,f=c?0:j.header.offsetTop+j.header.offsetHeight,g=window.innerWidth,h=c?window.innerHeight:Math.max(100,j.footer.offsetTop-f),i=0,k=0;if(j.fixedWidth){s.width=j.fixedWidth,s.height=j.fixedHeight;var l=s.width/s.height;g/h>l?i=g-Math.floor(h*l):k=h-Math.floor(g/l)}else s.width=g,s.height=h;if(d.style.left=e+Math.floor(i/2)+"px",d.style.top=f+Math.floor(k/2)+"px",d.style.width=g-i+"px",d.style.height=h-k+"px",d.width!=s.width||d.height!=s.height){var m=j.fixedWidth||!s.resizeTodo,n=m&&s.context.getImageData(0,0,d.width,d.height);d.width=s.width,d.height=s.height,n&&s.context.putImageData(n,0,0)}if(j.fixedWidth){var o=s.cursorCanvas,p=d.offsetWidth/d.width;o.style.width=o.width*p+"px",o.style.height=o.height*p+"px"}}},window.onresize(),s}function k(a,b){var c=b.spinner;return c?(c.onmousedown=function(){confirm(SqueakJS.appName+" is busy. Interrupt?")&&(a.interruptPending=!0)},c.style):null}function l(a,b,c,d){var e=0===b,f=c.lastTick-d.lastTick<500;!e||f?(a.display="none",s=0):0===s?s=c.lastTick:c.lastTick-s>1e3&&(a.display="block",r=(r+30)%360,a.webkitTransform=a.transform="rotate("+r+"deg)")}function m(a){var b=window.location.hash.slice(1),c=b&&b.split("&");if(c)for(var d=0;d<c.length;d++){var e=c[d].split("="),f=e[0],g=!0;if(e.length>1&&(g=decodeURIComponent(e.slice(1).join("=")),g.match(/^(true|false|null|[0-9"[{].*)$/)))try{g=JSON.parse(g)}catch(a){"["===g[0]&&(g=g.slice(1,-1).split(","))}a[f]=g}var h=Squeak.splitFilePath(a.root||"/").fullname;Squeak.dirCreate(h,!0),/\/$/.test(h)||(h+="/"),a.root=h,a.url&&a.files&&!a.image&&(a.image=a.url+"/"+a.files[0])}function n(a){if(a.templates){if(a.templates.constructor===Array){var b={};a.templates.forEach(function(a){b[a]=a}),a.templates=b}for(var c in a.templates)Squeak.fetchTemplateDir("/"==c[0]?c:a.root+c,a.templates[c])}}var o=window.localStorage;try{if(o["squeak-foo:"]="bar","bar"!==o["squeak-foo:"])throw Error();delete o["squeak-foo:"]}catch(a){o={}}var p,q=navigator.userAgent.match("AppleWebKit/"),r=0,s=0;SqueakJS.runImage=function(a,c,d,e){window.onbeforeunload=function(a){var b=SqueakJS.appName+" is still running";return a.returnValue=b,b},window.clearTimeout(p),d.reset(),d.clear(),d.showBanner("Loading "+SqueakJS.appName),d.showProgress(0);var f=this;window.setTimeout(function(){var g=new Squeak.Image(c);g.readFromBuffer(a,function(){function a(){try{d.quitFlag?f.onQuit(h,d,e):h.interpret(50,function(b){"sleep"==b&&(b=200),i&&l(i,b,h,d),p=window.setTimeout(a,b)})}catch(a){console.error(a),alert(a)}}d.quitFlag=!1;var h=new Squeak.Interpreter(g,d);SqueakJS.vm=h,o.squeakImageName=c,b(e),d.clear(),d.showBanner("Starting "+SqueakJS.appName);var i=k(h,e);d.runNow=function(){window.clearTimeout(p),a()},d.runFor=function(a){var b=Date.now()+a;do{d.runNow()}while(Date.now()<b)},a()},function(a){d.showProgress(a)})},0)},SqueakJS.runSqueak=function(a,b,c){function d(a){if(0===i.length)return a(g);var b=i.shift();if(!c.forceDownload&&!b.forceDownload&&Squeak.fileExists(c.root+b.name))return void(b.name==f?Squeak.fileGet(c.root+b.name,function(b){g=b,d(a)},function(){Squeak.fileDelete(c.root+b.name),i.unshift(b),d(a)}):d(a));e.showBanner("Downloading "+b.name);var h=new XMLHttpRequest;h.open("GET",b.url),h.responseType="arraybuffer",h.onprogress=function(a){a.lengthComputable&&e.showProgress(a.loaded/a.total)},h.onload=function(){200==this.status?(b.name==f&&(g=this.response),Squeak.filePut(c.root+b.name,this.response,function(){d(a)})):this.onerror(this.statusText)},h.onerror=function(){console.warn("Retrying with CORS proxy: "+b.url);var a=c.proxy||"https://crossorigin.me/",d=new XMLHttpRequest;d.open("GET",a+b.url),d.responseType=h.responseType,d.onprogress=h.onprogress,d.onload=h.onload,d.onerror=function(){alert("Failed to download:\n"+b.url)},d.send()},h.send()}if(m(c),c.image?a=c.image:c.image=a,a.match(/^http:/)&&location.protocol.match(/^https/))return void(location.protocol="http");SqueakJS.options=c,SqueakJS.appName=c.appName||a.replace(/.*\//,"").replace(/\.image$/,""),Squeak.fsck(),n(c);var e=j(b,c),f=Squeak.splitFilePath(a).basename,g=null,h=a.replace(/[^\/]*$/,""),i=[{url:a,name:f}];if(c.files&&c.files.forEach(function(a){a!==f&&i.push({url:h+a,name:a})}),c.document){var k=Squeak.splitFilePath(c.document).basename;i.push({url:c.document,name:k,forceDownload:!1!==c.forceDownload}),e.documentName=c.root+k}return d(function(a){SqueakJS.runImage(a,c.root+f,e,c)}),e},SqueakJS.quitSqueak=function(){SqueakJS.vm.quitFlag=!0},SqueakJS.onQuit=function(a,b,c){window.onbeforeunload=null,b.vm=null,c.spinner&&(c.spinner.style.display="none"),c.onQuit?c.onQuit(a,b,c):b.showBanner(SqueakJS.appName+" stopped.")}}),window.applicationCache&&applicationCache.addEventListener("updateready",function(){var a=window.SqueakJS&&SqueakJS.options&&SqueakJS.options.appName||"SqueakJS";confirm(a+" has been updated. Restart now?")&&(window.onbeforeunload=null,window.location.reload())}),module("users.bert.SqueakJS.vm").requires().toRun(function(){window.Squeak=users.bert.SqueakJS.vm;var a=window.localStorage;try{if(a["squeak-foo:"]="bar","bar"!==a["squeak-foo:"])throw Error();delete a["squeak-foo:"]}catch(b){console.warn("localStorage not available, faking"),a={}}Object.extend(Squeak,"version",{vmVersion:"SqueakJS 0.8.2",vmBuild:"unknown",vmPath:"/",vmFile:"vm.js",platformName:"Web",platformSubtype:"unknown",osVersion:navigator.userAgent,windowSystem:"HTML"},"object header",{HeaderTypeMask:3,HeaderTypeSizeAndClass:0,HeaderTypeClass:1,HeaderTypeFree:2,HeaderTypeShort:3},"special objects",{splOb_NilObject:0,splOb_FalseObject:1,splOb_TrueObject:2,splOb_SchedulerAssociation:3,splOb_ClassBitmap:4,splOb_ClassInteger:5,splOb_ClassString:6,splOb_ClassArray:7,splOb_SmalltalkDictionary:8,splOb_ClassFloat:9,splOb_ClassMethodContext:10,splOb_ClassBlockContext:11,splOb_ClassPoint:12,splOb_ClassLargePositiveInteger:13,splOb_TheDisplay:14,splOb_ClassMessage:15,splOb_ClassCompiledMethod:16,splOb_TheLowSpaceSemaphore:17,splOb_ClassSemaphore:18,splOb_ClassCharacter:19,splOb_SelectorDoesNotUnderstand:20,splOb_SelectorCannotReturn:21,splOb_TheInputSemaphore:22,splOb_SpecialSelectors:23,splOb_CharacterTable:24,splOb_SelectorMustBeBoolean:25,splOb_ClassByteArray:26,splOb_ClassProcess:27,splOb_CompactClasses:28,splOb_TheTimerSemaphore:29,splOb_TheInterruptSemaphore:30,splOb_FloatProto:31,splOb_SelectorCannotInterpret:34,splOb_MethodContextProto:35,splOb_ClassBlockClosure:36,splOb_BlockContextProto:37,splOb_ExternalObjectsArray:38,splOb_ClassPseudoContext:39,splOb_ClassTranslatedMethod:40,splOb_TheFinalizationSemaphore:41,splOb_ClassLargeNegativeInteger:42,splOb_ClassExternalAddress:43,splOb_ClassExternalStructure:44,splOb_ClassExternalData:45,splOb_ClassExternalFunction:46,splOb_ClassExternalLibrary:47,splOb_SelectorAboutToReturn:48,splOb_SelectorRunWithIn:49,splOb_SelectorAttemptToAssign:50,splOb_PrimErrTableIndex:51,splOb_ClassAlien:52,splOb_InvokeCallbackSelector:53,splOb_ClassUnsafeAlien:54,splOb_ClassWeakFinalizer:55},"known classes",{Class_superclass:0,Class_mdict:1,Class_format:2,Class_instVars:null,Class_name:6,Context_sender:0,Context_instructionPointer:1,Context_stackPointer:2,Context_method:3,Context_closure:4,Context_receiver:5,Context_tempFrameStart:6,Context_smallFrameSize:17,Context_largeFrameSize:57,BlockContext_caller:0,BlockContext_argumentCount:3,BlockContext_initialIP:4,BlockContext_home:5,Closure_outerContext:0,Closure_startpc:1,Closure_numArgs:2,Closure_firstCopiedValue:3,Stream_array:0,Stream_position:1,Stream_limit:2,ProcSched_processLists:0,ProcSched_activeProcess:1,Link_nextLink:0,LinkedList_firstLink:0,LinkedList_lastLink:1,Semaphore_excessSignals:2,Proc_suspendedContext:1,Proc_priority:2,Proc_myList:3,Assn_key:0,Assn_value:1,MethodDict_array:1,MethodDict_selectorStart:2,Message_selector:0,Message_arguments:1,Message_lookupClass:2,Point_x:0,Point_y:1,LargeInteger_bytes:0,LargeInteger_neg:1,BitBlt_dest:0,BitBlt_source:1,BitBlt_halftone:2,BitBlt_combinationRule:3,BitBlt_destX:4,BitBlt_destY:5,BitBlt_width:6,BitBlt_height:7,BitBlt_sourceX:8,BitBlt_sourceY:9,BitBlt_clipX:10,BitBlt_clipY:11,BitBlt_clipW:12,BitBlt_clipH:13,BitBlt_colorMap:14,BitBlt_warpBase:15,Form_bits:0,Form_width:1,Form_height:2,Form_depth:3,Form_offset:4,WeakFinalizationList_first:0,WeakFinalizerItem_list:0,WeakFinalizerItem_next:1},"events",{Mouse_Blue:1,Mouse_Yellow:2,Mouse_Red:4,Keyboard_Shift:8,Keyboard_Ctrl:16,Keyboard_Alt:32,Keyboard_Cmd:64,Mouse_All:7,Keyboard_All:120,EventTypeNone:0,EventTypeMouse:1,EventTypeKeyboard:2,EventTypeDragDropFiles:3,EventKeyChar:0,EventKeyDown:1,EventKeyUp:2,EventDragEnter:1,EventDragMove:2,EventDragLeave:3,EventDragDrop:4},"constants",{MinSmallInt:-1073741824,MaxSmallInt:1073741823,NonSmallInt:-1342177280,MillisecondClockMask:536870911},"modules",{externalModules:Squeak.externalModules||{},registerExternalModule:function(a,b){this.externalModules[a]=b}},"files",{fsck:function(b,c,d,e){if(c=c||"",e=e||{dirs:0,files:0,bytes:0,deleted:0},!d){d={};for(var f in a){var g=f.match(/squeak-file(\.lz)?:(.*)$/);g&&(d[g[2]]=!0)}if("undefined"!=typeof indexedDB)return this.dbTransaction("readonly","fsck cursor",function(a){var f=a.openCursor();f.onsuccess=function(a){var f=a.target.result;f?(d[f.key]=!0,f.continue()):Squeak.fsck(b,c,d,e)},f.onerror=function(){console.error("fsck failed")}})}var h=Squeak.dirList(c);for(var i in h){var j=c+"/"+i;if(h[i][3]){"squeak:"+j in a?(Squeak.fsck(null,j,d,e),e.dirs++):(console.log("Deleting stale directory "+j),Squeak.dirDelete(j),e.deleted++)}else d[j]?(d[j]=!1,e.files++,e.bytes+=h[i][4]):(console.log("Deleting stale file entry "+j),Squeak.fileDelete(j,!0),e.deleted++)}if(""===c){console.log("squeak fsck: "+e.dirs+" directories, "+e.files+" files, "+(e.bytes/1e6).toFixed(1)+" MBytes");var k=[],l=0;for(var j in d)l++,d[j]&&k.push(j);if(k.length>0){for(var m=0;m<k.length;m++)console.log("Deleting orphaned file "+k[m]),delete a["squeak-file:"+k[m]],delete a["squeak-file.lz:"+k[m]],e.deleted++;"undefined"!=typeof indexedDB&&this.dbTransaction("readwrite","fsck delete",function(a){for(var b=0;b<k.length;b++)a.delete(k[b])})}b&&b(e)}},dbTransaction:function(a,b,c,d){function e(){c(Squeak.dbFake()),d&&d()}function f(){var e=SqueakDB.transaction("files",a),f=e.objectStore("files");e.oncomplete=function(){d&&d()},e.onerror=function(a){console.error(a.target.error.name+": "+b)},e.onabort=function(a){console.error(a.target.error.name+": aborting "+b),c(Squeak.dbFake()),d&&d()},c(f)}if("undefined"==typeof indexedDB)return e();if(window.SqueakDB)return f();var g=indexedDB.open("squeak");return g?(g.onsuccess=function(){console.log("Opened files database."),window.SqueakDB=this.result,SqueakDB.onversionchange=function(){delete window.SqueakDB,this.close()},SqueakDB.onerror=function(a){console.error("Error accessing database: "+a.target.error.name)},f()},g.onupgradeneeded=function(a){console.log("Creating files database"),a.target.result.createObjectStore("files")},g.onerror=function(a){console.error(a.target.error.name+": cannot open files database"),console.warn("Falling back to local storage"),e()},void(g.onblocked=function(){console.log("Database upgrade needed, but was blocked."),console.warn("Falling back to local storage"),e()})):e()},dbFake:function(){return"undefined"==typeof SqueakDBFake&&("undefined"==typeof indexedDB&&console.warn("IndexedDB not supported by this browser, using localStorage"),window.SqueakDBFake={bigFiles:{},bigFileThreshold:1e5,get:function(b){var c=SqueakDBFake.bigFiles[b];if(!c){var d=a["squeak-file:"+b];if(!d){var e=a["squeak-file.lz:"+b];e&&("object"==typeof LZString?d=LZString.decompressFromUTF16(e):console.error("LZString not loaded: cannot decompress "+b))}if(d){for(var f=new Uint8Array(d.length),g=0;g<f.length;g++)f[g]=255&d.charCodeAt(g);c=f.buffer}}var h={result:c};return setTimeout(function(){h.onsuccess&&h.onsuccess({target:h})},0),h},put:function(b,c){if(b.byteLength>SqueakDBFake.bigFileThreshold)SqueakDBFake.bigFiles[c]||console.log("File "+c+" ("+b.byteLength+" bytes) too large, storing in memory only"),SqueakDBFake.bigFiles[c]=b;else{var d=Squeak.bytesAsString(new Uint8Array(b));if("object"==typeof LZString){var e=LZString.compressToUTF16(d);a["squeak-file.lz:"+c]=e,delete a["squeak-file:"+c]}else a["squeak-file:"+c]=d}var f={};return setTimeout(function(){f.onsuccess&&f.onsuccess()},0),f},delete:function(b){delete a["squeak-file:"+b],delete a["squeak-file.lz:"+b],delete SqueakDBFake.bigFiles[b];var c={};return setTimeout(function(){c.onsuccess&&c.onsuccess()},0),c},openCursor:function(){var a={};return setTimeout(function(){a.onsuccess&&a.onsuccess({target:a})},0),a}}),SqueakDBFake},fileGet:function(a,b,c){c||(c=function(a){console.log(a)});var d=this.splitFilePath(a);return d.basename?window.SqueakDBFake&&SqueakDBFake.bigFiles[d.fullname]?b(SqueakDBFake.bigFiles[d.fullname]):void this.dbTransaction("readonly","get "+a,function(a){var e=a.get(d.fullname);e.onerror=function(a){c(a.target.error.name)},e.onsuccess=function(){return void 0!==this.result?b(this.result):void Squeak.fetchTemplateFile(d.fullname,function(a){b(a)},function(){if("undefined"==typeof indexedDB)return c("file not found: "+d.fullname);var a=Squeak.dbFake().get(d.fullname);a.onerror=function(){c("file not found: "+d.fullname)},a.onsuccess=function(){b(this.result)}})}}):c("Invalid path: "+a)},filePut:function(b,c,d){var e=this.splitFilePath(b);if(!e.basename)return null;var f=this.dirList(e.dirname);if(!f)return null;var g=f[e.basename],h=this.totalSeconds();if(g){if(g[3])return null}else g=[e.basename,h,0,!1,0],f[e.basename]=g;return g[2]=h,g[4]=c.byteLength||c.length||0,a["squeak:"+e.dirname]=JSON.stringify(f),this.dbTransaction("readwrite","put "+b,function(a){a.put(c,e.fullname)},function(){d&&d()}),g},fileDelete:function(b,c){var d=this.splitFilePath(b);if(!d.basename)return!1;var e=this.dirList(d.dirname);if(!e)return!1;var f=e[d.basename];return!(!f||f[3])&&(delete e[d.basename],a["squeak:"+d.dirname]=JSON.stringify(e),!!c||(this.dbTransaction("readwrite","delete "+b,function(a){a.delete(d.fullname)}),!0))},fileRename:function(b,c){var d=this.splitFilePath(b);if(!d.basename)return!1;var e=this.splitFilePath(c);if(!e.basename)return!1;var f=this.dirList(d.dirname);if(!f)return!1;var g=f[d.basename];if(!g||g[3])return!1;var h=d.dirname==e.dirname,i=h?f:this.dirList(e.dirname);return!!i&&(!i[e.basename]&&(delete f[d.basename],g[0]=e.basename,i[e.basename]=g,a["squeak:"+e.dirname]=JSON.stringify(i),h||(a["squeak:"+d.dirname]=JSON.stringify(f)),this.fileGet(d.fullname,function(a){this.dbTransaction("readwrite","rename "+d.fullname+" to "+e.fullname,function(b){b.delete(d.fullname),b.put(a,e.fullname)})}.bind(this),function(a){console.log("File rename failed: "+a)}.bind(this)),!0))},fileExists:function(a){var b=this.splitFilePath(a);if(!b.basename)return!1;var c=this.dirList(b.dirname);if(!c)return!1;var d=c[b.basename];return!(!d||d[3])},dirCreate:function(b,c){var d=this.splitFilePath(b);if(!d.basename)return!1;c&&!a["squeak:"+d.dirname]&&Squeak.dirCreate(d.dirname,!0);var e=this.dirList(d.dirname);if(!e)return!1;if(e[d.basename])return!1;var f=this.totalSeconds(),g=[d.basename,f,f,!0,0];return e[d.basename]=g,a["squeak:"+d.fullname]=JSON.stringify({}),a["squeak:"+d.dirname]=JSON.stringify(e),!0},dirDelete:function(b){var c=this.splitFilePath(b);if(!c.basename)return!1;var d=this.dirList(c.dirname);if(!d)return!1;if(!d[c.basename])return!1;var e=this.dirList(c.fullname);if(!e)return!1;for(var f in e)return!1;return delete d[c.basename],a["squeak:"+c.dirname]=JSON.stringify(d),delete a["squeak:"+c.fullname],!0},dirList:function(b,c){function d(a,b){for(var c in b)if(b.hasOwnProperty(c)){var d=b[c];a[d[0]]=d}}var e=this.splitFilePath(b),f=a["squeak:"+e.fullname],g=c&&a["squeak-template:"+e.fullname];if(f||g){var h={};return g&&d(h,JSON.parse(g).entries),f&&d(h,JSON.parse(f)),h}return"/"==e.fullname?{}:null},splitFilePath:function(a){"/"!==a[0]&&(a="/"+a),a=a.replace(/\/\//gi,"/");var b=a.match(/(.*)\/(.*)/);return{fullname:a,dirname:b[1].length?b[1]:"/",basename:b[2].length?b[2]:null}},flushFile:function(a){if(a.modified){var b=a.contents.buffer;b.byteLength!==a.size&&(b=new ArrayBuffer(a.size),new Uint8Array(b).set(a.contents.subarray(0,a.size))),Squeak.filePut(a.name,b),a.modified=!1}},flushAllFiles:function(){if("undefined"!=typeof SqueakFiles)for(var a in SqueakFiles)this.flushFile(SqueakFiles[a])},closeAllFiles:function(){Squeak.flushAllFiles(),delete window.SqueakFiles},fetchTemplateDir:function(b,c){function d(b){var c=Squeak.splitFilePath(b);"/"!==c.dirname&&d(c.dirname);var b=JSON.parse(a["squeak-template:"+c.dirname]||'{"entries": {}}');if(!b.entries[c.basename]){var e=Squeak.totalSeconds();b.entries[c.basename]=[c.basename,e,e,!0,0],a["squeak-template:"+c.dirname]=JSON.stringify(b)}}function e(b,c){var d=JSON.parse(a["squeak-template:"+b]);for(var e in d.entries){var f=d.entries[e];f[3]&&Squeak.fetchTemplateDir(b+"/"+f[0],c+"/"+f[0])}}if(b=Squeak.splitFilePath(b).fullname,a["squeak-template:"+b])e(b,c);else{var f=c+"/sqindex.json",g=new XMLHttpRequest;g.open("GET",f,!0),g.onload=function(){if(200==g.status){console.log("adding template "+b),d(b);var f=JSON.parse(g.response),h={url:c,entries:{}};for(var i in f){var j=f[i];h.entries[j[0]]=j}a["squeak-template:"+b]=JSON.stringify(h),e(b,c)}else g.onerror(g.statusText)},g.onerror=function(){console.log("cannot load template index "+f)},g.send()}},fetchTemplateFile:function(b,c,d){b=Squeak.splitFilePath(b);var e=a["squeak-template:"+b.dirname];if(!e)return d();var f=JSON.parse(e).url;if(!f)return d();f+="/"+b.basename;var g=new XMLHttpRequest;g.open("get",f,!0),g.responseType="arraybuffer",g.timeout=3e4,g.onreadystatechange=function(){if(this.readyState==this.DONE)if(200==this.status){var a=this.response;console.log("Got "+a.byteLength+" bytes from "+f),Squeak.dirCreate(b.dirname,!0),Squeak.filePut(b.fullname,a),c(a)}else alert("Download failed ("+this.status+") "+f),d()},console.log("Fetching "+f),g.send()}},"audio",{startAudioOut:function(){if(!this.audioOutContext){var a=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext;this.audioOutContext=a&&new a}return this.audioOutContext},startAudioIn:function(a,b){return this.audioInContext?(this.audioInSource.disconnect(),a(this.audioInContext,this.audioInSource)):(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia?void navigator.getUserMedia({audio:!0,toString:function(){return"audio"}},function(b){var c=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext;this.audioInContext=c&&new c,this.audioInSource=this.audioInContext.createMediaStreamSource(b),a(this.audioInContext,this.audioInSource)},function(){b("cannot access microphone")}):b("test: audio input not supported"))},stopAudio:function(){this.audioInSource&&this.audioInSource.disconnect()}},"time",{Epoch:Date.UTC(1901,0,1)+6e4*(new Date).getTimezoneOffset(),EpochUTC:Date.UTC(1901,0,1),totalSeconds:function(){return Math.floor((Date.now()-Squeak.Epoch)/1e3)}},"utils",{bytesAsString:function(a){for(var b=[],c=0;c<a.length;c++)b.push(String.fromCharCode(a[c]));return b.join("")}}),Object.subclass("Squeak.Image","about",{about:function(){}},"initializing",{initialize:function(a){this.totalMemory=1e8,this.name=a,this.gcCount=0,this.gcTenured=0,this.gcMilliseconds=0,this.allocationCount=0,this.oldSpaceCount=0,this.newSpaceCount=0,this.hasNewInstances={}},readFromBuffer:function(a,b,c){function d(){if(I){for(var a=J+(K.oldSpaceCount/10|0);I&&a>J;)I.installFromImage(t,G,H,g,n),I=I.nextObject,J++;return c&&c(J/K.oldSpaceCount),!0}return K.specialObjectsArray=F,K.decorateKnownObjects(),K.fixCompiledMethods(),K.fixCompactOops(),!1}function e(){d()?window.setTimeout(e,0):b&&b()}console.log("squeak: reading "+this.name+" ("+a.byteLength+" bytes)"),this.startupTime=Date.now();for(var f=new DataView(a),g=!1,h=0,i=function(){var a=f.getUint32(h,g);return h+=4,a},j=function(b,c){if(5>c){for(var d=[];d.length<b;)d.push(i());return d}var e=new Uint32Array(a,h,b);return h+=4*b,e},k=[6501,6502,6504,6505,68e3,68002,68003],l=0,m=0;g=!g,h=m,l=i(),!(k.indexOf(l)>=0);)if(g||(m+=512),m>512)throw Error("bad image version");this.version=l;var n=[6505,68003].indexOf(l)>=0;if(this.hasClosures=[6504,6505,68002,68003].indexOf(l)>=0,l>=68e3)throw Error("64 bit images not supported yet");var o=i(),p=i(),q=i(),r=i();this.lastHash=i(),i(),i(),i(),h+=o-36;for(var s,t={},u=m+o;u+p>h;){var v=0,w=0,x=i();switch(x&Squeak.HeaderTypeMask){case Squeak.HeaderTypeSizeAndClass:v=x>>2,w=i(),x=i();break;case Squeak.HeaderTypeClass:w=x-Squeak.HeaderTypeClass,x=i(),v=x>>2&63;break;case Squeak.HeaderTypeShort:v=x>>2&63,w=x>>12&31;break;case Squeak.HeaderTypeFree:throw Error("Unexpected free block")}v--;var y=h-4-u,z=x>>8&15,A=x>>17&4095,B=j(v,z),C=new Squeak.Object;C.initFromImage(y,w,z,A,B),32>w&&(C.hash|=268435456),s&&(s.nextObject=C),this.oldSpaceCount++,s=C,t[q+y]=C}this.firstOldObject=t[q+4],this.lastOldObject=C,this.oldSpaceBytes=p;var D=t[t[r].bits[Squeak.splOb_CompactClasses]].bits,E=null;for(C=this.firstOldObject,s=null;C;)s=E,E=C.renameFromImage(t,D),s&&(s.nextObject=E),t[q+C.oop]=E,C=C.nextObject;this.firstOldObject=t[q+4],this.lastOldObject=E;var F=t[r],G=t[F.bits[Squeak.splOb_CompactClasses]].bits,H=t[F.bits[Squeak.splOb_ClassFloat]],I=this.firstOldObject,J=0,K=this;if(c)window.setTimeout(e,0);else{for(;d(););b&&b()}},decorateKnownObjects:function(){var a=this.specialObjectsArray.pointers;a[Squeak.splOb_NilObject].isNil=!0,a[Squeak.splOb_TrueObject].isTrue=!0,a[Squeak.splOb_FalseObject].isFalse=!0,a[Squeak.splOb_ClassFloat].isFloatClass=!0,this.compactClasses=this.specialObjectsArray.pointers[Squeak.splOb_CompactClasses].pointers;for(var b=0;b<this.compactClasses.length;b++)this.compactClasses[b].isNil||(this.compactClasses[b].isCompact=!0);Number.prototype.sqInstName||Object.defineProperty(Number.prototype,"sqInstName",{enumerable:!1,value:function(){return this.toString()}})},fixCompactOops:function(){for(var a=this.firstOldObject,b=0;a;){var c=a.hash>268435455;if(c!==!!a.sqClass.isCompact){var d=0===a.snapshotSize().header;c!==d&&(b+=d?-4:4)}a.hash&=268435455,a.oop+=b,a=a.nextObject}this.oldSpaceBytes+=b},fixCompiledMethods:function(){if(!(this.version>=6502))for(var a=this.firstOldObject,b=this.specialObjectsArray.pointers[Squeak.splOb_ClassCompiledMethod];a;)a.format>=12&&(a.sqClass=b),a=a.nextObject}},"garbage collection",{partialGC:function(){return this.totalMemory-this.oldSpaceBytes},fullGC:function(a){this.vm.addMessage("fullGC: "+a);var b=Date.now(),c=this.markReachableObjects();return this.removeUnmarkedOldObjects(),this.appendToOldObjects(c),this.finalizeWeakReferences(),this.allocationCount+=this.newSpaceCount,this.newSpaceCount=0,this.hasNewInstances={},this.gcCount++,this.gcMilliseconds+=Date.now()-b,c.length>0?c[0]:null},markReachableObjects:function(){this.vm.storeContextRegisters();for(var a=[this.specialObjectsArray,this.vm.activeContext],b=[];a.length>0;){var c=a.pop();if(!c.mark){c.nextObject||c===this.lastOldObject||b.push(c),c.mark=!0,c.sqClass.mark||a.push(c.sqClass);var d=c.pointers;if(d){var e=d.length;if(this.vm.isContext(c)){e=c.contextSizeWithStack();for(var f=e;f<d.length;f++)d[f]=this.vm.nilObj}else c.sqClass.isWeak()&&(e=c.sqClass.classInstSize());for(var f=0;e>f;f++)"object"!=typeof d[f]||d[f].mark||a.push(d[f])}}}return b.sort(function(a,b){return b.oop-a.oop})},removeUnmarkedOldObjects:function(){var a=0,b=0,c=this.firstOldObject;for(c.mark=!1;;){var d=c.nextObject;if(!d)return this.lastOldObject=c,this.oldSpaceBytes-=b,void(this.oldSpaceCount-=a);if(d.mark)c=d,c.mark=!1,c.oop-=b;else{var e=d;c.nextObject=e.nextObject,e.oop=-++this.newSpaceCount,b+=e.totalBytes(),a++}}},appendToOldObjects:function(a){for(var b=this.lastOldObject,c=0;c<a.length;c++){var d=a[c];d.mark=!1,this.oldSpaceBytes=d.setAddr(this.oldSpaceBytes),b.nextObject=d,b=d}this.lastOldObject=b,this.oldSpaceCount+=a.length,this.gcTenured+=a.length},finalizeWeakReferences:function(){for(var a=this.firstOldObject;a;){if(a.sqClass.isWeak()){for(var b=a.pointers||[],c=a.sqClass.classInstSize(),d=!1,e=c;e<b.length;e++)b[e].oop<0&&(b[e]=this.vm.nilObj,d=!0);if(d&&(this.vm.pendingFinalizationSignals++,c>=2)){var f=a.pointers[Squeak.WeakFinalizerItem_list];if(f.sqClass==this.vm.specialObjects[Squeak.splOb_ClassWeakFinalizer]){var g=f.pointers[Squeak.WeakFinalizationList_first];a.pointers[Squeak.WeakFinalizerItem_next]=g,f.pointers[Squeak.WeakFinalizationList_first]=a}}}a=a.nextObject}this.vm.pendingFinalizationSignals>0&&this.vm.forceInterruptCheck()}},"creating",{registerObject:function(a){return a.oop=-++this.newSpaceCount,this.lastHash=13849+27181*this.lastHash&4294967295,4095&this.lastHash},instantiateClass:function(a,b,c){var d=new(a.classInstProto()),e=this.registerObject(d);return d.initInstanceOf(a,b,e,c),this.hasNewInstances[a.oop]=!0,d},clone:function(a){var b=new(a.sqClass.classInstProto()),c=this.registerObject(b);return b.initAsClone(a,c),this.hasNewInstances[b.sqClass.oop]=!0,b}},"operations",{bulkBecome:function(a,b,c,d){if(!a)return!b;var e=a.length;if(e!==b.length)return!1;this.newSpaceCount>0?this.fullGC("become"):this.vm.storeContextRegisters();for(var f={},g=0;e>g;g++){var h=a[g];if(!h.sqClass)return!1;if(f[h.oop])return!1;f[h.oop]=b[g]}if(c)for(var g=0;e>g;g++){var h=b[g];if(!h.sqClass)return!1;if(f[h.oop])return!1;f[h.oop]=a[g]}if(d)for(var g=0;e>g;g++){if(!b[g].sqClass)return!1;var i=a[g].hash;a[g].hash=b[g].hash,b[g].hash=i}for(var h=this.firstOldObject;h;){var j=f[h.sqClass.oop];j&&(h.sqClass=j);var k=h.pointers;if(k)for(var l=0;l<k.length;l++)(j=f[k[l].oop])&&(k[l]=j);h=h.nextObject}return this.vm.flushMethodCacheAfterBecome(f),!0},objectAfter:function(a){return a.nextObject||this.newSpaceCount>0&&this.fullGC("nextObject")},someInstanceOf:function(a){for(var b=this.firstOldObject;;){if(b.sqClass===a)return b;if(!(b=b.nextObject||this.nextObjectWithGCFor(a)))return null}},nextInstanceAfter:function(a){for(var b=a.sqClass;;){if(!(a=a.nextObject||this.nextObjectWithGCFor(b)))return null;if(a.sqClass===b)return a}},nextObjectWithGCFor:function(a){return 0!==this.newSpaceCount&&this.hasNewInstances[a.oop]?this.fullGC("instance of "+a.className()):null},writeToBuffer:function(){var a=64,b=new DataView(new ArrayBuffer(a+this.oldSpaceBytes)),c=0,d=function(a){b.setUint32(c,a),c+=4};for(d(this.formatVersion()),d(a),d(this.oldSpaceBytes),d(this.firstOldObject.addr()),d(this.objectToOop(this.specialObjectsArray)),d(this.lastHash),d(52429400);a>c;)d(0);for(var e=this.firstOldObject,f=0;e;)c=e.writeTo(b,c,this),e=e.nextObject,f++;if(c!==b.byteLength)throw Error("wrong image size");if(f!==this.oldSpaceCount)throw Error("wrong object count");return b.buffer},objectToOop:function(a){if("number"==typeof a)return a<<1|1;if(a.oop<0)throw Error("temporary oop");return a.oop},bytesLeft:function(){return this.totalMemory-this.oldSpaceBytes},formatVersion:function(){return this.hasClosures?6504:6502},segmentVersion:function(){var a=this.specialObjectsArray.pointers[Squeak.splOb_SelectorDoesNotUnderstand],b=new Uint32Array(a.bytes.buffer,0,1);return this.formatVersion()|4278190080&b[0]},loadImageSegment:function(a,b){var c=new DataView(a.words.buffer),d=!1,e=!1,f=0,g=function(){var a=c.getUint32(f,d);return f+=4,a},h=function(a,b){if(5>b){for(var d=[];d.length<a;)d.push(g());return d}var e=new Uint32Array(c.buffer,f,a);return f+=4*a,e},i=g();if(!0&i&&(d=!0,f=0,!0&(i=g())))return console.error("image segment format not supported"),null;for(var j=[],k={};f<c.byteLength;){var l=0,m=0,n=g();switch(n&Squeak.HeaderTypeMask){case Squeak.HeaderTypeSizeAndClass:l=n>>2,m=g(),n=g();break;case Squeak.HeaderTypeClass:m=n-Squeak.HeaderTypeClass,n=g(),l=n>>2&63;break;case Squeak.HeaderTypeShort:l=n>>2&63,m=n>>12&31;break;case Squeak.HeaderTypeFree:throw Error("Unexpected free block")}l--;var o=f,p=n>>8&15,q=n>>17&4095,r=h(l,p),s=new Squeak.Object;s.initFromImage(o,m,p,q,r),j.push(s),k[o]=s}for(var t=0;t<b.pointers.length;t++)k[2147483652+4*t]=b.pointers[t];for(var u=this.specialObjectsArray.pointers[Squeak.splOb_CompactClasses].pointers,v=0,w=u.map(function(a){return k[--v]=a,v}),x=k[8]||k[12]||k[16],y=this.specialObjectsArray.pointers[Squeak.splOb_ClassFloat],t=0;t<j.length;t++){var z=j[t];z.installFromImage(k,w,y,d,e),z.oop=-++this.newSpaceCount,this.hasNewInstances[z.sqClass.oop]=!0}return x}}),Object.subclass("Squeak.Object","initialization",{initInstanceOf:function(a,b,c,d){this.sqClass=a,this.hash=c;var e=a.pointers[Squeak.Class_format],f=(e>>1&63)+(e>>10&192)-1;this.format=e>>7&15,this.format<8?6!=this.format?f+b>0&&(this.pointers=this.fillArray(f+b,d)):b>0&&(a.isFloatClass?(this.isFloat=!0,this.float=0):this.words=new Uint32Array(b)):b>0&&(this.bytes=new Uint8Array(b))},initAsClone:function(a,b){this.sqClass=a.sqClass,this.hash=b,this.format=a.format,a.isFloat?(this.isFloat=a.isFloat,this.float=a.float):(a.pointers&&(this.pointers=a.pointers.slice(0)),a.words&&(this.words=new Uint32Array(a.words)),a.bytes&&(this.bytes=new Uint8Array(a.bytes)))},initFromImage:function(a,b,c,d,e){this.oop=a,this.sqClass=b,this.format=c,this.hash=d,this.bits=e},classNameFromImage:function(a){var b=a[this.bits[Squeak.Class_name]];if(b&&b.format>=8&&b.format<12){var c=b.decodeBytes(b.bits.length,b.bits,0,3&b.format);return Squeak.bytesAsString(c)}return"Class"},renameFromImage:function(a,b){var c=this.sqClass<32?a[b[this.sqClass-1]]:a[this.sqClass],d=c.instProto||c.classInstProto(c.classNameFromImage(a));if(!d)return this;var e=new d;return e.oop=this.oop,e.sqClass=this.sqClass,e.format=this.format,e.hash=this.hash,e.bits=this.bits,e},installFromImage:function(a,b,c,d,e){var f=this.sqClass;this.sqClass=f>0&&32>f?a[b[f-1]]:a[f];var g=this.bits.length;if(this.format<5){if(g>0){var h=this.bits;this.pointers=this.decodePointers(g,h,a)}}else if(this.format>=12){var i=this.decodeWords(1,this.bits,d)[0],j=i>>10&255,h=this.decodeWords(j+1,this.bits,d);this.pointers=this.decodePointers(j+1,h,a),this.bytes=this.decodeBytes(g-(j+1),this.bits,j+1,3&this.format)}else if(this.format>=8)g>0&&(this.bytes=this.decodeBytes(g,this.bits,0,3&this.format));else if(this.sqClass==c){if(this.isFloat=!0,this.float=this.decodeFloat(this.bits,d,e),1.3797216632888e-310==this.float)if(/noFloatDecodeWorkaround/.test(window.location.hash));else if(this.constructor.prototype.decodeFloat=this.decodeFloatDeoptimized,this.float=this.decodeFloat(this.bits,d,e),1.3797216632888e-310==this.float)throw Error("Cannot deoptimize decodeFloat")}else g>0&&(this.words=this.decodeWords(g,this.bits,d));delete this.bits,this.mark=!1},decodePointers:function(a,b,c){for(var d=new Array(a),e=0;a>e;e++){var f=b[e];d[e]=1==(1&f)?f>>1:c[f]||42424242}return d},decodeWords:function(a,b,c){for(var d=new DataView(b.buffer,b.byteOffset),e=new Uint32Array(a),f=0;a>f;f++)e[f]=d.getUint32(4*f,c);return e},decodeBytes:function(a,b,c,d){var e=4*a-d,f=new Uint8Array(b.buffer,b.byteOffset+4*c,e),g=new Uint8Array(e);return g.set(f),g},decodeFloat:function(a,b,c){var d=new DataView(a.buffer,a.byteOffset);if(!b)return d.getFloat64(0,!1);if(c)return d.getFloat64(0,!0);var e=new ArrayBuffer(8),f=new DataView(e);return f.setUint32(0,d.getUint32(4)),f.setUint32(4,d.getUint32(0)),f.getFloat64(0,!0)},decodeFloatDeoptimized:function(a,b,c){var d=new DataView(a.buffer,a.byteOffset);if(!b)return d.getFloat64(0,!1);if(c)return d.getFloat64(0,!0);var e=new ArrayBuffer(8),f=new DataView(e);return function(){f.setUint32(0,d.getUint32(4)),f.setUint32(4,d.getUint32(0))}(),f.getFloat64(0,!0)},fillArray:function(a,b){for(var c=[],d=0;a>d;d++)c[d]=b;return c}},"printing",{toString:function(){return this.sqInstName()},bytesAsString:function(){return this.bytes?Squeak.bytesAsString(this.bytes):""},bytesAsNumberString:function(a){if(!this.bytes)return"";for(var b="0123456789ABCDEF",c=[],d=0,e=this.bytes.length-1;e>=0;e--)c.push(b[this.bytes[e]>>4]),c.push(b[15&this.bytes[e]]),d=256*d+this.bytes[e];var f=a?"-":"",g=d>=9007199254740992?"â‰ˆ":"";return f+"16r"+c.join("")+" ("+g+f+d+"L)"},assnKeyAsString:function(){return this.pointers[Squeak.Assn_key].bytesAsString()},slotNameAt:function(a){var b=this.instSize();return b>=a?this.sqClass.allInstVarNames()[a-1]:(a-b).toString()},sqInstName:function(){if(this.isNil)return"nil";if(this.isTrue)return"true";if(this.isFalse)return"false";if(this.isFloat){var a=this.float.toString();return/\./.test(a)||(a+=".0"),a}var b=this.sqClass.className();if(/ /.test(b))return"the "+b;switch(b){case"String":case"ByteString":return"'"+this.bytesAsString()+"'";case"Symbol":case"ByteSymbol":return"#"+this.bytesAsString();case"Point":return this.pointers.join("@");case"Rectangle":return this.pointers.join(" corner: ");case"Association":case"ReadOnlyVariableBinding":return this.pointers.join("->");case"LargePositiveInteger":return this.bytesAsNumberString(!1);case"LargeNegativeInteger":return this.bytesAsNumberString(!0);case"Character":return"$"+String.fromCharCode(this.pointers[0])+" ("+this.pointers[0].toString()+")"}return/^[aeiou]/i.test(b)?"an "+b:"a "+b}},"accessing",{isWords:function(){return 6===this.format},isBytes:function(){var a=this.format;return a>=8&&11>=a},isWordsOrBytes:function(){var a=this.format;return 6==a||a>=8&&11>=a},isPointers:function(){return this.format<=4},isMethod:function(){return this.format>=12},pointersSize:function(){return this.pointers?this.pointers.length:0},bytesSize:function(){return this.bytes?this.bytes.length:0},wordsSize:function(){return this.isFloat?2:this.words?this.words.length:0},instSize:function(){return this.format>4||2==this.format?0:this.format<2?this.pointersSize():this.sqClass.classInstSize()},floatData:function(){var a=new ArrayBuffer(8),b=new DataView(a);return b.setFloat64(0,this.float,!1),b},wordsAsFloat32Array:function(){return this.float32Array||this.words&&(this.float32Array=new Float32Array(this.words.buffer))},wordsAsFloat64Array:function(){return this.float64Array||this.words&&(this.float64Array=new Float64Array(this.words.buffer))},wordsAsInt32Array:function(){return this.int32Array||this.words&&(this.int32Array=new Int32Array(this.words.buffer))},wordsAsInt16Array:function(){return this.int16Array||this.words&&(this.int16Array=new Int16Array(this.words.buffer))},wordsAsUint16Array:function(){return this.uint16Array||this.words&&(this.uint16Array=new Uint16Array(this.words.buffer))},wordsAsUint8Array:function(){return this.uint8Array||this.words&&(this.uint8Array=new Uint8Array(this.words.buffer))},wordsOrBytes:function(){return this.words?this.words:this.uint32Array?this.uint32Array:this.bytes?this.uint32Array=new Uint32Array(this.bytes.buffer,0,this.bytes.length>>2):null},setAddr:function(a){var b=this.snapshotSize();return this.oop=a+4*b.header,a+4*(b.header+b.body)},snapshotSize:function(){var a=this.isFloat?2:this.words?this.words.length:this.pointers?this.pointers.length:0;return this.bytes&&(a+=this.bytes.length+3>>2),a++,{header:a>63?2:this.sqClass.isCompact?0:1,body:a}},addr:function(){return this.oop-4*this.snapshotSize().header},totalBytes:function(){var a=this.snapshotSize();return 4*(a.header+a.body)},writeTo:function(a,b,c){this.bytes&&(this.format|=3&-this.bytes.length);var d=b,e=this.snapshotSize(),f=(15&this.format)<<8|(4095&this.hash)<<17;switch(e.header){case 2:a.setUint32(b,e.body<<2|Squeak.HeaderTypeSizeAndClass),b+=4,a.setUint32(b,this.sqClass.oop|Squeak.HeaderTypeSizeAndClass),b+=4,a.setUint32(b,f|Squeak.HeaderTypeSizeAndClass),b+=4;break;case 1:a.setUint32(b,this.sqClass.oop|Squeak.HeaderTypeClass),b+=4,a.setUint32(b,f|e.body<<2|Squeak.HeaderTypeClass),b+=4;break;case 0:var g=c.compactClasses.indexOf(this.sqClass)+1;a.setUint32(b,f|g<<12|e.body<<2|Squeak.HeaderTypeShort),b+=4}if(this.isFloat)a.setFloat64(b,this.float),b+=8;else if(this.words)for(var h=0;h<this.words.length;h++)a.setUint32(b,this.words[h]),b+=4;else if(this.pointers)for(var h=0;h<this.pointers.length;h++)a.setUint32(b,c.objectToOop(this.pointers[h])),b+=4;if(this.bytes){for(var h=0;h<this.bytes.length;h++)a.setUint8(b++,this.bytes[h]);b+=3&-this.bytes.length}if(b!==d+this.totalBytes())throw Error("written size does not match");return b}},"as class",{classInstSize:function(){var a=this.pointers[Squeak.Class_format];return(a>>10&192)+(a>>1&63)-1},isWeak:function(){return 4==(this.pointers[Squeak.Class_format]>>7&15)},instVarNames:function(){var a=this.pointers.length>12?4:this.pointers.length>9?3:4;return(this.pointers[a].pointers||[]).map(function(a){return a.bytesAsString()})},allInstVarNames:function(){var a=this.superclass();return a.isNil?this.instVarNames():a.allInstVarNames().concat(this.instVarNames())},superclass:function(){return this.pointers[0]},className:function(){if(!this.pointers)return"_NOTACLASS_";var a=this.pointers[Squeak.Class_name];if(a&&a.bytes)return a.bytesAsString();for(var b=5;6>=b;b++){var c=this.pointers[b];if(c&&c.pointers&&(a=c.pointers[Squeak.Class_name])&&a.bytes)return a.bytesAsString()+" class"}return"_SOMECLASS_"},classInstProto:function(a){if(this.instProto)return this.instProto;var b=Squeak.Object;try{a||(a=this.className());var c=a.replace(/[^A-Za-z0-9]/g,"_");c="UndefinedObject"===c?"nil":"True"===c?"true_":"False"===c?"false_":(/^[AEIOU]/.test(c)?"an":"a")+c,b=new Function("return function "+c+"() {};")(),b.prototype=Squeak.Object.prototype}catch(a){}return Object.defineProperty(this,"instProto",{value:b}),b}},"as method",{methodHeader:function(){return this.pointers[0]},methodNumLits:function(){return this.pointers.length-1},methodNumArgs:function(){return this.methodHeader()>>24&15},methodPrimitiveIndex:function(){var a=805306879&this.methodHeader();return a>511?(511&a)+(a>>19):a},methodClassForSuper:function(){return this.pointers[this.methodNumLits()].pointers[Squeak.Assn_value]},methodNeedsLargeFrame:function(){return(131072&this.methodHeader())>0},methodAddPointers:function(a){this.pointers=a},methodTempCount:function(){return this.methodHeader()>>18&63},methodGetLiteral:function(a){return this.pointers[1+a]},methodGetSelector:function(a){return this.pointers[1+a]},methodSetLiteral:function(a,b){this.pointers[1+a]=b}},"as context",{contextHome:function(){return this.contextIsBlock()?this.pointers[Squeak.BlockContext_home]:this},contextIsBlock:function(){return"number"==typeof this.pointers[Squeak.BlockContext_argumentCount]},contextMethod:function(){return this.contextHome().pointers[Squeak.Context_method]},contextSender:function(){return this.pointers[Squeak.Context_sender]},contextSizeWithStack:function(a){if(a&&a.activeContext===this)return a.sp+1;var b=this.pointers[Squeak.Context_stackPointer];return Squeak.Context_tempFrameStart+("number"==typeof b?b:0)}}),Object.subclass("Squeak.Interpreter","initialization",{initialize:function(a,b){console.log("squeak: initializing interpreter "+Squeak.vmVersion),this.Squeak=Squeak,this.image=a,this.image.vm=this,this.primHandler=new Squeak.Primitives(this,b),this.loadImageState(),this.hackImage(),this.initVMState(),this.loadInitialContext(),this.initCompiler(),console.log("squeak: ready")},loadImageState:function(){this.specialObjects=this.image.specialObjectsArray.pointers,this.specialSelectors=this.specialObjects[Squeak.splOb_SpecialSelectors].pointers,this.nilObj=this.specialObjects[Squeak.splOb_NilObject],this.falseObj=this.specialObjects[Squeak.splOb_FalseObject],this.trueObj=this.specialObjects[Squeak.splOb_TrueObject],this.hasClosures=this.image.hasClosures,this.globals=this.findGlobals(),this.hasClosures||this.findMethod("UnixFileDirectory class>>pathNameDelimiter")||(this.primHandler.emulateMac=!0),6501==this.image.version&&(this.primHandler.reverseDisplay=!0)},initVMState:function(){this.byteCodeCount=0,this.sendCount=0,this.interruptCheckCounter=0,this.interruptCheckCounterFeedBackReset=1e3,this.interruptChecksEveryNms=3,this.nextPollTick=0,this.nextWakeupTick=0,this.lastTick=0,this.interruptKeycode=2094,this.interruptPending=!1,this.pendingFinalizationSignals=0,this.freeContexts=this.nilObj,this.freeLargeContexts=this.nilObj,this.reclaimableContextCount=0,this.nRecycledContexts=0,this.nAllocatedContexts=0,this.methodCacheSize=1024,this.methodCacheMask=this.methodCacheSize-1,this.methodCacheRandomish=0,this.methodCache=[];for(var a=0;a<this.methodCacheSize;a++)this.methodCache[a]={lkupClass:null,selector:null,method:null,primIndex:0,argCount:0,mClass:null};this.breakOutOfInterpreter=!1,this.breakOutTick=0,this.breakOnMethod=null,this.breakOnNewMethod=!1,this.breakOnContextChanged=!1,this.breakOnContextReturned=null,this.messages={},this.startupTime=Date.now()},loadInitialContext:function(){var a=this.specialObjects[Squeak.splOb_SchedulerAssociation],b=a.pointers[Squeak.Assn_value],c=b.pointers[Squeak.ProcSched_activeProcess];this.activeContext=c.pointers[Squeak.Proc_suspendedContext],this.fetchContextRegisters(this.activeContext),this.reclaimableContextCount=0},findGlobals:function(){var a=this.specialObjects[Squeak.splOb_SmalltalkDictionary],b=a.sqClass.className();if("Association"===b&&(a=a.pointers[1],b=a.sqClass.className()),"SystemDictionary"===b)return a.pointers[1].pointers;if("SmalltalkImage"===b){var c=a.pointers[0],d=c.sqClass.className();if("SystemDictionary"===d)return c.pointers[1].pointers;if("Environment"===d)return c.pointers[2].pointers[1].pointers}throw Error("cannot find global dict")},initCompiler:function(){if(!Squeak.Compiler)return console.warn("Squeak.Compiler not loaded, using interpreter only");try{if(42!==new Function("return 42")())return console.warn("function constructor not working, disabling JIT")}catch(a){return console.warn("disabling JIT: "+a)}var a=this.image.oldSpaceCount/(this.startupTime-this.image.startupTime);if(10>a)return console.warn("Slow machine detected (loaded "+(1e3*a|0)+" objects/sec), using interpreter only");try{console.log("squeak: initializing JIT compiler"),this.compiler=new Squeak.Compiler(this)}catch(a){console.warn("Compiler "+a)}},hackImage:function(){[].forEach(function(a){var b=this.findMethod(a.method);b&&(b.pointers[0]|=a.primitive,console.warn("Hacking "+a.method))},this)}},"interpreting",{interpretOne:function(a){if(this.method.compiled){if(a){if(!this.compiler.enableSingleStepping(this.method))return this.method.compiled=null,this.interpretOne(a);this.breakNow()}return void(this.byteCodeCount+=this.method.compiled(this))}var b,c,d=this.Squeak;if(this.byteCodeCount++,128>(b=this.nextByte()))switch(b){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:return void this.push(this.receiver.pointers[15&b]);case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:case 24:case 25:case 26:case 27:case 28:case 29:case 30:case 31:return void this.push(this.homeContext.pointers[d.Context_tempFrameStart+(15&b)]);case 32:case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:case 41:case 42:case 43:case 44:case 45:case 46:case 47:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 58:case 59:case 60:case 61:case 62:case 63:return void this.push(this.method.methodGetLiteral(31&b));case 64:case 65:case 66:case 67:case 68:case 69:case 70:case 71:case 72:case 73:case 74:case 75:case 76:case 77:case 78:case 79:case 80:case 81:case 82:case 83:case 84:case 85:case 86:case 87:case 88:case 89:case 90:case 91:case 92:case 93:case 94:case 95:return void this.push(this.method.methodGetLiteral(31&b).pointers[d.Assn_value]);case 96:case 97:case 98:case 99:case 100:case 101:case 102:case 103:return void(this.receiver.pointers[7&b]=this.pop());case 104:case 105:case 106:case 107:case 108:case 109:case 110:case 111:return void(this.homeContext.pointers[d.Context_tempFrameStart+(7&b)]=this.pop());case 112:return void this.push(this.receiver);case 113:return void this.push(this.trueObj);case 114:return void this.push(this.falseObj);case 115:return void this.push(this.nilObj);case 116:return void this.push(-1);case 117:return void this.push(0);case 118:return void this.push(1);case 119:return void this.push(2);case 120:return void this.doReturn(this.receiver);case 121:return void this.doReturn(this.trueObj);case 122:return void this.doReturn(this.falseObj);case 123:return void this.doReturn(this.nilObj);case 124:return void this.doReturn(this.pop());case 125:return void this.doReturn(this.pop(),this.activeContext.pointers[d.BlockContext_caller]);case 126:case 127:return void this.nono()}else switch(b){case 128:return void this.extendedPush(this.nextByte());case 129:return void this.extendedStore(this.nextByte());case 130:return void this.extendedStorePop(this.nextByte());case 131:return c=this.nextByte(),void this.send(this.method.methodGetSelector(31&c),c>>5,!1);case 132:return void this.doubleExtendedDoAnything(this.nextByte());case 133:return c=this.nextByte(),void this.send(this.method.methodGetSelector(31&c),c>>5,!0);case 134:return c=this.nextByte(),void this.send(this.method.methodGetSelector(63&c),c>>6,!1);case 135:return void this.pop();case 136:return void this.push(this.top());case 137:return void this.push(this.exportThisContext());case 138:return void this.pushNewArray(this.nextByte());case 139:return void this.nono();case 140:return c=this.nextByte(),void this.push(this.homeContext.pointers[d.Context_tempFrameStart+this.nextByte()].pointers[c]);case 141:return c=this.nextByte(),void(this.homeContext.pointers[d.Context_tempFrameStart+this.nextByte()].pointers[c]=this.top());case 142:return c=this.nextByte(),void(this.homeContext.pointers[d.Context_tempFrameStart+this.nextByte()].pointers[c]=this.pop());case 143:return void this.pushClosureCopy();case 144:case 145:case 146:case 147:case 148:case 149:case 150:case 151:return void(this.pc+=1+(7&b));case 152:case 153:case 154:case 155:case 156:case 157:case 158:case 159:return void this.jumpIfFalse(1+(7&b));case 160:case 161:case 162:case 163:case 164:case 165:case 166:case 167:return c=this.nextByte(),this.pc+=256*((7&b)-4)+c,void(4>(7&b)&&this.interruptCheckCounter--<=0&&this.checkForInterrupts());case 168:case 169:case 170:case 171:return void this.jumpIfTrue(256*(3&b)+this.nextByte());case 172:case 173:case 174:case 175:return void this.jumpIfFalse(256*(3&b)+this.nextByte());case 176:return this.success=!0,this.resultIsFloat=!1,void(this.pop2AndPushNumResult(this.stackIntOrFloat(1)+this.stackIntOrFloat(0))||this.sendSpecial(15&b));case 177:return this.success=!0,this.resultIsFloat=!1,void(this.pop2AndPushNumResult(this.stackIntOrFloat(1)-this.stackIntOrFloat(0))||this.sendSpecial(15&b));case 178:return this.success=!0,void(this.pop2AndPushBoolResult(this.stackIntOrFloat(1)<this.stackIntOrFloat(0))||this.sendSpecial(15&b));case 179:return this.success=!0,void(this.pop2AndPushBoolResult(this.stackIntOrFloat(1)>this.stackIntOrFloat(0))||this.sendSpecial(15&b));case 180:return this.success=!0,void(this.pop2AndPushBoolResult(this.stackIntOrFloat(1)<=this.stackIntOrFloat(0))||this.sendSpecial(15&b));case 181:return this.success=!0,void(this.pop2AndPushBoolResult(this.stackIntOrFloat(1)>=this.stackIntOrFloat(0))||this.sendSpecial(15&b));case 182:return this.success=!0,void(this.pop2AndPushBoolResult(this.stackIntOrFloat(1)===this.stackIntOrFloat(0))||this.sendSpecial(15&b));case 183:return this.success=!0,void(this.pop2AndPushBoolResult(this.stackIntOrFloat(1)!==this.stackIntOrFloat(0))||this.sendSpecial(15&b));case 184:return this.success=!0,this.resultIsFloat=!1,void(this.pop2AndPushNumResult(this.stackIntOrFloat(1)*this.stackIntOrFloat(0))||this.sendSpecial(15&b));case 185:return this.success=!0,void(this.pop2AndPushIntResult(this.quickDivide(this.stackInteger(1),this.stackInteger(0)))||this.sendSpecial(15&b));case 186:return this.success=!0,void(this.pop2AndPushIntResult(this.mod(this.stackInteger(1),this.stackInteger(0)))||this.sendSpecial(15&b));case 187:return this.success=!0,void(this.primHandler.primitiveMakePoint(1,!0)||this.sendSpecial(15&b));case 188:return this.success=!0,void(this.pop2AndPushIntResult(this.safeShift(this.stackInteger(1),this.stackInteger(0)))||this.sendSpecial(15&b));case 189:return this.success=!0,void(this.pop2AndPushIntResult(this.div(this.stackInteger(1),this.stackInteger(0)))||this.sendSpecial(15&b));case 190:return this.success=!0,void(this.pop2AndPushIntResult(this.stackInteger(1)&this.stackInteger(0))||this.sendSpecial(15&b));case 191:return this.success=!0,void(this.pop2AndPushIntResult(this.stackInteger(1)|this.stackInteger(0))||this.sendSpecial(15&b));case 192:case 193:case 194:case 195:case 196:case 197:case 198:case 199:case 200:case 201:case 202:case 203:case 204:case 205:case 206:case 207:return void(this.primHandler.quickSendOther(this.receiver,15&b)||this.sendSpecial(16+(15&b)));case 208:case 209:case 210:case 211:case 212:case 213:case 214:case 215:case 216:case 217:case 218:case 219:case 220:case 221:case 222:case 223:return void this.send(this.method.methodGetSelector(15&b),0,!1);case 224:case 225:case 226:case 227:case 228:case 229:case 230:case 231:case 232:case 233:case 234:case 235:case 236:case 237:case 238:case 239:return void this.send(this.method.methodGetSelector(15&b),1,!1);case 240:case 241:case 242:case 243:case 244:case 245:case 246:case 247:case 248:case 249:case 250:case 251:case 252:case 253:case 254:case 255:return void this.send(this.method.methodGetSelector(15&b),2,!1)}throw Error("not a bytecode: "+b)},interpret:function(a,b){if(this.frozen)return"frozen";for(this.isIdle=!1,this.breakOutOfInterpreter=!1,this.breakOutTick=this.primHandler.millisecondClockValue()+(a||500);!1===this.breakOutOfInterpreter;)this.method.compiled?this.byteCodeCount+=this.method.compiled(this):this.interpretOne();if("function"==typeof this.breakOutOfInterpreter)return this.breakOutOfInterpreter(b);var c="break"==this.breakOutOfInterpreter?"break":this.isIdle?this.nextWakeupTick?Math.max(1,this.nextWakeupTick-this.primHandler.millisecondClockValue()):"sleep":0;return b&&b(c),c},goIdle:function(){var a=0!==this.nextWakeupTick;this.forceInterruptCheck(),this.checkForInterrupts();var b=0!==this.nextWakeupTick;this.isIdle=b||!a,this.breakOut()},freeze:function(a){var b;this.frozen=!0,this.breakOutOfInterpreter=function(a){if(!a)throw Error("need function to restart interpreter");return b=a,"frozen"}.bind(this);var c=function(){if(this.frozen=!1,!b)throw Error("no continue function");b(0)}.bind(this);return a&&window.setTimeout(function(){a(c)},0),c},breakOut:function(){this.breakOutOfInterpreter=this.breakOutOfInterpreter||!0},nextByte:function(){return this.methodBytes[this.pc++]},nono:function(){throw Error("Oh No!")},forceInterruptCheck:function(){this.interruptCheckCounter=-1e3},checkForInterrupts:function(){var a=this.primHandler.millisecondClockValue();if(a<this.lastTick&&(this.nextPollTick=a+(this.nextPollTick-this.lastTick),this.breakOutTick=a+(this.breakOutTick-this.lastTick),0!==this.nextWakeupTick&&(this.nextWakeupTick=a+(this.nextWakeupTick-this.lastTick))),this.interruptCheckCounter>-100&&(a-this.lastTick<this.interruptChecksEveryNms?this.interruptCheckCounterFeedBackReset+=10:this.interruptCheckCounterFeedBackReset<=1e3?this.interruptCheckCounterFeedBackReset=1e3:this.interruptCheckCounterFeedBackReset-=12),this.interruptCheckCounter=this.interruptCheckCounterFeedBackReset,this.lastTick=a,this.interruptPending){this.interruptPending=!1;var b=this.specialObjects[Squeak.splOb_TheInterruptSemaphore];b.isNil||this.primHandler.synchronousSignal(b)}if(0!==this.nextWakeupTick&&a>=this.nextWakeupTick){this.nextWakeupTick=0;var b=this.specialObjects[Squeak.splOb_TheTimerSemaphore];b.isNil||this.primHandler.synchronousSignal(b)}if(this.pendingFinalizationSignals>0){var b=this.specialObjects[Squeak.splOb_TheFinalizationSemaphore];this.pendingFinalizationSignals=0,b.isNil||this.primHandler.synchronousSignal(b)}this.primHandler.semaphoresToSignal.length>0&&this.primHandler.signalExternalSemaphores(),!this.method.compiled&&this.compiler&&this.compiler.compile(this.method),a>=this.breakOutTick&&this.breakOut()},extendedPush:function(a){var b=63&a;switch(a>>6){case 0:this.push(this.receiver.pointers[b]);break;case 1:this.push(this.homeContext.pointers[Squeak.Context_tempFrameStart+b]);break;case 2:this.push(this.method.methodGetLiteral(b));break;case 3:this.push(this.method.methodGetLiteral(b).pointers[Squeak.Assn_value])}},extendedStore:function(a){var b=63&a;switch(a>>6){case 0:this.receiver.pointers[b]=this.top();break;case 1:this.homeContext.pointers[Squeak.Context_tempFrameStart+b]=this.top();break;case 2:this.nono();break;case 3:this.method.methodGetLiteral(b).pointers[Squeak.Assn_value]=this.top()}},extendedStorePop:function(a){var b=63&a;switch(a>>6){case 0:this.receiver.pointers[b]=this.pop();break;case 1:this.homeContext.pointers[Squeak.Context_tempFrameStart+b]=this.pop();break;case 2:this.nono();break;case 3:this.method.methodGetLiteral(b).pointers[Squeak.Assn_value]=this.pop()}},doubleExtendedDoAnything:function(a){var b=this.nextByte();switch(a>>5){case 0:this.send(this.method.methodGetSelector(b),31&a,!1);break;case 1:this.send(this.method.methodGetSelector(b),31&a,!0);break;case 2:this.push(this.receiver.pointers[b]);break;case 3:this.push(this.method.methodGetLiteral(b));break;case 4:this.push(this.method.methodGetLiteral(b).pointers[Squeak.Assn_value]);break;case 5:this.receiver.pointers[b]=this.top();break;case 6:this.receiver.pointers[b]=this.pop();break;case 7:this.method.methodGetLiteral(b).pointers[Squeak.Assn_value]=this.top()}},jumpIfTrue:function(a){var b=this.pop();return b.isTrue?void(this.pc+=a):void(b.isFalse||(this.push(b),this.send(this.specialObjects[Squeak.splOb_SelectorMustBeBoolean],0,!1)))},jumpIfFalse:function(a){var b=this.pop();return b.isFalse?void(this.pc+=a):void(b.isTrue||(this.push(b),this.send(this.specialObjects[Squeak.splOb_SelectorMustBeBoolean],0,!1)))},sendSpecial:function(a){this.send(this.specialSelectors[2*a],this.specialSelectors[2*a+1],!1)}},"closures",{pushNewArray:function(a){var b=a>127,c=127&a,d=this.instantiateClass(this.specialObjects[Squeak.splOb_ClassArray],c);if(b){for(var e=0;c>e;e++)d.pointers[e]=this.stackValue(c-e-1);this.popN(c)}this.push(d)},pushClosureCopy:function(){var a=this.nextByte(),b=15&a,c=a>>4,d=this.nextByte(),e=256*d+this.nextByte(),f=this.encodeSqueakPC(this.pc,this.method),g=this.newClosure(b,f,c);if(g.pointers[Squeak.Closure_outerContext]=this.activeContext,this.reclaimableContextCount=0,c>0){for(var h=0;c>h;h++)g.pointers[Squeak.Closure_firstCopiedValue+h]=this.stackValue(c-h-1);this.popN(c)}this.pc+=e,this.push(g)},newClosure:function(a,b,c){var d=this.instantiateClass(this.specialObjects[Squeak.splOb_ClassBlockClosure],c);return d.pointers[Squeak.Closure_startpc]=b,d.pointers[Squeak.Closure_numArgs]=a,d}},"sending",{send:function(a,b,c){var d=this.stackValue(b),e=this.getClass(d);c&&(e=this.method.methodClassForSuper(),e=e.pointers[Squeak.Class_superclass]);var f=this.findSelectorInClass(a,b,e);f.primIndex&&(this.verifyAtSelector=a,this.verifyAtClass=e),this.executeNewMethod(d,f.method,f.argCount,f.primIndex,f.mClass,a)},sendAsPrimitiveFailure:function(a,b,c){this.executeNewMethod(a,b,c,0)},findSelectorInClass:function(a,b,c){var d=this.findMethodCacheEntry(a,c);if(d.method)return d;for(var e,f=c;!f.isNil;){if(e=f.pointers[Squeak.Class_mdict],e.isNil){var g=this.specialObjects[Squeak.splOb_SelectorCannotInterpret],h=this.createActualMessage(a,b,c);return this.popNandPush(b,h),this.findSelectorInClass(g,1,f.superclass())}var i=this.lookupSelectorInDict(e,a);if(!i.isNil)return this.currentSelector=a,this.currentLookupClass=c,d.method=i,d.primIndex=i.isMethod()?i.methodPrimitiveIndex():248,d.argCount=b,d.mClass=f,d;f=f.superclass()}var j=this.specialObjects[Squeak.splOb_SelectorDoesNotUnderstand];if(a===j)throw Error("Recursive not understood error encountered");var k=this.createActualMessage(a,b,c);return this.popNandPush(b,k),this.findSelectorInClass(j,1,c)},lookupSelectorInDict:function(a,b){for(var c=a.pointersSize(),d=c-Squeak.MethodDict_selectorStart-1,e=(d&b.hash)+Squeak.MethodDict_selectorStart,f=!1;;){var g=a.pointers[e];if(g===b){return a.pointers[Squeak.MethodDict_array].pointers[e-Squeak.MethodDict_selectorStart]}if(g.isNil)return this.nilObj;if(++e===c){if(f)return this.nilObj;e=Squeak.MethodDict_selectorStart,f=!0}}},executeNewMethod:function(a,b,c,d,e,f){if(this.sendCount++,b===this.breakOnMethod&&this.breakNow("executing method "+this.printMethod(b,e,f)),this.logSends&&console.log(this.sendCount+" "+this.printMethod(b,e,f)),this.breakOnContextChanged&&(this.breakOnContextChanged=!1,this.breakNow()),!(d>0&&this.tryPrimitive(d,c,b))){var g=this.allocateOrRecycleContext(b.methodNeedsLargeFrame()),h=b.methodTempCount(),i=Squeak.Context_tempFrameStart+h-1;if(g.pointers[Squeak.Context_method]=b,g.pointers[Squeak.BlockContext_initialIP]=this.nilObj,g.pointers[Squeak.Context_sender]=this.activeContext,this.arrayCopy(this.activeContext.pointers,this.sp-c,g.pointers,Squeak.Context_tempFrameStart-1,c+1),this.arrayFill(g.pointers,Squeak.Context_tempFrameStart+c,Squeak.Context_tempFrameStart+h,this.nilObj),this.popN(c+1),this.reclaimableContextCount++,this.storeContextRegisters(),this.activeContext=g,this.homeContext=g,this.method=b,this.methodBytes=b.bytes,this.pc=0,this.sp=i,this.storeContextRegisters(),this.receiver=g.pointers[Squeak.Context_receiver],this.receiver!==a)throw Error("receivers don't match");!b.compiled&&this.compiler&&this.compiler.compile(b,e,f),this.interruptCheckCounter--<=0&&this.checkForInterrupts()}},doReturn:function(a,b){if(!b){var c=this.homeContext;if(this.hasClosures)for(var d;!(d=c.pointers[Squeak.Context_closure]).isNil;)c=d.pointers[Squeak.Closure_outerContext];b=c.pointers[Squeak.Context_sender]}if(b.isNil||b.pointers[Squeak.Context_instructionPointer].isNil)return this.cannotReturn(a);for(var e=this.activeContext.pointers[Squeak.Context_sender];e!==b;){if(e.isNil)return this.cannotReturn(a);if(this.isUnwindMarked(e))return this.aboutToReturnThrough(a,e);e=e.pointers[Squeak.Context_sender]}var f;for(e=this.activeContext;e!==b;)this.breakOnContextReturned===e&&(this.breakOnContextReturned=null,this.breakNow()),f=e.pointers[Squeak.Context_sender],e.pointers[Squeak.Context_sender]=this.nilObj,e.pointers[Squeak.Context_instructionPointer]=this.nilObj,this.reclaimableContextCount>0&&(this.reclaimableContextCount--,this.recycleIfPossible(e)),e=f;this.activeContext=e,this.fetchContextRegisters(this.activeContext),this.push(a),this.breakOnContextChanged&&(this.breakOnContextChanged=!1,this.breakNow())},aboutToReturnThrough:function(a,b){this.push(this.exportThisContext()),this.push(a),this.push(b);var c=this.specialObjects[Squeak.splOb_SelectorAboutToReturn];this.send(c,2)},cannotReturn:function(a){this.push(this.exportThisContext()),this.push(a);var b=this.specialObjects[Squeak.splOb_SelectorCannotReturn];this.send(b,1)},tryPrimitive:function(a,b,c){if(a>255&&520>a){if(a>=264)return this.popNandPush(1,this.top().pointers[a-264]),!0;switch(a){case 256:return!0;case 257:return this.popNandPush(1,this.trueObj),!0;case 258:return this.popNandPush(1,this.falseObj),!0;case 259:return this.popNandPush(1,this.nilObj),!0}return this.popNandPush(1,a-261),!0}return this.primHandler.doPrimitive(a,b,c)},createActualMessage:function(a,b,c){var d=this.instantiateClass(this.specialObjects[Squeak.splOb_ClassMessage],0),e=this.instantiateClass(this.specialObjects[Squeak.splOb_ClassArray],b);return this.arrayCopy(this.activeContext.pointers,this.sp-b+1,e.pointers,0,b),d.pointers[Squeak.Message_selector]=a,d.pointers[Squeak.Message_arguments]=e,d.pointers.length>Squeak.Message_lookupClass&&(d.pointers[Squeak.Message_lookupClass]=c),d},primitivePerform:function(a){var b=this.stackValue(a-1),c=this.stackValue(a),d=a-1,e=this.sp-d,f=this.activeContext.pointers;this.arrayCopy(f,e+1,f,e,d),this.sp--;var g=this.findSelectorInClass(b,d,this.getClass(c));return this.executeNewMethod(c,g.method,g.argCount,g.primIndex,g.mClass,b),!0},primitivePerformWithArgs:function(a,b){var c=this.stackValue(a),d=this.stackValue(a-1),e=this.stackValue(a-2);if(e.sqClass!==this.specialObjects[Squeak.splOb_ClassArray])return!1;var f=b?this.stackValue(a-3):this.getClass(c);if(b)for(var g=this.getClass(c);g!==f;)if(g=g.pointers[Squeak.Class_superclass],g.isNil)return!1;var h=e.pointersSize(),i=this.activeContext.pointers;this.arrayCopy(e.pointers,0,i,this.sp-1,h),this.sp+=h-a;var j=this.findSelectorInClass(d,h,f);return this.executeNewMethod(c,j.method,j.argCount,j.primIndex,j.mClass,d),!0},primitiveInvokeObjectAsMethod:function(a,b){for(var c=this.instantiateClass(this.specialObjects[Squeak.splOb_ClassArray],a),d=0;a>d;d++)c.pointers[a-d-1]=this.pop();var e=this.pop(),f=this.currentSelector,g=this.specialObjects[Squeak.splOb_SelectorRunWithIn];return this.push(b),this.push(f),this.push(c),this.push(e),this.send(g,3,!1),!0},findMethodCacheEntry:function(a,b){var c;this.methodCacheRandomish=this.methodCacheRandomish+1&3;for(var d=(a.hash^b.hash)&this.methodCacheMask,e=d,f=0;4>f;f++){if(c=this.methodCache[e],c.selector===a&&c.lkupClass===b)return c;f===this.methodCacheRandomish&&(d=e),e=e+a.hash&this.methodCacheMask}return c=this.methodCache[d],c.lkupClass=b,c.selector=a,c.method=null,c},flushMethodCache:function(){for(var a=0;a<this.methodCacheSize;a++)this.methodCache[a].selector=null,this.methodCache[a].method=null;return!0},flushMethodCacheForSelector:function(a){for(var b=0;b<this.methodCacheSize;b++)this.methodCache[b].selector===a&&(this.methodCache[b].selector=null,this.methodCache[b].method=null);return!0},flushMethodCacheForMethod:function(a){for(var b=0;b<this.methodCacheSize;b++)this.methodCache[b].method===a&&(this.methodCache[b].selector=null,this.methodCache[b].method=null);return!0},flushMethodCacheAfterBecome:function(){this.flushMethodCache()}},"contexts",{isUnwindMarked:function(a){return!!this.isMethodContext(a)&&198==a.pointers[Squeak.Context_method].methodPrimitiveIndex()},newActiveContext:function(a){this.storeContextRegisters(),this.activeContext=a,this.fetchContextRegisters(a)},exportThisContext:function(){return this.storeContextRegisters(),this.reclaimableContextCount=0,this.activeContext},fetchContextRegisters:function(a){var b=a.pointers[Squeak.Context_method];this.isSmallInt(b)?(this.homeContext=a.pointers[Squeak.BlockContext_home],b=this.homeContext.pointers[Squeak.Context_method]):this.homeContext=a,this.receiver=this.homeContext.pointers[Squeak.Context_receiver],this.method=b,this.methodBytes=b.bytes,this.pc=this.decodeSqueakPC(a.pointers[Squeak.Context_instructionPointer],b),this.sp=this.decodeSqueakSP(a.pointers[Squeak.Context_stackPointer])},storeContextRegisters:function(){this.activeContext.pointers[Squeak.Context_instructionPointer]=this.encodeSqueakPC(this.pc,this.method),this.activeContext.pointers[Squeak.Context_stackPointer]=this.encodeSqueakSP(this.sp)},encodeSqueakPC:function(a,b){return a+4*b.pointers.length+1},decodeSqueakPC:function(a,b){return a-4*b.pointers.length-1},encodeSqueakSP:function(a){return a-(Squeak.Context_tempFrameStart-1)},decodeSqueakSP:function(a){return a+(Squeak.Context_tempFrameStart-1)},recycleIfPossible:function(a){if(this.isMethodContext(a))if(a.pointersSize()===Squeak.Context_tempFrameStart+Squeak.Context_smallFrameSize)a.pointers[0]=this.freeContexts,this.freeContexts=a;else{if(a.pointersSize()!==Squeak.Context_tempFrameStart+Squeak.Context_largeFrameSize)return;a.pointers[0]=this.freeLargeContexts,this.freeLargeContexts=a}},allocateOrRecycleContext:function(a){var b;return a?this.freeLargeContexts.isNil?(this.nAllocatedContexts++,this.instantiateClass(this.specialObjects[Squeak.splOb_ClassMethodContext],Squeak.Context_largeFrameSize)):(b=this.freeLargeContexts,this.freeLargeContexts=b.pointers[0],this.nRecycledContexts++,b):this.freeContexts.isNil?(this.nAllocatedContexts++,this.instantiateClass(this.specialObjects[Squeak.splOb_ClassMethodContext],Squeak.Context_smallFrameSize)):(b=this.freeContexts,this.freeContexts=b.pointers[0],this.nRecycledContexts++,b)}},"stack access",{pop:function(){return this.activeContext.pointers[this.sp--]},popN:function(a){this.sp-=a},push:function(a){this.activeContext.pointers[++this.sp]=a},popNandPush:function(a,b){this.activeContext.pointers[this.sp-=a-1]=b},top:function(){return this.activeContext.pointers[this.sp]},stackValue:function(a){return this.activeContext.pointers[this.sp-a]},stackInteger:function(a){return this.checkSmallInt(this.stackValue(a))},stackIntOrFloat:function(a){var b=this.stackValue(a);if("number"==typeof b)return b;if(b.isFloat)return this.resultIsFloat=!0,b.float;var c=b.bytes;if(c&&4==c.length){for(var d=0,e=3;e>=0;e--)d=256*d+c[e];if(b.sqClass===this.specialObjects[Squeak.splOb_ClassLargePositiveInteger])return d;if(b.sqClass===this.specialObjects[Squeak.splOb_ClassLargeNegativeInteger])return-d}return this.success=!1,0},pop2AndPushIntResult:function(a){return!(!this.success||!this.canBeSmallInt(a))&&(this.popNandPush(2,a),!0)},pop2AndPushNumResult:function(a){if(this.success){if(this.resultIsFloat)return this.popNandPush(2,this.primHandler.makeFloat(a)),!0;if(a>=Squeak.MinSmallInt&&a<=Squeak.MaxSmallInt)return this.popNandPush(2,a),!0;if(a>=-4294967295&&4294967295>=a){var b=0>a,c=b?-a:a,d=b?Squeak.splOb_ClassLargeNegativeInteger:Squeak.splOb_ClassLargePositiveInteger,e=this.instantiateClass(this.specialObjects[d],4),f=e.bytes;return f[0]=255&c,f[1]=c>>8&255,f[2]=c>>16&255,f[3]=c>>24&255,this.popNandPush(2,e),!0}}return!1},pop2AndPushBoolResult:function(a){return!!this.success&&(this.popNandPush(2,a?this.trueObj:this.falseObj),!0)}},"numbers",{getClass:function(a){return this.isSmallInt(a)?this.specialObjects[Squeak.splOb_ClassInteger]:a.sqClass},canBeSmallInt:function(a){return a>=Squeak.MinSmallInt&&a<=Squeak.MaxSmallInt},isSmallInt:function(a){return"number"==typeof a},checkSmallInt:function(a){return"number"==typeof a?a:(this.success=!1,1)},quickDivide:function(a,b){if(0===b)return Squeak.NonSmallInt;var c=a/b|0;return c*b===a?c:Squeak.NonSmallInt},div:function(a,b){return 0===b?Squeak.NonSmallInt:Math.floor(a/b)},mod:function(a,b){return 0===b?Squeak.NonSmallInt:a-Math.floor(a/b)*b},safeShift:function(a,b){if(0>b)return-31>b?0>a?-1:0:a>>-b;if(b>31)return 0==a?0:Squeak.NonSmallInt;var c=a<<b;return c>>b===a?c:Squeak.NonSmallInt}},"utils",{isContext:function(a){return a.sqClass===this.specialObjects[Squeak.splOb_ClassMethodContext]||a.sqClass===this.specialObjects[Squeak.splOb_ClassBlockContext]},isMethodContext:function(a){return a.sqClass===this.specialObjects[Squeak.splOb_ClassMethodContext]},isMethod:function(a){return a.sqClass===this.specialObjects[Squeak.splOb_ClassCompiledMethod]},instantiateClass:function(a,b){return this.image.instantiateClass(a,b,this.nilObj)},arrayFill:function(a,b,c,d){for(var e=b;c>e;e++)a[e]=d},arrayCopy:function(a,b,c,d,e){if(a===c&&d>b)for(var f=e-1;f>=0;f--)c[d+f]=a[b+f];else for(var f=0;e>f;f++)c[d+f]=a[b+f]}},"debugging",{addMessage:function(a){return this.messages[a]?++this.messages[a]:this.messages[a]=1},warnOnce:function(a){1==this.addMessage(a)&&console.warn(a)},printMethod:function(a,b,c){if(c)return b.className()+">>"+c.bytesAsString();a||(a=this.activeContext.contextMethod());var d;if(this.allMethodsDo(function(b,c,e){return c===a?d=b.className()+">>"+e.bytesAsString():void 0}),d)return d;if(b){return"("+b.pointers[Squeak.Context_receiver]+")>>?"}return"?>>?"},allInstancesOf:function(a,b){"string"==typeof a&&(a=this.globalNamed(a));for(var c=[],d=this.image.someInstanceOf(a);d;)b?b(d):c.push(d),d=this.image.nextInstanceAfter(d);return c},globalNamed:function(a){return this.allGlobalsDo(function(b,c){return b.bytesAsString()===a?c:void 0})},allGlobalsDo:function(a){for(var b=this.globals,c=0;c<b.length;c++){var d=b[c];if(!d.isNil){var e=a(d.pointers[0],d.pointers[1]);if(e)return e}}},allMethodsDo:function(a){this.allGlobalsDo(function(b,c){if(c.pointers&&c.pointers.length>=9)for(var d=[c,c.sqClass],e=0;e<d.length;e++){var f=d[e],g=f.pointers[1];if(g.pointers&&g.pointers[1]){var h=g.pointers[1].pointers;if(h)for(var i=g.pointers,j=0;j<h.length;j++)if(a.call(this,f,h[j],i[2+j]))return!0}}})},printStack:function(a,b){"number"==typeof a&&(b=a,a=null),a||(a=this.activeContext),b||(b=100);for(var c=[],d=Math.max(b,1e6);!a.isNil&&d-- >0;)c.push(a),a=a.pointers[Squeak.Context_sender];var e=200;c.length>b+e&&(a.isNil||c.push("..."),c=c.slice(0,b).concat(["..."]).concat(c.slice(-e)));for(var f=[],g=c.length;g-- >0;){var a=c[g];if(a.pointers){var h="",i=a.pointers[Squeak.Context_method];"number"==typeof i?(i=a.pointers[Squeak.BlockContext_home].pointers[Squeak.Context_method],h="[] in "):a.pointers[Squeak.Context_closure].isNil||(h="[] in "),f.push(h+this.printMethod(i,a)+"\n")}else f.push("...\n")}return f.join("")},findMethod:function(a){var b,c=a.split(">>")[0],d=a.split(">>")[1];return this.allMethodsDo(function(a,e,f){return d.length==f.bytesSize()&&d==f.bytesAsString()&&c==a.className()?b=e:void 0}),b},breakNow:function(a){a&&console.log("Break: "+a),this.breakOutOfInterpreter="break"},breakOn:function(a){return this.breakOnMethod=a&&this.findMethod(a)},breakOnReturnFromThisContext:function(){this.breakOnContextChanged=!1,this.breakOnContextReturned=this.activeContext},breakOnSendOrReturn:function(){this.breakOnContextChanged=!0,this.breakOnContextReturned=null},printActiveContext:function(){for(var a=this.activeContext,b="number"==typeof a.pointers[Squeak.BlockContext_argumentCount],c=a.pointers[Squeak.Context_closure],d=!b&&!c.isNil,e=b?a.pointers[Squeak.BlockContext_home]:a,f=d?c.pointers[Squeak.Closure_numArgs]:e.pointers[Squeak.Context_method].methodTempCount(),g=this.decodeSqueakSP(0),h=e.contextSizeWithStack(this)-1,i=g+1,j=i+f-1,k="",l=g;h>=l;l++){var m=e.pointers[l],n=m.sqInstName?m.sqInstName():m.toString(),o="";l==g?o="=rcvr":j>=l&&(o="=tmp"+(l-i)),k+="\nctx["+l+"]"+o+": "+n}if(b){k+="\n";for(var p=a.pointers[3],q=this.decodeSqueakSP(1),r=q+p,l=q;l<=this.sp;l++){var m=a.pointers[l],n=m.sqInstName?m.sqInstName():m.toString(),o="";r>=l&&(o="=arg"+(l-q)),k+="\nblk["+l+"]"+o+": "+n}}return k},printAllProcesses:function(){for(var a=this.specialObjects[Squeak.splOb_SchedulerAssociation],b=a.pointers[Squeak.Assn_value],c=b.pointers[Squeak.ProcSched_activeProcess],d="Active: "+this.printProcess(c,!0),e=b.pointers[Squeak.ProcSched_processLists].pointers,f=e.length-1;f>=0;f--)for(var g=e[f].pointers[Squeak.LinkedList_firstLink];!g.isNil;)d+="\nRunnable: "+this.printProcess(g),g=g.pointers[Squeak.Link_nextLink];for(var h=this.specialObjects[Squeak.splOb_ClassSemaphore],i=this.image.someInstanceOf(h);i;){for(var g=i.pointers[Squeak.LinkedList_firstLink];!g.isNil;)d+="\nWaiting: "+this.printProcess(g),g=g.pointers[Squeak.Link_nextLink];i=this.image.nextInstanceAfter(i)}return d},printProcess:function(a,b){var c=a.pointers[Squeak.Proc_suspendedContext],d=a.pointers[Squeak.Proc_priority],e=this.printStack(b?null:c);return a.toString()+" at priority "+d+"\n"+e},printByteCodes:function(a,b,c,d){return a||(a=this.method),new Squeak.InstructionPrinter(a,this).printInstructions(b,c,d)},willSendOrReturn:function(){var a=this.method.bytes[this.pc];if(a>=120&&125>=a)return!0;if(131>a||200==a)return!1;if(a>=176)return!0;if(134>=a){var b;if(132===a){if(this.method.bytes[this.pc+1]>>5>1)return!1;b=this.method.bytes[this.pc+2]}else b=this.method.bytes[this.pc+1]&(134===a?63:31);if("blockCopy:"!=this.method.pointers[b+1].bytesAsString())return!0}return!1}}),Object.subclass("Squeak.Primitives","initialization",{initialize:function(a,b){this.vm=a,this.display=b,this.display.vm=this.vm,this.oldPrims=!this.vm.image.hasClosures,this.allowAccessBeyondSP=this.oldPrims,this.deferDisplayUpdates=!1,this.semaphoresToSignal=[],this.initDisplay(),this.initAtCache(),this.initModules()},initModules:function(){this.loadedModules={},this.builtinModules={JavaScriptPlugin:this.findPluginFunctions("js_","",!0),FilePlugin:this.findPluginFunctions("","primitive(Disable)?(File|Directory)"),DropPlugin:this.findPluginFunctions("","primitiveDropRequest"),SoundPlugin:this.findPluginFunctions("snd_"),JPEGReadWriter2Plugin:this.findPluginFunctions("jpeg2_"),SecurityPlugin:{primitiveDisableImageWrite:this.fakePrimitive.bind(this,"SecurityPlugin.primitiveDisableImageWrite",0)}},this.patchModules={ScratchPlugin:this.findPluginFunctions("scratch_")},this.interpreterProxy=new Squeak.InterpreterProxy(this.vm)},findPluginFunctions:function(a,b,c){b=b||"(initialise|shutdown|prim)";var d={},e=new RegExp("^"+a+b,"i");for(var f in this)if(e.test(f)&&"function"==typeof this[f]){var g=f;a&&(g=f[a.length].toLowerCase()+f.slice(a.length+1)),d[g]=c?f:this[f].bind(this)}return d},initDisplay:function(){this.indexedColors=[4294967295,4278190081,4294967295,4286611584,4294901760,4278255360,4278190335,4278255615,4294967040,4294902015,4280295456,4282400832,4284506208,4288651167,4290756543,4292861919,4278716424,4279242768,4279769112,4280821800,4281348144,4281874488,4282927176,4283453520,4283979864,4285032552,4285558896,4286085240,4287072135,4287598479,4288124823,4289177511,4289703855,4290230199,4291282887,4291809231,4292335575,4293388263,4293914607,4294440951,4278190081,4278203136,4278216192,4278229248,4278242304,4278255360,4278190131,4278203187,4278216243,4278229299,4278242355,4278255411,4278190182,4278203238,4278216294,4278229350,4278242406,4278255462,4278190233,4278203289,4278216345,4278229401,4278242457,4278255513,4278190284,4278203340,4278216396,4278229452,4278242508,4278255564,4278190335,4278203391,4278216447,4278229503,4278242559,4278255615,4281532416,4281545472,4281558528,4281571584,4281584640,4281597696,4281532467,4281545523,4281558579,4281571635,4281584691,4281597747,4281532518,4281545574,4281558630,4281571686,4281584742,4281597798,4281532569,4281545625,4281558681,4281571737,4281584793,4281597849,4281532620,4281545676,4281558732,4281571788,4281584844,4281597900,4281532671,4281545727,4281558783,4281571839,4281584895,4281597951,4284874752,4284887808,4284900864,4284913920,4284926976,4284940032,4284874803,4284887859,4284900915,4284913971,4284927027,4284940083,4284874854,4284887910,4284900966,4284914022,4284927078,4284940134,4284874905,4284887961,4284901017,4284914073,4284927129,4284940185,4284874956,4284888012,4284901068,4284914124,4284927180,4284940236,4284875007,4284888063,4284901119,4284914175,4284927231,4284940287,4288217088,4288230144,4288243200,4288256256,4288269312,4288282368,4288217139,4288230195,4288243251,4288256307,4288269363,4288282419,4288217190,4288230246,4288243302,4288256358,4288269414,4288282470,4288217241,4288230297,4288243353,4288256409,4288269465,4288282521,4288217292,4288230348,4288243404,4288256460,4288269516,4288282572,4288217343,4288230399,4288243455,4288256511,4288269567,4288282623,4291559424,4291572480,4291585536,4291598592,4291611648,4291624704,4291559475,4291572531,4291585587,4291598643,4291611699,4291624755,4291559526,4291572582,4291585638,4291598694,4291611750,4291624806,4291559577,4291572633,4291585689,4291598745,4291611801,4291624857,4291559628,4291572684,4291585740,4291598796,4291611852,4291624908,4291559679,4291572735,4291585791,4291598847,4291611903,4291624959,4294901760,4294914816,4294927872,4294940928,4294953984,4294967040,4294901811,4294914867,4294927923,4294940979,4294954035,4294967091,4294901862,4294914918,4294927974,4294941030,4294954086,4294967142,4294901913,4294914969,4294928025,4294941081,4294954137,4294967193,4294901964,4294915020,4294928076,4294941132,4294954188,4294967244,4294902015,4294915071,4294928127,4294941183,4294954239,4294967295]}},"dispatch",{quickSendOther:function(a,b){switch(this.success=!0,b){case 0:return this.popNandPushIfOK(2,this.objectAt(!0,!0,!1));case 1:return this.popNandPushIfOK(3,this.objectAtPut(!0,!0,!1));case 2:return this.popNandPushIfOK(1,this.objectSize(!0));case 6:return this.pop2andPushBoolIfOK(this.vm.stackValue(1)===this.vm.stackValue(0));case 7:return this.popNandPushIfOK(1,this.vm.getClass(this.vm.top()));case 8:return this.popNandPushIfOK(2,this.doBlockCopy());case 9:return this.primitiveBlockValue(0);case 10:return this.primitiveBlockValue(1)}return!1},doPrimitive:function(a,b,c){if(this.success=!0,128>a)switch(a){case 1:return this.popNandPushIntIfOK(2,this.stackInteger(1)+this.stackInteger(0));case 2:return this.popNandPushIntIfOK(2,this.stackInteger(1)-this.stackInteger(0));case 3:return this.pop2andPushBoolIfOK(this.stackInteger(1)<this.stackInteger(0));case 4:return this.pop2andPushBoolIfOK(this.stackInteger(1)>this.stackInteger(0));case 5:return this.pop2andPushBoolIfOK(this.stackInteger(1)<=this.stackInteger(0));case 6:return this.pop2andPushBoolIfOK(this.stackInteger(1)>=this.stackInteger(0));case 7:return this.pop2andPushBoolIfOK(this.stackInteger(1)===this.stackInteger(0));case 8:return this.pop2andPushBoolIfOK(this.stackInteger(1)!==this.stackInteger(0));case 9:return this.popNandPushIntIfOK(2,this.stackInteger(1)*this.stackInteger(0));case 10:return this.popNandPushIntIfOK(2,this.vm.quickDivide(this.stackInteger(1),this.stackInteger(0)));case 11:return this.popNandPushIntIfOK(2,this.vm.mod(this.stackInteger(1),this.stackInteger(0)));case 12:return this.popNandPushIntIfOK(2,this.vm.div(this.stackInteger(1),this.stackInteger(0)));case 13:return this.popNandPushIntIfOK(2,this.stackInteger(1)/this.stackInteger(0)|0);case 14:return this.popNandPushIfOK(2,this.doBitAnd());case 15:return this.popNandPushIfOK(2,this.doBitOr());case 16:return this.popNandPushIfOK(2,this.doBitXor());case 17:return this.popNandPushIfOK(2,this.doBitShift());case 18:return this.primitiveMakePoint(b,!1);case 19:case 20:case 21:case 22:return!1;case 23:return this.primitiveLessThanLargeIntegers();case 24:return this.primitiveGreaterThanLargeIntegers();case 25:return this.primitiveLessOrEqualLargeIntegers();case 26:return this.primitiveGreaterOrEqualLargeIntegers();case 27:return this.primitiveEqualLargeIntegers();case 28:return this.primitiveNotEqualLargeIntegers();case 29:case 30:case 31:case 32:case 33:case 34:case 35:case 36:case 37:return!1;case 38:return this.popNandPushIfOK(2,this.objectAt(!1,!1,!1));case 39:return this.popNandPushIfOK(3,this.objectAtPut(!1,!1,!1));case 40:return this.popNandPushFloatIfOK(1,this.stackInteger(0));case 41:return this.popNandPushFloatIfOK(2,this.stackFloat(1)+this.stackFloat(0));case 42:return this.popNandPushFloatIfOK(2,this.stackFloat(1)-this.stackFloat(0));case 43:return this.pop2andPushBoolIfOK(this.stackFloat(1)<this.stackFloat(0));case 44:return this.pop2andPushBoolIfOK(this.stackFloat(1)>this.stackFloat(0));case 45:return this.pop2andPushBoolIfOK(this.stackFloat(1)<=this.stackFloat(0));case 46:return this.pop2andPushBoolIfOK(this.stackFloat(1)>=this.stackFloat(0));case 47:return this.pop2andPushBoolIfOK(this.stackFloat(1)===this.stackFloat(0));case 48:return this.pop2andPushBoolIfOK(this.stackFloat(1)!==this.stackFloat(0));case 49:return this.popNandPushFloatIfOK(2,this.stackFloat(1)*this.stackFloat(0));case 50:return this.popNandPushFloatIfOK(2,this.safeFDiv(this.stackFloat(1),this.stackFloat(0)));case 51:return this.popNandPushIfOK(1,this.floatAsSmallInt(this.stackFloat(0)));case 52:return!1;case 53:return this.popNandPushIntIfOK(1,this.frexp_exponent(this.stackFloat(0))-1);case 54:return this.popNandPushFloatIfOK(2,this.ldexp(this.stackFloat(1),this.stackFloat(0)));case 55:return this.popNandPushFloatIfOK(1,Math.sqrt(this.stackFloat(0)));case 56:return this.popNandPushFloatIfOK(1,Math.sin(this.stackFloat(0)));case 57:return this.popNandPushFloatIfOK(1,Math.atan(this.stackFloat(0)));case 58:return this.popNandPushFloatIfOK(1,Math.log(this.stackFloat(0)));case 59:return this.popNandPushFloatIfOK(1,Math.exp(this.stackFloat(0)));case 60:return this.popNandPushIfOK(2,this.objectAt(!1,!1,!1));case 61:return this.popNandPushIfOK(3,this.objectAtPut(!1,!1,!1));case 62:return this.popNandPushIfOK(1,this.objectSize(!1));case 63:return this.popNandPushIfOK(2,this.objectAt(!1,!0,!1));case 64:return this.popNandPushIfOK(3,this.objectAtPut(!1,!0,!1));case 65:case 66:case 67:return!1;case 68:return this.popNandPushIfOK(2,this.objectAt(!1,!1,!0));case 69:return this.popNandPushIfOK(3,this.objectAtPut(!1,!1,!0));case 70:return this.popNandPushIfOK(1,this.instantiateClass(this.stackNonInteger(0),0));case 71:return this.popNandPushIfOK(2,this.instantiateClass(this.stackNonInteger(1),this.stackPos32BitInt(0)));case 72:return this.primitiveArrayBecome(b,!1);case 73:return this.popNandPushIfOK(2,this.objectAt(!1,!1,!0));case 74:return this.popNandPushIfOK(3,this.objectAtPut(!1,!1,!0));case 75:return this.popNandPushIfOK(1,this.stackNonInteger(0).hash);case 76:return this.primitiveStoreStackp(b);case 77:return this.popNandPushIfOK(1,this.someInstanceOf(this.stackNonInteger(0)));case 78:return this.popNandPushIfOK(1,this.nextInstanceAfter(this.stackNonInteger(0)));case 79:return this.primitiveNewMethod(b);case 80:return this.popNandPushIfOK(2,this.doBlockCopy());case 81:return this.primitiveBlockValue(b);case 82:return this.primitiveBlockValueWithArgs(b);case 83:return this.vm.primitivePerform(b);case 84:return this.vm.primitivePerformWithArgs(b,!1);case 85:return this.primitiveSignal();case 86:return this.primitiveWait();case 87:return this.primitiveResume();case 88:return this.primitiveSuspend();case 89:return this.vm.flushMethodCache();case 90:return this.primitiveMousePoint(b);case 91:return this.primitiveTestDisplayDepth(b);case 93:return this.primitiveInputSemaphore(b);case 94:return this.primitiveGetNextEvent(b);case 95:return this.primitiveInputWord(b);case 96:return this.namedPrimitive("BitBltPlugin","primitiveCopyBits",b);case 97:return this.primitiveSnapshot(b);case 99:return this.primitiveLoadImageSegment(b);case 100:return this.vm.primitivePerformWithArgs(b,!0);case 101:return this.primitiveBeCursor(b);case 102:return this.primitiveBeDisplay(b);case 103:case 104:return!1;case 105:return this.popNandPushIfOK(5,this.doStringReplace());case 106:return this.primitiveScreenSize(b);case 107:return this.primitiveMouseButtons(b);case 108:return this.primitiveKeyboardNext(b);case 109:return this.primitiveKeyboardPeek(b);case 110:return this.pop2andPushBoolIfOK(this.vm.stackValue(1)===this.vm.stackValue(0));case 111:return this.popNandPushIfOK(1,this.vm.getClass(this.vm.top()));case 112:return this.popNandPushIfOK(1,this.vm.image.bytesLeft());case 113:return this.primitiveQuit(b);case 114:return this.primitiveExitToDebugger(b);case 115:return this.primitiveChangeClass(b);case 116:return this.vm.flushMethodCacheForMethod(this.vm.top());case 117:return this.doNamedPrimitive(b,c);case 118:return this.primitiveDoPrimitiveWithArgs(b);case 119:return this.vm.flushMethodCacheForSelector(this.vm.top());case 120:return!1;case 121:return this.primitiveImageName(b);case 122:return this.primitiveReverseDisplay(b);case 124:return this.popNandPushIfOK(2,this.registerSemaphore(Squeak.splOb_TheLowSpaceSemaphore));case 125:return this.popNandPushIfOK(2,this.setLowSpaceThreshold());case 126:return this.primitiveDeferDisplayUpdates(b);case 127:return this.primitiveShowDisplayRect(b)}else if(256>a)switch(a){case 128:return this.primitiveArrayBecome(b,!0);case 129:return this.popNandPushIfOK(1,this.vm.image.specialObjectsArray);case 130:return this.primitiveFullGC(b);case 131:return this.popNandPushIfOK(1,this.vm.image.partialGC());case 132:return this.pop2andPushBoolIfOK(this.pointsTo(this.stackNonInteger(1),this.vm.top()));case 133:return!0;case 134:return this.popNandPushIfOK(2,this.registerSemaphore(Squeak.splOb_TheInterruptSemaphore));case 135:return this.popNandPushIfOK(1,this.millisecondClockValue());case 136:return this.primitiveSignalAtMilliseconds(b);case 137:return this.popNandPushIfOK(1,this.secondClock());case 138:return this.popNandPushIfOK(1,this.someObject());case 139:return this.popNandPushIfOK(1,this.nextObject(this.vm.top()));case 140:return this.primitiveBeep(b);case 141:return this.primitiveClipboardText(b);case 142:return this.popNandPushIfOK(1,this.makeStString(this.filenameToSqueak(Squeak.vmPath)));case 143:case 144:return this.primitiveShortAtAndPut(b);case 145:return this.primitiveConstantFill(b);case 146:return this.namedPrimitive("JoystickTabletPlugin","primitiveReadJoystick",b);case 147:return this.namedPrimitive("BitBltPlugin","primitiveWarpBits",b);case 148:return this.popNandPushIfOK(1,this.vm.image.clone(this.vm.top()));case 149:return this.primitiveGetAttribute(b);case 150:if(this.oldPrims)return this.primitiveFileAtEnd(b);case 151:if(this.oldPrims)return this.primitiveFileClose(b);case 152:if(this.oldPrims)return this.primitiveFileGetPosition(b);case 153:if(this.oldPrims)return this.primitiveFileOpen(b);case 154:if(this.oldPrims)return this.primitiveFileRead(b);case 155:if(this.oldPrims)return this.primitiveFileSetPosition(b);case 156:if(this.oldPrims)return this.primitiveFileDelete(b);case 157:if(this.oldPrims)return this.primitiveFileSize(b);case 158:if(this.oldPrims)return this.primitiveFileWrite(b);case 159:if(this.oldPrims)return this.primitiveFileRename(b);case 160:if(this.oldPrims)return this.primitiveDirectoryCreate(b);case 161:if(this.oldPrims)return this.primitiveDirectoryDelimitor(b);case 162:if(this.oldPrims)return this.primitiveDirectoryLookup(b);case 163:if(this.oldPrims)return this.primitiveDirectoryDelete(b);break;case 165:case 166:return this.primitiveIntegerAtAndPut(b);case 167:return!1;case 168:return this.primitiveCopyObject(b);case 169:return this.oldPrims?this.primitiveDirectorySetMacTypeAndCreator(b):this.primitiveNotIdentical(b);case 170:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundStart",b);case 171:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundStartWithSemaphore",b);case 172:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundStop",b);case 173:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundAvailableSpace",b);case 174:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundPlaySamples",b);case 175:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundPlaySilence",b);case 176:if(this.oldPrims)return this.namedPrimitive("SoundGenerationPlugin","primWaveTableSoundmixSampleCountintostartingAtpan",b);case 177:if(this.oldPrims)return this.namedPrimitive("SoundGenerationPlugin","primFMSoundmixSampleCountintostartingAtpan",b);case 178:if(this.oldPrims)return this.namedPrimitive("SoundGenerationPlugin","primPluckedSoundmixSampleCountintostartingAtpan",b);case 179:if(this.oldPrims)return this.namedPrimitive("SoundGenerationPlugin","primSampledSoundmixSampleCountintostartingAtpan",b);case 180:if(this.oldPrims)return this.namedPrimitive("SoundGenerationPlugin","primitiveMixFMSound",b);case 181:if(this.oldPrims)return this.namedPrimitive("SoundGenerationPlugin","primitiveMixPluckedSound",b);case 182:if(this.oldPrims)return this.namedPrimitive("SoundGenerationPlugin","oldprimSampledSoundmixSampleCountintostartingAtleftVolrightVol",b);case 183:if(this.oldPrims)return this.namedPrimitive("SoundGenerationPlugin","primitiveApplyReverb",b);case 184:if(this.oldPrims)return this.namedPrimitive("SoundGenerationPlugin","primitiveMixLoopedSampledSound",b);case 185:if(this.oldPrims)return this.namedPrimitive("SoundGenerationPlugin","primitiveMixSampledSound",b);break;case 188:if(!this.oldPrims)return this.primitiveExecuteMethodArgsArray(b);break;case 189:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundInsertSamples",b);case 190:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundStartRecording",b);case 191:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundStopRecording",b);case 192:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundGetRecordingSampleRate",b);case 193:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundRecordSamples",b);case 194:if(this.oldPrims)return this.namedPrimitive("SoundPlugin","primitiveSoundSetRecordLevel",b);break;case 195:case 196:case 197:case 198:case 199:return!1;case 200:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveInitializeNetwork",b):this.primitiveClosureCopyWithCopiedValues(b);case 201:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveResolverStartNameLookup",b):this.primitiveClosureValue(b);case 202:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveResolverNameLookupResult",b):this.primitiveClosureValue(b);case 203:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveResolverStartAddressLookup",b):this.primitiveClosureValue(b);case 204:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveResolverAddressLookupResult",b):this.primitiveClosureValue(b);case 205:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveResolverAbortLookup",b):this.primitiveClosureValue(b);case 206:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveResolverLocalAddress",b):this.primitiveClosureValueWithArgs(b);case 207:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveResolverStatus",b);case 208:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveResolverError",b);case 209:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketCreate",b);break;case 210:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveSocketDestroy",b):this.popNandPushIfOK(2,this.objectAt(!1,!1,!1));case 211:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveSocketConnectionStatus",b):this.popNandPushIfOK(3,this.objectAtPut(!1,!1,!1));case 212:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveSocketError",b):this.popNandPushIfOK(1,this.objectSize(!1));case 213:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketLocalAddress",b);case 214:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketLocalPort",b);case 215:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketRemoteAddress",b);case 216:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketRemotePort",b);case 217:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketConnectToPort",b);case 218:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketListenOnPort",b);case 219:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketCloseConnection",b);case 220:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketAbortConnection",b);break;case 221:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveSocketReceiveDataBufCount",b):this.primitiveClosureValueNoContextSwitch(b);case 222:return this.oldPrims?this.namedPrimitive("SocketPlugin","primitiveSocketReceiveDataAvailable",b):this.primitiveClosureValueNoContextSwitch(b);case 223:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketSendDataBufCount",b);case 224:if(this.oldPrims)return this.namedPrimitive("SocketPlugin","primitiveSocketSendDone",b);break;case 230:return this.primitiveRelinquishProcessorForMicroseconds(b);case 231:return this.primitiveForceDisplayUpdate(b);case 233:return this.primitiveSetFullScreen(b);case 234:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveDecompressFromByteArray",b);case 235:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveCompareString",b);case 236:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveConvert8BitSigned",b);case 237:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveCompressToByteArray",b);case 238:if(this.oldPrims)return this.namedPrimitive("SerialPlugin","primitiveSerialPortOpen",b);case 239:if(this.oldPrims)return this.namedPrimitive("SerialPlugin","primitiveSerialPortClose",b);break;case 240:return this.oldPrims?this.namedPrimitive("SerialPlugin","primitiveSerialPortWrite",b):this.popNandPushIfOK(1,this.microsecondClockUTC());case 241:return this.oldPrims?this.namedPrimitive("SerialPlugin","primitiveSerialPortRead",b):this.popNandPushIfOK(1,this.microsecondClockLocal());case 243:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveTranslateStringWithTable",b);case 244:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveFindFirstInString",b);case 245:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveIndexOfAsciiInString",b);case 246:if(this.oldPrims)return this.namedPrimitive("MiscPrimitivePlugin","primitiveFindSubstring",b);break;case 248:return this.vm.primitiveInvokeObjectAsMethod(b,c);case 249:return this.primitiveArrayBecome(b,!1);case 254:return this.primitiveVMParameter(b)}else switch(a){case 521:return this.namedPrimitive("MIDIPlugin","primitiveMIDIClosePort",b);case 522:return this.namedPrimitive("MIDIPlugin","primitiveMIDIGetClock",b);case 523:return this.namedPrimitive("MIDIPlugin","primitiveMIDIGetPortCount",b);case 524:return this.namedPrimitive("MIDIPlugin","primitiveMIDIGetPortDirectionality",b);case 525:return this.namedPrimitive("MIDIPlugin","primitiveMIDIGetPortName",b);case 526:return this.namedPrimitive("MIDIPlugin","primitiveMIDIOpenPort",b);case 527:return this.namedPrimitive("MIDIPlugin","primitiveMIDIParameterGetOrSet",b);case 528:return this.namedPrimitive("MIDIPlugin","primitiveMIDIRead",b);case 529:return this.namedPrimitive("MIDIPlugin","primitiveMIDIWrite",b);case 550:return this.namedPrimitive("ADPCMCodecPlugin","primitiveDecodeMono",b);case 551:return this.namedPrimitive("ADPCMCodecPlugin","primitiveDecodeStereo",b);case 552:return this.namedPrimitive("ADPCMCodecPlugin","primitiveEncodeMono",b);case 553:return this.namedPrimitive("ADPCMCodecPlugin","primitiveEncodeStereo",b);case 571:return this.primitiveUnloadModule(b);case 572:return this.primitiveListBuiltinModule(b);case 573:return this.primitiveListLoadedModule(b)}return console.error("primitive "+a+" not implemented yet"),!1},namedPrimitive:function(a,b,c){var d=""===a?this:this.loadedModules[a];void 0===d&&(d=this.loadModule(a),this.loadedModules[a]=d);var e=!1;if(d){this.interpreterProxy.argCount=c;var f=d[b];"function"==typeof f?e=d[b](c):"string"==typeof f?e=this[f](c):this.vm.warnOnce("missing primitive: "+a+"."+b)}else this.vm.warnOnce("missing module: "+a+" ("+b+")");return!0===e||!1===e?e:this.success},doNamedPrimitive:function(a,b){if(b.pointersSize()<2)return!1;var c=b.pointers[1];if(4!==c.pointersSize())return!1;this.primMethod=b;var d=c.pointers[0].bytesAsString(),e=c.pointers[1].bytesAsString();return this.namedPrimitive(d,e,a)},fakePrimitive:function(a,b,c){return this.vm.warnOnce("faking primitive: "+a),void 0===b?this.vm.popN(c):this.vm.popNandPush(c+1,this.makeStObject(b)),!0}},"modules",{loadModule:function(a){var b=Squeak.externalModules[a]||this.builtinModules[a];if(!b)return null;if(this.patchModules[a]&&this.patchModule(b,a),b.setInterpreter&&!b.setInterpreter(this.interpreterProxy))return console.log("Wrong interpreter proxy version: "+a),null;var c=b.initialiseModule;return"function"==typeof c?b.initialiseModule():"string"==typeof c&&this[c](),this.interpreterProxy.failed()?(console.log("Module initialization failed: "+a),null):(console.log("Loaded module: "+a),b)},patchModule:function(a,b){var c=this.patchModules[b];for(var d in c)a[d]=c[d]},unloadModule:function(a){var b=this.loadedModules[a];if(!a||!b||b===this)return null;delete this.loadedModules[a];var c=b.unloadModule;return"function"==typeof c?b.unloadModule(this):"string"==typeof c&&this[c](this),console.log("Unloaded module: "+a),b},loadFunctionFrom:function(a,b){var c=""===b?this:this.loadedModules[b];if(void 0===c&&(c=this.loadModule(b),this.loadedModules[b]=c),!c)return null;var d=c[a];return"function"==typeof d?d.bind(c):"string"==typeof d?this[d].bind(this):(this.vm.warnOnce("missing primitive: "+b+"."+a),null)},primitiveUnloadModule:function(a){var b=this.stackNonInteger(0).bytesAsString();return!!b&&(this.unloadModule(b),this.popNIfOK(a))},primitiveListBuiltinModule:function(a){var b=this.stackInteger(0)-1;if(!this.success)return!1;var c=Object.keys(this.builtinModules);return this.popNandPushIfOK(a+1,this.makeStObject(c[b]))},primitiveListLoadedModule:function(a){var b=this.stackInteger(0)-1;if(!this.success)return!1;var c=[];for(var d in this.loadedModules){var e=this.loadedModules[d];if(e){var f=e.getModuleName?e.getModuleName():d;c.push(f)}}return this.popNandPushIfOK(a+1,this.makeStObject(c[b]))}},"stack access",{popNIfOK:function(a){return!!this.success&&(this.vm.popN(a),!0)},pop2andPushBoolIfOK:function(a){return this.vm.success=this.success,this.vm.pop2AndPushBoolResult(a)},popNandPushIfOK:function(a,b){return!(!this.success||null==b)&&(this.vm.popNandPush(a,b),!0)},popNandPushIntIfOK:function(a,b){return!(!this.success||!this.vm.canBeSmallInt(b))&&this.popNandPushIfOK(a,b)},popNandPushFloatIfOK:function(a,b){return!!this.success&&this.popNandPushIfOK(a,this.makeFloat(b))},stackNonInteger:function(a){return this.checkNonInteger(this.vm.stackValue(a))},stackInteger:function(a){return this.checkSmallInt(this.vm.stackValue(a))},stackPos32BitInt:function(a){return this.positive32BitValueOf(this.vm.stackValue(a))},pos32BitIntFor:function(a){if(a>=0&&a<=Squeak.MaxSmallInt)return a;for(var b=this.vm.specialObjects[Squeak.splOb_ClassLargePositiveInteger],c=this.vm.instantiateClass(b,4),d=c.bytes,e=0;4>e;e++)d[e]=a>>>8*e&255;return c},pos64BitIntFor:function(a){if(4294967295>=a)return this.pos32BitIntFor(a);for(var b=0xffffffffff>=a?5:0xffffffffffff>=a?6:72057594037927940>=a?7:8,c=this.vm.specialObjects[Squeak.splOb_ClassLargePositiveInteger],d=this.vm.instantiateClass(c,b),e=d.bytes,f=0;b>f;f++)e[f]=255&a,a/=256;return d},stackSigned32BitInt:function(a){var b=this.vm.stackValue(a);if("number"==typeof b)return b;if(4!==b.bytesSize())return this.success=!1,0;for(var c=b.bytes,d=0,e=0,f=1;4>e;e++,f*=256)d+=c[e]*f;return this.isA(b,Squeak.splOb_ClassLargePositiveInteger)?d:this.isA(b,Squeak.splOb_ClassLargeNegativeInteger)?-d:(this.success=!1,0)},signed32BitIntegerFor:function(a){if(a>=Squeak.MinSmallInt&&a<=Squeak.MaxSmallInt)return a;for(var b=0>a,c=b?-a:a,d=b?Squeak.splOb_ClassLargeNegativeInteger:Squeak.splOb_ClassLargePositiveInteger,e=this.vm.instantiateClass(this.vm.specialObjects[d],4),f=e.bytes,g=0;4>g;g++)f[g]=c>>>8*g&255;return e},stackFloat:function(a){return this.checkFloat(this.vm.stackValue(a))},stackBoolean:function(a){return this.checkBoolean(this.vm.stackValue(a))},stackSigned53BitInt:function(a){var b=this.vm.stackValue(a);if("number"==typeof b)return b;var c=b.bytesSize();if(7>=c){for(var d=b.bytes,e=0,f=0,g=1;c>f;f++,g*=256)e+=d[f]*g;if(9007199254740992>e){if(this.isA(b,Squeak.splOb_ClassLargePositiveInteger))return e;if(this.isA(b,Squeak.splOb_ClassLargeNegativeInteger))return-e}}return this.success=!1,0}},"numbers",{doBitAnd:function(){var a=this.stackPos32BitInt(1),b=this.stackPos32BitInt(0);return this.success?this.pos32BitIntFor(a&b):0},doBitOr:function(){var a=this.stackPos32BitInt(1),b=this.stackPos32BitInt(0);return this.success?this.pos32BitIntFor(a|b):0},doBitXor:function(){var a=this.stackPos32BitInt(1),b=this.stackPos32BitInt(0);return this.success?this.pos32BitIntFor(a^b):0},doBitShift:function(){var a=this.stackPos32BitInt(1),b=this.stackInteger(0);return this.success?this.vm.safeShift(a,b)>0?this.pos32BitIntFor(this.vm.safeShift(a,b)):(this.success=!1,0):0},safeFDiv:function(a,b){return 0===b?(this.success=!1,1):a/b},floatAsSmallInt:function(a){var b=a>=0?Math.floor(a):Math.ceil(a);return this.ensureSmallInt(b)},frexp_exponent:function(a){if(0==a)return 0;var b=new DataView(new ArrayBuffer(8));b.setFloat64(0,a);var c=b.getUint32(0)>>>20&2047;return 0===c&&(b.setFloat64(0,a*Math.pow(2,64)),c=(b.getUint32(0)>>>20&2047)-64),c-1022},ldexp:function(a,b){return b>1023?a*Math.pow(2,1023)*Math.pow(2,b-1023):-1074>b?a*Math.pow(2,-1074)*Math.pow(2,b+1074):a*Math.pow(2,b)},primitiveLessThanLargeIntegers:function(){return this.pop2andPushBoolIfOK(this.stackSigned53BitInt(1)<this.stackSigned53BitInt(0))},primitiveGreaterThanLargeIntegers:function(){return this.pop2andPushBoolIfOK(this.stackSigned53BitInt(1)>this.stackSigned53BitInt(0))},primitiveLessOrEqualLargeIntegers:function(){return this.pop2andPushBoolIfOK(this.stackSigned53BitInt(1)<=this.stackSigned53BitInt(0))},primitiveGreaterOrEqualLargeIntegers:function(){return this.pop2andPushBoolIfOK(this.stackSigned53BitInt(1)>=this.stackSigned53BitInt(0))},primitiveEqualLargeIntegers:function(){return this.pop2andPushBoolIfOK(this.stackSigned53BitInt(1)===this.stackSigned53BitInt(0))},primitiveNotEqualLargeIntegers:function(){return this.pop2andPushBoolIfOK(this.stackSigned53BitInt(1)!==this.stackSigned53BitInt(0))}},"utils",{floatOrInt:function(a){return a.isFloat?a.float:"number"==typeof a?a:0},positive32BitValueOf:function(a){if("number"==typeof a)return a>=0?a:(this.success=!1,0);if(!this.isA(a,Squeak.splOb_ClassLargePositiveInteger)||4!==a.bytesSize())return this.success=!1,0;for(var b=a.bytes,c=0,d=0,e=1;4>d;d++,e*=256)c+=b[d]*e;return c},checkFloat:function(a){return a.isFloat?a.float:"number"==typeof a?a:(this.success=!1,0)},checkSmallInt:function(a){return"number"==typeof a?a:(this.success=!1,0)},checkNonInteger:function(a){return"number"!=typeof a?a:(this.success=!1,this.vm.nilObj)},checkBoolean:function(a){return!!a.isTrue||!a.isFalse&&(this.success=!1)},indexableSize:function(a){if("number"==typeof a)return-1;var b=a.format;return 2>b?-1:3===b&&this.vm.isContext(a)&&!this.allowAccessBeyondSP?a.pointers[Squeak.Context_stackPointer]:6>b?a.pointersSize()-a.instSize():8>b?a.wordsSize():12>b?a.bytesSize():a.bytesSize()+4*a.pointersSize()},isA:function(a,b){return a.sqClass===this.vm.specialObjects[b]},isKindOf:function(a,b){for(var c=a.sqClass,d=this.vm.specialObjects[b];!c.isNil;){if(c===d)return!0;c=c.pointers[Squeak.Class_superclass]}return!1},isAssociation:function(a){return"number"!=typeof a&&2==a.pointersSize()},ensureSmallInt:function(a){return a===(0|a)&&this.vm.canBeSmallInt(a)?a:(this.success=!1,0)},charFromInt:function(a){return this.vm.specialObjects[Squeak.splOb_CharacterTable].pointers[a]},makeFloat:function(a){var b=this.vm.specialObjects[Squeak.splOb_ClassFloat],c=this.vm.instantiateClass(b,2);return c.float=a,c},makeLargeIfNeeded:function(a){return this.vm.canBeSmallInt(a)?a:this.makeLargeInt(a)},makeLargeInt:function(a){if(0>a)throw Error("negative large ints not implemented yet");if(a>4294967295)throw Error("large large ints not implemented yet");return this.pos32BitIntFor(a)},makePointWithXandY:function(a,b){var c=this.vm.specialObjects[Squeak.splOb_ClassPoint],d=this.vm.instantiateClass(c,0);return d.pointers[Squeak.Point_x]=a,d.pointers[Squeak.Point_y]=b,d},makeStArray:function(a,b){for(var c=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassArray],a.length),d=0;d<a.length;d++)c.pointers[d]=this.makeStObject(a[d],b);return c},makeStString:function(a){for(var b=[],c=0;c<a.length;++c)b.push(255&a.charCodeAt(c));var d=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassString],b.length);return d.bytes=b,d},makeStObject:function(a,b){if(void 0===a||null===a)return this.vm.nilObj;if(!0===a)return this.vm.trueObj;if(!1===a)return this.vm.falseObj;if(a.sqClass)return a;if("number"==typeof a)return a===(0|a)?this.makeLargeIfNeeded(a):this.makeFloat(a);if(b){var c=this.vm.instantiateClass(b,0);return c.jsObject=a,c}if("string"==typeof a||a.constructor===Uint8Array)return this.makeStString(a);if(a.constructor===Array)return this.makeStArray(a);throw Error("cannot make smalltalk object")},pointsTo:function(a,b){return!!a.pointers&&a.pointers.indexOf(b)>=0},asUint8Array:function(a){if(a.constructor===Uint8Array)return a;if(a.constructor===ArrayBuffer)return new Uint8Array(a);if("string"==typeof a){for(var b=new Uint8Array(a.length),c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b}throw Error("unknown buffer type")},filenameToSqueak:function(a){var b="/"!==a[0]?"/":"",c="/SqueakJS"+b+a;return this.emulateMac&&(c=("Macintosh HD"+c).replace(/\//g,"â‚¬").replace(/:/g,"/").replace(/â‚¬/g,":")),c},filenameFromSqueak:function(a){var b=this.emulateMac?a.replace(/^[^:]*:/,":").replace(/\//g,"â‚¬").replace(/:/g,"/").replace(/â‚¬/g,":"):a;return b=b.replace(/^\/*SqueakJS\/?/,"/")}},"indexing",{objectAt:function(a,b,c){var d=this.stackNonInteger(1),e=this.stackPos32BitInt(0);if(!this.success)return d;var f;if(a){if(f=this.atCache[d.hash&this.atCacheMask],f.array!==d)return this.success=!1,d}else{if(d.isFloat){var g=d.floatData();return 1==e?this.pos32BitIntFor(g.getUint32(0,!1)):2==e?this.pos32BitIntFor(g.getUint32(4,!1)):(this.success=!1,d)}f=this.makeAtCacheInfo(this.atCache,this.vm.specialSelectors[32],d,b,c)}if(1>e||e>f.size)return this.success=!1,d;if(c)return d.pointers[e-1];if(d.format<6)return d.pointers[e-1+f.ivarOffset];if(d.format<8)return this.pos32BitIntFor(d.words[e-1]);if(d.format<12)return f.convertChars?this.charFromInt(255&d.bytes[e-1]):255&d.bytes[e-1];var h=4*d.pointersSize();return 0>e-1-h?(this.success=!1,d):255&d.bytes[e-1-h]},objectAtPut:function(a,b,c){var d=this.stackNonInteger(2),e=this.stackPos32BitInt(1);if(!this.success)return d;var f;if(a){if(f=this.atPutCache[d.hash&this.atCacheMask],f.array!==d)return this.success=!1,d}else{if(d.isFloat){var g=this.stackPos32BitInt(0);if(!this.success||1!=e&&2!=e)this.success=!1;else{var h=d.floatData();h.setUint32(1==e?0:4,g,!1),d.float=h.getFloat64(0)}return this.vm.stackValue(0)}f=this.makeAtCacheInfo(this.atPutCache,this.vm.specialSelectors[34],d,b,c)}if(1>e||e>f.size)return this.success=!1,d;var i=this.vm.stackValue(0);if(c)return d.pointers[e-1]=i;if(d.format<6)return d.pointers[e-1+f.ivarOffset]=i;var j;if(d.format<8)return j=this.stackPos32BitInt(0),this.success&&(d.words[e-1]=j),i;if(b){if(i.sqClass!==this.vm.specialObjects[Squeak.splOb_ClassCharacter])return this.success=!1,i;if("number"!=typeof(j=i.pointers[0]))return this.success=!1,i}else{if("number"!=typeof i)return this.success=!1,i;j=i}if(0>j||j>255)return this.success=!1,i;if(d.format<8)return d.bytes[e-1]=j;var k=4*d.pointersSize();return 0>e-1-k?(this.success=!1,d):(d.bytes[e-1-k]=j,i)},objectSize:function(a){var b=this.vm.stackValue(0),c=-1;return a?b.sqClass===this.vm.specialObjects[Squeak.splOb_ClassArray]?c=b.pointersSize():b.sqClass===this.vm.specialObjects[Squeak.splOb_ClassString]&&(c=b.bytesSize()):c=this.indexableSize(b),-1===c?(this.success=!1,-1):this.pos32BitIntFor(c)},initAtCache:function(){this.atCacheSize=32,this.atCacheMask=this.atCacheSize-1,this.atCache=[],this.atPutCache=[],this.nonCachedInfo={};for(var a=0;a<this.atCacheSize;a++)this.atCache.push({}),this.atPutCache.push({})},clearAtCache:function(){this.nonCachedInfo.array=null;for(var a=0;a<this.atCacheSize;a++)this.atCache[a].array=null,this.atPutCache[a].array=null},makeAtCacheInfo:function(a,b,c,d,e){var f;return f=this.vm.verifyAtSelector!==b||this.vm.verifyAtClass!==c.sqClass||3===c.format&&this.vm.isContext(c)?this.nonCachedInfo:a[c.hash&this.atCacheMask],f.array=c,f.convertChars=d,e?(f.size=c.instSize()+Math.max(0,this.indexableSize(c)),f.ivarOffset=0):(f.size=this.indexableSize(c),f.ivarOffset=c.format<6?c.instSize():0),f}},"basic",{instantiateClass:function(a,b){return 4*b>this.vm.image.bytesLeft()?(console.warn("squeak: out of memory"),this.success=!1,null):this.vm.instantiateClass(a,b)},someObject:function(){return this.vm.image.firstOldObject},nextObject:function(a){return this.vm.image.objectAfter(a)||0},someInstanceOf:function(a){var b=this.vm.image.someInstanceOf(a);return b||(this.success=!1,0)},nextInstanceAfter:function(a){var b=this.vm.image.nextInstanceAfter(a);return b||(this.success=!1,0)},primitiveFullGC:function(){this.vm.image.fullGC("primitive");var a=this.vm.image.bytesLeft();return this.popNandPushIfOK(1,this.makeLargeIfNeeded(a))},primitiveMakePoint:function(a,b){var c=this.vm.stackValue(1),d=this.vm.stackValue(0);return!(b&&(this.checkFloat(c),this.checkFloat(d),!this.success))&&(this.vm.popNandPush(1+a,this.makePointWithXandY(c,d)),!0)},primitiveStoreStackp:function(a){var b=this.stackNonInteger(1),c=this.stackInteger(0);if(!this.success||0>c||this.vm.decodeSqueakSP(c)>=b.pointers.length)return!1;for(var d=b.pointers[Squeak.Context_stackPointer];c>d;)b.pointers[this.vm.decodeSqueakSP(++d)]=this.vm.nilObj;return b.pointers[Squeak.Context_stackPointer]=c,this.vm.popN(a),!0},primitiveChangeClass:function(a){if(1!==a)return!1;var b=this.stackNonInteger(1),c=this.stackNonInteger(0);return!!this.success&&(b.format===c.format&&b.sqClass.isCompact===c.sqClass.isCompact&&b.sqClass.classInstSize()===c.sqClass.classInstSize()&&(b.sqClass=c.sqClass,this.popNIfOK(1)))},primitiveDoPrimitiveWithArgs:function(){var a=this.stackNonInteger(0),b=this.stackInteger(1);if(!this.success)return!1;var c=a.pointersSize(),d=this.vm.activeContext.pointersSize();if(this.vm.sp+c>=d)return!1;this.vm.popN(2);for(var e=0;c>e;e++)this.vm.push(a.pointers[e]);return!!this.vm.tryPrimitive(b,c)||(this.vm.popN(c),this.vm.push(b),this.vm.push(a),!1)},primitiveShortAtAndPut:function(a){var b=this.stackNonInteger(a),c=this.stackInteger(a-1)-1,d=b.wordsAsInt16Array();if(!this.success||!d||0>c||c>=d.length)return!1;var e;if(2>a)e=d[c];else{if(-32768>(e=this.stackInteger(0))||e>32767)return!1;d[c]=e}return this.popNandPushIfOK(a+1,e),!0},primitiveIntegerAtAndPut:function(a){var b=this.stackNonInteger(a),c=this.stackInteger(a-1)-1,d=b.wordsAsInt32Array();if(!this.success||!d||0>c||c>=d.length)return!1;var e;if(2>a)e=this.signed32BitIntegerFor(d[c]);else{if(e=this.stackSigned32BitInt(0),!this.success)return!1;d[c]=e}return this.popNandPushIfOK(a+1,e),!0},primitiveConstantFill:function(a){var b=this.stackNonInteger(1),c=this.stackPos32BitInt(0);if(!this.success||!b.isWordsOrBytes())return!1;var d=b.words||b.bytes;if(d){if(d===b.bytes&&c>255)return!1;for(var e=0;e<d.length;e++)d[e]=c}return this.vm.popN(a),!0},primitiveNewMethod:function(a){var b=this.stackInteger(0),c=this.stackInteger(1);if(!this.success)return 0;var d=b>>9&255,e=this.vm.instantiateClass(this.vm.stackValue(2),c);e.pointers=[b];for(var f=0;d>f;f++)e.pointers.push(this.vm.nilObj);return this.vm.popNandPush(1+a,e),this.vm.breakOnNewMethod&&(this.vm.breakOnMethod=e),!0},primitiveExecuteMethodArgsArray:function(a){var b=this.stackNonInteger(0),c=this.stackNonInteger(1),d=this.vm.stackValue(2);if(!this.success||!this.vm.isMethod(b)||a>4)return!1;var e=b.methodNumArgs();if(e!==c.pointersSize())return!1;this.vm.popNandPush(a+1,d);for(var f=0;e>f;f++)this.vm.push(c.pointers[f]);return this.vm.executeNewMethod(d,b,e,b.methodPrimitiveIndex(),null,null),!0},primitiveArrayBecome:function(a,b){var c=this.stackNonInteger(a),d=this.stackNonInteger(a-1),e=!(a>1)||this.stackBoolean(a-2);return!!this.success&&(this.success=this.vm.image.bulkBecome(c.pointers,d.pointers,b,e),this.popNIfOK(a))},doStringReplace:function(){var a=this.stackNonInteger(4),b=this.stackInteger(3)-1,c=this.stackInteger(2)-b,d=this.stackNonInteger(1),e=this.stackInteger(0)-1;if(!this.success)return a;var f=d.format,g=a.format;if(8>g){if(g!=f)return this.success=!1,a;if((12&g)!=(12&f))return this.success=!1,a}if(4>f){var h=d.pointersSize();if(0>(e+=d.instSize())||e+c>h)return this.success=!1,a;h=a.pointersSize();if(0>(b+=a.instSize())||b+c>h)return this.success=!1,a;for(var i=0;c>i;i++)a.pointers[b+i]=d.pointers[e+i];return a}if(8>f){var h=d.wordsSize();if(0>e||e+c>h)return this.success=!1,a;if(h=a.wordsSize(),0>b||b+c>h)return this.success=!1,a;for(var i=0;c>i;i++)a.words[b+i]=d.words[e+i];return a}var h=d.bytesSize();if(0>e||e+c>h)return this.success=!1,a;if(h=a.bytesSize(),0>b||b+c>h)return this.success=!1,a;for(var i=0;c>i;i++)a.bytes[b+i]=d.bytes[e+i];return a},primitiveCopyObject:function(a){var b=this.stackNonInteger(1),c=this.stackNonInteger(0),d=b.pointersSize();if(!this.success||b.isWordsOrBytes()||b.sqClass!==c.sqClass||d!==c.pointersSize())return!1;for(var e=0;d>e;e++)c.pointers[e]=b.pointers[e];return this.vm.pop(a),!0},primitiveLoadImageSegment:function(a){var b=this.stackNonInteger(1),c=this.stackNonInteger(0);if(!b.words||!c.pointers)return!1;var d=this.vm.image.loadImageSegment(b,c);return!!d&&this.popNandPushIfOK(a+1,d)}},"blocks/closures",{doBlockCopy:function(){var a=this.vm.stackValue(1),b=this.stackInteger(0),c=a;if(this.vm.isContext(c)||(this.success=!1),!this.success)return a;"number"==typeof c.pointers[Squeak.Context_method]&&(c=c.pointers[Squeak.BlockContext_home]);var d=c.pointersSize()-c.instSize(),e=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassBlockContext],d),f=this.vm.encodeSqueakPC(this.vm.pc+2,this.vm.method);return e.pointers[Squeak.BlockContext_initialIP]=f,e.pointers[Squeak.Context_instructionPointer]=f,e.pointers[Squeak.Context_stackPointer]=0,e.pointers[Squeak.BlockContext_argumentCount]=b,e.pointers[Squeak.BlockContext_home]=c,e.pointers[Squeak.Context_sender]=this.vm.nilObj,e},primitiveBlockValue:function(a){var b=this.vm.stackValue(a);if(!this.isA(b,Squeak.splOb_ClassBlockContext))return!1;var c=b,d=c.pointers[Squeak.BlockContext_argumentCount];if("number"!=typeof d)return!1;if(d!=a)return!1;if(!c.pointers[Squeak.BlockContext_caller].isNil)return!1;this.vm.arrayCopy(this.vm.activeContext.pointers,this.vm.sp-a+1,c.pointers,Squeak.Context_tempFrameStart,a);var e=c.pointers[Squeak.BlockContext_initialIP];return c.pointers[Squeak.Context_instructionPointer]=e,c.pointers[Squeak.Context_stackPointer]=a,c.pointers[Squeak.BlockContext_caller]=this.vm.activeContext,this.vm.popN(a+1),this.vm.newActiveContext(c),!0},primitiveBlockValueWithArgs:function(a){var b=this.vm.stackValue(1),c=this.vm.stackValue(0);if(!this.isA(b,Squeak.splOb_ClassBlockContext))return!1;if(!this.isA(c,Squeak.splOb_ClassArray))return!1;var d=b.pointers[Squeak.BlockContext_argumentCount];if("number"!=typeof d)return!1;if(d!=c.pointersSize())return!1;if(!b.pointers[Squeak.BlockContext_caller].isNil)return!1;this.vm.arrayCopy(c.pointers,0,b.pointers,Squeak.Context_tempFrameStart,d);var e=b.pointers[Squeak.BlockContext_initialIP];return b.pointers[Squeak.Context_instructionPointer]=e,b.pointers[Squeak.Context_stackPointer]=d,b.pointers[Squeak.BlockContext_caller]=this.vm.activeContext,this.vm.popN(a+1),this.vm.newActiveContext(b),!0},primitiveClosureCopyWithCopiedValues:function(){return this.vm.breakNow("primitiveClosureCopyWithCopiedValues"),!1},primitiveClosureValue:function(a){var b=this.vm.stackValue(a);return a===b.pointers[Squeak.Closure_numArgs]&&this.activateNewClosureMethod(b,a)},primitiveClosureValueWithArgs:function(a){var b=this.vm.top(),c=b.pointersSize(),d=this.vm.stackValue(a);if(c!==d.pointers[Squeak.Closure_numArgs])return!1;this.vm.pop();for(var e=0;c>e;e++)this.vm.push(b.pointers[e]);return this.activateNewClosureMethod(d,c)},primitiveClosureValueNoContextSwitch:function(a){return this.primitiveClosureValue(a)},activateNewClosureMethod:function(a,b){var c=a.pointers[Squeak.Closure_outerContext],d=c.pointers[Squeak.Context_method],e=this.vm.allocateOrRecycleContext(d.methodNeedsLargeFrame()),f=a.pointers.length-Squeak.Closure_firstCopiedValue;e.pointers[Squeak.Context_sender]=this.vm.activeContext,e.pointers[Squeak.Context_instructionPointer]=a.pointers[Squeak.Closure_startpc],e.pointers[Squeak.Context_stackPointer]=b+f,e.pointers[Squeak.Context_method]=c.pointers[Squeak.Context_method],e.pointers[Squeak.Context_closure]=a,e.pointers[Squeak.Context_receiver]=c.pointers[Squeak.Context_receiver];for(var g=Squeak.Context_tempFrameStart,h=0;b>h;h++)e.pointers[g++]=this.vm.stackValue(b-h-1);for(var h=0;f>h;h++)e.pointers[g++]=a.pointers[Squeak.Closure_firstCopiedValue+h];return this.vm.popN(b+1),this.vm.newActiveContext(e),!0}},"scheduling",{primitiveResume:function(){return this.resume(this.vm.top()),!0},primitiveSuspend:function(){var a=this.getScheduler().pointers[Squeak.ProcSched_activeProcess];return this.vm.top()===a&&(this.vm.popNandPush(1,this.vm.nilObj),this.transferTo(this.pickTopProcess()),!0)},getScheduler:function(){return this.vm.specialObjects[Squeak.splOb_SchedulerAssociation].pointers[Squeak.Assn_value]},resume:function(a){var b=this.getScheduler().pointers[Squeak.ProcSched_activeProcess],c=b.pointers[Squeak.Proc_priority];a.pointers[Squeak.Proc_priority]>c?(this.putToSleep(b),this.transferTo(a)):this.putToSleep(a)},putToSleep:function(a){var b=a.pointers[Squeak.Proc_priority],c=this.getScheduler().pointers[Squeak.ProcSched_processLists],d=c.pointers[b-1];this.linkProcessToList(a,d)},transferTo:function(a){var b=this.getScheduler(),c=b.pointers[Squeak.ProcSched_activeProcess];b.pointers[Squeak.ProcSched_activeProcess]=a,c.pointers[Squeak.Proc_suspendedContext]=this.vm.activeContext,this.vm.newActiveContext(a.pointers[Squeak.Proc_suspendedContext]),a.pointers[Squeak.Proc_suspendedContext]=this.vm.nilObj,this.vm.reclaimableContextCount=0,this.vm.breakOnContextChanged&&(this.vm.breakOnContextChanged=!1,this.vm.breakNow())},pickTopProcess:function(){var a,b=this.getScheduler().pointers[Squeak.ProcSched_processLists],c=b.pointersSize()-1;do{if(0>c)throw Error("scheduler could not find a runnable process");a=b.pointers[c--]}while(this.isEmptyList(a));return this.removeFirstLinkOfList(a)},linkProcessToList:function(a,b){if(this.isEmptyList(b))b.pointers[Squeak.LinkedList_firstLink]=a;else{b.pointers[Squeak.LinkedList_lastLink].pointers[Squeak.Link_nextLink]=a}b.pointers[Squeak.LinkedList_lastLink]=a,a.pointers[Squeak.Proc_myList]=b},isEmptyList:function(a){return a.pointers[Squeak.LinkedList_firstLink].isNil},removeFirstLinkOfList:function(a){var b=a.pointers[Squeak.LinkedList_firstLink];if(b===a.pointers[Squeak.LinkedList_lastLink])a.pointers[Squeak.LinkedList_firstLink]=this.vm.nilObj,a.pointers[Squeak.LinkedList_lastLink]=this.vm.nilObj;else{var c=b.pointers[Squeak.Link_nextLink];a.pointers[Squeak.LinkedList_firstLink]=c}return b.pointers[Squeak.Link_nextLink]=this.vm.nilObj,b},registerSemaphore:function(a){var b=this.vm.top();return this.vm.specialObjects[a]=this.isA(b,Squeak.splOb_ClassSemaphore)?b:this.vm.nilObj,this.vm.stackValue(1)},primitiveWait:function(){var a=this.vm.top();if(!this.isA(a,Squeak.splOb_ClassSemaphore))return!1;var b=a.pointers[Squeak.Semaphore_excessSignals];if(b>0)a.pointers[Squeak.Semaphore_excessSignals]=b-1;else{var c=this.getScheduler().pointers[Squeak.ProcSched_activeProcess];this.linkProcessToList(c,a),this.transferTo(this.pickTopProcess())}return!0},primitiveSignal:function(){var a=this.vm.top();return!!this.isA(a,Squeak.splOb_ClassSemaphore)&&(this.synchronousSignal(a),!0)},synchronousSignal:function(a){this.isEmptyList(a)?a.pointers[Squeak.Semaphore_excessSignals]++:this.resume(this.removeFirstLinkOfList(a))},primitiveSignalAtMilliseconds:function(a){var b=this.stackInteger(0),c=this.stackNonInteger(1);return this.stackNonInteger(2),!!this.success&&(this.isA(c,Squeak.splOb_ClassSemaphore)?(this.vm.specialObjects[Squeak.splOb_TheTimerSemaphore]=c,this.vm.nextWakeupTick=b):(this.vm.specialObjects[Squeak.splOb_TheTimerSemaphore]=this.vm.nilObj,this.vm.nextWakeupTick=0),this.vm.popN(a),!0)},signalSemaphoreWithIndex:function(a){this.semaphoresToSignal.push(a)},signalExternalSemaphores:function(){for(var a=this.vm.specialObjects[Squeak.splOb_ExternalObjectsArray].pointers,b=this.vm.specialObjects[Squeak.splOb_ClassSemaphore];this.semaphoresToSignal.length;){var c=this.semaphoresToSignal.shift(),d=a[c-1];d.sqClass==b&&this.synchronousSignal(d)}}},"vm functions",{primitiveGetAttribute:function(a){var b=this.stackInteger(0);if(!this.success)return!1;var c;switch(b){case 0:c=this.filenameToSqueak(Squeak.vmPath+Squeak.vmFile);break;case 1:case 2:c=this.display.documentName||null;break;case 1001:c=Squeak.platformName;break;case 1002:c=Squeak.osVersion;break;case 1003:c=Squeak.platformSubtype;break;case 1004:c=Squeak.vmVersion;break;case 1005:c=Squeak.windowSystem;break;case 1006:c=Squeak.vmBuild;break;case 1007:case 1009:c=Squeak.vmVersion;break;default:return!1}return this.vm.popNandPush(a+1,this.makeStObject(c)),!0},setLowSpaceThreshold:function(){var a=this.stackInteger(0);return this.success&&(this.vm.lowSpaceThreshold=a),this.vm.stackValue(1)},primitiveVMParameter:function(a){var b=41;switch(a){case 0:for(var c=this.vm.instantiateClass(this.vm.specialObjects[Squeak.splOb_ClassArray],b),d=0;b>d;d++)c.pointers[d]=this.makeStObject(this.vmParameterAt(d+1));return this.popNandPushIfOK(1,c);case 1:var e=this.stackInteger(0);return this.popNandPushIfOK(2,this.makeStObject(this.vmParameterAt(e)));case 2:return this.popNandPushIfOK(3,0)}return!1},vmParameterAt:function(a){switch(a){case 1:case 2:return this.vm.image.oldSpaceBytes;case 3:return this.vm.image.totalMemory;case 4:return this.vm.image.allocationCount+this.vm.image.newSpaceCount;case 7:return this.vm.image.gcCount;case 8:return this.vm.image.gcMilliseconds;case 9:return 1;case 10:return 0;case 11:return this.vm.image.gcTenured;case 40:return 4;case 41:return this.vm.image.formatVersion()}return null},primitiveImageName:function(a){return 0==a?this.popNandPushIfOK(1,this.makeStString(this.filenameToSqueak(this.vm.image.name))):(this.vm.image.name=this.filenameFromSqueak(this.vm.top().bytesAsString()),window.localStorage.squeakImageName=this.vm.image.name,!0)},primitiveSnapshot:function(){this.vm.popNandPush(1,this.vm.trueObj),this.vm.storeContextRegisters(),this.getScheduler().pointers[Squeak.ProcSched_activeProcess].pointers[Squeak.Proc_suspendedContext]=this.vm.activeContext,this.vm.image.fullGC("snapshot");var a=this.vm.image.writeToBuffer();return Squeak.flushAllFiles(),Squeak.filePut(this.vm.image.name,a),this.vm.popNandPush(1,this.vm.falseObj),!0},primitiveQuit:function(){return Squeak.flushAllFiles(),this.display.quitFlag=!0,this.vm.breakNow("quit"),!0},primitiveExitToDebugger:function(){return this.vm.breakNow("debugger primitive"),!0},primitiveSetGCBiasToGrow:function(a){return this.fakePrimitive(".primitiveSetGCBiasToGrow",0,a)},primitiveSetGCBiasToGrowGCLimit:function(a){return this.fakePrimitive(".primitiveSetGCBiasToGrowGCLimit",0,a)}},"display",{primitiveBeCursor:function(a){if(this.display.cursorCanvas){var b=this.loadForm(this.stackNonInteger(a),!0),c=1===a?this.loadForm(this.stackNonInteger(0)):null;if(!this.success||!b)return!1;var d=this.display.cursorCanvas,e=d.getContext("2d"),f={left:0,top:0,right:b.width,bottom:b.height};d.width=b.width,d.height=b.height,1===b.depth?c?(b=this.cursorMergeMask(b,c),this.showForm(e,b,f,[0,4278190335,4294967295,4278190080])):this.showForm(e,b,f,[0,4278190080]):this.showForm(e,b,f,!0);var g=this.display.context.canvas,h=g.offsetWidth/g.width;d.style.width=(d.width*h|0)+"px",d.style.height=(d.height*h|0)+"px",this.display.cursorOffsetX=b.offsetX*h|0,this.display.cursorOffsetY=b.offsetY*h|0}return this.vm.popN(a),!0},cursorMergeMask:function(a,b){for(var c=new Uint32Array(16),d=0;16>d;d++){for(var e=a.bits[d],f=b.bits[d],g=2147483648,h=0,i=0;16>i;i++)h=h|(f&g)>>i|(e&g)>>i+1,g>>>=1;c[d]=h}return{obj:a.obj,bits:c,depth:2,width:16,height:16,offsetX:a.offsetX,offsetY:a.offsetY,msb:!0,pixPerWord:16,pitch:1}},primitiveBeDisplay:function(a){var b=this.vm.stackValue(0);return this.vm.specialObjects[Squeak.splOb_TheDisplay]=b,this.vm.popN(a),!0},primitiveReverseDisplay:function(){if(this.reverseDisplay=!this.reverseDisplay,this.redrawDisplay(),this.display.cursorCanvas){for(var a=this.display.cursorCanvas,b=a.getContext("2d"),c=b.getImageData(0,0,a.width,a.height),d=new Uint32Array(c.data.buffer),e=0;e<d.length;e++)d[e]=16777215^d[e];b.putImageData(c,0,0)}return!0},primitiveShowDisplayRect:function(a){var b={left:this.stackInteger(3),top:this.stackInteger(1),right:this.stackInteger(2),bottom:this.stackInteger(0)};return!!this.success&&(this.redrawDisplay(b),this.vm.popN(a),!0)},redrawDisplay:function(a){var b=this.theDisplay(),c={left:0,top:0,right:b.width,bottom:b.height};a&&(a.left>c.left&&(c.left=a.left),a.right<c.right&&(c.right=a.right),a.top>c.top&&(c.top=a.top),a.bottom<c.bottom&&(c.bottom=a.bottom)),c.left<c.right&&c.top<c.bottom&&this.displayUpdate(b,c)},showForm:function(a,b,c,d){if(c){var e=c.left,f=c.top,g=c.right-e,h=c.bottom-f,i=a.createImageData(g,h),j=i.data;j.buffer||(j=new Uint8Array(g*h*4));var k=new Uint32Array(j.buffer);switch(b.depth){case 1:case 2:case 4:case 8:var l=d||this.swappedColors;if(!l){l=[];for(var m=0;256>m;m++){var n=this.indexedColors[m],o=(4278255360&n)+((16711680&n)>>16)+((255&n)<<16);l[m]=o}this.swappedColors=l}this.reverseDisplay&&(d?l=d.map(function(a){return 16777215^a}):(this.reversedColors||(this.reversedColors=l.map(function(a){return 16777215^a})),l=this.reversedColors));for(var p=(1<<b.depth)-1,q=32-(e%b.pixPerWord+1)*b.depth,r=0;h>r;r++){for(var s=b.pitch*f+(e/b.pixPerWord|0),t=q,u=b.bits[s],v=i.width*r,w=0;g>w;w++)k[v++]=l[u>>>t&p],(t-=b.depth)<0&&(t=32-b.depth,u=b.bits[++s]);f++}break;case 16:for(var q=e%2?0:16,r=0;h>r;r++){for(var s=b.pitch*f+(e/2|0),t=q,u=b.bits[s],v=i.width*r,w=0;g>w;w++){var x=u>>>t;k[v++]=((31744&x)>>7)+((992&x)<<6)+((31&x)<<19)+4278190080,(t-=16)<0&&(t=16,u=b.bits[++s])}f++}break;case 32:for(var y=d?0:4278190080,r=0;h>r;r++){for(var s=b.pitch*f+e,v=i.width*r,w=0;g>w;w++){var n=b.bits[s++],o=4278255360&n|(16711680&n)>>16|(255&n)<<16|y;k[v++]=o}f++}break;default:throw Error("depth not implemented")}i.data!==j&&i.data.set(j),a.putImageData(i,c.left,c.top)}},primitiveDeferDisplayUpdates:function(a){var b=this.stackBoolean(0);return!!this.success&&(this.deferDisplayUpdates=b,this.vm.popN(a),!0)},primitiveForceDisplayUpdate:function(a){return this.vm.breakOut(),this.vm.popN(a),!0},primitiveScreenSize:function(a){var b=this.display,c=b.width||b.context.canvas.width,d=b.height||b.context.canvas.height;return this.popNandPushIfOK(a+1,this.makePointWithXandY(c,d))},primitiveSetFullScreen:function(a){var b=this.stackBoolean(0);if(!this.success)return!1;if(this.display.fullscreen!=b)if(this.display.fullscreenRequest){var c=this.vm.freeze();this.display.fullscreenRequest(b,function(){c()})}else this.display.fullscreen=b,this.vm.breakOut();return this.vm.popN(a),!0},primitiveTestDisplayDepth:function(){var a=[1,2,4,8,16,32];return this.pop2andPushBoolIfOK(a.indexOf(this.stackInteger(0))>=0)},loadForm:function(a,b){if(a.isNil)return null;var c={obj:a,bits:a.pointers[Squeak.Form_bits].wordsOrBytes(),depth:a.pointers[Squeak.Form_depth],width:a.pointers[Squeak.Form_width],height:a.pointers[Squeak.Form_height]};if(b){var d=a.pointers[Squeak.Form_offset];c.offsetX=d.pointers?d.pointers[Squeak.Point_x]:0,c.offsetY=d.pointers?d.pointers[Squeak.Point_y]:0}return 0===c.width||0===c.height?c:c.width>0&&c.height>0?(c.msb=c.depth>0,c.msb||(c.depth=-c.depth),c.depth>0?(c.pixPerWord=32/c.depth,c.pitch=(c.width+(c.pixPerWord-1))/c.pixPerWord|0,c.bits.length!==c.pitch*c.height?null:c):null):null},theDisplay:function(){return this.loadForm(this.vm.specialObjects[Squeak.splOb_TheDisplay])},displayDirty:function(a,b){this.deferDisplayUpdates||a!=this.vm.specialObjects[Squeak.splOb_TheDisplay]||this.displayUpdate(this.theDisplay(),b)},displayUpdate:function(a,b){this.showForm(this.display.context,a,b),this.display.lastTick=this.vm.lastTick,this.display.idle=0},primitiveBeep:function(a){var b=Squeak.startAudioOut();if(b){var c=b.createOscillator();c.connect(b.destination),c.frequency.value=880,c.noteOn(0),c.noteOff(b.currentTime+.2)}else this.vm.warnOnce("could not initialize audio");return this.popNIfOK(a)}},"input",{primitiveClipboardText:function(a){if(0===a){if("string"!=typeof this.display.clipboardString)return!1;this.vm.popNandPush(1,this.makeStString(this.display.clipboardString))}else if(1===a){var b=this.vm.top();b.bytes&&(this.display.clipboardString=b.bytesAsString(),this.display.clipboardStringChanged=!0),this.vm.pop()}return!0},primitiveKeyboardNext:function(a){return this.popNandPushIfOK(a+1,this.ensureSmallInt(this.display.keys.shift()))},primitiveKeyboardPeek:function(a){var b=this.display.keys.length;return this.popNandPushIfOK(a+1,b?this.ensureSmallInt(this.display.keys[0]||0):this.vm.nilObj)},primitiveMouseButtons:function(a){return this.popNandPushIfOK(a+1,this.ensureSmallInt(this.display.buttons)),this.vm.breakOut(),this.display.idle++>20&&this.vm.goIdle(),!0},primitiveMousePoint:function(a){var b=this.ensureSmallInt(this.display.mouseX),c=this.ensureSmallInt(this.display.mouseY);return this.popNandPushIfOK(a+1,this.makePointWithXandY(b,c))},primitiveInputSemaphore:function(){var a=this.stackInteger(0);return!!this.success&&(this.inputEventSemaIndex=a,this.display.signalInputEvent=function(){this.signalSemaphoreWithIndex(this.inputEventSemaIndex)}.bind(this),!0)},primitiveInputWord:function(){return this.popNandPushIfOK(1,0)},primitiveGetNextEvent:function(){this.display.idle++;var a=this.stackNonInteger(0);return!!this.display.getNextEvent&&(this.display.getNextEvent(a.pointers,this.vm.startupTime),!0)}},"time",{primitiveRelinquishProcessorForMicroseconds:function(a){return this.vm.pop(a),this.vm.goIdle(),!0},millisecondClockValue:function(){return Date.now()-this.vm.startupTime&Squeak.MillisecondClockMask},millisecondClockValueSet:function(a){this.vm.startupTime=Date.now()-a},secondClock:function(){return this.pos32BitIntFor(Squeak.totalSeconds())},microsecondClockUTC:function(){var a=Date.now()-Squeak.EpochUTC;return this.pos64BitIntFor(1e3*a)},microsecondClockLocal:function(){var a=Date.now()-Squeak.Epoch;return this.pos64BitIntFor(1e3*a)}},"FilePlugin",{primitiveDirectoryCreate:function(a){var b=this.stackNonInteger(0);if(!this.success)return!1;var c=this.filenameFromSqueak(b.bytesAsString());if(this.success=Squeak.dirCreate(c),!this.success){var d=Squeak.splitFilePath(c);console.log("Directory not created: "+d.fullname)}return this.popNIfOK(a)},primitiveDirectoryDelete:function(a){var b=this.stackNonInteger(0);if(!this.success)return!1;var c=this.filenameFromSqueak(b.bytesAsString());return this.success=Squeak.dirDelete(c),this.popNIfOK(a)},primitiveDirectoryDelimitor:function(){var a=this.emulateMac?":":"/";return this.popNandPushIfOK(1,this.charFromInt(a.charCodeAt(0)))},primitiveDirectoryEntry:function(){return this.vm.warnOnce("Not yet implemented: primitiveDirectoryEntry"),!1},primitiveDirectoryLookup:function(a){var b=this.stackInteger(0),c=this.stackNonInteger(1);if(!this.success)return!1;var d=c.bytesAsString(),e=this.filenameFromSqueak(d),f=Squeak.dirList(e,!0);if(!f){var g=Squeak.splitFilePath(e);return console.log("Directory not found: "+g.fullname),!1}var h=Object.keys(f).sort(),i=f[h[b-1]];return"/"===d&&(1===b?(i||(i=[0,0,0,0,0]),i[0]="SqueakJS",i[3]=!0):i=null),this.popNandPushIfOK(a+1,this.makeStObject(i)),!0},primitiveDirectorySetMacTypeAndCreator:function(a){return this.popNIfOK(a)},primitiveFileAtEnd:function(a){var b=this.stackNonInteger(0);return!(!this.success||!b.file)&&(this.popNandPushIfOK(a+1,this.makeStObject(b.filePos>=b.file.size)),!0)},primitiveFileClose:function(a){var b=this.stackNonInteger(0);return!(!this.success||!b.file)&&(this.fileClose(b.file),this.vm.breakOut(),b.file=null,this.popNIfOK(a))},primitiveFileDelete:function(a){var b=this.stackNonInteger(0);if(!this.success)return!1;var c=this.filenameFromSqueak(b.bytesAsString());return this.success=Squeak.fileDelete(c),this.popNIfOK(a)},primitiveFileFlush:function(a){var b=this.stackNonInteger(0);return!(!this.success||!b.file)&&(Squeak.flushFile(b.file),this.vm.breakOut(),this.popNIfOK(a))},primitiveFileGetPosition:function(a){var b=this.stackNonInteger(0);return!(!this.success||!b.file)&&(this.popNandPushIfOK(a+1,this.makeLargeIfNeeded(b.filePos)),!0)},primitiveFileOpen:function(a){var b=this.stackBoolean(0),c=this.stackNonInteger(1);if(!this.success)return!1;var d=this.filenameFromSqueak(c.bytesAsString()),e=this.fileOpen(d,b);if(!e)return!1;var f=this.makeStArray([e.name]);return f.file=e,f.fileWrite=b,f.filePos=0,this.popNandPushIfOK(a+1,f),!0},primitiveFileRead:function(a){var b=this.stackInteger(0),c=this.stackInteger(1)-1,d=this.stackNonInteger(2),e=this.stackNonInteger(3);return!(!this.success||!e.file)&&(b?d.bytes?!(0>c||c+b>d.bytes.length)&&this.fileContentsDo(e.file,function(f){if(!f.contents)return this.popNandPushIfOK(a+1,0);var g=f.contents,h=d.bytes;b=Math.min(b,f.size-e.filePos);for(var i=0;b>i;i++)h[c+i]=g[e.filePos++];this.popNandPushIfOK(a+1,b)}.bind(this)):(console.log("File reading into non-bytes object not implemented yet"),!1):this.popNandPushIfOK(a+1,0))},primitiveFileRename:function(a){var b=this.stackNonInteger(1),c=this.stackNonInteger(0);if(!this.success)return!1;var d=this.filenameFromSqueak(b.bytesAsString()),e=this.filenameFromSqueak(c.bytesAsString());return this.success=Squeak.fileRename(d,e),this.vm.breakOut(),this.popNIfOK(a)},primitiveFileSetPosition:function(a){var b=this.stackPos32BitInt(0),c=this.stackNonInteger(1);return!(!this.success||!c.file)&&(c.filePos=b,this.popNIfOK(a))},primitiveFileSize:function(a){var b=this.stackNonInteger(0);return!(!this.success||!b.file)&&(this.popNandPushIfOK(a+1,this.makeLargeIfNeeded(b.file.size)),!0)},primitiveFileStdioHandles:function(){return this.vm.warnOnce("Not yet implemented: primitiveFileStdioHandles"),!1},primitiveFileTruncate:function(){return console.warn("Not yet implemented: primitiveFileTruncate"),!1},primitiveDisableFileAccess:function(a){return this.fakePrimitive("FilePlugin.primitiveDisableFileAccess",0,a)},primitiveFileWrite:function(a){var b=this.stackInteger(0),c=this.stackInteger(1)-1,d=this.stackNonInteger(2),e=this.stackNonInteger(3);if(!this.success||!e.file||!e.fileWrite)return!1;if(!b)return this.popNandPushIfOK(a+1,0);var f=d.bytes||d.wordsAsUint8Array();return!!f&&(!(0>c||c+b>f.length)&&this.fileContentsDo(e.file,function(d){var g=f,h=d.contents||[];if(e.filePos+b>h.length){var i=0===h.length?e.filePos+b:Math.max(e.filePos+b,h.length+1e4);d.contents=new Uint8Array(i),d.contents.set(h),h=d.contents}for(var j=0;b>j;j++)h[e.filePos++]=g[c+j];e.filePos>d.size&&(d.size=e.filePos),d.modified=!0,this.popNandPushIfOK(a+1,b)}.bind(this)))},fileOpen:function(a,b){"undefined"==typeof SqueakFiles&&(window.SqueakFiles={});var c=Squeak.splitFilePath(a);if(!c.basename)return null;var d=Squeak.dirList(c.dirname,!0);if(!d)return null;var e=d[c.basename],f=null;if(e){var g=SqueakFiles[c.fullname];if(g)return++g.refCount,g}else{if(!b)return console.log("File not found: "+c.fullname),null;if(f=new Uint8Array,!(e=Squeak.filePut(c.fullname,f.buffer)))return console.log("Cannot create file: "+c.fullname),null}var g={name:c.fullname,size:e[4],contents:f,modified:!1,refCount:1};return SqueakFiles[g.name]=g,g},fileClose:function(a){Squeak.flushFile(a),0==--a.refCount&&delete SqueakFiles[a.name]},fileContentsDo:function(a,b){if(a.contents)b(a);else{if(!1===a.contents)return!1;this.vm.freeze(function(c){Squeak.fileGet(a.name,function(d){a.contents=this.asUint8Array(d),c(),b(a)}.bind(this),function(d){console.log("File get failed: "+d),a.contents=!1,c(),b(a)}.bind(this))}.bind(this))}return!0}},"DropPlugin",{primitiveDropRequestFileHandle:function(a){var b=this.stackInteger(0),c=this.display.droppedFiles||[];if(1>b||b>c.length)return!1;var d=c[b-1],e=this.fileOpen(d,!1);if(!e)return!1;var f=this.makeStArray([d]);return f.file=e,f.fileWrite=!1,f.filePos=0,this.popNandPushIfOK(a+1,f),!0},primitiveDropRequestFileName:function(a){var b=this.stackInteger(0),c=this.display.droppedFiles||[];if(1>b||b>c.length)return!1;var d=this.makeStString(this.filenameToSqueak(c[b-1]));return this.popNandPushIfOK(a,d)}},"SoundPlugin",{snd_primitiveSoundStart:function(a){return this.snd_primitiveSoundStartWithSemaphore(a)},snd_primitiveSoundStartWithSemaphore:function(a){var b=this.stackInteger(a-1),c=this.stackInteger(a-2),d=this.stackBoolean(a-3),e=a>3?this.stackInteger(a-4):0;return!!this.success&&(this.audioContext=Squeak.startAudioOut(),this.audioContext?(this.audioSema=e,this.audioNextTimeSlot=0,this.audioBuffersReady=[],this.audioBuffersUnused=[this.audioContext.createBuffer(d?2:1,b,c),this.audioContext.createBuffer(d?2:1,b,c)],console.log("sound: started"),this.popNIfOK(a)):(this.vm.warnOnce("could not initialize audio"),!1))},snd_playNextBuffer:function(){if(this.audioContext&&0!==this.audioBuffersReady.length){var a=this.audioContext.createBufferSource();a.buffer=this.audioBuffersReady.shift(),a.connect(this.audioContext.destination),this.audioNextTimeSlot<this.audioContext.currentTime&&(this.audioNextTimeSlot>0&&console.warn("sound "+this.audioContext.currentTime.toFixed(3)+": buffer underrun by "+(this.audioContext.currentTime-this.audioNextTimeSlot).toFixed(3)+" s"),this.audioNextTimeSlot=this.audioContext.currentTime),a.start(this.audioNextTimeSlot),this.audioNextTimeSlot+=a.buffer.duration,window.setTimeout(function(){this.audioContext&&(this.audioBuffersUnused.push(a.buffer),this.audioSema&&this.signalSemaphoreWithIndex(this.audioSema),this.vm.forceInterruptCheck())}.bind(this),1e3*(this.audioNextTimeSlot-this.audioContext.currentTime)),this.snd_playNextBuffer()}},snd_primitiveSoundAvailableSpace:function(a){if(!this.audioContext)return console.log("sound: no audio context"),!1;var b=0;if(this.audioBuffersUnused.length>0){var c=this.audioBuffersUnused[0];b=c.length*c.numberOfChannels*2}return this.popNandPushIfOK(a+1,b)},snd_primitiveSoundPlaySamples:function(a){if(!this.audioContext||0===this.audioBuffersUnused.length)return console.log("sound: play but no free buffers"),!1;var b=this.stackInteger(2),c=this.stackNonInteger(1).wordsAsInt16Array(),d=this.stackInteger(0)-1;if(!this.success||!c)return!1;for(var e=this.audioBuffersUnused.shift(),f=e.numberOfChannels,g=0;f>g;g++)for(var h=e.getChannelData(g),i=d+g,j=0;b>j;j++)h[j]=c[i]/32768,i+=f;return this.audioBuffersReady.push(e),this.snd_playNextBuffer(),this.popNIfOK(a)},snd_primitiveSoundPlaySilence:function(a){if(!this.audioContext||0===this.audioBuffersUnused.length)return console.log("sound: play but no free buffers"),!1;for(var b=this.audioBuffersUnused.shift(),c=b.numberOfChannels,d=b.length,e=0;c>e;e++)for(var f=b.getChannelData(e),g=0;d>g;g++)f[g]=0;return this.audioBuffersReady.push(b),this.snd_playNextBuffer(),this.popNandPushIfOK(a+1,d)},snd_primitiveSoundStop:function(a){return this.audioContext&&(this.audioContext=null,this.audioBuffersReady=null,this.audioBuffersUnused=null,this.audioNextTimeSlot=0,this.audioSema=0,console.log("sound: stopped")),this.popNIfOK(a)},snd_primitiveSoundStartRecording:function(a){if(3!==a)return!1;var b=this.stackNonInteger(3),c=this.stackInteger(2),d=this.stackBoolean(1),e=this.stackInteger(0);if(!this.success)return!1;var f=this.primMethod,g=this.vm.freeze(),h=this;return Squeak.startAudioIn(function(b,f){for(console.log("sound: recording started"),h.audioInContext=b,h.audioInSource=f,h.audioInSema=e,h.audioInBuffers=[],h.audioInBufferIndex=0,h.audioInOverSample=1;c*h.audioInOverSample<h.audioInContext.sampleRate;)h.audioInOverSample*=2;for(var i=1024*h.audioInOverSample;i/h.audioInContext.sampleRate<.1;)i*=2;h.audioInProcessor=b.createScriptProcessor(i,d?2:1,d?2:1),h.audioInProcessor.onaudioprocess=function(a){h.snd_recordNextBuffer(a.inputBuffer)},h.audioInSource.connect(h.audioInProcessor),h.audioInProcessor.connect(b.destination),h.vm.popN(a),window.setTimeout(g,0)},function(c){console.warn(c),h.vm.sendAsPrimitiveFailure(b,f,a),window.setTimeout(g,0)}),!0},snd_recordNextBuffer:function(a){this.audioInContext&&(this.audioInBuffers.length>5&&this.audioInBuffers.shift(),this.audioInBuffers.push(a),this.audioInSema&&this.signalSemaphoreWithIndex(this.audioInSema),this.vm.forceInterruptCheck())},snd_primitiveSoundGetRecordingSampleRate:function(a){if(!this.audioInContext)return!1;var b=this.audioInContext.sampleRate/this.audioInOverSample|0;return console.log("sound: actual recording rate "+b+"x"+this.audioInOverSample),this.popNandPushIfOK(a+1,b)},snd_primitiveSoundRecordSamples:function(a){var b=this.stackNonInteger(1).wordsAsInt16Array(),c=this.stackInteger(0)-1;if(!this.success)return!1;for(var d=0;c<b.length&&0!==this.audioInBuffers.length;){for(var e=this.audioInBuffers[0],f=e.numberOfChannels,g=f,h=this.audioInOverSample,i=(b.length-c)/g,j=(e.length-this.audioInBufferIndex)/h,k=Math.min(j,i),l=0;f>l;l++)for(var m=e.getChannelData(l),n=this.audioInBufferIndex,o=c+l,p=0;k>p;p++)b[o]=32768*m[n]&65535,o+=g,n+=h;d+=k*f,c+=k*f,n<e.length?this.audioInBufferIndex=n:(this.audioInBufferIndex=0,this.audioInBuffers.shift())}return this.popNandPushIfOK(a+1,d)},snd_primitiveSoundStopRecording:function(){return this.audioInContext&&(this.audioInSource.disconnect(),this.audioInProcessor.disconnect(),this.audioInContext=null,this.audioInSema=0,this.audioInBuffers=null,this.audioInSource=null,this.audioInProcessor=null,console.log("sound recording stopped")),!0},snd_primitiveSoundSetRecordLevel:function(){return!0}},"JPEGReadWriter2Plugin",{jpeg2_primJPEGPluginIsPresent:function(a){return this.popNandPushIfOK(a+1,this.vm.trueObj)},jpeg2_primImageHeight:function(a){var b=this.stackNonInteger(0).wordsOrBytes();if(!b)return!1;var c=b[1];return this.popNandPushIfOK(a+1,c)},jpeg2_primImageWidth:function(a){var b=this.stackNonInteger(0).wordsOrBytes();if(!b)return!1;var c=b[0];return this.popNandPushIfOK(a+1,c)},jpeg2_primJPEGCompressStructSize:function(a){return this.popNandPushIfOK(a+1,0)},jpeg2_primJPEGDecompressStructSize:function(a){return this.popNandPushIfOK(a+1,8)},jpeg2_primJPEGErrorMgr2StructSize:function(a){return this.popNandPushIfOK(a+1,0)},jpeg2_primJPEGReadHeaderfromByteArrayerrorMgr:function(a){var b=this.stackNonInteger(2).wordsOrBytes(),c=this.stackNonInteger(1).bytes;if(!b||!c)return!1;var d=this.vm.freeze();return this.jpeg2_readImageFromBytes(c,function(a){this.jpeg2state={src:c,img:a},b[0]=a.width,b[1]=a.height,d()}.bind(this),function(){b[0]=0,b[1]=0,d()}.bind(this)),this.popNIfOK(a)},jpeg2_primJPEGReadImagefromByteArrayonFormdoDitheringerrorMgr:function(a){var b=this.stackNonInteger(3).bytes,c=this.stackNonInteger(2).pointers,d=this.stackBoolean(1);if(!this.success||!b||!c)return!1;var e=this.jpeg2state;if(!e||e.src!==b)return console.error("jpeg read did not match header info"),!1;var f=c[Squeak.Form_depth],g=this.jpeg2_getPixelsFromImage(e.img),h=c[Squeak.Form_bits].words;if(32===f)this.jpeg2_copyPixelsToForm32(g,h);else{if(16!==f)return!1;d?this.jpeg2_ditherPixelsToForm16(g,h):this.jpeg2_copyPixelsToForm16(g,h)}return this.popNIfOK(a)},jpeg2_primJPEGWriteImageonByteArrayformqualityprogressiveJPEGerrorMgr:function(){return this.vm.warnOnce("JPEGReadWritePlugin2: writing not implemented yet"),!1},jpeg2_readImageFromBytes:function(a,b,c){var d=new Blob([a],{type:"image/jpeg"}),e=new Image;e.onload=function(){b(e)},e.onerror=function(){console.warn("could not render JPEG"),c()},e.src=(window.URL||window.webkitURL).createObjectURL(d)},jpeg2_getPixelsFromImage:function(a){var b=document.createElement("canvas"),c=b.getContext("2d");return b.width=a.width,b.height=a.height,c.drawImage(a,0,0),c.getImageData(0,0,a.width,a.height)},jpeg2_copyPixelsToForm32:function(a,b){for(var c=a.data,d=0;d<b.length;d++){var e=c[4*d+0],f=c[4*d+1],g=c[4*d+2];b[d]=4278190080|e<<16|f<<8|g}},jpeg2_copyPixelsToForm16:function(a,b){for(var c=a.width,d=a.height,e=a.data,f=0;d>f;f++)for(var g=0;c>g;g+=2){var h=f*d+g,i=e[4*h+0]>>3,j=e[4*h+1]>>3,k=e[4*h+2]>>3,l=e[4*h+4]>>3,m=e[4*h+5]>>3,n=e[4*h+6]>>3,o=i<<10|j<<5|k;0===o&&(o=1),o=o<<16|l<<10|m<<5|n,0==(65535&o)&&(o|=1),b[h>>1]=o}},jpeg2_ditherPixelsToForm16:function(a,b){for(var c=a.width>>1,d=a.height,e=a.data,f=[2,0,14,12,1,3,13,15],g=[10,8,6,4,9,11,5,7],h=0;d>h;h++)for(var i=0;c>i;i++){var j,k,l,m=h*d+2*i<<2,n=e[m+0],o=e[m+1],p=e[m+2],q=e[m+4],r=e[m+5],s=e[m+6],t=(3&h)<<1|1&i,u=f[t],v=g[t];j=496*n>>8,k=15&j,l=j>>4,n=k>u?l+1:l,j=496*o>>8,k=15&j,l=j>>4,o=k>u?l+1:l,j=496*p>>8,k=15&j,l=j>>4,p=k>u?l+1:l,j=496*q>>8,k=15&j,l=j>>4,q=k>v?l+1:l,j=496*r>>8,k=15&j,l=j>>4,r=k>v?l+1:l,j=496*s>>8,k=15&j,l=j>>4,s=k>v?l+1:l;var w=n<<10|o<<5|p;0===w&&(w=1),w=w<<16|q<<10|r<<5|s,0==(65535&w)&&(w|=1),b[m>>3]=w}}},"ScratchPluginAdditions",{scratch_primitiveOpenURL:function(b){var c=this.stackNonInteger(0).bytesAsString();if(""==c)return!1;if(/^\/SqueakJS\//.test(c)){c=c.slice(10);var d=Squeak.splitFilePath(c),e=a["squeak-template:"+d.dirname];e&&(c=JSON.parse(e).url+"/"+d.basename)}return window.open(c,"_blank"),this.popNIfOK(b)},scratch_primitiveGetFolderPath:function(a){var b=this.stackInteger(0);if(!this.success)return!1;var c;switch(b){case 1:c="/"}return!!c&&(this.vm.popNandPush(a+1,this.makeStString(this.filenameToSqueak(c))),!0)}},"JavaScriptPlugin",{js_primitiveDoUnderstand:function(a){var b=this.stackNonInteger(1),c=this.js_objectOrGlobal(b),d=this.stackNonInteger(0).pointers,e=d[0].bytesAsString(),f=d[1].pointers||[],g=!("jsObject"in b),h=null;try{this.js_activeCallback="Callbacks must be asynchronous";var i=e.match(/([^:]*)/)[0];if(g||"new"!==i){if(!(i in c))return this.js_setError("Property not found: "+i);var j=c[i];if("function"==typeof j&&(!g||f.length>0))h=j.apply(c,this.js_fromStArray(f));else if(0==f.length)h=j;else{if(1!=f.length)return this.js_setError("Property "+i+" is not a function");c[i]=this.js_fromStObject(f[0])}}else if(0===f.length)h=new c;else{var k=[null].concat(this.js_fromStArray(f));h=new(Function.prototype.bind.apply(c,k))}}catch(a){return this.js_setError(a.message)}finally{this.js_activeCallback=null}var l=this.makeStObject(h,b.sqClass);return this.popNandPushIfOK(a+1,l)},js_primitiveAsString:function(a){var b=this.js_objectOrGlobal(this.stackNonInteger(0));return this.popNandPushIfOK(a+1,this.makeStString(String(b)))},js_primitiveTypeof:function(a){var b=this.js_objectOrGlobal(this.stackNonInteger(0));return this.popNandPushIfOK(a+1,this.makeStString(typeof b))},js_primitiveAt:function(a){var b,c=this.stackNonInteger(1),d=this.vm.stackValue(0);try{var e=this.js_objectOrGlobal(c),f=this.js_fromStObject(d),g=e[f];b=this.makeStObject(g,c.sqClass)}catch(a){return this.js_setError(a.message)}return this.popNandPushIfOK(a+1,b)},js_primitiveAtPut:function(a){var b=this.stackNonInteger(2),c=this.vm.stackValue(1),d=this.vm.stackValue(0);try{var e=this.js_objectOrGlobal(b),f=this.js_fromStObject(c),g=this.js_fromStObject(d);e[f]=g}catch(a){return this.js_setError(a.message)}return this.popNandPushIfOK(a+1,d)},js_primitiveSqueakAsJSObject:function(a){var b=this.stackNonInteger(1),c=this.vm.stackValue(0);return this.success&&(b.jsObject=c),this.popNIfOK(a)},js_primitiveInitCallbacks:function(a){return this.js_callbackSema=this.stackInteger(0),this.js_activeCallback=null,this.popNIfOK(a)},js_primitiveGetActiveCallbackBlock:function(a){var b=this.js_activeCallback;return b?this.popNandPushIfOK(a,b.block):this.js_setError("No active callback")},js_primitiveGetActiveCallbackArgs:function(a){var b=this.stackNonInteger(a),c=this.js_activeCallback;if(!c)return this.js_setError("No active callback");try{var d=c.block.pointers[Squeak.BlockContext_argumentCount],e=[];"number"!=typeof d&&(d=c.block.pointers[Squeak.Closure_numArgs]);for(var f=0;d>f;f++)e.push(c.args[f]);return this.popNandPushIfOK(a,this.makeStArray(e,b))}catch(a){return this.js_setError(a.message)}},js_primitiveReturnFromCallback:function(a){return 1===a&&(this.js_activeCallback?(this.js_activeCallback.result=this.vm.pop(),this.vm.breakOut(),!0):this.js_setError("No active callback"))},js_primitiveGetError:function(a){var b=this.makeStObject(this.js_error);return this.js_error=null,this.popNandPushIfOK(a+1,b)},js_setError:function(a){return this.js_error=String(a),!1},js_fromStObject:function(a){if("number"==typeof a)return a;if(a.jsObject)return a.jsObject;if(a.isFloat)return a.float;if(a.isNil)return null;if(a.isTrue)return!0;if(a.isFalse)return!1;if(a.bytes||a.sqClass===this.vm.specialObjects[Squeak.splOb_ClassString])return a.bytesAsString();if(a.sqClass===this.vm.specialObjects[Squeak.splOb_ClassArray])return this.js_fromStArray(a.pointers||[],!0);if(a.sqClass===this.vm.specialObjects[Squeak.splOb_ClassBlockContext]||a.sqClass===this.vm.specialObjects[Squeak.splOb_ClassBlockClosure])return this.js_fromStBlock(a);throw Error("asJSArgument needed for "+a)},js_fromStArray:function(a,b){if(a.length>0&&b&&this.isAssociation(a[0]))return this.js_fromStDict(a);for(var c=[],d=0;d<a.length;d++)c.push(this.js_fromStObject(a[d]));return c},js_fromStDict:function(a){for(var b={},c=0;c<a.length;c++){var d=a[c].pointers;if(!d||2!==d.length)throw Error(d+" is not an Association");var e=this.js_fromStObject(d[0]),f=this.js_fromStObject(d[1]);b[e]=f}return b},js_fromStBlock:function(a){if(!this.js_callbackSema)throw Error("CallbackSemaphore not set");this.vm.reclaimableContextCount=0;var b=this;return function(){return b.js_executeCallback(a,arguments)}},js_executeCallback:function(a,b){if(this.js_activeCallback){if("string"==typeof this.js_activeCallback)throw Error(this.js_activeCallback);return console.error("Callback: already active")}this.js_activeCallback={block:a,args:b,result:null},this.signalSemaphoreWithIndex(this.js_callbackSema),this.vm.forceInterruptCheck();for(var c=Date.now()+500;Date.now()<c&&!this.js_activeCallback.result;)this.vm.interpret();var d=this.js_activeCallback.result;if(this.js_activeCallback=null,d)try{return this.js_fromStObject(d)}catch(a){return d.toString()}else console.error("Callback error: "+(this.vm.frozen?"frozen":"timeout"))},js_objectOrGlobal:function(a){return"jsObject"in a?a.jsObject:window}},"Obsolete",{primitiveFloatArrayAt:function(a){return this.namedPrimitive("FloatArrayPlugin","primitiveAt",a)},primitiveFloatArrayMulFloatArray:function(a){return this.namedPrimitive("FloatArrayPlugin","primitiveMulFloatArray",a)},primitiveFloatArrayAddScalar:function(a){return this.namedPrimitive("FloatArrayPlugin","primitiveAddScalar",a)},primitiveFloatArrayDivFloatArray:function(a){return this.namedPrimitive("FloatArrayPlugin","primitiveDivFloatArray",a)},primitiveFloatArrayDivScalar:function(a){return this.namedPrimitive("FloatArrayPlugin","primitiveDivScalar",a)},primitiveFloatArrayHash:function(a){return this.namedPrimitive("FloatArrayPlugin","primitiveHash",a)},primitiveFloatArrayAtPut:function(a){return this.namedPrimitive("FloatArrayPlugin","primitiveAtPut",a)},primitiveFloatArrayMulScalar:function(a){return this.namedPrimitive("FloatArrayPlugin","primitiveMulScalar",a)},primitiveFloatArrayAddFloatArray:function(a){return this.namedPrimitive("FloatArrayPlugin","primitiveAddFloatArray",a)},primitiveFloatArraySubScalar:function(a){return this.namedPrimitive("FloatArrayPlugin","primitiveSubScalar",a)},primitiveFloatArraySubFloatArray:function(a){return this.namedPrimitive("FloatArrayPlugin","primitiveSubFloatArray",a)},primitiveFloatArrayEqual:function(a){return this.namedPrimitive("FloatArrayPlugin","primitiveEqual",a)},primitiveFloatArrayDotProduct:function(a){return this.namedPrimitive("FloatArrayPlugin","primitiveDotProduct",a)},m23PrimitiveInvertRectInto:function(a){return this.namedPrimitive("Matrix2x3Plugin","primitiveInvertRectInto",a)},m23PrimitiveTransformPoint:function(a){return this.namedPrimitive("Matrix2x3Plugin","primitiveTransformPoint",a)},m23PrimitiveIsPureTranslation:function(a){return this.namedPrimitive("Matrix2x3Plugin","primitiveIsPureTranslation",a)},m23PrimitiveComposeMatrix:function(a){return this.namedPrimitive("Matrix2x3Plugin","primitiveComposeMatrix",a)},m23PrimitiveTransformRectInto:function(a){return this.namedPrimitive("Matrix2x3Plugin","primitiveTransformRectInto",a)},m23PrimitiveIsIdentity:function(a){return this.namedPrimitive("Matrix2x3Plugin","primitiveIsIdentity",a)},m23PrimitiveInvertPoint:function(a){return this.namedPrimitive("Matrix2x3Plugin","primitiveInvertPoint",a)},primitiveDeflateBlock:function(a){return this.namedPrimitive("ZipPlugin","primitiveDeflateBlock",a)},primitiveDeflateUpdateHashTable:function(a){return this.namedPrimitive("ZipPlugin","primitiveDeflateUpdateHashTable",a)},primitiveUpdateGZipCrc32:function(a){return this.namedPrimitive("ZipPlugin","primitiveUpdateGZipCrc32",a)},primitiveInflateDecompressBlock:function(a){return this.namedPrimitive("ZipPlugin","primitiveInflateDecompressBlock",a)},primitiveZipSendBlock:function(a){return this.namedPrimitive("ZipPlugin","primitiveZipSendBlock",a)},primitiveFFTTransformData:function(a){return this.namedPrimitive("FFTPlugin","primitiveFFTTransformData",a)},primitiveFFTScaleData:function(a){return this.namedPrimitive("FFTPlugin","primitiveFFTScaleData",a)},primitiveFFTPermuteData:function(a){return this.namedPrimitive("FFTPlugin","primitiveFFTPermuteData",a)},gePrimitiveMergeFillFrom:function(a){return this.namedPrimitive("B2DPlugin","primitiveMergeFillFrom",a)},gePrimitiveCopyBuffer:function(a){return this.namedPrimitive("B2DPlugin","primitiveCopyBuffer",a)},gePrimitiveAddRect:function(a){return this.namedPrimitive("B2DPlugin","primitiveAddRect",a)},gePrimitiveAddGradientFill:function(a){return this.namedPrimitive("B2DPlugin","primitiveAddGradientFill",a)},gePrimitiveSetClipRect:function(a){return this.namedPrimitive("B2DPlugin","primitiveSetClipRect",a)},gePrimitiveSetBitBltPlugin:function(a){return this.namedPrimitive("B2DPlugin","primitiveSetBitBltPlugin",a)},gePrimitiveRegisterExternalEdge:function(a){return this.namedPrimitive("B2DPlugin","primitiveRegisterExternalEdge",a)},gePrimitiveGetClipRect:function(a){return this.namedPrimitive("B2DPlugin","primitiveGetClipRect",a)},gePrimitiveAddBezier:function(a){return this.namedPrimitive("B2DPlugin","primitiveAddBezier",a)},gePrimitiveInitializeProcessing:function(a){return this.namedPrimitive("B2DPlugin","primitiveInitializeProcessing",a)},gePrimitiveRenderImage:function(a){return this.namedPrimitive("B2DPlugin","primitiveRenderImage",a)},gePrimitiveGetOffset:function(a){return this.namedPrimitive("B2DPlugin","primitiveGetOffset",a)},gePrimitiveSetDepth:function(a){return this.namedPrimitive("B2DPlugin","primitiveSetDepth",a)},gePrimitiveAddBezierShape:function(a){return this.namedPrimitive("B2DPlugin","primitiveAddBezierShape",a)},gePrimitiveSetEdgeTransform:function(a){return this.namedPrimitive("B2DPlugin","primitiveSetEdgeTransform",a)},gePrimitiveGetTimes:function(a){return this.namedPrimitive("B2DPlugin","primitiveGetTimes",a)},gePrimitiveNextActiveEdgeEntry:function(a){return this.namedPrimitive("B2DPlugin","primitiveNextActiveEdgeEntry",a)},gePrimitiveAddBitmapFill:function(a){return this.namedPrimitive("B2DPlugin","primitiveAddBitmapFill",a)},gePrimitiveGetDepth:function(a){return this.namedPrimitive("B2DPlugin","primitiveGetDepth",a)},gePrimitiveAbortProcessing:function(a){return this.namedPrimitive("B2DPlugin","primitiveAbortProcessing",a)},gePrimitiveNextGlobalEdgeEntry:function(a){return this.namedPrimitive("B2DPlugin","primitiveNextGlobalEdgeEntry",a)},gePrimitiveGetFailureReason:function(a){return this.namedPrimitive("B2DPlugin","primitiveGetFailureReason",a)},gePrimitiveDisplaySpanBuffer:function(a){return this.namedPrimitive("B2DPlugin","primitiveDisplaySpanBuffer",a)},gePrimitiveGetCounts:function(a){return this.namedPrimitive("B2DPlugin","primitiveGetCounts",a)},gePrimitiveChangedActiveEdgeEntry:function(a){return this.namedPrimitive("B2DPlugin","primitiveChangedActiveEdgeEntry",a)},gePrimitiveRenderScanline:function(a){return this.namedPrimitive("B2DPlugin","primitiveRenderScanline",a)},gePrimitiveGetBezierStats:function(a){return this.namedPrimitive("B2DPlugin","primitiveGetBezierStats",a)},gePrimitiveFinishedProcessing:function(a){return this.namedPrimitive("B2DPlugin","primitiveFinishedProcessing",a)},gePrimitiveNeedsFlush:function(a){return this.namedPrimitive("B2DPlugin","primitiveNeedsFlush",a)},gePrimitiveAddLine:function(a){return this.namedPrimitive("B2DPlugin","primitiveAddLine",a)},gePrimitiveSetOffset:function(a){return this.namedPrimitive("B2DPlugin","primitiveSetOffset",a)},gePrimitiveNextFillEntry:function(a){return this.namedPrimitive("B2DPlugin","primitiveNextFillEntry",a)},gePrimitiveInitializeBuffer:function(a){return this.namedPrimitive("B2DPlugin","primitiveInitializeBuffer",a)},gePrimitiveDoProfileStats:function(a){return this.namedPrimitive("B2DPlugin","primitiveDoProfileStats",a)},gePrimitiveAddActiveEdgeEntry:function(a){return this.namedPrimitive("B2DPlugin","primitiveAddActiveEdgeEntry",a)},gePrimitiveSetAALevel:function(a){return this.namedPrimitive("B2DPlugin","primitiveSetAALevel",a)},gePrimitiveNeedsFlushPut:function(a){return this.namedPrimitive("B2DPlugin","primitiveNeedsFlushPut",a)},gePrimitiveAddCompressedShape:function(a){return this.namedPrimitive("B2DPlugin","primitiveAddCompressedShape",a)},gePrimitiveSetColorTransform:function(a){return this.namedPrimitive("B2DPlugin","primitiveSetColorTransform",a)},gePrimitiveAddOval:function(a){return this.namedPrimitive("B2DPlugin","primitiveAddOval",a)},gePrimitiveRegisterExternalFill:function(a){return this.namedPrimitive("B2DPlugin","primitiveRegisterExternalFill",a)},gePrimitiveAddPolygon:function(a){return this.namedPrimitive("B2DPlugin","primitiveAddPolygon",a)},gePrimitiveGetAALevel:function(a){return this.namedPrimitive("B2DPlugin","primitiveGetAALevel",a)}}),Object.subclass("Squeak.InterpreterProxy","initialization",{VM_PROXY_MAJOR:1,VM_PROXY_MINOR:11,initialize:function(a){this.vm=a,this.remappableOops=[],Object.defineProperty(this,"successFlag",{get:function(){return a.primHandler.success},set:function(b){a.primHandler.success=b}})},majorVersion:function(){return this.VM_PROXY_MAJOR},minorVersion:function(){return this.VM_PROXY_MINOR}},"success",{failed:function(){return!this.successFlag},primitiveFail:function(){this.successFlag=!1},primitiveFailFor:function(){this.successFlag=!1},success:function(a){a||(this.successFlag=!1)}},"stack access",{pop:function(a){this.vm.popN(a)},popthenPush:function(a,b){this.vm.popNandPush(a,b)},push:function(a){this.vm.push(a)},pushBool:function(a){this.vm.push(a?this.vm.trueObj:this.vm.falseObj)},pushInteger:function(a){this.vm.push(a)},pushFloat:function(a){this.vm.push(this.floatObjectOf(a))},stackValue:function(a){return this.vm.stackValue(a)},stackIntegerValue:function(a){var b=this.vm.stackValue(a);return"number"==typeof b?b:(this.successFlag=!1,0)},stackFloatValue:function(a){this.vm.success=!0;var b=this.vm.stackIntOrFloat(a);return this.vm.success?b:(this.successFlag=!1,0)},stackObjectValue:function(a){var b=this.vm.stackValue(a);return"number"!=typeof b?b:(this.successFlag=!1,this.vm.nilObj)},stackBytes:function(a){var b=this.vm.stackValue(a);return b.bytes?b.bytes:("number"!=typeof b&&b.isBytes()||(this.successFlag=!1),[])},stackWords:function(a){var b=this.vm.stackValue(a);return b.words?b.words:("number"!=typeof b&&b.isWords()||(this.successFlag=!1),[])},stackInt32Array:function(a){var b=this.vm.stackValue(a);return b.words?b.wordsAsInt32Array():("number"!=typeof b&&b.isWords()||(this.successFlag=!1),[])},stackInt16Array:function(a){var b=this.vm.stackValue(a);return b.words?b.wordsAsInt16Array():("number"!=typeof b&&b.isWords()||(this.successFlag=!1),[])},stackUint16Array:function(a){var b=this.vm.stackValue(a);return b.words?b.wordsAsUint16Array():("number"!=typeof b&&b.isWords()||(this.successFlag=!1),[])}},"object access",{isBytes:function(a){return"number"!=typeof a&&a.isBytes()},isWords:function(a){return"number"!=typeof a&&a.isWords()},isWordsOrBytes:function(a){return"number"!=typeof a&&a.isWordsOrBytes()},isPointers:function(a){return"number"!=typeof a&&a.isPointers()},isIntegerValue:function(a){return"number"==typeof a&&a>=-1073741824&&1073741823>=a},isArray:function(a){return a.sqClass===this.vm.specialObjects[Squeak.splOb_ClassArray]},isMemberOf:function(a,b){var c=a.sqClass.pointers[Squeak.Class_name].bytes;if(b.length!==c.length)return!1;for(var d=0;d<b.length;d++)if(b.charCodeAt(d)!==c[d])return!1;return!0},booleanValueOf:function(a){return!!a.isTrue||!a.isFalse&&(this.successFlag=!1,!1)},positive32BitValueOf:function(a){return this.vm.primHandler.positive32BitValueOf(a)},positive32BitIntegerFor:function(a){return this.vm.primHandler.pos32BitIntFor(a)},floatValueOf:function(a){return a.isFloat?a.float:(this.successFlag=!1,0)},floatObjectOf:function(a){return this.vm.primHandler.makeFloat(a)},fetchPointerofObject:function(a,b){return b.pointers[a]},fetchBytesofObject:function(a,b){var c=b.pointers[a];return c.bytes?c.bytes:c.words?c.wordsAsUint8Array():("number"!=typeof c&&c.isWordsOrBytes()||(this.successFlag=!1),[])},fetchWordsofObject:function(a,b){var c=b.pointers[a];return c.words?c.words:("number"!=typeof c&&c.isWords()||(this.successFlag=!1),[])},fetchInt32ArrayofObject:function(a,b){var c=b.pointers[a];return c.words?c.wordsAsInt32Array():("number"!=typeof c&&c.isWords()||(this.successFlag=!1),[])},fetchInt16ArrayofObject:function(a,b){var c=b.pointers[a];return c.words?c.wordsAsInt16Array():("number"!=typeof c&&c.isWords()||(this.successFlag=!1),[])},fetchUint16ArrayofObject:function(a,b){var c=b.pointers[a];return c.words?c.wordsAsUint16Array():("number"!=typeof c&&c.isWords()||(this.successFlag=!1),[])},fetchIntegerofObject:function(a,b){var c=b.pointers[a];return"number"==typeof c?c:(this.successFlag=!1,0)},fetchLong32ofObject:function(a,b){return b.words[a]},fetchFloatofObject:function(a,b){return this.floatValueOf(b.pointers[a])},storeIntegerofObjectwithValue:function(a,b,c){"number"==typeof c?b.pointers[a]=c:this.successFlag=!1},storePointerofObjectwithValue:function(a,b,c){b.pointers[a]=c},stObjectatput:function(a,b,c){if(a.sqClass!==this.classArray())throw Error("Array expected");return 1>b||b>=a.pointers.length?this.successFlag=!1:void(a.pointers[b]=c)}},"constant access",{isKindOfInteger:function(a){return"number"==typeof a||a.sqClass==this.classLargeNegativeInteger()||a.sqClass==this.classLargePositiveInteger()},classArray:function(){return this.vm.specialObjects[Squeak.splOb_ClassArray]},classBitmap:function(){return this.vm.specialObjects[Squeak.splOb_ClassBitmap]},classSmallInteger:function(){return this.vm.specialObjects[Squeak.splOb_ClassInteger]},classLargePositiveInteger:function(){return this.vm.specialObjects[Squeak.splOb_ClassLargePositiveInteger]},classLargeNegativeInteger:function(){return this.vm.specialObjects[Squeak.splOb_ClassLargeNegativeInteger]},classPoint:function(){return this.vm.specialObjects[Squeak.splOb_ClassPoint]},classString:function(){return this.vm.specialObjects[Squeak.splOb_ClassString]},nilObject:function(){return this.vm.nilObj},falseObject:function(){return this.vm.falseObj},trueObject:function(){return this.vm.trueObj}},"vm functions",{instantiateClassindexableSize:function(a,b){return this.vm.instantiateClass(a,b)},methodArgumentCount:function(){return this.argCount},makePointwithxValueyValue:function(a,b){return this.vm.primHandler.makePointWithXandY(a,b)},pushRemappableOop:function(a){this.remappableOops.push(a)},popRemappableOop:function(){return this.remappableOops.pop()},showDisplayBitsLeftTopRightBottom:function(a,b,c,d,e){if(d>b&&e>c){var f={left:b,top:c,right:d,bottom:e};this.vm.primHandler.displayDirty(a,f)}},ioLoadFunctionFrom:function(a,b){return this.vm.primHandler.loadFunctionFrom(a,b)}}),Object.subclass("Squeak.InstructionPrinter","initialization",{initialize:function(a,b){this.method=a,this.vm=b}},"printing",{printInstructions:function(a,b,c){for(this.indent=a,this.highlight=b,this.highlightPC=c,this.innerIndents={},this.result="",this.scanner=new Squeak.InstructionStream(this.method,this.vm),this.oldPC=this.scanner.pc,this.endPC=0,this.done=!1;!this.done;)this.scanner.interpretNextInstructionFor(this);return this.result},print:function(a){this.oldPC===this.highlightPC?this.highlight&&(this.result+=this.highlight):this.indent&&(this.result+=this.indent),this.result+=this.oldPC;for(var b=0;b<this.innerIndents[this.oldPC];b++)this.result+="   ";this.result+=" <";for(var b=this.oldPC;b<this.scanner.pc;b++)b>this.oldPC&&(this.result+=" "),this.result+=(this.method.bytes[b]+256).toString(16).substr(-2).toUpperCase();this.result+="> "+a+"\n",this.oldPC=this.scanner.pc}},"decoding",{blockReturnTop:function(){this.print("blockReturn")},doDup:function(){this.print("dup")},doPop:function(){this.print("pop")},jump:function(a){this.print("jumpTo: "+(this.scanner.pc+a)),this.scanner.pc+a>this.endPC&&(this.endPC=this.scanner.pc+a)},jumpIf:function(a,b){this.print((a?"jumpIfTrue: ":"jumpIfFalse: ")+(this.scanner.pc+b)),this.scanner.pc+b>this.endPC&&(this.endPC=this.scanner.pc+b)},methodReturnReceiver:function(){this.print("return: receiver"),this.done=this.scanner.pc>this.endPC},methodReturnTop:function(){this.print("return: topOfStack"),this.done=this.scanner.pc>this.endPC},methodReturnConstant:function(a){this.print("returnConst: "+a.toString()),this.done=this.scanner.pc>this.endPC},popIntoLiteralVariable:function(a){this.print("popIntoBinding: "+a.assnKeyAsString())},popIntoReceiverVariable:function(a){this.print("popIntoInstVar: "+a)},popIntoTemporaryVariable:function(a){this.print("popIntoTemp: "+a)},pushActiveContext:function(){this.print("push: thisContext")},pushConstant:function(a){var b=a.sqInstName?a.sqInstName():a.toString();this.print("pushConst: "+b)},pushLiteralVariable:function(a){this.print("pushBinding: "+a.assnKeyAsString())},pushReceiver:function(){this.print("push: self")},pushReceiverVariable:function(a){this.print("pushInstVar: "+a)},pushTemporaryVariable:function(a){this.print("pushTemp: "+a)},send:function(a,b,c){this.print((c?"superSend: #":"send: #")+(a.bytesAsString?a.bytesAsString():a))},storeIntoLiteralVariable:function(a){this.print("storeIntoBinding: "+a.assnKeyAsString())},storeIntoReceiverVariable:function(a){this.print("storeIntoInstVar: "+a)},storeIntoTemporaryVariable:function(a){this.print("storeIntoTemp: "+a)},pushNewArray:function(a){this.print("push: (Array new: "+a+")")},popIntoNewArray:function(a){this.print("pop: "+a+" into: (Array new: "+a+")")},pushRemoteTemp:function(a,b){this.print("push: "+a+" ofTemp: "+b)},storeIntoRemoteTemp:function(a,b){this.print("storeInto: "+a+" ofTemp: "+b)},popIntoRemoteTemp:function(a,b){this.print("popInto: "+a+" ofTemp: "+b)},pushClosureCopy:function(a,b,c){var d=this.scanner.pc,e=d+c;this.print("closure("+d+"-"+(e-1)+"): "+a+" copied, "+b+" args");for(var f=d;e>f;f++)this.innerIndents[f]=(this.innerIndents[f]||0)+1;e>this.endPC&&(this.endPC=e)}}),Object.subclass("Squeak.InstructionStream","initialization",{initialize:function(a,b){this.vm=b,this.method=a,this.pc=0,this.specialConstants=[b.trueObj,b.falseObj,b.nilObj,-1,0,1,2]}},"decoding",{interpretNextInstructionFor:function(a){var b=this.method,c=b.bytes[this.pc++],d=c/16|0,e=c%16;if(0===d)return a.pushReceiverVariable(e);if(1===d)return a.pushTemporaryVariable(e);if(2===d)return a.pushConstant(b.methodGetLiteral(e));if(3===d)return a.pushConstant(b.methodGetLiteral(e+16));if(4===d)return a.pushLiteralVariable(b.methodGetLiteral(e));if(5===d)return a.pushLiteralVariable(b.methodGetLiteral(e+16));if(6===d)return 8>e?a.popIntoReceiverVariable(e):a.popIntoTemporaryVariable(e-8);if(7===d){if(0===e)return a.pushReceiver();if(8>e)return a.pushConstant(this.specialConstants[e-1]);if(8===e)return a.methodReturnReceiver();if(12>e)return a.methodReturnConstant(this.specialConstants[e-9]);if(12===e)return a.methodReturnTop();if(13===e)return a.blockReturnTop();if(e>13)throw Error("unusedBytecode")}return 8===d?this.interpretExtension(e,b,a):9===d?8>e?a.jump(e+1):a.jumpIf(!1,e-8+1):10===d?(c=this.method.bytes[this.pc++],8>e?a.jump(256*(e-4)+c):a.jumpIf(12>e,256*(3&e)+c)):11===d?a.send(this.vm.specialSelectors[2*e],this.vm.specialSelectors[2*e+1],!1):12===d?a.send(this.vm.specialSelectors[2*(e+16)],this.vm.specialSelectors[2*(e+16)+1],!1):d>12?a.send(b.methodGetLiteral(e),d-13,!1):void 0},interpretExtension:function(a,b,c){if(6>=a){var d=this.method.bytes[this.pc++];if(2>=a){var e=d/64|0,f=d%64;if(0===a){if(0===e)return c.pushReceiverVariable(f);if(1===e)return c.pushTemporaryVariable(f);if(2===e)return c.pushConstant(this.method.methodGetLiteral(f));if(3===e)return c.pushLiteralVariable(this.method.methodGetLiteral(f))}if(1===a){if(0===e)return c.storeIntoReceiverVariable(f);if(1===e)return c.storeIntoTemporaryVariable(f);if(2===e)throw Error("illegalStore");if(3===e)return c.storeIntoLiteralVariable(this.method.methodGetLiteral(f))}if(2===a){if(0===e)return c.popIntoReceiverVariable(f);if(1===e)return c.popIntoTemporaryVariable(f);if(2===e)throw Error("illegalStore");if(3===e)return c.popIntoLiteralVariable(this.method.methodGetLiteral(f))}}if(3===a)return c.send(this.method.methodGetLiteral(d%32),d/32|0,!1);if(4===a){var g=this.method.bytes[this.pc++],e=d/32|0;if(0===e)return c.send(this.method.methodGetLiteral(g),d%32,!1);if(1===e)return c.send(this.method.methodGetLiteral(g),d%32,!0);if(2===e)return c.pushReceiverVariable(g);if(3===e)return c.pushConstant(this.method.methodGetLiteral(g));if(4===e)return c.pushLiteralVariable(this.method.methodGetLiteral(g));if(5===e)return c.storeIntoReceiverVariable(g);if(6===e)return c.popIntoReceiverVariable(g);if(7===e)return c.storeIntoLiteralVariable(this.method.methodGetLiteral(g))}if(5===a)return c.send(this.method.methodGetLiteral(31&d),d>>5,!0);if(6===a)return c.send(this.method.methodGetLiteral(63&d),d>>6,!1)}if(7===a)return c.doPop();if(8===a)return c.doDup();if(9===a)return c.pushActiveContext();var d=this.method.bytes[this.pc++];if(10===a)return 128>d?c.pushNewArray(d):c.popIntoNewArray(d-128);if(11===a)throw Error("unusedBytecode");var g=this.method.bytes[this.pc++];if(12===a)return c.pushRemoteTemp(d,g);if(13===a)return c.storeIntoRemoteTemp(d,g);if(14===a)return c.popIntoRemoteTemp(d,g);var h=this.method.bytes[this.pc++];return c.pushClosureCopy(d>>4,15&d,256*g+h)}})}),module("users.bert.SqueakJS.jit").requires("users.bert.SqueakJS.vm").toRun(function(){Object.subclass("Squeak.Compiler","initialization",{initialize:function(a){this.vm=a,this.comments=!!Squeak.Compiler.comments,this.specialSelectors=["+","-","<",">","<=",">=","=","~=","*","/","\\","@","bitShift:","//","bitAnd:","bitOr:","at:","at:put:","size","next","nextPut:","atEnd","==","class","blockCopy:","value","value:","do:","new","new:","x","y"]}},"accessing",{compile:function(a,b,c){if(a.isHot){this.singleStep=!1,this.debug=this.comments;var d=b&&b.className(),e=c&&c.bytesAsString();a.compiled=this.generate(a,d,e)}else a.isHot=!0},enableSingleStepping:function(a,b,c){if(!a.compiled||!a.compiled.canSingleStep){this.singleStep=!0,this.debug=!0;var d=this.vm.printMethod(a,b,c).split(">>");a.compiled=this.generate(a,d[0],d[1]),a.compiled.canSingleStep=!0}return!0},functionNameFor:function(a,b){if(!a||!b)return"Squeak_DOIT";if(!/[^a-zA-Z0-9:_]/.test(b))return(a+"_"+b).replace(/[: ]/g,"_");var c=b.replace(/./g,function(a){return{"|":"OR","~":"NOT","<":"LT","=":"EQ",">":"GT","&":"AND","@":"AT","*":"TIMES","+":"PLUS","\\":"MOD","-":"MINUS",",":"COMMA","/":"DIV","?":"IF"}[a]||"OPERATOR"});return a.replace(/[ ]/,"_")+"__"+c+"__"}},"generating",{generate:function(a,b,c){for(this.method=a,this.pc=0,this.endPC=0,this.prevPC=0,this.source=[],this.sourceLabels={},this.needsLabel={0:!0},this.needsBreak=!1,b&&c&&this.source.push("// ",b,">>",c,"\n"),this.source.push("var context = vm.activeContext,\n","    stack = context.pointers,\n","    rcvr = vm.receiver,\n","    inst = rcvr.pointers,\n","    temp = vm.homeContext.pointers,\n","    lit = vm.method.pointers,\n","    bytecodes = 0 - vm.pc;\n","while (true) switch (vm.pc) {\n"),this.done=!1;!this.done;){var d=a.bytes[this.pc++],e=0;switch(248&d){case 0:case 8:this.generatePush("inst[",15&d,"]");break;case 16:case 24:this.generatePush("temp[",6+(15&d),"]");break;case 32:case 40:case 48:case 56:this.generatePush("lit[",1+(31&d),"]");break;case 64:case 72:case 80:case 88:this.generatePush("lit[",1+(31&d),"].pointers[1]");break;case 96:this.generatePopInto("inst[",7&d,"]");break;case 104:this.generatePopInto("temp[",6+(7&d),"]");break;case 112:switch(d){case 112:this.generatePush("rcvr");break;case 113:this.generatePush("vm.trueObj");break;case 114:this.generatePush("vm.falseObj");break;case 115:this.generatePush("vm.nilObj");break;case 116:this.generatePush("-1");break;case 117:this.generatePush("0");break;case 118:this.generatePush("1");break;case 119:this.generatePush("2")}break;case 120:switch(d){case 120:this.generateReturn("rcvr");break;case 121:this.generateReturn("vm.trueObj");break;case 122:this.generateReturn("vm.falseObj");break;case 123:this.generateReturn("vm.nilObj");break;case 124:this.generateReturn("stack[vm.sp]");break;case 125:this.generateBlockReturn();break;default:throw Error("unusedBytecode")}break;case 128:case 136:this.generateExtended(d);break;case 144:this.generateJump(1+(7&d));break;case 152:this.generateJumpIf(!1,1+(7&d));break;case 160:e=a.bytes[this.pc++],this.generateJump(256*((7&d)-4)+e);break;case 168:e=a.bytes[this.pc++],this.generateJumpIf(172>d,256*(3&d)+e);break;case 176:case 184:this.generateNumericOp(d);break;case 192:case 200:this.generateQuickPrim(d);break;case 208:case 216:this.generateSend("lit[",1+(15&d),"]",0,!1);break;case 224:case 232:this.generateSend("lit[",1+(15&d),"]",1,!1);break;case 240:case 248:this.generateSend("lit[",1+(15&d),"]",2,!1)}}var f=this.functionNameFor(b,c);return this.singleStep?(this.debug&&this.source.push("// all valid PCs have a label;\n"),this.source.push("default: throw Error('invalid PC'); }"),new Function("return function "+f+"(vm, singleStep) {\n"+this.source.join("")+"\n}")()):(this.debug&&this.source.push("// fall back to single-stepping\n"),this.source.push("default: bytecodes += vm.pc; vm.interpretOne(true); return bytecodes;}"),this.deleteUnneededLabels(),new Function("return function "+f+"(vm) {\n"+this.source.join("")+"\n}")())},generateExtended:function(a){var b,c;switch(a){case 128:switch((b=this.method.bytes[this.pc++])>>6){case 0:return void this.generatePush("inst[",63&b,"]");case 1:return void this.generatePush("temp[",6+(63&b),"]");case 2:return void this.generatePush("lit[",1+(63&b),"]");case 3:return void this.generatePush("lit[",1+(63&b),"].pointers[1]")}case 129:switch((b=this.method.bytes[this.pc++])>>6){case 0:return void this.generateStoreInto("inst[",63&b,"]");case 1:return void this.generateStoreInto("temp[",6+(63&b),"]");case 2:throw Error("illegal store into literal");case 3:return void this.generateStoreInto("lit[",1+(63&b),"].pointers[1]")}return;case 130:switch((b=this.method.bytes[this.pc++])>>6){case 0:return void this.generatePopInto("inst[",63&b,"]");case 1:return void this.generatePopInto("temp[",6+(63&b),"]");case 2:throw Error("illegal pop into literal");case 3:return void this.generatePopInto("lit[",1+(63&b),"].pointers[1]")}case 131:return b=this.method.bytes[this.pc++],void this.generateSend("lit[",1+(31&b),"]",b>>5,!1);case 132:switch(b=this.method.bytes[this.pc++],c=this.method.bytes[this.pc++],b>>5){case 0:return void this.generateSend("lit[",1+c,"]",31&b,!1);case 1:return void this.generateSend("lit[",1+c,"]",31&b,!0);case 2:return void this.generatePush("inst[",c,"]");case 3:return void this.generatePush("lit[",1+c,"]");case 4:return void this.generatePush("lit[",1+c,"].pointers[1]");case 5:return void this.generateStoreInto("inst[",c,"]");case 6:return void this.generatePopInto("inst[",c,"]");case 7:return void this.generateStoreInto("lit[",1+c,"].pointers[1]")}case 133:return b=this.method.bytes[this.pc++],void this.generateSend("lit[",1+(31&b),"]",b>>5,!0);case 134:return b=this.method.bytes[this.pc++],void this.generateSend("lit[",1+(63&b),"]",b>>6,!1);case 135:return void this.generateInstruction("pop","vm.sp--");case 136:return void this.generateInstruction("dup","var dup = stack[vm.sp]; stack[++vm.sp] = dup");case 137:return void this.generateInstruction("thisContext","stack[++vm.sp] = vm.exportThisContext()");case 138:b=this.method.bytes[this.pc++];var d=b>127,e=127&b;return void this.generateClosureTemps(e,d);case 139:throw Error("unusedBytecode");case 140:return b=this.method.bytes[this.pc++],c=this.method.bytes[this.pc++],void this.generatePush("temp[",6+c,"].pointers[",b,"]");case 141:return b=this.method.bytes[this.pc++],c=this.method.bytes[this.pc++],void this.generateStoreInto("temp[",6+c,"].pointers[",b,"]");case 142:return b=this.method.bytes[this.pc++],c=this.method.bytes[this.pc++],void this.generatePopInto("temp[",6+c,"].pointers[",b,"]");case 143:b=this.method.bytes[this.pc++],c=this.method.bytes[this.pc++];var f=this.method.bytes[this.pc++],g=15&b,h=b>>4,i=c<<8|f;return void this.generateClosureCopy(g,h,i)}},generatePush:function(a,b,c,d,e){this.debug&&this.generateDebugCode("push"),this.generateLabel(),this.source.push("stack[++vm.sp] = ",a),void 0!==b&&(this.source.push(b,c),void 0!==d&&this.source.push(d,e)),this.source.push(";\n")},generateStoreInto:function(a,b,c,d,e){this.debug&&this.generateDebugCode("store into"),this.generateLabel(),this.source.push(a),void 0!==b&&(this.source.push(b,c),void 0!==d&&this.source.push(d,e)),this.source.push(" = stack[vm.sp];\n")},generatePopInto:function(a,b,c,d,e){this.debug&&this.generateDebugCode("pop into"),this.generateLabel(),this.source.push(a),void 0!==b&&(this.source.push(b,c),void 0!==d&&this.source.push(d,e)),this.source.push(" = stack[vm.sp--];\n")},generateReturn:function(a){this.debug&&this.generateDebugCode("return"),this.generateLabel(),this.source.push("vm.pc = ",this.pc,"; vm.doReturn(",a,"); return bytecodes + ",this.pc,";\n"),this.needsBreak=!1,this.done=this.pc>this.endPC},generateBlockReturn:function(){this.debug&&this.generateDebugCode("block return"),this.generateLabel(),this.source.push("vm.pc = ",this.pc,"; vm.doReturn(stack[vm.sp--], context.pointers[0]); return bytecodes + ",this.pc,";\n"),this.needsBreak=!1},generateJump:function(a){var b=this.pc+a;this.debug&&this.generateDebugCode("jump to "+b),this.generateLabel(),this.source.push("vm.pc = ",b,"; "),0>a?this.source.push("bytecodes += ",-a,"; "):this.source.push("bytecodes -= ",a,"; "),0>a&&this.source.push("\nif (vm.interruptCheckCounter-- <= 0) {\n","   vm.checkForInterrupts();\n","   if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return bytecodes + ",b,";\n","}\n"),this.singleStep&&this.source.push("\nif (vm.breakOutOfInterpreter) return bytecodes + ",b,";\n"),this.source.push("continue;\n"),this.needsBreak=!1,this.needsLabel[b]=!0,b>this.endPC&&(this.endPC=b)},generateJumpIf:function(a,b){var c=this.pc+b;this.debug&&this.generateDebugCode("jump if "+a+" to "+c),this.generateLabel(),this.source.push("var cond = stack[vm.sp--]; if (cond === vm.",a,"Obj) {vm.pc = ",c,"; bytecodes -= ",b,"; "),this.singleStep&&this.source.push("if (vm.breakOutOfInterpreter) return bytecodes + ",c,"; else "),this.source.push("continue}\n","else if (cond !== vm.",!a,"Obj) {vm.sp++; vm.pc = ",this.pc,"; vm.send(vm.specialObjects[25], 0, false); return bytecodes + ",this.pc,"}\n"),this.needsLabel[this.pc]=!0,this.needsLabel[c]=!0,c>this.endPC&&(this.endPC=c)},generateQuickPrim:function(a){switch(this.debug&&this.generateDebugCode("quick prim "+this.specialSelectors[16+(15&a)]),this.generateLabel(),a){case 194:return this.source.push("if (stack[vm.sp].sqClass === vm.specialObjects[7]) stack[vm.sp] = stack[vm.sp].pointersSize();\n","else if (stack[vm.sp].sqClass === vm.specialObjects[6]) stack[vm.sp] = stack[vm.sp].bytesSize();\n","else { vm.pc = ",this.pc,"; vm.sendSpecial(18); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return bytecodes + ",this.pc,"; }\n"),void(this.needsLabel[this.pc]=!0);case 198:return void this.source.push("var cond = stack[vm.sp-1] === stack[vm.sp];\nstack[--vm.sp] = cond ? vm.trueObj : vm.falseObj;\n");case 199:return void this.source.push("stack[vm.sp] = typeof stack[vm.sp] === 'number' ? vm.specialObjects[5] : stack[vm.sp].sqClass;\n");case 200:return this.source.push("vm.pc = ",this.pc,"; if (!vm.primHandler.quickSendOther(rcvr, ",15&a,")) ","{vm.sendSpecial(",16+(15&a),"); return bytecodes + ",this.pc,"}\n"),this.needsLabel[this.pc]=!0,void(this.needsLabel[this.pc+2]=!0);case 201:case 202:case 203:return this.source.push("vm.pc = ",this.pc,"; if (!vm.primHandler.quickSendOther(rcvr, ",15&a,")) vm.sendSpecial(",16+(15&a),"); return bytecodes + ",this.pc,";\n"),void(this.needsLabel[this.pc]=!0)}this.source.push("vm.pc = ",this.pc,"; if (!vm.primHandler.quickSendOther(rcvr, ",15&a,"))"," vm.sendSpecial(",16+(15&a),");\n","if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return bytecodes + ",this.pc,";\n","if (vm.pc !== ",this.pc,") throw Error('Huh?');\n"),this.needsBreak=!1,this.needsLabel[this.pc]=!0},generateNumericOp:function(a){switch(this.debug&&this.generateDebugCode("numeric op "+this.specialSelectors[15&a]),this.generateLabel(),this.needsLabel[this.pc]=!0,a){case 176:return void this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = vm.primHandler.signed32BitIntegerFor(a + b);\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(0); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return bytecodes + ",this.pc,"}\n");case 177:return void this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = vm.primHandler.signed32BitIntegerFor(a - b);\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(1); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return bytecodes + ",this.pc,"}\n");case 178:return void this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = a < b ? vm.trueObj : vm.falseObj;\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(2); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return bytecodes + ",this.pc,"}\n");case 179:return void this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = a > b ? vm.trueObj : vm.falseObj;\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(3); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return bytecodes + ",this.pc,"}\n");case 180:return void this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = a <= b ? vm.trueObj : vm.falseObj;\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(4); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return bytecodes + ",this.pc,"}\n");case 181:return void this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = a >= b ? vm.trueObj : vm.falseObj;\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(5); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return bytecodes + ",this.pc,"}\n");case 182:return void this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = a === b ? vm.trueObj : vm.falseObj;\n","} else if (a === b && a.float === a.float) {\n","   stack[--vm.sp] = vm.trueObj;\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(6); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return bytecodes + ",this.pc,"}\n");case 183:return void this.source.push("var a = stack[vm.sp - 1], b = stack[vm.sp];\n","if (typeof a === 'number' && typeof b === 'number') {\n","   stack[--vm.sp] = a !== b ? vm.trueObj : vm.falseObj;\n","} else if (a === b && a.float === a.float) {\n","   stack[--vm.sp] = vm.falseObj;\n","} else { vm.pc = ",this.pc,"; vm.sendSpecial(7); if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return bytecodes + ",this.pc,"}\n");case 184:return void this.source.push("vm.success = true; vm.resultIsFloat = false; if(!vm.pop2AndPushNumResult(vm.stackIntOrFloat(1) * vm.stackIntOrFloat(0))) { vm.pc = ",this.pc,"; vm.sendSpecial(8); return bytecodes + ",this.pc,"}\n");case 185:return void this.source.push("vm.success = true; if(!vm.pop2AndPushIntResult(vm.quickDivide(vm.stackInteger(1),vm.stackInteger(0)))) { vm.pc = ",this.pc,"; vm.sendSpecial(9); return bytecodes + ",this.pc,"}\n");case 186:return void this.source.push("vm.success = true; if(!vm.pop2AndPushIntResult(vm.mod(vm.stackInteger(1),vm.stackInteger(0)))) { vm.pc = ",this.pc,"; vm.sendSpecial(10); return bytecodes + ",this.pc,"}\n");case 187:return void this.source.push("vm.success = true; if(!vm.primHandler.primitiveMakePoint(1, true)) { vm.pc = ",this.pc,"; vm.sendSpecial(11); return bytecodes + ",this.pc,"}\n");case 188:return void this.source.push("vm.success = true; if(!vm.pop2AndPushIntResult(vm.safeShift(vm.stackInteger(1),vm.stackInteger(0)))) { vm.pc = ",this.pc,"; vm.sendSpecial(12); return bytecodes + ",this.pc,"}\n");case 189:return void this.source.push("vm.success = true; if(!vm.pop2AndPushIntResult(vm.div(vm.stackInteger(1),vm.stackInteger(0)))) { vm.pc = ",this.pc,"; vm.sendSpecial(13); return bytecodes + ",this.pc,"}\n");case 190:return void this.source.push("vm.success = true; if(!vm.pop2AndPushIntResult(vm.stackInteger(1) & vm.stackInteger(0))) { vm.pc = ",this.pc,"; vm.sendSpecial(14); return bytecodes + ",this.pc,"}\n");case 191:return void this.source.push("vm.success = true; if(!vm.pop2AndPushIntResult(vm.stackInteger(1) | vm.stackInteger(0))) { vm.pc = ",this.pc,"; vm.sendSpecial(15); return bytecodes + ",this.pc,"}\n")}},generateSend:function(a,b,c,d,e){this.debug&&this.generateDebugCode("send "+("lit["===a?this.method.pointers[b].bytesAsString():"...")),this.generateLabel(),this.source.push("vm.pc = ",this.pc,"; vm.send(",a,b,c,", ",d,", ",e,"); ","if (context !== vm.activeContext || vm.breakOutOfInterpreter !== false) return bytecodes + ",this.pc,";\n"),this.needsBreak=!1,this.needsLabel[this.pc]=!0},generateClosureTemps:function(a,b){if(this.debug&&this.generateDebugCode("closure temps"),this.generateLabel(),this.source.push("var array = vm.instantiateClass(vm.specialObjects[7], ",a,");\n"),b){for(var c=0;a>c;c++)this.source.push("array.pointers[",c,"] = stack[vm.sp - ",a-c-1,"];\n");this.source.push("stack[vm.sp -= ",a-1,"] = array;\n")}else this.source.push("stack[++vm.sp] = array;\n")},generateClosureCopy:function(a,b,c){var d=this.pc,e=d+c;if(this.debug&&this.generateDebugCode("push closure("+d+"-"+(e-1)+"): "+b+" copied, "+a+" args"),this.generateLabel(),this.source.push("var closure = vm.instantiateClass(vm.specialObjects[36], ",b,");\n","closure.pointers[0] = context; vm.reclaimableContextCount = 0;\n","closure.pointers[1] = ",d+4*this.method.pointers.length+1,";\n","closure.pointers[2] = ",a,";\n"),b>0){for(var f=0;b>f;f++)this.source.push("closure.pointers[",f+3,"] = stack[vm.sp - ",b-f-1,"];\n");this.source.push("stack[vm.sp -= ",b-1,"] = closure;\n")}else this.source.push("stack[++vm.sp] = closure;\n");this.source.push("vm.pc = ",e,";\n"),this.source.push("bytecodes -= ",c,";\n"),this.singleStep&&this.source.push("if (vm.breakOutOfInterpreter) return bytecodes + ",e,";\n"),this.source.push("continue;\n"),this.needsBreak=!1,this.needsLabel[d]=!0,this.needsLabel[e]=!0,e>this.endPC&&(this.endPC=e)},generateLabel:function(){this.sourceLabels[this.prevPC]=this.source.length,this.source.push("case ",this.prevPC,":\n"),this.prevPC=this.pc},generateDebugCode:function(a){this.needsBreak&&(this.source.push("if (vm.breakOutOfInterpreter) return bytecodes + (vm.pc = ",this.prevPC,");\n"),this.needsLabel[this.prevPC]=!0);for(var b=[],c=this.prevPC;c<this.pc;c++)b.push((this.method.bytes[c]+256).toString(16).slice(-2).toUpperCase());this.source.push("// ",this.prevPC," <",b.join(" "),"> ",a,"\n"),this.needsBreak=this.singleStep},generateInstruction:function(a,b){this.debug&&this.generateDebugCode(a),this.generateLabel(),this.source.push(b,";\n")},deleteUnneededLabels:function(){for(var a in this.sourceLabels)if(!this.needsLabel[a])for(var b=0;3>b;b++)this.source[this.sourceLabels[a]+b]=""}})}),module("users.bert.SqueakJS.plugins.ADPCMCodecPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function a(a,b){return b>31?0:a<<b}function b(a,b){return b>31?0:a>>>b}function c(){return s}function d(a,b){var c,d,e;for(d=b-a,0>d&&(d=0-d),c=63,e=1;62>=e;e++)63===c&&t[e-1]>=d&&(c=e);return c}function e(c){var d,e,f;for(e=0,d=c;;){if(!((f=d-n)>0))return e+=b(p,0-f),n-=d,p&=b(255,8-n),e;e+=a(p,f),d-=n,p=q[++o-1],n=8}}function f(c,d){var e,f,g,h;for(f=d,g=c;;){if(e=8-n,!(0>(h=e-g)))return p+=a(f,h),n+=g,self;p+=b(f,0-h),q[++o-1]=p,n=0,p=0,f&=a(1,0-h)-1,g-=e}}function g(){var a,b,c,d,f,g,h,i,j,k,l,m,s,u,v,w,x;if(a=r.stackValue(1),b=r.stackIntegerValue(0),v=r.fetchIntegerofObject(0,a),s=r.fetchIntegerofObject(1,a),j=r.fetchIntegerofObject(2,a),l=r.fetchIntegerofObject(3,a),k=r.fetchIntegerofObject(4,a),m=r.fetchIntegerofObject(5,a),p=r.fetchIntegerofObject(6,a),n=r.fetchIntegerofObject(7,a),o=r.fetchIntegerofObject(8,a),q=r.fetchBytesofObject(9,a),x=r.fetchInt16ArrayofObject(10,a),w=r.fetchIntegerofObject(12,a),i=r.fetchIntegerofObject(13,a),t=r.fetchInt16ArrayofObject(14,a),u=r.fetchInt16ArrayofObject(15,a),r.failed())return null;for(f=1;b>=f;f++)if(1==(f&m))v=e(16),v>32767&&(v-=65536),s=e(6),x[++w-1]=v;else{for(d=e(i),h=t[s],g=0,c=k;c>0;)(d&c)>0&&(g+=h),h>>>=1,c>>>=1;g+=h,(d&j)>0?v-=g:v+=g,v>32767?v=32767:-32768>v&&(v=-32768),s+=u[d&l],0>s?s=0:s>88&&(s=88),x[++w-1]=v}return r.failed()?null:(r.storeIntegerofObjectwithValue(0,a,v),r.storeIntegerofObjectwithValue(1,a,s),r.storeIntegerofObjectwithValue(6,a,p),r.storeIntegerofObjectwithValue(7,a,n),r.storeIntegerofObjectwithValue(8,a,o),r.storeIntegerofObjectwithValue(12,a,w),void r.pop(1))}function h(){var a,b,c,d,f,g,h,i,j,k,l,m,s,u,v,w,x,y,z,A,B,C,D,E,F;if(a=r.stackValue(1),b=r.stackIntegerValue(0),C=r.fetchInt16ArrayofObject(0,a),A=r.fetchInt16ArrayofObject(1,a),w=r.fetchIntegerofObject(2,a),y=r.fetchIntegerofObject(3,a),x=r.fetchIntegerofObject(4,a),z=r.fetchIntegerofObject(5,a),p=r.fetchIntegerofObject(6,a),n=r.fetchIntegerofObject(7,a),o=r.fetchIntegerofObject(8,a),q=r.fetchBytesofObject(9,a),F=r.fetchInt16ArrayofObject(10,a),D=r.fetchInt16ArrayofObject(11,a),E=r.fetchIntegerofObject(12,a),v=r.fetchIntegerofObject(13,a),t=r.fetchInt16ArrayofObject(14,a),B=r.fetchInt16ArrayofObject(15,a),r.failed())return null;for(l=C[0],m=C[1],h=A[0],i=A[1],g=1;b>=g;g++)if(1==(g&z))l=e(16),h=e(6),m=e(16),i=e(6),l>32767&&(l-=65536),m>32767&&(m-=65536),F[++E-1]=l,D[E-1]=m;else{for(d=e(v),f=e(v),s=t[h],u=t[i],j=k=0,c=x;c>0;)(d&c)>0&&(j+=s),(f&c)>0&&(k+=u),s>>>=1,u>>>=1,c>>>=1;j+=s,k+=u,(d&w)>0?l-=j:l+=j,(f&w)>0?m-=k:m+=k,l>32767?l=32767:-32768>l&&(l=-32768),m>32767?m=32767:-32768>m&&(m=-32768),h+=B[d&y],0>h?h=0:h>88&&(h=88),i+=B[f&y],0>i?i=0:i>88&&(i=88),F[++E-1]=l,D[E-1]=m}return C[0]=l,C[1]=m,A[0]=h,A[1]=i,r.failed()?null:(r.storeIntegerofObjectwithValue(6,a,p),r.storeIntegerofObjectwithValue(7,a,n),r.storeIntegerofObjectwithValue(8,a,o),r.storeIntegerofObjectwithValue(12,a,E),void r.pop(1))}function i(){var a,b,c,e,g,h,i,j,k,l,m,s,u,v,w,x,y,z,A;if(a=r.stackValue(1),b=r.stackIntegerValue(0),y=r.fetchIntegerofObject(0,a),w=r.fetchIntegerofObject(1,a),s=r.fetchIntegerofObject(2,a),u=r.fetchIntegerofObject(4,a),v=r.fetchIntegerofObject(5,a),p=r.fetchIntegerofObject(6,a),n=r.fetchIntegerofObject(7,a),o=r.fetchIntegerofObject(8,a),q=r.fetchBytesofObject(9,a),A=r.fetchInt16ArrayofObject(10,a),z=r.fetchIntegerofObject(12,a),m=r.fetchIntegerofObject(13,a),t=r.fetchInt16ArrayofObject(14,a),x=r.fetchInt16ArrayofObject(15,a),r.failed())return null;for(l=t[0],h=1;b>=h;h++)if(1==(h&v))y=A[++z-1],(i=y)<0&&(i+=65536),f(16,i),b>h&&(w=d(y,A[z])),f(6,w);else{for(k=0,g=A[++z-1]-y,0>g&&(k=s,g=0-g),e=0,j=0,c=u;c>0;)g>=l&&(e+=c,j+=l,g-=l),l>>>=1,c>>>=1;j+=l,k>0?y-=j:y+=j,y>32767?y=32767:-32768>y&&(y=-32768),w+=x[e],0>w?w=0:w>88&&(w=88),l=t[w],f(m,k|e)}return n>0&&(q[++o-1]=p),r.failed()?null:(r.storeIntegerofObjectwithValue(0,a,y),r.storeIntegerofObjectwithValue(1,a,w),r.storeIntegerofObjectwithValue(6,a,p),r.storeIntegerofObjectwithValue(7,a,n),r.storeIntegerofObjectwithValue(8,a,o),r.storeIntegerofObjectwithValue(12,a,z),void r.pop(1))}function j(){var a;return a=r.stackValue(1),r.stackIntegerValue(0),p=r.fetchIntegerofObject(6,a),n=r.fetchIntegerofObject(7,a),o=r.fetchIntegerofObject(8,a),q=r.fetchIntegerofObject(9,a),t=r.fetchIntegerofObject(14,a),r.failed()?null:(success(!1),r.failed()?null:(r.storeIntegerofObjectwithValue(6,a,p),r.storeIntegerofObjectwithValue(7,a,n),r.storeIntegerofObjectwithValue(8,a,o),void r.pop(1)))}function k(a){return r=a,!1!==(r.majorVersion()==l)&&r.minorVersion()>=m}var l=1,m=11,n=0,o=0,p=0,q=null,r=null,s="ADPCMCodecPlugin 3 November 2014 (e)",t=null;Squeak.registerExternalModule("ADPCMCodecPlugin",{primitiveDecodeStereo:h,primitiveEncodeStereo:j,setInterpreter:k,primitiveEncodeMono:i,primitiveDecodeMono:g,getModuleName:c})}),module("users.bert.SqueakJS.plugins.B2DPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function a(a){return"number"==typeof a?Ml.classSmallInteger():a.sqClass}function b(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}function c(a){return a.bytes?a.bytes.length:a.words?4*a.words.length:0}function d(a,b){return 0|Math.floor(a/b)}function e(a,b){return a-d(a,b)*b|0}function f(a,b){return b>31?0:a<<b}function g(a,b){return b>31?0:a>>>b}function h(a,b){return new Int32Array(a.buffer,a.byteOffset+4*b)}function i(a,b){return new Float32Array(a.buffer,a.byteOffset+4*b)}function j(){return Sl[hk]}function k(a){return Sl[hk]=a}function l(){return Sl[ik]}function m(a){return Sl[ik]=a}function n(a,b){var c;return c=a+q()-1&~(q()-1),c>b?b:c}function o(a){return Sl[jk]=a}function p(a,b){return b-1&~(q()-1)}function q(){return Sl[kk]}function r(a){return Sl[kk]=a}function s(){return Sl[lk]}function t(a){return Sl[lk]=a}function u(){return Sl[mk]}function v(a){return Sl[mk]=a}function w(a){var b,c;return b=65535&a,c=a>>>16&255,(b*b>>>16)+b*c*2+(c*c<<16)>>>8}function x(a,b){var c;return 0===a?0>b?0-b:b:0===b?0>a?0-a:a:(c=a*a+b*b,db(c))}function y(a){return K(1)?(Ll[Bc()]=a,void Cc(Bc()+1)):0}function z(a,b,c,d){var e,f;$(a)[pi]=$(a)[pi]-256*c,e=th(a)[pi],th(a)[pi]=e+256*(b-c),f=th(a)[qi],th(a)[qi]=f+256*b,Z(a,d-c)}function A(a,b,c,d){var e,f;$(a)[pi]=$(a)[pi]+256*c,e=th(a)[pi],th(a)[pi]=e-256*(b-c),f=th(a)[qi],th(a)[qi]=f+256*b,Z(a,d-c+b)}function B(a,b,c){var d,e,f,g,h,i,j;i=wh(a),j=yh(a),d=Ah(a),f=we(d),g=Eh(a),h=ud(a),e=c-b,d>i&&(0>h?g-=e:(g+=e,Ab(a,b))),j+f===0&&(h>0?g-=wd(a):(g+=wd(a),Ab(a,b))),j+f>0&&(0>h?(g+=e,Ab(a,b)):g-=e),Fh(a,g)}function C(){return Sl[nk]}function D(a){return Sl[nk]=a}function E(){return Sl[ok]}function F(a){return Sl[ok]=a}function G(a){return fe(a)}function H(){var a;return N(Zh)?(a=Ql,Ql=a+Zh,ve(a,fj),re(a,0),te(a,Zh),a):0}function I(){return fh(6),gh()}function J(a,b){var c,d,e,f;if(e=ii+a,!N(e))return 0;if(d=Ql,Ql=d+e,ve(d,gj),re(d,0),te(d,e),c=_a(d),Gc())for(f=0;a-1>=f;f++)c[f]=Wg(b[f]);else for(f=0;a-1>=f;f++)c[f]=b[f];return ea(d,a),d}function K(a){var b,c,d,e;if(!G(a))return!1;if(0!==E())for(d=E(),b=E()+a,c=1,e=E();e>=c;c++)Bl[--b]=Bl[--d];return Bl=h(Bl,a),!0}function L(a,b,c){var d,e,f,g;if(e=Tj+b,!N(e))return 0;if(d=Ql,Ql=d+e,c?ve(d,nj):ve(d,mj),re(d,0),te(d,e),g=Fc(d),Gc())for(f=0;b-1>=f;f++)g[f]=Wg(a[f]);else for(f=0;b-1>=f;f++)g[f]=a[f];return Ec(d,b),d}function M(){var a;return N(Uj)?(a=Ql,Ql=a+Uj,ve(a,lj),re(a,0),te(a,Uj),a):0}function N(a){var b,c,d,e;if(!K(a))return!1;if(0!==Bc())for(d=Bc(),b=Bc()+a,c=1,e=Bc();e>=c;c++)Ll[--b]=Ll[--d];return Ll=h(Ll,a),!0}function O(a){return fe(a)}function P(){return fh($f())}function Q(){var a;return N(xi)?(a=Ql,Ql=a+xi,ve(a,qj),re(a,0),te(a,xi),a):0}function R(){var a;return N(ck)?(a=Ql,Ql=a+ck,ve(a,rj),re(a,0),te(a,ck),a):0}function S(a){return 0==(pe(a)&Ci)}function T(a,b,c){if(b>c){if(a>b)return b;if(c>a)return c}else{if(b>a)return b;if(a>c)return c}return a}function U(a){return je(a,fi)}function V(a,b){return ke(a,fi,b)}function W(a){return je(a,gi)}function X(a,b){return ke(a,gi,b)}function Y(a){return je(a,hi)}function Z(a,b){return ke(a,hi,b)}function $(a){return h(Pl,a+oi)}function _(a){return je(a,ri)}function aa(a,b){return ke(a,ri,b)}function ba(a){return je(a,si)}function ca(a,b){return ke(a,si,b)}function da(a){return je(a,ei)}function ea(a,b){return ke(a,ei,b)}function fa(a){return je(a,$h)}function ga(a,b){return ke(a,$h,b)}function ha(a){return je(a,_h)}function ia(a,b){return ke(a,_h,b)}function ja(a){return je(a,ai)}function ka(a,b){return ke(a,ai,b)}function la(a){return je(a,bi)}function ma(a,b){return ke(a,bi,b)}function na(a){return je(a,ji)}function oa(a,b){return ke(a,ji,b)}function pa(a,b,c,d){var e,h,i,j,k,l,m,n,o;return i=fa(a),j=ja(a),32===i?(o=0|b[j*d+c],0!==o&&0==(4278190080&o)&&(o|=4278190080),ah(o)):(n=zf()[i],o=b[j*d+g(c,n)],k=f(1,i)-1,n=32-i-(c&f(1,n)-1)*i,o=g(o,n)&k,16===i?0!==o&&(h=(31&o)<<3,h+=h>>>5,l=(o>>>5&31)<<3,l+=l>>>5,m=(o>>>10&31)<<3,m+=m>>>5,e=255,o=h+(l<<8)+(m<<16)+(e<<24)):o=0===da(a)?0:_a(a)[o],ah(o))}function qa(a){return je(a,ci)}function ra(a,b){return ke(a,ci,b)}function sa(a){return hh(gh()-a+4)}function ta(a,b){return ih(gh()-a+4,b)}function ua(a){return hh(gh()-a+5)}function va(a,b){return ih(gh()-a+5,b)}function wa(a){return hh(gh()-a+0)}function xa(a,b){return ih(gh()-a+0,b)}function ya(a){return hh(gh()-a+1)}function za(a,b){return ih(gh()-a+1,b)}function Aa(a){return hh(gh()-a+2)}function Ba(a,b){return ih(gh()-a+2,b)}function Ca(a){return hh(gh()-a+3)}function Da(a,b){return ih(gh()-a+3,b)}function Ea(a,c,d){var e,f,g,h,i,j;for(g=b(a),e=a.wordsAsInt32Array(),h=0,f=0;g-1>=f;f++){if(i=Kf(f,e),!((j=Lf(f,e))>=0&&c>=j))return!1;h+=i}return h===d}function Fa(a){var c,d,e,f;if(!Ml.isWords(a))return!1;for(f=b(a),d=a.wordsAsInt32Array(),e=0;f-1>=e;e++)if(c=d[e],!Zc(c))return!1;return!0}function Ga(a,c){var d,e,f,g,h;for(e=b(a),g=a.wordsAsInt32Array(),f=0,d=0;e-1>=d;d++)h=Kf(d,g),f+=h;return f===c}function Ha(a,c){var d;return!!Ml.isWords(a)&&((d=b(a))===3*c||d===6*c)}function Ia(a,c,d,e,f,g,h){var i;return!(!Ha(a,c)||!Fa(h))&&(i=b(h),!!(Ea(d,i,c)&&Ea(e,i,c)&&Ea(g,i,c)&&Ga(f,c)))}function Ja(a){var b;return b=bd(a)?ph(a):0,W(a)+b<$b()?0:zb(a)-b>=Ub()&&U(a)-b>=Ub()?0:void y(a)}function Ka(a){return $c(a)?La(a):Vc(a)?Ja(a):void y(a)}function La(a){var b;return b=bd(a)?Ah(a):0,md(a)+b<$b()?0:zb(a)-b>=Ub()&&kd(a)-b>=Ub()?0:void y(a)}function Ma(){return[1,.98078528040323,.923879532511287,.831469612302545,.7071067811865475,.555570233019602,.38268343236509,.1950903220161286,0,-.1950903220161283,-.3826834323650896,-.555570233019602,-.707106781186547,-.831469612302545,-.9238795325112865,-.98078528040323,-1,-.98078528040323,-.923879532511287,-.831469612302545,-.707106781186548,-.555570233019602,-.3826834323650903,-.1950903220161287,0,.1950903220161282,.38268343236509,.555570233019602,.707106781186547,.831469612302545,.9238795325112865,.98078528040323,1]}function Na(){return[0,.1950903220161282,.3826834323650897,.555570233019602,.707106781186547,.831469612302545,.923879532511287,.98078528040323,1,.98078528040323,.923879532511287,.831469612302545,.7071067811865475,.555570233019602,.38268343236509,.1950903220161286,0,-.1950903220161283,-.3826834323650896,-.555570233019602,-.707106781186547,-.831469612302545,-.9238795325112865,-.98078528040323,-1,-.98078528040323,-.923879532511287,-.831469612302545,-.707106781186548,-.555570233019602,-.3826834323650903,-.1950903220161287,0]}function Oa(a,b){return 0>a?0:a>=b?b-1:a}function Pa(){var a,b;for(a=g(Vf(),u()),b=g(Rf(),u())+1,0>a&&(a=0),b>Tf()&&(b=Tf());b>a;)Rl[a]=0,++a;Wf(Tf()),Sf(0)}function Qa(){return Sl[uk]}function Ra(a){return Sl[uk]=a}function Sa(){return Sl[vk]}function Ta(a){return Sl[vk]=a}function Ua(){return Sl[wk]}function Va(a){return Sl[wk]=a}function Wa(){return Sl[xk]}function Xa(a){return Sl[xk]=a}function Ya(){return Sl[yk]}function Za(a){return Sl[yk]=a}function $a(){return i(Sl,zk)}function _a(a){return h(Pl,a+di)}function ab(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o;return e=l=wa(a),f=m=ya(a),h=n=Aa(a),i=o=Ca(a),c=sa(a),d=ua(a),j=e+=(n-l)*b|0,k=f+=(o-m)*b|0,h+=(c-n)*b|0,i+=(d-o)*b|0,j+=(h-e)*b|0,k+=(i-f)*b|0,f=T(f,m,k),i=T(i,k,d),g=I(),Il?0:(Ba(a,e),Da(a,f),ta(a,j),va(a,k),xa(g,j),za(g,k),Ba(g,h),Da(g,i),ta(g,c),va(g,d),g)}function bb(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;return f=I(),Il?0:(d=k=wa(a),e=l=ya(a),g=m=Aa(a),h=n=Ca(a),b=sa(a),c=ua(a),d+=m-k>>1,e+=n-l>>1,i=g+=b-m>>1,j=h+=c-n>>1,i+=d-g>>1,j+=e-h>>1,Ba(a,d),Da(a,e),ta(a,i),va(a,j),xa(f,i),za(f,j),Ba(f,g),Da(f,h),ta(f,b),va(f,c),f)}function cb(a,b){var c,d,e;c=$(a)[pi]>>8,d=th(a)[pi]>>8,c>d&&(e=c,c=d,d=e),Ab(a,c),d-c>b?vh(a,d-c):vh(a,b)}function db(a){return 32>a?Nf()[a]:Math.sqrt(a)+.5|0}function eb(a,b,c){return!(!Dl&&!Rc())&&Dl(a,b,c)}function fb(){var a,b;for(b=0,a=Ql;a>b;)Wc(b)&&(Bb(b)>=Wb()||Ka(b)),b+=se(b)}function gb(){return Sl[Jk]}function hb(a){return Sl[Jk]=a}function ib(){return Sl[Kk]}function jb(a){return Sl[Kk]=a}function kb(){return Sl[Lk]}function lb(a){return Sl[Lk]=a}function mb(){return Sl[Mk]}function nb(a){return Sl[Mk]=a}function ob(a){var b,c,d;return b=g(Vf(),u()),b<Wa()&&(b=Wa()),c=g(Rf()+q()-1,u()),c>Sa()&&(c=Sa()),d=g(a,u()),d<Ya()||d>=Ua()||c<Wa()||b>=Sa()?0:void eb(b,c,d)}function pb(a){return ve(a,ue(a)|Ci)}function qb(a){return ve(a,ue(a)&~Ci)}function rb(a){return je(a,_i)}function sb(a,b){return ke(a,_i,b)}function tb(a){return je(a,bj)}function ub(a,b){return ke(a,bj,b)}function vb(a){return je(a,aj)}function wb(a,b){return ke(a,aj,b)}function xb(){return i(Sl,Nk)}function yb(a){return ue(a)>>>1}function zb(a){return je(a,Cj)}function Ab(a,b){return ke(a,Cj,b)}function Bb(a){return je(a,Dj)}function Cb(a,b){return ke(a,Dj,b)}function Db(a){return je(a,Ej)}function Eb(a,b){return ke(a,Ej,b)}function Fb(){}function Gb(a,b){var c,d,e;for(c=Og(),d=a,e=Vg();b>e;){if(0!==(c=Og())&&pc(c,d,e))return!0;xf(e),d=e,e=Vg()}return 0!==(c=Og())&&pc(c,d,b)}function Hb(){return Jb(ed(),gd(),id(),gb())}function Ib(a,b,c){var d,e,f,h,i,k,m,n;if(m=b,n=c,e=-1,1===q())for(;n>m;)i=0|a[++e],Rl[m]=i,++m;else for(f=j(),h=l(),d=u();n>m;)k=g(m,d),i=0|a[++e],i=g(i&f,h),Rl[k]=Rl[k]+i,++m;n>Rf()&&Sf(n),n>Pf()&&Qf(n)}function Jb(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,r,s,t;if(1!==q())return Kb(a,b,c,d);if(!(e=Gd(a)))return null;for(g=qa(a),f=ha(a),o=1===na(a),h=b-ec(a),i=d-gc(a),k=Nb(a),m=ac(a),j=h*k+i*Pb(a),l=h*m+i*cc(a),p=b,r=c;r>p;)o&&(j=Bf(j,g<<16),l=Bf(l,f<<16)),s=j>>16,t=l>>16,o||(s=Oa(s,g),t=Oa(t,f)),s>=0&&t>=0&&g>s&&f>t&&(n=pa(a,e,s,t),Rl[p]=n),j+=k,l+=m,++p}function Kb(a,b,c,d){var e,h,i,k,m,o,r,s,t,v,w,x,y,z,A,B,C,D,E,F,G;if(!(i=Gd(a)))return null;for(m=qa(a),k=ha(a),D=1===na(a),s=b-ec(a),t=d-gc(a),w=Nb(a),y=ac(a),v=s*w+t*Pb(a),x=s*y+t*cc(a),e=q(),A=n(b,c),C=p(b,c),h=u(),o=j(),r=l(),E=b;A>E;)D&&(v=Bf(v,m<<16),x=Bf(x,k<<16)),F=v>>16,G=x>>16,D||(F=Oa(F,m),G=Oa(G,k)),F>=0&&G>=0&&m>F&&k>G&&(z=pa(a,i,F,G),z=g(z&o,r),B=g(E,h),Rl[B]=Rl[B]+z),v+=w,x+=y,++E;for(o=4042322160|g(j(),u()),r=u();C>E;)D&&(v=Bf(v,m<<16),x=Bf(x,k<<16)),F=v>>16,G=x>>16,D||(F=Oa(F,m),G=Oa(G,k)),F>=0&&G>=0&&m>F&&k>G&&(z=pa(a,i,F,G),z=g(z&o,r),B=g(E,h),Rl[B]=Rl[B]+z),v+=f(w,r),x+=f(y,r),E+=e;for(o=j(),r=l();c>E;)D&&(v=Bf(v,m<<16),x=Bf(x,k<<16)),F=v>>16,G=x>>16,D||(F=Oa(F,m),G=Oa(G,k)),F>=0&&G>=0&&m>F&&k>G&&(z=pa(a,i,F,G),z=g(z&o,r),B=g(E,h),Rl[B]=Rl[B]+z),v+=w,x+=y,++E}function Lb(a,b,c){var d,e;if(1!==q())return Mb(a,b,c);for(d=b,e=c;e>d+4;)Rl[d]=a,Rl[d+1]=a,Rl[d+2]=a,Rl[d+3]=a,d+=4;for(;e>d;)Rl[d]=a,++d}function Mb(a,b,c){var d,e,f,h,i,k,m,o;if(h=n(b,c),k=p(b,c),d=q(),e=u(),o=b,h>o)for(m=g(a&j(),l());h>o;)i=g(o,e),Rl[i]=Rl[i]+m,++o;if(k>o)for(f=4042322160|g(j(),u()),m=g(a&f,u());k>o;)i=g(o,e),Rl[i]=Rl[i]+m,o+=d;if(c>o)for(m=g(a&j(),l());c>o;)i=g(o,e),Rl[i]=Rl[i]+m,++o}function Nb(a){return je(a,Lj)}function Ob(a,b){return ke(a,Lj,b)}function Pb(a){return je(a,Mj)}function Qb(a,b){return ke(a,Mj,b)}function Rb(){return Sb(ed(),gd(),id(),gb())}function Sb(a,b,c,d){var e,f,g,h,i,j,k,l;for(g=Fc(a),i=Dc(a),f=Nb(a),e=(b-ec(a))*f+(d-gc(a))*Pb(a),j=k=b,l=c;((h=e>>16)<0||h>=i)&&l>j;)++j,e+=f;if(j>k&&(0>h&&(h=0),h>=i&&(h=i-1),Lb(g[h],k,j)),1===q())for(;(h=e>>16)<i&&h>=0&&l>j;)Rl[j]=g[h],++j,e+=f;else j=Tb(a,g,e,f,j,c);l>j&&(0>h&&(h=0),h>=i&&(h=i-1),Lb(g[h],j,l))}function Tb(a,b,c,d,e,h){var i,k,m,o,r,s,t,v,w,x,y,z;for(i=q(),k=u(),x=Dc(a),r=c,z=e,w=r>>16,s=n(e,h),v=p(e,h),m=j(),o=l();s>z&&x>w&&w>=0;){for(y=b[w],y=g(y&m,o);s>z&&r>>16===w;)t=g(z,k),Rl[t]=Rl[t]+y,++z,r+=d;w=r>>16}for(m=4042322160|g(j(),u()),o=u();v>z&&x>w&&w>=0;){for(y=b[w],y=g(y&m,o);v>z&&r>>16===w;)t=g(z,k),Rl[t]=Rl[t]+y,z+=i,r+=f(d,o);w=r>>16}for(m=j(),o=l();h>z&&x>w&&w>=0;){for(y=b[w],y=g(y&m,o);h>z&&r>>16===w;)t=g(z,k),Rl[t]=Rl[t]+y,++z,r+=d;w=r>>16}return z}function Ub(){return Sl[Ok]}function Vb(a){return Sl[Ok]=a}function Wb(){return Sl[Pk]}function Xb(a){return Sl[Pk]=a}function Yb(){return Sl[Qk]}function Zb(a){return Sl[Qk]=a}function $b(){return Sl[Rk]}function _b(a){return Sl[Rk]=a}function ac(a){return je(a,Nj)}function bc(a,b){return ke(a,Nj,b)}function cc(a){return je(a,Oj)}function dc(a,b){return ke(a,Oj,b)}function ec(a){return je(a,Pj)}function fc(a,b){return ke(a,Pj,b)}function gc(a){return je(a,Qj)}function hc(a,b){return ke(a,Qj,b)}function ic(a,b,c,d,e,f,g){var h,i,j,k,l,m,n,o;for(h=0|c[0],i=0|c[1],l=x(h>>16,i>>16),m=b[l],j=(l-1)*(l-1),n=f,(o=g)>ec(a)&&(o=ec(a));o>n;){for(;o>n&&Xf(h>>16,i>>16)>=j;)Rl[n]=m,++n,h+=d,i+=e;for(k=Xf(h>>16,i>>16);j>k;)--l,m=b[l],j=(l-1)*(l-1)}return c[0]=h,c[1]=i,n}function jc(a,b,c,d,e,h,i){var k,m,o,r,s,t,v,w,y,z,A,B,C,D,E;if(s=0|c[0],t=0|c[1],k=q(),m=u(),B=x(s>>16,t>>16),z=(B-1)*(B-1),D=h,E=ec(a),E>i&&(E=i),v=n(h,E),y=p(h,E),v>D)for(o=j(),r=l(),C=b[B],C=g(C&o,r);v>D;){for(;v>D&&Xf(s>>16,t>>16)>=z;)w=g(D,m),Rl[w]=Rl[w]+C,++D,s+=d,t+=e;for(A=Xf(s>>16,t>>16);z>A;)--B,C=b[B],C=g(C&o,r),z=(B-1)*(B-1)}if(y>D)for(o=4042322160|g(j(),u()),r=u(),C=b[B],C=g(C&o,r);y>D;){for(;y>D&&Xf(s>>16,t>>16)>=z;)w=g(D,m),Rl[w]=Rl[w]+C,D+=k,s+=f(d,r),t+=f(e,r);for(A=Xf(s>>16,t>>16);z>A;)--B,C=b[B],C=g(C&o,r),z=(B-1)*(B-1)}if(E>D)for(o=j(),r=l(),C=b[B],C=g(C&o,r);E>D;){for(;E>D&&Xf(s>>16,t>>16)>=z;)w=g(D,m),Rl[w]=Rl[w]+C,++D,s+=d,t+=e;for(A=Xf(s>>16,t>>16);z>A;)--B,C=b[B],C=g(C&o,r),z=(B-1)*(B-1)}return c[0]=s,c[1]=t,D}function kc(){return lc(ed(),gd(),id(),gb())}function lc(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p;for(m=Fc(a),n=Dc(a),f=b-ec(a),g=d-gc(a),i=Nb(a),k=ac(a),h=f*i+g*Pb(a),j=f*k+g*cc(a),o=b,p=c,l=(n-1)*(n-1);Xf(h>>16,j>>16)>=l&&p>o;)++o,h+=i,j+=k;o>b&&Lb(m[n-1],b,o),e=xe(),e[0]=h,e[1]=j,o<ec(a)&&(o=1===q()?ic(a,m,e,i,k,o,p):jc(a,m,e,i,k,o,p)),p>o&&(o=1===q()?mc(a,m,e,i,k,o,p):nc(a,m,e,i,k,o,p)),c>o&&Lb(m[n-1],o,c)}function mc(a,b,c,d,e,f,g){var h,i,j,k,l,m,n,o,p,q;for(h=0|c[0],i=0|c[1],m=x(h>>16,i>>16),o=b[m],n=Dc(a),k=(n-1)*(n-1),l=(m+1)*(m+1),j=Xf(h>>16,i>>16),p=f,q=g;q>p&&k>j;){for(;q>p&&Xf(h>>16,i>>16)<=l;)Rl[p]=o,++p,h+=d,i+=e;for(j=Xf(h>>16,i>>16);j>l;)++m,o=b[m],l=(m+1)*(m+1)}return c[0]=h,c[1]=i,p}function nc(a,b,c,d,e,h,i){var k,m,o,r,s,t,v,w,y,z,A,B,C,D,E,F;if(s=0|c[0],t=0|c[1],k=q(),m=u(),C=x(s>>16,t>>16),D=Dc(a),A=(D-1)*(D-1),B=(C+1)*(C+1),y=Xf(s>>16,t>>16),F=h,v=n(h,i),z=p(h,i),v>F&&A>y)for(o=j(),r=l(),E=b[C],E=g(E&o,r);v>F&&A>y;){for(;v>F&&Xf(s>>16,t>>16)<=B;)w=g(F,m),Rl[w]=Rl[w]+E,++F,s+=d,t+=e;for(y=Xf(s>>16,t>>16);y>B;)++C,E=b[C],E=g(E&o,r),B=(C+1)*(C+1)}if(z>F&&A>y)for(o=4042322160|g(j(),u()),r=u(),E=b[C],E=g(E&o,r);z>F&&A>y;){for(;z>F&&Xf(s>>16,t>>16)<=B;)w=g(F,m),Rl[w]=Rl[w]+E,F+=k,s+=f(d,r),t+=f(e,r);for(y=Xf(s>>16,t>>16);y>B;)++C,E=b[C],E=g(E&o,r),B=(C+1)*(C+1)}if(i>F&&A>y)for(o=j(),r=l(),E=b[C],E=g(E&o,r);i>F&&A>y;){for(;i>F&&Xf(s>>16,t>>16)<=B;)w=g(F,m),Rl[w]=Rl[w]+E,++F,s+=d,t+=e;for(y=Xf(s>>16,t>>16);y>B;)++C,E=b[C],E=g(E&o,r),B=(C+1)*(C+1)}return c[0]=s,c[1]=t,F}function oc(a,b){var c;return c=Yf(a)-Yf(b),0!==c?c>0:cg(a)>>>0<cg(b)>>>0}function pc(a,b,c){var d,e,g;if(0===a)return!1;if(e=b<Pf()?Pf():b,g=c>f(Tf(),u())?f(Tf(),u()):c,e<Yb()&&(e=Yb()),g>Ub()&&(g=Ub()),e<Vf()&&Wf(e),g>Rf()&&Sf(g),g>Pf()&&Qf(g),e>=g)return!1;if(Yc(a))Lb(a,e,g);else{if(fd(a),hd(e),jd(g),1>=(d=qc(a)))return!0;switch(d){case 0:case 1:Fb();break;case 2:Rb();break;case 3:kc();break;case 4:case 5:Hb()}}return!1}function qc(a){return(ue(a)&kj)>>>8}function rc(){var a,b,c;for(c=gb();zc()<Bc();){if(a=Ll[zc()],Bb(a)>c)return!1;if(((b=ue(a))&sj)===hj)return!0;if(!fe(1))return!1;switch(b){case 0:case 1:case 2:case 3:Fb();break;case 4:ig();break;case 5:mg();break;case 6:gg();break;case 7:kg()}Tc(a),Ac(zc()+1)}return!1}function sc(){var a,b,c,d;for(b=d=Ub();C()<E();){if(a=c=Bl[C()],(b=d=zb(a))>=Ub())return!1;if(xf(b),bd(a)&&Mg(a),S(a)&&(Lg(a),Il))return!1;D(C()+1),C()<E()&&(c=Bl[C()],(d=zb(c))>=Yb()&&Gb(b,d))}return d<Ub()&&Gb(d,Ub()),!1}function tc(){for(var a,b,c;C()<E();)if(b=Bl[C()],0===(a=tb(b)-1))Af();else{if(ub(b,a),((c=ue(b))&sj)===hj)return!0;switch(c){case 0:case 1:case 2:case 3:Fb();break;case 4:rg();break;case 5:vg();break;case 6:og();break;case 7:tg()}Df(),D(C()+1)}return!1}function uc(a,b){var c;for(c=0;c<bg()&&(cg(c)!==a||Yf(c)!==b);)c+=$f();return c>=bg()?-1:c}function vc(){return eg()===vj}function wc(){eh($f())}function xc(){return Ol}function yc(a,b){var c;return a===b||(c=Bb(a)-Bb(b),0!==c?0>c:0>(c=zb(a)-zb(b)))}function zc(){return Sl[Sk]}function Ac(a){return Sl[Sk]=a}function Bc(){return Sl[Tk]}function Cc(a){return Sl[Tk]=a}function Dc(a){return je(a,Rj)}function Ec(a,b){return ke(a,Rj,b)}function Fc(a){return h(Pl,a+Sj)}function Gc(){return 0!==Hc()}function Hc(){return Sl[Uk]}function Ic(a){return Sl[Uk]=a}function Jc(){return 0!==Kc()}function Kc(){return Sl[Vk]}function Lc(a){return Sl[Vk]=a}function Mc(a,b){var c,d,e,f,g;if(-1===(c=uc(a,b)))return!1;if(0===c)return wc(),!0;if(dg(c,cg(0)),Zf(c,Yf(0)),ag(c,_f(0)),wc(),bg()<=$f())return!0;for(g=0,c=$f();c<bg();)oc(c,g)&&(g=c),c+=$f();return g+$f()===bg()||(f=cg(g),dg(g,Tg()),Ug(f),d=Yf(g),Zf(g,Pg()),Qg(d),e=_f(g),ag(g,Rg()),Sg(e),!0)}function Nc(a,b){return Sl[a]=Sl[a]+b}function Oc(a){var b,c;for(c=zb(a),b=0;b<E()&&zb(Bl[b])<c;)++b;for(;b<E()&&zb(Bl[b])===c&&yc(Bl[b],a);)++b;return b}function Pc(){var a;a=$a(),a[0]=1,a[1]=0,a[2]=1,a[3]=0,a[4]=1,a[5]=0,a[6]=1,a[7]=0,Ic(0)}function Qc(){var a;a=xb(),a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,Lc(0)}function Rc(){return Nl=Ml.ioLoadFunctionFrom("loadBitBltFrom",Cl),Dl=Ml.ioLoadFunctionFrom("copyBitsFromtoat",Cl),!!Nl&&!!Dl}function Sc(){return If(q()),Wa()<0&&Xa(0),Sa()>Tf()&&Ta(Tf()),Zb(f(Wa(),u())),_b(f(Ya(),u())),Vb(f(Sa(),u())),Xb(f(Ua(),u())),Cc(0),F(0),Ll=h(Pl,Ql),Bl=h(Pl,Ql),fb(),Il?null:0===Bc()?(hb(Wb()),0):(Of(),hb(Bb(Ll[0])),gb()<$b()&&hb($b()),Wf(0),Sf(f(Tf(),u())-1),void Pa())}function Tc(a){var b;return tb(a)<=0?null:(b=Oc(a),void Uc(a,b))}function Uc(a,b){var c;if(!G(1))return null;for(c=E()-1;!(b>c);)Bl[c+1]=Bl[c],--c;Bl[b]=a,F(E()+1)}function Vc(a){return(ue(a)&sj)===fj}function Wc(a){return!(ue(a)>ij)&&0!=(ue(a)&ij)}function Xc(a){return Yc(a)||ad(a)}function Yc(a){return 0!=(4278190080&a)}function Zc(a){return 0===a||Yc(a)||_c(a)&&Xc(a)}function $c(a){return(ue(a)&sj)===lj}function _c(a){return a>=0&&Ql>a}function ad(a){return 0!=(ue(a)&kj)}function bd(a){return 0!=(ue(a)&pj)}function cd(){return Sl[Xk]}function dd(a){return Sl[Xk]=a}function ed(){return Sl[Yk]}function fd(a){return Sl[Yk]=a}function gd(){return Sl[Zk]}function hd(a){return Sl[Zk]=a}function id(){return Sl[$k]}function jd(a){return Sl[$k]=a}function kd(a){return je(a,Vj)}function ld(a,b){return ke(a,Vj,b)}function md(a){return je(a,Wj)}function nd(a,b){return ke(a,Wj,b)}function od(a){return je(a,Yj)}function pd(a,b){return ke(a,Yj,b)}function qd(a){return je(a,Zj)}function rd(a,b){return ke(a,Zj,b)}function sd(a){return je(a,Xj)}function td(a,b){return ke(a,Xj,b)}function ud(a){return je(a,ek)}function vd(a,b){return ke(a,ek,b)}function wd(a){return je(a,fk)}function xd(a,b){return ke(a,fk,b)}function yd(a,b){return ke(a,gk,b)}function zd(a,b,c,e){var f,g,h,i,j;if(f=I(),Il)return 0;for(xa(f,a[0]),za(f,a[1]),Ba(f,b[0]),Da(f,b[1]),ta(f,c[0]),va(f,c[1]),j=g=Hg(f,e),h=f;g>=h;h+=6)if(i=Gg(h),i>j&&(j=i),Il)return 0;return d(j,6)}function Ad(a,b,c,d,e){var f,g,h,i,j;if(Sd(xe(),Ml.fetchPointerofObject(0,a)),Ml.failed())return null;for(g=xe()[0],i=xe()[1],f=1;b-1>=f;f++){if(Sd(xe(),Ml.fetchPointerofObject(f,a)),Ml.failed())return null;if(h=xe()[0],j=xe()[1],xe()[0]=g,xe()[1]=i,ye()[0]=h,ye()[1]=j,$g(2),$d(d,xe(),ye(),e,c,0),Il)return null;g=h,i=j}}function Bd(a,b,c,d,e){var f,g,h,i,j,k,l,m,n;for(f=0;b-1>=f;f++){if(g=Ml.fetchPointerofObject(3*f,a),Sd(xe(),g),g=Ml.fetchPointerofObject(3*f+1,a),Sd(ye(),g),g=Ml.fetchPointerofObject(3*f+2,a),Sd(ze(),g),Ml.failed())return null;if($g(3),i=xe()[0],l=xe()[1],j=ye()[0],m=ye()[1],k=ze()[0],n=ze()[1],i===l&&j===m||j===k&&m===n)$d(d,xe(),ze(),e,c,0);else{if(h=zd(xe(),ye(),ze(),0!==d&&0!==e),Il)return null;Zd(d,e,c,0,h)}if(Il)return null}}function Cd(a,b,c){var d,e;for(d=0;c-1>=d;d++){if("number"!=typeof(e=Ml.fetchPointerofObject(d,a))&&!e.isFloat)return Ml.primitiveFail();b[d]="number"==typeof e?e:Ml.floatValueOf(e)}}function Dd(a,b,c,d,e){ua(b)>=ya(b)?(Ab(a,wa(b)),Cb(a,ya(b)-e),aa(a,Aa(b)),ca(a,Ca(b)-e),V(a,sa(b)),X(a,ua(b)-e)):(Ab(a,sa(b)),Cb(a,ua(b)-e),aa(a,Aa(b)),ca(a,Ca(b)-e),V(a,wa(b)),X(a,ya(b)-e)),Eb(a,ib()),sb(a,c),wb(a,d)}function Ed(a){return!(!Nl&&!Rc())&&Nl(a)}function Fd(c,e,g,h,i,j,k){var l,m,n,o,p,q,r,s,t,u;if(e.isNil)t=0,s=null;else{if(a(e)!==Ml.classBitmap())return Ml.primitiveFail();t=b(e),s=e.wordsAsInt32Array()}return"number"==typeof c?Ml.primitiveFail():Ml.isPointers(c)?b(c)<5?Ml.primitiveFail():(l=Ml.fetchPointerofObject(0,c),a(l)!==Ml.classBitmap()?Ml.primitiveFail():(m=b(l),r=Ml.fetchIntegerofObject(1,c),p=Ml.fetchIntegerofObject(2,c),n=Ml.fetchIntegerofObject(3,c),Ml.failed()?null:r>=0&&p>=0?32!==n&&8!==n&&16!==n&&1!==n&&2!==n&&4!==n?Ml.primitiveFail():0!==t&&t!==f(1,n)?Ml.primitiveFail():(u=d(32,n),q=d(r+(u-1),u),m!==q*p?Ml.primitiveFail():(o=J(t,s),Il?null:(ra(o,r),ia(o,p),ga(o,n),ka(o,q),ma(o,m),oa(o,g),re(o,k),Md(o,h,i,j,r,p),o))):Ml.primitiveFail())):Ml.primitiveFail()}function Gd(a){var c,d,e,f;return f=qe(a),f>b(Jl)?null:(e=Ml.fetchPointerofObject(f,Jl),d=Ml.fetchPointerofObject(0,e),c=b(d),c!==la(a)?null:d.wordsAsInt32Array())}function Hd(a){var b,c;return c=$a(),Ic(0),!!(b=Yd(a,c,8))&&(Ic(1),c[1]=256*c[1],c[3]=256*c[3],c[5]=256*c[5],c[7]=256*c[7],b)}function Id(a,b,c,d,e,f,g){var h,i,j,k,l,m,n,o;return d!==e||0!==f&&0!==g?(h=6*a,c?(j=(b.int16Array||(b.int16Array=new Int16Array(b.buffer,b.byteOffset)))[h+0],m=(b.int16Array||(b.int16Array=new Int16Array(b.buffer,b.byteOffset)))[h+1],k=(b.int16Array||(b.int16Array=new Int16Array(b.buffer,b.byteOffset)))[h+2],n=(b.int16Array||(b.int16Array=new Int16Array(b.buffer,b.byteOffset)))[h+3],l=(b.int16Array||(b.int16Array=new Int16Array(b.buffer,b.byteOffset)))[h+4],o=(b.int16Array||(b.int16Array=new Int16Array(b.buffer,b.byteOffset)))[h+5]):(j=0|b[h+0],m=0|b[h+1],k=0|b[h+2],n=0|b[h+3],l=0|b[h+4],o=0|b[h+5]),j===k&&m===n||k===l&&n===o?j===l&&m===o?null:(xe()[0]=j,xe()[1]=m,ye()[0]=l,ye()[1]=o,$g(2),$d(f,xe(),ye(),g,d,e)):(xe()[0]=j,xe()[1]=m,ye()[0]=k,ye()[1]=n,ze()[0]=l,ze()[1]=o,$g(3),i=zd(xe(),ye(),ze(),0!==f&&0!==g),Il?null:void Zd(f,g,d,e,i))):null}function Jd(a,b,c,d,e,f,g,h){var i,j,k,l,m,n,o,p,q,r,s,t,u;if(0===b)return 0;for(k=q=t=n=-1,j=p=s=m=1,l=r=u=o=0,i=1;b>=i;i++){if(--j<=0&&(++k,j=Kf(k,c),0!==(l=Lf(k,c))&&(l=g[l-1],l=Wg(l),Il)))return null;if(--p<=0&&(++q,p=Kf(q,d),0!==(r=Lf(q,d))&&(r=g[r-1],r=Wg(r))),--s<=0&&(++t,s=Kf(t,e),0!==(u=Lf(t,e))&&(u=_g(u))),--m<=0&&(++n,m=Kf(n,f),0!==(o=Lf(n,f))&&(o=g[o-1])),Id(i-1,a,h,l,r,u,o),Il)return null}}function Kd(a){var c;return c=cd(),b(a)<Oh?null:(Ab(c,Ml.fetchIntegerofObject(Rh,a)),Cb(c,Ml.fetchIntegerofObject(Sh,a)),Eb(c,Ml.fetchIntegerofObject(Th,a)),ub(c,Ml.fetchIntegerofObject(Qh,a)),c)}function Ld(a){var b,c;return Lc(0),c=xb(),b=Yd(a,c,6),Ml.failed()?null:!!b&&(Lc(1),c[2]=c[2]+kb(),c[5]=c[5]+mb(),!0)}function Md(a,b,c,d,e,f){var g,h,i,j,k,l,m,n,o,p;c[0]=c[0]+b[0],c[1]=c[1]+b[1],d[0]=d[0]+b[0],d[1]=d[1]+b[1],Xg(b),Xg(c),Xg(d),g=c[0]-b[0],h=c[1]-b[1],o=d[0]-b[0],p=d[1]-b[1],i=g*g+h*h,i>0?(j=g*e*65536/i|0,k=h*e*65536/i|0):(j=0,k=0),l=o*o+p*p,l>0?(m=o*f*65536/l|0,n=p*f*65536/l|0):(m=0,n=0),fc(a,b[0]),hc(a,b[1]),Ob(a,j),Qb(a,k),bc(a,m),dc(a,n)}function Nd(c){var e,f,g,h,i,j,k,l,m;if(!Ml.isArray(c))return!1;for(Jl=c,l=0;l<=b(Jl)-1;l++){if("number"==typeof(k=Ml.fetchPointerofObject(l,Jl)))return!1;if(!Ml.isPointers(k))return!1;if(b(k)<5)return!1;if(e=Ml.fetchPointerofObject(0,k),a(e)!==Ml.classBitmap())return!1;if(f=b(e),j=Ml.fetchIntegerofObject(1,k),h=Ml.fetchIntegerofObject(2,k),g=Ml.fetchIntegerofObject(3,k),Ml.failed())return!1;if(!(j>=0&&h>=0))return!1;if(m=d(32,g),i=d(j+(m-1),m),f!==i*h)return!1}return!0}function Od(c,d,e,f,g){var h,i;return a(c)!==Ml.classBitmap()?Ml.primitiveFail():(i=b(c),h=L(c.wordsAsInt32Array(),i,g),Il?null:(Md(h,d,e,f,i,i),h))}function Pd(a,b,c,d,e,f){var g,h,i;b[1]<=c[1]?(g=b,h=c,i=1):(g=c,h=b,i=-1),Ab(a,g[0]),Cb(a,g[1]-d),Eb(a,ib()),sb(a,e),wb(a,f),ld(a,h[0]),nd(a,h[1]-d),yd(a,i)}function Qd(a,b,c,d){var e,f,g,h,i,j;for(j=ye()[0]-xe()[0]>>1,g=ye()[1]-xe()[1]>>1,e=ye()[0]+xe()[0]>>1,f=ye()[1]+xe()[1]>>1,h=0;15>=h;h++){if(Rd(h,j,g,e,f),$g(3),i=zd(xe(),ye(),ze(),0!==a&&0!==b),Il)return null;if(Zd(a,b,c,d,i),Il)return null}}function Rd(a,b,c,d,e){var f,g,h,i,j,k;f=Ma()[2*a+0]*b+d|0,i=Na()[2*a+0]*c+e|0,xe()[0]=f,xe()[1]=i,h=Ma()[2*a+2]*b+d|0,k=Na()[2*a+2]*c+e|0,ze()[0]=h,ze()[1]=k,g=Ma()[2*a+1]*b+d|0,j=Na()[2*a+1]*c+e|0,g=2*g-(f+h>>1),j=2*j-(i+k>>1),ye()[0]=g,ye()[1]=j}function Sd(b,c){var d;return a(c)!==Ml.classPoint()?Ml.primitiveFail():(d=Ml.fetchPointerofObject(0,c),"number"==typeof d||d.isFloat?(b[0]="number"==typeof d?d:0|Ml.floatValueOf(d),d=Ml.fetchPointerofObject(1,c),"number"==typeof d||d.isFloat?void(b[1]="number"==typeof d?d:0|Ml.floatValueOf(d)):Ml.primitiveFail()):Ml.primitiveFail())}function Td(a,b,c,d,e,f){var g,h,i,j,k;for(f?(h=(a.int16Array||(a.int16Array=new Int16Array(a.buffer,a.byteOffset)))[0],j=(a.int16Array||(a.int16Array=new Int16Array(a.buffer,a.byteOffset)))[1]):(h=0|a[0],j=0|a[1]),g=1;b-1>=g;g++){if(f?(i=(a.int16Array||(a.int16Array=new Int16Array(a.buffer,a.byteOffset)))[2*g],k=(a.int16Array||(a.int16Array=new Int16Array(a.buffer,a.byteOffset)))[2*g+1]):(i=0|a[2*g],k=0|a[2*g+1]),xe()[0]=h,xe()[1]=j,ye()[0]=i,ye()[1]=k,$g(2),$d(d,xe(),ye(),e,c,0),Il)return null;h=i,j=k}}function Ud(a,b,c,d){$d(a,xe(),ye(),b,c,d),$d(a,ye(),ze(),b,c,d),$d(a,ze(),Ae(),b,c,d),$d(a,Ae(),xe(),b,c,d)}function Vd(){var a,c,d,e;return 2!==Ml.methodArgumentCount()?Al:0!==(c=uf(Ml.stackValue(2)))?c:(d=Ml.stackObjectValue(0),a=Ml.stackObjectValue(1),Ml.failed()?zl:0!==(c=Xd(Ml.fetchPointerofObject(Mh,Hl)))?c:Ed(Ml.fetchPointerofObject(Kh,Hl))?Nd(Ml.fetchPointerofObject(Lh,Hl))?b(a)<Oh?Hi:b(d)<Uh?Oi:(e=eg(),e===Aj||e===Bj||e===zj?$i:0):Pi:Fi)}function Wd(a,b,c,d,e,f){var g;for(g=1;b>=g;g++)if(Id(g-1,a,f,c,0,d,e),Il)return null}function Xd(c){return a(c)!==Ml.classBitmap()?Gi:(Rl=c.words,Uf(b(c)-1),0)}function Yd(a,c,d){return!a.isNil&&("number"==typeof a?Ml.primitiveFail():b(a)!==d?Ml.primitiveFail():(Ml.isWords(a)?_d(a,c,d):Cd(a,c,d),!0))}function Zd(a,b,c,d,e){var f,g,h,i;for(0===a||0===b?(i=!1,h=0):(i=!0,h=we(a)),g=6*e;g>0;){if(f=i?Q():H(),Il)return 0;Dd(f,g,c,d,h),i&&(sh(f,b),vh(f,a),qh(f,a)),g-=6}dh()}function $d(a,b,c,d,e,f){var g,h;return 0===a||0===d?(g=M(),h=0):(g=R(),h=we(a)),Il?0:(Pd(g,b,c,h,e,f),void(bd(g)&&(Dh(g,d),Fh(g,a),Bh(g,a))))}function _d(a,b,c){var d,e;for(e=a.wordsAsFloat32Array(),d=0;c-1>=d;d++)b[d]=e[d]}function ae(a){return"number"==typeof a?Si:Ml.isWords(a)?b(a)<bl?Vi:(Gh(a),be()!==al?Ri:bh()!==b(a)?Wi:le()!==Wk?Ui:(Pl=h(Sl,le()),Ll=h(Pl,ne()),Bl=h(Ll,Bc()),Wk+ne()+Bc()+E()>bh()?Xi:0)):Ti}function be(){return Sl[_k]}function ce(a){return Sl[_k]=a}function de(a){0===strcmp(a,Cl)&&(Nl=0,Dl=0)}function ee(a,b,c){var d;for(d=a;d>0&&zb(Bl[d-1])>c;)Bl[d]=Bl[d-1],--d;Bl[d]=b}function fe(a){return!(Wk+Ql+Bc()+E()+a>jh())||(xg(Kj),!1)}function ge(){return 0!==he()}function he(){return Sl[cl]}function ie(a){return Sl[cl]=a}function je(a,b){return Pl[a+b]}function ke(a,b,c){return Pl[a+b]=c}function le(){return Sl[dl]}function me(a){return Sl[dl]=a}function ne(){return Sl[el]}function oe(a){return Sl[el]=a}function pe(a){return je(a,ej)}function qe(a){return je(a,cj)}function re(a,b){return ke(a,cj,b)}function se(a){return je(a,dj)}function te(a,b){return ke(a,dj,b)}function ue(a){return je(a,ej)&oj}function ve(a,b){return ke(a,ej,b)}function we(a){return a>>1}function xe(){return h(Sl,fl)}function ye(){return h(Sl,gl)}function ze(){return h(Sl,hl)}function Ae(){return h(Sl,il)}function Be(){zc()>=Bc()&&0===E()&&fg(vj),gb()>=Wb()&&fg(vj)}function Ce(){var a;return 0!==Ml.methodArgumentCount()?Ml.primitiveFailFor(Al):0!==(a=uf(Ml.stackValue(0)))?Ml.primitiveFailFor(a):(fg(vj),void Bg(Hl))}function De(){var a,b,c;return Gl&&(Kl=Ml.ioMicroMSecs()),1!==Ml.methodArgumentCount()?Ml.primitiveFailFor(Al):0!==(c=vf(Ml.stackValue(1),Aj))?Ml.primitiveFailFor(c):(b=Ml.stackObjectValue(0),Ml.failed()?Ml.primitiveFailFor(zl):(a=Kd(b))?fe(1)?(tb(a)>0&&Tc(a),Il?Ml.primitiveFailFor(Ki):(fg(tj),Bg(Hl),Ml.pop(1),void(Gl&&(Nc(Ak,1),Nc(ql,Ml.ioMicroMSecs()-Kl))))):Ml.primitiveFailFor(Xi):Ml.primitiveFailFor(Hi))}function Ee(){var a,b,c,d,e,f,g;return 5!==Ml.methodArgumentCount()?Ml.primitiveFailFor(Al):(e=Ml.positive32BitValueOf(Ml.stackValue(0)),c=Ml.positive32BitValueOf(Ml.stackValue(1)),g=Ml.stackObjectValue(2),a=Ml.stackObjectValue(3),f=Ml.stackObjectValue(4),Ml.failed()?Ml.primitiveFailFor(zl):0!==(b=vf(Ml.stackValue(5),xj))?Ml.primitiveFailFor(b):Zc(c)&&Zc(e)?(Sd(xe(),f),Sd(ye(),g),Sd(ze(),a),Ml.failed()?Ml.primitiveFailFor(zl):($g(3),d=zd(xe(),ye(),ze(),!1),fe(d*Zh),Il||(c=Wg(c),e=Wg(e)),Il||Zd(0,0,c,e,d),Il?(dh(),Ml.primitiveFailFor(Ki)):Ml.failed()?Ml.primitiveFailFor(Ni):(Bg(Hl),void Ml.pop(5)))):Ml.primitiveFailFor(Zi))}function Fe(){var a,c,d,e,f,g,h,i,j;if(5!==Ml.methodArgumentCount())return Ml.primitiveFailFor(Al);if(e=Ml.positive32BitValueOf(Ml.stackValue(0)),f=Ml.stackIntegerValue(1),c=Ml.positive32BitValueOf(Ml.stackValue(2)),g=Ml.stackIntegerValue(3),h=Ml.stackObjectValue(4),Ml.failed())return Ml.primitiveFailFor(zl);if(0!==(a=vf(Ml.stackValue(5),xj)))return Ml.primitiveFailFor(a);if(d=b(h),Ml.isWords(h)){if(i=!1,d!==3*g&&d!==6*g)return Ml.primitiveFailFor(zl)}else{if(!Ml.isArray(h))return Ml.primitiveFailFor(zl);if(d!==3*g)return Ml.primitiveFailFor(zl);i=!0}return j=0===f||0===e?Uj:ck,fe(j*g)?Zc(e)&&Zc(c)?(e=Wg(e),c=Wg(c),Il?Ml.primitiveFailFor(Ki):0!==e&&0!==f||0!==c?(0!==f&&1>(f=_g(f))&&(f=1),i?Bd(h,g,c,f,e):Wd(h.wordsAsInt32Array(),g,c,f,e,3*g===d),Il?Ml.primitiveFailFor(Ki):Ml.failed()?Ml.primitiveFailFor(Ni):(ie(1),Bg(Hl),void Ml.pop(5))):Ml.pop(5)):Ml.primitiveFailFor(Zi):Ml.primitiveFailFor(Xi)}function Ge(){var a,b,c,d,e,f,g,h,i;return 7!==Ml.methodArgumentCount()?Ml.primitiveFailFor(Al):(i=Ml.stackIntegerValue(0),0>=i?Ml.primitiveFailFor(zl):(f=Ml.stackObjectValue(1),b=Ml.stackObjectValue(2),g=Ml.stackObjectValue(3),h=Ml.booleanValueOf(Ml.stackValue(4)),a=Ml.stackObjectValue(5),e=Ml.stackObjectValue(6),Ml.failed()?Ml.primitiveFailFor(zl):0!==(c=vf(Ml.stackValue(7),xj))?Ml.primitiveFailFor(c):(Sd(xe(),g),Sd(ye(),b),Sd(ze(),f),Ml.failed()?Ml.primitiveFailFor(Ei):(d=Fd(e,a,h?1:0,xe(),ye(),ze(),i-1),Il?Ml.primitiveFailFor(Ki):Ml.failed()?Ml.primitiveFailFor(Ni):(Bg(Hl),void Ml.popthenPush(8,Ml.positive32BitIntegerFor(d)))))))}function He(){var a,c,d,e,f,g,h,i,j;return 7!==Ml.methodArgumentCount()?Ml.primitiveFailFor(Al):(c=Ml.stackObjectValue(0),e=Ml.stackObjectValue(1),f=Ml.stackObjectValue(2),j=Ml.stackObjectValue(3),d=Ml.stackObjectValue(4),g=Ml.stackIntegerValue(5),h=Ml.stackObjectValue(6),Ml.failed()?Ml.primitiveFailFor(zl):0!==(a=vf(Ml.stackValue(7),xj))?Ml.primitiveFailFor(a):Ia(h,g,d,j,f,e,c)?fe(Math.max(Zh,Uj)*g)?(i=b(h)===3*g,Jd(h.wordsAsInt32Array(),g,d.wordsAsInt32Array(),j.wordsAsInt32Array(),f.wordsAsInt32Array(),e.wordsAsInt32Array(),c.wordsAsInt32Array(),i),Il?Ml.primitiveFailFor(Ki):Ml.failed()?Ml.primitiveFailFor(Ni):(ie(1),Bg(Hl),void Ml.pop(7))):Ml.primitiveFailFor(Xi):Ml.primitiveFailFor(Mi))}function Ie(){var a,b,c,d,e,f,g;return 5!==Ml.methodArgumentCount()?Ml.primitiveFailFor(Al):(d=Ml.booleanValueOf(Ml.stackValue(0)),e=Ml.stackValue(1),a=Ml.stackValue(2),f=Ml.stackValue(3),g=Ml.stackValue(4),Ml.failed()?Ml.primitiveFailFor(zl):0!==(b=vf(Ml.stackValue(5),xj))?Ml.primitiveFailFor(b):(Sd(xe(),f),Sd(ye(),a),Sd(ze(),e),Ml.failed()?Ml.primitiveFailFor(Ei):(c=Od(g,xe(),ye(),ze(),d),Il?Ml.primitiveFailFor(Ki):Ml.failed()?Ml.primitiveFailFor(Ni):(Bg(Hl),void Ml.popthenPush(6,Ml.positive32BitIntegerFor(c))))))}function Je(){var a,b,c,d,e;return 4!==Ml.methodArgumentCount()?Ml.primitiveFailFor(Al):(d=Ml.positive32BitValueOf(Ml.stackValue(0)),c=Ml.positive32BitValueOf(Ml.stackValue(1)),a=Ml.stackObjectValue(2),e=Ml.stackObjectValue(3),Ml.failed()?Ml.primitiveFailFor(zl):0!==(b=vf(Ml.stackValue(4),xj))?Ml.primitiveFailFor(b):Zc(c)&&Zc(d)?(Sd(xe(),e),Sd(ye(),a),Ml.failed()?Ml.primitiveFailFor(Ei):($g(2),c=Wg(c),d=Wg(d),Il?Ml.primitiveFailFor(Ki):($d(0,xe(),ye(),0,c,d),Il?Ml.primitiveFailFor(Ki):Ml.failed()?Ml.primitiveFailFor(Ni):(Bg(Hl),void Ml.pop(4))))):Ml.primitiveFailFor(Zi))}function Ke(){var a,b,c,d,e,f;return 5!==Ml.methodArgumentCount()?Ml.primitiveFailFor(Al):(a=Ml.positive32BitValueOf(Ml.stackValue(0)),b=Ml.stackIntegerValue(1),e=Ml.positive32BitValueOf(Ml.stackValue(2)),c=Ml.stackObjectValue(3),f=Ml.stackObjectValue(4),Ml.failed()?Ml.primitiveFailFor(zl):0!==(d=vf(Ml.stackValue(5),xj))?Ml.primitiveFailFor(d):Zc(a)&&Zc(e)?(e=Wg(e),a=Wg(a),Il?Ml.primitiveFailFor(Ki):0===e&&(0===a||0>=b)?Ml.pop(5):fe(16*Zh)?(b=b>0&&0!==a?_g(b):0,Sd(xe(),f),Sd(ye(),c),Ml.failed()?Ml.primitiveFailFor(Ei):(Qd(b,a,0,e),Il?(dh(),Ml.primitiveFailFor(Ki)):Ml.failed()?Ml.primitiveFailFor(Ni):(ie(1),Bg(Hl),void Ml.pop(5)))):Ml.primitiveFailFor(Xi)):Ml.primitiveFailFor(Zi))}function Le(){var a,c,d,e,f,g,h,i,j;if(5!==Ml.methodArgumentCount())return Ml.primitiveFailFor(Al);if(e=Ml.positive32BitValueOf(Ml.stackValue(0)),f=Ml.stackIntegerValue(1),c=Ml.positive32BitValueOf(Ml.stackValue(2)),g=Ml.stackIntegerValue(3),h=Ml.stackObjectValue(4),Ml.failed())return Ml.primitiveFailFor(zl);if(0!==(a=vf(Ml.stackValue(5),xj)))return Ml.primitiveFailFor(a);if(d=b(h),Ml.isWords(h)){if(i=!1,d!==g&&2*g!==d)return Ml.primitiveFailFor(zl)}else{if(!Ml.isArray(h))return Ml.primitiveFailFor(zl);if(d!==g)return Ml.primitiveFailFor(zl);i=!0}return j=0===f||0===e?Uj:ck,fe(j*g)?Zc(e)&&Zc(c)?(e=Wg(e),c=Wg(c),Il?Ml.primitiveFailFor(Ki):0!==e&&0!==f||0!==c?(0!==f&&(f=_g(f)),i?Ad(h,g,c,f,e):Td(h.wordsAsInt32Array(),g,c,f,e,g===d),Il?Ml.primitiveFailFor(Ki):Ml.failed()?Ml.primitiveFailFor(Ni):(ie(1),Bg(Hl),void Ml.pop(5))):Ml.pop(5)):Ml.primitiveFailFor(Zi):Ml.primitiveFail()}function Me(){var a,b,c,d,e,f;return 5!==Ml.methodArgumentCount()?Ml.primitiveFailFor(Al):(a=Ml.positive32BitValueOf(Ml.stackValue(0)),b=Ml.stackIntegerValue(1),e=Ml.positive32BitValueOf(Ml.stackValue(2)),c=Ml.stackObjectValue(3),f=Ml.stackObjectValue(4),Ml.failed()?Ml.primitiveFailFor(zl):0!==(d=vf(Ml.stackValue(5),xj))?Ml.primitiveFailFor(d):Zc(a)&&Zc(e)?(a=Wg(a),e=Wg(e),Il?Ml.primitiveFailFor(Ki):0!==e||0!==a&&0!==b?fe(4*Uj)?(b=b>0&&0!==a?_g(b):0,Sd(xe(),f),Sd(ze(),c),Ml.failed()?Ml.primitiveFailFor(Ei):(ye()[0]=ze()[0],ye()[1]=xe()[1],Ae()[0]=xe()[0],Ae()[1]=ze()[1],$g(4),Ud(b,a,0,e),Ml.failed()?Ml.primitiveFailFor(Ni):(ie(1),Bg(Hl),void Ml.pop(5)))):Ml.primitiveFailFor(Xi):Ml.pop(5)):Ml.primitiveFailFor(Zi))}function Ne(){var a,b,c;return Gl&&(Kl=Ml.ioMicroMSecs()),1!==Ml.methodArgumentCount()?Ml.primitiveFailFor(Al):0!==(c=vf(Ml.stackValue(1),zj))?Ml.primitiveFailFor(c):(b=Ml.stackObjectValue(0),Ml.failed()?Ml.primitiveFailFor(zl):(a=Kd(b))?(0===tb(a)?Af():(Df(),D(C()+1)),fg(yj),Bg(Hl),Ml.pop(1),void(Gl&&(Nc(Bk,1),Nc(rl,Ml.ioMicroMSecs()-Kl)))):Ml.primitiveFailFor(Hi))}function Oe(){var c,d,e,f,g,i,j,k;if(2!==Ml.methodArgumentCount())return Ml.primitiveFailFor(Al);if(d=Ml.stackValue(0),c=Ml.stackValue(1),0!==(g=ae(c)))return Ml.primitiveFailFor(g);if(a(c)!==a(d))return Ml.primitiveFailFor(Gi);if(0>(e=b(d)-b(c)))return Ml.primitiveFailFor(Qi);for(j=Sl,f=d.wordsAsInt32Array(),i=0,k=jh()-1;k>=i;i++)f[i]=j[i];for(f[tk]=jh()+e,f[jl]=bh()+e,j=h(j,jh()),f=h(f,jh()+e),i=0,k=bh()-jh()-1;k>=i;i++)f[i]=j[i];return 0!==(g=ae(d))?Ml.primitiveFailFor(g):void Ml.pop(2)}function Pe(){var a;return Gl&&(Kl=Ml.ioMicroMSecs()),0!==Ml.methodArgumentCount()?Ml.primitiveFailFor(Al):0!==(a=vf(Ml.stackValue(0),uj))?Ml.primitiveFailFor(a):0!==(a=Xd(Ml.fetchPointerofObject(Mh,Hl)))?Ml.primitiveFailFor(a):Ed(Ml.fetchPointerofObject(Kh,Hl))?((gb()&s())===s()&&(ob(gb()),Be()),vc()||(D(0),hb(gb()+1),fg(yj)),Bg(Hl),void(Gl&&(Nc(Ck,1),Nc(sl,Ml.ioMicroMSecs()-Kl)))):Ml.primitiveFailFor(Fi)}function Qe(){var a,b;b=Gl,a=Ml.stackObjectValue(0),a=Ml.booleanValueOf(a),Ml.failed()||(Gl=a,Ml.pop(2),Ml.pushBool(b))}function Re(){var a,b;return Gl&&(Kl=Ml.ioMicroMSecs()),0!==Ml.methodArgumentCount()?Ml.primitiveFailFor(Al):0!==(a=uf(Ml.stackValue(0)))?Ml.primitiveFailFor(a):(b=vc(),Bg(Hl),Ml.pop(1),Ml.pushBool(b),void(Gl&&(Nc(Dk,1),Nc(tl,Ml.ioMicroMSecs()-Kl))))}function Se(){var a;return 0!==Ml.methodArgumentCount()?Ml.primitiveFailFor(Al):0!==(a=uf(Ml.stackValue(0)))?Ml.primitiveFailFor(a):(Ml.pop(1),void Ml.pushInteger(q()))}function Te(){var a,c,d;return 1!==Ml.methodArgumentCount()?Ml.primitiveFailFor(Al):0!==(a=uf(Ml.stackValue(1)))?Ml.primitiveFailFor(a):(c=Ml.stackObjectValue(0),!Ml.failed()&&Ml.isWords(c)&&b(c)>=4?(d=c.wordsAsInt32Array(),d[0]=d[0]+Sl[rk],d[1]=d[1]+Sl[pk],d[2]=d[2]+Sl[sk],d[3]=d[3]+Sl[qk],void Ml.pop(1)):Ml.primitiveFailFor(zl))}function Ue(){var a,c,d;return 1!==Ml.methodArgumentCount()?Ml.primitiveFailFor(Al):0!==(a=uf(Ml.stackValue(1)))?Ml.primitiveFailFor(a):(d=Ml.stackObjectValue(0),!Ml.failed()&&Ml.isPointers(d)&&b(d)>=2?(Ml.pushRemappableOop(d),c=Ml.makePointwithxValueyValue(Wa(),Ya()),Ml.storePointerofObjectwithValue(0,Ml.topRemappableOop(),c),c=Ml.makePointwithxValueyValue(Sa(),Ua()),d=Ml.popRemappableOop(),Ml.storePointerofObjectwithValue(1,d,c),void Ml.popthenPush(2,d)):Ml.primitiveFailFor(zl))}function Ve(){var a,c,d;return 1!==Ml.methodArgumentCount()?Ml.primitiveFailFor(Al):0!==(a=uf(Ml.stackValue(1)))?Ml.primitiveFailFor(a):(c=Ml.stackObjectValue(0),!Ml.failed()&&Ml.isWords(c)&&b(c)>=9?(d=c.wordsAsInt32Array(),d[0]=d[0]+Sl[Ek],d[1]=d[1]+Sl[Dk],d[2]=d[2]+Sl[Ik],d[3]=d[3]+Sl[Ak],d[4]=d[4]+Sl[Hk],d[5]=d[5]+Sl[Fk],d[6]=d[6]+Sl[Ck],d[7]=d[7]+Sl[Gk],d[8]=d[8]+Sl[Bk],void Ml.pop(1)):Ml.primitiveFailFor(zl))}function We(){var a;return 0!==Ml.methodArgumentCount()?Ml.primitiveFailFor(Al):0!==(a=uf(Ml.stackValue(0)))?Ml.primitiveFailFor(a):(Ml.pop(1),void Ml.pushInteger(ib()))}function Xe(){var a;return 0!==Ml.methodArgumentCount()?Ml.primitiveFailFor(Al):(Hl=Ml.stackValue(0),"number"==typeof Hl?Ml.primitiveFailFor(Ii):Ml.isPointers(Hl)?b(Hl)<Jh?Ml.primitiveFailFor(Li):0!==(a=ae(Ml.fetchPointerofObject(Nh,Hl)))?Ml.primitiveFailFor(a):(Ml.pop(1),void Ml.pushInteger(yg())):Ml.primitiveFailFor(Ji))}function Ye(){var a,b;return 0!==Ml.methodArgumentCount()?Ml.primitiveFailFor(Al):0!==(a=uf(Ml.stackValue(0)))?Ml.primitiveFailFor(a):(b=Ml.makePointwithxValueyValue(kb(),mb()),void Ml.popthenPush(1,b))}function Ze(){var a,c,d;return 1!==Ml.methodArgumentCount()?Ml.primitiveFailFor(Al):0!==(a=uf(Ml.stackValue(1)))?Ml.primitiveFailFor(a):(c=Ml.stackObjectValue(0),!Ml.failed()&&Ml.isWords(c)&&b(c)>=9?(d=c.wordsAsInt32Array(),d[0]=d[0]+Sl[ul],d[1]=d[1]+Sl[tl],d[2]=d[2]+Sl[yl],d[3]=d[3]+Sl[ql],d[4]=d[4]+Sl[xl],d[5]=d[5]+Sl[vl],d[6]=d[6]+Sl[sl],d[7]=d[7]+Sl[wl],d[8]=d[8]+Sl[rl],void Ml.pop(1)):Ml.primitiveFailFor(zl))}function $e(){var a,c;return 1!==Ml.methodArgumentCount()?Ml.primitiveFail():(c=Ml.stackObjectValue(0),Ml.failed()?null:Ml.isWords(c)?(a=b(c))<bl?Ml.primitiveFail():(Gh(c),Pl=h(Sl,Wk),ce(al),ch(a),kh(a),fg(xj),me(Wk),oe(4),ve(0,jj),te(0,4),re(0,0),Ac(0),Cc(0),D(0),F(0),zg(0),ie(0),Xa(0),Ta(0),Za(0),Va(0),jb(0),Cf(),Qc(),Pc(),Ml.pop(2),void Ml.push(c)):Ml.primitiveFail())}function _e(){var a;return Gl&&(Kl=Ml.ioMicroMSecs()),0!==Ml.methodArgumentCount()?Ml.primitiveFailFor(Al):0!==(a=vf(Ml.stackValue(0),xj))?Ml.primitiveFailFor(a):0!==(a=Xd(Ml.fetchPointerofObject(Mh,Hl)))?Ml.primitiveFailFor(a):(Sc(),Il?Ml.primitiveFailFor(Ki):(fg(tj),Ml.failed()||Bg(Hl),void(Gl&&(Nc(Ek,1),Nc(ul,Ml.ioMicroMSecs()-Kl)))))}function af(){var c,d,e,f;return Gl&&(Kl=Ml.ioMicroMSecs()),2!==Ml.methodArgumentCount()?Ml.primitiveFailFor(Al):0!==(d=vf(Ml.stackValue(2),Bj))?Ml.primitiveFailFor(d):0!==(d=Xd(Ml.fetchPointerofObject(Mh,Hl)))?Ml.primitiveFailFor(d):(e=Ml.stackObjectValue(0),c=Ml.stackObjectValue(1),Ml.failed()||a(c)!==Ml.classBitmap()?Ml.primitiveFailFor(zl):b(e)<Uh?Ml.primitiveFailFor(Oi):(f=Ml.fetchIntegerofObject(Vh,e),qe(ed())!==f?Ml.primitiveFailFor(Zi):(f=Ml.fetchIntegerofObject(Xh,e),gd()!==f?Ml.primitiveFailFor(Zi):(f=Ml.fetchIntegerofObject(Wh,e),id()!==f?Ml.primitiveFailFor(Zi):b(c)<id()-gd()?Ml.primitiveFailFor(zl):Ml.failed()?null:(Ib(c.wordsAsInt32Array(),gd(),id()),fg(wj),Bg(Hl),Ml.pop(2),void(Gl&&(Nc(Fk,1),Nc(vl,Ml.ioMicroMSecs()-Kl))))))))}function bf(){var a,b;return 0!==Ml.methodArgumentCount()?Ml.primitiveFailFor(Al):0!==(a=uf(Ml.stackValue(0)))?Ml.primitiveFailFor(a):(b=ge(),Bg(Hl),Ml.pop(1),void Ml.pushBool(b))}function cf(){var a,b;return 1!==Ml.methodArgumentCount()?Ml.primitiveFailFor(Al):0!==(a=uf(Ml.stackValue(1)))?Ml.primitiveFailFor(a):(b=Ml.booleanValueOf(Ml.stackValue(0)),Ml.failed()?Ml.primitiveFailFor(zl):(ie(!0===b?1:0),Bg(Hl),void Ml.pop(1)))}function df(){var a,b,c,d;return Gl&&(Kl=Ml.ioMicroMSecs()),1!==Ml.methodArgumentCount()?Ml.primitiveFailFor(Al):0!==(c=wf(Ml.stackValue(1),yj,vj))?Ml.primitiveFailFor(c):(b=Ml.stackObjectValue(0),Ml.failed()?Ml.primitiveFailFor(zl):(d=!1,eg()!==vj&&(d=tc(),d?(a=Bl[C()],Ag(a,b),fg(zj)):fg(tj)),Ml.failed()?null:(Bg(Hl),Ml.pop(2),Ml.pushBool(!d),void(Gl&&(Nc(Gk,1),Nc(wl,Ml.ioMicroMSecs()-Kl))))))}function ef(){var a,b,c;return Gl&&(Kl=Ml.ioMicroMSecs()),1!==Ml.methodArgumentCount()?Ml.primitiveFailFor(Al):0!==(a=vf(Ml.stackValue(1),wj))?Ml.primitiveFailFor(a):0!==(a=Xd(Ml.fetchPointerofObject(Mh,Hl)))?Ml.primitiveFailFor(a):Nd(Ml.fetchPointerofObject(Lh,Hl))?(0!==Qa()&&(0==(gb()&s())&&Pa(),Ra(0)),b=Ml.stackObjectValue(0),c=sc(),Il?Ml.primitiveFailFor(Ki):(c&&Cg(b),Ml.failed()?Ml.primitiveFailFor(Zi):(c?fg(Bj):(dh(),Qf(0),fg(uj)),Bg(Hl),Ml.pop(2),Ml.pushBool(!c),void(Gl&&(Nc(Hk,1),Nc(xl,Ml.ioMicroMSecs()-Kl)))))):Ml.primitiveFailFor(Pi)}function ff(){var a,b,c,d;return Gl&&(Kl=Ml.ioMicroMSecs()),1!==Ml.methodArgumentCount()?Ml.primitiveFailFor(Al):0!==(c=vf(Ml.stackValue(1),tj))?Ml.primitiveFailFor(c):(b=Ml.stackObjectValue(0),d=rc(),d&&(a=Ll[zc()],Ag(a,b),Ac(zc()+1)),Ml.failed()?Ml.primitiveFailFor(Yi):(d?fg(Aj):(fg(wj),Ra(1),D(0),dh()),Bg(Hl),Ml.pop(2),Ml.pushBool(!d),void(Gl&&(Nc(Ik,1),Nc(yl,Ml.ioMicroMSecs()-Kl)))))}function gf(){var a,b,c,d,e,f,g,h;return 6!==Ml.methodArgumentCount()?Ml.primitiveFailFor(Al):0!==(b=vf(Ml.stackValue(6),xj))?Ml.primitiveFailFor(b):(h=Ml.positive32BitValueOf(Ml.stackValue(0)),g=Ml.positive32BitValueOf(Ml.stackValue(1)),f=Ml.stackIntegerValue(2),e=Ml.stackIntegerValue(3),d=Ml.stackIntegerValue(4),c=Ml.stackIntegerValue(5),Ml.failed()?Ml.primitiveFailFor(zl):N(Ai)?Zc(g)&&Zc(h)?(a=Ql,Ql=a+Ai,ve(a,hj),te(a,Ai),re(a,c),Ab(a,d),Cb(a,e),Eb(a,f),sb(a,Wg(g)),wb(a,Wg(h)),Il?Ml.primitiveFailFor(Ki):void(Ml.failed()||(Bg(Hl),Ml.pop(6)))):Ml.primitiveFailFor(Zi):Ml.primitiveFailFor(Xi))}function hf(){var a,b,c;if(1!==Ml.methodArgumentCount())return Ml.primitiveFailFor(Al);if(0!==(a=vf(Ml.stackValue(1),xj)))return Ml.primitiveFailFor(a);if(c=Ml.stackIntegerValue(0),Ml.failed())return Ml.primitiveFailFor(zl);for(b=0;0===b;){if(!N(Ai))return Ml.primitiveFailFor(Xi);b=Ql,Ql=b+Bi,ve(b,jj),te(b,Bi),re(b,c)}Ml.failed()||(Bg(Hl),Ml.pop(2),Ml.pushInteger(b))}function jf(){var a;return 0!==(a=Vd())?Ml.primitiveFailFor(a):(tf(),Il?Dg():(sf(),void Dg()))}function kf(){var a;return 0!==(a=Vd())?Ml.primitiveFailFor(a):(tf(),void Dg())}function lf(){var a,b;return 1!==Ml.methodArgumentCount()?Ml.primitiveFailFor(Al):0!==(a=vf(Ml.stackValue(1),xj))?Ml.primitiveFailFor(a):(b=Ml.stackIntegerValue(0),Ml.failed()?Ml.primitiveFailFor(zl):(If(b),Bg(Hl),void Ml.pop(1)))}function mf(){var a,b;if(b=Ml.stackValue(0),!Ml.isBytes(b))return Ml.primitiveFail();if(c(b)>=256)return Ml.primitiveFail();b.bytes,a=!1;var d=b.bytesAsString();return d!==Cl&&(Cl=d,a=!0),a&&!Rc()?Ml.primitiveFail():void Ml.pop(1)}function nf(){var a,c;return 1!==Ml.methodArgumentCount()?Ml.primitiveFailFor(Al):0!==(a=vf(Ml.stackValue(1),xj))?Ml.primitiveFailFor(a):(c=Ml.stackObjectValue(0),!Ml.failed()&&Ml.isPointers(c)&&b(c)>=2?(Sd(xe(),Ml.fetchPointerofObject(0,c)),Sd(ye(),Ml.fetchPointerofObject(1,c)),Ml.failed()?Ml.primitiveFailFor(zl):(Xa(xe()[0]),Za(xe()[1]),Ta(ye()[0]),Va(ye()[1]),Bg(Hl),void Ml.pop(1))):Ml.primitiveFailFor(zl))}function of(){var a,b;return 1!==Ml.methodArgumentCount()?Ml.primitiveFailFor(Al):0!==(a=vf(Ml.stackValue(1),xj))?Ml.primitiveFailFor(a):(b=Ml.stackObjectValue(0),Ml.failed()?Ml.primitiveFailFor(zl):(Hd(b),Ml.failed()?Ml.primitiveFailFor(Ni):(Bg(Hl),void Ml.pop(1))))}function pf(){var a,b;return 1!==Ml.methodArgumentCount()?Ml.primitiveFailFor(Al):0!==(b=vf(Ml.stackValue(1),xj))?Ml.primitiveFailFor(b):(a=Ml.stackIntegerValue(0),Ml.failed()?Ml.primitiveFailFor(zl):(jb(a),Bg(Hl),void Ml.pop(1)))}function qf(){var a,b;return 1!==Ml.methodArgumentCount()?Ml.primitiveFailFor(Al):0!==(a=vf(Ml.stackValue(1),xj))?Ml.primitiveFailFor(a):(b=Ml.stackObjectValue(0),Ml.failed()?Ml.primitiveFailFor(zl):(Ld(b),Ml.failed()?Ml.primitiveFailFor(zl):(Bg(Hl),void Ml.pop(1))))}function rf(){var b,c;return 1!==Ml.methodArgumentCount()?Ml.primitiveFailFor(Al):0!==(b=vf(Ml.stackValue(1),xj))?Ml.primitiveFailFor(b):(c=Ml.stackValue(0),a(c)!==Ml.classPoint()?Ml.primitiveFailFor(zl):(Sd(xe(),c),Ml.failed()?Ml.primitiveFailFor(zl):(lb(xe()[0]),nb(xe()[1]),Bg(Hl),void Ml.pop(1))))}function sf(){for(var a;!vc();){if(Gl&&(Kl=Ml.ioMicroMSecs()),a=rc(),Gl&&(Nc(Ik,1),Nc(yl,Ml.ioMicroMSecs()-Kl)),Il)return fg(tj);if(a)return fg(Aj),xg(Ij);if(D(0),dh(),Ra(1),Gl&&(Kl=Ml.ioMicroMSecs()),0!==Qa()&&0==(gb()&s())&&Pa(),Ra(0),a=sc(),Gl&&(Nc(Hk,1),Nc(xl,Ml.ioMicroMSecs()-Kl)),Il)return fg(wj);if(a)return fg(Bj),xg(Hj);if(dh(),Qf(0),Gl&&(Kl=Ml.ioMicroMSecs()),(gb()&s())===s()&&(ob(gb()),Be()),Gl&&(Nc(Ck,1),Nc(sl,Ml.ioMicroMSecs()-Kl)),Il)return fg(uj);if(vc())return 0;if(D(0),hb(gb()+1),Gl&&(Kl=Ml.ioMicroMSecs()),a=tc(),Gl&&(Nc(Gk,1),Nc(wl,Ml.ioMicroMSecs()-Kl)),Il)return fg(yj);if(a)return fg(zj),xg(Fj)}}function tf(){var a,b;if((b=eg())===xj){if(Sc(),Il)return 0;b=tj}if(b===tj){if(Gl&&(Kl=Ml.ioMicroMSecs()),a=rc(),Gl&&(Nc(Ik,1),Nc(yl,Ml.ioMicroMSecs()-Kl)),Il)return fg(tj);if(a)return fg(Aj),xg(Ij);D(0),dh(),Ra(1),b=wj}if(b===wj){if(Gl&&(Kl=Ml.ioMicroMSecs()),0!==Qa()&&0==(gb()&s())&&Pa(),Ra(0),a=sc(),Gl&&(Nc(Hk,1),Nc(xl,Ml.ioMicroMSecs()-Kl)),Il)return fg(wj);if(a)return fg(Bj),xg(Hj);b=uj,dh(),Qf(0)}if(b===uj){if(Gl&&(Kl=Ml.ioMicroMSecs()),(gb()&s())===s()&&(ob(gb()),Be()),Gl&&(Nc(Ck,1),Nc(sl,Ml.ioMicroMSecs()-Kl)),Il)return fg(uj);if(vc())return 0;b=yj,D(0),hb(gb()+1)}if(b===yj){if(Gl&&(Kl=Ml.ioMicroMSecs()),a=tc(),Gl&&(Nc(Gk,1),Nc(wl,Ml.ioMicroMSecs()-Kl)),Il)return fg(yj);if(a)return fg(zj),xg(Fj);fg(tj)}}function uf(a){var c;return Ml.failed()?Di:"number"==typeof a?Ii:Ml.isPointers(a)?b(a)<Jh?Li:(Hl=a,0!==(c=ae(Ml.fetchPointerofObject(Nh,a)))?c:(zg(0),Ql=ne(),Il=!1,0)):Ji}function vf(a,b){var c;return 0!==(c=uf(a))?c:eg()===b?0:(zg(Gj),$i)}function wf(a,b,c){var d;return 0!==(d=uf(a))?d:eg()===b?0:eg()===c?0:(zg(Gj),$i)}function xf(a){if(0===bg())return null;for(;Vg()<=a;)if(Mc(Og(),Ng()),0===bg())return null}function yf(a,b,c){var d,e,f,g,h,i,j,k,l,m,n;if((l=c+1-b)<=1)return 0;if(f=a[b],h=a[c],e=yc(f,h),e||(m=a[b],a[b]=a[c],a[c]=m,n=f,f=h,h=n),2>=l)return 0;if(i=b+c>>1,g=a[i],e=yc(f,g),e?(e=yc(g,h))||(m=a[c],a[c]=a[i],a[i]=m,g=h):(m=a[b],a[b]=a[i],a[i]=m,g=f),3>=l)return 0;for(j=b,k=c,d=!0;d;){for(e=!0;e;)j<=--k?(m=a[k],e=yc(g,m)):e=!1;for(e=!0;e;)++j<=k?(m=a[j],e=yc(m,g)):e=!1;(d=k>=j)&&(m=a[j],a[j]=a[k],a[k]=m)}yf(a,b,k),yf(a,j,c)}function zf(){return[0,5,4,0,3,0,0,0,2,0,0,0,0,0,0,0,1]}function Af(){var a;for(a=C(),F(E()-1);a<E();)Bl[a]=Bl[a+1],++a}function Bf(a,b){var c;for(c=a;0>c;)c+=b;for(;c>=b;)c-=b;return c}function Cf(){Sl[ul]=0,Sl[tl]=0,Sl[yl]=0,Sl[ql]=0,Sl[xl]=0,Sl[vl]=0,Sl[sl]=0,Sl[wl]=0,Sl[rl]=0,Sl[Ek]=0,Sl[Dk]=0,Sl[Ik]=0,Sl[Ak]=0,Sl[Hk]=0,Sl[Fk]=0,Sl[Ck]=0,Sl[Gk]=0,Sl[Bk]=0,Sl[rk]=0,Sl[pk]=0,Sl[sk]=0,Sl[qk]=0}function Df(){var a,b,c;return 0===C()?null:(a=Bl[C()],c=zb(a),b=Bl[C()-1],zb(b)<=c?null:void ee(C(),a,c))}function Ef(){return El=rh(Fl)}function Ff(){return El=uh(Fl)}function Gf(){return El=Ch(Fl)}function Hf(){return El=Eh(Fl)}function If(a){var b;a>=4&&(b=4),a>=2&&4>a&&(b=2),2>a&&(b=1),r(b),1===b&&(v(0),k(4294967295),t(0)),2===b&&(v(1),k(4244438268),t(1)),4===b&&(v(2),k(4042322160),t(3)),m(2*u()),o(u())}function Jf(a){return Ml=a,!1!==(Ml.majorVersion()==Hh)&&Ml.minorVersion()>=Ih}function Kf(a,b){return(0|b[a])>>>16}function Lf(a,b){return 65535&(0|b[a])}function Mf(a,b,c){return P()?(dg(0,a),Zf(0,b),ag(0,c),bg()===$f()?null:void(oc(0,bg()-$f())&&(dg(0,Tg()),Zf(0,Pg()),ag(0,Rg()),Ug(a),Qg(b),Sg(c)))):null}function Nf(){return[0,1,1,2,2,2,2,3,3,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,6]}function Of(){yf(Ll,0,Bc()-1)}function Pf(){return Sl[ll]}function Qf(a){return Sl[ll]=a}function Rf(){return Sl[kl]}function Sf(a){return Sl[kl]=a}function Tf(){return Sl[ml]}function Uf(a){return Sl[ml]=a}function Vf(){return Sl[nl]}function Wf(a){return Sl[nl]=a}function Xf(a,b){return a*a+b*b}function Yf(a){return hh(a+1)}function Zf(a,b){return ih(a+1,b)}function $f(){return 3}function _f(a){return hh(a+2)}function ag(a,b){return ih(a+2,b)}function bg(){return gh()}function cg(a){return hh(a)}function dg(a,b){return ih(a,b)}function eg(){return Sl[ol]}function fg(a){return Sl[ol]=a}function gg(){return hg(Ll[zc()],gb())}function hg(a,b){var c,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;return!bd(a)&&b>=W(a)?ub(a,0):(r=zb(a),s=Bb(a),u=_(a),v=ba(a),e=U(a),f=W(a),c=f-s,k=2*(u-r),l=r+e-2*u,m=2*(v-s),n=s+f-2*v,o=2*c,2>o&&(o=2),p=d(16777216,o),q=w(p),i=k*p,g=l*q*2,i+=g>>1,j=m*p,h=n*q*2,j+=h>>1,ub(a,c),t=$(a),t[pi]=256*r,t[qi]=256*s,t[mi]=i,t[ni]=j,t[ki]=g,t[li]=h,void((s=Bb(a))!==b&&(qg(a,b),ub(a,c-(b-s)))))}function ig(){return jg(Ll[zc()],gb())}function jg(a,b){var c,f,g,h,i,j,k,l,m;if(!bd(a)&&b>=md(a))return ub(a,0);if(c=kd(a)-zb(a),f=md(a)-Bb(a),c>=0?(l=1,k=c,g=0):(l=-1,k=0-c,g=1-f),0===f?(g=0,m=c,h=0):f>k?(m=0,h=k):(m=d(k,f)*l,h=e(k,f)),ub(a,f),vd(a,l),xd(a,m),td(a,g),rd(a,h),pd(a,f),(j=Bb(a))!==b){for(i=j;b-1>=i;i++)sg(a,i);ub(a,f-(b-j))}}function kg(){return lg(Ll[zc()],gb())}function lg(a,b){var c,d,e,f,g,h,i,j,k;for(f=ph(a),e=we(f),c=U(a),h=Bb(a),hg(a,h),g=tb(a),d=0;5>=d;d++)th(a)[d]=$(a)[d];if(i=$(a)[mi],0===i&&$(a)[ki],i=i>=0?1:-1,0>i?z(a,f,e,c):A(a,f,e,c),0===g&&($(a)[pi]=256*Y(a)),ub(a,g+f),j=0,k=0-g-e,mh(a,j),oh(a,k),j>=e&&0>k?qb(a):pb(a),cb(a,f),h!==b){for(d=h;b-1>=d;d++)ug(a,d);ub(a,tb(a)-(b-h))}}function mg(){return ng(Ll[zc()],gb())}function ng(a,b){var c,d,e,f,g,h,i,j,k;if(e=Ah(a),d=we(e),g=zb(a),h=Bb(a),jg(a,h),f=tb(a),i=ud(a),Ab(a,g-d),ub(a,f+e),i>0?Fh(a,wd(a)+e):(Fh(a,e-wd(a)),Ab(a,zb(a)+wd(a))),j=0,k=0-f-d,xh(a,j),zh(a,k),j>=d&&0>k?qb(a):pb(a),h!==b){for(c=h;b-1>=c;c++)wg(a,c);ub(a,tb(a)-(b-h))}}function og(){return qg(Bl[C()],gb())}function pg(a,b){var c,d,e,f,g;for(e=a[pi],f=a[qi],c=a[mi],d=a[ni],g=256*b;g>f&&d>=0;)e+=c+32768>>16,f+=d+32768>>16,c+=a[ki],d+=a[li];return a[pi]=e,a[qi]=f,a[mi]=c,a[ni]=d,e>>8}function qg(a,b){var c;c=pg($(a),b),Ab(a,c)}function rg(){return sg(Bl[C()],gb())}function sg(a){var b,c;c=zb(a)+wd(a),b=sd(a)+qd(a),b>0&&(c+=ud(a),b-=od(a)),td(a,b),Ab(a,c)}function tg(){ug(Bl[C()],gb())}function ug(a,b){var c,d,e,f;d=ph(a),c=we(d),e=lh(a)+1,f=nh(a)+1,mh(a,e),oh(a,f),e>=c&&qb(a),f>=0&&pb(a),0>f+c?pg($(a),b):$(a)[pi]=256*Y(a),pg(th(a),b),cb(a,d)}function vg(){return wg(Bl[C()],gb())}function wg(a,b){var c,d,e,f,g,h;g=wh(a)+1,h=yh(a)+1,xh(a,g),zh(a,h),e=Ah(a),d=we(e),g>=d&&qb(a),h>=0&&pb(a),c=zb(a),sg(a,b),f=zb(a),(e>=g||h+d>=0)&&B(a,c,f)}function xg(a){zg(a),Il=!0}function yg(){return Sl[pl]}function zg(a){return Sl[pl]=a}function Ag(a,c){return b(c)<Oh?Ml.primitiveFail():(Ml.storeIntegerofObjectwithValue(Ph,c,qe(a)),Ml.storeIntegerofObjectwithValue(Rh,c,zb(a)),Ml.storeIntegerofObjectwithValue(Sh,c,gb()),Ml.storeIntegerofObjectwithValue(Th,c,Db(a)),Ml.storeIntegerofObjectwithValue(Qh,c,tb(a)),void dd(a))}function Bg(){oe(Ql)}function Cg(a){var c,d,e;return c=ed(),d=gd(),e=id(),b(a)<Uh?Ml.primitiveFail():(Ml.storeIntegerofObjectwithValue(Vh,a,qe(c)),Ml.storeIntegerofObjectwithValue(Xh,a,d),Ml.storeIntegerofObjectwithValue(Wh,a,e),void Ml.storeIntegerofObjectwithValue(Yh,a,gb()))}function Dg(){return Ml.failed()?null:(Il&&Eg(Ml.stackObjectValue(1),Ml.stackObjectValue(0)),Bg(Hl),Ml.pop(3),void Ml.pushInteger(yg()))}function Eg(a,b){var c,d;d=yg(),d===Ij&&(c=Ll[zc()],Ag(c,a),Ac(zc()+1)),d===Hj&&Cg(b),d===Fj&&(c=Bl[C()],Ag(c,a))}function Fg(a){var b,c,d,e,f,g;return g=ya(a),e=ua(a),e===g?a:(c=e-g,0>c&&(c=0-c),c>255?(Nc(pk,1),bb(a)):(f=wa(a),d=sa(a),b=d-f,0>b&&(b=0-b),b>32*c?(Nc(sk,1),bb(a)):a))}function Gg(a){var b,c,d;return d=Fg(a),d!==a?(b=Gg(a),Il?0:(c=Gg(d),Il?0:b>=c?b:c)):a}function Hg(a,b){var c,d,e;return c=d=e=Jg(a),b&&(d=Ig(a)),d>e&&(e=d),a!==c&&b&&(d=Ig(c)),d>e&&(e=d),e}function Ig(a){var b,c,d,e,f,g,h;return g=wa(a),h=Aa(a),e=sa(a),c=h-g,d=e-h,c*d>=0?a:(Nc(rk,1),b=d-c,f=c,0>f&&(f=0-f),0>b&&(b=0-b),ab(a,f/b))}function Jg(a){var b,c,d,e,f,g,h;return g=ya(a),h=Ca(a),e=ua(a),c=h-g,d=e-h,c*d>=0?a:(Nc(rk,1),b=d-c,f=c,0>f&&(f=0-f),0>b&&(b=0-b),ab(a,f/b))}function Kg(a,b,c){0===bg()?P()&&(Ug(a),Qg(b),Sg(c)):Mc(a,b)||Mf(a,b,c)}function Lg(a){var b,c;return fe(2*$f())?(b=Db(a)<<1,c=rb(a),0!==c&&Kg(c,b,999999999),c=vb(a),0!==c&&Kg(c,b,999999999),void xf(zb(a))):null}function Mg(a){var b,c,d,e,f,g;switch(g=yb(a),Fl=a,g){case 0:case 1:Fb();break;case 2:Hf();break;case 3:Ff()}switch(e=El,g){case 0:case 1:Fb();break;case 2:Gf();break;case 3:Ef()}return c=El,0===c?null:fe($f())?(b=1+(Db(a)<<1),f=zb(a)+e,d=uc(c,b),-1===d?Mf(c,b,f):_f(d)<f&&ag(d,f),void xf(zb(a))):null}function Ng(){return 0===bg()?-1:Pg()}function Og(){return 0===bg()?0:Tg()}function Pg(){return Yf(bg()-$f())}function Qg(a){return Zf(bg()-$f(),a)}function Rg(){return _f(bg()-$f())}function Sg(a){return ag(bg()-$f(),a)}function Tg(){return cg(bg()-$f())}function Ug(a){return dg(bg()-$f(),a)}function Vg(){return 0===bg()?999999999:Rg()}function Wg(a){var b,c,d,e,f,g;return 0===a||Yc(a)?(d=255&a,e=a>>>8&255,f=a>>>16&255,b=a>>>24&255,Gc()&&(g=$a(),c=(b*g[6]+g[7])/b,f=(f*g[0]+g[1])*c|0,e=(e*g[2]+g[3])*c|0,d=(d*g[4]+g[5])*c|0,b=b*c|0,f=Math.max(f,0),f=Math.min(f,255),e=Math.max(e,0),e=Math.min(e,255),d=Math.max(d,0),d=Math.min(d,255),b=Math.max(b,0),b=Math.min(b,255)),1>b?0:(255>b&&ge()&&xg(Jj),d+(e<<8)+(f<<16)+(b<<24))):a}function Xg(a){Jc()?Yg(a,a):(a[0]=(a[0]+kb())*q(),a[1]=(a[1]+mb())*q())}function Yg(a,b){Zg(0|a[0],0|a[1],b)}function Zg(a,b,c){var d,e,f;d=xb(),e=(d[0]*a+d[1]*b+d[2])*q()|0,f=(d[3]*a+d[4]*b+d[5])*q()|0,c[0]=e,c[1]=f}function $g(a){a>0&&Xg(xe()),a>1&&Xg(ye()),a>2&&Xg(ze()),a>3&&Xg(Ae())}function _g(a){var b,c,d,e;return 0===a?0:(xe()[0]=0,xe()[1]=0,ye()[0]=256*a,ye()[1]=0,ze()[0]=0,ze()[1]=256*a,$g(3),b=ye()[0]-xe()[0],c=ye()[1]-xe()[1],d=128+(0|Math.sqrt(b*b+c*c))>>8,b=ze()[0]-xe()[0],c=ze()[1]-xe()[1],e=128+(0|Math.sqrt(b*b+c*c))>>8,d>e&&(d=e),0===d?1:d)}function ah(a){var b,c,d,e,f;return Gc()?(c=255&a,d=a>>>8&255,e=a>>>16&255,b=a>>>24&255,f=$a(),e=e*f[0]+f[1]|0,d=d*f[2]+f[3]|0,c=c*f[4]+f[5]|0,b=b*f[6]+f[7]|0,e=Math.max(e,0),e=Math.min(e,255),d=Math.max(d,0),d=Math.min(d,255),c=Math.max(c,0),c=Math.min(c,255),b=Math.max(b,0),b=Math.min(b,255),16>b?0:c+(d<<8)+(e<<16)+(b<<24)):a}function bh(){return Sl[jl]}function ch(a){return Sl[jl]=a}function dh(){kh(bh())}function eh(a){kh(jh()+a)}function fh(a){return!!O(a)&&(kh(jh()-a),!0)}function gh(){return bh()-jh()}function hh(a){return Sl[jh()+a]}function ih(a,b){return Sl[jh()+a]=b}function jh(){return Sl[tk]}function kh(a){return Sl[tk]=a}function lh(a){return je(a,ti)}function mh(a,b){return ke(a,ti,b)}function nh(a){return je(a,ui)}function oh(a,b){return ke(a,ui,b)}function ph(a){return je(a,vi)}function qh(a,b){return ke(a,vi,b)}function rh(a){return je(a,wi)}function sh(a,b){return ke(a,wi,b)}function th(a){return h(Pl,a+yi)}function uh(a){return je(a,zi)}function vh(a,b){return ke(a,zi,b)}function wh(a){return je(a,$j)}function xh(a,b){return ke(a,$j,b)}function yh(a){return je(a,_j)}function zh(a,b){return ke(a,_j,b)}function Ah(a){return je(a,ak)}function Bh(a,b){return ke(a,ak,b)}function Ch(a){return je(a,bk)}function Dh(a,b){return ke(a,bk,b)}function Eh(a){return je(a,dk)}function Fh(a,b){return ke(a,dk,b)}function Gh(a){Sl=a.wordsAsInt32Array()}var Hh=1,Ih=11,Jh=12,Kh=2,Lh=3,Mh=1,Nh=0,Oh=6,Ph=0,Qh=4,Rh=1,Sh=2,Th=3,Uh=6,Vh=0,Wh=2,Xh=1,Yh=3,Zh=16,$h=12,_h=11,ai=14,bi=13,ci=10,di=18,ei=15,fi=14,gi=15,hi=21,ii=18,ji=16,ki=4,li=5,mi=2,ni=3,oi=10,pi=0,qi=1,ri=12,si=13,ti=18,ui=19,vi=20,wi=16,xi=28,yi=22,zi=17,Ai=10,Bi=4,Ci=65536,Di=100,Ei=121,Fi=122,Gi=114,Hi=112,Ii=101,Ji=102,Ki=104,Li=103,Mi=120,Ni=119,Oi=113,Pi=123,Qi=115,Ri=108,Si=105,Ti=106,Ui=110,Vi=107,Wi=109,Xi=111,Yi=118,Zi=117,$i=116,_i=8,aj=9,bj=7,cj=2,dj=1,ej=0,fj=6,gj=1024,hj=2,ij=255,jj=256,kj=65280,lj=4,mj=512,nj=768,oj=65535,pj=1,qj=7,rj=5,sj=254,tj=1,uj=5,vj=8,wj=3,xj=0,yj=6,zj=7,Aj=2,Bj=4,Cj=4,Dj=5,Ej=6,Fj=6,Gj=2,Hj=5,Ij=4,Jj=3,Kj=1,Lj=6,Mj=7,Nj=8,Oj=9,Pj=4,Qj=5,Rj=10,Sj=12,Tj=12,Uj=16,Vj=14,Wj=15,Xj=13,Yj=15,Zj=14,$j=18,_j=19,ak=20,bk=16,ck=21,dk=17,ek=10,fk=12,gk=11,hk=51,ik=50,jk=53,kk=48,lk=52,mk=49,nk=13,ok=14,pk=109,qk=111,rk=108,sk=110,tk=10,uk=69,vk=43,wk=45,xk=42,yk=44,zk=24,Ak=97,Bk=107,Ck=103,Dk=93,Ek=91,Fk=101,Gk=105,Hk=99,Ik=95,Jk=88,Kk=113,Lk=46,Mk=47,Nk=18,Ok=37,Pk=39,Qk=36,Rk=38,Sk=11,Tk=12,Uk=17,Vk=16,Wk=128,Xk=65,Yk=66,Zk=67,$k=68,_k=0,al=1097753705,bl=256,cl=63,dl=8,el=9,fl=80,gl=82,hl=84,il=86,jl=1,kl=34,ll=35,ml=33,nl=32,ol=2,pl=64,ql=96,rl=106,sl=102,tl=92,ul=90,vl=100,wl=104,xl=98,yl=94,zl=3,Al=5,Bl=null,Cl="BitBltPlugin",Dl=null,El=0,Fl=0,Gl=0,Hl=0,Il=0,Jl=0,Kl=0,Ll=null,Ml=null,Nl=null,Ol="B2DPlugin 14 November 2014 (e)",Pl=null,Ql=0,Rl=null,Sl=null;Squeak.registerExternalModule("B2DPlugin",{primitiveMergeFillFrom:af,primitiveCopyBuffer:Oe,primitiveAddRect:Me,primitiveAddGradientFill:Ie,primitiveSetClipRect:nf,initialiseModule:Rc,primitiveSetBitBltPlugin:mf,primitiveRegisterExternalEdge:gf,primitiveGetClipRect:Ue,primitiveAddBezier:Ee,primitiveInitializeProcessing:_e,primitiveRenderImage:jf,primitiveGetOffset:Ye,primitiveSetDepth:pf,primitiveAddBezierShape:Fe,primitiveSetEdgeTransform:qf,getModuleName:xc,primitiveGetTimes:Ze,primitiveNextActiveEdgeEntry:df,primitiveAddBitmapFill:Ge,primitiveGetDepth:We,primitiveAbortProcessing:Ce,primitiveNextGlobalEdgeEntry:ff,primitiveGetFailureReason:Xe,primitiveDisplaySpanBuffer:Pe,moduleUnloaded:de,primitiveGetCounts:Ve,primitiveChangedActiveEdgeEntry:Ne,primitiveRenderScanline:kf,primitiveGetBezierStats:Te,primitiveFinishedProcessing:Re,setInterpreter:Jf,primitiveNeedsFlush:bf,primitiveAddLine:Je,primitiveSetOffset:rf,primitiveNextFillEntry:ef,primitiveInitializeBuffer:$e,primitiveDoProfileStats:Qe,primitiveAddActiveEdgeEntry:De,primitiveSetAALevel:lf,primitiveNeedsFlushPut:cf,primitiveAddCompressedShape:He,primitiveSetColorTransform:of,primitiveAddOval:Ke,primitiveRegisterExternalFill:hf,primitiveAddPolygon:Le,primitiveGetAALevel:Se})}),module("users.bert.SqueakJS.plugins.BitBltPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function a(a){return"number"==typeof a?Sc.classSmallInteger():a.sqClass}function b(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}function c(a){return a.bytes?a.bytes.length:a.words?4*a.words.length:0}function d(a,b){return 0|Math.floor(a/b)}function e(a,b){return a-d(a,b)*b|0}function f(a,b){return b>31?0:a<<b}function g(a,b){return b>31?0:a>>>b}function h(a,b){return 0>b?-31>b?0:a>>>0-b:b>31?0:a<<b}function i(a,b){var c,d;if(16>tc){for(c=a^b,d=Xc[tc];0!==c;)0!=(c&d)&&++dc,c=g(c,tc);return b}return 16===tc?(c=xa(a,b,5,3),dc=dc+(31&c)+(c>>>5&31)+(c>>>10&31),c=xa(a>>>16,b>>>16,5,3),dc=dc+(31&c)+(c>>>5&31)+(c>>>10&31)):(c=xa(a,b,8,3),dc=dc+(255&c)+(c>>>8&255)+(c>>>16&255)),b}function j(a,b){var c,d,e,f;if((jc&(Pb|Nb))!=(Pb|Nb))return b;if(16>tc){for(c=Xc[tc]&lc,f=b,e=1;zc>=e;e++)d=f&c,jb(d,ib(d)+1),f=g(f,tc);return b}return 16===tc?(d=Va(65535&b,5,ic),jb(d,ib(d)+1),d=Va(b>>>16,5,ic),jb(d,ib(d)+1)):(d=Va(b,8,ic),jb(d,ib(d)+1)),b}function k(a,b){return a+b}function l(a,b){var c,d,e,f;return f=a>>>24,0===f?b:255===f?a:(c=255-f,d=(16711935&a)*f+(16711935&b)*c+16711935,e=(16711935&(a>>>8|16711680))*f+(b>>>8&16711935)*c+16711935,d=d+(d-65537>>>8&16711935)>>>8&16711935,e=e+(e-65537>>>8&16711935)>>>8&16711935,d|e<<8)}function m(a,b){return n(a,b,!1)}function n(a,b,c){var e,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;if(16>tc)return b;if(p=255-ed,l=b,1===zc)c&&0===a||(r=(16711935&a)*ed+(16711935&b)*p+16711935,s=(a>>>8&16711935)*ed+(b>>>8&16711935)*p+16711935,r=r+(r-65537>>>8&16711935)>>>8&16711935,s=s+(s-65537>>>8&16711935)>>>8&16711935,l=r|s<<8);else for(h=Xc[tc],t=5,e=31,w=yc,v=b,k=a,j=1;zc>=j;j++){if(n=k&h,!(0==(w&h)||c&&0===n)){for(q=v&h,i=0,o=1;3>=o;o++)m=(o-1)*t,u=d((g(n,m)&e)*ed+(g(q,m)&e)*p+254,255)&e,i|=f(u,m);l=l&~f(h,16*(j-1))|f(i,16*(j-1))}w=g(w,tc),k=g(k,tc),v=g(v,tc)}return l}function o(a,b){var c,d,e;return c=255-(a>>>24),d=((16711935&b)*c>>>8&16711935)+(16711935&a),e=((b>>>8&16711935)*c>>>8&16711935)+(a>>>8&16711935),d=16711935&d|255*(16777472&d)>>>8,(e=(16711935&e)<<8|255*(16777472&e))|d}function p(a,b){return 0===a?b:n(a,b,!0)}function q(){var a,b,c,d,e,h,i,j,k,l,m,n,p,q;for(l=ac+1,m=td,p=Kc,c=16*(1&Jc),xc&&(c=16-c),Vc=f(65535,16-c);0!=--l;){for(e=m*nd+4*sd,i=p*Ac+4*(Jc>>1),a=4*(3&p),q=(3&sd)-1,h=bc+1,k=Vc,c=65535===k?16:0;0!=--h;)b=Fc[a+(q=q+1&3)],d=fd[e>>>2],j=d>>>24,255===j?(d=T(d,b),d=0===d?f(1,c):f(d,c),V(i,d,k)):0!==j&&(n=rc[i>>>2],n&=~k,n=g(n,c),n=(31744&n)<<9|(992&n)<<6|(31&n)<<3|4278190080,d=o(d,n),d=T(d,b),d=0===d?f(1,c):f(d,c),V(i,d,k)),e+=4,xc?0===c&&(i+=4):0!==c&&(i+=4),c^=16,k=~k;++m,++p}}function r(){var a,b,c,d,e,f,g,h,i;for(f=ac+1,g=td,i=Kc;0!=--f;){for(b=g*nd+4*sd,d=i*Ac+4*Jc,c=bc+1;0!=--c;)if(a=fd[b>>>2],255===(e=a>>>24)){for(rc[d>>>2]=a,b+=4,d+=4;0!=--c&&(a=fd[b>>>2])>>>24==255;)rc[d>>>2]=a,b+=4,d+=4;++c}else if(0===e){for(b+=4,d+=4;0!=--c&&(a=fd[b>>>2])>>>24==0;)b+=4,d+=4;++c}else h=rc[d>>>2],h=o(a,h),rc[d>>>2]=h,b+=4,d+=4;++g,++i}}function s(){var a,b,c,d,e,h,i,j,k,l,m,n,p,q;for(e=P(),j=jc&~Ob,m=ac+1,n=td,q=Kc,Vc=8*(3&Jc),xc&&(Vc=24-Vc),Wc=tb^f(255,Vc),i=0==(1&Jc)?0:522133279,0==(1&Kc)&&(i^=522133279);0!=--m;){for(i^=522133279,c=n*nd+4*sd,h=q*Ac+4*(Jc>>2),d=bc+1,a=Vc,l=Wc;0!=--d;)b=(fd[c>>>2]&~i)+i,k=b>>>24,k>31&&(224>k&&(p=rc[h>>>2],p&=~l,p=g(p,a),p=e[p],b=o(b,p)),b=pa(b,j),b=f(b,a),V(h,b,l)),c+=4,xc?0===a?(h+=4,a=24,l=16777215):(a-=8,l=l>>>8|4278190080):24===a?(h+=4,a=0,l=4294967040):(a+=8,l=l<<8|255),i^=522133279;++n,++q}}function t(a,b){return a&b}function u(a,b){return a&~b}function v(a,b){return~a&b}function w(a,b){return~a&~b}function x(a,b){return~b}function y(a,b){return~a|b}function z(a,b){return~a|~b}function A(a){return~a}function B(a,b){return~a^b}function C(a,b){return a|b}function D(a,b){return a|~b}function E(a,b){return a^b}function F(){var a;id===uc&&Kc>=td&&(Kc>td?(wd=-1,td=td+ac-1,Kc=Kc+ac-1):Kc===td&&Jc>sd&&(Mc=-1,sd=sd+bc-1,Jc=Jc+bc-1,Zc>1&&(a=Vc,Vc=Wc,Wc=a)),wc=Kc*Ac+4*d(Jc,zc),sc=Ac*wd-4*Zc*Mc)}function G(){return 0}function H(){return Cc>=gc?(sd=pd,Jc=Cc,bc=Cd):(sd=pd+(gc-Cc),bc=Cd-(gc-Cc),Jc=gc),Jc+bc>gc+fc&&(bc-=Jc+bc-(gc+fc)),Dc>=hc?(td=qd,Kc=Dc,ac=Rc):(td=qd+hc-Dc,ac=Rc-(hc-Dc),Kc=hc),Kc+ac>hc+ec&&(ac-=Kc+ac-(hc+ec)),_c?null:(0>sd&&(Jc-=sd,bc+=sd,sd=0),sd+bc>od&&(bc-=sd+bc-od),0>td&&(Kc-=td,ac+=td,td=0),void(td+ac>jd&&(ac-=td+ac-jd)))}function I(){return H(),0>=bc||0>=ac?(Zb=$b=_b=Yb=0,null):oa()?(K(),void lb()):Sc.primitiveFail()}function J(a,b,c){Cc=a,Dc=c,pd=a,Cd=b-a,I(),db()}function K(){if(L(),Sc.failed())return Sc.primitiveFail();if(kb())return null;if(30===oc||31===oc){if(1!==Sc.methodArgumentCount())return Sc.primitiveFail();if(ed=Sc.stackIntegerValue(0),!(!Sc.failed()&&ed>=0&&255>=ed))return Sc.primitiveFail()}dc=0,ya(),(22===oc||32===oc)&&(Zb=$b=_b=Yb=0),Mc>0?(Zb=Jc,$b=Jc+bc):(Zb=Jc-bc+1,$b=Jc+1),wd>0?(_b=Kc,Yb=Kc+ac):(_b=Kc-ac+1,Yb=Kc+1)}function L(){var a,b;if(41===oc)if(pc=255,qc=16777215,Lc=null,ud=null,Sc.methodArgumentCount()>=2){if(pc=Sc.stackIntegerValue(Sc.methodArgumentCount()-2),Sc.failed())return Sc.primitiveFail();if(qc=Sc.stackIntegerValue(Sc.methodArgumentCount()-1),Sc.failed())return Sc.primitiveFail();4===Sc.methodArgumentCount()&&(b=Sc.stackObjectValue(1),Sc.isBytes(b)&&(Lc=b.bytes),a=Sc.stackObjectValue(0),Sc.isBytes(a)&&(ud=a.bytes))}else{if(1!==Sc.methodArgumentCount())return Sc.primitiveFail();if(qc=Sc.stackIntegerValue(0),Sc.failed())return Sc.primitiveFail()}}function M(){var a,b,c,d,e,i,j,k,l,m,n,o,p,q;for(i=ad[oc+1],j=4*Mc,-32===dd?dd=e=c=0:0>dd?(e=dd+32,c=f(tb,0-dd)):0===dd?(e=0,c=tb):(e=dd-32,c=g(tb,dd)),q=~c,$c?(d=tb,Pc=0):d=_(0),n=Kc,o=1;ac>=o;o++){if(Pc>1&&(d=_(n),n+=wd),bd?(m=fd[kd>>>2],kd+=j):m=0,yc=Vc,p=fd[kd>>>2],kd+=j,b=h(m&q,e)|h(p&c,dd),m=p,k=rc[wc>>>2],a=i(b&d,k),k=yc&a|k&~yc,rc[wc>>>2]=k,wc+=j,yc=tb,3===oc)if(0===dd&&d===tb)if(-1===Mc)for(l=2;Zc-1>=l;l++)p=fd[kd>>>2],kd+=j,rc[wc>>>2]=p,wc+=j;else for(l=2;Zc-1>=l;l++)rc[wc>>>2]=m,wc+=j,m=fd[kd>>>2],kd+=j;else for(l=2;Zc-1>=l;l++)p=fd[kd>>>2],kd+=j,b=h(m&q,e)|h(p&c,dd),m=p,rc[wc>>>2]=b&d,wc+=j;else for(l=2;Zc-1>=l;l++)p=fd[kd>>>2],kd+=j,b=h(m&q,e)|h(p&c,dd),m=p,a=i(b&d,rc[wc>>>2]),rc[wc>>>2]=a,wc+=j;Zc>1&&(yc=Wc,p=fd[kd>>>2],kd+=j,b=h(m&q,e)|h(p&c,dd),k=rc[wc>>>2],a=i(b&d,k),k=yc&a|k&~yc,rc[wc>>>2]=k,wc+=j),kd+=gd,wc+=sc}}function N(){var a,b,c,d,e,f;for(c=ad[oc+1],f=1;ac>=f;f++){if(b=$c?tb:_(Kc+f-1),yc=Vc,d=rc[wc>>>2],a=c(b,d),d=yc&a|d&~yc,rc[wc>>>2]=d,wc+=4,yc=tb,3===oc)for(d=b,e=2;Zc-1>=e;e++)rc[wc>>>2]=d,wc+=4;else for(e=2;Zc-1>=e;e++)d=rc[wc>>>2],a=c(b,d),rc[wc>>>2]=a,wc+=4;Zc>1&&(yc=Wc,d=rc[wc>>>2],a=c(b,d),d=yc&a|d&~yc,rc[wc>>>2]=d,wc+=4),wc+=sc}}function O(){var a,b,c,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;for(k=ad[oc+1],md=d(32,hd),e=Xc[hd],p=Xc[tc],a=jc&~Ob,kd=td*nd+4*d(sd,md),u=md-(sd&md-1),f=u>bc?0:d(bc-u,md)+1,gd=nd-4*f,j=zc-(Jc&zc-1),s=1+(Jc+bc-1&zc-1),j>bc&&(j=bc),r=(sd&md-1)*hd,l=(Jc&zc-1)*tc,b=hd,q=tc,c=0,ld&&(r=32-hd-r,b=0-b),xc&&(l=32-tc-l,q=0-q,c=32-tc),m=1;ac>=m;m++){n=$c?tb:_(Kc+m-1),rd=r,Ic=l,yc=Vc,t=j,h=Zc;do{g=za(t,a,e,p,b,q),Ic=c,yc===tb?(o=k(g&n,rc[wc>>>2]),rc[wc>>>2]=yc&o):(i=rc[wc>>>2],o=k(g&n,i&yc),i=yc&o|i&~yc,rc[wc>>>2]=i),wc+=4,2===h?(yc=Wc,t=s):(yc=tb,t=zc)}while(0!=--h);kd+=gd,wc+=sc}}function P(){return[0,4278190081,4294967295,4286611584,4294901760,4278255360,4278190335,4278255615,4294967040,4294902015,4280295456,4282400832,4284506208,4288651167,4290756543,4292861919,4278716424,4279242768,4279769112,4280821800,4281348144,4281874488,4282927176,4283453520,4283979864,4285032552,4285558896,4286085240,4287072135,4287598479,4288124823,4289177511,4289703855,4290230199,4291282887,4291809231,4292335575,4293388263,4293914607,4294440951,4278190081,4278203136,4278216192,4278229248,4278242304,4278255360,4278190131,4278203187,4278216243,4278229299,4278242355,4278255411,4278190182,4278203238,4278216294,4278229350,4278242406,4278255462,4278190233,4278203289,4278216345,4278229401,4278242457,4278255513,4278190284,4278203340,4278216396,4278229452,4278242508,4278255564,4278190335,4278203391,4278216447,4278229503,4278242559,4278255615,4281532416,4281545472,4281558528,4281571584,4281584640,4281597696,4281532467,4281545523,4281558579,4281571635,4281584691,4281597747,4281532518,4281545574,4281558630,4281571686,4281584742,4281597798,4281532569,4281545625,4281558681,4281571737,4281584793,4281597849,4281532620,4281545676,4281558732,4281571788,4281584844,4281597900,4281532671,4281545727,4281558783,4281571839,4281584895,4281597951,4284874752,4284887808,4284900864,4284913920,4284926976,4284940032,4284874803,4284887859,4284900915,4284913971,4284927027,4284940083,4284874854,4284887910,4284900966,4284914022,4284927078,4284940134,4284874905,4284887961,4284901017,4284914073,4284927129,4284940185,4284874956,4284888012,4284901068,4284914124,4284927180,4284940236,4284875007,4284888063,4284901119,4284914175,4284927231,4284940287,4288217088,4288230144,4288243200,4288256256,4288269312,4288282368,4288217139,4288230195,4288243251,4288256307,4288269363,4288282419,4288217190,4288230246,4288243302,4288256358,4288269414,4288282470,4288217241,4288230297,4288243353,4288256409,4288269465,4288282521,4288217292,4288230348,4288243404,4288256460,4288269516,4288282572,4288217343,4288230399,4288243455,4288256511,4288269567,4288282623,4291559424,4291572480,4291585536,4291598592,4291611648,4291624704,4291559475,4291572531,4291585587,4291598643,4291611699,4291624755,4291559526,4291572582,4291585638,4291598694,4291611750,4291624806,4291559577,4291572633,4291585689,4291598745,4291611801,4291624857,4291559628,4291572684,4291585740,4291598796,4291611852,4291624908,4291559679,4291572735,4291585791,4291598847,4291611903,4291624959,4294901760,4294914816,4294927872,4294940928,4294953984,4294967040,4294901811,4294914867,4294927923,4294940979,4294954035,4294967091,4294901862,4294914918,4294927974,4294941030,4294954086,4294967142,4294901913,4294914969,4294928025,4294941081,4294954137,4294967193,4294901964,4294915020,4294928076,4294941132,4294954188,4294967244,4294902015,4294915071,4294928127,4294941183,4294954239,4294967295]}function Q(a,b,c){return b>a?d(b-a+Qb,c+1)+1:b===a?0:0-(d(a-b+Qb,c+1)+1)}function R(){var a,b,c;c=zc-1,b=zc-(Jc&c),Vc=xc?g(tb,32-b*tc):f(tb,32-b*tc),a=1+(Jc+bc-1&c),Wc=xc?f(tb,32-a*tc):g(tb,32-a*tc),b>bc?(Vc&=Wc,Wc=0,Zc=1):Zc=d(bc-b+c,zc)+1,Mc=wd=1,wc=Kc*Ac+4*d(Jc,zc),sc=Ac*wd-4*Zc*Mc}function S(a,b){return b}function T(a,b){var c;return c=b<<8,(Ec[c+(a>>>16&255)]<<10)+(Ec[c+(a>>>8&255)]<<5)+Ec[c+(255&a)]}function U(a,b){var c,d,e,f,g,h,i,j,k,l;if(e=a>0?1:0===a?0:-1,l=b>0?1:0===b?0:-1,f=Math.abs(b),i=Math.abs(a),h=d=9999,g=k=-9999,i>f){for(c=i>>1,j=1;i>=j;j++)if(Cc+=e,(c-=f)<0&&(Dc+=l,c+=i),i>j){if(I(),Sc.failed())return null;$b>Zb&&Yb>_b&&(h=Math.min(h,Zb),g=Math.max(g,$b),d=Math.min(d,_b),k=Math.max(k,Yb),(g-h)*(k-d)>4e3&&(Zb=h,$b=g,_b=d,Yb=k,db(),h=d=9999,g=k=-9999))}}else for(c=f>>1,j=1;f>=j;j++)if(Dc+=l,(c-=i)<0&&(Cc+=e,c+=f),f>j){if(I(),Sc.failed())return null;$b>Zb&&Yb>_b&&(h=Math.min(h,Zb),g=Math.max(g,$b),d=Math.min(d,_b),k=Math.max(k,Yb),(g-h)*(k-d)>4e3&&(Zb=h,$b=g,_b=d,Yb=k,db(),h=d=9999,g=k=-9999))}Zb=h,$b=g,_b=d,Yb=k,Sc.storeIntegerofObjectwithValue(Bb,cc,Cc),Sc.storeIntegerofObjectwithValue(Cb,cc,Dc)}function V(a,b,c){var d;d=rc[a>>>2],d&=c,d|=b,rc[a>>>2]=d}function W(a,b){var c,d,e,f;return c=255&a,d=Gc[7&c],e=Hc[c>>>3],f=d>b?e+1:e,c=a>>>8&255,d=Gc[7&c],e=Hc[c>>>3],f|=d>b?e+1<<5:e<<5,c=a>>>16&255,d=Gc[7&c],e=Hc[c>>>3],f|=d>b?e+1<<10:e<<10}function X(a,b){var c,d;return d=Sc.fetchPointerofObject(a,b),"number"==typeof d?d:(c=Sc.floatValueOf(d),c>=-2147483648&&2147483647>=c?0|c:(Sc.primitiveFail(),0))}function Y(a,b,c){var d,e;return e=Sc.fetchPointerofObject(a,b),"number"==typeof e?e:e.isNil?c:(d=Sc.floatValueOf(e),d>=-2147483648&&2147483647>=d?0|d:(Sc.primitiveFail(),0))}function Z(a,b){return 32!==tc?b:0===b?0:0!=(4278190080&b)?b:b|4278190080&a}function $(){return Yc}function _(a){return Nc[e(a,Pc)]}function aa(a){return!!a.isNil||(0===oc||(5===oc||(10===oc||15===oc)))}function ba(){ad[1]=G,ad[2]=t,ad[3]=u,ad[4]=fb,ad[5]=v,ad[6]=S,ad[7]=E,ad[8]=C,ad[9]=w,ad[10]=B,ad[11]=x,ad[12]=D,ad[13]=A,ad[14]=y,ad[15]=z,ad[16]=S,ad[17]=S,ad[18]=S,ad[19]=k,ad[20]=gb,ad[21]=Ma,ad[22]=_a,ad[23]=i,ad[24]=j,ad[25]=l,ad[26]=Da,ad[27]=Ca,ad[28]=Xa,ad[29]=Ya,ad[30]=Za,ad[31]=m,ad[32]=p,ad[33]=Sa,ad[34]=hb,ad[35]=o,ad[36]=o,ad[37]=o,ad[38]=$a,ad[39]=Ea,ad[40]=Ba,ad[41]=Z,ad[42]=Ra}function ca(){var a,b,c;for(b=0;255>=b;b++)for(a=0;15>=a;a++)c=W(b,a),Ec[(a<<8)+b]=c}function da(){return ba(),ca(),!0}function ea(a,b){return!a||!b||0===a[Xb]&&0===a[Vb]&&0===a[Lb]&&0===a[ub]&&16711680===b[Xb]&&65280===b[Vb]&&255===b[Lb]&&4278190080===b[ub]}function fa(){var a;if(rc=Sc.fetchPointerofObject(Rb,uc),Bc=Sc.fetchIntegerofObject(Ub,uc),vc=Sc.fetchIntegerofObject(Tb,uc),!(Bc>=0&&vc>=0))return!1;if(tc=Sc.fetchIntegerofObject(Sb,uc),xc=tc>0,0>tc&&(tc=0-tc),"number"==typeof rc){if(!Ka(rc))return!1;zc=d(32,tc),rc=Ac=0}else{if(zc=d(32,tc),Ac=4*d(Bc+(zc-1),zc),a=c(rc),!Sc.isWordsOrBytes(rc)||a!==Ac*vc)return!1;rc=rc.wordsOrBytes()}return!0}function ga(a){return ha(a,!1)}function ha(a,c){if(cc=a,Tc=c,oc=Sc.fetchIntegerofObject(Fb,cc),Sc.failed()||0>oc||oc>Wb-2)return!1;if(oc>=16&&17>=oc)return!1;if(id=Sc.fetchPointerofObject(Gb,cc),_c=aa(id),Oc=Sc.fetchPointerofObject(Db,cc),$c=aa(Oc),uc=Sc.fetchPointerofObject(Ab,a),!(Sc.isPointers(uc)&&b(uc)>=4))return!1;if(!fa())return!1;if(Cc=Y(Bb,cc,0),Dc=Y(Cb,cc,0),Cd=Y(Kb,cc,Bc),Rc=Y(Eb,cc,vc),Sc.failed())return!1;if(_c)pd=qd=0;else{if(!(Sc.isPointers(id)&&b(id)>=4))return!1;if(!ia())return!1;if(!ja())return!1;0==(jc&Ob)&&bb(),pd=Y(Hb,cc,0),qd=Y(Ib,cc,0)}return!!la()&&(gc=Y(xb,cc,0),hc=Y(yb,cc,0),fc=Y(wb,cc,Bc),ec=Y(vb,cc,vc),!Sc.failed()&&(0>gc&&(fc+=gc,gc=0),0>hc&&(ec+=hc,hc=0),gc+fc>Bc&&(fc=Bc-gc),hc+ec>vc&&(ec=vc-hc),!0))}function ia(){var a;if(fd=Sc.fetchPointerofObject(Rb,id),od=X(Ub,id),jd=X(Tb,id),!(od>=0&&jd>=0))return!1;if(hd=Sc.fetchIntegerofObject(Sb,id),ld=hd>0,0>hd&&(hd=0-hd),"number"==typeof fd){if(!La(fd))return!1;md=d(32,hd),fd=nd=0}else{if(md=d(32,hd),nd=4*d(od+(md-1),md),a=c(fd),!Sc.isWordsOrBytes(fd)||a!==nd*jd)return!1;fd=fd.wordsOrBytes()}return!0}function ja(){var a,c,d,e;if(jc=lc=ic=0,nc=null,mc=null,kc=null,c=Sc.fetchPointerofObject(zb,cc),c.isNil)return!0;if(jc=Pb,e=!1,Sc.isWords(c))d=b(c),kc=c.words,e=!0;else{if(!(Sc.isPointers(c)&&b(c)>=3))return!1;if(nc=ka(Sc.fetchPointerofObject(0,c)),mc=ka(Sc.fetchPointerofObject(1,c)),a=Sc.fetchPointerofObject(2,c),a.isNil)d=0;else{if(!Sc.isWords(a))return!1;d=b(a),kc=a.words}jc|=Ob}return 0==(d&d-1)&&(lc=d-1,ic=0,512===d&&(ic=3),4096===d&&(ic=4),32768===d&&(ic=5),0===d?(kc=null,lc=0):jc|=Nb,e&&bb(),ea(nc,mc)?(mc=null,nc=null):jc|=Mb,!0)}function ka(a){return a.isNil?null:"number"==typeof a?(Sc.primitiveFail(),null):Sc.isWords(a)&&4===b(a)?a.words:(Sc.primitiveFail(),null)}function la(){var a;if($c)return Nc=null,!0;if(Sc.isPointers(Oc)&&b(Oc)>=4)a=Sc.fetchPointerofObject(Rb,Oc),Pc=Sc.fetchIntegerofObject(Tb,Oc),Sc.isWords(a)||($c=!0);else{if(Sc.isPointers(Oc)||!Sc.isWords(Oc))return!1;a=Oc,Pc=b(a)}return Nc=a.wordsOrBytes(),!0}function ma(){return cd=Sc.ioLoadFunctionFrom("ioGetSurfaceFormat","SurfacePlugin"),Uc=Sc.ioLoadFunctionFrom("ioLockSurface","SurfacePlugin"),vd=Sc.ioLoadFunctionFrom("ioUnlockSurface","SurfacePlugin"),!!cd&&!!Uc&&!!vd}function na(a){return ha(a,!0)}function oa(){var a,b,c,d,e,f,g;if(Qc=!1,0===rc){if(!Uc&&!ma())return null;if(d=Uc,a=Sc.fetchIntegerofObject(Rb,uc),0===fd&&!_c&&(b=Sc.fetchIntegerofObject(Rb,id))===a)return Tc?(g=Math.min(sd,Jc),e=Math.max(sd,Jc)+bc,c=Math.min(td,Kc),f=Math.max(td,Kc)+ac,fd=d(b,function(a){nd=a},g,c,e-g,f-c)):fd=d(b,function(a){nd=a},0,0,od,jd),rc=fd,Ac=nd,Qc=!0,0!==rc;rc=d(a,function(a){Ac=a},Jc,Kc,bc,ac),Qc=!0}if(0===fd&&!_c){if(b=Sc.fetchIntegerofObject(Rb,id),!Uc&&!ma())return null;d=Uc,fd=Tc?d(b,function(a){nd=a},0,0,od,jd):d(b,function(a){nd=a},sd,td,bc,ac),Qc=!0}return 0!==rc&&(0!==fd||_c)}function pa(a,b){var c;return c=a,0!=(b&Pb)&&(0!=(b&Mb)&&0===(c=Wa(a,b))&&0!==a&&(c=1),0!=(b&Nb)&&(c=kc[c&lc])),c}function qa(a){0===strcmp(a,"SurfacePlugin")&&(cd=Uc=vd=0)}function ra(a,b,c,d){var e,g,h;for(h=Xc[c],e=0,g=1;d>=g;g++)(a&h)===h&&(e|=b&h),h=f(h,c);return e}function sa(a,b,c,d,e){var f,h,i,j;return j=a&e,f=b&e,i=(a^j)+(b^f),h=j&f|(j|f)&i,i^j^f|g(h,c-1)*d}function ta(a,b,c,d){var e,g,h;for(h=Xc[c],e=0,g=1;d>=g;g++)e|=Math.max(b&h,a&h),h=f(h,c);return e}function ua(a,b,c,d){var e,g,h;for(h=Xc[c],e=0,g=1;d>=g;g++)e|=Math.min(b&h,a&h),h=f(h,c);return e}function va(a,b,c,d){var e,h,i,j;return j=Xc[c],e=f(j,c),h=g((1+(a&j))*(1+(b&j))-1&e,c),1===d?h:(i=(1+(g(a,c)&j))*(1+(g(b,c)&j))-1&e,h|=i,2===d?h:(i=(1+(g(a,2*c)&j))*(1+(g(b,2*c)&j))-1&e,h|=f(i,c),3===d?h:(i=(1+(g(a,3*c)&j))*(1+(g(b,3*c)&j))-1&e,h|=f(i,2*c))))}function wa(a,b,c,d){var e,h,i,j,k,l;for(l=Xc[c],h=0,j=1;d>=j;j++)i=g(a&l,(j-1)*c),e=g(b&l,(j-1)*c),32!==c&&(16===c?(i=4278190080|Ta(i),e=4278190080|Ta(e)):(i=4278190080|Va(i,c,32),e=4278190080|Va(e,c,32))),k=Pa(i,e),32!==c&&(k=Va(k,32,c)),h|=f(k,(j-1)*c),l=f(l,c);return h}function xa(a,b,c,d){var e,g,h,i,j;for(j=Xc[c],g=0,i=1;d>=i;i++)h=a&j,e=b&j,g|=e>h?e-h:h-e,j=f(j,c);return g}function ya(){R(),_c?N():(F(),hd!==tc||0!==jc||ld!==xc?O():(eb(),M()))}function za(a,b,c,d,e,h){var i,j,k,l,m,n,o;if(k=fd[kd>>>2],o=0,j=rd,l=Ic,n=a,b===(Pb|Nb))do{i=g(k,j)&c,m=kc[i&lc],o|=f(m&d,l),l+=h,0!=(4294967264&(j+=e))&&(ld?j+=32:j-=32,k=fd[(kd+=4)>>>2])}while(0!=--n);else do{i=g(k,j)&c,m=pa(i,b),o|=f(m&d,l),l+=h,0!=(4294967264&(j+=e))&&(ld?j+=32:j-=32,k=fd[(kd+=4)>>>2])}while(0!=--n);return rd=j,o}function Aa(a,b){var c,d,e,f;return 0>a||0>b||(e=a>>>14)>=od||(f=b>>>14)>=jd?0:(d=f*nd+4*g(e,yd),c=fd[d>>>2],rd=zd[e&xd],g(c,rd)&Ad)}function Ba(a,b){var c,d,e,g,h;if(32===tc)return a===b?0:b;for(d=tc,h=Xc[d],e=0,g=1;zc>=g;g++)c=b&h,(a&h)===c&&(c=0),e|=c,h=f(h,d);return e}function Ca(a,b){return ra(~a,b,tc,zc)}function Da(a,b){return 0===a?b:a|ra(~a,b,tc,zc)}function Ea(a,b){var c,d,e,h,i;if(1===zc)return b;if(c=0,e=f(1,tc)-1,h=f(e,(zc-1)*tc),d=32-tc,c|=f(b&e,d)|g(b&h,d),2>=zc)return c;for(i=2;zc>>1>=i;i++)e=f(e,tc),h=g(h,tc),d-=2*tc,c|=f(b&e,d)|g(b&h,d);return c}function Fa(){var a;return a=Sc.stackValue(Sc.methodArgumentCount()),ga(a)?(I(),Sc.failed()?null:(db(),Sc.failed()?null:(Sc.pop(Sc.methodArgumentCount()),22===oc||32===oc?(Sc.pop(1),Sc.pushInteger(dc)):void 0))):Sc.primitiveFail()}function Ga(){var d,e,f,g,h,i,j,k,l,m,n,o,p,q;if(6!==Sc.methodArgumentCount())return Sc.primitiveFail();if(n=Sc.stackIntegerValue(0),h=Sc.stackObjectValue(1),l=Sc.stackObjectValue(2),a(h)!==Sc.classArray()||a(l)!==Sc.classArray())return Sc.primitiveFail();if(256!==b(l))return Sc.primitiveFail();if(Sc.failed())return null;if(i=b(h)-2,f=Sc.stackIntegerValue(3),o=Sc.stackIntegerValue(4),q=Sc.stackObjectValue(5),!Sc.isBytes(q))return Sc.primitiveFail();if(!(o>0&&f>0&&f<=c(q)))return Sc.primitiveFail();if(g=Sc.stackObjectValue(6),!ga(g))return Sc.primitiveFail();if(30===oc||31===oc)return Sc.primitiveFail();for(j=0!==rc&&0!==fd&&!1===_c&&id!==uc&&(0!==jc||ld!==xc||hd!==tc),m=Cc,e=q.bytes,d=o;f>=d;d++){if(p=e[d-1],0>(k=Sc.fetchIntegerofObject(p,l))||k>i)return Sc.primitiveFail();if(pd=Sc.fetchIntegerofObject(k,h),Cd=Sc.fetchIntegerofObject(k+1,h)-pd,Sc.failed())return null;if(H(),bc>0&&ac>0&&(j?(R(),O(),Zb=Jc,$b=Jc+bc,_b=Kc,Yb=Kc+ac):I()),Sc.failed())return null;Cc=Cc+Cd+n}Zb=m,db(),Sc.storeIntegerofObjectwithValue(Bb,g,Cc),Sc.pop(6)}function Ha(){var a,b,c;return b=Sc.stackValue(2),c=Sc.stackIntegerValue(1),a=Sc.stackIntegerValue(0),ga(b)?(Sc.failed()||(U(c,a),db()),void(Sc.failed()||Sc.pop(2))):Sc.primitiveFail()}function Ia(){var a,e,f,h,i,j,k,l,m,n,o,p,q;return o=Sc.stackIntegerValue(1),p=Sc.stackIntegerValue(0),e=Sc.stackValue(2),Sc.failed()?null:0>o||0>p?(q=0,Sc.failed()?null:(Sc.popthenPush(3,q),null)):(e=Sc.stackValue(Sc.methodArgumentCount()),Sc.isPointers(e)&&b(e)>=4?(i=Sc.fetchPointerofObject(Rb,e),Sc.isWordsOrBytes(i)?(Cd=Sc.fetchIntegerofObject(Ub,e),Rc=Sc.fetchIntegerofObject(Tb,e),h=Sc.fetchIntegerofObject(Sb,e),Sc.failed()?null:o>=Cd||p>=Rc?(q=0,Sc.failed()?null:(Sc.popthenPush(3,q),null)):0>h?(Sc.primitiveFail(),null):(j=d(32,h),l=d(Cd+(j-1),j),m=c(i),m!==l*Rc*4?(Sc.primitiveFail(),null):(k=Sc.fetchLong32ofObject(p*l+d(o,j),i),n=g(4294967295,32-h),f=32-(1+(o&j-1))*h,a=g(k,f)&n,q=Sc.positive32BitIntegerFor(a),Sc.failed()?null:(Sc.popthenPush(3,q),null)))):(Sc.primitiveFail(),null)):(Sc.primitiveFail(),null))}function Ja(){var a;return a=Sc.stackValue(Sc.methodArgumentCount()),na(a)?(mb(),Sc.failed()?null:(db(),Sc.failed()?null:void Sc.pop(Sc.methodArgumentCount()))):Sc.primitiveFail()}function Ka(a){return!(!cd&&!ma())&&cd(a,function(a,b,c,d){Bc=a,vc=b,tc=c,xc=d})}function La(a){return!(!cd&&!ma())&&cd(a,function(a,b,c,d){od=a,jd=b,hd=c,ld=d})}function Ma(a,b){var c,e;return 16>tc?(e=f(1,tc)-1,c=f(d(4294967295,e),tc-1),sa(a,b,tc,e,c)):16===tc?(e=31,c=1108361744,sa(2147450879&a,2147450879&b,5,e,c)):(e=255,c=2155905152,sa(a,b,8,e,c))}function Na(){var a,b,c,d,e,h,i,j,k,l,m,n,o,p;for(l=ac+1,m=td,o=Kc,c=16*(1&Jc),xc&&(c=16-c),Vc=f(65535,16-c);0!=--l;){for(e=m*nd+4*sd,i=o*Ac+4*(Jc>>1),a=4*(3&o),p=(3&sd)-1,h=bc+1,k=Vc,c=65535===k?16:0;0!=--h;)b=Fc[a+(p=p+1&3)],d=fd[e>>>2],j=16777215&d,0!==j&&(n=rc[i>>>2],n&=~k,n=g(n,c),n=(31744&n)<<9|(992&n)<<6|(31&n)<<3|4278190080,d=Pa(d,n),d=T(d,b),d=0===d?f(1,c):f(d,c),V(i,d,k)),e+=4,xc?0===c&&(i+=4):0!==c&&(i+=4),c^=16,k=~k;++m,++o}}function Oa(){var a,b,c,d,e,f,g,h;for(e=ac+1,f=td,h=Kc;0!=--e;){for(b=f*nd+4*sd,d=h*Ac+4*Jc,c=bc+1;0!=--c;)if(a=fd[b>>>2],0===(16777215&a)){for(b+=4,d+=4;0!=--c&&0==(16777215&(a=fd[b>>>2]));)b+=4,d+=4;++c}else g=rc[d>>>2],g=Pa(a,g),rc[d>>>2]=g,b+=4,d+=4;++f,++h}}function Pa(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p;return o=a,0===o?b:(d=qc,k=255&pc,n=255&o,o>>>=8,e=255&o,o>>>=8,i=255&o,o>>>=8,h=255&o,255!==k&&(h=h*k>>>8,i=i*k>>>8,e=e*k>>>8,n=n*k>>>8),j=b,f=255&j,p=255&d,ud&&(f=ud[f],p=ud[p]),m=(f*(255-n)>>>8)+(p*n>>>8),m>255&&(m=255),Lc&&(m=Lc[m]),j>>>=8,d>>>=8,f=255&j,p=255&d,ud&&(f=ud[f],p=ud[p]),c=(f*(255-e)>>>8)+(p*e>>>8),c>255&&(c=255),Lc&&(c=Lc[c]),j>>>=8,d>>>=8,f=255&j,p=255&d,ud&&(f=ud[f],p=ud[p]),l=(f*(255-i)>>>8)+(p*i>>>8),l>255&&(l=255),Lc&&(l=Lc[l]),j>>>=8,d>>>=8,g=((255&j)*(255-h)>>>8)+h,g>255&&(g=255),(((g<<8)+l<<8)+c<<8)+m)}function Qa(){var a,b,c,e,h,i,j,k,l,m,n,o,p,q;for(h=P(),k=jc&~Ob,n=ac+1,o=td,q=Kc,Vc=8*(3&Jc),xc&&(Vc=24-Vc),Wc=tb^f(255,Vc),j=0==(1&Jc)?0:522133279,0==(1&Kc)&&(j^=522133279);0!=--n;){for(j^=522133279,c=o*nd+4*sd,i=q*Ac+4*(Jc>>2),e=bc+1,a=Vc,m=Wc;0!=--e;)b=(fd[c>>>2]&~j)+j,l=16777215&b,l=d((l>>>16)+(l>>>8&255)+(255&l),3),l>31&&(l>224&&(b=4294967295),p=rc[i>>>2],p&=~m,p=g(p,a),p=h[p],b=Pa(b,p),b=pa(b,k),b=f(b,a),V(i,b,m)),c+=4,xc?0===a?(i+=4,a=24,m=16777215):(a-=8,m=m>>>8|4278190080):32===a?(i+=4,a=0,m=4294967040):(a+=8,m=m<<8|255),j^=522133279;++o,++q}}function Ra(a,b){var c;return c=a,0===c?b:wa(a,b,tc,zc)}function Sa(a,b){var c,d,e,f,h,i,j,k,l,m;for(h=Xc[tc],16===tc?(d=5,i=31):(d=8,i=255),l=yc,j=b,f=a,k=1;zc>=k;k++)(l&h)>0&&(m=j&h,c=f&h,16>tc?e=c===m?0:1:(e=xa(c,m,d,3),e=(e&i)+(g(e,d)&i)+(g(g(e,d),d)&i)),dc+=e),l=g(l,tc),f=g(f,tc),j=g(j,tc);return b}function Ta(a){return(31&a)<<3|(992&a)<<6|(31744&a)<<9}function Ua(a){return a}function Va(a,b,c){var d,e,h,i;return(d=c-b)>0?(i=f(1,b)-1,h=f(a,d),i=f(i,d),e=h&i,i=f(i,c),h=f(h,d),e+(h&i)+(f(h,d)&f(i,c))):0===d?5===b?32767&a:8===b?16777215&a:a:0===a?a:(d=b-c,i=f(1,c)-1,h=g(a,d),e=h&i,i=f(i,c),h=g(h,d),e=e+(h&i)+(g(h,d)&f(i,c)),0===e?1:e)}function Wa(a){var b;return b=h(a&mc[0],nc[0]),b|=h(a&mc[1],nc[1]),(b|=h(a&mc[2],nc[2]))|h(a&mc[3],nc[3])}function Xa(a,b){return 16>tc?ta(a,b,tc,zc):16===tc?ta(a,b,5,3)+(ta(a>>>16,b>>>16,5,3)<<16):ta(a,b,8,4)}function Ya(a,b){return 16>tc?ua(a,b,tc,zc):16===tc?ua(a,b,5,3)+(ua(a>>>16,b>>>16,5,3)<<16):ua(a,b,8,4)}function Za(a,b){var c;return c=~a,16>tc?ua(c,b,tc,zc):16===tc?ua(c,b,5,3)+(ua(c>>>16,b>>>16,5,3)<<16):ua(c,b,8,4)}function $a(a,b){return 16>tc?va(a,b,tc,zc):16===tc?va(a,b,5,3)+(va(a>>>16,b>>>16,5,3)<<16):va(a,b,8,4)}function _a(a,b){return 16>tc?xa(a,b,tc,zc):16===tc?xa(a,b,5,3)+(xa(a>>>16,b>>>16,5,3)<<16):xa(a,b,8,4)}function ab(a){return Sc=a,!1!==(Sc.majorVersion()==rb)&&Sc.minorVersion()>=sb}function bb(){var a,b;if(a=b=0,8>=hd)return null;if(16===hd&&(a=5),32===hd&&(a=8),0===ic){if(8>=tc)return null;16===tc&&(b=5),32===tc&&(b=8)}else b=ic;cb(a,b)}function cb(a,b){var c,d,e=[0,0,0,0],g=[0,0,0,0];return c=b-a,0===c?0:(0>=c?(d=f(1,b)-1,g[Xb]=f(d,2*a-c),g[Vb]=f(d,a-c),g[Lb]=f(d,0-c),g[ub]=0):(d=f(1,a)-1,g[Xb]=f(d,2*a),g[Vb]=f(d,a),g[Lb]=d),e[Xb]=3*c,e[Vb]=2*c,e[Lb]=c,e[ub]=0,nc=e,mc=g,void(jc|=Pb|Mb))}function db(){Sc.showDisplayBitsLeftTopRightBottom(uc,Zb,_b,$b,Yb)}function eb(){var a,b,c,e;e=zc-1,b=sd&e,a=Jc&e,Mc>0?(c=Math.min(bc,zc-a),bd=b+c>e):(c=Math.min(bc,a+1),bd=0>b-c+1),dd=ld?(b-a)*tc:(a-b)*tc,bd&&(0>dd?dd+=32:dd-=32),kd=td*nd+4*d(sd,d(32,hd)),gd=nd*wd-4*Zc*Mc,bd&&(gd-=4*Mc)}function fb(a){return a}function gb(a,b){return a-b}function hb(a,b){var c,d,e,f,h,i;if((jc&(Pb|Nb))!=(Pb|Nb))return b;for(c=Xc[tc],e=b,h=yc,f=1;zc>=f;f++)0!=(h&c)&&(i=e&c,d=16>tc?i:16===tc?Va(i,5,ic):Va(i,8,ic),jb(d,ib(d)+1)),h=g(h,tc),e=g(e,tc);return b}function ib(a){return kc[a&lc]}function jb(a,b){return kc[a&lc]=b}function kb(){return!_c&&((34===oc||41===oc)&&(32===hd&&(id!==uc&&(41===oc?32===tc?(Oa(),Zb=Jc,$b=Jc+bc,_b=Kc,Yb=Kc+ac,!0):16===tc?(Na(),Zb=Jc,$b=Jc+bc,_b=Kc,Yb=Kc+ac,!0):8===tc&&(Qa(),Zb=Jc,$b=Jc+bc,_b=Kc,Yb=Kc+ac,!0):!(8>tc)&&((8!==tc||0!=(jc&Pb))&&(32===tc&&r(),16===tc&&q(),8===tc&&s(),Zb=Jc,$b=Jc+bc,_b=Kc,Yb=Kc+ac,!0))))))}function lb(){var a,b,c,d;if(Qc){if(!vd&&!ma())return null;c=vd,d=!1,a=Sc.fetchPointerofObject(Rb,uc),"number"==typeof a&&(a=a,c(a,Zb,_b,$b-Zb,Yb-_b),rc=Ac=0,d=!0),_c||"number"==typeof(b=Sc.fetchPointerofObject(Rb,id))&&(b=b,d&&b===a||c(b,0,0,0,0),fd=nd=0),Qc=!1}}function mb(){var a;return a=_c,_c=!0,H(),_c=a,_c||0>=bc||0>=ac?(Zb=$b=_b=Yb=0,null):oa()?(R(),nb(),Mc>0?(Zb=Jc,$b=Jc+bc):(Zb=Jc-bc+1,$b=Jc+1),wd>0?(_b=Kc,Yb=Kc+ac):(_b=Kc-ac+1,Yb=Kc+1),void lb()):Sc.primitiveFail()}function nb(){var a,c,d,e,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B;if(k=ad[oc+1],!(b(cc)>=Jb+12))return Sc.primitiveFail();if(g=Rc-1,0>=g&&(g=1),w=X(Jb,cc),d=X(Jb+3,cc),A=Q(w,d,g),0>A&&(w=d-g*A),r=X(Jb+1,cc),d=X(Jb+4,cc),x=Q(r,d,g),0>x&&(r=d-g*x),t=X(Jb+9,cc),d=X(Jb+6,cc),l=Q(t,d,g),0>l&&(t=d-g*l),m=X(Jb+10,cc),d=X(Jb+7,cc),h=Q(m,d,g),0>h&&(m=d-g*h),Sc.failed())return!1;if(2===Sc.methodArgumentCount())if(B=Sc.stackIntegerValue(1),u=Sc.stackValue(0),u.isNil){if(16>hd)return Sc.primitiveFail()}else{if(b(u)<f(1,hd))return Sc.primitiveFail();u=u.wordsOrBytes()}else B=1,u=Sc.nilObject();for(g=Cd-1,0>=g&&(g=1),j=zc-(Jc&zc-1),y=1+(Jc+bc-1&zc-1),j>bc&&(j=bc),hc>Dc&&(w+=(hc-Dc)*A,r+=(hc-Dc)*x,t+=(hc-Dc)*l,m+=(hc-Dc)*h),ob(),B>1&&0==(jc&Ob)&&(kc?cb(8,ic):16===tc&&cb(8,5)),a=jc&~Ob,xc?(s=0-tc,c=32-tc):(s=tc,c=0),n=1;ac>=n;n++){v=Q(w,t,g),sd=v>=0?w:t-g*v,o=Q(r,m,g),td=o>=0?r:m-g*o,Ic=xc?32-(1+(Jc&zc-1))*tc:(Jc&zc-1)*tc,gc>Cc&&(sd+=(gc-Cc)*v,td+=(gc-Cc)*o),p=$c?tb:_(Kc+n-1),yc=Vc,z=j,d=Zc;do{e=1===B?qb(z,v,o,A,x,s,a):pb(z,v,o,A,x,u,B,s),Ic=c,yc===tb?(q=k(e&p,rc[wc>>>2]),rc[wc>>>2]=yc&q):(i=rc[wc>>>2],q=k(e&p,i&yc),i=yc&q|i&~yc,rc[wc>>>2]=i),wc+=4,2===d?(yc=Wc,z=y):(yc=tb,z=zc)}while(0!=--d);w+=A,r+=x,t+=l,m+=h,wc+=sc}}function ob(){var a,b;for(Bd=0,b=hd;1!==b;)++Bd,b>>>=1;for(Ad=Xc[hd],yd=5-Bd,xd=f(1,yd)-1,a=0;xd>=a;a++)zd[a]=ld?32-f(a+1,Bd):f(a,Bd)}function pb(a,b,c,e,g,h,i,j){var k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C;r=Xc[tc],l=0,2===i?(m=b>>1,o=c>>1,q=e>>1,s=g>>1):(m=d(b,i),o=d(c,i),q=d(e,i),s=d(g,i)),p=a;do{y=sd,u=td,z=A=x=v=0,B=0,n=i;do{C=y,w=u,k=i;do{t=Aa(C,w),(25!==oc||0!==t)&&(++B,t=16>hd?h[t]:16===hd?Ta(t):Ua(t),v+=255&t,x+=t>>>8&255,A+=t>>>16&255,z+=t>>>24),C+=m,w+=o}while(0!=--k);y+=q,u+=s}while(0!=--n);0===B||25===oc&&i*i>>1>B?t=0:(4===B?(A>>>=2,x>>>=2,v>>>=2,z>>>=2):(A=d(A,B),x=d(x,B),v=d(v,B),z=d(z,B)),t=(z<<24)+(A<<16)+(x<<8)+v,0===t&&A+x+v+z>0&&(t=1),t=pa(t,jc)),l|=f(t&r,Ic),Ic+=j,sd+=b,td+=c}while(0!=--p);return l}function qb(a,b,c,d,e,g,h){var i,j,k,l,m;if(l=Xc[tc],m=0,j=a,h===(Pb|Nb))do{i=Aa(sd,td),k=kc[i&lc],m|=f(k&l,Ic),Ic+=g,sd+=b,td+=c}while(0!=--j);else do{i=Aa(sd,td),k=pa(i,h),m|=f(k&l,Ic),Ic+=g,sd+=b,td+=c}while(0!=--j);return m}var rb=1,sb=11,tb=4294967295,ub=3,vb=13,wb=12,xb=10,yb=11,zb=14,Ab=0,Bb=4,Cb=5,Db=2,Eb=7,Fb=3,Gb=1,Hb=8,Ib=9,Jb=15,Kb=6,Lb=2,Mb=2,Nb=4,Ob=8,Pb=1,Qb=16384,Rb=0,Sb=3,Tb=2,Ub=1,Vb=1,Wb=43,Xb=0,Yb=0,Zb=0,$b=0,_b=0,ac=0,bc=0,cc=0,dc=0,ec=0,fc=0,gc=0,hc=0,ic=0,jc=0,kc=null,lc=0,mc=null,nc=null,oc=0,pc=0,qc=0,rc=0,sc=0,tc=0,uc=0,vc=0,wc=0,xc=0,yc=0,zc=0,Ac=0,Bc=0,Cc=0,Dc=0,Ec=new Array(4096),Fc=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5],Gc=[0,2,4,6,8,12,14,16],Hc=[0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30],Ic=0,Jc=0,Kc=0,Lc=null,Mc=0,Nc=0,Oc=0,Pc=0,Qc=0,Rc=0,Sc=null,Tc=0,Uc=null,Vc=0,Wc=0,Xc=[0,1,3,0,15,31,0,0,255,0,0,0,0,0,0,0,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1],Yc="BitBltPlugin 3 November 2014 (e)",Zc=0,$c=0,_c=0,ad=new Array(43),bd=0,cd=null,dd=0,ed=0,fd=0,gd=0,hd=0,id=0,jd=0,kd=0,ld=0,md=0,nd=0,od=0,pd=0,qd=0,rd=0,sd=0,td=0,ud=null,vd=null,wd=0,xd=0,yd=0,zd=new Array(32),Ad=0,Bd=0,Cd=0;Squeak.registerExternalModule("BitBltPlugin",{primitiveCopyBits:Fa,copyBits:I,moduleUnloaded:qa,primitiveDrawLoop:Ha,primitiveDisplayString:Ga,initialiseModule:da,loadBitBltFrom:ga,setInterpreter:ab,primitiveWarpBits:Ja,getModuleName:$,primitivePixelValueAt:Ia,copyBitsFromtoat:J})}),module("users.bert.SqueakJS.plugins.FFTPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function a(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}function b(a,b){return 0|Math.floor(a/b)}function c(a,b){return b>31?0:a<<b}function d(a){return u.success(u.isWords(a)),u.failed()?0:a.wordsAsFloat32Array()}function e(a){return u.success(u.isWords(a)),a.words}function f(){return v}function g(b){var f;return u.success(a(b)>=6),!u.failed()&&(w=u.fetchIntegerofObject(0,b),r=u.fetchIntegerofObject(1,b),f=u.fetchPointerofObject(2,b),C=a(f),B=d(f),f=u.fetchPointerofObject(3,b),y=a(f),x=e(f),f=u.fetchPointerofObject(4,b),A=a(f),z=d(f),f=u.fetchPointerofObject(5,b),t=a(f),s=d(f),u.success(c(1,w)===r&&1+(r>>2)===C&&r===A&&r===t&&A===t),!1===u.failed())}function h(){var a,b,c,d,e;for(d=0,c=y;c>d;){if(a=x[d]-1,b=x[d+1]-1,!(A>a&&A>b))return u.success(!1);e=z[a],z[a]=z[b],z[b]=e,e=s[a],s[a]=s[b],s[b]=e,d+=2}}function i(){var a;return a=u.stackObjectValue(0),g(a)?(h(),void(u.failed()&&h())):null}function j(){var a;return a=u.stackObjectValue(0),g(a)?void l():null}function k(){var a,b;return a=u.booleanValueOf(u.stackValue(0)),b=u.stackObjectValue(1),g(b)?(n(a),void(u.failed()||u.pop(1))):null}function l(){var a,b;if(1>=r)return null;for(b=1/r,a=0;r-1>=a;a++)z[a]=z[a]*b,s[a]=s[a]*b}function m(a){return u=a,!1!==(u.majorVersion()==p)&&u.minorVersion()>=q}function n(a){return h(),u.failed()?(h(),null):(o(a),void(a||l()))}function o(a){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,t;for(e=r>>1,f=r>>2,o=1;w>=o;o++)for(m=c(1,o),n=m>>1,d=b(r,m),l=1;n>=l;l++)for(t=(l-1)*d,f>t?(q=B[C-t-1],j=B[t]):(q=0-B[t-f],j=B[e-t]),a||(j=0-j),g=l;r>=g;)k=g+n-1,h=g-1,p=z[k]*q-s[k]*j,i=z[k]*j+s[k]*q,z[k]=z[h]-p,s[k]=s[h]-i,z[h]=z[h]+p,s[h]=s[h]+i,g+=m}var p=1,q=11,r=0,s=null,t=0,u=null,v="FFTPlugin 3 November 2014 (e)",w=0,x=null,y=0,z=null,A=0,B=null,C=0;Squeak.registerExternalModule("FFTPlugin",{primitiveFFTTransformData:k,setInterpreter:m,primitiveFFTPermuteData:i,primitiveFFTScaleData:j,getModuleName:f})}),module("users.bert.SqueakJS.plugins.FloatArrayPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function a(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}function b(){return w}function c(){var b,c,d,e,f,g;if(b=v.stackObjectValue(0),f=v.stackObjectValue(1),v.failed())return null;if(v.success(v.isWords(b)),v.success(v.isWords(f)),v.failed())return null;if(e=a(b),v.success(e===a(f)),v.failed())return null;for(g=f.wordsAsFloat32Array(),c=b.wordsAsFloat32Array(),d=0;e-1>=d;d++)g[d]=g[d]+c[d];v.pop(1)}function d(){var b,c,d,e,f;if(f=v.stackFloatValue(0),d=v.stackObjectValue(1),v.failed())return null;if(v.success(v.isWords(d)),v.failed())return null;for(c=a(d),e=d.wordsAsFloat32Array(),b=0;c-1>=b;b++)e[b]=e[b]+f;v.pop(1)}function e(){var b,c,d,e;return d=v.stackIntegerValue(0),e=v.stackObjectValue(1),v.failed()?null:(v.success(v.isWords(e)),v.success(d>0&&d<=a(e)),v.failed()?null:(b=e.wordsAsFloat32Array(),c=b[d-1],v.pop(2),void v.pushFloat(c)))}function f(){var b,c,d,e,f;return f=v.stackValue(0),c="number"==typeof f?f:v.floatValueOf(f),d=v.stackIntegerValue(1),e=v.stackObjectValue(2),v.failed()?null:(v.success(v.isWords(e)),v.success(d>0&&d<=a(e)),v.failed()?null:(b=e.wordsAsFloat32Array(),b[d-1]=c,void(v.failed()||v.popthenPush(3,f))))}function g(){var b,c,d,e,f,g;if(b=v.stackObjectValue(0),f=v.stackObjectValue(1),v.failed())return null;if(v.success(v.isWords(b)),v.success(v.isWords(f)),v.failed())return null;if(e=a(b),v.success(e===a(f)),v.failed())return null;for(g=f.wordsAsFloat32Array(),c=b.wordsAsFloat32Array(),d=0;e-1>=d;d++)if(0===c[d])return v.primitiveFail();for(d=0;e-1>=d;d++)g[d]=g[d]/c[d];v.pop(1)}function h(){var b,c,d,e,f,g;if(g=v.stackFloatValue(0),e=v.stackObjectValue(1),v.failed())return null;if(0===g)return v.primitiveFail();if(v.success(v.isWords(e)),v.failed())return null;for(d=a(e),f=e.wordsAsFloat32Array(),c=1/g,b=0;d-1>=b;b++)f[b]=f[b]*c;v.pop(1)}function i(){var b,c,d,e,f,g,h;if(b=v.stackObjectValue(0),f=v.stackObjectValue(1),v.failed())return null;if(v.success(v.isWords(b)),v.success(v.isWords(f)),v.failed())return null;if(e=a(b),v.success(e===a(f)),v.failed())return null;for(g=f.wordsAsFloat32Array(),c=b.wordsAsFloat32Array(),h=0,d=0;e-1>=d;d++)h+=g[d]*c[d];v.pop(2),v.pushFloat(h)}function j(){var b,c,d,e,f,g;if(b=v.stackObjectValue(0),f=v.stackObjectValue(1),v.failed())return null;if(v.success(v.isWords(b)),v.success(v.isWords(f)),v.failed())return null;if(v.pop(2),(e=a(b))!==a(f))return v.pushBool(!1);for(g=f.wordsAsFloat32Array(),c=b.wordsAsFloat32Array(),d=0;e-1>=d;d++)if(g[d]!==c[d])return v.pushBool(!1);return v.pushBool(!0)}function k(){var b,c,d,e,f;if(d=v.stackObjectValue(0),v.failed())return null;if(v.success(v.isWords(d)),v.failed())return null;for(c=a(d),e=d.wordsAsInt32Array(),f=0,b=0;c-1>=b;b++)f+=e[b];return v.pop(1),v.pushInteger(536870911&f)}function l(){var b,c,d,e,f;if(d=v.stackObjectValue(0),v.failed())return null;if(v.success(v.isWords(d)),v.failed())return null;for(c=a(d),v.success(!0),e=d.wordsAsFloat32Array(),f=0,b=0;c-1>=b;b++)f+=e[b]*e[b];f=Math.sqrt(f),v.popthenPush(1,v.floatObjectOf(f))}function m(){var b,c,d,e,f,g;if(b=v.stackObjectValue(0),f=v.stackObjectValue(1),v.failed())return null;if(v.success(v.isWords(b)),v.success(v.isWords(f)),v.failed())return null;if(e=a(b),v.success(e===a(f)),v.failed())return null;for(g=f.wordsAsFloat32Array(),c=b.wordsAsFloat32Array(),d=0;e-1>=d;d++)g[d]=g[d]*c[d];v.pop(1)}function n(){var b,c,d,e,f;if(f=v.stackFloatValue(0),d=v.stackObjectValue(1),v.failed())return null;if(v.success(v.isWords(d)),v.failed())return null;for(c=a(d),e=d.wordsAsFloat32Array(),b=0;c-1>=b;b++)e[b]=e[b]*f;v.pop(1)}function o(){var b,c,d,e,f;if(e=v.stackObjectValue(0),v.failed())return null;if(v.success(v.isWords(e)),v.failed())return null;for(d=a(e),v.success(!0),f=e.wordsAsFloat32Array(),c=0,b=0;d-1>=b;b++)c+=f[b]*f[b];if(v.success(c>0),v.failed())return null;for(c=Math.sqrt(c),b=0;d-1>=b;b++)f[b]=f[b]/c}function p(){var b,c,d,e,f,g;if(b=v.stackObjectValue(0),f=v.stackObjectValue(1),v.failed())return null;if(v.success(v.isWords(b)),v.success(v.isWords(f)),v.failed())return null;if(e=a(b),v.success(e===a(f)),v.failed())return null;for(g=f.wordsAsFloat32Array(),c=b.wordsAsFloat32Array(),d=0;e-1>=d;d++)g[d]=g[d]-c[d];v.pop(1)}function q(){var b,c,d,e,f;if(f=v.stackFloatValue(0),d=v.stackObjectValue(1),v.failed())return null;if(v.success(v.isWords(d)),v.failed())return null;for(c=a(d),e=d.wordsAsFloat32Array(),b=0;c-1>=b;b++)e[b]=e[b]-f;v.pop(1)}function r(){var b,c,d,e,f;if(d=v.stackObjectValue(0),v.failed())return null;if(v.success(v.isWords(d)),v.failed())return null;for(c=a(d),e=d.wordsAsFloat32Array(),f=0,b=0;c-1>=b;b++)f+=e[b];v.popthenPush(1,v.floatObjectOf(f))}function s(a){return v=a,!1!==(v.majorVersion()==t)&&v.minorVersion()>=u}var t=1,u=11,v=null,w="FloatArrayPlugin 3 November 2014 (e)";Squeak.registerExternalModule("FloatArrayPlugin",{primitiveMulFloatArray:m,primitiveEqual:j,primitiveAtPut:f,primitiveAt:e,primitiveNormalize:o,primitiveSubFloatArray:p,primitiveDivFloatArray:g,primitiveAddScalar:d,primitiveDotProduct:i,primitiveSubScalar:q,setInterpreter:s,primitiveSum:r,getModuleName:b,primitiveHashArray:k,primitiveMulScalar:n,primitiveLength:l,primitiveAddFloatArray:c,primitiveDivScalar:h})}),module("users.bert.SqueakJS.plugins.GeniePlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function a(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}function b(a,b){return new Int32Array(a.buffer,a.byteOffset+4*b)}function c(a,b){var c,d,e,f,g,h;return c=a[0],f=a[1],d=b[0],g=b[1],e=d-c,h=g-f,e*e+h*h}function d(a,b){var c;return c=Math.abs(b-a),c>180&&(c=360-c),c*c>>>6}function e(){return o}function f(){return 2}function g(){return 0}function h(a){console.log(o+": "+a)}function i(){var e,f,g,i,j,k,l,m,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa;if(Q=n.stackValue(11),R=n.stackValue(10),S=n.stackValue(9),T=n.stackValue(8),U=n.stackValue(7),V=n.stackValue(6),W=n.stackValue(5),X=n.stackValue(4),Y=n.stackIntegerValue(3),Z=n.stackValue(2),$=n.stackValue(1),_=n.stackValue(0),n.failed())return null;if(n.failed())return h("failed 1"),null;if(n.success(n.isWords(Q)&&n.isWords(R)&&n.isWords(S)&&n.isWords(T)&&n.isWords(U)&&n.isWords(V)&&n.isWords(W)&&n.isWords(X)&&n.isWords(Z)&&n.isWords($)&&n.isWords(_)),n.failed())return h("failed 2"),null;if(n.success(n.isMemberOf(Q,"PointArray")&&n.isMemberOf(R,"PointArray")),n.failed())return h("failed 3"),null;if(s=Q.wordsAsInt32Array(),x=R.wordsAsInt32Array(),z=S.wordsAsInt32Array(),o=T.wordsAsInt32Array(),u=U.wordsAsInt32Array(),q=V.wordsAsInt32Array(),M=W.wordsAsInt32Array(),e=X.wordsAsInt32Array(),B=Z.wordsAsInt32Array(),O=$.wordsAsInt32Array(),A=_.wordsAsInt32Array(),y=a(R)>>>1,H=a(S)>>>1,p=a(T)>>>1,f=a(V),r=a(Z),n.success(r===a($)&&r===a(_)&&r>p),n.failed())return h("failed 4"),null;if(n.success(a(U)>=H-1&&a(Q)>>>1>=H&&f>=p-1&&y>=p&&a(W)>=H-1&&a(X)>=p-1),n.failed())return h("failed 5"),null;if(g=1&Y,J=Y>>>1,C=1<<29,v=g?0:J*J>>>10,B[0]=0,O[0]=0,A[0]=2,F=0-v,t=p,!(y>=t-1&&f>=t-1))return n.primitiveFail(),null;for(E=1;t>=E;E++)i=E-1,F=F+(q[i]+c(b(x,i<<1),s)>>>7)+v,O[E]=F,B[E]=F*E,A[E]=E+1;for(F=O[0]-v,G=1;H>=G;G++){for(j=G-1,D=j<<1,L=B[0],F=F+(u[j]+c(b(s,D),x)>>>7)+v,O[0]=F,B[0]=F*G,A[0]=G+1,t=p,E=1;t>=E;E++)i=E-1,k=i<<1,K=B[E],P=B[i],w=u[j]+c(b(s,D),b(x,E<<1))>>>7,0===(F=O[E])?K+=w:(K=K+F+w*A[E],w+=F),m=q[i]+c(b(x,k),b(s,G<<1))>>>7,0===(F=O[i])?P+=m:(P=P+F+m*A[i],m+=F),g?L=C:(I=(c(b(o,k),b(z,D))+c(b(x,k),b(s,D)))*(16+d(e[i],M[j]))>>>11,L+=I),K>=L&&P>=L?(l=L,F=0,N=1):P>=K?(l=K,F=w+v,N=A[E]+1):(l=P,F=m+v,N=A[i]+1),L=B[E],B[E]=Math.min(l,C),O[E]=Math.min(F,C),A[E]=N;F=O[0]}return aa=l,n.failed()?null:(n.popthenPush(13,aa),null)}function j(){var a;return a=1e3*f()+g(),n.failed()?null:(n.popthenPush(1,a),null)}function k(a){return n=a,!1!==(n.majorVersion()==l)&&n.minorVersion()>=m}var l=1,m=11,n=null,o="GeniePlugin v2.0 14 November 2014 (e)";Squeak.registerExternalModule("GeniePlugin",{primVersionNO:j,setInterpreter:k,primSameClassAbsoluteStrokeDistanceMyPoints_otherPoints_myVectors_otherVectors_mySquaredLengths_otherSquaredLengths_myAngles_otherAngles_maxSizeAndReferenceFlag_rowBase_rowInsertRemove_rowInsertRemoveCount:i,getModuleName:e})}),module("users.bert.SqueakJS.plugins.JPEGReaderPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function a(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}function b(a){return a.bytes?a.bytes.length:a.words?4*a.words.length:0}function c(a,b){return 0|Math.floor(a/b)}function d(a,b){return b>31?0:a<<b}function e(a,b){return b>31?0:a>>>b}function f(a){return g(pa,a)&&h(oa,a)}function g(b,c){return"number"!=typeof c&&(!!va.isPointers(c)&&(!(a(c)<ha)&&(b[I]=va.fetchIntegerofObject(I,c),b[J]=va.fetchIntegerofObject(J,c),b[ba]=va.fetchIntegerofObject(ba,c),b[la]=va.fetchIntegerofObject(la,c),b[G]=va.fetchIntegerofObject(G,c),b[da]=va.fetchIntegerofObject(da,c),b[ia]=va.fetchIntegerofObject(ia,c),!va.failed())))}function h(b,c){var d,e,f,g;if("number"==typeof c)return!1;if(!va.isPointers(c))return!1;if(a(c)<ha)return!1;if("number"==typeof(d=va.fetchPointerofObject(ca,c)))return!1;if(!va.isPointers(d))return!1;if((g=a(d))>fa)return!1;for(f=0;g-1>=f;f++){if("number"==typeof(e=va.fetchPointerofObject(f,d)))return!1;if(!va.isWords(e))return!1;if(a(e)!==L)return!1;b[f]=e.wordsAsInt32Array()}return!va.failed()}function i(){var a,b;for(Ha[I]=0,Ha[J]=0,a=0;xa-1>=a;a++)b=u(),b+=Fa[aa],b=Math.min(b,ga),Fa[aa]=b&ua,b&=ga-ua,b=Math.max(b,1),wa[a]=4278190080+(b<<16)+(b<<8)+b}function j(){var a,b,c,d,e,f,g;for(Ha[I]=0,Ha[J]=0,pa[I]=0,pa[J]=0,ra[I]=0,ra[J]=0,e=0;xa-1>=e;e++)g=u(),b=s(),b-=ka,c=t(),c-=ka,f=g+(U*c>>16)+Fa[ja],f=Math.min(f,ga),f=Math.max(f,0),Fa[ja]=f&ua,f&=ga-ua,f=Math.max(f,1),d=g-(N*b>>16)-(Q*c>>16)+Fa[aa],d=Math.min(d,ga),d=Math.max(d,0),Fa[aa]=d&ua,d&=ga-ua,d=Math.max(d,1),a=g+(W*b>>16)+Fa[H],a=Math.min(a,ga),a=Math.max(a,0),Fa[H]=a&ua,a&=ga-ua,a=Math.max(a,1),wa[e]=4278190080+(f<<16)+(d<<8)+a}function k(a){return g(ra,a)&&h(qa,a)}function l(a,b){var c,d,e,f,g;if(0>(d=q(sa,ta)))return va.primitiveFail();for(0!==d&&(c=n(d),d=z(c,d)),d=b[ia]=b[ia]+d,a[0]=d,e=1;L-1>=e;e++)a[e]=0;for(f=1;L>f;){if(0>(d=q(ma,na)))return va.primitiveFail();if(g=d>>>4,0!==(d&=15)){if(f+=g,c=n(d),d=z(c,d),0>f||f>=L)return va.primitiveFail();a[ya[f]]=d}else{if(15!==g)return null;f+=g}++f}}function m(){for(var a;16>=Aa;){if(!(Da>Ca))return Aa;if(a=Ba[Ca],++Ca,255===a){if(!(Da>Ca&&0===Ba[Ca]))return--Ca,Aa;++Ca}za=za<<8|a,Aa+=8}return Aa}function n(a){var b;return a>Aa&&(m(),a>Aa)?-1:(Aa-=a,b=e(za,Aa),za&=d(1,Aa)-1,b)}function o(){return Ea}function p(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v=new Array(64);for(e=0;K-1>=e;e++){for(c=-1,g=1;K-1>=g;g++)-1===c&&0!==a[g*K+e]&&(c=g);if(-1===c)for(d=a[e]*b[0]<<2,f=0;K-1>=f;f++)v[f*K+e]=d;else r=a[2*K+e]*b[2*K+e],s=a[6*K+e]*b[6*K+e],q=(r+s)*P,n=q+s*(0-X),o=q+r*R,r=a[e]*b[e],s=a[4*K+e]*b[4*K+e],h=r+s<<13,i=r-s<<13,j=h+o,m=h-o,k=i+n,l=i-n,h=a[7*K+e]*b[7*K+e],i=a[5*K+e]*b[5*K+e],n=a[3*K+e]*b[3*K+e],o=a[K+e]*b[K+e],q=h+o,r=i+n,s=h+n,t=i+o,u=(s+t)*T,h*=M,i*=Z,n*=_,o*=V,q*=0-S,r*=0-$,s*=0-Y,t*=0-O,s+=u,t+=u,h=h+q+s,i=i+r+t,n=n+r+s,o=o+q+t,v[e]=j+o>>11,v[7*K+e]=j-o>>11,v[1*K+e]=k+n>>11,v[6*K+e]=k-n>>11,v[2*K+e]=l+i>>11,v[5*K+e]=l-i>>11,v[3*K+e]=m+h>>11,v[4*K+e]=m-h>>11}for(e=0;L-K>=e;e+=K)r=v[e+2],s=v[e+6],q=(r+s)*P,n=q+s*(0-X),o=q+r*R,h=v[e]+v[e+4]<<13,i=v[e]-v[e+4]<<13,j=h+o,m=h-o,k=i+n,l=i-n,h=v[e+7],i=v[e+5],n=v[e+3],o=v[e+1],q=h+o,r=i+n,s=h+n,t=i+o,u=(s+t)*T,h*=M,i*=Z,n*=_,o*=V,q*=0-S,r*=0-$,s*=0-Y,t*=0-O,s+=u,t+=u,h=h+q+s,i=i+r+t,n=n+r+s,o=o+q+t,p=(j+o>>18)+ka,p=Math.min(p,ga),p=Math.max(p,0),a[e]=p,p=(j-o>>18)+ka,p=Math.min(p,ga),p=Math.max(p,0),a[e+7]=p,p=(k+n>>18)+ka,p=Math.min(p,ga),p=Math.max(p,0),a[e+1]=p,p=(k-n>>18)+ka,p=Math.min(p,ga),p=Math.max(p,0),a[e+6]=p,p=(l+i>>18)+ka,p=Math.min(p,ga),p=Math.max(p,0),a[e+2]=p,p=(l-i>>18)+ka,p=Math.min(p,ga),p=Math.max(p,0),a[e+5]=p,p=(m+h>>18)+ka,p=Math.min(p,ga),p=Math.max(p,0),a[e+3]=p,p=(m-h>>18)+ka,p=Math.min(p,ga),p=Math.max(p,0),a[e+4]=p}function q(a,b){var c,d,e,f,g;if((d=a[0]>>>24)>ea)return-1;for(f=2;;){if(0>(c=n(d)))return-1;if((e=f+c-1)>=b)return-1;if(0==(1056964608&(g=a[e])))return g;if(f=65535&g,(d=g>>>24&255)>ea)return-1}return-1}function r(c){var d,e;return!(a(c)<5)&&(!!va.isPointers(c)&&("number"!=typeof(d=va.fetchPointerofObject(0,c))&&(!!va.isBytes(d)&&(Ba=d.bytes,e=b(d),Ca=va.fetchIntegerofObject(1,c),Da=va.fetchIntegerofObject(2,c),za=va.fetchIntegerofObject(3,c),Aa=va.fetchIntegerofObject(4,c),!va.failed()&&(!(Da>e)&&!(0>Ca||Ca>=Da))))))}function s(){var a,b,d,e,f,g,h,i;return d=b=pa[I],e=pa[J],h=pa[ba],i=pa[la],0!==h&&0!==i&&(d=c(d,h),e=c(e,i)),a=(e>>>3)*pa[G]+(d>>>3),g=((7&e)<<3)+(7&d),f=oa[a][g],++b,b<8*pa[da]?pa[I]=b:(pa[I]=0,pa[J]++),f}function t(){var a,b,d,e,f,g,h,i;return d=b=ra[I],e=ra[J],h=ra[ba],i=ra[la],0!==h&&0!==i&&(d=c(d,h),e=c(e,i)),a=(e>>>3)*ra[G]+(d>>>3),g=((7&e)<<3)+(7&d),f=qa[a][g],++b,b<8*ra[da]?ra[I]=b:(ra[I]=0,ra[J]++),f}function u(){var a,b,d,e,f,g,h,i;return d=b=Ha[I],e=Ha[J],h=Ha[ba],i=Ha[la],0!==h&&0!==i&&(d=c(d,h),e=c(e,i)),a=(e>>>3)*Ha[G]+(d>>>3),g=((7&e)<<3)+(7&d),f=Ga[a][g],++b,b<8*Ha[da]?Ha[I]=b:(Ha[I]=0,Ha[J]++),f}function v(){var b;return B(),4!==va.methodArgumentCount()?va.primitiveFail():(ua=va.stackIntegerValue(0),b=va.stackObjectValue(1),va.failed()?null:va.isWords(b)&&3===a(b)?(Fa=b.wordsAsInt32Array(),b=va.stackObjectValue(2),va.failed()?null:va.isWords(b)?(xa=a(b),wa=b.wordsAsInt32Array(),b=va.stackObjectValue(3),va.failed()?null:D(b)?(i(),void va.pop(4)):va.primitiveFail()):va.primitiveFail()):va.primitiveFail())}function w(){var b;return B(),4!==va.methodArgumentCount()?va.primitiveFail():(ua=va.stackIntegerValue(0),b=va.stackObjectValue(1),va.failed()?null:va.isWords(b)&&3===a(b)?(Fa=b.wordsAsInt32Array(),b=va.stackObjectValue(2),va.failed()?null:va.isWords(b)?(xa=a(b),wa=b.wordsAsInt32Array(),b=va.stackObjectValue(3),va.failed()?null:va.isPointers(b)&&3===a(b)&&D(va.fetchPointerofObject(0,b))&&f(va.fetchPointerofObject(1,b))&&k(va.fetchPointerofObject(2,b))?(j(),void va.pop(4)):va.primitiveFail()):va.primitiveFail()):va.primitiveFail())}function x(){var b,c,d;return 5!==va.methodArgumentCount()?va.primitiveFail():(d=va.stackObjectValue(0),va.failed()?null:r(d)?(c=va.stackObjectValue(1),va.failed()?null:va.isWords(c)?(na=a(c),ma=c.wordsAsInt32Array(),c=va.stackObjectValue(2),va.failed()?null:va.isWords(c)?(ta=a(c),sa=c.wordsAsInt32Array(),d=va.stackObjectValue(3),va.failed()?null:g(Ha,d)?(c=va.stackObjectValue(4),va.failed()?null:va.isWords(c)?a(c)!==L?va.primitiveFail():(b=c.wordsAsInt32Array(),va.failed()?null:(l(b,Ha),va.failed()?null:(C(va.stackValue(0)),va.storeIntegerofObjectwithValue(ia,va.stackValue(3),Ha[ia]),void va.pop(5)))):va.primitiveFail()):va.primitiveFail()):va.primitiveFail()):va.primitiveFail()):va.primitiveFail())}function y(){var b,c,d;return 2!==va.methodArgumentCount()?va.primitiveFail():(c=va.stackObjectValue(0),va.failed()?null:va.isWords(c)&&a(c)===L?(d=c.wordsAsInt32Array(),c=va.stackObjectValue(1),va.failed()?null:va.isWords(c)&&a(c)===L?(b=c.wordsAsInt32Array(),p(b,d),void va.pop(2)):va.primitiveFail()):va.primitiveFail())}function z(a,b){return a<d(1,b-1)?a-d(1,b)+1:a}function A(a){return va=a,!1!==(va.majorVersion()==E)&&va.minorVersion()>=F}function B(){}function C(a){va.storeIntegerofObjectwithValue(1,a,Ca),va.storeIntegerofObjectwithValue(3,a,za),va.storeIntegerofObjectwithValue(4,a,Aa)}function D(a){return g(Ha,a)&&h(Ga,a)}var E=1,F=11,G=5,H=2,I=0,J=1,K=8,L=64,M=2446,N=22554,O=3196,P=4433,Q=46802,R=6270,S=7373,T=9633,U=91881,V=12299,W=116130,X=15137,Y=16069,Z=16819,$=20995,_=25172,aa=1,ba=2,ca=4,da=8,ea=16,fa=128,ga=255,ha=11,ia=10,ja=0,ka=127,la=3,ma=null,na=0,oa=new Array(128),pa=new Array(11),qa=new Array(128),ra=new Array(11),sa=null,ta=0,ua=0,va=null,wa=null,xa=0,ya=[0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63],za=0,Aa=0,Ba=null,Ca=0,Da=0,Ea="JPEGReaderPlugin 3 November 2014 (e)",Fa=null,Ga=new Array(128),Ha=new Array(11);Squeak.registerExternalModule("JPEGReaderPlugin",{setInterpreter:A,primitiveIdctInt:y,primitiveColorConvertMCU:w,primitiveColorConvertGrayscaleMCU:v,primitiveDecodeMCU:x,getModuleName:o})}),module("users.bert.SqueakJS.plugins.KedamaPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function a(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}function b(a,b){return 0|Math.floor(a/b)}function c(a,c){return a-b(a,c)*c|0}function d(a,b){return 0>b?-31>b?0:a>>>0-b:b>31?0:a<<b}function e(a,b){var c,d;return 0===a?b>=0?90:270:(c=b/a,d=Math.atan(c),a>=0?b>=0?d/.0174532925199433:360+d/.0174532925199433:180+d/.0174532925199433)}function f(a){var b,c;return b=90-a,c=b/360|0,0>b&&--c,.0174532925199433*(b-360*c)}function g(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;if(l=$.stackValue(0),d=$.stackValue(1),r=$.stackValue(2),o=$.stackValue(3),f=$.stackIntegerValue(4),h=$.stackIntegerValue(5),g=$.stackValue(6),$.failed())return null;if(!$.isWords(g))return $.primitiveFail(),null;if(!$.isWords(o))return $.primitiveFail(),null;if(!$.isWords(r))return $.primitiveFail(),null;if(!$.isWords(d))return $.primitiveFail(),null;if(!$.isBytes(l))return $.primitiveFail(),null;if(f*h!==a(g))return $.primitiveFail(),null;if(j=a(o),a(r)!==j)return $.primitiveFail(),null;if(a(d)!==j)return $.primitiveFail(),null;if(a(l)!==j)return $.primitiveFail(),null;for(n=o.wordsAsFloat32Array(),q=r.wordsAsFloat32Array(),c=d.words,k=l.bytes,e=g.words,i=0;j-1>=i;i++)m=0|n[i],p=0|q[i],0!==k[i]&&m>=0&&p>=0&&h>m&&f>p&&(b=p*h+m,e[b]=c[i]);return $.failed()?null:void $.pop(7)}function h(){var b,c,d,e,f,g,h;if(g=$.stackValue(0),d=$.stackValue(1),$.failed())return null;if(!$.isWords(d))return $.primitiveFail(),null;if(!$.isWords(g))return $.primitiveFail(),null;if(h=a(d),a(g)!==h)return $.primitiveFail(),null;for(c=d.wordsAsFloat32Array(),f=g.wordsAsFloat32Array(),e=0;h-1>=e;e++)b=c[e],b/=.0174532925199433,b=90-b,b>0||(b+=360),f[e]=b;return $.failed()?null:void $.pop(2)}function i(){return aa}function j(){var b,c,d,e;return d=$.stackValue(0),e=$.stackIntegerValue(1),$.failed()?null:$.isWords(d)?a(d)<e?($.primitiveFail(),null):(c=d.wordsAsFloat32Array(),b=c[e-1],b=F(b),$.failed()?null:($.pop(3),void $.pushFloat(b))):($.primitiveFail(),null)}function k(){_=17,ba=16807,ca=2147483647,da=b(ca,ba),ea=c(ca,ba)}function l(a){var d,e,f,g,h;return f=0>a?0-a:a,d=b(_,da),e=c(_,da),_=ba*e-ea*d,g=65535&_,h=g*(f+1)>>>16,0>a?0-h:h}function m(){var a;return a=$.stackIntegerValue(0),$.failed()?null:(_=65536&a,void $.pop(1))}function n(){var b,c,e,f,g,h,i,j,k,l,m,n;if(n=$.stackIntegerValue(0),m=$.stackIntegerValue(1),k=$.stackValue(2),f=$.stackValue(3),$.failed())return null;if(g=a(f),l=a(k),g!==l)return $.primitiveFail(),null;if(-32>n)return $.primitiveFail(),null;if(n>8)return $.primitiveFail(),null;for(c=f.words,j=k.words,h=4278190080,i=0;g-1>=i;i++)e=c[i],b=d(e,n),b>255&&(b=255),0>b&&(b=0),j[i]=b<<24&h|m;$.pop(4)}function o(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;if(o=$.stackValue(0),p=$.stackIntegerValue(1),j=$.stackValue(2),e=$.stackValue(3),$.failed())return null;if(m=o.words,l=m[0],$.failed())return null;if(n=Math.log(l),f=a(e),k=a(j),f!==k)return $.primitiveFail(),null;for(c=e.words,i=j.words,g=4278190080,h=0;f-1>=h;h++)d=c[h],b=0===d?0:255/n*Math.log(d)|0,b>255&&(b=255),i[h]=b<<24&g|p;$.pop(4)}function p(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;if(b=$.stackIntegerValue(0),j=$.stackIntegerValue(1),p=$.stackValue(2),m=$.stackValue(3),i=$.stackValue(4),f=$.stackValue(5),!$.isWords(p))return $.primitiveFail(),null;if(!$.isWords(m))return $.primitiveFail(),null;if(!$.isWords(i))return $.primitiveFail(),null;if(!$.isWords(f))return $.primitiveFail(),null;if(g=a(i),a(m)!==g)return $.primitiveFail(),null;if(a(p)!==g)return $.primitiveFail(),null;if(a(f)!==b*j)return $.primitiveFail(),null;for(l=m.wordsAsFloat32Array(),o=p.wordsAsFloat32Array(),h=i.words,d=f.words,c=0;b*j-1>=c;c++)d[c]=0;for(c=0;g-1>=c;c++)k=l[c],n=o[c],(e=j*n+k)>=0&&b*j>e&&(d[e]=h[c]);return $.failed()?null:void $.pop(6)}function q(){var b,c,d,e,f,g,h,i,j,k;return d=$.stackIntegerValue(0),g=$.stackIntegerValue(1),k=$.stackFloatValue(2),i=$.stackFloatValue(3),c=$.stackValue(4),$.failed()?null:$.isWords(c)?a(c)!==d*g?($.primitiveFail(),null):(h=0|i,j=0|k,b=c.words,h>=0&&g>h&&j>=0&&d>j?(e=j*g+h,f=b[e]):f=0,$.failed()?null:($.pop(6),void $.pushInteger(f))):($.primitiveFail(),null)}function r(){var b,c,d,e,f,g,h,i,j,k,l;return d=$.stackIntegerValue(0),h=$.stackIntegerValue(1),g=$.stackIntegerValue(2),l=$.stackFloatValue(3),j=$.stackFloatValue(4),c=$.stackValue(5),$.failed()?null:$.isWords(c)?a(c)!==d*h?($.primitiveFail(),null):(i=0|j,k=0|l,f=g,f>1073741823&&(f=1073741823),0>f&&(f=0),b=c.words,i>=0&&h>i&&k>=0&&d>k&&(e=k*h+i,b[e]=f),$.failed()?null:void $.pop(6)):($.primitiveFail(),null)}function s(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;if(h=$.stackValue(0),c=$.stackIntegerValue(1),f=$.stackIntegerValue(2),e=$.stackValue(3),p=$.stackValue(4),m=$.stackValue(5),$.failed())return null;if(!$.isWords(h))return $.primitiveFail(),null;if(!$.isWords(m))return $.primitiveFail(),null;if(!$.isWords(p))return $.primitiveFail(),null;if(!$.isWords(e))return $.primitiveFail(),null;if(c*f!==a(e))return $.primitiveFail(),null;if(j=a(m),a(p)!==j)return $.primitiveFail(),null;if(a(h)!==j)return $.primitiveFail(),null;for(l=m.wordsAsFloat32Array(),o=p.wordsAsFloat32Array(),g=h.words,b=e.words,i=0;j-1>=i;i++)k=0|l[i],n=0|o[i],k>=0&&n>=0&&f>k&&c>n&&(d=n*f+k,g[i]=b[d]);return $.failed()?null:void $.pop(6)}function t(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;return b=$.stackIntegerValue(0),o=$.stackIntegerValue(1),m=$.stackIntegerValue(2),j=$.stackIntegerValue(3),c=$.stackFloatValue(4),d=$.stackFloatValue(5),p=$.stackFloatValue(6),g=$.stackValue(7),t=$.stackValue(8),r=$.stackValue(9),i=$.stackIntegerValue(10),$.failed()?null:$.isWords(r)&&$.isWords(t)&&$.isWords(g)?(n=a(r),a(t)!==n?($.primitiveFail(),null):a(g)!==n?($.primitiveFail(),null):(q=r.wordsAsFloat32Array(),s=t.wordsAsFloat32Array(),f=g.wordsAsFloat32Array(),e=p,h=i-1,k=q[h]+e*Math.cos(f[h]),l=s[h]-e*Math.sin(f[h]),L(h,q,f,k,d,j,m),M(h,s,f,l,c,o,b),$.failed()?null:void $.pop(11))):($.primitiveFail(),null)}function u(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;if(l=$.stackValue(0),c=$.stackIntegerValue(1),f=$.stackIntegerValue(2),e=$.stackValue(3),s=$.stackValue(4),p=$.stackValue(5),$.failed())return null;if(!$.isWords(p))return $.primitiveFail(),null;if(!$.isWords(s))return $.primitiveFail(),null;if(!$.isWords(e))return $.primitiveFail(),null;if(c*f!==a(e))return $.primitiveFail(),null;if(j=a(p),a(s)!==j)return $.primitiveFail(),null;if(i="number"==typeof l,i&&(h=l),!i){if(!$.isMemberOf(l,"WordArray"))return $.primitiveFail(),null;if(a(l)!==j)return $.primitiveFail(),null}for(o=p.wordsAsFloat32Array(),r=s.wordsAsFloat32Array(),i||(m=l.words),b=e.words,i&&(k=h),g=0;j-1>=g;g++)n=0|o[g],q=0|r[g],n>=0&&q>=0&&f>n&&c>q&&(d=q*f+n,i||(k=m[g]),b[d]=k);return $.failed()?null:void $.pop(6)}function v(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;if(b=$.stackIntegerValue(0),o=$.stackIntegerValue(1),m=$.stackIntegerValue(2),j=$.stackIntegerValue(3),c=$.stackFloatValue(4),d=$.stackFloatValue(5),r=$.stackValue(6),g=$.stackValue(7),v=$.stackValue(8),t=$.stackValue(9),$.failed())return null;if(!$.isWords(t))return $.primitiveFail(),null;if(!$.isWords(v))return $.primitiveFail(),null;if(!$.isWords(g))return $.primitiveFail(),null;if(r.isFloat)i=!1;else{if(!$.isWords(r))return $.primitiveFail(),null;i=!0}if(n=a(t),a(v)!==n)return $.primitiveFail(),null;if(a(g)!==n)return $.primitiveFail(),null;if(i&&a(r)!==n)return $.primitiveFail(),null;for(s=t.wordsAsFloat32Array(),u=v.wordsAsFloat32Array(),f=g.wordsAsFloat32Array(),i?q=r.wordsAsFloat32Array():p=$.floatValueOf(r),h=0;n-1>=h;h++)e=i?q[h]:p,k=s[h]+e*Math.cos(f[h]),l=u[h]-e*Math.sin(f[h]),L(h,s,f,k,d,j,m),M(h,u,f,l,c,o,b);return $.failed()?null:void $.pop(10)}function w(){var b,c,d,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x;if(m=$.stackIntegerValue(0),g=$.stackIntegerValue(1),v=$.stackIntegerValue(2),c=$.stackValue(3),p=$.stackFloatValue(4),r=$.stackFloatValue(5),q=$.stackFloatValue(6),$.failed())return null;if(!$.isWords(c))return $.primitiveFail(),null;if(a(c)!==g*v)return $.primitiveFail(),null;for(b=c.words,t=q,u=r,t=Math.max(t,0),u=Math.max(u,0),t=Math.min(t,v-1),u=Math.min(u,g-1),n=Math.max(t-m,0),d=Math.min(t+m,v-1),o=Math.max(u-m,0),f=Math.min(u+m,g-1),h=b[u*v+t],i=-1,x=o;f>=x;x++)for(l=x*v,w=n;d>=w;w++)(s=b[l+w])>h&&(i=w,j=x,h=s);return k=-1===i?F(p):e(i-t,j-u)+90|0,$.failed()?null:($.pop(8),void $.pushFloat(k))}function x(){var b,c,d,e,f,g,h,i,j,k,l,m,n;if(k=$.stackObjectValue(0),b=$.stackObjectValue(1),j=$.stackObjectValue(2),$.failed())return null;if($.success($.isWords(b)),$.success($.isWords(j)),$.success($.isWords(k)),$.failed())return null;if(i=a(b),$.success(i===a(j)),$.success(i===a(k)),$.failed())return null;if(g=$.isMemberOf(b,"WordArray"),h=$.isMemberOf(j,"WordArray"),g&&h){if(!$.isMemberOf(k,"WordArray"))return $.primitiveFail(),null}else if(!$.isMemberOf(k,"KedamaFloatArray"))return $.primitiveFail(),null;if(h)if(g)for(m=j.words,l=b.words,n=k.words,f=0;i-1>=f;f++)n[f]=m[f]+l[f];else for(m=j.words,c=b.wordsAsFloat32Array(),e=k.wordsAsFloat32Array(),f=0;i-1>=f;f++)e[f]=m[f]+c[f];else if(g)for(d=j.wordsAsFloat32Array(),l=b.words,e=k.wordsAsFloat32Array(),f=0;i-1>=f;f++)e[f]=d[f]+l[f];else for(d=j.wordsAsFloat32Array(),c=b.wordsAsFloat32Array(),e=k.wordsAsFloat32Array(),f=0;i-1>=f;f++)e[f]=d[f]+c[f];$.pop(4),$.push(k)}function y(){var b,c,d,e,f,g,h,i,j,k,l,m,n;if(l=$.stackObjectValue(0),b=$.stackValue(1),k=$.stackObjectValue(2),$.failed())return null;if($.success($.isWords(k)),$.success($.isWords(l)),$.failed())return null;if(j=a(k),$.success(j===a(l)),$.failed())return null;if(h="number"==typeof b,i=$.isMemberOf(k,"WordArray"),h&&i){if(!$.isMemberOf(l,"WordArray"))return $.primitiveFail(),null}else if(!$.isMemberOf(l,"KedamaFloatArray"))return $.primitiveFail(),null;if(i)if(h)for(m=k.words,g=b,n=l.words,f=0;j-1>=f;f++)n[f]=m[f]+g;else for(m=k.words,c=$.floatValueOf(b),e=l.wordsAsFloat32Array(),f=0;j-1>=f;f++)e[f]=m[f]+c;else if(h)for(d=k.wordsAsFloat32Array(),g=b,e=l.wordsAsFloat32Array(),f=0;j-1>=f;f++)e[f]=d[f]+g;else for(d=k.wordsAsFloat32Array(),c=$.floatValueOf(b),e=l.wordsAsFloat32Array(),f=0;j-1>=f;f++)e[f]=d[f]+c;$.pop(4),$.push(l)}function z(){var b,c,d,e,f,g,h,i,j,k,l,m,n;if(k=$.stackObjectValue(0),b=$.stackObjectValue(1),j=$.stackObjectValue(2),$.failed())return null;if($.success($.isWords(b)),$.success($.isWords(j)),$.success($.isWords(k)),$.failed())return null;if(i=a(b),$.success(i===a(j)),$.success(i===a(k)),$.failed())return null;if(g=$.isMemberOf(b,"WordArray"),h=$.isMemberOf(j,"WordArray"),g&&h){if(!$.isMemberOf(k,"WordArray"))return $.primitiveFail(),null}else if(!$.isMemberOf(k,"KedamaFloatArray"))return $.primitiveFail(),null;if(h)if(g)for(m=j.words,l=b.words,n=k.words,f=0;i-1>=f;f++)n[f]=m[f]/l[f];else for(m=j.words,c=b.wordsAsFloat32Array(),e=k.wordsAsFloat32Array(),f=0;i-1>=f;f++)e[f]=m[f]/c[f];else if(g)for(d=j.wordsAsFloat32Array(),l=b.words,e=k.wordsAsFloat32Array(),f=0;i-1>=f;f++)e[f]=d[f]/l[f];else for(d=j.wordsAsFloat32Array(),c=b.wordsAsFloat32Array(),e=k.wordsAsFloat32Array(),f=0;i-1>=f;f++)e[f]=d[f]/c[f];$.pop(4),$.push(k)}function A(){var c,d,e,f,g,h,i,j,k,l,m,n,o;if(m=$.stackObjectValue(0),c=$.stackValue(1),l=$.stackObjectValue(2),$.failed())return null;if($.success($.isWords(l)),$.success($.isWords(m)),$.failed())return null;if(k=a(l),$.success(k===a(m)),$.failed())return null;if(i="number"==typeof c,j=$.isMemberOf(l,"WordArray"),i&&j){if(!$.isMemberOf(m,"WordArray"))return $.primitiveFail(),null}else if(!$.isMemberOf(m,"KedamaFloatArray"))return $.primitiveFail(),null;if(j)if(i)for(n=l.words,h=c,o=m.words,g=0;k-1>=g;g++)o[g]=b(n[g],h);else for(n=l.words,d=$.floatValueOf(c),f=m.wordsAsFloat32Array(),g=0;k-1>=g;g++)f[g]=n[g]/d;else if(i)for(e=l.wordsAsFloat32Array(),h=c,f=m.wordsAsFloat32Array(),g=0;k-1>=g;g++)f[g]=e[g]/h;else for(e=l.wordsAsFloat32Array(),d=$.floatValueOf(c),f=m.wordsAsFloat32Array(),g=0;k-1>=g;g++)f[g]=e[g]/d;$.pop(4),$.push(m)}function B(){var b,c,d,e,f,g,h,i,j,k,l,m,n;if(k=$.stackObjectValue(0),b=$.stackObjectValue(1),j=$.stackObjectValue(2),$.failed())return null;if($.success($.isWords(b)),$.success($.isWords(j)),$.success($.isWords(k)),$.failed())return null;if(i=a(b),$.success(i===a(j)),$.success(i===a(k)),$.failed())return null;if(g=$.isMemberOf(b,"WordArray"),h=$.isMemberOf(j,"WordArray"),g&&h){if(!$.isMemberOf(k,"WordArray"))return $.primitiveFail(),null}else if(!$.isMemberOf(k,"KedamaFloatArray"))return $.primitiveFail(),null;if(h)if(g)for(m=j.words,l=b.words,n=k.words,f=0;i-1>=f;f++)n[f]=m[f]*l[f];else for(m=j.words,c=b.wordsAsFloat32Array(),e=k.wordsAsFloat32Array(),f=0;i-1>=f;f++)e[f]=m[f]*c[f];else if(g)for(d=j.wordsAsFloat32Array(),l=b.words,e=k.wordsAsFloat32Array(),f=0;i-1>=f;f++)e[f]=d[f]*l[f];else for(d=j.wordsAsFloat32Array(),c=b.wordsAsFloat32Array(),e=k.wordsAsFloat32Array(),f=0;i-1>=f;f++)e[f]=d[f]*c[f];$.pop(4),$.push(k)}function C(){var b,c,d,e,f,g,h,i,j,k,l,m,n;if(l=$.stackObjectValue(0),b=$.stackValue(1),k=$.stackObjectValue(2),$.failed())return null;if($.success($.isWords(k)),$.success($.isWords(l)),$.failed())return null;if(j=a(k),$.success(j===a(l)),$.failed())return null;if(h="number"==typeof b,i=$.isMemberOf(k,"WordArray"),h&&i){if(!$.isMemberOf(l,"WordArray"))return $.primitiveFail(),null}else if(!$.isMemberOf(l,"KedamaFloatArray"))return $.primitiveFail(),null;if(i)if(h)for(m=k.words,g=b,n=l.words,f=0;j-1>=f;f++)n[f]=m[f]*g;else for(m=k.words,c=$.floatValueOf(b),e=l.wordsAsFloat32Array(),f=0;j-1>=f;f++)e[f]=m[f]*c;else if(h)for(d=k.wordsAsFloat32Array(),g=b,e=l.wordsAsFloat32Array(),f=0;j-1>=f;f++)e[f]=d[f]*g;else for(d=k.wordsAsFloat32Array(),c=$.floatValueOf(b),e=l.wordsAsFloat32Array(),f=0;j-1>=f;f++)e[f]=d[f]*c;$.pop(4),$.push(l)}function D(){var b,c,d,e,f,g,h,i,j,k,l,m,n;if(k=$.stackObjectValue(0),b=$.stackObjectValue(1),j=$.stackObjectValue(2),$.failed())return null;if($.success($.isWords(b)),$.success($.isWords(j)),$.success($.isWords(k)),$.failed())return null;if(i=a(b),$.success(i===a(j)),$.success(i===a(k)),$.failed())return null;if(g=$.isMemberOf(b,"WordArray"),h=$.isMemberOf(j,"WordArray"),g&&h){if(!$.isMemberOf(k,"WordArray"))return $.primitiveFail(),null}else if(!$.isMemberOf(k,"KedamaFloatArray"))return $.primitiveFail(),null;if(h)if(g)for(m=j.words,l=b.words,n=k.words,f=0;i-1>=f;f++)n[f]=m[f]-l[f];else for(m=j.words,c=b.wordsAsFloat32Array(),e=k.wordsAsFloat32Array(),f=0;i-1>=f;f++)e[f]=m[f]-c[f];else if(g)for(d=j.wordsAsFloat32Array(),l=b.words,e=k.wordsAsFloat32Array(),f=0;i-1>=f;f++)e[f]=d[f]-l[f];else for(d=j.wordsAsFloat32Array(),c=b.wordsAsFloat32Array(),e=k.wordsAsFloat32Array(),f=0;i-1>=f;f++)e[f]=d[f]-c[f];$.pop(4),$.push(k)}function E(){var b,c,d,e,f,g,h,i,j,k,l,m,n;if(l=$.stackObjectValue(0),b=$.stackValue(1),k=$.stackObjectValue(2),$.failed())return null;if($.success($.isWords(k)),$.success($.isWords(l)),$.failed())return null;if(j=a(k),$.success(j===a(l)),$.failed())return null;if(h="number"==typeof b,i=$.isMemberOf(k,"WordArray"),h&&i){if(!$.isMemberOf(l,"WordArray"))return $.primitiveFail(),null}else if(!$.isMemberOf(l,"KedamaFloatArray"))return $.primitiveFail(),null;if(i)if(h)for(m=k.words,g=b,n=l.words,f=0;j-1>=f;f++)n[f]=m[f]-g;else for(m=k.words,c=$.floatValueOf(b),e=l.wordsAsFloat32Array(),f=0;j-1>=f;f++)e[f]=m[f]-c;else if(h)for(d=k.wordsAsFloat32Array(),g=b,e=l.wordsAsFloat32Array(),f=0;j-1>=f;f++)e[f]=d[f]-g;else for(d=k.wordsAsFloat32Array(),c=$.floatValueOf(b),e=l.wordsAsFloat32Array(),f=0;j-1>=f;f++)e[f]=d[f]-c;$.pop(4),$.push(l)}function F(a){var b,c;return c=a/.0174532925199433,b=90-c,b>0||(b+=360),b}function G(){var b,c,d,e,f,g,h;if(b=$.stackFloatValue(0),d=$.stackValue(1),h=$.stackIntegerValue(2),e=$.stackIntegerValue(3),g=$.stackIntegerValue(4),$.failed())return null;if(!$.isWords(d))return $.primitiveFail(),null;if(!(a(d)>=h&&e>=1&&h>=e))return $.primitiveFail(),null;if(c=d.wordsAsFloat32Array(),$.failed())return null;for(f=e;h>=f;f++)c[f-1]=l(g)*b;$.pop(5)}function H(){var b,c,d,e,f,g,h;if(b=$.stackFloatValue(0),f=$.stackValue(1),h=$.stackIntegerValue(2),c=$.stackIntegerValue(3),g=$.stackIntegerValue(4),$.failed())return null;if(!$.isWords(f))return $.primitiveFail(),null;if(!(a(f)>=h&&c>=1&&h>=c))return $.primitiveFail(),null;if(e=f.words,$.failed())return null;for(d=c;h>=d;d++)e[d-1]=l(g)*b|0;$.pop(5)}function I(){var a,b;return a=$.stackIntegerValue(0),$.failed()?null:(b=l(a),$.failed()?null:($.pop(2),void $.pushInteger(b)))}function J(){var a,b,c,d,f,g,h;return b=$.stackFloatValue(0),a=$.stackFloatValue(1),f=$.stackFloatValue(2),d=$.stackFloatValue(3),$.failed()?null:(g=d-a,h=f-b,c=e(g,h),c+=90,c>360&&(c-=360),$.failed()?null:($.pop(5),void $.pushFloat(c)))}function K(){var a,b,c,d,e,f,g;return b=$.stackFloatValue(0),a=$.stackFloatValue(1),e=$.stackFloatValue(2),d=$.stackFloatValue(3),$.failed()?null:(f=a-d,g=b-e,c=Math.sqrt(f*f+g*g),$.failed()?null:($.pop(5),void $.pushFloat(c)))}function L(a,b,c,d,e,f,g){var h,i;i=d,0>i&&(1===f&&(i+=e),2===f&&(i=0),3===f&&(i=0-i,h=c[a],c[a]=3.141592653589793>h?3.141592653589793-h:9.42477796076938-h)),i>=e&&(1===g&&(i-=e),2===g&&(i=e-1e-6),3===g&&(i=e-1e-6-(i-e),h=c[a],c[a]=3.141592653589793>h?3.141592653589793-h:9.42477796076938-h)),b[a]=i}function M(a,b,c,d,e,f,g){var h;h=d,0>h&&(1===f&&(h+=e),2===f&&(h=0),3===f&&(h=0-h,c[a]=6.283185307179586-c[a])),h>=e&&(1===g&&(h-=e),2===g&&(h=e-1e-6),3===g&&(h=e-1e-6-(h-e),c[a]=6.283185307179586-c[a])),b[a]=h}function N(){var b,c,d,e,g,h,i,j;if(i=$.stackValue(0),d=$.stackValue(1),$.failed())return null;if(!$.isWords(d))return $.primitiveFail(),null;if(j=a(d),i.isFloat)g=!1;else{if(!$.isWords(i))return $.primitiveFail(),null;if(a(i)!==j)return $.primitiveFail(),null;g=!0}for(c=d.wordsAsFloat32Array(),g?h=i.wordsAsFloat32Array():(b=$.floatValueOf(i),b=f(b)),e=0;j-1>=e;e++)g&&(b=h[e],b=f(b)),c[e]=b;return $.failed()?null:void $.pop(2)}function O(a){return $=a,!1!==($.majorVersion()==Y)&&$.minorVersion()>=Z}function P(){var b,c,d,e;return b=$.stackFloatValue(0),d=$.stackValue(1),e=$.stackIntegerValue(2),$.failed()?null:$.isWords(d)?a(d)<e?($.primitiveFail(),null):(c=d.wordsAsFloat32Array(),c[e-1]=f(b),$.failed()?null:void $.pop(3)):($.primitiveFail(),null)}function Q(){return!0}function R(){var b,c,d,e,f,g,h,i,j,k;return f=$.stackIntegerValue(0),e=$.stackIntegerValue(1),b=$.stackFloatValue(2),h=$.stackFloatValue(3),d=$.stackValue(4),j=$.stackIntegerValue(5),k=$.stackValue(6),$.failed()?null:$.isWords(k)&&$.isWords(d)?(g=a(k),a(d)!==g?($.primitiveFail(),null):(i=k.wordsAsFloat32Array(),c=d.wordsAsFloat32Array(),L(j-1,i,c,h,b,e,f),$.failed()?null:void $.pop(7))):($.primitiveFail(),null)}function S(){var b,c,d,e,f,g,h,i,j,k;return b=$.stackIntegerValue(0),g=$.stackIntegerValue(1),c=$.stackFloatValue(2),h=$.stackFloatValue(3),e=$.stackValue(4),j=$.stackIntegerValue(5),k=$.stackValue(6),$.failed()?null:$.isWords(k)&&$.isWords(e)?(f=a(k),a(e)!==f?($.primitiveFail(),null):(i=k.wordsAsFloat32Array(),d=e.wordsAsFloat32Array(),M(j-1,i,d,h,c,g,b),$.failed()?null:void $.pop(7))):($.primitiveFail(),null)}function T(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o;if(i=$.stackIntegerValue(0),g=$.stackIntegerValue(1),b=$.stackFloatValue(2),m=$.stackValue(3),d=$.stackValue(4),o=$.stackValue(5),$.failed())return null;if(!$.isWords(o))return $.primitiveFail(),null;if(!$.isWords(d))return $.primitiveFail(),null;if(m.isFloat)f=!1;else{if(!$.isWords(m))return $.primitiveFail(),null;f=!0}if(j=a(o),a(d)!==j)return $.primitiveFail(),null;if(f&&a(m)!==j)return $.primitiveFail(),null;for(n=o.wordsAsFloat32Array(),c=d.wordsAsFloat32Array(),f?l=m.wordsAsFloat32Array():k=$.floatValueOf(m),e=0;j-1>=e;e++)h=f?l[e]:k,L(e,n,c,h,b,g,i);return $.failed()?null:void $.pop(6)}function U(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o;if(b=$.stackIntegerValue(0),j=$.stackIntegerValue(1),c=$.stackFloatValue(2),m=$.stackValue(3),e=$.stackValue(4),o=$.stackValue(5),$.failed())return null;if(!$.isWords(o))return $.primitiveFail(),null;if(!$.isWords(e))return $.primitiveFail(),null;if(m.isFloat)g=!1;else{if(!$.isWords(m))return $.primitiveFail(),null;g=!0}if(i=a(o),a(e)!==i)return $.primitiveFail(),null;if(g&&a(m)!==i)return $.primitiveFail(),null;for(n=o.wordsAsFloat32Array(),d=e.wordsAsFloat32Array(),g?l=m.wordsAsFloat32Array():k=$.floatValueOf(m),f=0;i-1>=f;f++)h=g?l[f]:k,M(f,n,d,h,c,j,b);return $.failed()?null:void $.pop(6)}function V(){var b,c,d,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;if(m=$.stackValue(0),t=$.stackValue(1),q=$.stackValue(2),h=$.stackValue(3),f=$.stackValue(4),$.failed())return null;if(!$.isWords(m))return $.primitiveFail(),null;if(!$.isWords(q))return $.primitiveFail(),null;if(!$.isWords(t))return $.primitiveFail(),null;if(0>(n=a(m)))return $.primitiveFail(),null;if(a(q)!==n)return $.primitiveFail(),null;if(a(t)!==n)return $.primitiveFail(),null;if(f.isFloat){if(!h.isFloat)return $.primitiveFail(),null;c=!1}else{if(h.isFloat)return $.primitiveFail(),null;c=!0}if(c){if(a(f)!==n)return $.primitiveFail(),null;if(a(h)!==n)return $.primitiveFail(),null}for(l=m.wordsAsFloat32Array(),p=q.wordsAsFloat32Array(),s=t.wordsAsFloat32Array(),c&&(d=f.wordsAsFloat32Array(),g=h.wordsAsFloat32Array()),c||(i=$.floatValueOf(f),j=$.floatValueOf(h)),b=0;n-1>=b;b++)c&&(i=d[b],j=g[b]),o=i-p[b],r=j-s[b],k=e(o,r),k+=90,k>360&&(k-=360),l[b]=k;return $.failed()?null:($.pop(6),void $.push(m))}function W(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;if(k=$.stackValue(0),r=$.stackValue(1),o=$.stackValue(2),g=$.stackValue(3),e=$.stackValue(4),$.failed())return null;if(!$.isWords(k))return $.primitiveFail(),null;if(!$.isWords(o))return $.primitiveFail(),null;if(!$.isWords(r))return $.primitiveFail(),null;if(0>(l=a(k)))return $.primitiveFail(),null;if(a(o)!==l)return $.primitiveFail(),null;if(a(r)!==l)return $.primitiveFail(),null;if(e.isFloat){if(!g.isFloat)return $.primitiveFail(),null;c=!1}else{if(g.isFloat)return $.primitiveFail(),null;c=!0}if(c){if(a(e)!==l)return $.primitiveFail(),null;if(a(g)!==l)return $.primitiveFail(),null}for(j=k.wordsAsFloat32Array(),n=o.wordsAsFloat32Array(),q=r.wordsAsFloat32Array(),c&&(d=e.wordsAsFloat32Array(),f=g.wordsAsFloat32Array()),c||(h=$.floatValueOf(e),i=$.floatValueOf(g)),b=0;l-1>=b;b++)c&&(h=d[b],i=f[b]),m=h-n[b],p=i-q[b],j[b]=Math.sqrt(m*m+p*p);return $.failed()?null:($.pop(6),void $.push(k))}function X(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;if(s=$.stackIntegerValue(0),q=$.stackIntegerValue(1),h=$.stackIntegerValue(2),j=$.stackIntegerValue(3),d=$.stackValue(4),k=$.stackValue(5),$.failed())return null;if(n=a(k),f=a(d),j*h!==n)return $.primitiveFail(),null;if(n*q*s!==f)return $.primitiveFail(),null;for(i=k.words,c=d.words,l=0,m=0,e=0,p=0;h-1>=p;p++){for(r=0;s-1>=r;r++){for(o=0;j-1>=o;o++)for(b=i[l],++l,g=0;q-1>=g;g++)c[e]=b,++e;l=m}m+=j,l=m}$.pop(6)}var Y=1,Z=11,$=null,_=0,aa="KedamaPlugin 3 November 2014 (e)",ba=0,ca=0,da=0,ea=0;Squeak.registerExternalModule("KedamaPlugin",{makeMaskLog:o,vectorGetDistanceTo:W,getScalarHeading:j,shutdownModule:Q,primitiveAddScalar:y,primSetPixelsAtXY:u,turtleScalarSetX:R,primPixelAtXY:q,primUpHill:w,primScalarForward:t,primitiveDivArrays:z,getModuleName:i,primitiveSubArrays:D,scalarGetAngleTo:J,randomRange:I,setInterpreter:O,kedamaSetRandomSeed:m,drawTurtlesInArray:g,turtleScalarSetY:S,randomIntoIntegerArray:H,getHeadingArrayInto:h,makeTurtlesMap:p,setHeadingArrayFrom:N,turtlesSetX:T,setScalarHeading:P,makeMask:n,primitiveDivScalar:A,primitiveSubScalar:E,primPixelsAtXY:s,vectorGetAngleTo:V,primitiveMulArrays:B,primPixelAtXYPut:r,zoomBitmap:X,initialiseModule:k,primitiveAddArrays:x,scalarGetDistanceTo:K,turtlesSetY:U,randomIntoFloatArray:G,primTurtlesForward:v,primitiveMulScalar:C})}),module("users.bert.SqueakJS.plugins.KedamaPlugin2").requires("users.bert.SqueakJS.vm").toRun(function(){function a(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}function b(a,b){return 0|Math.floor(a/b)}function c(a,c){return a-b(a,c)*c|0}function d(a,b){return 0>b?-31>b?0:a>>>0-b:b>31?0:a<<b}function e(a,b){var c,d;return 0===a?b>=0?90:270:(c=b/a,d=Math.atan(c),a>=0?b>=0?d/.0174532925199433:360+d/.0174532925199433:180+d/.0174532925199433)}function f(a){var b,c;return b=90-a,c=b/360|0,0>b&&--c,.0174532925199433*(b-360*c)}function g(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;if(l=va.stackValue(0),d=va.stackValue(1),r=va.stackValue(2),o=va.stackValue(3),f=va.stackIntegerValue(4),h=va.stackIntegerValue(5),g=va.stackValue(6),va.failed())return null;if(!va.isWords(g))return va.primitiveFail(),null;if(!va.isWords(o))return va.primitiveFail(),null;if(!va.isWords(r))return va.primitiveFail(),null;if(!va.isWords(d))return va.primitiveFail(),null;if(!va.isBytes(l))return va.primitiveFail(),null;if(f*h!==a(g))return va.primitiveFail(),null;if(j=a(o),a(r)!==j)return va.primitiveFail(),null;if(a(d)!==j)return va.primitiveFail(),null;if(a(l)!==j)return va.primitiveFail(),null;for(n=o.wordsAsFloat32Array(),q=r.wordsAsFloat32Array(),c=d.words,k=l.bytes,e=g.words,i=0;j-1>=i;i++)m=0|n[i],p=0|q[i],0!==k[i]&&m>=0&&p>=0&&h>m&&f>p&&(b=p*h+m,e[b]=c[i]);return va.failed()?null:void va.pop(7)}function h(){var b,c,d,e,f,g,h;if(g=va.stackValue(0),d=va.stackValue(1),va.failed())return null;if(!va.isWords(d))return va.primitiveFail(),null;if(!va.isWords(g))return va.primitiveFail(),null;if(h=a(d),a(g)!==h)return va.primitiveFail(),null;for(c=d.wordsAsFloat32Array(),f=g.wordsAsFloat32Array(),e=0;h-1>=e;e++)b=c[e],b/=.0174532925199433,b=90-b,b>0||(b+=360),f[e]=b;return va.failed()?null:void va.pop(2)}function i(){return xa}function j(){var b,c,d,e;return d=va.stackValue(0),e=va.stackIntegerValue(1),va.failed()?null:va.isWords(d)?a(d)<e?(va.primitiveFail(),null):(c=d.wordsAsFloat32Array(),b=c[e-1],b=aa(b),va.failed()?null:(va.pop(3),void va.pushFloat(b))):(va.primitiveFail(),null)}function k(){wa=17,ya=16807,za=2147483647,Aa=b(za,ya),Ba=c(za,ya)}function l(a){var d,e,f,g,h;return f=0>a?0-a:a,d=b(wa,Aa),e=c(wa,Aa),wa=ya*e-Ba*d,g=65535&wa,h=g*(f+1)>>>16,0>a?0-h:h}function m(){var a;return a=va.stackIntegerValue(0),va.failed()?null:(wa=65536&a,void va.pop(1))}function n(){var b,c,e,f,g,h,i,j,k,l,m,n;if(n=va.stackIntegerValue(0),m=va.stackIntegerValue(1),k=va.stackValue(2),f=va.stackValue(3),va.failed())return null;if(g=a(f),l=a(k),g!==l)return va.primitiveFail(),null;if(-32>n)return va.primitiveFail(),null;if(n>8)return va.primitiveFail(),null;for(c=f.words,j=k.words,h=4278190080,i=0;g-1>=i;i++)e=c[i],b=d(e,n),b>255&&(b=255),0>b&&(b=0),j[i]=b<<24&h|m;va.pop(4)}function o(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;if(o=va.stackValue(0),p=va.stackIntegerValue(1),j=va.stackValue(2),e=va.stackValue(3),va.failed())return null;if(m=o.words,l=m[0],va.failed())return null;if(n=Math.log(l),f=a(e),k=a(j),f!==k)return va.primitiveFail(),null;for(c=e.words,i=j.words,g=4278190080,h=0;f-1>=h;h++)d=c[h],b=0===d?0:255/n*Math.log(d)|0,b>255&&(b=255),i[h]=b<<24&g|p;va.pop(4)}function p(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;if(b=va.stackIntegerValue(0),j=va.stackIntegerValue(1),p=va.stackValue(2),m=va.stackValue(3),i=va.stackValue(4),f=va.stackValue(5),!va.isWords(p))return va.primitiveFail(),null;if(!va.isWords(m))return va.primitiveFail(),null;if(!va.isWords(i))return va.primitiveFail(),null;if(!va.isWords(f))return va.primitiveFail(),null;if(g=a(i),a(m)!==g)return va.primitiveFail(),null;if(a(p)!==g)return va.primitiveFail(),null;if(a(f)!==b*j)return va.primitiveFail(),null;for(l=m.wordsAsFloat32Array(),o=p.wordsAsFloat32Array(),h=i.words,d=f.words,c=0;b*j-1>=c;c++)d[c]=0;for(c=0;g-1>=c;c++)k=l[c],n=o[c],(e=j*n+k)>=0&&b*j>e&&(d[e]=h[c]);return va.failed()?null:void va.pop(6)}function q(){var b,c,d,e,f,g,h,i,j,k;return d=va.stackIntegerValue(0),g=va.stackIntegerValue(1),k=va.stackFloatValue(2),i=va.stackFloatValue(3),c=va.stackValue(4),va.failed()?null:va.isWords(c)?a(c)!==d*g?(va.primitiveFail(),null):(h=0|i,j=0|k,b=c.words,h>=0&&g>h&&j>=0&&d>j?(e=j*g+h,f=b[e]):f=0,va.failed()?null:(va.pop(6),void va.pushInteger(f))):(va.primitiveFail(),null)}function r(){var b,c,d,e,f,g,h,i,j,k,l;return d=va.stackIntegerValue(0),h=va.stackIntegerValue(1),g=va.stackIntegerValue(2),l=va.stackFloatValue(3),j=va.stackFloatValue(4),c=va.stackValue(5),va.failed()?null:va.isWords(c)?a(c)!==d*h?(va.primitiveFail(),null):(i=0|j,k=0|l,f=g,f>1073741823&&(f=1073741823),0>f&&(f=0),b=c.words,i>=0&&h>i&&k>=0&&d>k&&(e=k*h+i,b[e]=f),va.failed()?null:void va.pop(6)):(va.primitiveFail(),null)}function s(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;if(h=va.stackValue(0),c=va.stackIntegerValue(1),f=va.stackIntegerValue(2),e=va.stackValue(3),p=va.stackValue(4),m=va.stackValue(5),va.failed())return null;if(!va.isWords(h))return va.primitiveFail(),null;if(!va.isWords(m))return va.primitiveFail(),null;if(!va.isWords(p))return va.primitiveFail(),null;if(!va.isWords(e))return va.primitiveFail(),null;if(c*f!==a(e))return va.primitiveFail(),null;if(j=a(m),a(p)!==j)return va.primitiveFail(),null;if(a(h)!==j)return va.primitiveFail(),null;for(l=m.wordsAsFloat32Array(),o=p.wordsAsFloat32Array(),g=h.words,b=e.words,i=0;j-1>=i;i++)k=0|l[i],n=0|o[i],k>=0&&n>=0&&f>k&&c>n&&(d=n*f+k,g[i]=b[d]);return va.failed()?null:void va.pop(6)}function t(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;return b=va.stackIntegerValue(0),o=va.stackIntegerValue(1),m=va.stackIntegerValue(2),j=va.stackIntegerValue(3),c=va.stackFloatValue(4),d=va.stackFloatValue(5),p=va.stackFloatValue(6),g=va.stackValue(7),t=va.stackValue(8),r=va.stackValue(9),i=va.stackIntegerValue(10),va.failed()?null:va.isWords(r)&&va.isWords(t)&&va.isWords(g)?(n=a(r),a(t)!==n?(va.primitiveFail(),null):a(g)!==n?(va.primitiveFail(),null):(q=r.wordsAsFloat32Array(),s=t.wordsAsFloat32Array(),f=g.wordsAsFloat32Array(),e=p,h=i-1,k=q[h]+e*Math.cos(f[h]),l=s[h]-e*Math.sin(f[h]),ga(h,q,f,k,d,j,m),ha(h,s,f,l,c,o,b),va.failed()?null:void va.pop(11))):(va.primitiveFail(),null)}function u(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x;if(q=va.stackValue(0),c=va.stackIntegerValue(1),f=va.stackIntegerValue(2),e=va.stackValue(3),x=va.stackValue(4),u=va.stackValue(5),n=va.stackValue(6),va.failed())return null;if(!va.isBytes(n))return va.primitiveFail(),null;if(!va.isWords(u))return va.primitiveFail(),null;if(!va.isWords(x))return va.primitiveFail(),null;if(!va.isWords(e))return va.primitiveFail(),null;if(c*f!==a(e))return va.primitiveFail(),null;if(o=a(u),a(n)!==o)return va.primitiveFail(),null;if(a(x)!==o)return va.primitiveFail(),null;if(m=n.bytes,t=u.wordsAsFloat32Array(),w=x.wordsAsFloat32Array(),k="number"==typeof q)j=q,p=j;else{if(a(q)!==o)return va.primitiveFail(),null;l=va.isMemberOf(q,"WordArray"),l?r=q.words:g=q.wordsAsFloat32Array()}for(b=e.words,i=0;o-1>=i;i++)1===m[i]&&(s=0|t[i],v=0|w[i],s>=0&&v>=0&&f>s&&c>v&&(d=v*f+s,k?b[d]=p:l?b[d]=r[i]:(h=g[i],b[d]=h)));return va.failed()?null:void va.pop(7)}function v(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x;if(b=va.stackIntegerValue(0),q=va.stackIntegerValue(1),o=va.stackIntegerValue(2),j=va.stackIntegerValue(3),c=va.stackFloatValue(4),d=va.stackFloatValue(5),t=va.stackValue(6),g=va.stackValue(7),x=va.stackValue(8),v=va.stackValue(9),n=va.stackValue(10),va.failed())return null;if(!va.isBytes(n))return va.primitiveFail(),null;if(!va.isWords(v))return va.primitiveFail(),null;if(!va.isWords(x))return va.primitiveFail(),null;if(!va.isWords(g))return va.primitiveFail(),null;if(t.isFloat)i=!1;else{if(!va.isWords(t))return va.primitiveFail(),null;i=!0}if(p=a(v),a(x)!==p)return va.primitiveFail(),null;if(a(g)!==p)return va.primitiveFail(),null;if(a(n)!==p)return va.primitiveFail(),null;if(i&&a(t)!==p)return va.primitiveFail(),null;for(m=n.bytes,u=v.wordsAsFloat32Array(),w=x.wordsAsFloat32Array(),f=g.wordsAsFloat32Array(),i?s=t.wordsAsFloat32Array():r=va.floatValueOf(t),h=0;p-1>=h;h++)1===m[h]&&(e=i?s[h]:r,k=u[h]+e*Math.cos(f[h]),l=w[h]-e*Math.sin(f[h]),ga(h,u,f,k,d,j,o),ha(h,w,f,l,c,q,b));return va.failed()?null:void va.pop(11)}function w(){var b,c,d,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x;if(m=va.stackIntegerValue(0),g=va.stackIntegerValue(1),v=va.stackIntegerValue(2),c=va.stackValue(3),p=va.stackFloatValue(4),r=va.stackFloatValue(5),q=va.stackFloatValue(6),va.failed())return null;if(!va.isWords(c))return va.primitiveFail(),null;if(a(c)!==g*v)return va.primitiveFail(),null;for(b=c.words,t=q,u=r,t=Math.max(t,0),u=Math.max(u,0),t=Math.min(t,v-1),u=Math.min(u,g-1),n=Math.max(t-m,0),d=Math.min(t+m,v-1),o=Math.max(u-m,0),f=Math.min(u+m,g-1),h=b[u*v+t],i=-1,x=o;f>=x;x++)for(l=x*v,w=n;d>=w;w++)(s=b[l+w])>h&&(i=w,j=x,h=s);return k=-1===i?aa(p):e(i-t,j-u)+90|0,va.failed()?null:(va.pop(8),void va.pushFloat(k))}function x(){var b,c,d,e,f,g,h,i,j,k,l,m,n;if(k=va.stackObjectValue(0),b=va.stackObjectValue(1),j=va.stackObjectValue(2),va.failed())return null;if(va.success(va.isWords(b)),va.success(va.isWords(j)),va.success(va.isWords(k)),va.failed())return null;if(i=a(b),va.success(i===a(j)),va.success(i===a(k)),va.failed())return null;if(g=va.isMemberOf(b,"WordArray"),h=va.isMemberOf(j,"WordArray"),g&&h){if(!va.isMemberOf(k,"WordArray"))return va.primitiveFail(),null}else if(!va.isMemberOf(k,"KedamaFloatArray"))return va.primitiveFail(),null;if(h)if(g)for(m=j.words,l=b.words,n=k.words,f=0;i-1>=f;f++)n[f]=m[f]+l[f];else for(m=j.words,c=b.wordsAsFloat32Array(),e=k.wordsAsFloat32Array(),f=0;i-1>=f;f++)e[f]=m[f]+c[f];else if(g)for(d=j.wordsAsFloat32Array(),l=b.words,e=k.wordsAsFloat32Array(),f=0;i-1>=f;f++)e[f]=d[f]+l[f];else for(d=j.wordsAsFloat32Array(),c=b.wordsAsFloat32Array(),e=k.wordsAsFloat32Array(),f=0;i-1>=f;f++)e[f]=d[f]+c[f];va.pop(4),va.push(k)}function y(){var b,c,d,e,f,g,h,i,j,k,l,m,n;if(l=va.stackObjectValue(0),b=va.stackValue(1),k=va.stackObjectValue(2),va.failed())return null;if(va.success(va.isWords(k)),va.success(va.isWords(l)),va.failed())return null;if(j=a(k),va.success(j===a(l)),va.failed())return null;if(h="number"==typeof b,i=va.isMemberOf(k,"WordArray"),h&&i){if(!va.isMemberOf(l,"WordArray"))return va.primitiveFail(),null}else if(!va.isMemberOf(l,"KedamaFloatArray"))return va.primitiveFail(),null;if(i)if(h)for(m=k.words,g=b,n=l.words,f=0;j-1>=f;f++)n[f]=m[f]+g;else for(m=k.words,c=va.floatValueOf(b),e=l.wordsAsFloat32Array(),f=0;j-1>=f;f++)e[f]=m[f]+c;else if(h)for(d=k.wordsAsFloat32Array(),g=b,e=l.wordsAsFloat32Array(),f=0;j-1>=f;f++)e[f]=d[f]+g;else for(d=k.wordsAsFloat32Array(),c=va.floatValueOf(b),e=l.wordsAsFloat32Array(),f=0;j-1>=f;f++)e[f]=d[f]+c;va.pop(4),va.push(l)}function z(){var b,c,d,e,f,g,h,i;if(g=va.stackObjectValue(0),i=va.stackValue(1),va.failed())return null;if(va.success(va.isBytes(i)),va.success(va.isBytes(g)),va.failed())return null;if(d=a(i),e=a(g),va.failed())return null;for(c=d,d>e&&(c=e),f=g.bytes,h=i.bytes,b=0;c-1>=b;b++)h[b]=h[b]+f[b]===2;va.pop(1)}function A(){var b,c,d,e,f,g,h,i,j,k,l,m,n;if(k=va.stackObjectValue(0),b=va.stackObjectValue(1),j=va.stackObjectValue(2),va.failed())return null;if(va.success(va.isWords(b)),va.success(va.isWords(j)),va.success(va.isWords(k)),va.failed())return null;if(i=a(b),va.success(i===a(j)),va.success(i===a(k)),va.failed())return null;if(g=va.isMemberOf(b,"WordArray"),h=va.isMemberOf(j,"WordArray"),g&&h){if(!va.isMemberOf(k,"WordArray"))return va.primitiveFail(),null}else if(!va.isMemberOf(k,"KedamaFloatArray"))return va.primitiveFail(),null;if(h)if(g)for(m=j.words,l=b.words,n=k.words,f=0;i-1>=f;f++)n[f]=m[f]/l[f];else for(m=j.words,c=b.wordsAsFloat32Array(),e=k.wordsAsFloat32Array(),f=0;i-1>=f;f++)e[f]=m[f]/c[f];else if(g)for(d=j.wordsAsFloat32Array(),l=b.words,e=k.wordsAsFloat32Array(),f=0;i-1>=f;f++)e[f]=d[f]/l[f];else for(d=j.wordsAsFloat32Array(),c=b.wordsAsFloat32Array(),e=k.wordsAsFloat32Array(),f=0;i-1>=f;f++)e[f]=d[f]/c[f];va.pop(4),va.push(k)}function B(){var c,d,e,f,g,h,i,j,k,l,m,n,o;if(m=va.stackObjectValue(0),c=va.stackValue(1),l=va.stackObjectValue(2),va.failed())return null;if(va.success(va.isWords(l)),va.success(va.isWords(m)),va.failed())return null;if(k=a(l),va.success(k===a(m)),va.failed())return null;if(i="number"==typeof c,j=va.isMemberOf(l,"WordArray"),i&&j){if(!va.isMemberOf(m,"WordArray"))return va.primitiveFail(),null}else if(!va.isMemberOf(m,"KedamaFloatArray"))return va.primitiveFail(),null;if(j)if(i)for(n=l.words,h=c,o=m.words,g=0;k-1>=g;g++)o[g]=b(n[g],h);else for(n=l.words,d=va.floatValueOf(c),f=m.wordsAsFloat32Array(),g=0;k-1>=g;g++)f[g]=n[g]/d;else if(i)for(e=l.wordsAsFloat32Array(),h=c,f=m.wordsAsFloat32Array(),g=0;k-1>=g;g++)f[g]=e[g]/h;else for(e=l.wordsAsFloat32Array(),d=va.floatValueOf(c),f=m.wordsAsFloat32Array(),g=0;k-1>=g;g++)f[g]=e[g]/d;va.pop(4),va.push(m)}function C(){var b,c,d,e,f,g,h,i,j,k,l;if(j=va.stackObjectValue(0),b=va.stackObjectValue(1),i=va.stackObjectValue(2),va.failed())return null;if(va.success(va.isWords(b)),va.success(va.isWords(i)),va.success(va.isBytes(j)),va.failed())return null;if(h=a(b),va.success(h===a(i)),va.success(h===a(j)),va.failed())return null;if(g=va.isMemberOf(b,"WordArray"),va.isMemberOf(i,"WordArray"))if(g)for(l=i.words,k=b.words,c=j.bytes,f=0;h-1>=f;f++)c[f]=l[f]===k[f];else for(l=i.words,d=b.wordsAsFloat32Array(),c=j.bytes,f=0;h-1>=f;f++)c[f]=l[f]===d[f];else if(g)for(e=i.wordsAsFloat32Array(),k=b.words,c=j.bytes,f=0;h-1>=f;f++)c[f]=e[f]===k[f];else for(e=i.wordsAsFloat32Array(),d=b.wordsAsFloat32Array(),c=j.bytes,f=0;h-1>=f;f++)c[f]=e[f]===d[f];va.pop(4),va.push(j)}function D(){var b,c,d,e,f,g,h,i,j,k,l;if(k=va.stackObjectValue(0),b=va.stackValue(1),j=va.stackObjectValue(2),va.failed())return null;if(va.success(va.isWords(j)),va.success(va.isBytes(k)),va.failed())return null;if(i=a(j),va.success(i===a(k)),va.failed())return null;if(h="number"==typeof b,va.isMemberOf(j,"WordArray"))if(h)for(l=j.words,g=b,c=k.bytes,f=0;i-1>=f;f++)c[f]=l[f]===g;else for(l=j.words,d=va.floatValueOf(b),c=k.bytes,f=0;i-1>=f;f++)c[f]=l[f]===d;else if(h)for(e=j.wordsAsFloat32Array(),g=b,c=k.bytes,f=0;i-1>=f;f++)c[f]=e[f]===g;else for(e=j.wordsAsFloat32Array(),d=va.floatValueOf(b),c=k.bytes,f=0;i-1>=f;f++)c[f]=e[f]===d;va.pop(4),va.push(k)}function E(){var b,c,d,e,f,g,h,i,j,k,l;if(j=va.stackObjectValue(0),b=va.stackObjectValue(1),i=va.stackObjectValue(2),va.failed())return null;if(va.success(va.isWords(b)),va.success(va.isWords(i)),va.success(va.isBytes(j)),va.failed())return null;if(h=a(b),va.success(h===a(i)),va.success(h===a(j)),va.failed())return null;if(g=va.isMemberOf(b,"WordArray"),va.isMemberOf(i,"WordArray"))if(g)for(l=i.words,k=b.words,c=j.bytes,f=0;h-1>=f;f++)c[f]=l[f]>=k[f];else for(l=i.words,d=b.wordsAsFloat32Array(),c=j.bytes,f=0;h-1>=f;f++)c[f]=l[f]>=d[f];else if(g)for(e=i.wordsAsFloat32Array(),k=b.words,c=j.bytes,f=0;h-1>=f;f++)c[f]=e[f]>=k[f];else for(e=i.wordsAsFloat32Array(),d=b.wordsAsFloat32Array(),c=j.bytes,f=0;h-1>=f;f++)c[f]=e[f]>=d[f];va.pop(4),va.push(j)}function F(){var b,c,d,e,f,g,h,i,j,k,l;if(k=va.stackObjectValue(0),b=va.stackValue(1),j=va.stackObjectValue(2),va.failed())return null;if(va.success(va.isWords(j)),va.success(va.isBytes(k)),va.failed())return null;if(i=a(j),va.success(i===a(k)),va.failed())return null;if(h="number"==typeof b,va.isMemberOf(j,"WordArray"))if(h)for(l=j.words,g=b,c=k.bytes,f=0;i-1>=f;f++)c[f]=l[f]>=g;else for(l=j.words,d=va.floatValueOf(b),c=k.bytes,f=0;i-1>=f;f++)c[f]=l[f]>=d;else if(h)for(e=j.wordsAsFloat32Array(),g=b,c=k.bytes,f=0;i-1>=f;f++)c[f]=e[f]>=g;else for(e=j.wordsAsFloat32Array(),d=va.floatValueOf(b),c=k.bytes,f=0;i-1>=f;f++)c[f]=e[f]>=d;va.pop(4),va.push(k)}function G(){var b,c,d,e,f,g,h,i,j,k,l;if(j=va.stackObjectValue(0),b=va.stackObjectValue(1),i=va.stackObjectValue(2),va.failed())return null;if(va.success(va.isWords(b)),va.success(va.isWords(i)),va.success(va.isBytes(j)),va.failed())return null;if(h=a(b),va.success(h===a(i)),va.success(h===a(j)),va.failed())return null;if(g=va.isMemberOf(b,"WordArray"),va.isMemberOf(i,"WordArray"))if(g)for(l=i.words,k=b.words,c=j.bytes,f=0;h-1>=f;f++)c[f]=l[f]>k[f];else for(l=i.words,d=b.wordsAsFloat32Array(),c=j.bytes,f=0;h-1>=f;f++)c[f]=l[f]>d[f];else if(g)for(e=i.wordsAsFloat32Array(),k=b.words,c=j.bytes,f=0;h-1>=f;f++)c[f]=e[f]>k[f];else for(e=i.wordsAsFloat32Array(),d=b.wordsAsFloat32Array(),c=j.bytes,f=0;h-1>=f;f++)c[f]=e[f]>d[f];va.pop(4),va.push(j)}function H(){var b,c,d,e,f,g,h,i,j,k,l;if(k=va.stackObjectValue(0),b=va.stackValue(1),j=va.stackObjectValue(2),va.failed())return null;if(va.success(va.isWords(j)),va.success(va.isBytes(k)),va.failed())return null;if(i=a(j),va.success(i===a(k)),va.failed())return null;if(h="number"==typeof b,va.isMemberOf(j,"WordArray"))if(h)for(l=j.words,g=b,c=k.bytes,f=0;i-1>=f;f++)c[f]=l[f]>g;else for(l=j.words,d=va.floatValueOf(b),c=k.bytes,f=0;i-1>=f;f++)c[f]=l[f]>d;else if(h)for(e=j.wordsAsFloat32Array(),g=b,c=k.bytes,f=0;i-1>=f;f++)c[f]=e[f]>g;else for(e=j.wordsAsFloat32Array(),d=va.floatValueOf(b),c=k.bytes,f=0;i-1>=f;f++)c[f]=e[f]>d;va.pop(4),va.push(k)}function I(){var b,c,d,e,f,g,h,i,j,k,l;if(j=va.stackObjectValue(0),b=va.stackObjectValue(1),i=va.stackObjectValue(2),va.failed())return null;if(va.success(va.isWords(b)),va.success(va.isWords(i)),va.success(va.isBytes(j)),va.failed())return null;if(h=a(b),va.success(h===a(i)),va.success(h===a(j)),va.failed())return null;if(g=va.isMemberOf(b,"WordArray"),va.isMemberOf(i,"WordArray"))if(g)for(l=i.words,k=b.words,c=j.bytes,f=0;h-1>=f;f++)c[f]=l[f]<=k[f];else for(l=i.words,d=b.wordsAsFloat32Array(),c=j.bytes,f=0;h-1>=f;f++)c[f]=l[f]<=d[f];else if(g)for(e=i.wordsAsFloat32Array(),k=b.words,c=j.bytes,f=0;h-1>=f;f++)c[f]=e[f]<=k[f];else for(e=i.wordsAsFloat32Array(),d=b.wordsAsFloat32Array(),c=j.bytes,f=0;h-1>=f;f++)c[f]=e[f]<=d[f];va.pop(4),va.push(j)}function J(){var b,c,d,e,f,g,h,i,j,k,l;if(k=va.stackObjectValue(0),b=va.stackValue(1),j=va.stackObjectValue(2),va.failed())return null;if(va.success(va.isWords(j)),va.success(va.isBytes(k)),va.failed())return null;if(i=a(j),va.success(i===a(k)),va.failed())return null;if(h="number"==typeof b,va.isMemberOf(j,"WordArray"))if(h)for(l=j.words,g=b,c=k.bytes,f=0;i-1>=f;f++)c[f]=l[f]<=g;else for(l=j.words,d=va.floatValueOf(b),c=k.bytes,f=0;i-1>=f;f++)c[f]=l[f]<=d;else if(h)for(e=j.wordsAsFloat32Array(),g=b,c=k.bytes,f=0;i-1>=f;f++)c[f]=e[f]<=g;else for(e=j.wordsAsFloat32Array(),d=va.floatValueOf(b),c=k.bytes,f=0;i-1>=f;f++)c[f]=e[f]<=d;va.pop(4),va.push(k)}function K(){var b,c,d,e,f,g,h,i,j,k,l;if(j=va.stackObjectValue(0),b=va.stackObjectValue(1),i=va.stackObjectValue(2),va.failed())return null;if(va.success(va.isWords(b)),va.success(va.isWords(i)),va.success(va.isBytes(j)),va.failed())return null;if(h=a(b),va.success(h===a(i)),va.success(h===a(j)),va.failed())return null;if(g=va.isMemberOf(b,"WordArray"),va.isMemberOf(i,"WordArray"))if(g)for(l=i.words,k=b.words,c=j.bytes,f=0;h-1>=f;f++)c[f]=l[f]<k[f];else for(l=i.words,d=b.wordsAsFloat32Array(),c=j.bytes,f=0;h-1>=f;f++)c[f]=l[f]<d[f];else if(g)for(e=i.wordsAsFloat32Array(),k=b.words,c=j.bytes,f=0;h-1>=f;f++)c[f]=e[f]<k[f];else for(e=i.wordsAsFloat32Array(),d=b.wordsAsFloat32Array(),c=j.bytes,f=0;h-1>=f;f++)c[f]=e[f]<d[f];va.pop(4),va.push(j)}function L(){var b,c,d,e,f,g,h,i,j,k,l;if(k=va.stackObjectValue(0),b=va.stackValue(1),j=va.stackObjectValue(2),va.failed())return null;if(va.success(va.isWords(j)),va.success(va.isBytes(k)),va.failed())return null;if(i=a(j),va.success(i===a(k)),va.failed())return null;if(h="number"==typeof b,va.isMemberOf(j,"WordArray"))if(h)for(l=j.words,g=b,c=k.bytes,f=0;i-1>=f;f++)c[f]=l[f]<g;else for(l=j.words,d=va.floatValueOf(b),c=k.bytes,f=0;i-1>=f;f++)c[f]=l[f]<d;else if(h)for(e=j.wordsAsFloat32Array(),g=b,c=k.bytes,f=0;i-1>=f;f++)c[f]=e[f]<g;else for(e=j.wordsAsFloat32Array(),d=va.floatValueOf(b),c=k.bytes,f=0;i-1>=f;f++)c[f]=e[f]<d;va.pop(4),va.push(k)}function M(){var b,c,d,e,f,g,h,i,j,k,l,m,n;if(k=va.stackObjectValue(0),b=va.stackObjectValue(1),j=va.stackObjectValue(2),va.failed())return null;if(va.success(va.isWords(b)),va.success(va.isWords(j)),va.success(va.isWords(k)),va.failed())return null;if(i=a(b),va.success(i===a(j)),va.success(i===a(k)),va.failed())return null;if(g=va.isMemberOf(b,"WordArray"),h=va.isMemberOf(j,"WordArray"),g&&h){if(!va.isMemberOf(k,"WordArray"))return va.primitiveFail(),null}else if(!va.isMemberOf(k,"KedamaFloatArray"))return va.primitiveFail(),null;if(h)if(g)for(m=j.words,l=b.words,n=k.words,f=0;i-1>=f;f++)n[f]=m[f]*l[f];else for(m=j.words,c=b.wordsAsFloat32Array(),e=k.wordsAsFloat32Array(),f=0;i-1>=f;f++)e[f]=m[f]*c[f];else if(g)for(d=j.wordsAsFloat32Array(),l=b.words,e=k.wordsAsFloat32Array(),f=0;i-1>=f;f++)e[f]=d[f]*l[f];else for(d=j.wordsAsFloat32Array(),c=b.wordsAsFloat32Array(),e=k.wordsAsFloat32Array(),f=0;i-1>=f;f++)e[f]=d[f]*c[f];va.pop(4),va.push(k)}function N(){var b,c,d,e,f,g,h,i,j,k,l,m,n;if(l=va.stackObjectValue(0),b=va.stackValue(1),k=va.stackObjectValue(2),va.failed())return null;if(va.success(va.isWords(k)),va.success(va.isWords(l)),va.failed())return null;if(j=a(k),va.success(j===a(l)),va.failed())return null;if(h="number"==typeof b,i=va.isMemberOf(k,"WordArray"),h&&i){if(!va.isMemberOf(l,"WordArray"))return va.primitiveFail(),null}else if(!va.isMemberOf(l,"KedamaFloatArray"))return va.primitiveFail(),null;if(i)if(h)for(m=k.words,g=b,n=l.words,f=0;j-1>=f;f++)n[f]=m[f]*g;else for(m=k.words,c=va.floatValueOf(b),e=l.wordsAsFloat32Array(),f=0;j-1>=f;f++)e[f]=m[f]*c;else if(h)for(d=k.wordsAsFloat32Array(),g=b,e=l.wordsAsFloat32Array(),f=0;j-1>=f;f++)e[f]=d[f]*g;else for(d=k.wordsAsFloat32Array(),c=va.floatValueOf(b),e=l.wordsAsFloat32Array(),f=0;j-1>=f;f++)e[f]=d[f]*c;va.pop(4),va.push(l)}function O(){var b,c,d,e,f,g,h,i,j,k,l;if(j=va.stackObjectValue(0),b=va.stackObjectValue(1),i=va.stackObjectValue(2),va.failed())return null;if(va.success(va.isWords(b)),va.success(va.isWords(i)),va.success(va.isBytes(j)),va.failed())return null;if(h=a(b),va.success(h===a(i)),va.success(h===a(j)),va.failed())return null;if(g=va.isMemberOf(b,"WordArray"),va.isMemberOf(i,"WordArray"))if(g)for(l=i.words,k=b.words,c=j.bytes,f=0;h-1>=f;f++)c[f]=l[f]!==k[f];else for(l=i.words,d=b.wordsAsFloat32Array(),c=j.bytes,f=0;h-1>=f;f++)c[f]=l[f]!==d[f];else if(g)for(e=i.wordsAsFloat32Array(),k=b.words,c=j.bytes,f=0;h-1>=f;f++)c[f]=e[f]!==k[f];else for(e=i.wordsAsFloat32Array(),d=b.wordsAsFloat32Array(),c=j.bytes,f=0;h-1>=f;f++)c[f]=e[f]!==d[f];va.pop(4),va.push(j)}function P(){var b,c,d,e,f,g,h,i,j,k,l;if(k=va.stackObjectValue(0),b=va.stackValue(1),j=va.stackObjectValue(2),va.failed())return null;if(va.success(va.isWords(j)),va.success(va.isBytes(k)),va.failed())return null;if(i=a(j),va.success(i===a(k)),va.failed())return null;if(h="number"==typeof b,va.isMemberOf(j,"WordArray"))if(h)for(l=j.words,g=b,c=k.bytes,f=0;i-1>=f;f++)c[f]=l[f]!==g;else for(l=j.words,d=va.floatValueOf(b),c=k.bytes,f=0;i-1>=f;f++)c[f]=l[f]!==d;else if(h)for(e=j.wordsAsFloat32Array(),g=b,c=k.bytes,f=0;i-1>=f;f++)c[f]=e[f]!==g;else for(e=j.wordsAsFloat32Array(),d=va.floatValueOf(b),c=k.bytes,f=0;i-1>=f;f++)c[f]=e[f]!==d;va.pop(4),va.push(k)}function Q(){var b,c,d,e;if(e=va.stackValue(0),va.failed())return null;if(va.success(va.isBytes(e)),va.failed())return null;if(c=a(e),va.failed())return null;for(d=e.bytes,b=0;c-1>=b;b++)d[b]=0===d[b]?1:0}function R(){var b,c,d,e,f,g,h,i;if(g=va.stackObjectValue(0),i=va.stackValue(1),va.failed())return null;if(va.success(va.isBytes(i)),va.success(va.isBytes(g)),va.failed())return null;if(d=a(i),e=a(g),va.failed())return null;for(c=d,d>e&&(c=e),f=g.bytes,h=i.bytes,b=0;c-1>=b;b++)h[b]=h[b]+f[b]>0;va.pop(1)}function S(){var b,c,d,e,f,g,h,i;if(g=va.stackValue(0),e=va.stackObjectValue(1),va.failed())return null;if(f=va.isIntegerValue(g)?g:va.booleanValueOf(g),i=va.fetchPointerofObject(1,e),d=va.fetchPointerofObject(0,e),va.failed())return null;if(!va.isBytes(d))return va.primitiveFail(),null;if(!va.isBytes(i))return va.primitiveFail(),null;for(h=i.bytes,c=d.bytes,b=0;b<=a(i)-1;b++)1===c[b]&&(h[b]=f);va.pop(1)}function T(){var b,c,d,e,f,g,h;if(f=va.stackIntegerValue(0),e=va.stackObjectValue(1),va.failed())return null;if(f|=4278190080,h=va.fetchPointerofObject(1,e),d=va.fetchPointerofObject(0,e),va.failed())return null;if(!va.isBytes(d))return va.primitiveFail(),null;if(!va.isWords(h))return va.primitiveFail(),null;for(g=h.words,c=d.bytes,b=0;b<=a(h)-1;b++)1===c[b]&&(g[b]=f);va.pop(1)}function U(){var b,c,d,e,f,g,h;if(f=va.stackFloatValue(0),e=va.stackObjectValue(1),va.failed())return null;if(h=va.fetchPointerofObject(1,e),d=va.fetchPointerofObject(0,e),va.failed())return null;if(!va.isBytes(d))return va.primitiveFail(),null;if(!va.isWords(h))return va.primitiveFail(),null;for(g=h.wordsAsFloat32Array(),c=d.bytes,b=0;b<=a(h)-1;b++)1===c[b]&&(g[b]=f);va.pop(1)}function V(){var b,c,d,e,f,g,h;if(f=va.stackValue(0),e=va.stackObjectValue(1),va.failed())return null;if(h=va.fetchPointerofObject(1,e),d=va.fetchPointerofObject(0,e),va.failed())return null;if(!va.isBytes(d))return va.primitiveFail(),null;if(!va.isPointers(h))return va.primitiveFail(),null;for(g=h.wordsAsInt32Array(),c=d.bytes,b=0;b<=a(h)-1;b++)1===c[b]&&(g[b]=f);va.pop(1)}function W(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o;if(h=va.stackIntegerValue(0),g=va.stackObjectValue(1),l=va.stackIntegerValue(2),k=va.stackIntegerValue(3),f=va.stackObjectValue(4),va.failed())return null;if(n=va.fetchPointerofObject(1,f),d=va.fetchPointerofObject(0,f),va.failed())return null;if(!va.isBytes(d))return va.primitiveFail(),null;if(!va.isBytes(n)||!va.isBytes(g))return va.primitiveFail(),null;if(m=n.bytes,c=d.bytes,i=g.bytes,o=a(n),e=a(d),j=a(g),k>l)return va.primitiveFail(),null;if(1>k)return va.primitiveFail(),null;if(k>o)return va.primitiveFail(),null;if(k>e)return va.primitiveFail(),null;if(l>o)return va.primitiveFail(),null;if(l>e)return va.primitiveFail(),null;if(1>h)return va.primitiveFail(),null;if(h>j)return va.primitiveFail(),null;if(l-k+1>j-h+1)return va.primitiveFail(),null;for(b=k-1;l-1>=b;b++)1===c[b]&&(m[b]=i[h+b-k]);va.pop(4)}function X(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;if(l=va.stackIntegerValue(0),k=va.stackObjectValue(1),p=va.stackIntegerValue(2),o=va.stackIntegerValue(3),j=va.stackObjectValue(4),va.failed())return null;if(s=va.fetchPointerofObject(1,j),g=va.fetchPointerofObject(0,j),va.failed())return null;if(!va.isBytes(g))return va.primitiveFail(),null;if(!(va.isWords(s)&&va.isWords(k)||va.isPointers(s)&&va.isPointers(k)))return va.primitiveFail(),null;if(f=g.bytes,t=a(s),h=a(g),n=a(k),o>p)return va.primitiveFail(),null;if(1>o)return va.primitiveFail(),null;if(o>t)return va.primitiveFail(),null;if(o>h)return va.primitiveFail(),null;if(p>t)return va.primitiveFail(),null;if(p>h)return va.primitiveFail(),null;if(1>l)return va.primitiveFail(),null;if(l>n)return va.primitiveFail(),null;if(p-o+1>n-l+1)return va.primitiveFail(),null;if(q=va.isMemberOf(s,"KedamaFloatArray"),i=va.isMemberOf(k,"KedamaFloatArray"),q&&i)for(c=s.wordsAsFloat32Array(),b=k.wordsAsFloat32Array(),e=o-1;p-1>=e;e++)1===f[e]&&(c[e]=b[l+e-o]);if(q&&!i)for(c=s.wordsAsFloat32Array(),m=k.words,e=o-1;p-1>=e;e++)1===f[e]&&(c[e]=m[l+e-o]);if(!q&&i)for(r=s.words,b=k.wordsAsFloat32Array(),e=o-1;p-1>=e;e++)1===f[e]&&(d=b[l+e-o]>>>0,r[e]=d);if(!q&&!i)for(r=s.words,m=k.words,e=o-1;p-1>=e;e++)1===f[e]&&(r[e]=m[l+e-o]);va.pop(4)}function Y(){var b,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;if(o=va.stackObjectValue(0),b=va.stackObjectValue(1),n=va.stackObjectValue(2),va.failed())return null;if(va.success(va.isWords(b)),va.success(va.isWords(n)),va.success(va.isWords(o)),va.failed())return null;if(m=a(b),va.success(m===a(n)),va.success(m===a(o)),va.failed())return null;if(k=va.isMemberOf(b,"WordArray"),l=va.isMemberOf(n,"WordArray"),k&&l){if(!va.isMemberOf(o,"WordArray"))return va.primitiveFail(),null}else if(!va.isMemberOf(o,"KedamaFloatArray"))return va.primitiveFail(),null;if(l)if(k)for(t=n.words,s=b.words,u=o.words,j=0;m-1>=j;j++)q=t[j],p=s[j],r=c(q,p),u[j]=r;else for(t=n.words,g=b.wordsAsFloat32Array(),i=o.wordsAsFloat32Array(),j=0;m-1>=j;j++)q=t[j],d=g[j],f=q/d,f=Math.floor(f),i[j]=q-f*d;else if(k)for(h=n.wordsAsFloat32Array(),s=b.words,i=o.wordsAsFloat32Array(),j=0;m-1>=j;j++)e=h[j],p=s[j],f=e/p,f=Math.floor(f),i[j]=e-f*p;else for(h=n.wordsAsFloat32Array(),g=b.wordsAsFloat32Array(),i=o.wordsAsFloat32Array(),j=0;m-1>=j;j++)e=h[j],d=g[j],f=e/d,f=Math.floor(f),i[j]=e-f*d;va.pop(4),va.push(o)}function Z(){var b,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;if(o=va.stackObjectValue(0),b=va.stackValue(1),n=va.stackObjectValue(2),va.failed())return null;if(va.success(va.isWords(n)),va.success(va.isWords(o)),va.failed())return null;if(m=a(n),va.success(m===a(o)),va.failed())return null;if(k="number"==typeof b,l=va.isMemberOf(n,"WordArray"),k&&l){if(!va.isMemberOf(o,"WordArray"))return va.primitiveFail(),null}else if(!va.isMemberOf(o,"KedamaFloatArray"))return va.primitiveFail(),null;if(l)if(k)for(q=n.words,j=b,r=o.words,i=0;m-1>=i;i++)r[i]=c(q[i],j);else for(q=n.words,d=va.floatValueOf(b),h=o.wordsAsFloat32Array(),i=0;m-1>=i;i++)p=q[i],f=p/d,f=Math.floor(f),h[i]=p-f*d;else if(k)for(g=n.wordsAsFloat32Array(),j=b,h=o.wordsAsFloat32Array(),i=0;m-1>=i;i++)e=g[i],f=e/j,f=Math.floor(f),h[i]=e-f*j;else for(g=n.wordsAsFloat32Array(),d=va.floatValueOf(b),h=o.wordsAsFloat32Array(),i=0;m-1>=i;i++)e=g[i],f=e/d,f=Math.floor(f),h[i]=e-f*d;va.pop(4),va.push(o)}function $(){var b,c,d,e,f,g,h,i,j,k,l,m,n;if(k=va.stackObjectValue(0),b=va.stackObjectValue(1),j=va.stackObjectValue(2),va.failed())return null;if(va.success(va.isWords(b)),va.success(va.isWords(j)),va.success(va.isWords(k)),va.failed())return null;if(i=a(b),va.success(i===a(j)),va.success(i===a(k)),va.failed())return null;if(g=va.isMemberOf(b,"WordArray"),h=va.isMemberOf(j,"WordArray"),g&&h){if(!va.isMemberOf(k,"WordArray"))return va.primitiveFail(),null}else if(!va.isMemberOf(k,"KedamaFloatArray"))return va.primitiveFail(),null;if(h)if(g)for(m=j.words,l=b.words,n=k.words,f=0;i-1>=f;f++)n[f]=m[f]-l[f];else for(m=j.words,c=b.wordsAsFloat32Array(),e=k.wordsAsFloat32Array(),f=0;i-1>=f;f++)e[f]=m[f]-c[f];else if(g)for(d=j.wordsAsFloat32Array(),l=b.words,e=k.wordsAsFloat32Array(),f=0;i-1>=f;f++)e[f]=d[f]-l[f];else for(d=j.wordsAsFloat32Array(),c=b.wordsAsFloat32Array(),e=k.wordsAsFloat32Array(),f=0;i-1>=f;f++)e[f]=d[f]-c[f];va.pop(4),va.push(k)}function _(){var b,c,d,e,f,g,h,i,j,k,l,m,n;if(l=va.stackObjectValue(0),b=va.stackValue(1),k=va.stackObjectValue(2),va.failed())return null;if(va.success(va.isWords(k)),va.success(va.isWords(l)),va.failed())return null;if(j=a(k),va.success(j===a(l)),va.failed())return null;if(h="number"==typeof b,i=va.isMemberOf(k,"WordArray"),h&&i){if(!va.isMemberOf(l,"WordArray"))return va.primitiveFail(),null}else if(!va.isMemberOf(l,"KedamaFloatArray"))return va.primitiveFail(),null;if(i)if(h)for(m=k.words,g=b,n=l.words,f=0;j-1>=f;f++)n[f]=m[f]-g;else for(m=k.words,c=va.floatValueOf(b),e=l.wordsAsFloat32Array(),f=0;j-1>=f;f++)e[f]=m[f]-c;else if(h)for(d=k.wordsAsFloat32Array(),g=b,e=l.wordsAsFloat32Array(),f=0;j-1>=f;f++)e[f]=d[f]-g;else for(d=k.wordsAsFloat32Array(),c=va.floatValueOf(b),e=l.wordsAsFloat32Array(),f=0;j-1>=f;f++)e[f]=d[f]-c;va.pop(4),va.push(l)}function aa(a){var b,c;return c=a/.0174532925199433,b=90-c,b>0||(b+=360),b}function ba(){var b,c,d,e,f,g,h;if(b=va.stackFloatValue(0),d=va.stackValue(1),h=va.stackIntegerValue(2),e=va.stackIntegerValue(3),g=va.stackIntegerValue(4),va.failed())return null;if(!va.isWords(d))return va.primitiveFail(),null;if(!(a(d)>=h&&e>=1&&h>=e))return va.primitiveFail(),null;if(c=d.wordsAsFloat32Array(),va.failed())return null;for(f=e;h>=f;f++)c[f-1]=l(g)*b;va.pop(5)}function ca(){var b,c,d,e,f,g,h;if(b=va.stackFloatValue(0),f=va.stackValue(1),h=va.stackIntegerValue(2),c=va.stackIntegerValue(3),g=va.stackIntegerValue(4),va.failed())return null;if(!va.isWords(f))return va.primitiveFail(),null;if(!(a(f)>=h&&c>=1&&h>=c))return va.primitiveFail(),null;if(e=f.words,va.failed())return null;for(d=c;h>=d;d++)e[d-1]=l(g)*b|0;va.pop(5)}function da(){var a,b;return a=va.stackIntegerValue(0),va.failed()?null:(b=l(a),va.failed()?null:(va.pop(2),void va.pushInteger(b)))}function ea(){var a,b,c,d,f,g,h;return b=va.stackFloatValue(0),a=va.stackFloatValue(1),f=va.stackFloatValue(2),d=va.stackFloatValue(3),va.failed()?null:(g=d-a,h=f-b,c=e(g,h),c+=90,c>360&&(c-=360),va.failed()?null:(va.pop(5),void va.pushFloat(c)))}function fa(){var a,b,c,d,e,f,g;return b=va.stackFloatValue(0),a=va.stackFloatValue(1),e=va.stackFloatValue(2),d=va.stackFloatValue(3),va.failed()?null:(f=a-d,g=b-e,c=Math.sqrt(f*f+g*g),va.failed()?null:(va.pop(5),void va.pushFloat(c)))}function ga(a,b,c,d,e,f,g){var h,i;i=d,0>i&&(1===f&&(i+=e),2===f&&(i=0),3===f&&(i=0-i,h=c[a],c[a]=3.141592653589793>h?3.141592653589793-h:9.42477796076938-h)),i>=e&&(1===g&&(i-=e),2===g&&(i=e-1e-6),3===g&&(i=e-1e-6-(i-e),h=c[a],c[a]=3.141592653589793>h?3.141592653589793-h:9.42477796076938-h)),b[a]=i}function ha(a,b,c,d,e,f,g){var h;h=d,0>h&&(1===f&&(h+=e),2===f&&(h=0),3===f&&(h=0-h,c[a]=6.283185307179586-c[a])),h>=e&&(1===g&&(h-=e),2===g&&(h=e-1e-6),3===g&&(h=e-1e-6-(h-e),c[a]=6.283185307179586-c[a])),b[a]=h}function ia(){var b,c,d,e,g,h,i,j,k,l;if(k=va.stackValue(0),d=va.stackValue(1),i=va.stackValue(2),va.failed())return null;if(!va.isBytes(i))return va.primitiveFail(),null;if(!va.isWords(d))return va.primitiveFail(),null;if(l=a(d),k.isFloat)g=!1;else{if(!va.isWords(k))return va.primitiveFail(),null;if(a(k)!==l)return va.primitiveFail(),null;g=!0}for(h=i.bytes,c=d.wordsAsFloat32Array(),g?j=k.wordsAsFloat32Array():(b=va.floatValueOf(k),b=f(b)),e=0;l-1>=e;e++)1===h[e]&&(g&&(b=j[e],b=f(b)),c[e]=b);return va.failed()?null:void va.pop(3)}function ja(a){return va=a,!1!==(va.majorVersion()==ta)&&va.minorVersion()>=ua}function ka(){var b,c,d,e;return b=va.stackFloatValue(0),d=va.stackValue(1),e=va.stackIntegerValue(2),va.failed()?null:va.isWords(d)?a(d)<e?(va.primitiveFail(),null):(c=d.wordsAsFloat32Array(),c[e-1]=f(b),va.failed()?null:void va.pop(3)):(va.primitiveFail(),null)}function la(){return!0}function ma(){var b,c,d,e,f,g,h,i,j,k;return f=va.stackIntegerValue(0),e=va.stackIntegerValue(1),b=va.stackFloatValue(2),h=va.stackFloatValue(3),d=va.stackValue(4),j=va.stackIntegerValue(5),k=va.stackValue(6),va.failed()?null:va.isWords(k)&&va.isWords(d)?(g=a(k),a(d)!==g?(va.primitiveFail(),null):(i=k.wordsAsFloat32Array(),c=d.wordsAsFloat32Array(),ga(j-1,i,c,h,b,e,f),va.failed()?null:void va.pop(7))):(va.primitiveFail(),null)}function na(){var b,c,d,e,f,g,h,i,j,k;return b=va.stackIntegerValue(0),g=va.stackIntegerValue(1),c=va.stackFloatValue(2),h=va.stackFloatValue(3),e=va.stackValue(4),j=va.stackIntegerValue(5),k=va.stackValue(6),va.failed()?null:va.isWords(k)&&va.isWords(e)?(f=a(k),a(e)!==f?(va.primitiveFail(),null):(i=k.wordsAsFloat32Array(),d=e.wordsAsFloat32Array(),ha(j-1,i,d,h,c,g,b),va.failed()?null:void va.pop(7))):(va.primitiveFail(),null)}function oa(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;if(l=va.stackIntegerValue(0),h=va.stackIntegerValue(1),b=va.stackFloatValue(2),p=va.stackValue(3),d=va.stackValue(4),s=va.stackValue(5),k=va.stackValue(6),va.failed())return null;if(!va.isBytes(k))return va.primitiveFail(),null;if(!va.isWords(s))return va.primitiveFail(),null;if(!va.isWords(d))return va.primitiveFail(),null;if(p.isFloat)f=!1;else{if(!va.isWords(p))return va.primitiveFail(),null;f=!0,g=va.isMemberOf(p,"WordArray")}if(m=a(s),a(k)!==m)return va.primitiveFail(),null;if(a(d)!==m)return va.primitiveFail(),null;if(f&&a(p)!==m)return va.primitiveFail(),null;for(j=k.bytes,r=s.wordsAsFloat32Array(),c=d.wordsAsFloat32Array(),f?g?q=p.words:o=p.wordsAsFloat32Array():n=va.floatValueOf(p),e=0;m-1>=e;e++)1===j[e]&&(i=f?g?q[e]:o[e]:n,ga(e,r,c,i,b,h,l));return va.failed()?null:void va.pop(7)}function pa(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;if(b=va.stackIntegerValue(0),m=va.stackIntegerValue(1),c=va.stackFloatValue(2),p=va.stackValue(3),e=va.stackValue(4),s=va.stackValue(5),k=va.stackValue(6),va.failed())return null;if(!va.isBytes(k))return va.primitiveFail(),null;if(!va.isWords(s))return va.primitiveFail(),null;if(!va.isWords(e))return va.primitiveFail(),null;if(p.isFloat)g=!1;else{if(!va.isWords(p))return va.primitiveFail(),null;g=!0,h=va.isMemberOf(p,"WordArray")}if(l=a(s),a(k)!==l)return va.primitiveFail(),null;if(a(e)!==l)return va.primitiveFail(),null;if(g&&a(p)!==l)return va.primitiveFail(),null;for(j=k.bytes,r=s.wordsAsFloat32Array(),d=e.wordsAsFloat32Array(),g?h?q=p.words:o=p.wordsAsFloat32Array():n=va.floatValueOf(p),f=0;l-1>=f;f++)1===j[f]&&(i=g?h?q[f]:o[f]:n,ha(f,r,d,i,c,m,b));return va.failed()?null:void va.pop(7)}function qa(){var b,c,d,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;if(m=va.stackValue(0),t=va.stackValue(1),q=va.stackValue(2),h=va.stackValue(3),f=va.stackValue(4),va.failed())return null;if(!va.isWords(m))return va.primitiveFail(),null;if(!va.isWords(q))return va.primitiveFail(),null;if(!va.isWords(t))return va.primitiveFail(),null;if(0>(n=a(m)))return va.primitiveFail(),null;if(a(q)!==n)return va.primitiveFail(),null;if(a(t)!==n)return va.primitiveFail(),null;if(f.isFloat){if(!h.isFloat)return va.primitiveFail(),null;c=!1}else{if(h.isFloat)return va.primitiveFail(),null;c=!0}if(c){if(a(f)!==n)return va.primitiveFail(),null;if(a(h)!==n)return va.primitiveFail(),null}for(l=m.wordsAsFloat32Array(),p=q.wordsAsFloat32Array(),s=t.wordsAsFloat32Array(),c&&(d=f.wordsAsFloat32Array(),g=h.wordsAsFloat32Array()),c||(i=va.floatValueOf(f),j=va.floatValueOf(h)),b=0;n-1>=b;b++)c&&(i=d[b],j=g[b]),o=i-p[b],r=j-s[b],k=e(o,r),k+=90,k>360&&(k-=360),l[b]=k;return va.failed()?null:(va.pop(6),void va.push(m))}function ra(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;if(k=va.stackValue(0),r=va.stackValue(1),o=va.stackValue(2),g=va.stackValue(3),e=va.stackValue(4),va.failed())return null;if(!va.isWords(k))return va.primitiveFail(),null;if(!va.isWords(o))return va.primitiveFail(),null;if(!va.isWords(r))return va.primitiveFail(),null;if(0>(l=a(k)))return va.primitiveFail(),null;if(a(o)!==l)return va.primitiveFail(),null;if(a(r)!==l)return va.primitiveFail(),null;if(e.isFloat){if(!g.isFloat)return va.primitiveFail(),null;c=!1}else{if(g.isFloat)return va.primitiveFail(),null;c=!0}if(c){if(a(e)!==l)return va.primitiveFail(),null;if(a(g)!==l)return va.primitiveFail(),null}for(j=k.wordsAsFloat32Array(),n=o.wordsAsFloat32Array(),q=r.wordsAsFloat32Array(),c&&(d=e.wordsAsFloat32Array(),f=g.wordsAsFloat32Array()),c||(h=va.floatValueOf(e),i=va.floatValueOf(g)),b=0;l-1>=b;b++)c&&(h=d[b],i=f[b]),m=h-n[b],p=i-q[b],j[b]=Math.sqrt(m*m+p*p);return va.failed()?null:(va.pop(6),void va.push(k))}function sa(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;if(s=va.stackIntegerValue(0),q=va.stackIntegerValue(1),h=va.stackIntegerValue(2),j=va.stackIntegerValue(3),d=va.stackValue(4),k=va.stackValue(5),va.failed())return null;if(n=a(k),f=a(d),j*h!==n)return va.primitiveFail(),null;if(n*q*s!==f)return va.primitiveFail(),null;for(i=k.words,c=d.words,l=0,m=0,e=0,p=0;h-1>=p;p++){for(r=0;s-1>=r;r++){for(o=0;j-1>=o;o++)for(b=i[l],++l,g=0;q-1>=g;g++)c[e]=b,++e;l=m}m+=j,l=m}va.pop(6)}var ta=1,ua=11,va=null,wa=0,xa="KedamaPlugin2 13 November 2014 (e)",ya=0,za=0,Aa=0,Ba=0;Squeak.registerExternalModule("KedamaPlugin2",{primitiveAddArrays:x,getModuleName:i,primitiveMulArrays:M,drawTurtlesInArray:g,primitiveGTScalar:H,setScalarHeading:ka,primitiveSubScalar:_,turtleScalarSetY:na,vectorGetAngleTo:qa,primitiveRemArrays:Y,primitiveLTArrays:K,primitiveAddScalar:y,primPixelsAtXY:s,primitiveMulScalar:N,primSetPixelsAtXY:u,setHeadingArrayFrom:ia,primPixelAtXYPut:r,makeMaskLog:o,primitiveLTScalar:L,scalarGetAngleTo:ea,primitiveOrByteArray:R,primitiveLEArrays:I,primitiveRemScalar:Z,getHeadingArrayInto:h,turtlesSetX:oa,primitivePredicateReplaceBytes:W,primitiveDivArrays:A,makeMask:n,primitiveLEScalar:J,kedamaSetRandomSeed:m,randomIntoIntegerArray:ca,setInterpreter:ja,primitivePredicateAtAllPutColor:T,makeTurtlesMap:p,randomIntoFloatArray:ba,primUpHill:w,shutdownModule:la,primitiveDivScalar:B,primitiveGEArrays:E,primitiveNotByteArray:Q,randomRange:da,initialiseModule:k,getScalarHeading:j,primPixelAtXY:q,primitivePredicateAtAllPutNumber:U,primitiveEQArrays:C,primitiveNEArrays:O,primScalarForward:t,vectorGetDistanceTo:ra,turtlesSetY:pa,turtleScalarSetX:ma,primTurtlesForward:v,primitiveGEScalar:F,primitiveAndByteArray:z,primitivePredicateReplaceWords:X,primitiveGTArrays:G,primitivePredicateAtAllPutObject:V,primitiveEQScalar:D,primitivePredicateAtAllPutBoolean:S,zoomBitmap:sa,primitiveNEScalar:P,scalarGetDistanceTo:fa,primitiveSubArrays:$})}),module("users.bert.SqueakJS.plugins.Klatt").requires("users.bert.SqueakJS.vm").toRun(function(){function a(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}function b(a,b){return 0|Math.floor(a/b)}function c(a,c){return a-b(a,c)*c|0}function d(){0!==c(Bb,2)&&(Kb*=1-tb[ua])>0&&(Kb=0)}function e(){var a,b,c,d,e;e=Eb/Gb,a=Math.sin(2*La*12.7*e),b=Math.sin(2*La*7.1*e),c=Math.sin(2*La*4.7*e),d=2*tb[Da]*tb[wa]/100*(a+b+c),Cb+=d}function f(){0===c(Bb,2)?Cb+=tb[ua]*tb[wa]*(1-tb[gb]):Cb-=tb[ua]*tb[wa]*(1-tb[gb])}function g(){Cb+=(r()-32767)*tb[Ka]/32768*tb[wa]}function h(){(Kb+=(r()-32767)*tb[lb]/32768*Kb)>0&&(Kb=0)}function i(a,b,c){var d,e,f,g,h;e=(0-La)/Gb*c,h=Math.exp(e),g=0-h*h,e=2*La/Gb*b,f=h*Math.cos(e)*2,d=1-f-g,d=1/d,f=(0-f)*d,g=(0-g)*d,C(a,d),E(a,f),G(a,g)}function j(a,b){var c,d;return c=B(a)*b+D(a)*(d=H(a))+F(a)*J(a),K(a,d),I(a,b),c}function k(a){var b;return sb>0?(b=j(fb,a),b=A(db,b),b=j(kb,b),b=A(ib,b),sb>=8&&(b=A(ab,b)),sb>=7&&(b=A(_a,b)),sb>=6&&(b=A(Za,b)),sb>=5&&(b=A(Xa,b)),sb>=4&&(b=A(Ua,b)),sb>=3&&(b=A(Ra,b)),sb>=2&&(b=A(Oa,b)),sb>=1&&(b=A(Ma,b)),b):0}function l(a){return vb.success(vb.isWords(a)),vb.failed()?0:a.wordsAsFloat32Array()}function m(a){return vb.success(vb.isWords(a)),vb.failed()?0:a.wordsAsInt16Array()}function n(){return wb}function o(){var a;return 0===Ib?0:(zb>Ab?(a=ob*Kb+pb*Lb,Lb=Kb,Kb=a):(a=qb*Kb-rb,Kb=a),Ab>=Ib&&(Ab=0,v()),++Ab,a)}function p(a){return 32.767*Math.pow(2,(a-87)/6)}function q(b){var c;return vb.success(22===a(b)),!vb.failed()&&(c=vb.fetchPointerofObject(0,b),Db=l(c),Cb=vb.fetchFloatofObject(2,b),Ib=vb.fetchIntegerofObject(3,b),Ab=vb.fetchIntegerofObject(4,b),zb=vb.fetchIntegerofObject(5,b),yb=vb.fetchIntegerofObject(6,b),ob=vb.fetchFloatofObject(7,b),pb=vb.fetchFloatofObject(8,b),Kb=vb.fetchFloatofObject(9,b),Lb=vb.fetchFloatofObject(10,b),qb=vb.fetchFloatofObject(11,b),rb=vb.fetchFloatofObject(12,b),ub=vb.fetchFloatofObject(13,b),Jb=vb.fetchFloatofObject(14,b),xb=vb.fetchFloatofObject(15,b),Bb=vb.fetchIntegerofObject(16,b),Eb=vb.fetchIntegerofObject(17,b),Hb=vb.fetchIntegerofObject(18,b),sb=vb.fetchIntegerofObject(19,b),Fb=vb.fetchIntegerofObject(20,b),Gb=vb.fetchIntegerofObject(21,b),!1===vb.failed())}function r(){return Hb=1309*Hb+13849&65535}function s(){var a,b,c,d;for(b=0,c=Kb,d=Lb,a=1;zb>=a;a++)b=ob*c+pb*d,d=c,c=b;0!==b&&(Kb=Kb/b*1e4)}function t(a){return A(Pa,a)-A(Sa,a)+A(Va,a)-A(Ya,a)+A($a,a)}function u(a){return A(Na,a)+A(Qa,a)+A(Ta,a)+A(Wa,a)+A(eb,a)+A(jb,a)}function v(){tb[wa]>0?(Q(),Bb=c(Bb+1,65535)):(Ib=1,yb=Ib)}function w(){var b,c,d,e,f;return b=l(vb.stackValue(2)),c=m(d=vb.stackValue(1)),f=vb.stackIntegerValue(0),vb.failed()?null:(e=vb.stackObjectValue(3),q(e)?(vb.success(2*a(d)>=Fb),vb.failed()?null:(P(b,c,f),M(e)?void vb.pop(3):null)):null)}function x(a,b,c,d,e){return Math.exp(a*b)*((e*(a*a+1)+a)*d-c)+1}function y(a,b,c){var d,e,f,g,h;e=(0-La)/Gb*c,h=Math.exp(e),g=0-h*h,e=2*La/Gb*b,f=h*Math.cos(e)*2,d=1-f-g,C(a,d),E(a,f),G(a,g)}function z(a,b,c,d){y(a,b,c),C(a,B(a)*d)}function A(a,b){var c,d;return c=B(a)*b+D(a)*(d=H(a))+F(a)*J(a),K(a,d),I(a,c),c}function B(a){return Db[5*a-5]}function C(a,b){Db[5*a-5]=b}function D(a){return Db[5*a-4]}function E(a,b){Db[5*a-4]=b}function F(a){return Db[5*a-3]}function G(a,b){Db[5*a-3]=b}function H(a){return Db[5*a-2]}function I(a,b){Db[5*a-2]=b}function J(a){return Db[5*a-1]}function K(a,b){Db[5*a-1]=b}function L(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;p=Ib*a|0,m=p/Ib,l=c,j=b,0>=j?e=1:(i=(1-m)/j,e=1-i/(Math.exp(i)-1)),h=La*(l+1),d=Math.cos(h),o=Math.sin(h),n=j/m*h*e,r=R(h,d,o,n),q=h/p,k=Math.exp(r*q),ob=2*Math.cos(q)*k,pb=0-k*k,Lb=0,Kb=k*Math.sin(q),f=Math.exp(-1/(j*Ib)),g=Math.pow(f,Ib-p),qb=f,rb=(1-f)*g/(1-g),s()}function M(a){var b,c,d,e,f,g,h,i,j,k,l;return vb.pushRemappableOop(a),vb.pushRemappableOop(vb.floatObjectOf(Cb)),vb.pushRemappableOop(vb.floatObjectOf(ob)),vb.pushRemappableOop(vb.floatObjectOf(pb)),vb.pushRemappableOop(vb.floatObjectOf(Kb)),vb.pushRemappableOop(vb.floatObjectOf(Lb)),vb.pushRemappableOop(vb.floatObjectOf(qb)),vb.pushRemappableOop(vb.floatObjectOf(rb)),vb.pushRemappableOop(vb.floatObjectOf(ub)),vb.pushRemappableOop(vb.floatObjectOf(Jb)),h=vb.floatObjectOf(xb),j=vb.popRemappableOop(),f=vb.popRemappableOop(),e=vb.popRemappableOop(),d=vb.popRemappableOop(),l=vb.popRemappableOop(),k=vb.popRemappableOop(),c=vb.popRemappableOop(),b=vb.popRemappableOop(),i=vb.popRemappableOop(),g=vb.popRemappableOop(),!vb.failed()&&(vb.storePointerofObjectwithValue(2,g,i),vb.storeIntegerofObjectwithValue(3,g,Ib),vb.storeIntegerofObjectwithValue(4,g,Ab),vb.storeIntegerofObjectwithValue(5,g,zb),vb.storeIntegerofObjectwithValue(6,g,yb),vb.storePointerofObjectwithValue(7,g,b),vb.storePointerofObjectwithValue(8,g,c),vb.storePointerofObjectwithValue(9,g,k),vb.storePointerofObjectwithValue(10,g,l),vb.storePointerofObjectwithValue(11,g,d),vb.storePointerofObjectwithValue(12,g,e),vb.storePointerofObjectwithValue(13,g,f),vb.storePointerofObjectwithValue(14,g,j),vb.storePointerofObjectwithValue(15,g,h),vb.storeIntegerofObjectwithValue(16,g,Bb),vb.storeIntegerofObjectwithValue(17,g,Eb),vb.storeIntegerofObjectwithValue(18,g,Hb),!1===vb.failed())}function N(a){var b,c,d,e,f,g,h,j,k,l,m;tb=a,l=.6*p(tb[ba]),m=.6*p(tb[da]),b=.4*p(tb[U]),d=.15*p(tb[W]),f=.06*p(tb[Y]),h=.04*p(tb[$]),c=.15*p(tb[V]),e=.06*p(tb[X]),g=.04*p(tb[Z]),j=.022*p(tb[_]),k=.03*p(tb[aa]),sb>=8&&(Gb>=16e3?y(ab,7500,600):sb=6),sb>=7&&(Gb>=16e3?y(_a,6500,500):sb=6),sb>=6&&y(Za,tb[Ca],tb[na]),sb>=5&&y(Xa,tb[Ba],tb[la]),y(Ua,tb[Aa],tb[ja]),y(Ra,tb[za],tb[ha]),y(Oa,tb[ya],tb[fa]),y(Ma,tb[xa],tb[ea]),y(db,tb[Ea],tb[pa]),y(ib,tb[Ha],tb[ra]),i(fb,tb[Fa],tb[qa]),i(kb,tb[Ia],tb[sa]),z(eb,tb[Ea],tb[pa],l),z(jb,tb[Ha],tb[ra],m),z(Na,tb[xa],tb[ea],b),z(Qa,tb[ya],tb[fa],d),z(Ta,tb[za],tb[ha],f),z(Wa,tb[Aa],tb[ja],h),z(Pa,tb[ya],tb[ga],c),z(Sa,tb[za],tb[ia],e),z(Va,tb[Aa],tb[ka],g),z(Ya,tb[Ba],tb[ma],j),z($a,tb[Ca],tb[oa],k)}function O(a){return vb=a,!1!==(vb.majorVersion()==S)&&vb.minorVersion()>=T}function P(a,b,c){var d,e,f,g,h,i,j,l,m,n,q,s,v,w,x,y,B,C,D;for(N(a),Cb>0?(D=p(tb[nb]-7),v=p(tb[nb]),B=.1*p(tb[mb])):D=v=B=0,h=.25*p(tb[Ga]),e=.05*p(tb[ca]),g=.05*p(tb[ta]),j=tb[Ja]-3,0>=j&&(j=57),d=p(j),z(hb,0,Gb,d),n=xb,m=c,y=Fb+c-1;y>=m;)n=(r()-32768)/4,n+=.75*xb,xb=n,Ab>yb&&(n*=.5),i=h*n,C=o(),Jb=C,zb>Ab&&(C+=B*(r()-32768)/4),l=D*C,s=v*C,f=e*n,l+=f,s+=f,q=k(l),w=s,q+=u(w),w=i+s-ub,ub=s,q=t(w)-q,q=g*w-q,q=A(hb,q),x=q*d|0,-32768>x&&(x=-32768),x>32767&&(x=32767),b[m-1]=x,++m,++Eb}function Q(){Cb=tb[wa],e(),g(),f(),0>Cb&&(Cb=0),Ib=Gb/Cb|0,yb=Ib,tb[nb]>0&&(yb>>=1),zb=Ib*tb[gb]|0,L(tb[gb],tb[bb],tb[cb]),h(),d()}function R(a,b,c,d){var e,f,g,h,i,j,k;if((h=x(0,a,b,c,d))>0)for(i=0,j=1,e=h,f=x(j,a,b,c,d);f>0;)i=j,e=f,j*=2,f=x(j,a,b,c,d);else for(i=-1,j=0,e=x(i,a,b,c,d),f=h;0>e;)j=i,f=e,i*=2,e=x(i,a,b,c,d);for(;j-i>va;)k=(j+i)/2,g=x(k,a,b,c,d),g>0?(i=k,e=g):(j=k,f=g);return(j+i)/2}var S=1,T=11,U=46,V=34,W=47,X=35,Y=48,Z=36,$=49,_=37,aa=38,ba=45,ca=9,da=50,ea=13,fa=17,ga=40,ha=19,ia=41,ja=21,ka=42,la=23,ma=43,na=25,oa=44,pa=27,qa=29,ra=31,sa=33,ta=39,ua=4,va=1e-4,wa=0,xa=12,ya=16,za=18,Aa=20,Ba=22,Ca=24,Da=1,Ea=26,Fa=28,Ga=10,Ha=30,Ia=32,Ja=51,Ka=2,La=3.141592653589793,Ma=12,Na=3,Oa=13,Pa=7,Qa=4,Ra=14,Sa=8,Ta=5,Ua=15,Va=9,Wa=6,Xa=16,Ya=10,Za=17,$a=11,_a=18,ab=19,bb=7,cb=8,db=20,eb=1,fb=21,gb=6,hb=24,ib=22,jb=2,kb=23,lb=3,mb=11,nb=5,ob=0,pb=0,qb=0,rb=0,sb=0,tb=null,ub=0,vb=null,wb="Klatt 3 November 2014 (e)",xb=0,yb=0,zb=0,Ab=0,Bb=0,Cb=0,Db=null,Eb=0,Fb=0,Gb=0,Hb=0,Ib=0,Jb=0,Kb=0,Lb=0;Squeak.registerExternalModule("Klatt",{setInterpreter:O,primitiveSynthesizeFrameIntoStartingAt:w,getModuleName:n})}),module("users.bert.SqueakJS.plugins.LargeIntegers").requires("users.bert.SqueakJS.vm").toRun(function(){function a(a){return"number"==typeof a?ta.classSmallInteger():a.sqClass}function b(a){return a.bytes?a.bytes.length:a.words?4*a.words.length:0}function c(a,b){return 0|Math.floor(a/b)}function d(a,b){return a-c(a,b)*b|0}function e(a,b){return b>31?0:a<<b}function f(a,b){return b>31?0:a>>>b}function g(a,b,c){var g,h,i,j,k,l,m,n;if(1>b||1>c)return ta.primitiveFail();if(h=a,l=Math.min(c,M(h)),b>l)return!1;if(k=1+(b-1>>3),g=1+(l-1>>3),j=d(b-1,8),i=7-d(l-1,8),k===g)return m=e(255,j)&f(255,i),0!=(J(h,k)&m);if(0!==f(J(h,k),j))return!0;for(n=k+1;g-1>=n;n++)if(0!==J(h,n))return!0;return 0!=(255&e(J(h,g),i))}function h(c,d){var e,f,g;return g=ta.instantiateClassindexableSize(a(c),d),e=b(c),f=d>e?e:d,m(c.bytes,g.bytes,f),g}function i(a,b){var c,d,e;return"number"==typeof a?(d=a,c=0>d?ta.classLargeNegativeInteger():ta.classLargePositiveInteger(),e=ta.instantiateClassindexableSize(c,b),j(d,e)):e=h(a,b),e}function j(a,b){var c,d,e;for(c=b.bytes,d=1,e=p(a);e>=d;d++)c[d-1]=t(a,d)}function k(a,b,c,d,e){var f,g,h;for(h=0,g=b-1,f=0;g>=f;f++)h=(h>>>8)+a[f]+c[f],e[f]=255&h;for(g=d-1,f=b;g>=f;f++)h=(h>>>8)+c[f],e[f]=255&h;return h>>>8}function l(a,b,c){var d,e,f;for(f=c-1;f>=0;){if((e=b[f])!==(d=a[f]))return d>e?1:-1;--f}return 0}function m(a,b,c){var d,e;for(d=c-1,e=0;d>=e;e++)b[e]=a[e];return 0}function n(a,b,e,f,g,h){var i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z;for(v=b-1,w=h,y=a[v-1],l=1===v?0:a[v-2],s=1;w>=s;s++){if(t=f+1-s,e[t-1]===y)j=255;else for(x=e[t-1],x=(x<<8)+e[t-2],z=d(x,y),j=c(x,y),p=j*l,n=p>>>8,m=255&p,o=3>t?0:e[t-3];n>z||z===n&&m>o?(--j,l>m?(--n,m=m+256-l):m-=l,q=n>=y):q=!1,q;)n-=y;for(r=t-v,k=0,u=1;b>=u;u++)n=a[u-1]*(j>>>8),m=a[u-1]*(255&j),i=e[r-1]-k-(255&m),e[r-1]=255&i,i>>=8,k=n+(m>>>8)-i,++r;if(k>0)for(--j,r=t-v,k=0,u=1;b>=u;u++)k=(k>>>8)+e[r-1]+a[u-1],e[r-1]=255&k,++r;g[h-s]=j}return 0}function o(a,b){var c,d;for(d=b;0===(c=a[d-1]);)if(0==--d)return 0;return y(c)+8*(d-1)}function p(a){return 256>a&&a>-256?1:65536>a&&a>-65536?2:16777216>a&&a>-16777216?3:4}function q(a,b,c,g,h){var i,j,k,l,m,n,o;for(i=a>>3,m=d(a,8),o=i-1,l=0;o>=l;l++)g[l]=0;if(0===m)return v(g,i,h-1,b,0);for(n=8-m,j=0,o=c-1,l=0;o>=l;l++)k=b[l],g[l+i]=255&(j|e(k,m)),j=f(k,n);return 0!==j&&(g[h-1]=j),0}function r(a,b,c,d,e,f,g,h){var i,j,k,m,n,o,p,q;for(o=b-1,n=d-1,m=f-1,k=0,j=0;o>=j;j++){for(q=h[0]+a[j]*c[0],p=q*g&255,q+=p*e[0],i=1;n>=i;i++)q=(q>>>8)+h[i]+a[j]*c[i]+p*e[i],h[i-1]=255&q;for(i=d;m>=i;i++)q=(q>>>8)+h[i]+p*e[i],h[i-1]=255&q;q=(q>>>8)+k,h[m]=255&q,k=q>>>8}for(j=b;m>=j;j++){for(q=h[0],p=q*g&255,q+=p*e[0],i=1;m>=i;i++)q=(q>>>8)+h[i]+p*e[i],h[i-1]=255&q;q=(q>>>8)+k,h[m]=255&q,k=q>>>8}if(0!==k||1!==l(e,h,f))for(q=0,j=0;m>=j;j++)q=q+h[j]-e[j],h[j]=255&q,q>>=8}function s(a,b,c,d,e){var f,g,h,i,j,k,l,m;if(1===b&&0===a[0])return 0;if(1===d&&0===c[0])return 0;for(m=b-1,k=d-1,j=0;m>=j;j++)if(0!==(h=a[j])){for(l=j,i=0,g=0;k>=g;g++)f=c[g],f=f*h+i+e[l],i=f>>>8,e[l]=255&f,++l;e[l]=i}return 0}function t(a,b){return 1>b&&ta.primitiveFail(),b>4?0:0>a?255&f(0-a,8*(b-1)):255&f(a,8*(b-1))}function u(a,b,c,d,e,f){var g,h;if(h=c-1,a===sa){for(g=0;h>=g;g++)f[g]=b[g]&d[g];for(h=e-1,g=c;h>=g;g++)f[g]=0;return 0}if(a===va){for(g=0;h>=g;g++)f[g]=b[g]|d[g];for(h=e-1,g=c;h>=g;g++)f[g]=d[g];return 0}if(a===wa){for(g=0;h>=g;g++)f[g]=b[g]^d[g];for(h=e-1,g=c;h>=g;g++)f[g]=d[g];return 0}return ta.primitiveFail()}function v(a,b,c,d,e){return function(){for(var f=c-b+1,g=0;f>g;g++)a[g+b]=d[g+e];return 0}()}function w(a,b,c,g,h){var i,j,k,l,m,n,o,p;if(j=a>>3,0===(m=d(a,8)))return v(g,0,h-1,b,j);for(n=8-m,k=f(b[j],m),p=j+1,o=c-1,i=p;o>=i;i++)l=b[i],g[i-p]=255&(k|e(l,n)),k=f(l,m);return 0!==k&&(g[h-1]=k),0}function x(a,b,c,d,e){var f,g;for(g=0,f=0;b-1>=f;f++)g=g+c[f]-a[f],e[f]=255&g,g>>=8;for(f=b;d-1>=f;f++)g+=c[f],e[f]=255&g,g>>=8}function y(a){var b,c;return b=a,c=0,65536>b||(b>>>=16,c+=16),256>b||(b>>>=8,c+=8),16>b||(b>>>=4,c+=4),4>b||(b>>>=2,c+=2),2>b||(b>>>=1,++c),c+b}function z(a){var b,c,d,e,f,g;for(g=a,f=0>g?ta.classLargeNegativeInteger():ta.classLargePositiveInteger(),b=p(g),c=ta.instantiateClassindexableSize(f,b),d=c.bytes,e=1;b>=e;e++)d[e-1]=t(g,e);return c}function A(c,d){var e,f,g,h;return f=b(c),0===(h=o(c.bytes,f))?0:(e=h+d+7>>3,g=ta.instantiateClassindexableSize(a(c),e),q(d,c.bytes,f,g.bytes,e),g)}function B(b,c,d){var e,f,g,h,i;return i=o(b.bytes,d),f=i+7>>3,h=i-c,0>=h?ta.instantiateClassindexableSize(a(b),0):(g=h+7>>3,e=ta.instantiateClassindexableSize(a(b),g),w(c,b.bytes,f,e.bytes,g),e)}function C(c,d){var e,f,g,h,i,j,l,n,o,p;return n=b(c),o=b(d),i=a(c),o>=n?(h=c,f=n,p=d,l=o):(h=d,f=o,p=c,l=n),e=ta.instantiateClassindexableSize(i,l),g=k(h.bytes,f,p.bytes,l,e.bytes),g>0&&(j=ta.instantiateClassindexableSize(i,l+1),m(e.bytes,j.bytes,l),e=j,e.bytes[l]=g),e}function D(c,d,e){var f,g,h,i,j,k,l,m,n;if("number"==typeof c){if(0>c)return ta.primitiveFail();h=z(c)}else{if(a(c)===ta.classLargeNegativeInteger())return ta.primitiveFail();h=c}if("number"==typeof d){if(0>d)return ta.primitiveFail();i=z(d)}else{if(a(d)===ta.classLargeNegativeInteger())return ta.primitiveFail();i=d}return l=b(h),m=b(i),m>l?(f=l,g=h,j=m,k=i):(f=m,g=i,j=l,k=h),n=ta.instantiateClassindexableSize(ta.classLargePositiveInteger(),j),u(e,g.bytes,f,k.bytes,j,n.bytes),ta.failed()?0:Q(n)}function E(a,c){var d,e;return e=b(a),d=b(c),d!==e?d>e?-1:1:l(a.bytes,c.bytes,e)}function F(a,c,d){var e,f,g,h,j,k,l,m,o;return o=b(a),m=b(c),e=d?ta.classLargeNegativeInteger():ta.classLargePositiveInteger(),l=o-m+1,0>=l?(f=ta.instantiateClassindexableSize(ta.classArray(),2),ta.stObjectatput(f,1,0),ta.stObjectatput(f,2,a),f):(k=8-y(pa(c,m)),h=A(c,k),h=i(h,G(h)+1),g=A(a,k),G(g)===o&&(g=i(g,o+1)),j=ta.instantiateClassindexableSize(e,l),n(h.bytes,G(h),g.bytes,G(g),j.bytes,G(j)),g=B(g,k,G(h)-1),f=ta.instantiateClassindexableSize(ta.classArray(),2),ta.stObjectatput(f,1,j),ta.stObjectatput(f,2,g),f)}function G(a){return"number"==typeof a?p(a):b(a)}function H(a,c,d,e){var f,g,h,i;return h=b(a),i=b(c),g=b(d),g>=h&&g>=i&&e>=0&&255>=e?(f=ta.instantiateClassindexableSize(ta.classLargePositiveInteger(),g),r(a.bytes,h,c.bytes,i,d.bytes,g,e,f.bytes),Q(f)):ta.primitiveFail()}function I(a,c,d){var e,f,g,h,i,j,k,l;return l=b(a),k=b(c),k>=l?(h=a,g=l,e=c,i=k):(h=c,g=k,e=a,i=l),f=d?ta.classLargeNegativeInteger():ta.classLargePositiveInteger(),j=ta.instantiateClassindexableSize(f,i+g),s(h.bytes,g,e.bytes,i,j.bytes),O(j)}function J(a,c){return c>b(a)?0:pa(a,c)}function K(c,d){var e,f,g,h,i,j,k,l,m,n;if(k=a(c)===ta.classLargeNegativeInteger(),l=b(c),m=b(d),l===m){for(;l>1&&J(c,l)===J(d,l);)--l;m=l}return m>l||l===m&&J(c,l)<J(d,l)?(f=d,j=m,h=c,e=l,n=!1===k):(f=c,j=l,h=d,e=m,n=k),i=j,g=ta.instantiateClassindexableSize(n?ta.classLargeNegativeInteger():ta.classLargePositiveInteger(),i),x(h.bytes,e,f.bytes,j,g.bytes),n?P(g):Q(g)}function L(){return ua}function M(a){return o(a.bytes,b(a))}function N(b){var c,d,e,f,g;if("number"==typeof b)return!0;if(0===(d=G(b)))return!1;if(0===pa(b,d))return!1;if(e=4,d>e)return!0;if(e>d)return!1;if(a(b)===ta.classLargePositiveInteger())return g=1073741823,pa(b,e)>t(g,e);if(f=-1073741824,pa(b,e)<t(f,e))return!1;for(c=1;e>=c;c++)if(pa(b,c)!==t(f,c))return!0;return!1}function O(b){return a(b)===ta.classLargePositiveInteger()?Q(b):P(b)}function P(a){var b,c,d,e,f,g;for(c=f=G(a);0!==c&&0===pa(a,c);)--c;if(0===c)return 0;if((d=4)>=c){if(e=-1073741824,d>c||J(a,d)<t(e,d)){for(g=0,b=c;b>=1;b+=-1)g=256*g-pa(a,b);return g}for(b=1;d>=b;b++)if(J(a,b)!==t(e,b))return f>c?h(a,c):a;return e}return f>c?h(a,c):a}function Q(a){var b,c,d,e,f;for(c=f=G(a);0!==c&&0===pa(a,c);)--c;if(0===c)return 0;if((d=4)>=c&&J(a,d)<=t(1073741823,d)){for(e=0,b=c;b>=1;b+=-1)e=256*e+pa(a,b);return e}return f>c?h(a,c):a}function R(){var a,b,c,d,e;return c=ta.stackIntegerValue(1),d=ta.stackIntegerValue(0),ta.success(ta.isKindOfInteger(ta.stackValue(2))),a=ta.stackValue(2),ta.failed()?null:(b="number"==typeof a?z(a):a,e=g(b,c,d)?ta.trueObject():ta.falseObject(),ta.failed()?null:(ta.popthenPush(3,e),null))}function S(){var a,b;return ta.success(ta.isKindOfInteger(ta.stackValue(0))),a=ta.stackValue(0),ta.failed()?null:"number"==typeof a?(b=z(a),ta.failed()?null:(ta.popthenPush(2,b),null)):ta.failed()?null:(ta.popthenPush(2,a),null)}function T(){var a;return a=ta.trueObject(),ta.failed()?null:(ta.popthenPush(1,a),null)}function U(){var a,c,d,e,f;return ta.success(ta.isKindOfInteger(ta.stackValue(1))),d=ta.stackValue(1),e=ta.stackIntegerValue(0),ta.failed()?null:(c="number"==typeof d?z(d):d,e>=0?(f=A(c,e),ta.failed()?null:(ta.popthenPush(3,f),null)):(a=0-e,f=O(B(c,a,b(c))),ta.failed()?null:(ta.popthenPush(3,f),null)))}function V(){var a,b,c,d,e;return ta.success(ta.isKindOfInteger(ta.stackValue(0))),d=ta.stackValue(0),ta.success(ta.isKindOfInteger(ta.stackValue(1))),b=ta.stackValue(1),ta.failed()?null:(a="number"==typeof b?z(b):b,c="number"==typeof d?z(d):d,e=C(a,c),ta.failed()?null:(ta.popthenPush(2,e),null))}function W(){var a,b,c,d,e;return ta.success(ta.isKindOfInteger(ta.stackValue(1))),c=ta.stackValue(1),ta.success(ta.isKindOfInteger(ta.stackValue(0))),d=ta.stackValue(0),ta.failed()?null:(a="number"==typeof c?z(c):c,b="number"==typeof d?z(d):d,e=C(a,b),ta.failed()?null:(ta.popthenPush(3,e),null))}function X(){var a,b,c;return ta.success(ta.isKindOfInteger(ta.stackValue(0))),b=ta.stackValue(0),ta.success(ta.isKindOfInteger(ta.stackValue(1))),a=ta.stackValue(1),ta.failed()?null:(c=D(a,b,sa),ta.failed()?null:(ta.popthenPush(2,c),null))}function Y(){var a,b,c,d;return ta.success(ta.isKindOfInteger(ta.stackValue(2))),a=ta.stackValue(2),ta.success(ta.isKindOfInteger(ta.stackValue(1))),b=ta.stackValue(1),c=ta.stackIntegerValue(0),ta.failed()?null:(d=D(a,b,c),ta.failed()?null:(ta.popthenPush(4,d),null))}function Z(){var a,b,c;return ta.success(ta.isKindOfInteger(ta.stackValue(0))),b=ta.stackValue(0),ta.success(ta.isKindOfInteger(ta.stackValue(1))),a=ta.stackValue(1),ta.failed()?null:(c=D(a,b,va),ta.failed()?null:(ta.popthenPush(2,c),null))}function $(){var a,c,d,e,f;return e=ta.stackIntegerValue(0),ta.success(ta.isKindOfInteger(ta.stackValue(1))),d=ta.stackValue(1),ta.failed()?null:(a="number"==typeof d?z(d):d,e>=0?(f=A(a,e),ta.failed()?null:(ta.popthenPush(2,f),null)):(c=0-e,f=O(B(a,c,b(a))),ta.failed()?null:(ta.popthenPush(2,f),null)))}function _(){var a,c,d,e,f;return e=ta.stackIntegerValue(0),ta.success(ta.isKindOfInteger(ta.stackValue(1))),d=ta.stackValue(1),ta.failed()?null:(a="number"==typeof d?z(d):d,e>=0?(f=A(a,e),ta.failed()?null:(ta.popthenPush(2,f),null)):(c=0-e,f=O(B(a,c,b(a))),ta.failed()?null:(ta.popthenPush(2,f),null)))}function aa(){var a,b,c;return ta.success(ta.isKindOfInteger(ta.stackValue(0))),b=ta.stackValue(0),ta.success(ta.isKindOfInteger(ta.stackValue(1))),a=ta.stackValue(1),ta.failed()?null:(c=D(a,b,wa),ta.failed()?null:(ta.popthenPush(2,c),null))}function ba(){var a,b,c,d,e;return ta.success(ta.isKindOfInteger(ta.stackValue(0))),d=ta.stackValue(0),ta.success(ta.isKindOfInteger(ta.stackValue(1))),b=ta.stackValue(1),ta.failed()?null:"number"==typeof b?"number"==typeof d?(a=b)>(c=d)?(e=1,ta.failed()?null:(ta.popthenPush(2,e),null)):c>a?(e=-1,ta.failed()?null:(ta.popthenPush(2,e),null)):(e=0,ta.failed()?null:(ta.popthenPush(2,e),null)):(e=-1,ta.failed()?null:(ta.popthenPush(2,e),null)):"number"==typeof d?(e=1,ta.failed()?null:(ta.popthenPush(2,e),null)):(e=E(b,d),ta.failed()?null:(ta.popthenPush(2,e),null))}function ca(){var a,b,c,d,e;return ta.success(ta.isKindOfInteger(ta.stackValue(1))),c=ta.stackValue(1),ta.success(ta.isKindOfInteger(ta.stackValue(0))),d=ta.stackValue(0),ta.failed()?null:"number"==typeof c?"number"==typeof d?(a=c)>(b=d)?(e=1,ta.failed()?null:(ta.popthenPush(3,e),null)):b>a?(e=-1,ta.failed()?null:(ta.popthenPush(3,e),null)):(e=0,ta.failed()?null:(ta.popthenPush(3,e),null)):(e=-1,ta.failed()?null:(ta.popthenPush(3,e),null)):"number"==typeof d?(e=1,ta.failed()?null:(ta.popthenPush(3,e),null)):(e=E(c,d),ta.failed()?null:(ta.popthenPush(3,e),null))}function da(){var a,b,c,d,e,f;if(ta.success(ta.isKindOfInteger(ta.stackValue(1))),d=ta.stackValue(1),e=ta.booleanValueOf(ta.stackValue(0)),ta.success(ta.isKindOfInteger(ta.stackValue(2))),b=ta.stackValue(2),ta.failed())return null;if(!N(b))return ta.primitiveFail(),null;if(!N(d))return ta.primitiveFail(),null;if(a="number"==typeof b?z(b):b,"number"==typeof d){if(0===d)return ta.primitiveFail(),null;c=z(d)}else c=d;return f=F(a,c,e),ta.failed()?null:(ta.popthenPush(3,f),null)}function ea(){var a,b,c,d,e,f;if(ta.success(ta.isKindOfInteger(ta.stackValue(2))),c=ta.stackValue(2),ta.success(ta.isKindOfInteger(ta.stackValue(1))),d=ta.stackValue(1),e=ta.booleanValueOf(ta.stackValue(0)),ta.failed())return null;if(a="number"==typeof c?z(c):c,"number"==typeof d){if(0===d)return ta.primitiveFail(),null;b=z(d)}else b=d;return f=F(a,b,e),ta.failed()?null:(ta.popthenPush(4,f),null)}function fa(){var a,b,c,d,e,f;return ta.success(ta.isKindOfInteger(ta.stackValue(1))),d=ta.stackValue(1),e=ta.booleanValueOf(ta.stackValue(0)),ta.success(ta.isKindOfInteger(ta.stackValue(2))),b=ta.stackValue(2),ta.failed()?null:(a="number"==typeof b?z(b):b,c="number"==typeof d?z(d):d,f=I(a,c,e),ta.failed()?null:(ta.popthenPush(3,f),null))}function ga(){var a,b,c,d,e,f;return ta.success(ta.isKindOfInteger(ta.stackValue(2))),c=ta.stackValue(2),ta.success(ta.isKindOfInteger(ta.stackValue(1))),d=ta.stackValue(1),e=ta.booleanValueOf(ta.stackValue(0)),ta.failed()?null:(a="number"==typeof c?z(c):c,b="number"==typeof d?z(d):d,f=I(a,b,e),ta.failed()?null:(ta.popthenPush(4,f),null))}function ha(){var a,b,c,d,e;return ta.success(ta.isKindOfInteger(ta.stackValue(0))),d=ta.stackValue(0),ta.success(ta.isKindOfInteger(ta.stackValue(1))),b=ta.stackValue(1),ta.failed()?null:(a="number"==typeof b?z(b):b,c="number"==typeof d?z(d):d,e=K(a,c),ta.failed()?null:(ta.popthenPush(2,e),null))}function ia(){var a,b,c,d,e;return ta.success(ta.isKindOfInteger(ta.stackValue(1))),c=ta.stackValue(1),ta.success(ta.isKindOfInteger(ta.stackValue(0))),d=ta.stackValue(0),ta.failed()?null:(a="number"==typeof c?z(c):c,b="number"==typeof d?z(d):d,e=K(a,b),ta.failed()?null:(ta.popthenPush(3,e),null))}function ja(){var a,b,c,d;for(b=strlen(L()),d=ta.instantiateClassindexableSize(ta.classString(),b),a=d.bytes,c=0;b-1>=c;c++)a[c]=L()[c];return ta.failed()?null:(ta.popthenPush(1,d),null)}function ka(){var a,b,c,d,e,f,g,h;return ta.success(ta.isKindOfInteger(ta.stackValue(2))),e=ta.stackValue(2),ta.success(ta.isKindOfInteger(ta.stackValue(1))),f=ta.stackValue(1),g=ta.stackIntegerValue(0),ta.success(ta.isKindOfInteger(ta.stackValue(3))),c=ta.stackValue(3),ta.failed()?null:(a="number"==typeof c?z(c):c,b="number"==typeof e?z(e):e,d="number"==typeof f?z(f):f,h=H(a,b,d,g),ta.failed()?null:(ta.popthenPush(4,h),null))}function la(){var a,b;return ta.success(ta.isKindOfInteger(ta.stackValue(0))),a=ta.stackValue(0),ta.failed()?null:"number"==typeof a?ta.failed()?null:(ta.popthenPush(2,a),null):(b=O(a),ta.failed()?null:(ta.popthenPush(2,b),null))}function ma(){var a,b;return ta.success(ta.stackValue(0).sqClass===ta.classLargeNegativeInteger()),a=ta.stackValue(0),ta.failed()?null:(b=P(a),ta.failed()?null:(ta.popthenPush(1,b),null))}function na(){var a,b;return ta.success(ta.stackValue(0).sqClass===ta.classLargePositiveInteger()),a=ta.stackValue(0),ta.failed()?null:(b=Q(a),ta.failed()?null:(ta.popthenPush(1,b),null))}function oa(a){return ta=a,!1!==(ta.majorVersion()==qa)&&ta.minorVersion()>=ra}function pa(a,b){return a.bytes[b-1]}var qa=1,ra=11,sa=0,ta=null,ua="LargeIntegers v1.5 (e)",va=1,wa=2;Squeak.registerExternalModule("LargeIntegers",{primDigitAddWith:W,primDigitBitShiftMagnitude:_,primGetModuleName:ja,primDigitBitLogicWithOp:Y,primCheckIfCModuleExists:T,primDigitCompare:ba,primDigitMultiplyNegative:fa,primDigitBitShift:$,primNormalizePositive:na,primDigitSubtractWith:ia,_primDigitBitShift:U,primDigitMultiplyWithNegative:ga,primDigitSubtract:ha,primDigitDivNegative:da,primNormalizeNegative:ma,primDigitBitOr:Z,primMontgomeryTimesModulo:ka,primDigitBitAnd:X,primDigitDivWithNegative:ea,setInterpreter:oa,primNormalize:la,primDigitBitXor:aa,primDigitCompareWith:ca,primDigitAdd:V,getModuleName:L,primAsLargeInteger:S,primAnyBitFromTo:R})}),module("users.bert.SqueakJS.plugins.Matrix2x3Plugin").requires("users.bert.SqueakJS.vm").toRun(function(){function a(a){return"number"==typeof a?v.classSmallInteger():a.sqClass}function b(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}function c(){return A}function d(a){return v.failed()?null:v.isWords(a)&&6===b(a)?a.wordsAsFloat32Array():(v.primitiveFail(),null)}function e(b){var c,d;return v.failed()?null:a(b)!==v.classPoint()?v.primitiveFail():(d=v.fetchPointerofObject(0,b),c="number"==typeof d,c||d.isFloat?(w=c?d:v.floatValueOf(d),d=v.fetchPointerofObject(1,b),c="number"==typeof d,c||d.isFloat?void(x=c?d:v.floatValueOf(d)):v.primitiveFail()):v.primitiveFail())}function f(a,b,c){var d,e,f,g,h,i;d=a[0]*b[0]+a[1]*b[3],e=a[0]*b[1]+a[1]*b[4],f=a[0]*b[2]+a[1]*b[5]+a[2],g=a[3]*b[0]+a[4]*b[3],h=a[3]*b[1]+a[4]*b[4],i=a[3]*b[2]+a[4]*b[5]+a[5],c[0]=d,c[1]=e,c[2]=f,c[3]=g,c[4]=h,c[5]=i}function g(a){var b,c,d,e,f;return e=w-a[2],f=x-a[5],b=a[0]*a[4]-a[1]*a[3],0===b?v.primitiveFail():(b=1/b,c=e*a[4]-a[1]*f,d=a[0]*f-e*a[3],y=c*b,void(z=d*b))}function h(a){y=w*a[0]+x*a[1]+a[2],z=w*a[3]+x*a[4]+a[5]}function i(a){return a>=-1073741824&&1073741823>=y}function j(){var a,b,c,e;return c=d(e=v.stackObjectValue(0)),b=d(v.stackObjectValue(1)),a=d(v.stackObjectValue(2)),v.failed()?null:(f(a,b,c),void v.popthenPush(3,e))}function k(){var a;return e(v.stackObjectValue(0)),a=d(v.stackObjectValue(1)),v.failed()?null:(g(a),void(v.failed()||q(2)))}function l(){var c,f,h,i,j,k,l,m,n,o,p;return h=v.stackObjectValue(0),p=v.stackObjectValue(1),i=d(v.stackObjectValue(2)),v.failed()?null:a(p)!==a(h)?v.primitiveFail():v.isPointers(p)?2!==b(p)?v.primitiveFail():(e(v.fetchPointerofObject(0,p)),v.failed()?null:(n=w,o=x,g(i),l=j=y,m=k=z,e(v.fetchPointerofObject(1,p)),v.failed()?null:(c=w,f=x,g(i),l=Math.min(l,y),j=Math.max(j,y),m=Math.min(m,z),k=Math.max(k,z),w=c,x=o,g(i),l=Math.min(l,y),j=Math.max(j,y),m=Math.min(m,z),k=Math.max(k,z),w=n,x=f,g(i),l=Math.min(l,y),j=Math.max(j,y),m=Math.min(m,z),k=Math.max(k,z),v.failed()||(h=r(h,l,m,j,k)),void(v.failed()||v.popthenPush(3,h))))):v.primitiveFail()}function m(){var a;return a=d(v.stackObjectValue(0)),v.failed()?null:(v.pop(1),void v.pushBool(1===a[0]&&0===a[1]&&0===a[2]&&0===a[3]&&1===a[4]&&0===a[5]))}function n(){var a;return a=d(v.stackObjectValue(0)),v.failed()?null:(v.pop(1),void v.pushBool(1===a[0]&&0===a[1]&&0===a[3]&&1===a[4]))}function o(){var a;return e(v.stackObjectValue(0)),a=d(v.stackObjectValue(1)),v.failed()?null:(h(a),void q(2))}function p(){var c,f,g,i,j,k,l,m,n,o,p;return g=v.stackObjectValue(0),p=v.stackObjectValue(1),i=d(v.stackObjectValue(2)),v.failed()?null:a(p)!==a(g)?v.primitiveFail():v.isPointers(p)?2!==b(p)?v.primitiveFail():(e(v.fetchPointerofObject(0,p)),v.failed()?null:(n=w,o=x,h(i),l=j=y,m=k=z,e(v.fetchPointerofObject(1,p)),v.failed()?null:(c=w,f=x,h(i),l=Math.min(l,y),j=Math.max(j,y),m=Math.min(m,z),k=Math.max(k,z),w=c,x=o,h(i),l=Math.min(l,y),j=Math.max(j,y),m=Math.min(m,z),k=Math.max(k,z),w=n,x=f,h(i),l=Math.min(l,y),j=Math.max(j,y),m=Math.min(m,z),k=Math.max(k,z),g=r(g,l,m,j,k),void(v.failed()||v.popthenPush(3,g))))):v.primitiveFail()}function q(a){return y+=.5,z+=.5,i(y)&&i(z)?void v.popthenPush(a,v.makePointwithxValueyValue(0|y,0|z)):v.primitiveFail()}function r(a,b,c,d,e){var f,g,h,j,k,l,m;return j=b+.5,i(j)?(g=d+.5,i(g)?(k=c+.5,i(k)?(h=e+.5,i(h)?(v.pushRemappableOop(a),l=v.makePointwithxValueyValue(0|j,0|k),v.pushRemappableOop(l),f=v.makePointwithxValueyValue(0|g,0|h),l=v.popRemappableOop(),m=v.popRemappableOop(),v.storePointerofObjectwithValue(0,m,l),v.storePointerofObjectwithValue(1,m,f),m):v.primitiveFail()):v.primitiveFail()):v.primitiveFail()):v.primitiveFail()}function s(a){return v=a,!1!==(v.majorVersion()==t)&&v.minorVersion()>=u}var t=1,u=11,v=null,w=0,x=0,y=0,z=0,A="Matrix2x3Plugin 3 November 2014 (e)";Squeak.registerExternalModule("Matrix2x3Plugin",{primitiveInvertPoint:k,primitiveInvertRectInto:l,primitiveIsIdentity:m,primitiveComposeMatrix:j,setInterpreter:s,primitiveTransformRectInto:p,primitiveIsPureTranslation:n,getModuleName:c,primitiveTransformPoint:o})}),module("users.bert.SqueakJS.plugins.MiscPrimitivePlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function a(a,b){return 0|Math.floor(a/b)}function b(b,c){return b-a(b,c)*c|0}function c(a,b){return b>31?0:a>>>b}function d(a,b,d){var e;for(e=0;3>=e;e++)b[d+e-1]=255&c(a,8*(3-e));return d+4}function e(a,c,e){return 223>=a?(c[e-1]=a,e+1):7935>=a?(c[e-1]=224+(a>>8),c[e]=b(a,256),e+2):(c[e-1]=255,d(a,c,e+1))}function f(){return t}function g(){var a,b,c,d,e,f,g,h;if(s.stackValue(3),a=s.stackBytes(2),b=s.stackBytes(1),c=s.stackBytes(0),s.failed())return null;for(g=a.length,h=b.length,f=1;f<=Math.min(g,h);f++)if(d=c[a[f-1]],e=c[b[f-1]],d!==e)return e>d?s.failed()?null:(s.popthenPush(4,1),null):s.failed()?null:(s.popthenPush(4,3),null);return g===h?s.failed()?null:(s.popthenPush(4,2),null):h>g?s.failed()?null:(s.popthenPush(4,1),null):s.failed()?null:(s.popthenPush(4,3),null)}function h(){var a,b,c,f,g,h,i,j,k,l;if(s.stackValue(2),a=s.stackInt32Array(1),b=s.stackBytes(0),s.failed())return null;for(k=a.length,f=e(k,b,1),h=1;k>=h;){for(l=a[h-1],i=255&l,c=(l>>>8&255)===i&&(l>>>16&255)===i&&(l>>>24&255)===i,g=h;k>g&&l===a[g];)++g;if(g>h)c?(f=e(4*(g-h+1)+1,b,f),b[f-1]=i,++f):(f=e(4*(g-h+1)+2,b,f),f=d(l,b,f)),h=g+1;else if(c)f=e(5,b,f),b[f-1]=i,++f,++h;else{for(;k>g&&a[g-1]!==a[g];)++g;for(g===k&&++g,f=e(4*(g-h)+3,b,f),j=h;g-1>=j;j++)f=d(a[j-1],b,f);h=g}}return s.failed()?null:(s.popthenPush(3,f-1),null)}function i(){var a,b,c,d,e;if(s.stackValue(2),a=s.stackBytes(1),b=s.stackUint16Array(0),s.failed())return null;for(d=a.length,c=1;d>=c;c++)e=a[c-1],b[c-1]=e>127?e-256<<8:e<<8;return s.failed()?null:void s.pop(2)}function j(){var a,b,c,d,e,f,g,h,i,j,k,l,m;if(s.stackValue(3),a=s.stackInt32Array(2),b=s.stackBytes(1),c=s.stackIntegerValue(0),s.failed())return null;for(h=c,g=b.length,j=1,m=a.length+1;g>=h;){if(d=b[h-1],++h,!(223>=d))if(254>=d)d=256*(d-224)+b[h-1],++h;else for(d=0,i=1;4>=i;i++)d=(d<<8)+b[h-1],++h;if(l=d>>>2,j+l>m)return s.primitiveFail(),null;if(1===(e=3&d))for(f=b[h-1],++h,f|=f<<8,f|=f<<16,i=1;l>=i;i++)a[j-1]=f,++j;if(2===e){for(f=0,i=1;4>=i;i++)f=f<<8|b[h-1],++h;for(i=1;l>=i;i++)a[j-1]=f,++j}if(3===e)for(k=1;l>=k;k++){for(f=0,i=1;4>=i;i++)f=f<<8|b[h-1],++h;a[j-1]=f,++j}}return s.failed()?null:void s.pop(3)}function k(){var a,b,c,d,e;if(s.stackValue(3),a=s.stackBytes(2),b=s.stackBytes(1),c=s.stackIntegerValue(0),s.failed())return null;if(256!==b.length)return s.failed()?null:(s.popthenPush(4,0),null);for(d=c,e=a.length;e>=d&&0===b[a[d-1]];)++d;return d>e?s.failed()?null:(s.popthenPush(4,0),null):s.failed()?null:(s.popthenPush(4,d),null)}function l(){var a,b,c,d,e,f;if(s.stackValue(4),a=s.stackBytes(3),b=s.stackBytes(2),c=s.stackIntegerValue(1),d=s.stackBytes(0),s.failed())return null;if(0===a.length)return s.failed()?null:(s.popthenPush(5,0),null);for(f=c;f<=b.length-a.length+1;f++)for(e=1;d[b[f+e-1-1]]===d[a[e-1]];){if(e===a.length)return s.failed()?null:(s.popthenPush(5,f),null);++e}return s.failed()?null:(s.popthenPush(5,0),null)}function m(){var a,b,c,d,e;if(s.stackValue(3),a=s.stackIntegerValue(2),b=s.stackBytes(1),c=s.stackIntegerValue(0),s.failed())return null;for(e=b.length,d=c;e>=d;d++)if(b[d-1]===a)return s.failed()?null:(s.popthenPush(4,d),null);return s.failed()?null:(s.popthenPush(4,0),null)}function n(){var a,b,c,d,e,f;if(s.stackValue(2),a=s.stackBytes(1),b=s.stackIntegerValue(0),s.failed())return null;for(c=a.length,d=268435455&b,f=1;c>=f;f++)d+=a[f-1],e=16383&d,d=9741*e+16384*(9741*(d>>>14)+101*e&16383)&268435455;return s.failed()?null:(s.popthenPush(3,d),null)}function o(){var a,b,c,d,e;if(s.stackValue(4),a=s.stackBytes(3),b=s.stackIntegerValue(2),c=s.stackIntegerValue(1),d=s.stackBytes(0),s.failed())return null;for(e=b;c>=e;e++)a[e-1]=d[a[e-1]];return s.failed()?null:void s.pop(4)}function p(a){return s=a,!1!==(s.majorVersion()==q)&&s.minorVersion()>=r}var q=1,r=11,s=null,t="MiscPrimitivePlugin 3 November 2014 (e)";Squeak.registerExternalModule("MiscPrimitivePlugin",{primitiveConvert8BitSigned:i,primitiveCompareString:g,primitiveTranslateStringWithTable:o,primitiveStringHash:n,primitiveCompressToByteArray:h,primitiveFindSubstring:l,primitiveIndexOfAsciiInString:m,setInterpreter:p,primitiveDecompressFromByteArray:j,getModuleName:f,primitiveFindFirstInString:k})}),module("users.bert.SqueakJS.plugins.ScratchPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function a(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}function b(a,b){return 0|Math.floor(a/b)}function c(a,c){return a-b(a,c)*c|0}function d(a,d,e,f,g){var h,i,j,k,l,m,n;return i=b(e,60),h=c(e,60),k=(1e3-f)*g,l=(1e3-b(f*h,60))*g,m=(1e3-b(f*(60-h),60))*g,n=b(1e3*g,3922),k=b(k,3922),l=b(l,3922),m=b(m,3922),0===i&&(j=(n<<16)+(m<<8)+k),1===i&&(j=(l<<16)+(n<<8)+k),2===i&&(j=(k<<16)+(n<<8)+m),3===i&&(j=(k<<16)+(l<<8)+n),4===i&&(j=(m<<16)+(k<<8)+n),5===i&&(j=(n<<16)+(k<<8)+l),0===j&&(j=1),a[d]=j,0}function e(a){return B.success(B.isWordsOrBytes(a)),B.failed()?0:a.wordsAsFloat64Array()}function f(a){return B.success(B.isWords(a)),B.failed()?0:a.words}function g(){return C}function h(a,c,d,e,f){var g,h;return h=f-e,0===h?0:(g=a===f?b(60*(c-d),h):c===f?120+b(60*(d-a),h):240+b(60*(a-c),h),0>g?g+360:g)}function i(a,b,c){var d,e,f,g,h;return 0===a?b:0===b?a:(e=1024-c,g=e*(a>>>16&255)+c*(b>>>16&255)>>10,f=e*(a>>>8&255)+c*(b>>>8&255)>>10,d=e*(255&a)+c*(255&b)>>10,h=(g<<16)+(f<<8)+d,0===h&&(h=1),h)}function j(a,b,c,d,e){var f,g,h,j,k,l,m;return j=b>>>10,-1>j||j>=d?0:(l=c>>>10,-1>l||l>=e?0:(k=1023&b,-1===j&&(j=0,k=0),j===d-1&&(k=0),m=1023&c,-1===l&&(l=0,m=0),l===e-1&&(m=0),g=l*d+j,h=16777215&a[g],k>0&&(h=i(h,16777215&a[g+1],k)),0===m?h:(g=(l+1)*d+j,f=16777215&a[g],k>0&&(f=i(f,16777215&a[g+1],k)),i(h,f,m))))}function k(){var c,d,e,g,h,i,j,k,l,m,n,o,p,q,r,s,t;if(j=B.stackValue(2),m=B.stackValue(1),r=B.stackIntegerValue(0),i=f(j),l=f(m),q=a(j),B.success(a(m)===q),B.failed())return null;for(h=b(q,r),t=1;h-2>=t;t++)for(s=1;r-2>=s;s++){for(k=p=g=c=0,e=-1;1>=e;e++)for(d=-1;1>=d;d++)0!==(o=16777215&i[(t+e)*r+(s+d)])&&(p+=o>>>16&255,g+=o>>>8&255,c+=255&o,++k);n=0===k?0:(b(p,k)<<16)+(b(g,k)<<8)+b(c,k),l[t*r+s]=n}return B.pop(3),0}function l(){var c,e,g,i,j,k,l,m,n,o,p,q,r,s,t,u;if(l=B.stackValue(2),p=B.stackValue(1),t=B.stackIntegerValue(0),k=f(l),u=a(l),o=f(p),B.success(a(p)===u),B.failed())return null;for(j=0;u-1>=j;j++)0!==(q=16777215&k[j])&&(r=q>>>16&255,g=q>>>8&255,c=255&q,m=n=r,g>m&&(m=g),c>m&&(m=c),n>g&&(n=g),n>c&&(n=c),i=h(r,g,c,n,m),s=0===m?0:b(1e3*(m-n),m),e=b(1e3*m,255),e+=10*t,e>1e3&&(e=1e3),0>e&&(e=0),d(o,j,i,s,e));return B.pop(3),0}function m(){var c,d,e,f,g,h,i,j,k,l,m,n=0,o=0;if(k=B.stackValue(2),e=B.stackValue(1),f=B.stackIntegerValue(0),B.success(B.isWords(k)),B.success(B.isWords(e)),c=b(2*a(k),f),l=2*a(e),B.success(l>=c),B.failed())return null;for(j=k.wordsAsInt16Array(),d=e.wordsAsInt16Array(),g=1;c>=g;g++){for(i=0,h=1;f>=h;h++)m=j[n++],0>m&&(m=0-m),m>i&&(i=m);d[o++]=i}return B.pop(3),0}function n(){var a,b,c,d,e,g,h,i,j,k,l,m,n,o,p;if(h=B.stackValue(7),i=B.stackIntegerValue(6),g=B.stackIntegerValue(5),l=B.stackValue(4),m=B.stackIntegerValue(3),k=B.stackIntegerValue(2),b=B.stackIntegerValue(1),c=B.stackIntegerValue(0),e=f(h),j=f(l),B.success(m>b+2*i),B.success(k>c+2*g),B.failed())return null;for(p=0;g-1>=p;p++)for(a=(c+2*p)*m+b,o=0;i-1>=o;o++)n=e[o+p*i],d=a+2*o,j[d]=n,j[d+1]=n,j[d+m]=n,j[d+m+1]=n;return B.pop(8),0}function o(){var b,c,d,e,f,g,h,i=0,j=0;if(g=B.stackValue(2),c=B.stackValue(1),e=B.booleanValueOf(B.stackValue(0)),B.success(B.isWords(g)),B.success(B.isWords(c)),h=a(g),B.success(a(c)>=h>>1),B.failed())return null;for(f=g.wordsAsInt16Array(),b=c.wordsAsInt16Array(),e&&i++,d=1;h>=d;d++)b[j++]=f[i],i+=2;return B.pop(3),0}function p(){var c,d,e,g,h,i,k,l,m,n,o,p,q,r,s,t,u,v,w,x;if(l=B.stackValue(3),n=B.stackValue(2),v=B.stackIntegerValue(1),p=B.stackIntegerValue(0),k=f(l),m=f(n),u=a(l),B.success(a(n)===u),B.failed())return null;for(i=b(u,v),d=v>>1,e=i>>1,i=b(u,v),d=v>>1,e=i>>1,r=p/100,w=0;v-1>=w;w++)for(x=0;i-1>=x;x++)g=(w-d)/d,h=(x-e)/e,q=Math.pow(Math.sqrt(g*g+h*h),r),1>=q?(c=Math.atan2(h,g),s=1024*(d+q*Math.cos(c)*d)|0,t=1024*(e+q*Math.sin(c)*e)|0):(s=1024*w,t=1024*x),o=j(k,s,t,v,i),m[x*v+w]=o;return B.pop(4),0}function q(){var a,b,c,d,e,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;if(i=f(B.stackValue(11)),k=B.stackIntegerValue(10),j=B.stackIntegerValue(9),l=f(B.stackValue(8)),n=B.stackIntegerValue(7),m=B.stackIntegerValue(6),r=B.stackIntegerValue(5),s=B.stackIntegerValue(4),e=B.stackIntegerValue(3),g=B.stackIntegerValue(2),d=B.stackIntegerValue(1),b=B.stackIntegerValue(0),B.success(r>=0&&s>=0),B.success(k>=r+2*d),B.success(j>=s+2*b),B.success(e>=0&&g>=0),B.success(n>=e+d),B.success(m>=g+b),B.failed())return null;for(u=0;b-1>=u;u++)for(q=k*(s+2*u)+r,c=n*(g+u)+e,t=0;d-1>=t;t++)o=i[q],p=16711680&o,h=65280&o,a=255&o,o=i[q+1],p+=16711680&o,h+=65280&o,a+=255&o,o=i[q+k],p+=16711680&o,h+=65280&o,a+=255&o,o=i[q+k+1],p+=16711680&o,h+=65280&o,a+=255&o,l[c]=p>>>2&16711680|h>>>2&65280|a>>>2,q+=2,++c;return B.pop(12),0}function r(){var a,b,c,d,e,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;if(i=f(B.stackValue(11)),k=B.stackIntegerValue(10),j=B.stackIntegerValue(9),l=f(B.stackValue(8)),n=B.stackIntegerValue(7),m=B.stackIntegerValue(6),s=B.stackIntegerValue(5),t=B.stackIntegerValue(4),e=B.stackIntegerValue(3),g=B.stackIntegerValue(2),d=B.stackIntegerValue(1),b=B.stackIntegerValue(0),B.success(s>=0&&t>=0),B.success(k>=s+2*d),B.success(j>=t+2*b),B.success(e>=0&&g>=0),B.success(n>=e+d),B.success(m>=g+b),B.failed())return null;for(v=0;b-1>=v;v++)for(r=k*(t+2*v)+s,c=n*(g+v)+e,u=0;d-1>=u;u++)o=i[r],p=i[r+k+1],q=(16711680&o)+(16711680&p)>>>1&16711680,h=(65280&o)+(65280&p)>>>1&65280,a=(255&o)+(255&p)>>>1,l[c]=q|h|a,r+=2,++c;return B.pop(12),0}function s(){var e,g,i,j,k,l,m,n,o,p,q,r,s,t,u,v;if(m=B.stackValue(2),q=B.stackValue(1),u=B.stackIntegerValue(0),l=f(m),v=a(m),p=f(q),B.success(a(q)===v),B.failed())return null;for(k=0;v-1>=k;k++)0!==(r=16777215&l[k])&&(s=r>>>16&255,i=r>>>8&255,e=255&r,n=o=s,i>n&&(n=i),e>n&&(n=e),o>i&&(o=i),o>e&&(o=e),g=b(1e3*n,255),t=0===n?0:b(1e3*(n-o),n),110>g&&(g=110,t=1e3),90>t&&(t=90),j=110===g||90===t?0:h(s,i,e,o,n),j=c(j+u+36e7,360),d(p,k,j,t,g));return B.pop(3),0}function t(){var c,d,e,g,h,i,k;return d=B.stackValue(3),h=B.stackIntegerValue(2),i=B.stackIntegerValue(1),k=B.stackIntegerValue(0),c=f(d),g=a(d),B.failed()?null:(e=j(c,i,k,h,b(g,h)),B.pop(5),B.pushInteger(e),0)}function u(){var c,e,g,i,j,k,l,m,n,o,p,q,r,s,t,u;if(l=B.stackValue(2),p=B.stackValue(1),t=B.stackIntegerValue(0),k=f(l),u=a(l),o=f(p),B.success(a(p)===u),B.failed())return null;for(j=0;u-1>=j;j++)2>(q=16777215&k[j])||(r=q>>>16&255,g=q>>>8&255,c=255&q,m=n=r,g>m&&(m=g),c>m&&(m=c),n>g&&(n=g),n>c&&(n=c),e=b(1e3*m,255),(s=0===m?0:b(1e3*(m-n),m))>0&&(i=h(r,g,c,n,m),s+=10*t,s>1e3&&(s=1e3),0>s&&(s=0),d(o,j,i,s,e)));return B.pop(3),0}function v(){var c,d,e,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,C;if(e=B.stackValue(5),g=B.stackIntegerValue(4),d=B.stackIntegerValue(3),l=B.stackValue(2),n=B.stackIntegerValue(1),k=B.stackIntegerValue(0),B.success(a(e)===g*d),B.success(a(l)===n*k),c=f(e),j=f(l),B.failed())return null;for(h=i=0,A=b(1024*g,n),C=b(1024*d,k),p=0;k-1>=p;p++){for(h=0,o=0;n-1>=o;o++)w=(1024-(1023&h))*(1024-(1023&i)),x=(1023&h)*(1024-(1023&i)),y=(1024-(1023&h))*(1023&i),z=(1023&h)*(1023&i),u=(i>>>10)*g+(h>>>10),q=c[u],r=g-1>h>>>10?c[u+1]:q,d-1>i>>>10&&(u+=g),s=c[u],t=g-1>h>>>10?c[u+1]:s,v=0,0===q&&(q=r,v+=w),0===r&&(r=q,v+=x),0===s&&(s=t,v+=y),0===t&&(t=s,v+=z),0===q&&(q=s,r=t),0===s&&(s=q,t=r),m=0,5e5>v&&(u=w*(q>>>16&255)+x*(r>>>16&255)+y*(s>>>16&255)+z*(t>>>16&255),m=(u>>>20&255)<<16,u=w*(q>>>8&255)+x*(r>>>8&255)+y*(s>>>8&255)+z*(t>>>8&255),m|=(u>>>20&255)<<8,u=w*(255&q)+x*(255&r)+y*(255&s)+z*(255&t),0===(m|=u>>>20&255)&&(m=1)),j[p*n+o]=m,h+=A;i+=C}return B.pop(6),0}function w(){var d,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,C,D,E,F,G,H,I,J,K,L,M,N,O;if(x=B.stackValue(5),C=B.stackValue(4),M=B.stackIntegerValue(3),w=f(x),A=f(C),h=a(x),G=B.stackIntegerValue(2),d=B.stackValue(1),i=B.stackValue(0),g=e(d),j=e(i),B.success(a(C)===h),B.failed())return null;for(u=b(h,M),I=Math.random(),k=c(I,G)-1,H=0;k/2-1>=H;H++)for(I=Math.random(),N=c(I,M),I=Math.random(),O=c(I,u),I=Math.random(),E=c(I,8),s=-4;4>=s;s++)for(t=-4;4>=t;t++)25>(m=s*s+t*t)&&m>0&&(n=N+s|0,p=O+t|0,n>0&&p>0&&u>p&&M>n&&(g[p*M+n]=E*(1-m/25)));for(r=1;M-2>=r;r++)for(l=1;u-2>=l;l++)K=l*M+r,g[K]=(j[K+1]+j[K-1]+j[K+M]+j[K-M]+j[K-1-M]/2+j[K-1+M]/2+j[K+1-M]/2+j[K+1+M]/2)/4-g[K],g[K]=.9*g[K];for(F=0;M*u>=F;F++)J=j[F],j[F]=g[F],g[F]=J;for(y=0;u-1>=y;y++)for(v=0;M-1>=v;v++)v>1&&M-1>v&&y>1&&u-1>y?(L=y*M+v,o=64*(g[L]-g[L-1]+(g[L+1]-g[L])),q=(g[L]-g[L-M]+(g[L+M]-g[L]))/64,2>o&&(o=-2),o>2&&(o=2),2>q&&(q=-2),q>2&&(q=2),z=(y+q)*M+(v+o)|0,D=M*u>z&&z>=0?w[z]:w[v+y*M]):D=w[v+y*M],A[v+y*M]=D;return B.pop(6),0}function x(){var c,d,e,g,h,i,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,C,D;if(p=B.stackValue(3),r=B.stackValue(2),A=B.stackIntegerValue(1),i=B.stackIntegerValue(0),o=f(p),q=f(r),y=a(p),B.success(a(r)===y),B.failed())return null;for(n=b(y,A),d=A>>1,e=n>>1,e>d?(t=d,v=e/d,w=1):(t=e,v=1,w=d>e?d/e:1),z=-3.141592653589793*i/180,u=t*t,C=0;A-1>=C;C++)for(D=0;n-1>=D;D++)k=v*(C-d),l=w*(D-e),h=k*k+l*l,u>h&&(m=1-Math.sqrt(h)/t,c=z*m*m,x=Math.sin(c),g=Math.cos(c),s=j(o,1024*((g*k-x*l)/v+d)|0,1024*((x*k+g*l)/w+e)|0,A,n),q[A*D+C]=s);return B.pop(4),0}function y(a){return B=a,!1!==(B.majorVersion()==z)&&B.minorVersion()>=A}var z=1,A=11,B=null,C="ScratchPlugin 3 November 2014 (e)";Squeak.registerExternalModule("ScratchPlugin",{primitiveCondenseSound:m,getModuleName:g,primitiveFisheye:p,primitiveWaterRipples1:w,primitiveHalfSizeDiagonal:r,primitiveScale:v,primitiveDoubleSize:n,setInterpreter:y,primitiveWhirl:x,primitiveBlur:k,primitiveBrightnessShift:l,primitiveHalfSizeAverage:q,primitiveSaturationShift:u,primitiveHueShift:s,primitiveInterpolate:t,primitiveExtractChannel:o})}),module("users.bert.SqueakJS.plugins.SoundGenerationPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function a(a,b){return 0|Math.floor(a/b)}function b(b,c){return b-a(b,c)*c|0}function c(){return q}function d(){var a,c,d,e,f,g,h,i,j,k,l,m,n,o,q,r,s,t,u;if(a=p.stackValue(3),c=p.stackInt16Array(2),d=p.stackIntegerValue(1),e=p.stackIntegerValue(0),t=p.fetchInt32ArrayofObject(7,a),u=p.fetchInt32ArrayofObject(8,a),s=p.fetchIntegerofObject(9,a),o=p.fetchIntegerofObject(10,a),n=p.fetchIntegerofObject(11,a),q=p.fetchInt16ArrayofObject(12,a),r=p.fetchInt16ArrayofObject(13,a),p.failed())return null;for(k=d;d+e-1>=k;k++){for(f=g=0,m=1;s>=m;m++)h=n-t[m-1],1>h&&(h+=o),l=u[m-1],f+=l*q[h-1],g+=l*r[h-1];i=2*k-1,j=c[i-1]+(f>>15),j>32767&&(j=32767),-32767>j&&(j=-32767),c[i-1]=j,q[n-1]=j,++i,j=c[i-1]+(g>>15),j>32767&&(j=32767),-32767>j&&(j=-32767),c[i-1]=j,r[n-1]=j,n=b(n,o)+1}return p.failed()?null:(p.storeIntegerofObjectwithValue(11,a,n),void p.pop(3))}function e(){var a,c,d,e,f,g,h,i,j,k,l,m,n,o,q,r,s,t,u,v,w,x,y,z;if(a=p.stackValue(5),c=p.stackIntegerValue(4),d=p.stackInt16Array(3),e=p.stackIntegerValue(2),f=p.stackIntegerValue(1),g=p.stackIntegerValue(0),v=p.fetchIntegerofObject(3,a),w=p.fetchIntegerofObject(4,a),x=p.fetchIntegerofObject(5,a),o=p.fetchIntegerofObject(7,a),z=p.fetchInt16ArrayofObject(8,a),y=p.fetchIntegerofObject(9,a),r=p.fetchIntegerofObject(10,a),s=p.fetchIntegerofObject(11,a),q=p.fetchIntegerofObject(14,a),t=p.fetchIntegerofObject(15,a),u=p.fetchIntegerofObject(16,a),p.failed())return null;for(h=0!==q&&0!==u,j=e+c-1,n=e;j>=n;n++)m=v*z[r>>15]>>15,h?(k=q*z[t>>15],t=b(t+u,y),0>t&&(t+=y),0>(r=b(r+s+k,y))&&(r+=y)):r=b(r+s,y),f>0&&(i=2*n-1,l=d[i-1]+(m*f>>15),l>32767&&(l=32767),-32767>l&&(l=-32767),d[i-1]=l),g>0&&(i=2*n,l=d[i-1]+(m*g>>15),l>32767&&(l=32767),-32767>l&&(l=-32767),d[i-1]=l),0!==w&&(v+=w,(w>0&&v>=x||0>w&&x>=v)&&(v=x,w=0));return o-=c,p.failed()?null:(p.storeIntegerofObjectwithValue(3,a,v),p.storeIntegerofObjectwithValue(4,a,w),p.storeIntegerofObjectwithValue(7,a,o),p.storeIntegerofObjectwithValue(10,a,r),p.storeIntegerofObjectwithValue(15,a,t),void p.pop(5))}function f(){var a,b,c,d,e,f,g,h,i,j,k,n,o,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G;if(a=p.stackValue(5),b=p.stackIntegerValue(4),c=p.stackInt16Array(3),d=p.stackIntegerValue(2),e=p.stackIntegerValue(1),f=p.stackIntegerValue(0),E=p.fetchIntegerofObject(3,a),F=p.fetchIntegerofObject(4,a),G=p.fetchIntegerofObject(5,a),v=p.fetchIntegerofObject(7,a),z=p.fetchIntegerofObject(8,a),x=p.fetchInt16ArrayofObject(10,a),A=p.fetchInt16ArrayofObject(11,a),w=p.fetchIntegerofObject(16,a),y=p.fetchIntegerofObject(17,a),D=p.fetchIntegerofObject(18,a),B=p.fetchIntegerofObject(19,a),C=p.fetchIntegerofObject(20,a),p.failed())return null;for(j=x!==A,g=e*E>>15,h=f*E>>15,i=2*d-1,k=d+b-1,u=d;k>=u;u++){if(t=(B+=C)>>9,t>y&&v>z&&(t=(B-=D)>>9),(q=t+1)>w){if(t>w)return v=0,p.failed()?null:(p.storeIntegerofObjectwithValue(3,a,E),p.storeIntegerofObjectwithValue(4,a,F),p.storeIntegerofObjectwithValue(7,a,v),p.storeIntegerofObjectwithValue(19,a,B),p.popthenPush(6,null),null);q=0===D?t:1+(B-D>>9)}o=B&l,r=n=x[t-1]*(m-o)+x[q-1]*o>>9,j&&(r=A[t-1]*(m-o)+A[q-1]*o>>9),e>0&&(s=c[i-1]+(g*n>>15),s>32767&&(s=32767),-32767>s&&(s=-32767),c[i-1]=s),++i,f>0&&(s=c[i-1]+(h*r>>15),s>32767&&(s=32767),-32767>s&&(s=-32767),c[i-1]=s),++i,0!==F&&(E+=F,(F>0&&E>=G||0>F&&G>=E)&&(E=G,F=0),g=e*E>>15,h=f*E>>15)}return v-=b,p.failed()?null:(p.storeIntegerofObjectwithValue(3,a,E),p.storeIntegerofObjectwithValue(4,a,F),p.storeIntegerofObjectwithValue(7,a,v),p.storeIntegerofObjectwithValue(19,a,B),void p.pop(5))}function g(){var a,b,c,d,e,f,g,h,i,j,k,l,m,o,q,r,s,t,u,v,w,x;if(a=p.stackValue(5),b=p.stackIntegerValue(4),c=p.stackInt16Array(3),d=p.stackIntegerValue(2),e=p.stackIntegerValue(1),f=p.stackIntegerValue(0),v=p.fetchIntegerofObject(3,a),w=p.fetchIntegerofObject(4,a),x=p.fetchIntegerofObject(5,a),q=p.fetchIntegerofObject(7,a),r=p.fetchInt16ArrayofObject(8,a),s=p.fetchIntegerofObject(9,a),t=p.fetchIntegerofObject(10,a),u=p.fetchIntegerofObject(11,a),p.failed())return null;for(i=d+b-1,m=l=s,o=d;i>=o;o++)l=m+t,l>=u&&(l=n+(l-u)),g=r[(m>>15)-1]+r[(l>>15)-1]>>1,r[(m>>15)-1]=g,k=g*v>>15,m=l,e>0&&(h=2*o-1,j=c[h-1]+(k*e>>15),j>32767&&(j=32767),-32767>j&&(j=-32767),c[h-1]=j),f>0&&(h=2*o,j=c[h-1]+(k*f>>15),j>32767&&(j=32767),-32767>j&&(j=-32767),c[h-1]=j),0!==w&&(v+=w,(w>0&&v>=x||0>w&&x>=v)&&(v=x,w=0));return s=l,q-=b,p.failed()?null:(p.storeIntegerofObjectwithValue(3,a,v),p.storeIntegerofObjectwithValue(4,a,w),p.storeIntegerofObjectwithValue(7,a,q),p.storeIntegerofObjectwithValue(9,a,s),void p.pop(5))}function h(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,q,r,s,t,u,v,w,x;if(a=p.stackValue(5),b=p.stackIntegerValue(4),c=p.stackInt16Array(3),d=p.stackIntegerValue(2),e=p.stackIntegerValue(1),f=p.stackIntegerValue(0),v=p.fetchIntegerofObject(3,a),w=p.fetchIntegerofObject(4,a),x=p.fetchIntegerofObject(5,a),n=p.fetchIntegerofObject(7,a),r=p.fetchInt16ArrayofObject(8,a),s=p.fetchIntegerofObject(10,a),u=p.fetchIntegerofObject(11,a),q=p.fetchIntegerofObject(12,a),t=p.fetchIntegerofObject(13,a),p.failed())return null;for(h=d+b-1,i=d,m=q+(u>>>16);s>=m&&h>=i;)l=r[m-1]*v>>15,e>0&&(g=2*i-1,k=c[g-1]+(l*e>>15),k>32767&&(k=32767),-32767>k&&(k=-32767),c[g-1]=k),f>0&&(g=2*i,k=c[g-1]+(l*f>>15),k>32767&&(k=32767),-32767>k&&(k=-32767),c[g-1]=k),0!==w&&(v+=w,(w>0&&v>=x||0>w&&x>=v)&&(v=x,w=0)),u+=t,u>=o&&(j=u>>>16,q+=j,u-=j<<16),m=q+(u>>>16),++i;return n-=b,p.failed()?null:(p.storeIntegerofObjectwithValue(3,a,v),p.storeIntegerofObjectwithValue(4,a,w),p.storeIntegerofObjectwithValue(7,a,n),p.storeIntegerofObjectwithValue(11,a,u),p.storeIntegerofObjectwithValue(12,a,q),void p.pop(5))}function i(a){return p=a,!1!==(p.majorVersion()==j)&&p.minorVersion()>=k}var j=1,k=11,l=511,m=512,n=32768,o=536870912,p=null,q="SoundGenerationPlugin 3 November 2014 (e)";Squeak.registerExternalModule("SoundGenerationPlugin",{primitiveMixFMSound:e,primitiveMixSampledSound:h,setInterpreter:i,getModuleName:c,primitiveApplyReverb:d,primitiveMixPluckedSound:g,primitiveMixLoopedSampledSound:f})}),module("users.bert.SqueakJS.plugins.StarSqueakPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function a(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}function b(a,b){return 0|Math.floor(a/b)}function c(a,b){return 0>b?-31>b?0:a>>>0-b:b>31?0:a<<b}function d(a){return l.success(l.isWords(a)),l.failed()?0:a.words}function e(){return m}function f(){var c,e,f,g,h,i,j,k,m,n,o,p,q,r,s,t,u,v;if(n=l.stackValue(4),g=l.stackValue(3),r=l.stackIntegerValue(2),j=l.stackIntegerValue(1),e=l.stackIntegerValue(0),m=d(n),f=d(g),l.success(a(n)===a(g)),l.success(a(n)===r*j),l.failed())return null;for(c=(2*e+1)*(2*e+1),u=0;j-1>=u;u++)for(p=u-e,0>p&&(p=0),i=u+e,i>=j&&(i=j-1),s=0;r-1>=s;s++){for(o=s-e,0>o&&(o=0),h=s+e,h>=r&&(h=r-1),q=0,v=p;i>=v;v++)for(k=v*r,t=o;h>=t;t++)q+=m[k+t];f[u*r+s]=b(q,c)}l.pop(5)}function g(){var b,c,e,f,g;if(e=l.stackValue(1),f=l.stackIntegerValue(0),c=d(e),g=a(e),l.failed())return null;for(b=0;g-1>=b;b++)c[b]=c[b]*f>>>10;l.pop(2)}function h(){var e,f,g,h,i,j,k,m,n,o,p,q,r,s,t,u,v,w;if(t=l.stackValue(6),g=l.stackValue(5),u=l.stackIntegerValue(4),h=l.stackIntegerValue(3),k=l.stackIntegerValue(2),n=l.stackIntegerValue(1),q=l.stackIntegerValue(0),r=d(t),e=d(g),l.success(a(g)===u*h),l.success(a(g)===a(t)*k*k),l.failed())return null;for(o=0,(4&n)>0&&(o+=65536),(2&n)>0&&(o+=256),(1&n)>0&&++o,s=-1,w=0;w<=b(h,k)-1;w++)for(v=0;v<=b(u,k)-1;v++)for(i=c(r[++s],q),i>255&&(i=255),m=0>=i?1:i*o,j=(w*u+v)*k,p=j;j+(k-1)*u>=p;p+=u)for(f=p;p+k-1>=f;f++)e[f]=m;l.pop(7)}function i(a){return l=a,!1!==(l.majorVersion()==j)&&l.minorVersion()>=k}var j=1,k=11,l=null,m="StarSqueakPlugin 3 November 2014 (e)";Squeak.registerExternalModule("StarSqueakPlugin",{primitiveDiffuseFromToWidthHeightDelta:f,primitiveEvaporateRate:g,setInterpreter:i,primitiveMapFromToWidthHeightPatchSizeRgbFlagsShift:h,getModuleName:e})}),module("users.bert.SqueakJS.plugins.ZipPlugin").requires("users.bert.SqueakJS.vm").toRun(function(){function a(a){return"number"==typeof a?U.classSmallInteger():a.sqClass}function b(a){return a.pointers?a.pointers.length:a.words?a.words.length:a.bytes?a.bytes.length:0}function c(a){return a.bytes?a.bytes.length:a.words?4*a.words.length:0}function d(a,b){return 0|Math.floor(a/b)}function e(a,b){return a-d(a,b)*b|0}function f(a,b){return b>31?0:a<<b}function g(a,b){return b>31?0:a>>>b}function h(a,b,c){var d;if(ba[a+c]!==ba[b+c])return 0;if(ba[a+c-1]!==ba[b+c-1])return 0;if(ba[a]!==ba[b])return 0;if(ba[a+1]!==ba[b+1])return 1;for(d=2;O>d&&ba[a+d]===ba[b+d];)++d;return d}function i(a,b,c){var d,e,f,g,h,i,j,k,o;if(aa>a)return!1;if(qa>=sa)return!0;for(e=!1,f=aa;a>=f;){if(e||(j=n(f,P-1,f,b,c),p(f),h=65535&j,g=j>>>16),j=n(f+1,g,h,b,c),o=65535&j,k=j>>>16,g>=k&&g>=P){for(d=m(g,f-h),i=1;g-1>=i;i++)p(++f);e=!1,++f}else d=l(ba[f]),++f,a>=f&&!d&&(p(f),e=!0,h=o,g=k);if(d)return aa=f,!0}return aa=f,!1}function j(b){var c;for(c=a(b);!c.isNil&&c.classInstSize()>=13;)c=c.superclass();return!c.isNil&&(W=c.classInstSize(),!0)}function k(b){var c;for(c=a(b);!c.isNil&&c.classInstSize()>=7;)c=c.superclass();return!c.isNil&&(X=c.classInstSize(),!0)}function l(a){return ta[qa]=a,ia[qa]=0,ra[a]++,++qa===sa||0==(4095&qa)&&B()}function m(a,b){var c,d;return ta[qa]=a-P,ia[qa]=b,d=va[a-P],ra[d]++,c=257>b?ga[b-1]:ga[256+(b-1>>>7)],ha[c]++,++qa,++ua,qa===sa||0==(4095&qa)&&B()}function n(a,b,c,d,e){var f,g,i,j,k,l,m;if(m=b<<16|c,b>=O)return m;if(l=la[D(a+P-1)],!((i=a-l)>0&&L>i))return m;for(g=d,k=a>L?a-L:0,f=b;;){if(j=h(a,l,f),a+j>wa&&(j=wa-a),j===P&&a-l>L>>2&&(j=P-1),j>f){if(m=j<<16|l,(f=j)>=O)return m;if(f>e)return m}if(!(--g>0))return m;if(l=ma[l&Q],k>=l)return m}}function o(){return V}function p(a){var b;na=D(a+P-1),b=la[na],la[na]=a,ma[a&Q]=b}function q(a){var d;if(!(U.isPointers(a)&&b(a)>=15))return!1;if(d=U.fetchPointerofObject(0,a),!U.isBytes(d))return!1;if(0===X){if(!k(a))return!1;if(b(a)<X+5)return X=0,!1}return ba=d.bytes,ca=c(d),wa=U.fetchIntegerofObject(1,a),xa=U.fetchIntegerofObject(2,a),d=U.fetchPointerofObject(X+0,a),!(!U.isWords(d)||b(d)!==K)&&(la=d.words,d=U.fetchPointerofObject(X+1,a),!(!U.isWords(d)||b(d)!==R)&&(ma=d.words,na=U.fetchIntegerofObject(X+2,a),aa=U.fetchIntegerofObject(X+3,a),d=U.fetchPointerofObject(X+5,a),!!U.isBytes(d)&&(sa=b(d),ta=d.bytes,d=U.fetchPointerofObject(X+6,a),!!(U.isWords(d)&&b(d)>=sa)&&(ia=d.words,d=U.fetchPointerofObject(X+7,a),!(!U.isWords(d)||b(d)!==N)&&(ra=d.words,d=U.fetchPointerofObject(X+8,a),!(!U.isWords(d)||b(d)!==M)&&(ha=d.words,qa=U.fetchIntegerofObject(X+9,a),ua=U.fetchIntegerofObject(X+10,a),!U.failed()))))))}function r(a){var d;if(0===X){if(!k(a))return!1;if(b(a)<X+3)return X=0,!1}return!!(U.isPointers(a)&&b(a)>=X+3)&&(d=U.fetchPointerofObject(0,a),U.isBytes(d)?(ba=d.bytes,ca=c(d),wa=U.fetchIntegerofObject(1,a),xa=U.fetchIntegerofObject(2,a),$=U.fetchIntegerofObject(X+1,a),_=U.fetchIntegerofObject(X+2,a),!U.failed()):U.primitiveFail())}function s(a,b){if(!(b>=0&&f(1,a)>b))return U.primitiveFail();for($|=f(b,_),_+=a;_>=8&&ca>wa;)ba[wa]=255&$,++wa,$>>>=8,_-=8}function t(){var a,b,c,d,e;return 3!==U.methodArgumentCount()?U.primitiveFail():(b=U.stackIntegerValue(0),a=U.stackIntegerValue(1),c=U.stackIntegerValue(2),d=U.stackObjectValue(3),U.failed()?null:q(d)?(e=i(c,a,b),U.failed()||(U.storeIntegerofObjectwithValue(X+2,d,na),U.storeIntegerofObjectwithValue(X+3,d,aa),U.storeIntegerofObjectwithValue(X+9,d,qa),U.storeIntegerofObjectwithValue(X+10,d,ua)),void(U.failed()||(U.pop(4),U.pushBool(e)))):U.primitiveFail())}function u(){var a,c,d,e,f,g;if(2!==U.methodArgumentCount())return U.primitiveFail();if(a=U.stackIntegerValue(0),e=U.stackObjectValue(1),U.failed())return null;if(!U.isWords(e))return U.primitiveFail();for(g=b(e),f=e.wordsAsInt32Array(),d=0;g-1>=d;d++)c=f[d],f[d]=c>=a?c-a:0;U.pop(2)}function v(){var a,d;if(2!==U.methodArgumentCount())return U.primitiveFail();if(a=U.stackValue(0),!U.isWords(a))return U.primitiveFail();if(ea=a.words,fa=b(a),a=U.stackValue(1),!U.isWords(a))return U.primitiveFail();if(oa=a.words,pa=b(a),d=U.stackValue(2),!U.isPointers(d))return U.primitiveFail();if(0===W){if(!j(d))return U.primitiveFail();if(b(d)<W+8)return W=0,U.primitiveFail()}return b(d)<W+8?U.primitiveFail():(xa=U.fetchIntegerofObject(2,d),Ba=U.fetchIntegerofObject(W+0,d),$=U.fetchIntegerofObject(W+1,d),_=U.fetchIntegerofObject(W+2,d),Aa=U.fetchIntegerofObject(W+4,d),za=U.fetchIntegerofObject(W+5,d),U.failed()?null:(--xa,--Aa,--za,a=U.fetchPointerofObject(0,d),U.isBytes(a)?(ba=a.bytes,ca=c(a),a=U.fetchPointerofObject(W+3,d),U.isBytes(a)?(ya=a.bytes,F(),void(U.failed()||(U.storeIntegerofObjectwithValue(2,d,xa+1),U.storeIntegerofObjectwithValue(W+0,d,Ba),U.storeIntegerofObjectwithValue(W+1,d,$),U.storeIntegerofObjectwithValue(W+2,d,_),U.storeIntegerofObjectwithValue(W+4,d,Aa+1),U.pop(2)))):U.primitiveFail()):U.primitiveFail()))}function w(){var a,b,d,f,g,h,i,j,k;if(4!==U.methodArgumentCount())return U.primitiveFail();if(f=U.stackObjectValue(0),k=U.stackIntegerValue(1),j=U.stackIntegerValue(2),a=U.positive32BitValueOf(U.stackValue(3)),U.failed())return 0;if(!(U.isBytes(f)&&k>=j&&j>0))return U.primitiveFail();if(!(c(f)>=k))return U.primitiveFail();for(d=f.bytes,--j,--k,h=65535&a,i=a>>>16&65535,g=j;k>=g;g++)b=d[g],h=e(h+b,65521),i=e(i+h,65521);a=(i<<16)+h,U.popthenPush(5,U.positive32BitIntegerFor(a))}function x(){var a,b,d,e,f,g;if(4!==U.methodArgumentCount())return U.primitiveFail();if(b=U.stackObjectValue(0),g=U.stackIntegerValue(1),f=U.stackIntegerValue(2),d=U.positive32BitValueOf(U.stackValue(3)),U.failed())return 0;if(!(U.isBytes(b)&&g>=f&&f>0))return U.primitiveFail();if(!(c(b)>=g))return U.primitiveFail();for(a=b.bytes,--f,--g,e=f;g>=e;e++)d=da[255&(d^a[e])]^d>>>8;U.popthenPush(5,U.positive32BitIntegerFor(d))}function y(){var a,c,d,e,f,g;return 4!==U.methodArgumentCount()?U.primitiveFail():(c=U.stackObjectValue(0),e=U.stackObjectValue(1),a=U.stackObjectValue(2),d=U.stackObjectValue(3),f=U.stackObjectValue(4),U.failed()?null:r(f)&&U.isPointers(c)&&b(c)>=2&&U.isPointers(e)&&b(e)>=2&&U.isPointers(d)&&b(d)>=3&&U.isPointers(a)&&b(a)>=3?(g=z(d,a,e,c),U.failed()||(U.storeIntegerofObjectwithValue(1,f,wa),U.storeIntegerofObjectwithValue(W+1,f,$),U.storeIntegerofObjectwithValue(W+2,f,_)),void(U.failed()||(U.pop(5),U.pushInteger(g)))):U.primitiveFail())}function z(a,d,e,f){var g,h,i,j,k,l,m,n,o,p,q,r,t,u,v,w;if(v=U.fetchPointerofObject(0,a),r=U.fetchIntegerofObject(1,a),!((q=U.fetchIntegerofObject(2,a))>=r&&U.isBytes(v)&&q<=c(v)))return U.primitiveFail();if(o=v.bytes,v=U.fetchPointerofObject(0,d),!(U.isWords(v)&&q<=b(v)&&U.fetchIntegerofObject(1,d)===r&&U.fetchIntegerofObject(2,d)===q))return U.primitiveFail();if(i=v.words,v=U.fetchPointerofObject(0,e),!U.isWords(v))return U.primitiveFail();if(p=b(v),t=v.words,v=U.fetchPointerofObject(1,e),!U.isWords(v)||p!==b(v))return U.primitiveFail();if(u=v.words,v=U.fetchPointerofObject(0,f),!U.isWords(v))return U.primitiveFail();if(k=b(v),j=v.words,v=U.fetchPointerofObject(1,f),!U.isWords(v)||k!==b(v))return U.primitiveFail();for(l=v.words,s(0,0),w=0;q>r&&ca>wa+4;)if(n=o[r],h=i[r],++r,0===h){if(++w,!(p>n))return U.primitiveFail();s(t[n],u[n])}else{if(w=w+n+P,!(256>n))return U.primitiveFail();if(g=va[n],!(p>g))return U.primitiveFail();if(s(t[g],u[g]),m=ka[g-257],0!==m&&(n-=Z[g-257],s(m,n)),!(32768>--h))return U.primitiveFail();if(g=256>h?ga[h]:ga[256+(h>>>7)],!(k>g))return U.primitiveFail();s(j[g],l[g]),0!==(m=ja[g])&&(h-=Y[g],s(m,h))}return U.failed()?null:(U.storeIntegerofObjectwithValue(1,a,r),U.storeIntegerofObjectwithValue(1,d,r),w)}function A(a){return U=a,!1!==(U.majorVersion()==H)&&U.minorVersion()>=I}function B(){var a;return qa===sa||0==(4095&qa)&&(!(qa>=10*ua)&&(a=qa-ua,!(ua>=a)&&ua>=4*a))}function C(a){return(na<<5^a)&J}function D(a){return C(ba[a])}function E(a,b){var c,d,e,f,g;if((d=a[0]>>>24)>S)return U.primitiveFail(),0;for(f=2;;){if(c=G(d),(e=f+c-1)>=b)return U.primitiveFail(),0;if(0==(1056964608&(g=a[e])))return g;if(f=65535&g,(d=g>>>24&255)>S)return U.primitiveFail(),0}return 0}function F(){var a,b,c,d,e,f,g,h,i,j,k;for(f=ca-1;f>xa&&za>=Aa;)if(h=$,g=_,i=Aa,256>(k=E(oa,pa)))ba[++xa]=k;else{if(256===k)return Ba&=T,0;if(c=(k>>>16)-1,e=65535&k,c>0&&(e+=G(c)),k=E(ea,fa),c=k>>>16,a=65535&k,c>0&&(a+=G(c)),xa+e>=f)return $=h,_=g,Aa=i,0;for(b=xa,j=xa-a,d=1;e>=d;d++)ba[b+d]=ba[j+d];xa+=e}}function G(a){for(var b,c;a>_;)c=ya[++Aa],$+=f(c,_),_+=8;return b=$&f(1,a)-1,$=g($,a),_-=a,b}var H=1,I=11,J=32767,K=32768,L=32768,M=30,N=286,O=258,P=3,Q=32767,R=32768,S=16,T=1,U=null,V="ZipPlugin 3 November 2014 (e)",W=0,X=0,Y=[0,1,2,3,4,6,8,12,16,24,32,48,64,96,128,192,256,384,512,768,1024,1536,2048,3072,4096,6144,8192,12288,16384,24576],Z=[0,1,2,3,4,5,6,7,8,10,12,14,16,20,24,28,32,40,48,56,64,80,96,112,128,160,192,224,0],$=0,_=0,aa=0,ba=null,ca=0,da=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],ea=null,fa=0,ga=[0,1,2,3,4,4,5,5,6,6,6,6,7,7,7,7,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,0,0,16,17,18,18,19,19,20,20,20,20,21,21,21,21,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29],ha=null,ia=null,ja=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],ka=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],la=null,ma=null,na=0,oa=null,pa=0,qa=0,ra=null,sa=0,ta=null,ua=0,va=[257,258,259,260,261,262,263,264,265,265,266,266,267,267,268,268,269,269,269,269,270,270,270,270,271,271,271,271,272,272,272,272,273,273,273,273,273,273,273,273,274,274,274,274,274,274,274,274,275,275,275,275,275,275,275,275,276,276,276,276,276,276,276,276,277,277,277,277,277,277,277,277,277,277,277,277,277,277,277,277,278,278,278,278,278,278,278,278,278,278,278,278,278,278,278,278,279,279,279,279,279,279,279,279,279,279,279,279,279,279,279,279,280,280,280,280,280,280,280,280,280,280,280,280,280,280,280,280,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284],wa=0,xa=0,ya=null,za=0,Aa=0,Ba=0;Squeak.registerExternalModule("ZipPlugin",{primitiveZipSendBlock:y,primitiveUpdateAdler32:w,primitiveUpdateGZipCrc32:x,primitiveDeflateUpdateHashTable:u,setInterpreter:A,getModuleName:o,primitiveDeflateBlock:t,primitiveInflateDecompressBlock:v})});var LZString={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_f:String.fromCharCode,compressToBase64:function(a){if(null==a)return"";var b,c,d,e,f,g,h,i="",j=0;for(a=LZString.compress(a);j<2*a.length;)j%2==0?(b=a.charCodeAt(j/2)>>8,c=255&a.charCodeAt(j/2),d=j/2+1<a.length?a.charCodeAt(j/2+1)>>8:NaN):(b=255&a.charCodeAt((j-1)/2),(j+1)/2<a.length?(c=a.charCodeAt((j+1)/2)>>8,d=255&a.charCodeAt((j+1)/2)):c=d=NaN),j+=3,e=b>>2,f=(3&b)<<4|c>>4,g=(15&c)<<2|d>>6,h=63&d,isNaN(c)?g=h=64:isNaN(d)&&(h=64),i=i+LZString._keyStr.charAt(e)+LZString._keyStr.charAt(f)+LZString._keyStr.charAt(g)+LZString._keyStr.charAt(h);return i},decompressFromBase64:function(a){if(null==a)return"";var b,c,d,e,f,g,h,i,j="",k=0,l=0,m=LZString._f;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<a.length;)f=LZString._keyStr.indexOf(a.charAt(l++)),g=LZString._keyStr.indexOf(a.charAt(l++)),h=LZString._keyStr.indexOf(a.charAt(l++)),i=LZString._keyStr.indexOf(a.charAt(l++)),c=f<<2|g>>4,d=(15&g)<<4|h>>2,e=(3&h)<<6|i,k%2==0?(b=c<<8,64!=h&&(j+=m(b|d)),64!=i&&(b=e<<8)):(j+=m(b|c),64!=h&&(b=d<<8),64!=i&&(j+=m(b|e))),k+=3;return LZString.decompress(j)},compressToUTF16:function(a){if(null==a)return"";var b,c,d,e="",f=0,g=LZString._f;for(a=LZString.compress(a),b=0;b<a.length;b++)switch(c=a.charCodeAt(b),f++){case 0:e+=g(32+(c>>1)),d=(1&c)<<14;break;case 1:e+=g(d+(c>>2)+32),d=(3&c)<<13;break;case 2:e+=g(d+(c>>3)+32),d=(7&c)<<12;break;case 3:e+=g(d+(c>>4)+32),d=(15&c)<<11;break;case 4:e+=g(d+(c>>5)+32),d=(31&c)<<10;break;case 5:e+=g(d+(c>>6)+32),d=(63&c)<<9;break;case 6:e+=g(d+(c>>7)+32),d=(127&c)<<8;break;case 7:e+=g(d+(c>>8)+32),d=(255&c)<<7;break;case 8:e+=g(d+(c>>9)+32),d=(511&c)<<6;break;case 9:e+=g(d+(c>>10)+32),d=(1023&c)<<5;break;case 10:e+=g(d+(c>>11)+32),d=(2047&c)<<4;break;case 11:e+=g(d+(c>>12)+32),d=(4095&c)<<3;break;case 12:e+=g(d+(c>>13)+32),d=(8191&c)<<2;break;case 13:e+=g(d+(c>>14)+32),d=(16383&c)<<1;break;case 14:e+=g(d+(c>>15)+32,32+(32767&c)),f=0}return e+g(d+32)},decompressFromUTF16:function(a){if(null==a)return"";for(var b,c,d="",e=0,f=0,g=LZString._f;f<a.length;){switch(c=a.charCodeAt(f)-32,e++){case 0:b=c<<1;break;case 1:d+=g(b|c>>14),b=(16383&c)<<2;break;case 2:d+=g(b|c>>13),b=(8191&c)<<3;break;case 3:d+=g(b|c>>12),b=(4095&c)<<4;break;case 4:d+=g(b|c>>11),b=(2047&c)<<5;break;case 5:d+=g(b|c>>10),b=(1023&c)<<6;break;case 6:d+=g(b|c>>9),b=(511&c)<<7;break;case 7:d+=g(b|c>>8),b=(255&c)<<8;break;case 8:d+=g(b|c>>7),b=(127&c)<<9;break;case 9:d+=g(b|c>>6),b=(63&c)<<10;break;case 10:d+=g(b|c>>5),b=(31&c)<<11;break;case 11:d+=g(b|c>>4),b=(15&c)<<12;break;case 12:d+=g(b|c>>3),b=(7&c)<<13;break;case 13:d+=g(b|c>>2),b=(3&c)<<14;break;case 14:d+=g(b|c>>1),b=(1&c)<<15;break;case 15:d+=g(b|c),e=0}f++}return LZString.decompress(d)},compress:function(a){if(null==a)return"";var b,c,d,e={},f={},g="",h="",i="",j=2,k=3,l=2,m="",n=0,o=0,p=LZString._f;for(d=0;d<a.length;d+=1)if(g=a.charAt(d),Object.prototype.hasOwnProperty.call(e,g)||(e[g]=k++,f[g]=!0),h=i+g,Object.prototype.hasOwnProperty.call(e,h))i=h;else{if(Object.prototype.hasOwnProperty.call(f,i)){if(i.charCodeAt(0)<256){for(b=0;l>b;b++)n<<=1,15==o?(o=0,m+=p(n),n=0):o++;for(c=i.charCodeAt(0),b=0;8>b;b++)n=n<<1|1&c,15==o?(o=0,m+=p(n),n=0):o++,c>>=1}else{for(c=1,b=0;l>b;b++)n=n<<1|c,15==o?(o=0,m+=p(n),n=0):o++,c=0;for(c=i.charCodeAt(0),b=0;16>b;b++)n=n<<1|1&c,15==o?(o=0,m+=p(n),n=0):o++,c>>=1}j--,0==j&&(j=Math.pow(2,l),l++),delete f[i]}else for(c=e[i],b=0;l>b;b++)n=n<<1|1&c,15==o?(o=0,m+=p(n),n=0):o++,c>>=1;j--,0==j&&(j=Math.pow(2,l),l++),e[h]=k++,i=String(g)}if(""!==i){if(Object.prototype.hasOwnProperty.call(f,i)){if(i.charCodeAt(0)<256){for(b=0;l>b;b++)n<<=1,15==o?(o=0,m+=p(n),n=0):o++;for(c=i.charCodeAt(0),b=0;8>b;b++)n=n<<1|1&c,15==o?(o=0,m+=p(n),n=0):o++,c>>=1}else{for(c=1,b=0;l>b;b++)n=n<<1|c,15==o?(o=0,m+=p(n),n=0):o++,c=0;for(c=i.charCodeAt(0),b=0;16>b;b++)n=n<<1|1&c,15==o?(o=0,m+=p(n),n=0):o++,c>>=1}j--,0==j&&(j=Math.pow(2,l),l++),delete f[i]}else for(c=e[i],b=0;l>b;b++)n=n<<1|1&c,15==o?(o=0,m+=p(n),n=0):o++,c>>=1;0==--j&&(j=Math.pow(2,l),l++)}for(c=2,b=0;l>b;b++)n=n<<1|1&c,15==o?(o=0,m+=p(n),n=0):o++,c>>=1;for(;;){if(n<<=1,15==o){m+=p(n);break}o++}return m},decompress:function(a){if(null==a)return"";if(""==a)return null;var b,c,d,e,f,g,h,i=[],j=4,k=4,l=3,m="",n="",o=LZString._f,p={string:a,val:a.charCodeAt(0),position:32768,index:1};for(b=0;3>b;b+=1)i[b]=b;for(d=0,f=Math.pow(2,2),g=1;g!=f;)e=p.val&p.position,p.position>>=1,0==p.position&&(p.position=32768,p.val=p.string.charCodeAt(p.index++)),d|=(e>0?1:0)*g,g<<=1;switch(d){case 0:for(d=0,f=Math.pow(2,8),g=1;g!=f;)e=p.val&p.position,p.position>>=1,0==p.position&&(p.position=32768,p.val=p.string.charCodeAt(p.index++)),d|=(e>0?1:0)*g,g<<=1;h=o(d);break;case 1:for(d=0,f=Math.pow(2,16),g=1;g!=f;)e=p.val&p.position,p.position>>=1,0==p.position&&(p.position=32768,p.val=p.string.charCodeAt(p.index++)),d|=(e>0?1:0)*g,g<<=1;h=o(d);break;case 2:return""}for(i[3]=h,c=n=h;;){if(p.index>p.string.length)return"";for(d=0,f=Math.pow(2,l),g=1;g!=f;)e=p.val&p.position,p.position>>=1,0==p.position&&(p.position=32768,p.val=p.string.charCodeAt(p.index++)),d|=(e>0?1:0)*g,g<<=1;switch(h=d){case 0:for(d=0,f=Math.pow(2,8),g=1;g!=f;)e=p.val&p.position,p.position>>=1,0==p.position&&(p.position=32768,p.val=p.string.charCodeAt(p.index++)),d|=(e>0?1:0)*g,g<<=1;i[k++]=o(d),h=k-1,j--;break;case 1:for(d=0,f=Math.pow(2,16),g=1;g!=f;)e=p.val&p.position,p.position>>=1,0==p.position&&(p.position=32768,p.val=p.string.charCodeAt(p.index++)),d|=(e>0?1:0)*g,g<<=1;i[k++]=o(d),h=k-1,j--;break;case 2:return n}if(0==j&&(j=Math.pow(2,l),l++),i[h])m=i[h];else{if(h!==k)return null;m=c+c.charAt(0)}n+=m,i[k++]=c+m.charAt(0),j--,c=m,0==j&&(j=Math.pow(2,l),l++)}}};"undefined"!=typeof module&&null!=module&&(module.exports=LZString);