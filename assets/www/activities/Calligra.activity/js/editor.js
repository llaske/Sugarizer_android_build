var Editor={template:'\n\t\t<div>\n\t\t\t<div id="back" class="editor-goback" v-on:click="goBack()"></div>\n\t\t\t<img id="miniletter" class="editor-miniletter" v-bind:src="item.image"></img>\n\t\t\t<div id="area" class="editor-area">\n\t\t\t\t<canvas id="letter"></canvas>\n\t\t\t</div>\n\t\t\t<button id="editor-add" class="editor-add"></button>\n\t\t\t<button id="editor-remove" class="editor-remove"></button>\n\t\t\t<div class="editor-start"></div>\n\t\t\t<button id="editor-addpath" class="editor-addpath"></button>\n\t\t\t<button id="editor-removepath" class="editor-removepath"></button>\n\t\t\t<div class="editor-path"></div>\n\t\t</div>',props:["item"],data:function(){return{size:-1,imageSize:-1,zoom:-1,current:-1,keyboardEvent:null}},methods:{computeSize:function(){var t=this,e=document.getElementById("canvas")||document.getElementById("body"),n=e.offsetHeight-50,i={width:e.offsetWidth-50,height:n};t.size=Math.min(i.width,i.height);var d=document.getElementById("letter");d.width=t.size,d.height=t.size,d.style.marginLeft=(i.width-t.size)/2-50+"px",t.zoom=t.size/t.imageSize,this.draw()},initEvent:function(){var t=this,e="click",n="ontouchstart"in document.documentElement;n&&(e="touchend");var i=document.getElementById("letter");i.addEventListener(e,(function(e){e.preventDefault(),n&&(e=e.changedTouches[0]);var d=Math.floor((e.clientX-i.getBoundingClientRect().left)/t.zoom),o=Math.floor((e.clientY-i.getBoundingClientRect().top)/t.zoom);if(-1!=t.current){var a=t.item.starts[t.current];if(a.path&&a.path.length){var r=a.path[a.path.length-1];r.x=d,r.y=o}else a.x=d,a.y=o;t.draw()}})),document.getElementById("editor-add").addEventListener("click",(function(){t.item.starts||(t.item.starts=[]);var e=t.item.starts.length;t.item.starts.push({x:5+5*e,y:5+5*e,path:[]}),t.draw()})),document.getElementById("editor-remove").addEventListener("click",(function(){t.item.starts.pop(),t.draw()})),document.getElementById("editor-addpath").addEventListener("click",(function(){var e=t.item.starts[t.current];e.path||(e.path=[]);var n=e.path.length;e.path.push({x:5+5*n,y:5+5*n}),t.draw()})),document.getElementById("editor-removepath").addEventListener("click",(function(){t.item.starts[t.current].path.pop(),t.draw()})),t.keyboardEvent=function(e){if(-1!=t.current){var n=t.item.starts[t.current];n.path&&n.path.length&&(n=n.path[n.path.length-1]),"38"==e.keyCode?n.y--:"40"==e.keyCode?n.y++:"37"==e.keyCode?n.x--:"39"==e.keyCode?n.x++:"80"==e.keyCode&&document.getElementById("editor-addpath").click(),t.draw()}},document.addEventListener("keydown",t.keyboardEvent)},draw:function(){var t=this,e=document.getElementById("letter").getContext("2d");e.clearRect(0,0,t.size,t.size);var n=new Image;n.onload=function(){e.drawImage(n,0,0,t.size,t.size),t.item.starts&&t.item.starts.length?(document.getElementById("editor-remove").disabled=!1,document.getElementById("editor-addpath").disabled=!1,t.item.starts.forEach((function(n,i){e.beginPath(),e.arc(n.x*t.zoom,n.y*t.zoom,2*t.zoom,0,2*Math.PI),e.fillStyle="red",e.fill(),t.current=i,document.getElementById("editor-removepath").disabled=!(n.path&&n.path.length),n.path&&n.path.length&&n.path.forEach((function(n){e.beginPath(),e.arc(n.x*t.zoom,n.y*t.zoom,1*t.zoom,0,2*Math.PI),e.fillStyle="yellow",e.fill()}))}))):(document.getElementById("editor-remove").disabled=!0,document.getElementById("editor-addpath").disabled=!0,document.getElementById("editor-removepath").disabled=!0)},n.src=t.item.image},onLoad:function(){this.computeSize(),this.initEvent()},goBack:function(){app.displayTemplateView()}},mounted:function(){var t=this,e=new Image;e.onload=function(){t.imageSize=e.width,t.onLoad()},e.src=t.item.image},beforeDestroy:function(){document.removeEventListener("keydown",this.keyboardEvent)}};