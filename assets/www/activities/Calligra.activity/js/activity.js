requirejs.config({baseUrl:"lib",paths:{activity:"../js"}});var app=new Vue({el:"#app",components:{toolbar:Toolbar,localization:Localization,tutorial:Tutorial,"template-viewer":TemplateViewer,editor:Editor,player:Player},data:{currentView:TemplateViewer,currentLibrary:null,currentTemplate:null,currentItem:null,color:{stroke:"#00000",fill:"#ffffff"}},created:function(){requirejs(["sugar-web/activity/activity","sugar-web/env","activity/palettes/templatepalette"],(function(e,t,r){e.setup()}))},mounted:function(){var e=this;requirejs(["sugar-web/activity/activity","sugar-web/env"],(function(t,r){r.getEnvironment((function(n,i){r.getEnvironment((function(t,r){e.color=r.user.colorvalue,document.getElementById("canvas").style.backgroundColor=e.color.fill})),i.objectId?t.getDatastoreObject().loadAsText((function(t,r,n){if(null==t&&null!=n){var i=JSON.parse(n);e.currentLibrary=i.library,e.currentTemplate=i.library[i.template],document.getElementById("template-button").style.backgroundImage="url(icons/"+e.currentTemplate.name+".svg)",e.$refs.toolbar.$refs.templatebutton.paletteObject.getPalette().children[0].style.backgroundImage="url(icons/"+e.currentTemplate.name+".svg)"}else e.currentLibrary=defaultTemplates,e.currentTemplate=defaultTemplates[0]})):(e.currentLibrary=defaultTemplates,e.currentTemplate=defaultTemplates[0])}))})),window.addEventListener("resize",(function(){e.onResize()})),document.getElementById("unfullscreen-button").addEventListener("click",(function(){e.unfullscreen()}))},methods:{localized:function(){this.$refs.toolbar.localized(this.$refs.localization),this.$refs.tutorial.localized(this.$refs.localization)},displayTemplateView:function(){var e=this;e.$refs.toolbar.$refs.lines.isDisabled=!0,e.$refs.toolbar.$refs.zoombutton.isDisabled=!0,e.currentView=TemplateViewer,e.$refs.toolbar.$refs.insertimage.isDisabled=!e.$refs.view.editMode,document.getElementById("canvas").style.backgroundColor=e.color.fill,document.getElementById("settings-button").style.backgroundImage=e.$refs.view.editMode?"url(icons/play.svg)":"url(icons/settings.svg)"},fullscreen:function(){document.getElementById("main-toolbar").style.opacity=0,document.getElementById("canvas").style.top="0px",document.getElementById("unfullscreen-button").style.visibility="visible",this.currentView===Player&&this.$refs.view.doFullscreen(!0)},unfullscreen:function(){document.getElementById("main-toolbar").style.opacity=1,document.getElementById("canvas").style.top="55px",document.getElementById("unfullscreen-button").style.visibility="hidden",this.currentView===Player&&this.$refs.view.doFullscreen(!1)},onTemplateSelected:function(e){for(var t=this,r=0;r<t.currentLibrary.length;r++)if(t.currentTemplate==t.currentLibrary[r]){t.currentLibrary[r]=t.currentTemplate;break}t.currentTemplate=t.currentLibrary[e.index],t.displayTemplateView()},onItemSelected:function(e,t){var r=this;if(r.currentView===TemplateViewer){if(t){for(var n=-1,i=0;i<r.currentTemplate.images.length;i++)if(r.currentTemplate.images[i]==e){n=i;break}return void r.currentTemplate.images.splice(n,1)}r.$refs.toolbar.$refs.lines.isDisabled=!1,r.$refs.toolbar.$refs.zoombutton.isDisabled=!1,r.$refs.toolbar.$refs.insertimage.isDisabled=!0,r.currentView=Player,r.currentItem=e,document.getElementById("canvas").style.backgroundColor="#ffffff"}},onZoom:function(e){this.currentView===Player&&this.$refs.view.doZoom(e.detail)},onSettings:function(){var e=this;e.currentView===TemplateViewer?(e.$refs.view.editMode=!e.$refs.view.editMode,e.$refs.toolbar.$refs.insertimage.isDisabled=!e.$refs.toolbar.$refs.insertimage.isDisabled,document.getElementById("settings-button").style.backgroundImage=e.$refs.view.editMode?"url(icons/play.svg)":"url(icons/settings.svg)"):e.currentView===Player?(e.currentView=Editor,document.getElementById("settings-button").style.backgroundImage="url(icons/play.svg)"):(e.currentView=Player,document.getElementById("settings-button").style.backgroundImage="url(icons/settings.svg)")},onInsertImage:function(){var e=this;e.currentView===TemplateViewer&&e.$refs.view.editMode&&requirejs(["sugar-web/datastore","sugar-web/graphics/journalchooser"],(function(t,r){setTimeout((function(){r.show((function(r){r&&new t.DatastoreObject(r.objectId).loadAsText((function(t,r,n){e.currentTemplate.images.push({image:n})}))}),{mimetype:"image/png"},{mimetype:"image/jpeg"})}),0)}))},onLines:function(){this.$refs.toolbar.$refs.lines.isActive=!this.$refs.toolbar.$refs.lines.isActive,this.currentView===Player&&this.$refs.view.draw()},onResize:function(){this.currentView===Player&&this.$refs.view.computeSize()},onHelp:function(){var e=this,t={};t.currentView=e.currentView,t.editMode=e.$refs.view.editMode||e.currentView===Editor,t.templatebutton=e.$refs.toolbar.$refs.templatebutton.$el,t.fullscreenbutton=e.$refs.toolbar.$refs.fullscreen.$el,t.settingsbutton=e.$refs.toolbar.$refs.settings.$el,e.currentView===TemplateViewer?(t.insertimagebutton=e.$refs.toolbar.$refs.insertimage.$el,e.currentTemplate&&e.currentTemplate.images&&e.currentTemplate.images[0]&&(t.item=e.$refs.view.$refs.item0[0].$el)):(t.linesbutton=e.$refs.toolbar.$refs.lines.$el,t.zoombutton=e.$refs.toolbar.$refs.zoombutton.$el,t.backbutton=document.getElementById("back"),t.restartbutton=document.getElementById("player-restart"),t.editoraddbutton=document.getElementById("editor-add"),t.editorremovebutton=document.getElementById("editor-remove"),t.editoraddpathbutton=document.getElementById("editor-addpath"),t.editorremovepathbutton=document.getElementById("editor-removepath")),this.$refs.tutorial.show(t)},onStop:function(){var e=this;requirejs(["sugar-web/activity/activity"],(function(t){console.log("writing..."),requirejs(["sugar-web/activity/activity"],(function(t){console.log("writing...");for(var r=0;r<e.currentLibrary.length;r++)if(e.currentTemplate==e.currentLibrary[r]){e.currentLibrary[r]=e.currentTemplate;break}var n={library:e.currentLibrary,template:r},i=JSON.stringify(n);t.getDatastoreObject().setDataAsText(i),t.getDatastoreObject().save((function(e){null===e?console.log("write done."):console.log("write failed.")}))}))}))}}});