var Player={template:'\n\t\t<div>\n\t\t\t<div id="back" class="editor-goback" v-on:click="goBack()"></div>\n\t\t\t<img id="miniletter" class="editor-miniletter" v-bind:src="item.image"></img>\n\t\t\t<div id="area" class="editor-area">\n\t\t\t\t<canvas id="letter"></canvas>\n\t\t\t</div>\n\t\t\t<button id="player-restart" class="player-restart"></button>\n\t\t\t<div id="cursor" class="player-cursor"></div>\n\t\t</div>',props:["item"],data:function(){return{size:-1,imageSize:-1,zoom:-1,current:{start:-1,stroke:-1,strokes:[],index:-1,cursor:{x:0,y:0},timeout:null},zoomMult:1,mode:"",drawing:!1}},methods:{computeSize:function(){var t=this,e=document.getElementById("canvas")||document.getElementById("body"),r=e.offsetHeight-50,o={width:e.offsetWidth-50,height:r};t.size=Math.min(o.width,o.height);var n=document.getElementById("letter");n.width=t.size,n.height=t.size,n.style.marginLeft=(o.width-t.size)/2-50+"px",t.zoom=t.size/t.imageSize*t.zoomMult,t.size*=t.zoomMult,this.draw()},initEvent:function(){var t=this;document.getElementById("player-restart").addEventListener("click",(function(e){t.startDemoMode()}));var e="mousedown",r="mousemove",o="mouseup",n="ontouchstart"in document.documentElement;n&&(e="touchstart",r="touchmove",o="touchend");var i=document.getElementById("cursor");i.addEventListener(r,(function(e){if(e.preventDefault(),"input"==t.mode&&t.drawing){n&&(e=e.touches[0]);var r=Math.floor((e.clientX-s.getBoundingClientRect().left)/t.zoom),o=Math.floor((e.clientY-s.getBoundingClientRect().top)/t.zoom);t.handleMouseMove(r,o)}})),i.addEventListener(e,(function(e){e.preventDefault(),t.drawing="input"==t.mode})),i.addEventListener(o,(function(e){e.preventDefault(),t.drawing=!1}));var s=document.getElementById("letter");s.addEventListener(e,(function(e){e.preventDefault(),t.drawing="input"==t.mode})),s.addEventListener(o,(function(e){e.preventDefault(),t.drawing=!1})),s.addEventListener(r,(function(e){if(e.preventDefault(),"input"==t.mode&&t.drawing){n&&(e=e.touches[0]);var r=Math.floor((e.clientX-s.getBoundingClientRect().left)/t.zoom),o=Math.floor((e.clientY-s.getBoundingClientRect().top)/t.zoom);t.handleMouseMove(r,o)}}))},draw:function(){var t=this,e=document.getElementById("letter").getContext("2d");e.clearRect(0,0,t.size,t.size);var r=new Image;r.onload=function(){t.drawLines(),e.drawImage(r,0,0,t.size,t.size),"input"==t.mode&&t.current.strokes.length&&t.drawStoke()},r.src=t.item.image},drawLines:function(){if(app.$refs.toolbar.$refs.lines.isActive){var t=document.getElementById("letter").getContext("2d");t.strokeStyle="lightgray",t.lineWidth=3;for(var e=[8,85,122,202],r=0;r<e.length;r++)t.beginPath(),t.moveTo(0*this.zoom,this.zoom*e[r]),t.lineTo(208*this.zoom,this.zoom*e[r]),t.stroke()}},drawStoke:function(){var t=this,e=document.getElementById("letter").getContext("2d");e.strokeStyle=app.color.stroke,e.lineWidth=10,e.lineCap="round",e.lineJoin="round";for(var r=0;r<t.current.strokes.length;r++){e.beginPath();for(var o=0;o<t.current.strokes[r].length;o++)e.lineTo(t.zoom*t.current.strokes[r][o].x,t.zoom*t.current.strokes[r][o].y);e.stroke()}},moveCursor:function(t){var e=document.getElementById("cursor");e&&(e.style.left=t.x+letter.getBoundingClientRect().left-23+"px",e.style.top=t.y+"px",this.current.cursor={x:t.x,y:t.y})},setCursorVisibility:function(t){var e=document.getElementById("cursor");e&&(e.style.visibility=t?"visible":"hidden")},handleMouseMove:function(t,e){var r=this,o=r.item.starts[r.current.start].path.length?r.item.starts[r.current.start].path[r.current.index]:r.item.starts[r.current.start];if(r.moveCursor({x:r.zoom*o.x,y:r.zoom*o.y}),Math.sqrt(Math.pow(t-o.x,2)+Math.pow(e-o.y,2))<=5&&(r.current.strokes[r.current.start].push({x:o.x,y:o.y}),r.drawStoke(),r.current.index++,r.current.index>=r.item.starts[r.current.start].path.length))if(r.current.start++,r.current.index=0,r.current.start>=r.item.starts.length)r.mode="end",r.setCursorVisibility(!1);else{var n=[{x:r.item.starts[r.current.start].x,y:r.item.starts[r.current.start].y}];r.moveCursor({x:r.zoom*n[0].x,y:r.zoom*n[0].y}),r.current.strokes.push(n),r.drawStoke()}},startDemoMode:function(){var t=this;t.mode="show";var step=function(){var e=t.current.strokes[t.current.start][t.current.stroke],r=document.getElementById("letter");if(r){var o=r.getContext("2d");o.beginPath(),o.strokeStyle=app.color.stroke,o.lineWidth=10,o.lineCap="round",o.lineJoin="round",o.moveTo(t.zoom*e.x0,t.zoom*e.y0),o.lineTo(t.zoom*e.x1,t.zoom*e.y1),o.stroke(),t.moveCursor({x:t.zoom*e.x1,y:t.zoom*e.y1}),t.current.stroke++,t.current.stroke>=t.current.strokes[t.current.start].length?(t.current.start++,t.current.stroke=0,t.current.start<t.current.strokes.length?t.current.timeout=setTimeout((function(){t.current.timeout=setTimeout(step,70)}),210):t.current.timeout=setTimeout((function(){t.startInputMode(),t.current.timeout=null}),700)):t.current.timeout=setTimeout(step,70)}};if(t.item.starts&&t.item.starts[0].path.length){t.current.start=0,t.current.stroke=0,t.current.strokes=[];for(var e=0;e<t.item.starts.length;e++)if(t.item.starts[e].path){var r=[],o=t.item.starts[e].path;t.item.starts[e].path.length?r.push({x0:t.item.starts[e].x,y0:t.item.starts[e].y,x1:o[0].x,y1:o[0].y}):r.push({x0:t.item.starts[e].x,y0:t.item.starts[e].y,x1:t.item.starts[e].x,y1:t.item.starts[e].y});for(var n=0;n<o.length;n++)n+1<o.length&&r.push({x0:o[n].x,y0:o[n].y,x1:o[n+1].x,y1:o[n+1].y});t.current.strokes.push(r)}var i=t.current.strokes[t.current.start][t.current.stroke];t.moveCursor({x:t.zoom*i.x0,y:t.zoom*i.y0}),t.setCursorVisibility(!0),t.current.timeout=setTimeout(step,70)}},startInputMode:function(){var t=this;if(t.mode="input",t.current.start=0,t.current.stroke=0,t.current.index=0,t.current.strokes=[],t.item.starts&&t.item.starts.length){var e=[{x:t.item.starts[0].x,y:t.item.starts[0].y}];t.moveCursor({x:t.zoom*e[0].x,y:t.zoom*e[0].y}),t.setCursorVisibility(!0),t.current.strokes.push(e)}t.draw()},onLoad:function(){this.computeSize(),this.initEvent(),requirejs(["sugar-web/graphics/icon"],(function(t){t.colorize(document.getElementById("cursor"),app.color,(function(){}))}))},doZoom:function(t){var e=this,r=1,o=e.current.cursor.x/e.zoom,n=e.current.cursor.y/e.zoom;switch(t.zoom){case 0:r=.9;break;case 1:e.zoomMult=1;break;case 2:r*=1.1}e.zoomMult*=r,e.computeSize(),e.moveCursor({x:e.zoom*o,y:e.zoom*n})},doFullscreen:function(t){var e=this,r=e.current.cursor.x/e.zoom,o=e.current.cursor.y/e.zoom;e.computeSize(),e.moveCursor({x:e.zoom*r,y:e.zoom*o})},goBack:function(){app.displayTemplateView()}},mounted:function(){var t=this,e=new Image;e.onload=function(){t.imageSize=e.width,t.onLoad(),t.startDemoMode()},e.src=t.item.image},beforeDestroy:function(){this.current.timeout&&clearTimeout(this.current.timeout)}};