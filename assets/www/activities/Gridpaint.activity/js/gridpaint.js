/*! Sugarizer 2019-09-21 */
function appInit(){frame=document.getElementById("frame"),clearbtn=document.getElementById("clear-button"),thumbframe=document.getElementById("thumbframe"),cnv=document.getElementById("gridcnv"),cnv.width=1024,cnv.height=748,hitbuffer=document.getElementById("hitbuffer"),hitbuffer.width=1024,hitbuffer.height=748;var a=location.href.split("--");3==a.length&&(fname=a[1]);for(var b=0;b<shapedefs.length;b++)newShape(shapedefs[b]);for(var b=0;b<shapes.length;b++)colors.push("red");eventInit(),"edit"==mode?editMode():selectorMode(),loadPos(selected),hittestInit(),thumbsInit(),drawButtons(),clearbtn.addEventListener("click",handleClearButton)}function newShape(a){var b={};b.points=a,shapes.push(b)}function handleStart(a,b){if(a<120)return void handleButton(b);findPiece(a,b);onMove=handleMove,onEnd=handleEnd,handleMove(a,b)}function handleMove(a,b){changed=!0;var c=findPiece(a,b);c<0||(colors[c]=newcolor,fillPiece(c),strokePiece(c))}function handleEnd(a){onMove=void 0,onUp=void 0,savePos(selected)}function handleButton(a){a>650&&selectorMode(!0);var b=Math.floor((a-20)/70);b<0||b>=cnames.length||(bselected=b,newcolor=cnames[b],drawButtons())}function hittestInit(){hitbuffer.style.visibility="hidden";var a=hitbuffer.getContext("2d");a.save(),a.translate(140,20),a.scale(scale,scale);for(var b=0;b<shapes.length;b++){var c=hexdigit(15&b),d=hexdigit(b>>4&15),e=hexdigit(b>>8&15);a.fillStyle="#"+e+"F"+d+"F"+c+"F",shapePath(b,a,!0),a.fill()}a.restore()}function findPiece(a,b){var c=hitbuffer.getContext("2d"),d=c.getImageData(a,b,1,1).data;return 255!=d[3]?-1:(d[0]>>4<<8)+(d[1]>>4<<4)+(d[2]>>4)}function hexdigit(a){return"0123456789ABCDEF".charAt(a)}function fillPiece(a){var b=cnv.getContext("2d");b.save(),b.translate(140,20),b.scale(scale,scale),b.fillStyle=colors[a],shapePath(a,b),b.fill(),b.restore()}function strokePiece(a){var b=cnv.getContext("2d");b.save(),b.translate(140,20),b.scale(scale,scale),b.strokeStyle="#404040",b.lineWidth=1,shapePath(a,b),b.stroke(),b.restore()}function shapePath(a,b,c){var d=shapes[a].points;b.beginPath(),b.moveTo(d[0],d[1]);for(var e=2;e<d.length;e+=2)b.lineTo(d[e],d[e+1]);b.lineTo(d[0],d[1])}function drawButtons(){var a=cnv.getContext("2d");a.fillStyle="#f0f0f0",a.fillRect(0,0,120,700),a.strokeStyle="#505050";for(var b=0;b<cnames.length;b++)drawButton(a,b);drawSaveButton(a)}function drawButton(a,b,c){a.fillStyle=cnames[b],a.lineWidth=b==bselected?4:2,roundRectPath(a,60,30+70*b,30,30),a.fill(),a.stroke()}function roundRectPath(a,b,c,d,e){var f=4;a.beginPath(),a.moveTo(b+f,c),a.lineTo(b+d-f,c),a.quadraticCurveTo(b+d,c,b+d,c+f),a.lineTo(b+d,c+e-f),a.quadraticCurveTo(b+d,c+e,b+d-f,c+e),a.lineTo(b+f,c+e),a.quadraticCurveTo(b,c+e,b,c+e-f),a.lineTo(b,c+f),a.quadraticCurveTo(b,c,b+f,c)}function drawSaveButton(a){a.fillStyle="green",a.lineWidth=3,a.beginPath(),a.arc(75,690,15,0,359.2*Math.PI-.001),a.fill(),a.stroke()}function handleClearButton(){for(var a in colors)colors[a]="white",fillPiece(a),strokePiece(a)}var frame,cnv,hitbuffer,clearbtn,shapes=[],colors=[],cnames=["red","yellow","#ff6600","#764300","limegreen","blue","darkmagenta","black","white"],cletters=["r","y","o","n","g","b","v","k","w"],bselected=0,newcolor=cnames[bselected],changed=!1,scale=1.18,fname="sqgridpos";