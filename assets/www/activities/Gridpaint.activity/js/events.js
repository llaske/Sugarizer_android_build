var onStart,onMove,onEnd,zoom,touchScreen=!1;function eventInit(){(touchScreen="ontouchstart"in document.documentElement)?(document.getElementById("canvas").addEventListener("touchstart",evMousedown,!1),frame.addEventListener("touchmove",evMousemove,!1),frame.addEventListener("touchend",evMouseup,!1)):(document.getElementById("canvas").onmousedown=evMousedown,frame.onmousemove=evMousemove,frame.onmouseup=evMouseup),computeSize(),window.addEventListener("resize",computeSize)}function computeSize(){var e=document.body.clientHeight-("visible"!=document.getElementById("unfullscreen-button").style.visibility?55:0);zoom=e/748;var t=(document.body.clientWidth-1024*zoom)/2;document.getElementById("frame").style.marginLeft=t+"px";var setTransform=function(e){e.style.transform="scale("+zoom+","+zoom+")",e.style.transformOrigin="0% 0%",e.style.width="1024px",e.style.height="748px"};setTransform(document.getElementById("gridcnv")),setTransform(document.getElementById("hitbuffer")),setTransform(document.getElementById("thumbframe"))}function evMousedown(e){e.preventDefault(),touchScreen&&(e=e.touches[0]);var t=localx(e.clientX),n=localy(e.clientY);onStart(t,n),/Android/i.test(navigator.userAgent)&&"http"!=document.location.protocol.substr(0,4)&&(cnv.style.display="none",cnv.offsetHeight,cnv.style.display="block")}function evMousemove(e){if(e.preventDefault(),touchScreen&&(e=e.touches[0]),onMove){var t=localx(e.clientX),n=localy(e.clientY);onMove(t,n)}}function evMouseup(e){e.preventDefault(),onEnd&&onEnd()}function localx(e){return(e-frame.getBoundingClientRect().left)/zoom}function localy(e){return(e-frame.getBoundingClientRect().top)/zoom}