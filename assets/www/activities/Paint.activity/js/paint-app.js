define([],(function(){function displayUndoRedoButtons(){if(t.data.isShared&&!t.data.isHost)return t.elements.redoButton.style.opacity="0.4",void(t.elements.undoButton.style.opacity="0.4");0===t.data.history.redo.length?t.elements.redoButton.style.opacity="0.4":t.elements.redoButton.style.opacity="1",t.data.history.undo.length<=1?t.elements.undoButton.style.opacity="0.4":t.elements.undoButton.style.opacity="1"}function saveCanvas(){var e=t.elements.canvas;try{var a=e.toDataURL()}catch(t){}(t.data.history.undo.length>0&&t.data.history.undo[t.data.history.undo.length-1]!==a||0===t.data.history.undo.length)&&(t.data.history.undo.push(a),t.data.history.redo=[]),t.data.history.redo.length>t.data.history.limit&&(t.data.history.redo=t.data.history.redo.slice(1)),t.data.history.undo.length>t.data.history.limit&&(t.data.history.undo=t.data.history.undo.slice(1)),displayUndoRedoButtons(),t.data.isShared&&!t.data.isHost&&t.collaboration.sendMessage({action:"saveCanvas"})}function handleCurrentFloatingElement(){void 0!==t.data.currentElement&&("copy/paste"!=t.data.currentElement.type||"Copy"!=t.data.mode&&"Paste"!=t.data.mode)&&(t.data.currentElement.element.parentElement.removeChild(t.data.currentElement.element),t.data.currentElement=void 0)}var t={libs:{},palettes:{},elements:{},buttons:{},paletteModesButtons:[],data:{isCompressEnabled:!0,isHost:!0,history:{limit:15,undo:[],redo:[]},size:5,color:{stroke:"#1500A7",fill:"#ff0000"},tool:void 0},modes:{},switchMode:function switchMode(e){saveCanvas(),t.data.mode=e,t.handleCurrentFloatingElement(),t.data.tool.onMouseDown=t.modes[e].onMouseDown,t.data.tool.onMouseDrag=t.modes[e].onMouseDrag,t.data.tool.onMouseUp=t.modes[e].onMouseUp},undoCanvas:function undoCanvas(){if(t.handleCurrentFloatingElement(),!(t.data.history.undo.length<2)){t.modes.Pen.point=void 0;var e=t.elements.canvas,a=e.getContext("2d"),o=new Image,n=t.data.history.undo[t.data.history.undo.length-2],s=t.data.history.undo[t.data.history.undo.length-1];return o.onload=function(){if(a.save(),a.setTransform(1,0,0,1,0,0),a.clearRect(0,0,e.width,e.height),a.drawImage(o,0,0),a.restore(),t.data.isShared)try{t.collaboration.sendMessage({action:"toDataURL",data:{width:t.elements.canvas.width/window.devicePixelRatio,height:t.elements.canvas.height/window.devicePixelRatio,src:t.collaboration.compress(t.elements.canvas.toDataURL())}})}catch(t){return}},o.src=n,t.data.history.redo.push(s),t.data.history.undo.pop(),displayUndoRedoButtons(),n}},redoCanvas:function redoCanvas(){if(handleCurrentFloatingElement(),0!==t.data.history.redo.length){t.modes.Pen.point=void 0;var e=t.elements.canvas,a=e.getContext("2d"),o=new Image,n=t.data.history.redo[t.data.history.redo.length-1];return o.onload=function(){if(a.save(),a.setTransform(1,0,0,1,0,0),a.clearRect(0,0,e.width,e.height),a.drawImage(o,0,0),a.restore(),t.data.isShared)try{t.collaboration.sendMessage({action:"toDataURL",data:{width:t.elements.canvas.width/window.devicePixelRatio,height:t.elements.canvas.height/window.devicePixelRatio,src:t.collaboration.compress(t.elements.canvas.toDataURL())}})}catch(t){}},o.src=n,t.data.history.undo.push(n),t.data.history.redo.pop(),displayUndoRedoButtons(),n}},displayUndoRedoButtons:displayUndoRedoButtons,saveCanvas:saveCanvas,clearCanvas:function clearCanvas(){var e=t.elements.canvas.getContext("2d");e.fillStyle="#ffffff",e.fillRect(0,0,parseInt(t.elements.canvas.style.width),parseInt(t.elements.canvas.style.height)),t.saveCanvas()},paletteRemoveActiveClass:function paletteRemoveActiveClass(){for(var e=0;e<t.paletteModesButtons.length;e++)t.paletteModesButtons[e].className=t.paletteModesButtons[e].className.replace(/(?:^|\s)active(?!\S)/g,"")},addActiveClassToElement:function addActiveClassToElement(t){t.className+=" active"},handleCurrentFloatingElement:handleCurrentFloatingElement};return t}));