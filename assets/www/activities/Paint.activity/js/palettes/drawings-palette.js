/*! Sugarizer 2016-12-28 */
define(["sugar-web/graphics/palette","mustache"],function(a,b){function c(a){var b=window.location.href.split("/");b.pop(),b=b.join("/")+"/"+a.detail.drawings;var c=(PaintApp.elements.canvas.getContext("2d"),new XMLHttpRequest);c.open("GET",b,!0),c.onload=function(a){if(200===c.status||0===c.status){var b=c.responseText,d=document.createElement("img");d.src="data:image/svg+xml;base64,"+btoa(b),d.onload=function(){var a=PaintApp.elements.canvas.getContext("2d"),b=d.width,c=d.height,e=PaintApp.elements.canvas.getBoundingClientRect().width,f=PaintApp.elements.canvas.getBoundingClientRect().height,g=Math.min(e/b,f/c),h=g*b,i=g*c;if(a.clearRect(0,0,PaintApp.elements.canvas.width,PaintApp.elements.canvas.height),a.drawImage(d,0,0,h,i),PaintApp.saveCanvas(),PaintApp.data.isShared)try{PaintApp.collaboration.sendMessage({action:"toDataURL",data:{width:PaintApp.elements.canvas.width/window.devicePixelRatio,height:PaintApp.elements.canvas.height/window.devicePixelRatio,src:PaintApp.collaboration.compress(PaintApp.elements.canvas.toDataURL())}})}catch(a){}}}},c.send(null)}function d(){var a=document.getElementById("drawings-button"),b=new PaintApp.palettes.drawingsPalette.DrawingsPalette(a,void 0);b.addEventListener("drawingsChange",c)}var e={};e.initGui=d,e.DrawingsPalette=function(c,d){function e(a){h.drawingsChangeEvent.detail.drawings=a.target.value,h.getPalette().dispatchEvent(h.drawingsChangeEvent),h.popDown()}a.Palette.call(this,c,d),this.drawingsChangeEvent=document.createEvent("CustomEvent"),this.drawingsChangeEvent.initCustomEvent("drawingsChange",!0,!0,{drawings:"icons/size-1.svg"}),this.template='<tbody>{{#rows}}<tr>{{#.}}<td><button value="{{drawings}}" style="height:55px; width:55px; background-size: 55px 55px; background-image: url({{ drawings }}); background-repeat: no-repeat; background-position: center; "></button></td>{{/.}}</tr>{{/rows}}</tbody>';var f=document.createElement("table");f.className="drawingss";var g={rows:[[{drawings:"drawings/woodpecker.svg"},{drawings:"drawings/tortoise.svg"},{drawings:"drawings/manatee.svg"}],[{drawings:"drawings/dog.svg"},{drawings:"drawings/goldfinch.svg"},{drawings:"drawings/mammoth.svg"}]]};f.innerHTML=b.render(this.template,g),this.setContent([f]),this.buttons=f.querySelectorAll("button");for(var h=this,i=0;i<this.buttons.length;i++)this.buttons[i].addEventListener("click",e)};var f=function(a){var b=document.createEvent("MouseEvents");b.initEvent("click",!0,!0),this.buttons[a].dispatchEvent(b)},g=function(a,b,c){return this.getPalette().addEventListener(a,b,c)};return e.DrawingsPalette.prototype=Object.create(a.Palette.prototype,{setdrawings:{value:f,enumerable:!0,configurable:!0,writable:!0},addEventListener:{value:g,enumerable:!0,configurable:!0,writable:!0}}),e});