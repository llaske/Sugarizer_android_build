define(["sugar-web/graphics/palette","mustache"],(function(t,e){var n={};function onDrawingSelect(t){var e=window.location.href.split("/");e.pop(),e=e.join("/")+"/"+t.detail.drawings;PaintApp.elements.canvas.getContext("2d");var n=new XMLHttpRequest;n.open("GET",e,!0),n.onload=function(t){if(200===n.status||0===n.status){var e=n.responseText,a=document.createElement("img");a.src="data:image/svg+xml;base64,"+btoa(e),a.onload=function(){var t=PaintApp.elements.canvas.getContext("2d"),e=a.width,n=a.height,i=PaintApp.elements.canvas.getBoundingClientRect().width,s=PaintApp.elements.canvas.getBoundingClientRect().height,r=Math.min(i/e,s/n),o=r*e,d=r*n;if(t.clearRect(0,0,PaintApp.elements.canvas.width,PaintApp.elements.canvas.height),t.drawImage(a,0,0,o,d),PaintApp.saveCanvas(),PaintApp.data.isShared)try{PaintApp.collaboration.sendMessage({action:"toDataURL",data:{width:PaintApp.elements.canvas.width/window.devicePixelRatio,height:PaintApp.elements.canvas.height/window.devicePixelRatio,src:PaintApp.collaboration.compress(PaintApp.elements.canvas.toDataURL())}})}catch(t){}}}},n.send(null)}n.initGui=function initGui(){var t=document.getElementById("drawings-button");new PaintApp.palettes.drawingsPalette.DrawingsPalette(t,void 0).addEventListener("drawingsChange",onDrawingSelect)},n.DrawingsPalette=function(n,a){t.Palette.call(this,n,a),this.drawingsChangeEvent=document.createEvent("CustomEvent"),this.drawingsChangeEvent.initCustomEvent("drawingsChange",!0,!0,{drawings:"icons/size-1.svg"}),this.template='<tbody>{{#rows}}<tr>{{#.}}<td><button value="{{drawings}}" style="height:55px; width:55px; background-size: 55px 55px; background-image: url({{ drawings }}); background-repeat: no-repeat; background-position: center; "></button></td>{{/.}}</tr>{{/rows}}</tbody>';var i=document.createElement("table");i.className="drawingss";i.innerHTML=e.render(this.template,{rows:[[{drawings:"drawings/woodpecker.svg"},{drawings:"drawings/tortoise.svg"},{drawings:"drawings/manatee.svg"}],[{drawings:"drawings/dog.svg"},{drawings:"drawings/goldfinch.svg"},{drawings:"drawings/mammoth.svg"}]]}),this.setContent([i]),this.buttons=i.querySelectorAll("button");var s=this;function popDownOnButtonClick(t){s.drawingsChangeEvent.detail.drawings=t.target.value,s.getPalette().dispatchEvent(s.drawingsChangeEvent),s.popDown()}for(var r=0;r<this.buttons.length;r++)this.buttons[r].addEventListener("click",popDownOnButtonClick)};return n.DrawingsPalette.prototype=Object.create(t.Palette.prototype,{setdrawings:{value:function(t){var e=document.createEvent("MouseEvents");e.initEvent("click",!0,!0),this.buttons[t].dispatchEvent(e)},enumerable:!0,configurable:!0,writable:!0},addEventListener:{value:function(t,e,n){return this.getPalette().addEventListener(t,e,n)},enumerable:!0,configurable:!0,writable:!0}}),n}));