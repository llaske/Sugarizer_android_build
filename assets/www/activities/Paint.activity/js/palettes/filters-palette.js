define(["sugar-web/graphics/palette","mustache"],(function(t,e){var a={};function onFilterSelect(t){switch(PaintApp.saveCanvas(),t.detail.filter){case"invert":!function canvasInvert(t){for(var e=t.getContext("2d"),a=e.getImageData(0,0,t.width,t.height),n=a.data,i=0,s=n.length;i<s;i+=4)n[i]=255-n[i],n[i+1]=255-n[i+1],n[i+2]=255-n[i+2];e.putImageData(a,0,0)}(PaintApp.elements.canvas);break;case"grayscale":!function canvasToGrayscale(t){for(var e=t.getContext("2d"),a=e.getImageData(0,0,t.width,t.height),n=a.data,i=0,s=n.length;i<s;i+=4){var r=.3*n[i]+.59*n[i+1]+.11*n[i+2];n[i]=r,n[i+1]=r,n[i+2]=r}e.putImageData(a,0,0)}(PaintApp.elements.canvas)}if(PaintApp.saveCanvas(),PaintApp.data.isShared)try{PaintApp.collaboration.sendMessage({action:"toDataURL",data:{width:PaintApp.elements.canvas.width/window.devicePixelRatio,height:PaintApp.elements.canvas.height/window.devicePixelRatio,src:PaintApp.collaboration.compress(PaintApp.elements.canvas.toDataURL())}})}catch(t){}}a.initGui=function initGui(){var t=document.getElementById("filters-button");new PaintApp.palettes.filtersPalette.FiltersPalette(t,void 0).addEventListener("filtersChange",onFilterSelect)},a.FiltersPalette=function(a,n){t.Palette.call(this,a,n),this.filtersChangeEvent=document.createEvent("CustomEvent"),this.filtersChangeEvent.initCustomEvent("filtersChange",!0,!0,{filters:"icons/size-1.svg"}),this.template='<tbody>{{#rows}}<tr>{{#.}}<td><button value="{{value}}" style="height:55px; width:55px; background-image: url({{ filters }}); background-repeat: no-repeat; background-position: center; "></button></td>{{/.}}</tr>{{/rows}}</tbody>';var i=document.createElement("table");i.className="filterss";i.innerHTML=e.render(this.template,{rows:[[{filters:"icons/effect-grayscale.svg",value:"grayscale"},{filters:"icons/invert-colors.svg",value:"invert"}]]}),this.setContent([i]),this.buttons=i.querySelectorAll("button");var s=this;function popDownOnButtonClick(t){s.filtersChangeEvent.detail.filter=t.target.value,s.getPalette().dispatchEvent(s.filtersChangeEvent),s.popDown()}for(var r=0;r<this.buttons.length;r++)this.buttons[r].addEventListener("click",popDownOnButtonClick)};return a.FiltersPalette.prototype=Object.create(t.Palette.prototype,{setfilters:{value:function(t){var e=document.createEvent("MouseEvents");e.initEvent("click",!0,!0),this.buttons[t].dispatchEvent(e)},enumerable:!0,configurable:!0,writable:!0},addEventListener:{value:function(t,e,a){return this.getPalette().addEventListener(t,e,a)},enumerable:!0,configurable:!0,writable:!0}}),a}));