/*! Sugarizer 2019-09-21 */
define(["sugar-web/graphics/journalchooser","sugar-web/datastore"],function(a,b){function c(){var a=document.getElementById("insertimage-button");PaintApp.elements.insertImageButton=a,a.addEventListener("click",d)}function d(){a.show(function(a){if(a){new b.DatastoreObject(a.objectId).loadAsText(function(a,b,c){var d=document.createElement("img");d.src=c,d.onload=function(){e=!0,f=!1;var a,b,c,g,h,i=PaintApp.elements.canvas.getContext("2d"),j=i.getImageData(0,0,PaintApp.elements.canvas.width,PaintApp.elements.canvas.height),k=!0,l="ontouchstart"in document.documentElement;i.putImageData(j,0,0),c=65,g=130,a=d.width,b=d.height,i.drawImage(d,c-60,g-125,a+60,b+70),h=i.getImageData(0,0,PaintApp.elements.canvas.width,PaintApp.elements.canvas.height),i.stroke(),PaintApp.saveCanvas(),i.beginPath(),i.setLineDash([1,10]),i.strokeStyle="#101010",i.rect(c-65,g-130,a+70,b+80),i.stroke();var m=function(m){(e||f)&&(k&&i.putImageData(j,0,0),l&&(m=m.touches[0]),e?(c=m.clientX-a/2,g=m.clientY-b/2):(a=m.clientX-c,b=m.clientY-g),i.drawImage(d,c-60,g-125,a+60,b+70),h=i.getImageData(0,0,PaintApp.elements.canvas.width,PaintApp.elements.canvas.height),i.beginPath(),i.setLineDash([1,10]),i.strokeStyle="#101010",i.rect(c-65,g-130,a+70,b+80),i.stroke())},n=function(a){e?(e=!1,f=!0):f&&(l&&(a=a.touches[0]),i.putImageData(h,0,0),i.setLineDash([1]),j=i.getImageData(0,0,PaintApp.elements.canvas.width,PaintApp.elements.canvas.height),PaintApp.saveCanvas(),i=0,e=!1,f=!1,l?(removeEventListener("touchmove",m),removeEventListener("touchend",n)):(removeEventListener("mousemove",m),removeEventListener("mouseup",n)))};if(l?(addEventListener("touchmove",m,!1),addEventListener("touchend",n,!1)):(addEventListener("mousemove",m),addEventListener("mouseup",n)),PaintApp.data.isShared)try{PaintApp.collaboration.sendMessage({action:"toDataURL",data:{width:PaintApp.elements.canvas.width/window.devicePixelRatio,height:PaintApp.elements.canvas.height/window.devicePixelRatio,src:PaintApp.collaboration.compress(PaintApp.elements.canvas.toDataURL())}})}catch(a){}}})}},{mimetype:"image/png"},{mimetype:"image/jpeg"})}var e=!1,f=!1;return{initGui:c}});