/*! Sugarizer 2020-03-14 */
define([],function(){function a(){function a(a){PaintApp.data.stamp=a.detail.stamp,PaintApp.data.stampBase=a.detail.stampBase,a.detail.proportionnal&&"true"===a.detail.proportionnal?PaintApp.data.stampProportionnal=!0:PaintApp.data.stampProportionnal=!1}PaintApp.elements.stampsButton=document.getElementById("stamps-button"),PaintApp.paletteModesButtons.push(PaintApp.elements.stampsButton),PaintApp.elements.stampsButton.addEventListener("click",function(){PaintApp.paletteRemoveActiveClass(),PaintApp.addActiveClassToElement(PaintApp.elements.stampsButton),PaintApp.switchMode("Stamp")});var b=new PaintApp.palettes.stampPalette.StampPalette(PaintApp.elements.stampsButton,void 0);b.addEventListener("stampChange",a);b.getPalette().querySelector(".palette-invoker");b.setStamp(0)}function b(a,b,c){var d=/<!ENTITY fill_color "(.*?)">/g,e=/<!ENTITY stroke_color "(.*?)">/g;return a=a.replace(d,'<!ENTITY fill_color "'+b+'">'),a=a.replace(e,'<!ENTITY stroke_color "'+c+'">')}return{initGui:a,changeColors:b,defaultSize:80,onMouseDown:function(a){return function(){PaintApp.modes.Stamp.releasedFinger=!1,PaintApp.handleCurrentFloatingElement();var c=PaintApp.modes.Stamp.defaultSize,d=PaintApp.modes.Stamp.defaultSize,e=a.point.x-c/2+"px",f=a.point.y+55-d/2+"px",g=window.location.href.split("/");g.pop(),g=g.join("/")+"/"+PaintApp.data.stamp;var h=(PaintApp.elements.canvas.getContext("2d"),a.point,new XMLHttpRequest);h.open("GET",g,!0),h.onload=function(a){if(200===h.status||0===h.status){var g=h.responseText;g=b(g,PaintApp.data.color.fill,PaintApp.data.color.stroke);var i=document.createElement("img");if(i.style.backgroundRepeat="no-repeat",i.style.backgroundSize="contain",i.src="data:image/svg+xml;base64,"+btoa(g),i.style.width=c+"px",i.style.height=d+"px",i.style.position="absolute",i.style.left=e,i.style.padding="0px",i.style.border="5px dotted #500",i.style.resize="both",i.style.top=f,document.body.appendChild(i),PaintApp.data.currentElement={type:"stamp",element:i,proportionnal:PaintApp.data.stampProportionnal,startPoint:{x:parseInt(i.style.left)+i.getBoundingClientRect().width/2,y:parseInt(i.style.top)+i.getBoundingClientRect().height/2}},PaintApp.modes.Stamp.releasedFinger){if(PaintApp.elements.canvas.getContext("2d").drawImage(PaintApp.data.currentElement.element,5+PaintApp.data.currentElement.element.getBoundingClientRect().left,PaintApp.data.currentElement.element.getBoundingClientRect().top-55+5),PaintApp.data.isShared){var j={stampBase:PaintApp.data.stampBase,color:{fill:PaintApp.data.color.fill,stroke:PaintApp.data.color.stroke},left:PaintApp.data.currentElement.element.getBoundingClientRect().left,top:PaintApp.data.currentElement.element.getBoundingClientRect().top-55+5,width:PaintApp.data.currentElement.element.getBoundingClientRect().width,height:PaintApp.data.currentElement.element.getBoundingClientRect().height};PaintApp.collaboration.sendMessage({action:"drawStamp",data:j})}PaintApp.data.currentElement.element.parentElement.removeChild(PaintApp.data.currentElement.element),PaintApp.data.currentElement=void 0,PaintApp.saveCanvas()}}},h.send(null)}()},onMouseDrag:function(a){if(PaintApp.data.currentElement){var b=Math.abs(a.point.x-PaintApp.data.currentElement.startPoint.x),c=Math.abs(a.point.y-PaintApp.data.currentElement.startPoint.y+55);distance=b>c?b:c,PaintApp.data.stampProportionnal?(PaintApp.data.currentElement.element.style.width=PaintApp.modes.Stamp.defaultSize+distance+"px",PaintApp.data.currentElement.element.style.height=PaintApp.modes.Stamp.defaultSize+distance+"px"):(PaintApp.data.currentElement.element.style.width=PaintApp.modes.Stamp.defaultSize+b+"px",PaintApp.data.currentElement.element.style.height=PaintApp.modes.Stamp.defaultSize+c+"px"),PaintApp.data.currentElement.element.style.left=PaintApp.data.currentElement.startPoint.x-PaintApp.data.currentElement.element.getBoundingClientRect().width/2+"px",PaintApp.data.currentElement.element.style.top=PaintApp.data.currentElement.startPoint.y-PaintApp.data.currentElement.element.getBoundingClientRect().height/2+"px"}},onMouseUp:function(a){if(PaintApp.modes.Stamp.releasedFinger=!0,PaintApp.data.currentElement){if(PaintApp.elements.canvas.getContext("2d").drawImage(PaintApp.data.currentElement.element,PaintApp.data.currentElement.element.getBoundingClientRect().left,PaintApp.data.currentElement.element.getBoundingClientRect().top-55,PaintApp.data.currentElement.element.getBoundingClientRect().width,PaintApp.data.currentElement.element.getBoundingClientRect().height),PaintApp.data.isShared){var b={stampBase:PaintApp.data.stampBase,color:{fill:PaintApp.data.color.fill,stroke:PaintApp.data.color.stroke},left:PaintApp.data.currentElement.element.getBoundingClientRect().left,top:PaintApp.data.currentElement.element.getBoundingClientRect().top-55,width:PaintApp.data.currentElement.element.getBoundingClientRect().width,height:PaintApp.data.currentElement.element.getBoundingClientRect().height};PaintApp.collaboration.sendMessage({action:"drawStamp",data:b})}PaintApp.data.currentElement.element.parentElement.removeChild(PaintApp.data.currentElement.element),PaintApp.data.currentElement=void 0,PaintApp.saveCanvas()}}}});