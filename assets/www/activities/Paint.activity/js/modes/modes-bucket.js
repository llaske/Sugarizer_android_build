/*! Sugarizer 2020-03-14 */
define([],function(){function a(){PaintApp.elements.bucketButton=document.getElementById("bucket-button"),PaintApp.paletteModesButtons.push(PaintApp.elements.bucketButton),PaintApp.elements.bucketButton.addEventListener("click",function(){PaintApp.paletteRemoveActiveClass(),PaintApp.addActiveClassToElement(PaintApp.elements.bucketButton),PaintApp.switchMode("Bucket")})}function b(a,b,e,f,g,h,i){var j,k,l=f.getImageData(0,0,g,h),m=l.data,n=m.length,o=[],p=4*(a+b*g),q=p,r=p,s=4*g,t=[m[p],m[p+1],m[p+2],m[p+3]],u=m[p]+m[p+1]+m[p+2]+m[p+3];if(!c(p,t,u,e,m,n,i))return!1;for(o.push(p);o.length;)if(p=o.pop(),d(p,t,u,e,m,n,i)){for(q=p,r=p,k=parseInt(p/s)*s,j=k+s;k<(r-=4)&&d(r,t,u,e,m,n,i););for(;j>(q+=4)&&d(q,t,u,e,m,n,i););for(var v=r;v<q;v+=4)v-s>=0&&c(v-s,t,u,e,m,n,i)&&o.push(v-s),v+s<n&&c(v+s,t,u,e,m,n,i)&&o.push(v+s)}f.putImageData(l,0,0)}function c(a,b,c,d,e,f,g){return!(a<0||a>=f)&&(0===e[a+3]||(b[3]!==d.a||b[0]!==d.r||b[1]!==d.g||b[2]!==d.b)&&(b[3]===e[a+3]&&b[0]===e[a]&&b[1]===e[a+1]&&b[2]===e[a+2]||Math.abs(b[3]-e[a+3])<=255-g&&Math.abs(b[0]-e[a])<=g&&Math.abs(b[1]-e[a+1])<=g&&Math.abs(b[2]-e[a+2])<=g))}function d(a,b,d,e,f,g,h){return!!c(a,b,d,e,f,g,h)&&(f[a]=e.r,f[a+1]=e.g,f[a+2]=e.b,f[a+3]=255,!0)}return{initGui:a,lock:!1,onMouseDown:function(a){if(!PaintApp.modes.Bucket.lock){var c=PaintApp.elements.canvas.getContext("2d"),d=PaintApp.data.color.fill.slice(4,-1).split(","),e=[parseInt(d[0]),parseInt(d[1]),parseInt(d[2]),0],f=(e.map(function(a){return a=parseInt(a).toString(16),1==a.length?"0"+a:a}),{a:1,r:parseInt(e[0]),g:parseInt(e[1]),b:parseInt(e[2])}),g=c.getImageData(a.point.x*window.devicePixelRatio,a.point.y*window.devicePixelRatio,1,1).data;if(Math.abs(g[0]-f.r)<=10&&Math.abs(g[1]-f.g)<=10&&Math.abs(g[2]-f.b)<=10)return void(PaintApp.modes.Bucket.lock=!1);if(b(parseInt(a.point.x*window.devicePixelRatio),parseInt(a.point.y*window.devicePixelRatio),f,c,c.canvas.width,c.canvas.height,5),PaintApp.saveCanvas(),PaintApp.modes.Bucket.lock=!1,PaintApp.data.isShared)try{PaintApp.collaboration.sendMessage({action:"toDataURL",data:{width:PaintApp.elements.canvas.width/window.devicePixelRatio,height:PaintApp.elements.canvas.height/window.devicePixelRatio,src:PaintApp.collaboration.compress(PaintApp.elements.canvas.toDataURL())}})}catch(a){}}},onMouseDrag:function(a){},onMouseUp:function(a){}}});