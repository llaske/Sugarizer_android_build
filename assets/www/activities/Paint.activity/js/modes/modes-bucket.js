define([],(function(){function pixelCompare(t,e,a,n,i,p,o){return!(t<0||t>=p)&&(0===i[t+3]||(e[3]!==n.a||e[0]!==n.r||e[1]!==n.g||e[2]!==n.b)&&(e[3]===i[t+3]&&e[0]===i[t]&&e[1]===i[t+1]&&e[2]===i[t+2]||Math.abs(e[3]-i[t+3])<=255-o&&Math.abs(e[0]-i[t])<=o&&Math.abs(e[1]-i[t+1])<=o&&Math.abs(e[2]-i[t+2])<=o))}function pixelCompareAndSet(t,e,a,n,i,p,o){return!!pixelCompare(t,e,0,n,i,p,o)&&(i[t]=n.r,i[t+1]=n.g,i[t+2]=n.b,i[t+3]=255,!0)}return{initGui:function initGui(){PaintApp.elements.bucketButton=document.getElementById("bucket-button"),PaintApp.paletteModesButtons.push(PaintApp.elements.bucketButton),PaintApp.elements.bucketButton.addEventListener("click",(function(){PaintApp.paletteRemoveActiveClass(),PaintApp.addActiveClassToElement(PaintApp.elements.bucketButton),PaintApp.switchMode("Bucket")}))},lock:!1,onMouseDown:function(t){if(!PaintApp.modes.Bucket.lock){var e=PaintApp.elements.canvas.getContext("2d"),a=PaintApp.data.color.fill.slice(4,-1).split(","),n=[parseInt(a[0]),parseInt(a[1]),parseInt(a[2]),0],i=(n.map((function(t){return 1==(t=parseInt(t).toString(16)).length?"0"+t:t})),{a:1,r:parseInt(n[0]),g:parseInt(n[1]),b:parseInt(n[2])}),p=e.getImageData(t.point.x*window.devicePixelRatio,t.point.y*window.devicePixelRatio,1,1).data;if(Math.abs(p[0]-i.r)<=10&&Math.abs(p[1]-i.g)<=10&&Math.abs(p[2]-i.b)<=10)PaintApp.modes.Bucket.lock=!1;else if(function floodfill(t,e,a,n,i,p,o){var s,c,l=n.getImageData(0,0,i,p),r=l.data,u=r.length,d=[],m=4*(t+e*i),h=m,A=m,P=4*i,f=[r[m],r[m+1],r[m+2],r[m+3]],v=r[m]+r[m+1]+r[m+2]+r[m+3];if(!pixelCompare(m,f,v,a,r,u,o))return!1;for(d.push(m);d.length;)if(pixelCompareAndSet(m=d.pop(),f,v,a,r,u,o)){for(h=m,A=m,s=(c=parseInt(m/P)*P)+P;c<(A-=4)&&pixelCompareAndSet(A,f,v,a,r,u,o););for(;s>(h+=4)&&pixelCompareAndSet(h,f,v,a,r,u,o););for(var g=A;g<h;g+=4)g-P>=0&&pixelCompare(g-P,f,v,a,r,u,o)&&d.push(g-P),g+P<u&&pixelCompare(g+P,f,v,a,r,u,o)&&d.push(g+P)}n.putImageData(l,0,0)}(parseInt(t.point.x*window.devicePixelRatio),parseInt(t.point.y*window.devicePixelRatio),i,e,e.canvas.width,e.canvas.height,5),PaintApp.saveCanvas(),PaintApp.modes.Bucket.lock=!1,PaintApp.data.isShared)try{PaintApp.collaboration.sendMessage({action:"toDataURL",data:{width:PaintApp.elements.canvas.width/window.devicePixelRatio,height:PaintApp.elements.canvas.height/window.devicePixelRatio,src:PaintApp.collaboration.compress(PaintApp.elements.canvas.toDataURL())}})}catch(t){}}},onMouseDrag:function(t){},onMouseUp:function(t){}}}));