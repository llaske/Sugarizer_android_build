function encode64(t){for(var r,n,i,o,f,a,c,y="",w=0,s=t.length,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";w<s;)o=(r=t.charCodeAt(w++))>>2,f=(3&r)<<4|(n=t.charCodeAt(w++))>>4,a=(15&n)<<2|(i=t.charCodeAt(w++))>>6,c=63&i,isNaN(n)?a=c=64:isNaN(i)&&(c=64),y=y+l.charAt(o)+l.charAt(f)+l.charAt(a)+l.charAt(c);return y}LZWEncoder=function(){var t,r,n,i,o,f,a,c,y,w,s,l,B={},v=-1,p=12,g=5003,A=p,m=1<<p,F=[],N=[],C=g,E=0,T=!1,D=0,Q=0,I=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],L=[],M=B.LZWEncoder=function lt(o,f,a,c){t=o,r=f,n=a,i=Math.max(2,c)},nt=function(t,r){L[l++]=t,l>=254&&S(r)},at=function(t){tt(C),E=w+2,T=!0,e(w,t)},tt=function(t){for(var r=0;r<t;++r)F[r]=-1},P=B.compress=function yt(t,r){var n,i,o,f,B,p,g;for(T=!1,c=b(a=y=t),s=(w=1<<t-1)+1,E=w+2,l=0,f=d(),g=0,n=C;n<65536;n*=2)++g;g=8-g,tt(p=C),e(w,r);t:for(;(o=d())!=v;)if(n=(o<<A)+f,F[i=o<<g^f]!=n){if(F[i]>=0){B=p-i,0==i&&(B=1);do{if((i-=B)<0&&(i+=p),F[i]==n){f=N[i];continue t}}while(F[i]>=0)}e(f,r),f=o,E<m?(N[i]=E++,F[i]=n):at(r)}else f=N[i];e(f,r),e(s,r)},S=(B.encode=function(n){n.writeByte(i),o=t*r,f=0,P(i+1,n),n.writeByte(0)},function(t){l>0&&(t.writeByte(l),t.writeBytes(L,0,l),l=0)}),b=function(t){return(1<<t)-1},d=function(){return 0==o?v:(--o,255&n[f++])},e=function(t,r){for(D&=I[Q],Q>0?D|=t<<Q:D=t,Q+=a;Q>=8;)nt(255&D,r),D>>=8,Q-=8;if((E>c||T)&&(T?(c=b(a=y),T=!1):(++a,c=a==A?m:b(a))),t==s){for(;Q>0;)nt(255&D,r),D>>=8,Q-=8;S(r)}};return M.apply(this,arguments),B},NeuQuant=function(){var t,r,n,i,o,f={},a=256,c=499,y=491,w=487,s=503,l=3*s,B=a-1,v=4,p=100,g=16,A=1<<g,m=10,F=10,N=A>>F,C=A<<m-F,E=a>>3,T=6,D=1<<T,Q=E*D,I=30,L=10,M=1<<L,P=8,S=1<<P,U=L+P,W=1<<U,Z=[],G=[],R=[],x=[],z=f.NeuQuant=function ht(t,f,c){var y,w;for(r=t,n=f,i=c,o=new Array(a),y=0;y<a;y++)o[y]=new Array(4),(w=o[y])[0]=w[1]=w[2]=(y<<v+8)/a,R[y]=A/a,G[y]=0},ot=function(){for(var t,r,n,i=[],f=new Array(a),c=0;c<a;c++)f[o[c][3]]=c;for(t=0,r=0;r<a;r++)n=f[r],i[t++]=o[n][0],i[t++]=o[n][1],i[t++]=o[n][2];return i},ct=function(){var t,r,n,i,f,c,y,w;for(y=0,w=0,t=0;t<a;t++){for(n=t,i=(f=o[t])[1],r=t+1;r<a;r++)(c=o[r])[1]<i&&(n=r,i=c[1]);if(c=o[n],t!=n&&(r=c[0],c[0]=f[0],f[0]=r,r=c[1],c[1]=f[1],f[1]=r,r=c[2],c[2]=f[2],f[2]=r,r=c[3],c[3]=f[3],f[3]=r),i!=y){for(Z[y]=w+t>>1,r=y+1;r<i;r++)Z[r]=t;y=i,w=t}}for(Z[y]=w+B>>1,r=y+1;r<256;r++)Z[r]=B},vt=function(){var o,f,a,B,g,A,m,F,N,C,E,D,L,P;for(n<l&&(i=1),t=30+(i-1)/3,D=r,L=0,P=n,C=(E=n/(3*i))/p|0,F=M,(m=(A=Q)>>T)<=1&&(m=0),o=0;o<m;o++)x[o]=F*((m*m-o*o)*S/(m*m));for(N=n<l?3:n%c!=0?3*c:n%y!=0?3*y:n%w!=0?3*w:3*s,o=0;o<E;)if(a=(255&D[L+0])<<v,B=(255&D[L+1])<<v,g=(255&D[L+2])<<v,f=yt(a,B,g),at(F,f,a,B,g),0!=m&&lt(m,f,a,B,g),(L+=N)>=P&&(L-=n),0==C&&(C=1),++o%C==0)for(F-=F/t,(m=(A-=A/I)>>T)<=1&&(m=0),f=0;f<m;f++)x[f]=F*((m*m-f*f)*S/(m*m))},j=(f.map=function(t,r,n){var i,f,c,y,w,s,l;for(w=1e3,l=-1,f=(i=Z[r])-1;i<a||f>=0;)i<a&&((c=(s=o[i])[1]-r)>=w?i=a:(i++,c<0&&(c=-c),(y=s[0]-t)<0&&(y=-y),(c+=y)<w&&((y=s[2]-n)<0&&(y=-y),(c+=y)<w&&(w=c,l=s[3])))),f>=0&&((c=r-(s=o[f])[1])>=w?f=-1:(f--,c<0&&(c=-c),(y=s[0]-t)<0&&(y=-y),(c+=y)<w&&((y=s[2]-n)<0&&(y=-y),(c+=y)<w&&(w=c,l=s[3]))));return l},f.process=function(){return vt(),j(),ct(),ot()},function(){for(var t=0;t<a;t++)o[t][0]>>=v,o[t][1]>>=v,o[t][2]>>=v,o[t][3]=t}),lt=function(t,r,n,i,f){var c,y,w,s,l,B,v;for((w=r-t)<-1&&(w=-1),(s=r+t)>a&&(s=a),c=r+1,y=r-1,B=1;c<s||y>w;){if(l=x[B++],c<s){v=o[c++];try{v[0]-=l*(v[0]-n)/W,v[1]-=l*(v[1]-i)/W,v[2]-=l*(v[2]-f)/W}catch(t){}}if(y>w){v=o[y--];try{v[0]-=l*(v[0]-n)/W,v[1]-=l*(v[1]-i)/W,v[2]-=l*(v[2]-f)/W}catch(t){}}}},at=function(t,r,n,i,f){var a=o[r];a[0]-=t*(a[0]-n)/M,a[1]-=t*(a[1]-i)/M,a[2]-=t*(a[2]-f)/M},yt=function(t,r,n){var i,f,c,y,w,s,l,B,p,A;for(p=B=2147483647,l=s=-1,i=0;i<a;i++)(f=(A=o[i])[0]-t)<0&&(f=-f),(c=A[1]-r)<0&&(c=-c),f+=c,(c=A[2]-n)<0&&(c=-c),(f+=c)<B&&(B=f,s=i),(y=f-(G[i]>>g-v))<p&&(p=y,l=i),w=R[i]>>F,R[i]-=w,G[i]+=w<<m;return R[s]+=N,G[s]-=C,l};return z.apply(this,arguments),f},GIFEncoder=function(){function h(){this.bin=[]}for(var t=0,r={};t<256;t++)r[t]=String.fromCharCode(t);h.prototype.getData=function(){for(var t="",n=this.bin.length,i=0;i<n;i++)t+=r[this.bin[i]];return t},h.prototype.writeByte=function(t){this.bin.push(t)},h.prototype.writeUTFBytes=function(t){for(var r=t.length,n=0;n<r;n++)this.writeByte(t.charCodeAt(n))},h.prototype.writeBytes=function(t,r,n){for(var i=n||t.length,o=r||0;o<i;o++)this.writeByte(t[o])};var n,i,o,f,a,c,y,w,s,l={},B=null,v=-1,p=0,g=!1,A=[],m=7,F=-1,N=!0,C=!1,E=10,T=(l.setDelay=function(t){p=Math.round(t/10)},l.setDispose=function(t){t>=0&&(F=t)},l.setRepeat=function(t){t>=0&&(v=t)},l.setTransparent=function(t){B=t},l.addFrame=function(t,r){if(null==t||!g||null==f)throw new Error("Please call start method before calling addFrame");var n=!0;try{r?a=t:(a=t.getImageData(0,0,t.canvas.width,t.canvas.height).data,C||D(t.canvas.width,t.canvas.height)),ct(),Q(),N&&(vt(),tt(),v>=0&&lt()),st(),ot(),N||tt(),at(),N=!1}catch(t){n=!1}return n},l.finish=function(){if(!g)return!1;var t=!0;g=!1;try{f.writeByte(59)}catch(r){t=!1}return t},function(){o=0,a=null,c=null,y=null,s=null,!1,N=!0}),D=(l.setFrameRate=function(t){15!=t&&(p=Math.round(100/t))},l.setQuality=function(t){t<1&&(t=1),E=t},l.setSize=function et(t,r){(!g||N)&&((n=t)<1&&(n=320),(i=r)<1&&(i=240),C=!0)}),Q=(l.start=function(){T();var t=!0;!1,f=new h;try{f.writeUTFBytes("GIF89a")}catch(r){t=!1}return g=t},l.cont=function(){T();return!1,f=new h,g=!0},function(){var t,r,n,i,f=c.length,a=f/3;for(y=[],t=new NeuQuant(c,f,E),s=t.process(),r=0,n=0;n<a;n++)i=t.map(255&c[r++],255&c[r++],255&c[r++]),A[i]=!0,y[n]=i;c=null,w=8,m=7,null!=B&&(o=yt(B))}),yt=function(t){var r;if(null==s)return-1;var n=(16711680&t)>>16,i=(65280&t)>>8,o=255&t,f=0,a=16777216,c=s.length;for(r=0;r<c;){var y=n-(255&s[r++]),w=i-(255&s[r++]),l=o-(255&s[r]),B=y*y+w*w+l*l,v=r/3;A[v]&&B<a&&(a=B,f=v),r++}return f},ct=function(){var t,r,o,f,y,w=n,s=i;for(c=[],t=a,r=0,o=0;o<s;o++)for(f=0;f<w;f++)y=o*w*4+4*f,c[r++]=t[y],c[r++]=t[y+1],c[r++]=t[y+2]},st=function(){var t,r;f.writeByte(33),f.writeByte(249),f.writeByte(4),null==B?(t=0,r=0):(t=1,r=2),F>=0&&(r=7&F),r<<=2,f.writeByte(0|r|t),u(p),f.writeByte(o),f.writeByte(0)},ot=function(){f.writeByte(44),u(0),u(0),u(n),u(i),N?f.writeByte(0):f.writeByte(128|m)},vt=function(){u(n),u(i),f.writeByte(240|m),f.writeByte(0),f.writeByte(0)},lt=function(){f.writeByte(33),f.writeByte(255),f.writeByte(11),f.writeUTFBytes("NETSCAPE2.0"),f.writeByte(3),f.writeByte(1),u(v),f.writeByte(0)},tt=function(){var t,r;for(f.writeBytes(s),t=768-s.length,r=0;r<t;r++)f.writeByte(0)},u=function(t){f.writeByte(255&t),f.writeByte(t>>8&255)},at=function(){new LZWEncoder(n,i,y,w).encode(f)};l.stream=function(){return f},l.setProperties=function(t,r){g=t,N=r};return l};