/*! Sugarizer 2020-03-14 */
define(["sugar-web/activity/activity","mustache","sugar-web/env","tutorial","webL10n"],function(a,b,c,d,e){requirejs(["domReady!"],function(d){function f(a,b,c){return c=c||"0",b=b||2,a+="",a.length>=b?a:new Array(b-a.length+1).join(c)+a}function g(a,c){this.elem=document.createElement("li"),document.getElementById("stopwatch-list").appendChild(this.elem);var d=document.getElementsByTagName("li").length;this.template='<div class="card-body"><div class="row" id="'+d+'"><div class="col-sm-2 col-md-2 col-lg-2 d-flex justify-content-center align-items-center"><div class="counter">00:00:00</div></div><div class="col-sm-4 col-md-4 col-lg-4 d-flex justify-content-center align-items-center"><div class="buttons-group"><button class="start-stop-button start" title="Start"></button><button class="reset-button" title="Reset"></button><button class="mark-button" title="Mark"></button></div></div><div class="col-sm-5 col-md-5 col-lg-5 d-flex align-items-center justify-content-center"><div class="marks"></div></div><div class="col-sm-1 col-md-1 col-lg-1 d-flex justify-content-center align-items-center p-0"><button class ="remove" title="Remove"></button></div></div></div>',this.elem.innerHTML=b.render(this.template,{}),this.counterElem=this.elem.querySelector(".counter"),this.marksElem=this.elem.querySelector(".marks"),this.running=!1,this.previousTime=Date.now(),this.tenthsOfSecond=0,this.seconds=0,this.minutes=0,c?(this.marks=c,this.updateMarks()):this.marks=[],a&&(this.minutes=parseInt(a.split(":")[0]),this.seconds=parseInt(a.split(":")[1]),this.tenthsOfSecond=parseInt(a.split(":")[2]),this.updateView());var e=this;this.startStopButton=this.elem.querySelector(".start-stop-button"),this.startStopButton.onclick=function(){e.onStartStopClicked()},this.resetButton=this.elem.querySelector(".reset-button"),this.resetButton.onclick=function(){e.onResetClicked()},this.markButton=this.elem.querySelector(".mark-button"),this.markButton.onclick=function(){e.onMarkClicked()},this.removeButton=this.elem.querySelector(".remove"),this.removeButton.onclick=function(){e.onRemoveClicked()}}a.setup();var h=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;g.prototype.onStartStopClicked=function(){this.running?(this.running=!1,this.startStopButton.title="Start",this.resetButton=this.elem.querySelector(".reset-button"),this.resetButton.disabled=!1):(this.running=!0,this.tick(),this.startStopButton=this.elem.querySelector(".start-stop-button"),this.startStopButton.title="Stop",this.resetButton=this.elem.querySelector(".reset-button"),this.resetButton.disabled=!0),this.updateButtons()},g.prototype.onResetClicked=function(){this.tenthsOfSecond=0,this.seconds=0,this.minutes=0,this.running?this.onStartStopClicked():this.running=!1,this.updateView(),this.onClearMarksClicked()},g.prototype.onMarkClicked=function(){this.marks.length>=10&&this.marks.shift(),0==f(this.minutes)&&0==f(this.seconds)&&0==f(this.tenthsOfSecond)||this.marks.push(f(this.minutes)+":"+f(this.seconds)+":"+f(this.tenthsOfSecond)),this.updateMarks()},g.prototype.onClearMarksClicked=function(){this.marks=[],this.updateMarks()},g.prototype.onRemoveClicked=function(){document.getElementById("stopwatch-list").removeChild(this.elem)},g.prototype.tick=function(){if(this.running){var a=Date.now();a-this.previousTime>100&&(this.previousTime=a,this.update(),this.updateView()),h(this.tick.bind(this))}},g.prototype.update=function(){this.tenthsOfSecond+=1,10==this.tenthsOfSecond&&(this.tenthsOfSecond=0,this.seconds+=1),60==this.seconds&&(this.seconds=0,this.minutes+=1)},g.prototype.updateView=function(){this.counterElem.innerHTML=f(this.minutes)+":"+f(this.seconds)+":"+f(this.tenthsOfSecond)},g.prototype.updateMarks=function(){this.marksElem.innerHTML="";for(var a=0;a<this.marks.length;a++)this.marksElem.innerHTML+=this.marks[a],a!==this.marks.length-1&&(this.marksElem.innerHTML+=" - ")},g.prototype.updateButtons=function(){this.running?(this.startStopButton.classList.add("stop"),this.startStopButton.classList.remove("start")):(this.startStopButton.classList.add("start"),this.startStopButton.classList.remove("stop"))},document.getElementById("add-stopwatch").onclick=function(){new g},c.getEnvironment(function(b,c){currentenv=c;var d="undefined"!=typeof chrome&&chrome.app&&chrome.app.runtime?chrome.i18n.getUILanguage():navigator.language,f=c.user?c.user.language:d;if(e.language.code=f,c.objectId)a.getDatastoreObject().loadAsText(function(a,b,c){if(null==a&&null!=c){stopwatchData=JSON.parse(c);var d;for(d=0;d<Object.keys(stopwatchData).length;d++)counter=stopwatchData[d].counter,marks=stopwatchData[d].marks,new g(counter,marks)}});else for(var h=0;h<5;h++)new g})}),document.getElementById("stop-button").addEventListener("click",function(b){var c=document.getElementById("stopwatch-list").getElementsByTagName("li");stopwatchDict={};var d;for(d=0;d<c.length;d++)stopwatchDict[d]={},stopwatchDict[d].counter=c[d].getElementsByClassName("counter")[0].innerHTML,stopwatchDict[d].marks=c[d].getElementsByClassName("marks")[0].innerHTML.split(" - ");stopwatchJSON=JSON.stringify(stopwatchDict),a.getDatastoreObject().setDataAsText(stopwatchJSON),a.getDatastoreObject().save()}),document.getElementById("fullscreen-button").addEventListener("click",function(){document.getElementById("main-toolbar").style.display="none",document.getElementById("canvas").style.top="0px",document.getElementById("unfullscreen-button").style.visibility="visible"}),document.getElementById("unfullscreen-button").addEventListener("click",function(){document.getElementById("main-toolbar").style.display="block",document.getElementById("canvas").style.top="55px",document.getElementById("unfullscreen-button").style.visibility="hidden"}),document.getElementById("help-button").addEventListener("click",function(a){d.start()})});