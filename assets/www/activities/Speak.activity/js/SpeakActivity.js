/*! Sugarizer 2020-03-14 */
define(["sugar-web/graphics/palette","sugar-web/env","webL10n","sugar-web/datastore","sugar-web/activity/activity"],function(a,b,c,d,e){function f(){K=!0,clearInterval(A),A=setInterval(function(){K=!1;var a=document.getElementById("speaklang").innerHTML,b=c.get("Sleepy");R.playVoice(a,b),clearInterval(A)},12e4)}function g(){R=Speech(),b.getEnvironment(function(a,b){var d="undefined"!=typeof chrome&&chrome.app&&chrome.app.runtime?chrome.i18n.getUILanguage():navigator.language;b.user||(b.user={language:d}),S=b.user,R.init(S),M||document.captureEvents(Event.MOUSEMOVE),setInterval(function(){u()},1e3/30),window.addEventListener("localized",function(){if(T)return c.language.code=S.language,void(T=!1);w();var a=window.setTimeout(function(){window.clearTimeout(a);var b=document.getElementById("speaklang").innerHTML,d=c.get("TypeSomething",{name:S.name});document.getElementById("combo-box").title=c.get("SavedTalk"),document.getElementsByClassName("dropdown").title=c.get("SavedTalk"),R.playVoice(b,d),s(d)},100)})}),f()}function h(){for(var a=document.getElementsByClassName("palette"),b=0;b<a.length;b++)a[b].style.visibility="hidden"}function i(a){var b,c=x.getBoundingClientRect(),d=c.width-c.width/4.5,e=c.height,f=c.width/2,g=d*a/5/(a-1);if(a%2==0){for(b=0;b<Math.floor(a/2);b++)G[b+1].x=f-g/2-(Math.floor(a/2)-b-1)*g,G[b+1].y=D+e/3;for(b=0;b<Math.floor(a/2);b++)G[b+Math.floor(a/2)+1].x=f+g/2+b*g,G[b+Math.floor(a/2)+1].y=D+e/3}if(a%2==1){for(G[1].x=f,G[1].y=D+e/3,b=0;b<Math.floor(a/2);b++)G[b+2].x=f-(Math.floor(a/2)-b)*g,G[b+2].y=D+e/3;for(b=0;b<Math.floor(a/2);b++)G[b+Math.floor(a/2)+2].x=f+(b+1)*g,G[b+Math.floor(a/2)+2].y=D+e/3}}function j(a,b){var c=a.getBoundingClientRect();N=(b.clientX-c.left)*a.width/c.width,O=(b.clientY-c.top)*a.height/c.height}function k(){if(K){var a,b=document.getElementById("eyetype").innerHTML;for(a=1;a<=J;a++){if(y.beginPath(),y.fillStyle="#000000",1==b)y.arc(G[a].x,G[a].y,1.1*E,0,2*Math.PI),y.fill();else{var c=1.1*E;y.fillRect(G[a].x-c,G[a].y-c,2*c,2*c)}y.closePath()}for(a=1;a<=J;a++){if(y.beginPath(),y.fillStyle="#FFFFFF",1==b)y.arc(G[a].x,G[a].y,E,0,2*Math.PI),y.fill();else{var c=E;y.fillRect(G[a].x-c,G[a].y-c,2*c,2*c)}y.closePath()}}else for(a=1;a<=J;a++){var a;y.beginPath(),y.arc(G[a].x,G[a].y,1.1*E,.4,Math.PI-.4),y.lineWidth=20,y.stroke(),y.closePath()}}function l(a){var b,c;-1==N&&-1==O?(b=0,c=0):(b=N-G[a].x,c=O-G[a].y);var d=1,e=1;b<0&&(d=-1),c<0&&(e=-1);var f=Math.atan(Math.abs(c/b));return isNaN(f)&&(f=0),{x:d*Math.min((E-F)*Math.cos(f),Math.abs(b)),y:e*Math.min((E-F)*Math.sin(f),Math.abs(c))}}function m(){if(K){var a;for(a=1;a<=J;a++)y.beginPath(),y.fillStyle="#000000",y.arc(G[a].x+l(a).x,G[a].y+l(a).y,F,0,2*Math.PI),y.fill(),y.closePath()}}function n(){document.getElementById("chat").style.display="block"}function o(){document.getElementById("chat").style.display="none"}function p(){var a=document.getElementById("userText").value,b=document.getElementById("chatbox"),c=document.createElement("li");c.style.borderRadius="10px",c.style.backgroundColor="#999999",c.style.listStyleType="none",c.style.padding="15px",c.style.margin="-15px",c.appendChild(document.createTextNode(a)),b.appendChild(c)}function q(a){"0"==document.getElementById("speaking").innerHTML&&(clearInterval(L),P=0);var b=a/70+1;b=Math.min(4,b),b=Math.max(1,b),1==Q?(P-=b)<-40&&(Q=2):2==Q&&(P+=b)>40&&(Q=1)}function r(){var a=document.getElementById("rate").innerHTML;document.getElementById("speaking").innerHTML=1,L=setInterval(function(){q(a)},10)}function s(a){""!=a&&("2"==document.getElementById("mode").innerHTML?setTimeout(function(){r()},4e3):r())}function t(){y.beginPath(),y.moveTo(H.x,H.y),y.bezierCurveTo(H.x+100,H.y+P,I.x-100,I.y+P,I.x,I.y),y.lineWidth=10,y.stroke(),y.closePath(),y.beginPath(),y.moveTo(H.x,H.y),y.bezierCurveTo(H.x+100,H.y-P,I.x-100,I.y-P,I.x,I.y),y.lineWidth=10,y.stroke(),y.closePath()}function u(){v(),J=parseInt(document.getElementById("numeyes").innerHTML),i(J),k(),m(),t()}function v(){y.clearRect(0,0,x.width,x.height),y.beginPath(),y.rect(0,0,x.width,x.height),y.fillStyle=z.fill,y.fill()}function w(){document.getElementById("gamemode1-button").title=c.get("TypeSomethingToHear"),document.getElementById("gamemode2-button").title=c.get("AskRobot"),document.getElementById("gamemode3-button").title=c.get("VoiceChat"),document.getElementById("language-button").title=c.get("Language"),document.getElementById("speech-button").title=c.get("Speech"),document.getElementById("face-button").title=c.get("Face"),document.getElementById("ratelabel").innerHTML=c.get("ratelabel"),document.getElementById("pitchlabel").innerHTML=c.get("pitchlabel"),document.getElementById("eyesnumber").innerHTML=c.get("eyesnumber"),document.getElementById("eyes").title=c.get("eyes"),document.getElementById("glasses").title=c.get("glasses"),document.getElementById("speakText").title=c.get("speak"),document.getElementById("lang-en").innerHTML=c.get("langen"),document.getElementById("lang-ca").innerHTML=c.get("langca"),document.getElementById("lang-cs").innerHTML=c.get("langcs"),document.getElementById("lang-de").innerHTML=c.get("langde"),document.getElementById("lang-el").innerHTML=c.get("langel"),document.getElementById("lang-eo").innerHTML=c.get("langeo"),document.getElementById("lang-es").innerHTML=c.get("langes"),document.getElementById("lang-fi").innerHTML=c.get("langfi"),document.getElementById("lang-fr").innerHTML=c.get("langfr"),document.getElementById("lang-hu").innerHTML=c.get("langhu"),document.getElementById("lang-it").innerHTML=c.get("langit"),document.getElementById("lang-kn").innerHTML=c.get("langkn"),document.getElementById("lang-la").innerHTML=c.get("langla"),document.getElementById("lang-lv").innerHTML=c.get("langlv"),document.getElementById("lang-nl").innerHTML=c.get("langnl"),document.getElementById("lang-pl").innerHTML=c.get("langpl"),document.getElementById("lang-pt").innerHTML=c.get("langpt"),document.getElementById("lang-ro").innerHTML=c.get("langro"),document.getElementById("lang-sk").innerHTML=c.get("langsk"),document.getElementById("lang-sv").innerHTML=c.get("langsv"),document.getElementById("lang-tr").innerHTML=c.get("langtr"),document.getElementById("lang-zh").innerHTML=c.get("langzh")}var x=document.getElementById("canvas"),y=x.getContext("2d");x.width=window.innerWidth,x.height=window.innerHeight-55;var z,A,B=x.getBoundingClientRect().width,C=x.getBoundingClientRect().height,D=45,E=Math.min(B,C)/6.5,F=Math.min(B,C)/28,G=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],H={x:1.35*B/4,y:D+2*C/3},I={x:2.65*B/4,y:D+2*C/3},J=2,K=!0;e.getXOColor(function(a,b){z=b}),$(window).resize(function(){x.width=window.innerWidth,x.height=window.innerHeight-55,B=x.getBoundingClientRect().width,C=x.getBoundingClientRect().height,H={x:1.35*B/4,y:D+2*C/3},I={x:2.65*B/4,y:D+2*C/3},E=Math.min(B,C)/6.5,F=Math.min(B,C)/28,i()}),x.addEventListener("mousemove",function(a){j(x,a)},!1);var L,M=!!document.all,N=-1,O=-1,P=0,Q=1,R=null,S={},T=!0;document.getElementById("userArea").onmouseup=function(a){h()},document.getElementById("speakText").onmousedown=function(a){var b=document.getElementById("speaklang").innerHTML,c=document.getElementById("userText").value;R.playVoice(b,c),f()},document.getElementById("speakText").onmouseup=function(a){s(document.getElementById("userText").value),"3"==document.getElementById("mode").innerHTML&&p()},document.getElementById("userText").onkeypress=function(a){if(13==(a.keyCode||a.which)){var b=document.getElementById("speaklang").innerHTML,c=document.getElementById("userText").value;R.playVoice(b,c),s(c),f(),"3"==document.getElementById("mode").innerHTML&&p()}},document.getElementById("userText").oninput=function(a){var b=this.getBoundingClientRect(),c={clientX:b.left+20*document.getElementById("userText").selectionStart,clientY:b.top};j(x,c),u()},document.getElementById("userText").addEventListener("mousemove",function(a){j(x,a),u()},!1),document.getElementById("gamemode1-button").onmouseup=function(a){document.getElementById("mode").innerHTML="1",document.getElementById("canvas").style.display="block",o()},document.getElementById("gamemode2-button").onmouseup=function(a){document.getElementById("mode").innerHTML="2",document.getElementById("canvas").style.display="block",o()},document.getElementById("gamemode3-button").onmouseup=function(a){document.getElementById("mode").innerHTML="3",document.getElementById("canvas").style.display="none",n()},g()});