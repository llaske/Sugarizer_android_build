var DomJS=function(){this.root=null,this.stack=new Array,this.currElement=null,this.error=!1,this.strict=!0,this.parseProcessingInstructions=!1};DomJS.prototype.parse=function(t,n){if("string"==typeof t){var e=this,r=sax.parser(this.strict);r.onerror=function(t){e.error=!0,n(!0,t)},r.ontext=function(t){if(null!=e.currElement){var n=new Text(t);e.currElement.children.push(n)}},r.onopencdata=function(){var t=new CDATASection;e.currElement.children.push(t)},r.oncdata=function(t){e.currElement.children[e.currElement.children.length-1].appendData(t)},r.onopentag=function(t){var n=new Element(t.name,t.attributes);null==e.root&&(e.root=n,e.processingInstructions&&(n.processingInstructions=e.processingInstructions)),null!=e.currElement&&e.currElement.children.push(n),e.currElement=n,e.stack.push(e.currElement)},r.onclosetag=function(t){e.stack.pop(),e.currElement=e.stack[e.stack.length-1]},r.oncomment=function(t){if(null!=e.currElement){var n=new Comment(t);e.currElement.children.push(n)}},r.onprocessinginstruction=function(t){if(!0===e.parseProcessingInstructions){void 0===e.processingInstructions&&(e.processingInstructions=new Array);var n=new ProcessingInstruction(t.name,t.body);e.processingInstructions.push(n)}},r.onend=function(){0==e.error&&n(!1,e.root)},r.write(t).close()}else n(!0,"Data is not a string")},DomJS.prototype.reset=function(){this.root=null,this.stack=new Array,this.currElement=null,this.error=!1};var escape=function(t){return t.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")},Element=function(t,n,e){this.name=t,this.attributes=n||[],this.children=e||[]};Element.prototype.toXml=function(t){if(void 0===t&&(t={buf:""}),this.processingInstructions)for(var n=0;n<this.processingInstructions.length;n++)t.buf+="<?"+this.processingInstructions[n].name+" "+this.processingInstructions[n].body+"?>\n";for(att in t.buf+="<"+this.name,this.attributes)t.buf+=" "+att+'="'+escape(this.attributes[att])+'"';if(0!=this.children.length){t.buf+=">";for(n=0;n<this.children.length;n++)this.children[n].toXml(t);t.buf+="</"+this.name+">"}else t.buf+="/>";return t.buf},Element.prototype.firstChild=function(){return this.children.length>0?this.children[0]:null},Element.prototype.text=function(){return this.children.length>0&&"string"==typeof this.children[0].text?this.children[0].text:null};var Text=function(t){this.text=t};Text.prototype.toXml=function(t){t.buf+=escape(this.text)};var Comment=function(t){this.comment=t};Comment.prototype.toXml=function(t){t.buf+="\x3c!--"+this.comment+"--\x3e"};var ProcessingInstruction=function(t,n){this.name=t,this.body=n};ProcessingInstruction.prototype.toXml=function(t){t.buf+="<?"+this.name+" "+this.body+"?>"};var CDATASection=function(t){this.text=t||""};CDATASection.prototype.toXml=function(t){t.buf+="<![CDATA["+this.text+"]]>"},CDATASection.prototype.appendData=function(t){this.text+=t};