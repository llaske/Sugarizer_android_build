var p4_log;p4_log=void 0!==this.imports&&void 0!==this.printerr?function(){var r=Array.prototype.slice.call(arguments);printerr(r.join(", "))}:(this.console,function(){}),void 0===Date.now&&(Date.now=function(){return(new Date).getTime()});var P4_CENTRALISING_WEIGHTS,P4_BASE_PAWN_WEIGHTS,P4_KNIGHT_WEIGHTS,P4_PAWN=2,P4_ROOK=4,P4_KNIGHT=6,P4_BISHOP=8,P4_QUEEN=12,P4_KING=10,P4_EDGE=16,P4_MOVES=[[],[],[],[],[1,10,-1,-10],[],[21,19,12,8,-21,-19,-12,-8],[],[11,9,-11,-9],[],[1,10,11,9,-1,-10,-11,-9],[],[1,10,11,9,-1,-10,-11,-9],[]],P4_VALUES=[0,0,20,20,100,100,60,60,61,61,8e3,8e3,180,180,0],P4_KING_VALUE=P4_VALUES[10],P4_WIN=P4_KING_VALUE>>1,P4_WIN_DECAY=300,P4_WIN_NOW=P4_KING_VALUE-250,P4_MAX_SCORE=9999,P4_MIN_SCORE=-P4_MAX_SCORE,P4_DEBUG=0,P4_INITIAL_BOARD="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 1 1",P4_USE_TYPED_ARRAYS=void 0!==this.Int32Array,P4_PIECE_LUT={P:2,p:3,R:4,r:5,N:6,n:7,B:8,b:9,K:10,k:11,Q:12,q:13},P4_ENCODE_LUT="  PPRRNNBBKKQQ";function p4_alphabeta_treeclimber(r,e,_,t,a,n,o,i){var p,s=p4_make_move(r,a,n,P4_QUEEN),P=1-_,f=p4_parse(r,_,s.ep,-t),v=f.length;if(e){var E;for(p=0;p<v;p++){var c=f[p],h=c[0],u=c[1],l=c[2];if(h>P4_WIN){o=P4_KING_VALUE;break}if((E=-p4_alphabeta_treeclimber(r,e-1,P,h,u,l,-i,-o))>o&&(o=E),o>=i)break}o<-P4_WIN_NOW&&!p4_check_check(r,_)&&(o=r.stalemate_scores[_]),o<-P4_WIN&&(o+=P4_WIN_DECAY)}else for(;i>o&&-1!=--v;)f[v][0]>o&&(o=f[v][0]);return p4_unmake_move(r,s),o}function p4_prepare(r){var e,_,t,a,n,o=r.pieces=[[],[]],i=r.moveno>>1,p=r.board,s=i>50?0:parseInt(6*Math.exp(-.07*i)),P=i<12,f=i<5,v=[0,0],E=[0,0],c=[0,0];for(e=20;e<100;e++){var h=14&(n=p[e]),u=1&n;h&&(o[u].push([n,e]),h==P4_KING?v[u]=e:(E[u]+=P4_VALUES[h],c[u]=Math.max(c[u],P4_VALUES[h])))}var l=r.draw_timeout>90||r.current_repetitions>=2;l&&p4_log("",r.current_repetitions,r.draw_timeout),r.values=[[],[]];var A=P4_VALUES[P4_QUEEN],I=E[0]+E[1]+2*A,N=2*(E[1]+A)/I,O=2*(E[0]+A)/I,d=[N,O],m=4*P4_QUEEN/I;for(r.stalemate_scores=[parseInt(.5+2*(N-1)*A),parseInt(.5+2*(O-1)*A)],e=0;e<P4_VALUES.length;e++){var g=P4_VALUES[e];g<P4_WIN?(r.values[0][e]=parseInt(g*N+.5),r.values[1][e]=parseInt(g*O+.5)):(r.values[0][e]=g,r.values[1][e]=g)}r.best_pieces=[parseInt(c[0]*N+.5),parseInt(c[1]*O+.5)];var G=[v[0]%10,v[1]%10],M=[parseInt(v[0]/10),parseInt(v[1]/10)],L=[[],[]];for(a=3;a<9;a++)for(t=1;t<9;t++)(14&(n=p[e=10*a+t]))==P4_PAWN&&(0==(1&n)?L[0][t]=a:void 0===L[1][t]&&(L[1][t]=a));var S=i>=20||I<5*A,K=r.weights;for(a=2;a<10;a++)for(t=1;t<9;t++)for(var T=P4_CENTRALISING_WEIGHTS[e=10*a+t]*s,V=P4_KNIGHT_WEIGHTS[e],b=0;b<2;b++){var k=Math.abs(G[1-b]-t),R=Math.abs(M[1-b]-a),W=Math.abs(G[b]-t),C=(Math.abs(M[b]-a),Math.max(Math.sqrt(k*k+R*R),1)+1),U=d[b],y=U*U*U,H=a==2+7*b,w=a==3+5*b,F=a==5+b,B=a==9-7*b,Q=-5*(f&&H),D=parseInt(.3*T)+2*V+Q,x=parseInt(.3*T),Y=parseInt(.6*T)+V+Q;H&&(x+=(4==t||5==t)*(s+!S),x+=(1==t||8==t)*(i>10&&i<20)*-3,x+=(2==t||7==t)*(i>10&&i<20)*-1);var q=parseInt(.5*V+T*(.5-f)),z=2*(P&&H)*s,j=Math.max(2*m,1)*P4_BASE_PAWN_WEIGHTS[b?119-e:e];if(f){if(a>=4&&a<=7)j+=parseInt(.1*(1+3*(5==a||6==a)+p4_random_int(r,4))*T);4!=t&&5!=t||(j-=3*w,j+=3*F)}B&&(j+=r.values[b][P4_QUEEN]-r.values[b][P4_PAWN]),j+=4*(3==a&&2==M[b]&&Math.abs(W)<2&&5!=G[b]&&4!=t&&5!=t);var Z=L[1-b];if((null==Z[t]||0==b&&Z[t]<a||1==b&&Z[t]>a)&&(j+=2),S){D+=2*parseInt(8*U/C),x+=2*((k<2)+(R<2)),Y+=3*(Math.abs(k-R)<2),q+=2*parseInt(8/C)+(k*R==0)+(k-R==0);var $=8*m*P4_CENTRALISING_WEIGHTS[e];z+=parseInt(150*m/(y*C)+$*y)}if(K[P4_PAWN+b][e]=j,K[P4_KNIGHT+b][e]=D,K[P4_ROOK+b][e]=x,K[P4_BISHOP+b][e]=Y,K[P4_QUEEN+b][e]=q,K[P4_KING+b][e]=z,l&&U<1){var X=3/y;for(_=2+b;_<14;_+=2)K[_][e]+=p4_random_int(r,X)}}r.prepared=!0}function p4_maybe_prepare(r){r.prepared||p4_prepare(r)}function p4_parse(r,e,_,t){var a,n,o,i,p,s,P,f=r.board,v=1-e,E=10-20*e,c=[],h=[],u=r.pieces[e],l=r.castles>>2*e&3,A=r.values[v],I=r.weights;for(s=u.length-1;s>=0;s--){var N=I[i=f[a=u[s][1]]];if(P=t-N[a],(i&=14)>2){var O=P4_MOVES[i];if(2&i){for(p=0;p<8;p++)(o=f[n=a+O[p]])?(17&o)==v&&h.push([P+A[o]+N[n]+I[o][n],a,n]):c.push([P+A[o]+N[n],a,n]);i==P4_KING&&l&&(1&l&&f[a-1]+f[a-2]+f[a-3]==0&&p4_check_castling(f,a-2,v,E,-1)&&c.push([P+12,a,a-2]),2&l&&f[a+1]+f[a+2]==0&&p4_check_castling(f,a,v,E,1)&&c.push([P+13,a,a+2]))}else{var d=O.length;for(p=0;p<d;){var m=O[p++];n=a;do{(o=f[n+=m])?(17&o)==v&&h.push([P+A[o]+N[n]+I[o][n],a,n]):c.push([P+A[o]+N[n],a,n])}while(!o)}}}else{if(!f[n=a+E]){c.push([P+N[n],a,n]);var g=n+E;a*(120-a)<3200&&!f[g]&&c.push([P+N[g],a,g])}(o=f[--n])&&(17&o)==v&&h.push([P+A[o]+N[n]+I[o][n],a,n]),(o=f[n+=2])&&(17&o)==v&&h.push([P+A[o]+N[n]+I[o][n],a,n])}}if(_){var G,M=P4_PAWN|e;f[a=_-E-1]==M&&(G=A[P4_PAWN]+I[P4_PAWN|v][_-E],h.push([t-N[a]+N[_]+G,a,_])),f[a+=2]==M&&(G=A[P4_PAWN]+I[P4_PAWN|v][_-E],h.push([t-N[a]+N[_]+G,a,_]))}return h.concat(c)}function p4_check_castling(r,e,_,t,a){var n,o,i,p=_+P4_KNIGHT,s=P4_BISHOP|_,P=P4_ROOK|_,f=2|_;for(i=e;i<e+3;i++){n=i;do{o=r[n+=t]}while(!o);if((23&o)==P)return 0;n=i;var v=t-1;do{o=r[n+=v]}while(!o);if((27&o)==s)return 0;n=i,v+=2;do{o=r[n+=v]}while(!o);if((27&o)==s)return 0;if(r[i+t-2]==p||r[i+t+2]==p)return 0}for(i=e+t-1;i<e+t+4;i++)if((o=23&r[i])==f||r[i+t]==p)return 0;n=a<0?e+2:e;do{o=r[n-=a]}while(!o);return(23&o)==P?0:1}function p4_check_check(r,e){var _,t=r.board,a=r.pieces[e],n=a.length;do{_=a[--n]}while(_[0]!=(P4_KING|e));var o=_[1],i=1-e,p=10-20*e;if(t[o+p-1]==(P4_PAWN|i)||t[o+p+1]==(P4_PAWN|i))return!0;var s=P4_MOVES[P4_KNIGHT],P=P4_MOVES[P4_KING],f=P4_KNIGHT|i,v=P4_KING|i;for(n=0;n<8;n++)if(t[o+s[n]]==f||t[o+P[n]]==v)return!0;var E=P4_MOVES[P4_BISHOP],c=P4_MOVES[P4_ROOK],h=P4_BISHOP|i,u=P4_ROOK|i;for(n=0;n<4;n++){var l,A=E[n],I=o;do{l=t[I+=A]}while(!l);if((27&l)==h)return!0;A=c[n],I=o;do{l=t[I+=A]}while(!l);if((23&l)==u)return!0}return!1}function p4_optimise_piece_list(r){for(var e,_,t,a=[p4_parse(r,0,0,0),p4_parse(r,1,0,0)],n=(r.weights,r.board),o=0;o<2;o++){var i=r.values[o],p=r.pieces[o],s=a[o],P=a[1-o],f=[];for(e=0;e<p.length;e++)f[(_=p[e])[1]]={score:0,piece:_[0],pos:_[1],threatened:0};for(e=s.length-1;e>=0;e--){var v=(E=s[e])[0];if(t=E[1],!n[E[2]])(c=f[t]).score=Math.max(c.score,v)}for(e=P.length-1;e>=0;e--){var E,c;if(void 0!==(c=f[(E=P[e])[2]])){var h=n[E[1]],u=.01*(1+c.piece>3+h<4);c.threatened<u&&(c.threatened=u)}}var l=[];for(e=20;e<100;e++)void 0!==(_=f[e])&&(_.score+=_.threatened*i[_.piece],l.push(_));for(l.sort((function(r,e){return r.score-e.score})),e=0;e<l.length;e++)_=l[e],p[e]=[_.piece,_.pos]}}function p4_findmove(r,e,_,t){p4_prepare(r),p4_optimise_piece_list(r);r.board;2==arguments.length&&(_=r.to_play,t=r.enpassant);var a,n,o,i=p4_parse(r,_,t,0),p=P4_MIN_SCORE,s=0,P=0;if(e<=0){for(o=0;o<i.length;o++)a=i[o],i[o][0]>p&&(p=a[0],s=a[1],P=a[2]);return[s,P,p]}for(o=0;o<i.length;o++){var f=(a=i[o])[0],v=a[1],E=a[2];if(f>P4_WIN){p=P4_KING_VALUE,s=v,P=E;break}(n=-r.treeclimber(r,e-1,1-_,f,v,E,P4_MIN_SCORE,-p))>p&&(p=n,s=v,P=E)}return p<-P4_WIN_NOW&&!p4_check_check(r,_)&&(p=r.stalemate_scores[_]),[s,P,p]}function p4_make_move(r,e,_,t){var a=r.board,n=a[e],o=a[_];a[_]=n,a[e]=0;var i,p,s,P=14&n,f=1&n,v=n,E=0,c=0,h=0;P==P4_PAWN?(60-_)*(60-_)>900?(t|=f,a[_]=t,v=t):1&(e^_)&&0==o?(c=a[s=_-10+20*f],a[s]=0):(e-_)*(e-_)==400&&(h=e+_>>1):P==P4_KING&&(e-_)*(e-_)==4&&(i=e+_>>1,p=f+P4_ROOK,a[E=e-4+7*(e<_)]=0,a[i]=p);var u=r.castles;if(u){var l=0,A=2*f,I=70*f,N=e-I,O=_+I;25==N?l|=3<<A:21==N?l|=1<<A:28==N&&(l|=2<<A),91==O?l|=4>>A:98==O&&(l|=8>>A),r.castles&=~l}for(var d=r.pieces.concat(),m=d[f],g=r.pieces[f]=[],G=0;G<m.length;G++){(K=m[G])[0];var M=K[1];M!=e&&M!=E&&g.push(K)}if(g.push([v,_]),p&&g.push([p,i]),o||c){var L=d[1-f];g=r.pieces[1-f]=[];var S=c?s:_;for(G=0;G<L.length;G++){var K;(K=L[G])[1]!=S&&g.push(K)}}return{s:e,e:_,S:n,E:o,ep:h,castles:u,rs:E,re:i,rook:p,ep_position:s,ep_taken:c,pieces:d}}function p4_unmake_move(r,e){var _=r.board;e.ep_position&&(_[e.ep_position]=e.ep_taken),_[e.s]=e.S,_[e.e]=e.E,e.rs&&(_[e.rs]=e.rook,_[e.re]=0),r.pieces=e.pieces,r.castles=e.castles}function p4_insufficient_material(r){var e,_=!1,t=void 0,a=r.board;for(e=20;e<100;e++){var n=14&a[e];if(0!=n&&n!=P4_KING)if(n==P4_KNIGHT){if(_||void 0!==t)return!1;_=!0}else{if(n!=P4_BISHOP)return!1;var o=1&e^1&parseInt(e/10);if(_)return!1;if(void 0===t)t=o;else if(t!=o)return!1}}return!0}var P4_MOVE_FLAG_OK=1,P4_MOVE_FLAG_CHECK=2,P4_MOVE_FLAG_MATE=4,P4_MOVE_FLAG_CAPTURE=8,P4_MOVE_FLAG_CASTLE_KING=16,P4_MOVE_FLAG_CASTLE_QUEEN=32,P4_MOVE_FLAG_DRAW=64,P4_MOVE_ILLEGAL=0,P4_MOVE_MISSED_MATE=P4_MOVE_FLAG_CHECK|P4_MOVE_FLAG_MATE,P4_MOVE_CHECKMATE=P4_MOVE_FLAG_OK|P4_MOVE_FLAG_CHECK|P4_MOVE_FLAG_MATE,P4_MOVE_STALEMATE=P4_MOVE_FLAG_OK|P4_MOVE_FLAG_MATE;function p4_move(r,e,_,t){var a=r.board,n=r.to_play,o=1-n;if(e!=parseInt(e))if(void 0===_){var i=p4_interpret_movestring(r,e);if(e=i[0],_=i[1],0==e)return{flags:P4_MOVE_ILLEGAL,ok:!1};t=i[2]}else e=p4_destringify_point(e),_=p4_destringify_point(_);void 0===t&&(t=P4_QUEEN);a[_];var p,s=a[e],P=!1;p4_maybe_prepare(r);var f=p4_parse(r,n,r.enpassant,0);for(p=0;p<f.length;p++)if(_==f[p][2]&&e==f[p][1]){P=!0;break}if(!P)return{flags:P4_MOVE_ILLEGAL,ok:!1};var v=p4_make_move(r,e,_,t);if(p4_check_check(r,n))return p4_unmake_move(r,v),p4_log("",v),{flags:P4_MOVE_ILLEGAL,ok:!1,string:"in check!"};var E=P4_MOVE_FLAG_OK;r.enpassant=v.ep,r.history.push([e,_,t]),v.E||v.ep_position?(r.draw_timeout=0,E|=P4_MOVE_FLAG_CAPTURE):(14&s)==P4_PAWN?r.draw_timeout=0:r.draw_timeout++,v.rs&&(E|=e>_?P4_MOVE_FLAG_CASTLE_QUEEN:P4_MOVE_FLAG_CASTLE_KING);var c=p4_state2fen(r,!0),h=(r.position_counts[c]||0)+1;r.position_counts[c]=h,r.current_repetitions=h,(r.draw_timeout>100||h>=3||p4_insufficient_material(r))&&(E|=P4_MOVE_FLAG_DRAW),r.moveno++,r.to_play=o,p4_check_check(r,o)&&(E|=P4_MOVE_FLAG_CHECK);var u=!0,l=p4_parse(r,o,v.ep,0);for(p=0;p<l.length;p++){var A=l[p],I=p4_make_move(r,A[1],A[2],P4_QUEEN),N=p4_check_check(r,o);if(p4_unmake_move(r,I),!N){u=!1;break}}u&&(E|=P4_MOVE_FLAG_MATE);var O=p4_move2string(r,e,_,s,t,E,f);return p4_log("",e,_,O,E),r.prepared=!1,{flags:E,string:O,ok:!0}}function p4_move2string(r,e,_,t,a,n,o){var i,p,s,P,f=14&t,v=n&P4_MOVE_FLAG_CAPTURE;if(i=p4_stringify_point(e),p=p4_stringify_point(_),f==P4_PAWN)s=v?i.charAt(0)+"x"+p:p,(_>90||_<30)&&(void 0===a&&(a=P4_QUEEN),s+="="+P4_ENCODE_LUT.charAt(a));else if(f==P4_KING&&(e-_)*(e-_)==4)s=_<e?"O-O-O":"O-O";else{var E="",c="",h=P4_ENCODE_LUT.charAt(t),u=e%10,l=parseInt(e/10),A=[];for(P=0;P<o.length;P++){var I=o[P];_==I[2]&&e!=I[1]&&r.board[I[1]]==t&&A.push(I[1])}if(A.length){for(P=0;P<A.length;P++){var N=A[P],O=N%10,d=parseInt(N/10);O==u&&(E=i.charAt(1)),d==l&&(c=i.charAt(0))}""==E&&""==c&&(c=i.charAt(0))}s=h+c+E+(v?"x":"")+p}return n&P4_MOVE_FLAG_CHECK?s+=n&P4_MOVE_FLAG_MATE?"#":"+":n&P4_MOVE_FLAG_MATE&&(s+=" stalemate"),s}function p4_jump_to_moveno(r,e){p4_log("",e),void 0===e||e>r.moveno?e=r.moveno:e<0&&(e=r.moveno+e);for(var _,t,a=p4_fen2state(r.beginning),n=0;a.moveno<e;){var o=r.history[n++];p4_move(a,o[0],o[1],o[2])}for(_ in a){var i=a[_];if(_ instanceof Array)for((t=r[_]).length=0,n=0;n<i.length;n++)t[n]=i[n];else r[_]=i}r.prepared=!1}function p4_state2fen(r,e){for(var _=r.board,t="",a=9;a>1;a--){for(var n=0,o=1;o<9;o++){var i=_[10*a+o];0==i?n++:(n&&(t+=n.toString()),t+="  PpRrNnBbKkQq".charAt(i),n=0)}n&&(t+=n),a>2&&(t+="/")}if(t+=" "+"wb".charAt(r.to_play)+" ",r.castles)for(var p=[2,"K",1,"Q",8,"k",4,"q"],s=0;s<8;s+=2)r.castles&p[s]&&(t+=p[s+1]);else t+="-";return 0!==r.enpassant?t+=" "+p4_stringify_point(r.enpassant):t+=" -",e?t:(t+=" "+r.draw_timeout+" ",t+=1+(r.moveno>>1))}function p4_stringify_point(r){var e=r%10,_=(r-e)/10-1;return" abcdefgh".charAt(e)+_}function p4_destringify_point(r){var e=parseInt(r.charAt(0),19)-9,_=parseInt(r.charAt(1))+1;if(_>=2&&_<10&&e>=1&&e<9)return 10*_+e}function p4_fen2state(r,e){void 0===e&&(e=p4_initialise_state());var _=e.board,t=r.split(" "),a=t[0],n=t[1],o=t[2],i=t[3],p=t[4],s=t[5];void 0===p&&(p=0);for(var P,f,v=90,E=1,c=0;c<a.length;c++)if("/"!=(f=a.charAt(c))){var h=P4_PIECE_LUT[f];if(h&&E<9)_[v+E]=h,E++;else for(var u=Math.min(E+parseInt(f),9);E<u;E++)_[v+E]=0}else if(E=1,(v-=10)<20)break;e.to_play="b"==n.toLowerCase()?1:0,e.castles=0;var l=_[25]==P4_KING,A=_[95]==P4_KING+1,I={k:8*(A&&_[98]==P4_ROOK+1),q:4*(A&&_[91]==P4_ROOK+1),K:2*(l&&_[28]==P4_ROOK),Q:1*(l&&_[21]==P4_ROOK)};for(P=0;P<o.length;P++){var N=I[f=o.charAt(P)];void 0!==N&&(e.castles|=N,0==N&&console.log("FEN claims castle state "+o+" but pieces are not in place for "+f))}if(e.enpassant="-"!=i?p4_destringify_point(i):0,e.draw_timeout=parseInt(p),void 0===s){var O,d=0,m=0;for(v=20;v<100;v+=10)for(E=1;E<9;E++)d+=!!(O=15&_[v+E]),E<8&&(m+=!_[v+E+1]!=!O),v<90&&(m+=!_[v+E+10]!=!O);s=Math.max(1,parseInt(1.3*(32-d)+1.5*(4-o.length)+(m-16)/5))}return e.moveno=2*(parseInt(s)-1)+e.to_play,e.history=[],e.beginning=r,e.prepared=!1,e.position_counts={},e.move=function(r,e,_){return p4_move(this,r,e,_)},e.findmove=function(r){return p4_findmove(this,r)},e.jump_to_moveno=function(r){return p4_jump_to_moveno(this,r)},e}var P4_ZEROS=[];function p4_zero_array(){if(P4_USE_TYPED_ARRAYS)return new Int32Array(120);if(0==P4_ZEROS.length)for(var r=0;r<120;r++)P4_ZEROS[r]=0;return P4_ZEROS.slice()}function p4_initialise_state(){var r=p4_zero_array();P4_CENTRALISING_WEIGHTS=p4_zero_array(),P4_BASE_PAWN_WEIGHTS=p4_zero_array(),P4_KNIGHT_WEIGHTS=p4_zero_array();for(var e=0;e<120;e++){var _=parseInt(e/10),t=e%10,a=Math.abs(t-4.5),n=Math.abs(_-5.5);P4_CENTRALISING_WEIGHTS[e]=parseInt(6-Math.pow(1.5*(a*a+n*n),.6)),P4_KNIGHT_WEIGHTS[e]=parseInt((a<2)+1.5*(n<2)+(a<3)+(n<3))-2,P4_BASE_PAWN_WEIGHTS[e]=parseInt("000012347000".charAt(_)),(_>9||_<2||t<1||t>8)&&(r[e]=16)}var o=[];for(e=0;e<14;e++)o[e]=p4_zero_array();var i={board:r,weights:o,history:[],treeclimber:p4_alphabeta_treeclimber};return p4_random_seed(i,P4_DEBUG?1:Date.now()),i}function p4_new_game(){return p4_fen2state(P4_INITIAL_BOARD)}function p4_interpret_movestring(r,e){var _=[0,0],t=/^[a-h][1-8]$/,a=/^\s*([RNBQK]?[a-h]?[1-8]?)[ :x-]*([a-h][1-8]?)(=[RNBQ])?[!?+#e.p]*\s*$/.exec(e);if(null==a){if(!(a=/^\s*([O0o]-[O0o](-[O0o])?)\s*$/.exec(e)))return _;n=25+70*r.to_play,o=a[2]?n-2:n+2}var n,o,i,p=a[1],s=a[2],P=a[3];return""==p||null==p?n=p4_find_source_point(r,o=p4_destringify_point(s),"P"+s.charAt(0)):/^[RNBQK]/.test(p)?n=p4_find_source_point(r,o=p4_destringify_point(s),p):t.test(p)&&t.test(s)?(n=p4_destringify_point(p),o=p4_destringify_point(s)):/^[a-h]$/.test(p)&&(n=p4_find_source_point(r,o=p4_destringify_point(s),"P"+p)),0==n?_:(P&&(i=P4_PIECE_LUT[P.charAt(1)]),[n,o,i])}function p4_find_source_point(r,e,_){var t,a,n,o,i=r.to_play,p=P4_PIECE_LUT[_.charAt(0)];for(p|=i,a=1;a<_.length;a++){var s=_.charAt(a);/[a-h]/.test(s)?o=_.charCodeAt(a)-96:/[1-8]/.test(s)&&(n=1+parseInt(s))}var P=[];p4_prepare(r);var f=p4_parse(r,i,r.enpassant,0);for(a=0;a<f.length;a++){var v=f[a];if(e==v[2]&&(t=v[1],!(r.board[t]!=p||void 0!==o&&o!=t%10||void 0!==n&&n!=parseInt(t/10)))){var E=p4_make_move(r,t,e,P4_QUEEN);p4_check_check(r,i)||P.push(t),p4_unmake_move(r,E)}}return p4_log("",_,"",e,"",P),0==P.length?0:(P.length>1&&p4_log("",r,e,_,P),P[0])}function p4_random_seed(r,e){e&=4294967295,r.rng=P4_USE_TYPED_ARRAYS?new Uint32Array(4):[],r.rng[0]=4058668781,r.rng[1]=e,r.rng[2]=e,r.rng[3]=e;for(var _=0;_<20;_++)p4_random31(r)}function p4_random31(r){var e=r.rng,_=e[1],t=e[2],a=e[0]-(_<<27|_>>>5);return e[0]=_^(t<<17|t>>>15),e[1]=t+e[3]&4294967295,e[2]=e[3]+a&4294967295,e[3]=a+e[0]&4294967295,2147483647&e[3]}function p4_random_int(r,e){var _,t=e;t--,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16;do{_=p4_random31(r)&t}while(_>=e);return _}