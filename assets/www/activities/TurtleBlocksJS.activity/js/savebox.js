/*! Sugarizer 2019-09-21 */
function SaveBox(){this._canvas=null,this._stage=null,this._refreshCanvas=null,this._doSaveTB=null,this._doSaveSVG=null,this._doSavePNG=null,this._doUploadToPlanet=null,this._doShareOnFacebook=null,this._container=null,this._bounds=null,this.save=null,this.close=null,this._scale=1,this.setCanvas=function(a){return this._canvas=a,this},this.setStage=function(a){return this._stage=a,this},this.setSaveTB=function(a){return this._doSaveTB=a,this},this.setSaveSVG=function(a){return this._doSaveSVG=a,this},this.setSavePNG=function(a){return this._doSavePNG=a,this},this.setSaveFB=function(a){return this._doShareOnFacebook=a,this},this.setSavePlanet=function(a){return this._doUploadToPlanet=a,this},this.setRefreshCanvas=function(a){return this._refreshCanvas=a,this},this.init=function(a,b,c,d){if(null===this._container){this.createBox(a,b,c);var e=this;this.saveTB=d("save-tb",_("Save as .tb"),this._container.x+50,this._container.y+85,55,0,this._stage),this.saveTB.visible=!0,this.positionHoverText(this.saveTB),this.saveTB.on("click",function(a){e.hide(),e._doSaveTB()}),this.saveSVG=d("save-svg",_("Save as .svg"),this._container.x+115,this._container.y+85,55,0,this._stage),this.saveSVG.visible=!0,this.positionHoverText(this.saveSVG),this.saveSVG.on("click",function(a){e.hide(),e._doSaveSVG()}),this.savePNG=d("save-png-inactive",_("Save as .png"),this._container.x+180,this._container.y+85,55,0,this._stage),this.savePNG.visible=!0,this.positionHoverText(this.savePNG),this.savePNG.on("click",function(a){e.hide(),e._doSavePNG()}),this.uploadToPlanet=d("upload-planet",_("Upload to Planet"),this._container.x+245,this._container.y+85,55,0,this._stage),this.uploadToPlanet.visible=!0,this.positionHoverText(this.uploadToPlanet),this.uploadToPlanet.on("click",function(a){e.hide(),e._doUploadToPlanet()}),this.shareOnFb=d("fb-inactive",_("Share on Facebook"),this._container.x+310,this._container.y+85,55,0,this._stage),this.shareOnFb.visible=!0,this.positionHoverText(this.shareOnFb),this.shareOnFb.on("click",function(a){e.hide(),e._doShareOnFacebook()})}else this.show()},this.positionHoverText=function(a){for(var b=0;b<a.children.length;b++)if(void 0!=a.children[b].text){a.children[b].textAlign="left",a.children[b].x=-27,a.children[b].y=27;break}},this.hide=function(){null!==this._container&&(this.saveTB.visible=!1,this.saveSVG.visible=!1,this.savePNG.visible=!1,this.uploadToPlanet.visible=!1,this.shareOnFb.visible=!1,this._container.visible=!1,this._refreshCanvas())},this.show=function(){null!==this._container&&(this.saveTB.visible=!0,this.saveSVG.visible=!0,this.savePNG.visible=!0,this.uploadToPlanet.visible=!0,this.shareOnFb.visible=!0,this._container.visible=!0,this._refreshCanvas())},this.createBox=function(a,b,c){function d(a,b,c,d){a._container.addChild(c),a._loadUtilityContainerHandler();var e=new createjs.Shape;a._bounds=a._container.getBounds(),a._container.cache(a._bounds.x,a._bounds.y,a._bounds.width,a._bounds.height),e.graphics.beginFill("#FFF").drawRect(a._bounds.x,a._bounds.y,a._bounds.width,a._bounds.height),e.x=0,e.y=0,a._container.hitArea=e}this._scale=a,null==this._container&&(this._container=new createjs.Container,this._stage.addChild(this._container),this._container.x=Math.floor((this._canvas.width/a-180)/2),this._container.y=27,this._makeBoxBitmap(SAVEBOXSVG,"box",d,null))},this._makeBoxBitmap=function(a,b,c,d){var e=new Image,f=this;e.onload=function(){var a=new createjs.Bitmap(e);c(f,b,a,d)},e.src="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(a)))},this._loadUtilityContainerHandler=function(){var a=!1,b=this;this._container.on("click",function(c){if(a)return void console.log("debouncing click");a=!0,setTimeout(function(){a=!1},500);c.stageX,b._scale,b._container.x;c.stageY/b._scale-b._container.y<55&&b.hide()})}}const SAVEBOXSVG='<svg xmlns="http://www.w3.org/2000/svg" height="133" width="360" version="1.1"> <rect style="fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none" y="0" x="0" height="133" width="360" /> <g style="fill:#000000;display:block" transform="translate(306.943,-1.053)"> <path style="fill:#000000;display:inline" d="m 27.557,5.053 c -12.43,0 -22.5,10.076 -22.5,22.497 0,12.432 10.07,22.503 22.5,22.503 12.431,0 22.5,-10.071 22.5,-22.503 0,-12.421 -10.07,-22.497 -22.5,-22.497 z m 10.199,28.159 c 1.254,1.256 1.257,3.291 0,4.545 -0.628,0.629 -1.451,0.943 -2.274,0.943 -0.822,0 -1.644,-0.314 -2.27,-0.94 l -5.76,-5.761 -5.76,5.761 c -0.627,0.626 -1.449,0.94 -2.271,0.94 -0.823,0 -1.647,-0.314 -2.275,-0.943 -1.254,-1.254 -1.254,-3.289 0.004,-4.545 l 5.758,-5.758 -5.758,-5.758 c -1.258,-1.254 -1.258,-3.292 -0.004,-4.546 1.255,-1.254 3.292,-1.259 4.546,0 l 5.76,5.759 5.76,-5.759 c 1.252,-1.259 3.288,-1.254 4.544,0 1.257,1.254 1.254,3.292 0,4.546 l -5.758,5.758 5.758,5.758 z" /> </g> <rect style="fill:#92b5c8;fill-opacity:1;stroke:none" y="51" x="0" height="82" width="360" /> <rect y="0.76763773" x="0.76764059" height="131.46472" width="358.46472" style="display:inline;visibility:visible;opacity:1;fill:none;fill-opacity:1;stroke:#000000;stroke-width:1.5;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1;" /></svg>';