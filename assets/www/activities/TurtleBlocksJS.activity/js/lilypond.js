/*! Sugarizer 2020-03-14 */
const LILYPONDHEADER='\\version "2.18.2"\n\n% ****************************************************************\n% \n% WHAT IS THIS? -- This is a LilyPond file generated from Music\n% Blocks software (Read about it at www.musicblocks.net).\n% \n% DOWNLOAD LILYPOND -- In order to create notation with this file,\n% you will need to download and install LilyPond software onto your\n% computer (http://lilypond.org/download.html). Frescobaldi\n% software is also handy for editing LilyPond files\n% (http://frescobaldi.org/download).\n% \n% LILYPOND INSTRUCTIONS -- For instructions on how to further\n% manipulate musical notation using LilyPond software, please\n% read the Introduction (http://lilypond.org/text-input.html) and\n% the Manual\n% (http://lilypond.org/doc/v2.18/Documentation/learning/index.html).\n% \n% GLOSSARY -- A glossary with helpful examples may be found here\n% (http://www.lilypond.org/doc/v2.19/Documentation/music-glossary/).\n% \n% MUTOPIA -- You may also benefit from studying scores from the\n% Mutopia Project website, which has freely sharable music notation\n% generated with LilyPond (http://www.mutopiaproject.org/).\n% \n% LILYBIN -- You can explore your Lilypond output in a web browser at\n% (http://lilybin.com/).\n% \n% COMMENTS -- Some of the code below is commented out. You can\n% enable it by deleting the % that precedes the text or, in the\n% case of a commented section, deleting the %{ and %} that surrounds\n% the section.\n% \n% ****************************************************************\n\n% Please add your own name, the title of your musical creation,\n% and the intended copyright below.\n% The copyright is great for sharing (and re-sharing)!\n% Read more about it here (http://creativecommons.org/licenses/by-sa/4.0/).\n% Of course, you can use any copyright you like -- you made it!\n\\header {\n   dedication = \\markup {\n      \\abs-fontsize #8 \\sans "Made with LilyPond and Music Blocks" \\with-url #"http://walterbender.github.io/musicblocks/" {\n         \\abs-fontsize #8 \\sans "(http://walterbender.github.io/musicblocks/)"\n      }\n   }\n   title = "My Music Blocks Creation"\n%   subtitle = "Subtitle"\n%   instrument = "Instrument"\n   composer = "Mr. Mouse"\n%   arranger = "Arranger"\n   copyright = "Mr. Mouse (c) 2015 -- CC-BY-SA"\n   tagline = "Made from Music Blocks v.0.9"\n   footer = \\markup {\n      \\with-url #"http://walterbender.github.io/musicblocks/" "Made with Music Blocks Software v.0.9." Engraved on \\simple #(strftime "%Y-%m-%d" (localtime (current-time)))\n   }\n   currentYear = \\markup {\n      \\simple #(strftime "%Y" (localtime (current-time)))\n   }\n   copyTag =  " free to distribute, modify, and perform"\n   copyType = \\markup {\n      \\with-url #"http://creativecommons.org/licenses/by-sa/3.0/" "Creative Commons Attribution ShareAlike 3.0 (Unported) License "\n   }\n   copyright = \\markup {\n      \\override #\'(baseline-skip . 0 ) \\right-column {\n         \\sans \\bold \\with-url #"http://musicblocks.net" {\n            \\abs-fontsize #9  "Music " \\concat {\n               \\abs-fontsize #12 \\with-color #white \\char ##x01C0 \\abs-fontsize #9 "Blocks "\n            }\n         }\n      }\n      \\override #\'(baseline-skip . 0 ) \\center-column {\n         \\abs-fontsize #11.9 \\with-color #grey \\bold {\n            \\char ##x01C0 \\char ##x01C0\n         }\n      }\n      \\override #\'(baseline-skip . 0 ) \\column {\n         \\abs-fontsize #8 \\sans \\concat {\n            " Typeset using " \\with-url #"http://www.lilypond.org" "LilyPond software " \\char ##x00A9 " " \\currentYear " by " \\composer " " \\char ##x2014 " " \\footer\n         }\n         \\concat {\n            \\concat {\n               \\abs-fontsize #8 \\sans {\n                  " " \\copyType \\char ##x2014 \\copyTag\n               }\n            }\n            \\abs-fontsize #13 \\with-color #white \\char ##x01C0\n         }\n      }\n   }\n   tagline = ##f\n}\n\n% To change the meter make adjustments in the following section.\n% You must also delete the % before \\meter everywhere it appears below.\nmeter = {\n   \\time 3/4\n   \\key c \\minor\n   \\numericTimeSignature\n   \\partial 4 \n   \\tempo "Andante" 4=90\n}\n\n',RODENTS=[_("mouse"),_("brown rat"),_("mole"),_("chipmunk"),_("red squirrel"),_("guinea pig"),_("capybara"),_("coypu"),_("black rat"),_("grey squirrel"),_("flying squirrel"),_("bat")],RODENTSEN=["mouse","brown rat","mole","chipmunk","red squirrel","guinea pig","capybara","coypu","black rat","grey squirrel","flying squirrel","bat"],RODENTSSHORT=[_("m"),_("br"),_("ml"),_("ch"),_("rs"),_("gp"),_("cb"),_("cp"),_("bk"),_("gs"),_("fs"),_("bt")],RODENTSSHORTEN=["m","br","ml","ch","rs","gp","cb","cp","bk","gs","fs","bt"],LYNOTE=0,LYDURATION=1,LYDOTCOUNT=2,LYTUPLETVALUE=3,LYROUNDDOWN=4,LYINSIDECHORD=5,LYSTACCATO=6,CLEFS=["treble","bass","bass_8","percussion"];getLilypondHeader=function(){return LILYPONDHEADER},updateLilypondNotation=function(a,b,c,d,e){var f=durationToNoteValue(c);d in a.lilypondStaging||(a.lilypondStaging[d]=[]),a.turtles.turtleList[d].drum&&(b="c'"),a.lilypondStaging[d].push([b,f[0],f[1],f[2],f[3],e,a.staccato[d].length>0&&last(a.staccato[d])>0])},processLilypondNotes=function(a,b){function c(a){if("number"==typeof a){var b=frequencyToPitch(a);a=b[0]+b[1]}return a.replace(/♯/g,"is").replace(/♭/g,"es").replace(/10/g,"''''''''").replace(/1/g,",,").replace(/2/g,",").replace(/3/g,"").replace(/4/g,"'").replace(/5/g,"''").replace(/6/g,"'''").replace(/7/g,"''''").replace(/8/g,"''''''").replace(/9/g,"'''''''").toLowerCase()}function d(a,b,d,e){for(var f=0,g=0;g<e;){a.lilypondStaging[b][d+f][LYDURATION];a.lilypondStaging[b][d+f][LYINSIDECHORD]>0?((0===d&&0===f||a.lilypondStaging[b][d+f-1][LYINSIDECHORD]!==a.lilypondStaging[b][d+f][LYINSIDECHORD])&&(a.lilypondNotes[b]+="<"),a.lilypondNotes[b]+=c(a.lilypondStaging[b][d+f][LYNOTE]),obj[LYSTACCATO]&&(a.lilypondNotes[b]+="\\staccato"),a.lilypondNotes[b]+=" ",d+f!==a.lilypondStaging[b].length-1&&a.lilypondStaging[b][d+f+1][LYINSIDECHORD]===a.lilypondStaging[b][d+f][LYINSIDECHORD]||(a.lilypondNotes[b]+=">"+a.lilypondStaging[b][d+f+1][LYROUNDDOWN]+" ",g++),f++):(a.lilypondNotes[b]+=c(a.lilypondStaging[b][d+f][LYNOTE])+a.lilypondStaging[b][d+f][LYROUNDDOWN],obj[LYSTACCATO]&&(a.lilypondNotes[b]+="\\staccato"),a.lilypondNotes[b]+=" ",f++,g++)}if(d+f-1<a.lilypondStaging[b].length-1){var h=a.lilypondStaging[b][d+f];"string"==typeof h&&")"===h?(a.lilypondNotes[b]+=")} ",d+=1):a.lilypondNotes[b]+="} "}else a.lilypondNotes[b]+="} ";return f}a.lilypondNotes[b]="";for(var e=0,f=!1,g=!1,h=0,i=0,j=0;j<a.lilypondStaging[b].length;j++)if(obj=a.lilypondStaging[b][j],"string"==typeof obj)"break"===obj?(j>0&&(a.lilypondNotes[b]+="\n"),e=0):"("===obj?f=!0:"begin articulation"===obj?g=!0:"end articulation"===obj?g=!1:a.lilypondNotes[b]+=obj;else{e%8==0&&e>0&&(a.lilypondNotes[b]+="\n"),e+=1;var k=c(obj[LYNOTE]),l=0;if(null!=obj[LYTUPLETVALUE]){h=1/a.lilypondStaging[b][j][LYDURATION],i=1/a.lilypondStaging[b][j][LYROUNDDOWN];for(var m=1,n=1;n<obj[LYTUPLETVALUE];){if(j+m>=a.lilypondStaging[b].length){l=m;break}if(a.lilypondStaging[b][j+m][LYINSIDECHORD]>0&&a.lilypondStaging[b][j+m][LYINSIDECHORD]===a.lilypondStaging[b][j+m-1][LYINSIDECHORD])m++;else{if(a.lilypondStaging[b][j+m][LYTUPLETVALUE]!==obj[LYTUPLETVALUE]){l=m;break}h+=1/a.lilypondStaging[b][j+m][LYDURATION],i+=1/a.lilypondStaging[b][j+m][LYROUNDDOWN],m++,n++}}}if(obj[LYTUPLETVALUE]>0){if(0===l){var o=toFraction(i/h);a.lilypondNotes[b]+="\\tuplet "+o[0]+"/"+o[1]+" { ",j+=d(a,b,j,obj[LYTUPLETVALUE])-1}else{var o=toFraction(obj[LYTUPLETVALUE]/l);a.lilypondNotes[b]+="\\tuplet "+o[0]+"/"+o[1]+" { ",j+=d(a,b,j,l)-1}h=0,i=0}else{if(obj[LYINSIDECHORD]>0){if(0!==j&&a.lilypondStaging[b][j-1][LYINSIDECHORD]===obj[LYINSIDECHORD]||(a.lilypondNotes[b]+="<"),a.lilypondNotes[b]+=k,j===a.lilypondStaging[b].length-1||a.lilypondStaging[b][j+1][LYINSIDECHORD]!==obj[LYINSIDECHORD]){a.lilypondNotes[b]+=">",a.lilypondNotes[b]+=obj[LYDURATION];for(var p=0;p<obj[LYDOTCOUNT];p++)a.lilypondNotes[b]+=".";g&&(a.lilypondNotes[b]+="->"),a.lilypondNotes[b]+=" "}}else{a.lilypondNotes[b]+=k+obj[LYDURATION];for(var p=0;p<obj[LYDOTCOUNT];p++)a.lilypondNotes[b]+=".";g&&(a.lilypondNotes[b]+="->")}obj[LYSTACCATO]&&(a.lilypondNotes[b]+="\\staccato"),h=0,i=0}a.lilypondNotes[b]+=" ",f&&(f=!1,a.lilypondNotes[b]+="(")}},lilypondLineBreak=function(a,b){void 0==a.lilypondStaging[b]&&(a.lilypondStaging[b]=[]),a.lilypondStaging[b].push("break")},lilypondBeginArticulation=function(a,b){void 0==a.lilypondStaging[b]&&(a.lilypondStaging[b]=[]),a.lilypondStaging[b].push("begin articulation")},lilypondEndArticulation=function(a,b){a.lilypondStaging[b].push("end articulation")},lilypondBeginCrescendo=function(a,b,c){void 0==a.lilypondStaging[b]&&(a.lilypondStaging[b]=[]),c>0?a.lilypondStaging[b].push("\\< "):a.lilypondStaging[b].push("\\> ")},lilypondEndCrescendo=function(a,b){a.lilypondStaging[b].push("\\! ")},lilypondBeginSlur=function(a,b){void 0==a.lilypondStaging[b]&&(a.lilypondStaging[b]=[]),a.lilypondStaging[b].push("(")},lilypondEndSlur=function(a,b){a.lilypondStaging[b].push(") ")},lilypondInsertTie=function(a,b){void 0==a.lilypondStaging[b]&&(a.lilypondStaging[b]=[]),a.lilypondStaging[b].push("~")},lilypondRemoveTie=function(a,b){a.lilypondStaging[b].pop()},saveLilypondOutput=function(a,b){var c=0,d=[];for(var e in a.lilypondStaging)c+=1;console.log("saving as lilypond: "+c),a.lilypondOutput+="% You can change the MIDI instruments below to anything on logo list:\n% (http://lilypond.org/doc/v2.18/documentation/notation/midi-instruments)\n\n";var f=0;for(var e in a.lilypondStaging){if(a.lilypondStaging[e].length>0){for(var g=0,h=0,i=0;i<a.lilypondStaging[e].length;i++)if(obj=a.lilypondStaging[e][i],"object"==typeof obj)if(obj[0].length<2);else{if("string"==typeof obj[0])g+=Number(obj[0].substr(-1));else{var j=frequencyToPitch(obj[0]);g+=j[1]}h+=1}if(a.turtles.turtleList[e].drum)d.push("percussion");else if(h>0)switch(Math.floor(g/h)){case 0:case 1:case 2:d.push("bass_8");break;case 3:d.push("bass");break;default:d.push("treble")}else d.push("treble");processLilypondNotes(a,e);var k=a.turtles.turtleList[e].name;k===_("start")||k===_("start drum")?k=RODENTS[e%12]:k===e.toString()&&(k=RODENTS[e%12]),""===k&&(k=RODENTSEN[e%12]),k=k.replace(/ /g,"_"),a.lilypondOutput+=k+" = {\n",a.lilypondOutput+="% \\meter\n",a.lilypondOutput+=a.lilypondNotes[e],f===c-1&&(a.lilypondOutput+=' \\bar "|."'),a.lilypondOutput+="\n}\n\n";var l=RODENTSSHORT[e%12];""===l&&(l=RODENTSSHORTEN[e%12]),a.lilypondOutput+=k.replace(/ /g,"_")+"Voice = ",a.turtles.turtleList[e].drum?a.lilypondOutput+="\\new DrumStaff \\with {\n":a.lilypondOutput+="\\new Staff \\with {\n",a.lilypondOutput+='   \\clef "'+last(d)+'"\n',a.lilypondOutput+='   instrumentName = "'+k+'"\n',a.lilypondOutput+='   shortInstrumentName = "'+l+'"\n',a.lilypondOutput+='   midiInstrument = "acoustic grand"\n',a.lilypondOutput+='\n   \\remove "Note_heads_engraver"\n   \\consists "Completion_heads_engraver"\n   \\remove "Rest_engraver"\n   \\consists "Completion_rest_engraver"\n',a.lilypondOutput+='} { \\clef "'+last(d)+'" \\'+k.replace(/ /g,"_")+" }\n\n"}f+=1}a.lilypondOutput+="\n\\score {\n",a.lilypondOutput+="   <<\n";for(var f=0;f<CLEFS.length;f++){var i=0;for(var e in a.lilypondNotes)if(d[i]===CLEFS[f]&&a.lilypondStaging[e].length>0){var k=a.turtles.turtleList[e].name;k===_("start")||k===_("start drum")?k=RODENTS[e%12]:k===e.toString()&&(k=RODENTS[e%12]),k=k.replace(/ /g,"_"),a.lilypondOutput+="      \\"+k+"Voice\n"}}a.lilypondOutput+='\n\n% GUITAR TAB SECTION\n% Delete the %{ and %} below to include guitar tablature output.\n%{\n      \\new TabStaff = "guitar tab" \n      <<\n         \\clef moderntab\n';for(var f=0;f<CLEFS.length;f++){var i=0;for(var e in a.lilypondNotes)if(d[i]===CLEFS[f]&&a.lilypondStaging[e].length>0){var k=a.turtles.turtleList[e].name;k===_("start")||k===_("start drum")?k=RODENTS[e%12]:k===e.toString()&&(k=RODENTS[e%12]),k=k.replace(/ /g,"_"),a.lilypondOutput+='         \\context TabVoice = "'+k+'" \\'+k.replace(/ /g,"_")+"\n"}}a.lilypondOutput+="      >>\n%}\n",a.lilypondOutput+="\n   >>\n   \\layout {}\n\n",a.lilypondOutput+="% MIDI SECTION\n% Delete the %{ and %} below to include MIDI output.\n%{\n\\midi {\n   \\tempo 4=90\n}\n%}\n\n}\n\n",a.lilypondOutput+="% MUSIC BLOCKS CODE\n",a.lilypondOutput+="% Below is the code for the Music Blocks project that generated logo Lilypond file.\n%{\n\n";var m=prepareExport();a.lilypondOutput+=m.replace(/]],/g,"]],\n"),a.lilypondOutput+="\n%}\n\n",doSaveLilypond(a,b)};