/*! Sugarizer 2020-03-14 */
function PluginsViewer(a,b,c,d,e){this.canvas=a,this.stage=b,this.refreshCanvas=c,this.closeViewer=d,this.loadPlugin=e,this.dict={},this.pluginFiles=[],this.container=null,this.prev=null,this.next=null,this.page=0,this.server=!0,this.setServer=function(a){this.server=a},this.hide=function(){null!==this.container&&(this.container.visible=!1,this.refreshCanvas())},this.show=function(a){function b(a,b,c,d){function e(a,b,c,d){function e(a,b,c,d){return a.next=c,a.container.addChild(a.next),a.next.x=325,a.next.y=535,a.container.visible=!0,a.refreshCanvas(),a.completeInit(),loadThumbnailContainerHandler(a),!0}a.prev=c,a.container.addChild(a.prev),a.prev.x=270,a.prev.y=535,makeViewerBitmap(a,NEXTBUTTON,"viewer",e,null)}a.container.addChild(c),makeViewerBitmap(a,PREVBUTTON,"viewer",e,null)}if(this.scale=a,this.page=0,this.server)try{var c=httpGet(),d=JSON.parse(c);for(var e in d)if("svg"===fileExt(d[e])){var f=fileBasename(d[e]);-1===this.pluginFiles.indexOf(f)&&this.pluginFiles.push(f)}for(var e in this.pluginFiles){!(this.pluginFiles[e]+".json")in d&&this.pluginFiles.remove(this.pluginFiles[e])}}catch(a){return console.log(a),!1}else this.pluginFiles=SAMPLEPLUGINS;if(console.log("found these projects: "+this.pluginFiles.sort()),null!==this.container)return this.container.visible=!0,this.refreshCanvas(),this.completeInit(),!0;this.container=new createjs.Container,this.stage.addChild(this.container),this.container.x=Math.floor((this.canvas.width/a-650)/2),this.container.y=27,makeViewerBitmap(this,BACKGROUND,"viewer",b,null)},this.downloadImage=function(a,b){var c="data:image/svg+xml;utf8,",d=this.pluginFiles[a]+".svg";if(this.server)var e=c+httpGet(d);else var e=c+SAMPLESSVG[d];var f=new Image,g=this;f.onload=function(){bitmap=new createjs.Bitmap(e),bitmap.scaleX=.5,bitmap.scaleY=.5,g.container.addChild(bitmap),lastChild=last(g.container.children),g.container.swapChildren(bitmap,lastChild),g.dict[g.pluginFiles[a]]=bitmap,x=5+a%4*160,y=55+120*Math.floor(a%16/4),g.dict[g.pluginFiles[a]].x=x,g.dict[g.pluginFiles[a]].y=y,g.dict[g.pluginFiles[a]].visible=!0,g.refreshCanvas(),null!==b&&b(g,a+1)},f.src=e},this.completeInit=function(){this.prepareNextImage(this,0)},this.prepareNextImage=function(a,b){b<a.pluginFiles.length&&b<16*a.page+16?a.pluginFiles[b]in a.dict?(x=5+b%4*160,y=55+120*Math.floor(b%16/4),a.dict[a.pluginFiles[b]].x=x,a.dict[a.pluginFiles[b]].y=y,a.dict[a.pluginFiles[b]].visible=!0,a.prepareNextImage(a,b+1)):a.downloadImage(b,a.prepareNextImage):(0===a.page&&(a.prev.visible=!1),16*(a.page+1)<a.pluginFiles.length&&(a.next.visible=!0),a.refreshCanvas())}}function hideCurrentPage(a){for(var b=16*a.page,c=Math.min(a.pluginFiles.length,16*(a.page+1)),d=b;d<c;d++)a.dict[a.pluginFiles[d]].visible=!1;a.page-=1,0===a.page&&(a.prev.visible=!1),16*(a.page+1)<a.pluginFiles.length&&(a.next.visible=!0);for(var b=16*a.page,c=Math.min(a.pluginFiles.length,16*(a.page+1)),d=b;d<c;d++)a.dict[a.pluginFiles[d]].visible=!0;a.refreshCanvas()}function showNextPage(a){for(var b=16*a.page,c=Math.min(a.pluginFiles.length,16*(a.page+1)),d=b;d<c;d++)a.dict[a.pluginFiles[d]].visible=!1;a.page+=1,a.prev.visible=!0,16*(a.page+1)+1>a.pluginFiles.length&&(a.next.visible=!1),a.prepareNextImage(a,c),a.refreshCanvas()}function viewerClicked(a,b){var c=b.stageX/a.scale-a.container.x,d=b.stageY/a.scale-a.container.y;if(c>600&&d<55)a.hide(),a.closeViewer();else if(d>535)a.prev.visible&&c<325?hideCurrentPage(a):a.next.visible&&c>325&&showNextPage(a);else{var e=Math.floor((c-5)/160),f=Math.floor((d-55)/120),g=4*f+e+16*a.page;g<a.pluginFiles.length&&(a.hide(),a.closeViewer(),a.loadPlugin(a.pluginFiles[g]+".json"))}}function loadThumbnailContainerHandler(a){var b,c,d,e,f=new createjs.Shape,g=650,h=590;f.graphics.beginFill("#FFF").drawRect(0,0,g,h),f.x=0,f.y=0,a.container.hitArea=f;var i=!1;a.container.on("click",function(b){if(i)return void console.log("debouncing click");i=!0,setTimeout(function(){i=!1},500),viewerClicked(a,b)}),a.container.on("mousedown",function(a){b=a.stageX,c=a.stageY,i=!0}),a.container.on("pressup",function(f){d=f.stageX,e=f.stageY,e>c+30||d>b+30?a.next.visible&&showNextPage(a):e<c-30||d<b-30?a.prev.visible&&hideCurrentPage(a):(i=!1,viewerClicked(a,f))})}function makeViewerBitmap(a,b,c,d,e){var f=new Image;f.onload=function(){bitmap=new createjs.Bitmap(f),d(a,c,bitmap,e)},f.src="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(b)))}