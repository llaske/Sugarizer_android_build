/*! Sugarizer 2019-09-21 */
function StatusMatrix(){const a=128,b=53,c=32,d=620,e=d-1.5*b;docById("statusDiv").style.visibility="hidden",this.init=function(f){this._logo=f;var g=window.innerWidth;this._cellScale=g/1200;var h=c*this._cellScale,i=docById("myCanvas"),j=docById("statusDiv");j.style.visibility="visible",j.setAttribute("draggable","true"),j.style.left="200px",j.style.top="150px";var k=docById("statusButtonsDiv");k.style.display="inline",k.style.visibility="visible",k.style.width=a,k.innerHTML='<table cellpadding="0px" id="statusButtonTable"></table>';var l=docById("statusButtonTable"),m=l.createTHead(),n=m.insertRow(0),o=this,p=this._addButton(n,"close-button.svg",c,_("close"));p.onclick=function(){r.style.visibility="hidden",k.style.visibility="hidden",j.style.visibility="hidden"};var q=this._addButton(n,"grab.svg",c,_("drag"));q.style.cursor="move",this._dx=q.getBoundingClientRect().left-j.getBoundingClientRect().left,this._dy=q.getBoundingClientRect().top-j.getBoundingClientRect().top,this._dragging=!1,this._target=!1,this._dragCellHTML=q.innerHTML,q.onmouseover=function(a){q.innerHTML=""},q.onmouseout=function(a){o._dragging||(q.innerHTML=o._dragCellHTML)},i.ondragover=function(a){a.preventDefault()},i.ondrop=function(a){if(o._dragging){o._dragging=!1;var b=a.clientX-o._dx;j.style.left=b+"px";var c=a.clientY-o._dy;j.style.top=c+"px",q.innerHTML=o._dragCellHTML}},j.ondragover=function(a){a.preventDefault()},j.ondrop=function(a){if(o._dragging){o._dragging=!1;var b=a.clientX-o._dx;j.style.left=b+"px";var c=a.clientY-o._dy;j.style.top=c+"px",q.innerHTML=o._dragCellHTML}},j.onmousedown=function(a){o._dragging=!0,o._target=a.target},j.ondragstart=function(a){q.contains(o._target)?a.dataTransfer.setData("text/plain",""):a.preventDefault()};var r=docById("statusTableDiv");r.style.display="inline",r.style.visibility="visible",r.style.border="0px",r.innerHTML='<div id="statusOuterDiv"><div id="statusInnerDiv"><table cellpadding="0px" id="statusTable"></table></div></div>';var s=Math.max(Math.floor(.5*window.innerHeight/100),8),t=docById("statusOuterDiv");if(this._logo.turtles.turtleList.length>s){t.style.height=this._cellScale*MATRIXSOLFEHEIGHT*(s+2)+"px";var g=Math.max(Math.min(window.innerWidth,this._cellScale*d),a);t.style.width=g+"px"}else{this._logo.statusFields.length>4?t.style.height=this._cellScale*(MATRIXBUTTONHEIGHT2+(2+MATRIXSOLFEHEIGHT)*this._logo.turtles.turtleList.length)+30+"px":t.style.height=this._cellScale*(MATRIXBUTTONHEIGHT2+(2+MATRIXSOLFEHEIGHT)*this._logo.turtles.turtleList.length)+"px";var g=Math.max(Math.min(window.innerWidth,this._cellScale*d-20),a);t.style.width=g+"px"}var g=Math.max(Math.min(window.innerWidth,this._cellScale*e),a-b),u=docById("statusInnerDiv");u.style.width=g+"px",u.style.marginLeft=b*this._cellScale+"px";var v=docById("statusTable"),m=v.createTHead(),n=m.insertRow(),h=Math.floor(24*this._cellScale),p=n.insertCell();p.style.backgroundColor=MATRIXBUTTONCOLOR,p.className="headcol",p.style.height=Math.floor(MATRIXBUTTONHEIGHT*this._cellScale)+"px",p.style.width=b*this._cellScale+"px",p.innerHTML="&nbsp;";for(var w=0;w<this._logo.statusFields.length;w++){var p=n.insertCell(w+1);switch(p.style.fontSize=Math.floor(100*this._cellScale)+"%",this._logo.statusFields[w][1]){case"plus":case"minus":case"neg":case"divide":case"power":case"multiply":case"sqrt":case"int":case"mod":var x="";break;case"namedbox":var x=this._logo.blocks.blockList[this._logo.statusFields[w][0]].privateData;break;default:var x=this._logo.blocks.blockList[this._logo.statusFields[w][0]].protoblock.staticLabels[0]}p.innerHTML="&nbsp;<b>"+x+"</b>&nbsp;",p.style.height=Math.floor(MATRIXBUTTONHEIGHT*this._cellScale)+"px",p.style.backgroundColor=MATRIXBUTTONCOLOR}if(_THIS_IS_MUSIC_BLOCKS_){var p=n.insertCell();p.style.fontSize=Math.floor(100*this._cellScale)+"%",p.innerHTML="&nbsp;<b>"+_("note")+"</b>&nbsp;",p.style.height=Math.floor(MATRIXBUTTONHEIGHT*this._cellScale)+"px",p.style.backgroundColor=MATRIXBUTTONCOLOR}for(var y=0,z=0;z<this._logo.turtles.turtleList.length;z++)if(!this._logo.turtles.turtleList[z].trash){var n=m.insertRow(),p=n.insertCell();if(p.style.backgroundColor=MATRIXLABELCOLOR,_THIS_IS_MUSIC_BLOCKS_?p.innerHTML='&nbsp;&nbsp;<img src="images/mouse.svg" title="'+this._logo.turtles.turtleList[z].name+'" alt="'+this._logo.turtles.turtleList[z].name+'" height="'+h+'" width="'+h+'">&nbsp;&nbsp;':p.innerHTML='&nbsp;&nbsp;<img src="header-icons/turtle-button.svg" title="'+this._logo.turtles.turtleList[z].name+'" alt="'+this._logo.turtles.turtleList[z].name+'" height="'+h+'" width="'+h+'">&nbsp;&nbsp;',p.style.width=b*this._cellScale+"px",p.style.height=Math.floor(MATRIXSOLFEHEIGHT*this._cellScale)+"px",p.className="headcol",_THIS_IS_MUSIC_BLOCKS_)for(var w=0;w<this._logo.statusFields.length+1;w++){var p=n.insertCell();p.style.backgroundColor=MATRIXRHYTHMCELLCOLOR,p.style.fontSize=Math.floor(100*this._cellScale)+"%",p.innerHTML="",p.style.height=Math.floor(MATRIXSOLFEHEIGHT*this._cellScale)+"px"}else for(var w=0;w<this._logo.statusFields.length;w++){var p=n.insertCell();p.style.backgroundColor=MATRIXRHYTHMCELLCOLOR,p.style.fontSize=Math.floor(100*this._cellScale)+"%",p.innerHTML="",p.style.height=Math.floor(MATRIXSOLFEHEIGHT*this._cellScale)+"px"}y+=1}},this.updateAll=function(){var a=docById("statusTable");this._logo.updatingStatusMatrix=!0;for(var b=0,c=0;c<this._logo.turtles.turtleList.length;c++)if(!this._logo.turtles.turtleList[c].trash){for(var d=0;d<this._logo.statusFields.length;d++){var e=this._logo.inStatusMatrix;switch(this._logo.inStatusMatrix=!1,this._logo.parseArg(this._logo,c,this._logo.statusFields[d][0]),this._logo.blocks.blockList[this._logo.statusFields[d][0]].name){case"x":case"y":case"heading":var f=this._logo.blocks.blockList[this._logo.statusFields[d][0]].value.toFixed(2);break;case"elapsednotes":var f=mixedNumber(this._logo.blocks.blockList[this._logo.statusFields[d][0]].value);break;case"namedbox":var g=this._logo.blocks.blockList[this._logo.statusFields[d][0]].privateData;if(g in this._logo.boxes)var f=this._logo.boxes[g];else var f="";break;default:var f=this._logo.blocks.blockList[this._logo.statusFields[d][0]].value}var h=f;this._logo.inStatusMatrix=e;var i=a.rows[b+1].cells[d+1];null!=i&&(i.innerHTML=h)}if(_THIS_IS_MUSIC_BLOCKS_){var j="",f="";if(null!=this._logo.noteStatus[c]){for(var k=this._logo.noteStatus[c][0],l=0;l<k.length;l++)j+=k[l],"number"==typeof k[l]?j+="Hz ":j+=" ";var f=this._logo.noteStatus[c][1],m=rationalToFraction(f);j+=m[1]+"/"+m[0]}var i=a.rows[b+1].cells[d+1];null!=i&&(i.innerHTML=j.replace(/#/g,"♯").replace(/b/,"♭"))}b+=1}this._logo.updatingStatusMatrix=!1},this._addButton=function(a,c,d,e){var f=a.insertCell(-1);return f.innerHTML='&nbsp;&nbsp;<img src="header-icons/'+c+'" title="'+e+'" alt="'+e+'" height="'+d+'" width="'+d+'" vertical-align="middle" align-content="center">&nbsp;&nbsp;',f.style.width=b+"px",f.style.minWidth=f.style.width,f.style.maxWidth=f.style.width,f.style.height=f.style.width,f.style.minHeight=f.style.height,f.style.maxHeight=f.style.height,f.style.backgroundColor=MATRIXBUTTONCOLOR,f.onmouseover=function(){this.style.backgroundColor=MATRIXBUTTONCOLORHOVER},f.onmouseout=function(){this.style.backgroundColor=MATRIXBUTTONCOLOR},f}}