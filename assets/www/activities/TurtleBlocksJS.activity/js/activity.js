/*! Sugarizer 2020-03-14 */
function facebookInit(){window.fbAsyncInit=function(){FB.init({appId:"1496189893985945",xfbml:!0,version:"v2.1"})}}const _THIS_IS_MUSIC_BLOCKS_=!1,_THIS_IS_TURTLE_BLOCKS_=!_THIS_IS_MUSIC_BLOCKS_;try{!function(a,b,c){var d,e=a.getElementsByTagName(b)[0];a.getElementById(c)||(d=a.createElement(b),d.id=c,d.src="https://connect.facebook.net/en_US/sdk.js",e.parentNode.insertBefore(d,e))}(document,"script","facebook-jssdk")}catch(a){}var lang=document.webL10n.getLanguage();-1!==lang.indexOf("-")&&(lang=lang.slice(0,lang.indexOf("-")),document.webL10n.setLanguage(lang)),MYDEFINES=_THIS_IS_MUSIC_BLOCKS_?["activity/sugarizer-compatibility","activity/platformstyle","easeljs-0.8.2.min","tweenjs-0.6.2.min","preloadjs-0.6.2.min","Tone.min","howler","p5.min","p5.sound.min","p5.dom.min","mespeak","Chart","activity/utils","activity/artwork","activity/status","activity/munsell","activity/trash","activity/boundary","activity/turtle","activity/palette","activity/protoblocks","activity/blocks","activity/block","activity/turtledefs","activity/logo","activity/clearbox","activity/utilitybox","activity/samplesviewer","activity/basicblocks","activity/blockfactory","activity/analytics","activity/modewidget","activity/soundsamples","activity/pitchtimematrix","activity/pitchdrummatrix","activity/rhythmruler","activity/pitchstaircase","activity/tempo","activity/pitchslider","activity/macros","activity/musicutils","activity/lilypond","prefixfree.min"]:["activity/sugarizer-compatibility","activity/platformstyle","easeljs-0.8.2.min","tweenjs-0.6.2.min","preloadjs-0.6.2.min","howler","p5.min","p5.sound.min","p5.dom.min","mespeak","Chart","activity/utils","activity/artwork","activity/status","activity/munsell","activity/trash","activity/boundary","activity/turtle","activity/palette","activity/protoblocks","activity/blocks","activity/block","activity/turtledefs","activity/logo","activity/clearbox","activity/savebox","activity/utilitybox","activity/samplesviewer","activity/basicblocks","activity/blockfactory","activity/analytics","activity/macros","activity/musicutils","activity/lilypond","prefixfree.min"],define(MYDEFINES,function(a){function b(a){function b(){Ja.showBlocks(),blocksContainer.x=0,blocksContainer.y=0,Ha.initial_x=55,Ha.initial_y=55,Ha.updatePalettes();var a=100*Ra,b=100*Ra;for(var c in Ia.blockList)if(!Ia.blockList[c].trash){var d=Ia.blockList[c];if(null==d.connections[0]){var e=a-d.container.x,f=b-d.container.y;if(Ia.moveBlockRelative(c,e,f),Ia.findDragGroup(c),Ia.dragGroup.length>0)for(var g=0;g<Ia.dragGroup.length;g++){var h=Ia.dragGroup[g];0!==g&&Ia.moveBlockRelative(h,e,f)}a+=200*Ra,a>(Ea.width-100)/Ra&&(a=100*Ra,b+=100*Ra)}}gb[0].visible=!1,gb[1].visible=!0,boundary.hide()}function c(){null!=_a&&(Fa.removeChild(_a),_a=null),Ja.boxes={},Ja.time=0,ga(),Ja.setBackgroundColor(-1),Ja.lilypondOutput=LILYPONDHEADER;for(var a=0;a<Ga.turtleList.length;a++)Ja.turtleHeaps[a]=[],Ja.lilypondStaging[a]=[],Ga.turtleList[a].doClear(!0,!0);blocksContainer.x=0,blocksContainer.y=0,Element.prototype.remove=function(){this.parentElement.removeChild(this)},NodeList.prototype.remove=HTMLCollection.prototype.remove=function(){for(var a=0,b=this.length;a<b;a++)this[a]&&this[a].parentElement&&this[a].parentElement.removeChild(this[a])};var b=document.getElementById("myTable");null!=b&&b.remove()}function d(a){var b=Ja.turtleDelay,c=!1;if(Ja.setTurtleDelay(0),_THIS_IS_MUSIC_BLOCKS_){if("visible"===docById("ptmDiv").style.visibility&&(c=!0,Ja.pitchTimeMatrix.playAll()),"visible"===docById("pscDiv").style.visibility&&(c=!0,pitchstaircase.playUpAndDown()),"visible"===docById("rulerDiv").style.visibility&&("visible"===docById("tempoDiv").style.visibility&&(tempo.isMoving&&tempo.pause(),tempo.resume()),c=!0,rhythmruler.playAll()),c)return;"visible"===docById("tempoDiv").style.visibility&&(tempo.isMoving&&tempo.pause(),tempo.resume())}Ga.running()?0!==b?(console.log("running from step"),Ja.step()):(console.log("stopping..."),Ja.doStopTurtle(),setTimeout(function(){console.log("and running"),Ja.runLogoCommands(null,a)},500)):(console.log("running"),Ja.runLogoCommands(null,a))}function e(){Ja.setTurtleDelay(jb),_THIS_IS_MUSIC_BLOCKS_&&"visible"===docById("ptmDiv").style.visibility?Ja.pitchTimeMatrix.playAll():Ga.running()?Ja.step():Ja.runLogoCommands()}function f(){var a=0;for(var b in Ja.stepQueue)a+=1;0===a||Ja.turtleDelay!==kb?(Ja.setTurtleDelay(kb),Ga.running()||Ja.runLogoCommands(),Ja.step()):(Ja.setTurtleDelay(kb),Ja.step())}function g(){Ja.setNoteDelay(jb),"visible"===docById("ptmDiv").style.visibility?Ja.pitchTimeMatrix.playAll():Ga.running()?Ja.stepNote():Ja.runLogoCommands()}function h(){var a=0;for(var b in Ja.stepQueue)a+=1;0===a||Ja.TurtleDelay!==kb?(Ja.setTurtleDelay(kb),Ga.running()||Ja.runLogoCommands(),Ja.stepNote()):(Ja.setTurtleDelay(kb),Ja.stepNote())}function i(){Ja.doStopTurtle()}function j(){zb?(ja(),zb=!1):(ka(),zb=!0)}function k(){Ab?(la(),Ab=!1):(ma(),Ab=!0)}function l(){Wa=!Wa}function m(a,b){var c=this;c.x=Ea.width/(2*Ra)+300/Math.sqrt(2),c.y=300-300/Math.sqrt(2),this.closeButton=Ba("cancel-button",_("Close"),c.x,c.y,55,0),this.closeButton.on("click",function(d){console.log("Deleting Chart"),c.closeButton.visible=!1,Fa.removeChild(a),Ja.showBlocks(),Bb=!0,b.clearRect(0,0,600,600)})}function o(a){var b=document.createElement("canvas");return b.width=a.width,b.height=a.height,a.toDataURL()==b.toDataURL()}function p(){var a=docById("myChart");if(0!=o(a)){var b=a.getContext("2d");document.body.style.cursor="wait";var c=null,d=analyzeProject(Ia);console.log(d);var e=scoreToChartData(d),f=this;f.close=m;var g=function(){var a=c.toBase64Image(),d=new Image;d.onload=function(){var a=new createjs.Bitmap(d);Fa.addChild(a),a.x=Ea.width/(2*Ra)-300,a.y=0,a.scaleX=a.scaleY=a.scale=600/a.image.width,Ja.hideBlocks(),Bb=!0,document.body.style.cursor="default",f.close(a,b)},d.src=a},h=getChartOptions(g);console.log("creating new chart"),c=new Chart(b).Radar(e,h)}}function q(){mb<lb.length-1&&(mb+=1,Ia.setBlockScale(lb[mb]))}function r(){mb>0&&(mb-=1,Ia.setBlockScale(lb[mb]))}function s(){if(docById("loader").className="loader",Fa=new createjs.Stage(Ea),createjs.Touch.enable(Fa),createjs.Ticker.timingMode=createjs.Ticker.RAF_SYNCHED,createjs.Ticker.setFPS(30),createjs.Ticker.addEventListener("tick",Fa),createjs.Ticker.addEventListener("tick",Q),A("#ffffff","#7a7a7a",function(a){Eb=a},55),A("#ffcbc4","#ff0031",function(a){Fb=a},110),B(),palettesContainer=new createjs.Container,blocksContainer=new createjs.Container,trashContainer=new createjs.Container,turtleContainer=new createjs.Container,Fa.addChild(turtleContainer,trashContainer,blocksContainer,palettesContainer),t(),trashcan=new Trashcan,trashcan.setCanvas(Ea).setStage(trashContainer).setSize(rb).setRefreshCanvas(P).init(),Ga=new Turtles,Ga.setCanvas(Ea).setStage(turtleContainer).setRefreshCanvas(P),boundary=new Boundary,boundary.setStage(blocksContainer).init(),Ia=new Blocks,Ia.setCanvas(Ea).setStage(blocksContainer).setRefreshCanvas(P).setTrashcan(trashcan).setUpdateStage(Fa.update).setGetStageScale(v).setTurtles(Ga).setErrorMsg(ia),Ia.makeCopyPasteButtons(Ba,ta),Ga.setBlocks(Ia),Ha=new Palettes,Ha.setCanvas(Ea).setStage(palettesContainer).setRefreshCanvas(P).setSize(rb).setTrashcan(trashcan).setBlocks(Ia).init(),initPalettes(Ha),Ja=new Logo,Ja.setCanvas(Ea).setBlocks(Ia).setTurtles(Ga).setStage(turtleContainer).setRefreshCanvas(P).setTextMsg(ha).setErrorMsg(ia).setHideMsgs(ga).setOnStopTurtle(N).setOnRunTurtle(O).setGetStageX(w).setGetStageY(x).setGetStageMouseDown(y).setGetCurrentKeyCode(E).setClearCurrentKeyCode(F).setMeSpeak(meSpeak).setSaveLocally($),Ia.setLogo(Ja),Ja.setBackgroundColor(-1),Ka=new ClearBox,Ka.setCanvas(Ea).setStage(Fa).setRefreshCanvas(P).setClear(K),_THIS_IS_TURTLE_BLOCKS_&&(ab=new SaveBox,ab.setCanvas(Ea).setStage(Fa).setRefreshCanvas(P).setSaveTB(T).setSaveSVG(U).setSavePNG(V).setSavePlanet(W).setSaveFB(X)),La=new UtilityBox,La.setStage(Fa).setRefreshCanvas(P).setBigger(q).setSmaller(r).setPlugins(pa).setStats(p).setScroller(l),Ma=new SamplesViewer,Ma.setStage(Fa).setRefreshCanvas(P).setClear(K).setLoad(ba).setLoadRaw(ca).init(),initBasicProtoBlocks(Ha,Ia),macroData=storage.macros,null!=macroData&&processMacroData(macroData,Ha,Ia,cb),Ia.setMacroDictionary(cb),Ha.setMacroDictionary(cb),pluginData=storage.plugins,null!=pluginData){var a=processPluginData(pluginData,Ha,Ia,Ja.evalFlowDict,Ja.evalArgDict,Ja.evalParameterDict,Ja.evalSetterDict,Ja.evalOnStartList,Ja.evalOnStopList);updatePluginObj(a)}var b=storage.custommode;void 0!=b&&(customMode=JSON.parse(b),console.log("restoring custom mode: "+customMode)),Na.addEventListener("click",function(a){this.value=null}),Na.addEventListener("change",function(a){var b=new FileReader;b.onload=function(a){document.body.style.cursor="wait",setTimeout(function(){var a=b.result,c=a.replace("\n"," "),d=JSON.parse(c);for(var e in Ia.palettes.dict)Ia.palettes.dict[e].hideMenu(!0);P(),Ia.loadNewBlocks(d),document.body.style.cursor="default"},200)},b.readAsText(Na.files[0])},!1),Pa.addEventListener("click",function(a){this.value=null}),Oa.addEventListener("click",function(a){window.scroll(0,0),this.value=null}),Oa.addEventListener("change",function(b){window.scroll(0,0);var c=new FileReader;c.onload=function(b){document.body.style.cursor="wait",setTimeout(function(){if(null!=(a=processRawPluginData(c.result,Ha,Ia,ia,Ja.evalFlowDict,Ja.evalArgDict,Ja.evalParameterDict,Ja.evalSetterDict,Ja.evalOnStartList,Ja.evalOnStopList))){var b=preparePluginExports(a);console.log(b),storage.plugins=b}setTimeout(function(){Ha.visible&&Ha.hide(),Ha.show(),Ha.bringToTop()},1e3),document.body.style.cursor="default"},200)},c.readAsText(Oa.files[0])},!1),Fa.mouseMoveOutside=!0,Fa.enableMouseOver(10),Cb=z("images/Cartesian.svg"),Db=z("images/polar.svg");var c=window.location.href,d=null,e=!1;ua(),G();var f,g=[];if(!sugarizerCompatibility.isInsideSugarizer()&&c.indexOf("?")>0){var f=c.split("?");if(f[1].indexOf("&")>0){for(var h=f[1].split("&"),i=0;i<h.length;i++)if(h[i].indexOf("=")>0){var j=h[i].split("=");switch(j[0].toLowerCase()){case"file":d=j[1];break;case"run":"true"===j[1].toLowerCase()&&(e=!0);break;case"inurl":var k=j[1],m=function(a){return new Promise(function(b,c){var d=new XMLHttpRequest;d.open("get",a,!0),d.responseType="json",d.onload=function(){var a=d.status;200===a?b(d.response):c(a)},d.send()})};m(k).then(function(a){console.log("Your Json result is:  "+a.arg),n=a.arg,g.push(parseInt(n))},function(a){alert("Something went wrong.")});break;case"outurl":var k=j[1];break;default:ia("Invalid parameters")}}}else{if(f[1].indexOf("=")>0)var j=f[1].split("=");"file"===j[0].toLowerCase()&&(d=j[1])}}null!=d?setTimeout(function(){console.log("loading "+d),da(ba,d,e,g)},2e3):setTimeout(function(){da(fa)},2e3),document.addEventListener("mousewheel",u,!1),document.addEventListener("DOMMouseScroll",u,!1),this.document.onkeydown=D,qa()}function t(){var a=!1;Fa.on("stagemousemove",function(a){ob=a.stageX,pb=a.stageY}),Fa.on("stagemousedown",function(b){if(nb=!0,null!=Fa.getObjectUnderPoint()|Ga.running())return void Fa.on("stagemouseup",function(a){nb=!1});a=!0,lastCords={x:b.stageX,y:b.stageY},Fa.on("stagemousemove",function(b){a&&(Ia.inLongPress&&(Ia.saveStackButton.visible=!1,Ia.dismissButton.visible=!1,Ia.inLongPress=!1),Wa&&(blocksContainer.x+=b.stageX-lastCords.x,blocksContainer.y+=b.stageY-lastCords.y,lastCords={x:b.stageX,y:b.stageY},P()))}),Fa.on("stagemouseup",function(b){nb=!1,a=!1},null,!0)})}function u(a){var b=a.wheelDelta||-a.detail,c=Math.max(-1,Math.min(1,b)),d=30;a.clientX<rb?(Ha.menuScrollEvent(c,d),Ha.hidePaletteIconCircles()):(palette=Ha.findPalette(a.clientX/Ra,a.clientY/Ra),palette&&palette.scrollEvent(c,d))}function v(){return Ra}function w(){return Ga.screenX2turtleX(ob/Ra)}function x(){return Ga.screenY2turtleY(pb/Ra)}function y(){return nb}function z(a){var b=new Image;b.src=a;var c=new createjs.Container;Fa.addChild(c);var d=new createjs.Bitmap(b);return c.addChild(d),d.cache(0,0,1200,900),d.x=(Ea.width-1200)/2,d.y=(Ea.height-900)/2,d.scaleX=d.scaleY=d.scale=1,d.visible=!1,d.updateCache(),d}function A(a,b,c,d){var e=new createjs.Container;Fa.addChild(e),e.x=(Ea.width-1e3)/2,e.y=d,e.visible=!1;var f=new Image,g=MSGBLOCK.replace("fill_color",a).replace("stroke_color",b);f.onload=function(){var a=new createjs.Bitmap(f);e.addChild(a);var b=new createjs.Text("your message here","20px Arial","#000000");e.addChild(b),b.textAlign="center",b.textBaseline="alphabetic",b.x=500,b.y=30;var d=e.getBounds();e.cache(d.x,d.y,d.width,d.height);var g=new createjs.Shape;g.graphics.beginFill("#FFF").drawRect(0,0,1e3,42),g.x=0,g.y=0,e.hitArea=g,e.on("click",function(a){e.visible=!1,null!=Gb&&Gb.removeAllChildren(),Bb=!0}),c(b),Ia.setMsgText(b)},f.src="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(g)))}function B(){for(var a=0;a<Ib.length;a++){C(Ib[a])}}function C(a){var b=new createjs.Container;Fa.addChild(b),b.x=(Ea.width-1e3)/2,b.y=110,Hb[a]=b,Hb[a].name=a,Hb[a].visible=!1;var c=new Image;c.onload=function(){var a=new createjs.Bitmap(c);b.addChild(a);var d=new createjs.Text("","20px Sans","#000000");b.addChild(d),d.x=70,d.y=10;var e=b.getBounds();b.cache(e.x,e.y,e.width,e.height);var f=new createjs.Shape;f.graphics.beginFill("#FFF").drawRect(0,0,e.width,e.height),f.x=0,f.y=0,b.hitArea=f,b.on("click",function(a){b.visible=!1,null!=Gb&&Gb.removeAllChildren(),Bb=!0})},c.src="images/"+a+".svg"}function D(a){if(!docById("labelDiv").classList.contains("hasKeyboard")){if(_THIS_IS_MUSIC_BLOCKS_){if(docById("BPMInput").classList.contains("hasKeyboard"))return;if(docById("musicratio1").classList.contains("hasKeyboard"))return;if(docById("musicratio2").classList.contains("hasKeyboard"))return;if(docById("dissectNumber").classList.contains("hasKeyboard"))return}const e=9;a.keyCode!==e&&a.keyCode!==8||a.preventDefault();if(a.altKey)switch(a.keyCode){case 69:c();break;case 82:d();break;case 83:Ja.doStopTurtle()}else if(a.ctrlKey);else{switch(a.keyCode){case 38:null!=Ia.activeBlock?(Ia.moveStackRelative(Ia.activeBlock,0,-STANDARDBLOCKHEIGHT/2),Ia.blockMoved(Ia.activeBlock),Ia.adjustDocks(Ia.activeBlock,!0)):Ha.mouseOver?(Ha.menuScrollEvent(1,10),Ha.hidePaletteIconCircles()):null!=Ha.activePalette?Ha.activePalette.scrollEvent(STANDARDBLOCKHEIGHT,1):Wa&&(blocksContainer.y-=21);break;case 40:null!=Ia.activeBlock?(Ia.moveStackRelative(Ia.activeBlock,0,STANDARDBLOCKHEIGHT/2),Ia.blockMoved(Ia.activeBlock),Ia.adjustDocks(Ia.activeBlock,!0)):Ha.mouseOver?(Ha.menuScrollEvent(-1,10),Ha.hidePaletteIconCircles()):null!=Ha.activePalette?Ha.activePalette.scrollEvent(-STANDARDBLOCKHEIGHT,1):Wa&&(blocksContainer.y+=21);break;case 37:null!=Ia.activeBlock?(Ia.moveStackRelative(Ia.activeBlock,-STANDARDBLOCKHEIGHT/2,0),Ia.blockMoved(Ia.activeBlock),Ia.adjustDocks(Ia.activeBlock,!0)):Wa&&(blocksContainer.x-=21);break;case 39:null!=Ia.activeBlock?(Ia.moveStackRelative(Ia.activeBlock,STANDARDBLOCKHEIGHT/2,0),Ia.blockMoved(Ia.activeBlock),Ia.adjustDocks(Ia.activeBlock,!0)):Wa&&(blocksContainer.x+=21);break;case 36:if(Ha.mouseOver){var f=Math.max(55-Ha.buttons.rhythm.y,0);Ha.menuScrollEvent(1,f),Ha.hidePaletteIconCircles()}else null!=Ha.activePalette?Ha.activePalette.scrollEvent(-Ha.activePalette.scrollDiff,1):b();break;case e:break;case 27:Aa();break;case 13:Ja.runLogoCommands()}Xa=String.fromCharCode(a.keyCode),Ya=a.keyCode}}}function E(){return Ya}function F(){Xa="",Ya=0}function G(){if(!docById("labelDiv").classList.contains("hasKeyboard")){if(platform.androidWebkit)var a=window.outerWidth,b=window.outerHeight;else var a=window.innerWidth,b=window.innerHeight;var c=Math.min(a,b);if(c<11*rb){var d=!0;Ra=a<10*rb?c/(11*rb):Math.max(c/(11*rb),.75)}else{var d=!1;Ra=a/1200>b/900?a/1200:b/900}Fa.scaleX=Ra,Fa.scaleY=Ra,Fa.canvas.width=a,Fa.canvas.height=b,Ga.setScale(Ra),Ia.setScale(Ra),boundary.setScale(a,b,Ra),Ha.setScale(Ra),trashcan.resizeEvent(Ra),ua(d),Cb.x=Ea.width/(2*Ra)-600,Cb.y=Ea.height/(2*Ra)-450,Db.x=Ea.width/(2*Ra)-600,Db.y=Ea.height/(2*Ra)-450,Bb=!0,xa(!0),d?(Ha.setMobile(!0),Ha.hide()):(Ha.setMobile(!1),Ha.show(),Ha.bringToTop());for(var e=0;e<Ga.turtleList.length;e++)Ga.turtleList[e].doClear(!1,!1);var f=document.getElementById("overlayCanvas");f.width=a,f.height=b}}function H(){for(var a in Ia.palettes.dict)Ia.palettes.dict[a].hideMenu(!0);P();var b=0,c=3*-rb;if(0===Ia.trashStacks.length)return void console.log("Trash is empty--nothing to do");var d=Ia.trashStacks.pop();Ia.findDragGroup(d);for(var e=0;e<Ia.dragGroup.length;e++){var f=Ia.dragGroup[e];Ia.blockList[f].trash=!1,Ia.moveBlockRelative(f,b,c),Ia.blockList[f].show()}if(Ia.raiseStackToTop(d),"start"===Ia.blockList[d].name||"drum"===Ia.blockList[d].name){var g=Ia.blockList[d].value;Ga.turtleList[g].trash=!1,Ga.turtleList[g].container.visible=!0}else if("action"===Ia.blockList[d].name){var h=Ia.blockList[Ia.blockList[d].connections[1]];if(null!=h){var i=h.value;Ia.blockList[d].trash=!0;var j=Ia.findUniqueActionName(i);if(Ia.blockList[d].trash=!1,j!==h){console.log("renaming action when restoring from trash. old name: "+i+" unique name: "+j),h.value=j;var k=h.value.toString();k.length>8&&(k=k.substr(0,7)+"..."),h.text.text=k,null!=h.label&&(h.label.value=j),h.container.updateCache();for(var e=0;e<Ia.dragGroup.length;e++){var l=Ia.blockList[Ia.dragGroup[e]];if(-1!==["nameddo","nameddoArg","namedcalc","namedcalcArg"].indexOf(l.name)&&l.privateData===i){console.log("reassigning nameddo to "+j),l.privateData=j,l.value=j;var k=l.value.toString();k.length>8&&(k=k.substr(0,7)+"..."),l.text.text=k,l.overrideName=k,l.regenerateArtwork(),l.container.updateCache()}}}var m=h.value;m!==_("action")&&console.log("FIXME: Check for unique action name here")}}Ia.refreshCanvas()}function I(){Ka.show(Ra)}function J(){La.init(Ra,ub.x-27,ub.y,Ba)}function K(a,b){for(var c in Ia.palettes.dict)Ia.palettes.dict[c].hideMenu(!0);P();var d=3*rb;for(var e in Ia.blockList){if(null==Ia.blockList[e].connections[0]&&Ia.trashStacks.push(e),"start"===Ia.blockList[e].name||"drum"===Ia.blockList[e].name){console.log("start blk "+e+" value is "+Ia.blockList[e].value);var f=Ia.blockList[e].value;Ia.blockList[e].trash||null==f||(console.log("sending turtle "+f+" to trash"),Ga.turtleList[f].trash=!0,Ga.turtleList[f].container.visible=!1)}else"action"===Ia.blockList[e].name&&(Ia.blockList[e].trash||Ia.deleteActionBlock(Ia.blockList[e]));Ia.blockList[e].trash=!0,Ia.moveBlockRelative(e,0,d),Ia.blockList[e].hide()}a?Ia.loadNewBlocks(DATAOBJS):b||$(),Bb=!0}function L(){Ia.visible?(Ja.hideBlocks(),Ha.hide()):(null!=_a&&(Fa.removeChild(_a),_a=null),Ja.showBlocks(),Ha.show(),Ha.bringToTop())}function M(){Ia.visible&&(console.log("calling toggleCollapsibles"),Ia.toggleCollapsibles())}function N(){db.visible&&qa()}function O(){db.visible||ra()}function P(){Bb=!0}function Q(a){Bb&&(Bb=!1,Fa.update(a))}function R(){_THIS_IS_MUSIC_BLOCKS_&&(localStorage.setItem("isMatrixHidden",docById("ptmDiv").style.visibility),localStorage.setItem("isStaircaseHidden",docById("pscDiv").style.visibility),localStorage.setItem("isPitchDrumMatrixHidden",docById("pdmDiv").style.visibility),localStorage.setItem("isRhythmRulerHidden",docById("rulerDiv").style.visibility),localStorage.setItem("isModeWidgetHidden",docById("modeDiv").style.visibility),localStorage.setItem("isSliderHidden",docById("sliderDiv").style.visibility),localStorage.setItem("isTempoHidden",docById("tempoDiv").style.visibility),"hidden"!==docById("ptmDiv").style.visibility&&(docById("ptmDiv").style.visibility="hidden",docById("ptmTableDiv").style.visibility="hidden",docById("ptmButtonsDiv").style.visibility="hidden"),"hidden"!==docById("pdmDiv").style.visibility&&(docById("pdmDiv").style.visibility="hidden",docById("pdmButtonsDiv").style.visibility="hidden",docById("pdmTableDiv").style.visibility="hidden"),"hidden"!==docById("rulerDiv").style.visibility&&(docById("rulerDiv").style.visibility="hidden",docById("rulerTableDiv").style.visibility="hidden",docById("rulerButtonsDiv").style.visibility="hidden"),"hidden"!==docById("pscDiv").style.visibility&&(docById("pscDiv").style.visibility="hidden",docById("pscTableDiv").style.visibility="hidden",docById("pscButtonsDiv").style.visibility="hidden"),"hidden"!==docById("statusDiv").style.visibility&&(docById("statusDiv").style.visibility="hidden",docById("statusButtonsDiv").style.visibility="hidden",docById("statusTableDiv").style.visibility="hidden"),"hidden"!==docById("sliderDiv").style.visibility&&(docById("sliderDiv").style.visibility="hidden",docById("sliderButtonsDiv").style.visibility="hidden",docById("sliderTableDiv").style.visibility="hidden"),"hidden"!==docById("modeDiv").style.visibility&&(docById("modeDiv").style.visibility="hidden",docById("modeButtonsDiv").style.visibility="hidden",docById("modeTableDiv").style.visibility="hidden"),"hidden"!==docById("tempoDiv").style.visibility&&null!=Ja.tempo&&Ja.tempo.hide()),localStorage.setItem("isStatusHidden",docById("statusDiv").style.visibility),Ja.doStopTurtle(),wb.visible=!1,docById("helpElem").style.visibility="hidden",console.log("save locally"),$(),Ma.show()}function S(){if(_THIS_IS_MUSIC_BLOCKS_){console.log("Saving .tb file");download("My Project"+".tb","data:text/plain;charset=utf-8,"+oa())}else ab.init(Ra,vb.x-27,vb.y-97,Ba)}function T(){var a=prompt("Filename:","untitled.tb");null!=a&&("tb"!==fileExt(a)&&(a+=".tb"),download(a,"data:text/plain;charset=utf-8,"+encodeURIComponent(oa())))}function U(){var a=prompt("Filename:","untitled.svg");if(null!=a){"svg"!==fileExt(a)&&(a+=".svg");var b=doSVG(Ja.canvas,Ja,Ja.turtles,Ja.canvas.width,Ja.canvas.height,1);download(a,"data:image/svg+xml;utf8,"+b,a,'"width='+Ja.canvas.width+", height="+Ja.canvas.height+'"')}}function V(){alert("Unavailable at the moment")}function W(){$(),Ma.show()}function X(){alert("Facebook Sharing : disabled")}function Y(){console.log("Loading .tb file"),document.querySelector("#myOpenFile").focus(),document.querySelector("#myOpenFile").click(),window.scroll(0,0)}function Z(){document.body.style.cursor="wait",console.log("Saving .ly file"),Ja.runningLilypond=!0,Ja.lilypondOutput=LILYPONDHEADER,Ja.lilypondNotes={};for(var a=0;a<Ga.turtleList.length;a++)Ja.lilypondStaging[a]=[],Ga.turtleList[a].doClear(!0,!0);Ja.runLogoCommands()}function $(){if(sugarizerCompatibility.isInsideSugarizer()?storage=sugarizerCompatibility.data:storage=localStorage,console.log("overwriting session data"),void 0===storage.currentProject)try{storage.currentProject="My Project",storage.allProjects=JSON.stringify(["My Project"])}catch(a){console.log(a)}try{var a=storage.currentProject;storage["SESSION"+a]=oa()}catch(a){console.log(a)}var b=new Image,c=doSVG(Ea,Ja,Ga,320,240,320/Ea.width);b.onload=function(){var c=new createjs.Bitmap(b),d=c.getBounds();c.cache(d.x,d.y,d.width,d.height);try{storage["SESSIONIMAGE"+a]=c.getCacheDataURL()}catch(a){console.log(a)}},b.src="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(c))),sugarizerCompatibility.isInsideSugarizer()&&sugarizerCompatibility.saveLocally()}function aa(a){console.log("Running Project from Event"),document.removeEventListener("finishedLoading",aa),setTimeout(function(){console.log("Run"),L(),d(a)},5e3)}function ba(a,b,c){b=void 0!==b&&b,document.body.style.cursor="wait",setTimeout(function(){"tb"!==fileExt(a)&&(a+=".tb");try{try{httpGet(null),console.log("running from server or the user can access to examples."),Qa=!0}catch(a){console.log("running from filesystem or the connection isnt secure"),Qa=!1}if(Qa)var b=httpGet(a),c=b.replace("\n","");for(var d in Ia.palettes.dict)Ia.palettes.dict[d].hideMenu(!0);var e=JSON.parse(c);Ia.loadNewBlocks(e),$()}catch(a){console.log(a),da(fa)}document.body.style.cursor="default",Bb=!0},200),b&&yb&&(document.addEventListener?document.addEventListener("finishedLoading",function(){aa(c)},!1):document.attachEvent("finishedLoading",function(){aa(c)})),yb=!1}function ca(a){console.log("loadRawProject "+a),document.body.style.cursor="wait",c();for(var b in Ia.palettes.dict)Ia.palettes.dict[b].hideMenu(!0);var d=JSON.parse(a);Ia.loadNewBlocks(d),document.body.style.cursor="default"}function da(a,b,c,d){var e=new Date;a(b,c,d);var f=new Date,g=f.getTime()-e.getTime(),h=Math.max(6e3-g);setTimeout(ea,h)}function ea(){docById("loading-image-container").style.display="none",docById("hideContents").style.display="block"}function fa(){console.log("LOAD START"),justLoadStart=function(){console.log("loading start and a matrix"),Ia.loadNewBlocks(DATAOBJS)},sugarizerCompatibility.isInsideSugarizer()?storage=sugarizerCompatibility.data:storage=localStorage,sessionData=null;var a=storage.currentProject;if(sessionData=storage["SESSION"+a],sessionData)try{if("undefined"===sessionData||"[]"===sessionData)console.log("empty session found: loading start"),justLoadStart();else{console.log("restoring session: "+sessionData);for(var b in Ia.palettes.dict)Ia.palettes.dict[b].hideMenu(!0);Ia.loadNewBlocks(JSON.parse(sessionData))}}catch(a){console.log(a)}else justLoadStart();Bb=!0}function ga(){Fb.parent.visible=!1,null!=Gb&&(Gb.removeAllChildren(),P()),Eb.parent.visible=!1;for(var a in Hb)Hb[a].visible=!1}function ha(a){if(null!=Eb){var b=Eb.parent;b.visible=!0,Eb.text=a,b.updateCache(),Fa.setChildIndex(b,Fa.getNumChildren()-1)}}function ia(a,b,c){if(qa(),null!=Fb){if(void 0!==b&&null!=b&&!Ia.blockList[b].collapsed){var d=(Ea.width-1e3)/2,e=128,f=Ia.blockList[b].container.x+blocksContainer.x,g=Ia.blockList[b].container.y+blocksContainer.y;null==Gb&&(Gb=new createjs.Container,Fa.addChild(Gb));var h=new createjs.Shape;Gb.addChild(h),h.graphics.setStrokeStyle(4).beginStroke("#ff0031").moveTo(d,e).lineTo(f,g),Fa.setChildIndex(Gb,Fa.getNumChildren()-1);var i=Math.atan2(f-d,e-g)/Math.PI*180,j=new createjs.Shape;Gb.addChild(j),j.graphics.setStrokeStyle(4).beginStroke("#ff0031").moveTo(-10,18).lineTo(0,0).lineTo(10,18),j.x=f,j.y=g,j.rotation=i}switch(a){case NOMICERRORMSG:Hb.nomicrophone.visible=!0,Fa.setChildIndex(Hb.nomicrophone,Fa.getNumChildren()-1);break;case NOSTRINGERRORMSG:Hb.notastring.visible=!0,Fa.setChildIndex(Hb.notastring,Fa.getNumChildren()-1);break;case EMPTYHEAPERRORMSG:Hb.emptyheap.visible=!0,Fa.setChildIndex(Hb.emptyheap,Fa.getNumChildren()-1);break;case NOSQRTERRORMSG:Hb.negroot.visible=!0,Fa.setChildIndex(Hb.negroot,Fa.getNumChildren()-1);break;case NOACTIONERRORMSG:null==c&&(c="foo"),Hb.nostack.children[1].text=c,Hb.nostack.visible=!0,Hb.nostack.updateCache(),Fa.setChildIndex(Hb.nostack,Fa.getNumChildren()-1);break;case NOBOXERRORMSG:null==c&&(c="foo"),Hb.emptybox.children[1].text=c,Hb.emptybox.visible=!0,Hb.emptybox.updateCache(),Fa.setChildIndex(Hb.emptybox,Fa.getNumChildren()-1);break;case ZERODIVIDEERRORMSG:Hb.zerodivide.visible=!0,Fa.setChildIndex(Hb.zerodivide,Fa.getNumChildren()-1);break;case NANERRORMSG:Hb.notanumber.visible=!0,Fa.setChildIndex(Hb.notanumber,Fa.getNumChildren()-1);break;case NOINPUTERRORMSG:Hb.noinput.visible=!0,Fa.setChildIndex(Hb.noinput,Fa.getNumChildren()-1);break;default:var k=Fb.parent;k.visible=!0,Fb.text=a,Fa.setChildIndex(k,Fa.getNumChildren()-1),k.updateCache()}Bb=!0}}function ja(){Cb.visible=!1,Cb.updateCache(),Bb=!0}function ka(){Cb.visible=!0,Cb.updateCache(),Bb=!0}function la(){Db.visible=!1,Db.updateCache(),Bb=!0}function ma(){Db.visible=!0,Db.updateCache(),Bb=!0}function na(){Ia.pasteStack()}function oa(){for(var a=[],b=0;b<Ia.blockList.length;b++){var c=Ia.blockList[b];c.trash||a.push(b)}for(var d=[],b=0;b<Ia.blockList.length;b++){var c=Ia.blockList[b];if(!c.trash){if(c.isValueBlock()||"loadFile"===c.name)var e={value:c.value};else if("start"===c.name||"drum"===c.name){var f=Ga.turtleList[c.value];if(null==f)var e={collapsed:!1,xcor:0,ycor:0,heading:0,color:0,shade:50,pensize:5,grey:100};else var e={collapsed:c.collapsed,xcor:f.x,ycor:f.y,heading:f.orientation,color:f.color,shade:f.value,pensize:f.stroke,grey:f.chroma}}else if("action"===c.name)var e={collapsed:c.collapsed};else if("matrix"===c.name)var e={collapsed:c.collapsed};else if("pitchdrummatrix"===c.name)var e={collapsed:c.collapsed};else if("status"===c.name)var e={collapsed:c.collapsed};else if("namedbox"===c.name)var e={value:c.privateData};else if("nameddo"===c.name)var e={value:c.privateData};else if("nameddoArg"===c.name)var e={value:c.privateData};else if("namedcalc"===c.name)var e={value:c.privateData};else if("namedcalcArg"===c.name)var e={value:c.privateData};else if("namedarg"===c.name)var e={value:c.privateData};else if("matrixData"===c.name){var e={notes:window.savedMatricesNotes,count:window.savedMatricesCount};!0}else var e={};connections=[];for(var g=0;g<c.connections.length;g++){var h=a.indexOf(c.connections[g]);null==c.connections[g]||-1===h?connections.push(null):connections.push(h)}d.push([a.indexOf(b),[c.name,e],c.container.x,c.container.y,connections])}}return JSON.stringify(d)}function pa(){Oa.focus(),Oa.click()}function qa(){db.visible=!1}function ra(){db.visible=!0}function sa(a){function b(){createjs.Tween.get(a).to({alpha:1,visible:!0},500)}createjs.Tween.get(a).to({alpha:0,visible:!1},1e3).call(b)}function ta(){if(null===$a){var a=new Image;a.onload=function(){var b=55,c=Math.floor(rb/2),d=new createjs.Bitmap(a);rb!==b&&(d.scaleX=rb/b,d.scaleY=rb/b),d.regX=c/d.scaleX,d.regY=c/d.scaleY,Za.addChild(d),$a=d,Bb=!0},a.src="header-icons/paste-button.svg"}else sa($a)}function ua(a){if(void 0!==Ta){Fa.removeChild(Ta);for(var j in sb)Fa.removeChild(sb[j])}if(Ta=new createjs.Shape,Ta.graphics.f(platformColor.header).r(0,0,screen.width/Ra,rb),platformColor.doHeaderShadow&&(Ta.shadow=new createjs.Shadow("#777",0,2,2)),Fa.addChild(Ta),_THIS_IS_MUSIC_BLOCKS_)var k=[["run",d,_("Run fast / long press to run slowly / extra-long press to run music slowly"),e,g,"slow-button","slow-music-button"],["step",f,_("Run step by step"),null,null,null,null],["step-music",h,_("Run note by note"),null,null,null,null],["stop-turtle",i,_("Stop"),null,null,null,null],["clear",c,_("Clean"),null,null,null,null],["hide-blocks",L,_("Show/hide blocks"),null,null,null,null],["collapse-blocks",M,_("Expand/collapse collapsable blocks"),null,null,null,null],["go-home",b,_("Home"),null,null,null,null],["help",xa,_("Help"),null,null,null,null]];else var k=[["run",d,_("Run fast / long press to run slowly"),e,null,"slow-button",null],["step",f,_("Run step by step"),null,null,null,null],["stop-turtle",i,_("Stop"),null,null,null,null],["clear",c,_("Clean"),null,null,null,null],["hide-blocks",L,_("Show/hide blocks"),null,null,null,null],["collapse-blocks",M,_("Expand/collapse collapsable blocks"),null,null,null,null],["go-home",b,_("Home"),null,null,null,null],["help",xa,_("Help"),null,null,null,null]];sugarizerCompatibility.isInsideSugarizer()&&k.push(["sugarizer-stop",function(){sugarizerCompatibility.data.blocks=oa(),sugarizerCompatibility.saveLocally(function(){sugarizerCompatibility.sugarizerStop()})},"Stop",null,null,null,null]),a&&k.unshift(["popdown-palette",wa]);for(var l=rb,m=Math.floor(l/2),n=m,o=l,p=0,j=0;j<k.length;j++)if(getMainToolbarButtonNames(k[j][0])){var q=Ba(k[j][0]+"-button",k[j][2],m,n,l,0);if(Ca(q,m,n,k[j][1],k[j][3],k[j][4],k[j][5],k[j][6]),sb.push(q),"stop-turtle"===k[j][0])db=q,eb=m,fb=n;else if("go-home"===k[j][0]){gb=[],gb.push(q),hb=m,ib=n;var r=Ba("go-home-faded-button",_("Home"),m,n,l,0);Ca(r,m,n,k[j][1],null,null,null,null),gb.push(r),sb.push(r),gb[0].visible=!1,gb[1].visible=!0,boundary.hide(),Ia.setHomeContainers(gb,boundary)}m+=o,n+=p}else console.log("continue");va(Ra)}function va(a){if(void 0!==Va){Fa.removeChild(Va);for(var b in tb)Fa.removeChild(tb[b])}if(_THIS_IS_MUSIC_BLOCKS_)var c=[["planet",R,_("Load samples from server")],["open",Y,_("Load project from files")],["save",S,_("Save project")],["lilypond",Z,_("Save sheet music")],["paste-disabled",na,_("Paste")],["Cartesian",j,_("Cartesian")],["polar",k,_("Polar")],["utility",J,_("Settings")],["empty-trash",I,_("Delete all")],["restore-trash",H,_("Undo")]];else var c=[["planet",R,_("Load samples from server")],["open",Y,_("Load project from files")],["save",S,_("Save project")],["paste-disabled",na,_("Paste")],["Cartesian",j,_("Cartesian")],["polar",k,_("Polar")],["utility",J,_("Settings")],["empty-trash",I,_("Delete all")],["restore-trash",H,_("Undo")]];document.querySelector("#myOpenFile").addEventListener("change",function(a){Ma.model.controller.hide()});var d=rb,e=Math.floor(Ea.width/a)-d/2,f=Math.floor(d/2),g=0,h=d;Va=Ba("menu-button","",e,f,d,Ua?90:void 0),Ca(Va,e,f,ya,null,null,null,null);for(var b=0;b<c.length;b++)if(getAuxToolbarButtonNames(c[b][0])){e+=g,f+=h;var i=Ba(c[b][0]+"-button",c[b][2],e,f,d,0);Ca(i,e,f,c[b][1],null,null,null,null),tb.push(i),"utility"===c[b][0]?ub=i:"save"===c[b][0]&&(vb=i),i.visible=!1}if(Ua)for(var l in tb)tb[l].visible=!0}function wa(){console.log("doPopdownPalette"),new PopdownPalette(Ha).popdown()}function xa(a){if(xb=0,a){if(null==wb){wb=new createjs.Container,Fa.addChild(wb),wb.x=65,wb.y=65,wb.on("click",function(a){var b=wb.getBounds();if(a.stageY<wb.y+b.height/2)wb.visible=!1,docById("helpElem").style.visibility="hidden";else{xb+=1,xb>=HELPCONTENT.length&&(xb=0);var d=55*Ra;c.innerHTML='<img src ="'+HELPCONTENT[xb][2]+'" style="height:'+d+'px; width: auto"></img> <h2>'+HELPCONTENT[xb][0]+"</h2><p>"+HELPCONTENT[xb][1]+"</p>"}Bb=!0});var b=new Image;b.onload=function(){console.log(Ra);var a=new createjs.Bitmap(b);wb.children.length>0&&(console.log("delete old help container"),wb.removeChild(wb.children[0])),wb.addChild(a);var c=wb.getBounds(),d=new createjs.Shape;d.graphics.beginFill("#FFF").drawRect(c.x,c.y,c.width,c.height),d.x=0,d.y=0,wb.hitArea=d,docById("helpElem").innerHTML='<img src ="'+HELPCONTENT[xb][2]+'"</img> <h2>'+HELPCONTENT[xb][0]+"</h2><p>"+HELPCONTENT[xb][1]+"</p>",doneTour||(docById("helpElem").style.visibility="visible"),Bb=!0},b.src="images/help-container.svg"}var c=docById("helpElem");c.style.position="absolute",c.style.display="block",c.style.paddingLeft=20*Ra+"px",c.style.paddingRight=20*Ra+"px",c.style.paddingTop="0px",c.style.paddingBottom=20*Ra+"px",c.style.fontSize="20px",c.style.color="#000000",c.style.left=65*Ra+"px",c.style.top=105*Ra+"px";var d=Math.min(300,300),e=Math.min(300,300);if(c.style.width=d+"px",c.style.height=e+"px",Ra>1){wb.children[0]}}doneTour="true"===storage.doneTour,a&&doneTour?(docById("helpElem").style.visibility="hidden",wb.visible=!1):(sugarizerCompatibility.isInsideSugarizer()?sugarizerCompatibility.data.doneTour="true":storage.doneTour="true",docById("helpElem").innerHTML='<img src ="'+HELPCONTENT[xb][2]+'"</img> <h2>'+HELPCONTENT[xb][0]+"</h2><p>"+HELPCONTENT[xb][1]+"</p>",docById("helpElem").style.visibility="visible",wb.visible=!0,Bb=!0,Ha.show(),Ua||doMenuAnimation(1))}function ya(){za(1)}function za(){var a=last(Va.children);if(null!=a){var b=a.rotation;createjs.Tween.get(a).to({rotation:b}).to({rotation:b+90},500)}else setTimeout(za,50);setTimeout(function(){if(Ua){Ua=!1;for(var a in tb)tb[a].visible=!1}else{Ua=!0;for(var a in tb)tb[a].visible=!0}Bb=!0},500)}function Aa(){Sa=!Sa,Va.visible=Sa,Ta.visible=Sa;for(var a in sb)sb[a].visible=Sa;for(var a in tb)tb[a].visible=Sa;Bb=!0}function Ba(a,b,c,d,e,f,g){var h=new createjs.Container;"paste-disabled-button"===a&&(Za=h),void 0==g?Fa.addChild(h):g.addChild(h),h.x=c,h.y=d;var i=new createjs.Text(b,"14px Sans","#282828");h.y<55?(h.x<55?(i.textAlign="left",i.x=-14):(i.textAlign="center",i.x=0),i.y=30):(i.textAlign="right",i.x=-28,i.y=0),i.visible=!1,h.on("mouseover",function(a){for(var b=0;b<h.children.length;b++)if(void 0!=h.children[b].text){h.children[b].visible=!0;break}}),h.on("mouseout",function(a){for(var b=0;b<h.children.length;b++)if(void 0!=h.children[b].text){h.children[b].visible=!1;break}});var j=new Image;return j.onload=function(){var a=55,b=Math.floor(e/2),c=new createjs.Bitmap(j);e!==a&&(c.scaleX=e/a,c.scaleY=e/a),c.regX=b/c.scaleX,c.regY=b/c.scaleY,void 0!==f&&(c.rotation=f),h.addChild(c);var d=new createjs.Shape;d.graphics.beginFill("#FFF").drawEllipse(-b,-b,e,e),d.x=0,d.y=0,h.hitArea=d,c.cache(0,0,e,e),c.updateCache(),Bb=!0},j.src="header-icons/"+a+".svg",h.addChild(i),h}function Ca(a,b,c,d,e,f,g,h){var i=!1;null===e&&(e=d),null===f&&(f=e);var j,k,l=!1,m=!1,n=a;a.on("mousedown",function(o){var p=!0;a.x,Math.round(o.stageX/Ra),a.y,Math.round(o.stageY/Ra);j=setTimeout(function(){l=!0,null!==g&&(a.visible=!1,a=Ba(g,"",b,c,rb,0))},500),k=setTimeout(function(){m=!0,null!==h&&(a.visible=!1,a=Ba(h,"",b,c,rb,0))},1e3);var q=showButtonHighlight(b,c,rb/2,o,Ra,Fa);a.on("pressup",function(o){hideButtonHighlight(q,Fa),a.x=b,a.y=c,null===g&&null===h||(a.visible=!1,a=n,a.visible=!0),null!=d&&p&&!i&&(i=!0,setTimeout(function(){i=!1},500),clearTimeout(j),clearTimeout(k),l?m?f():e():d()),p=!1}),l=!1,m=!1})}createDefaultStack(),createHelpContent(),window.scroll(0,0);try{meSpeak.loadConfig("lib/mespeak_config.json");var Da=document.webL10n.getLanguage();sugarizerCompatibility.isInsideSugarizer()&&(Da=sugarizerCompatibility.getLanguage()),-1!==["es","ca","de","el","eo","fi","fr","hu","it","kn","la","lv","nl","pl","pt","ro","sk","sv","tr","zh"].indexOf(Da)?meSpeak.loadVoice("lib/voices/"+Da+".json"):meSpeak.loadVoice("lib/voices/en/en.json")}catch(a){console.log(a)}var Ea=docById("myCanvas");new createjs.LoadQueue(!1);if(window.File&&window.FileReader&&window.FileList&&window.Blob);else{alert("The File APIs are not fully supported in this browser.")}var Fa,Ga,Ha,Ia,Ja,Ka,La,Ma,Na=docById("myOpenFile"),Oa=docById("myOpenPlugin"),Pa=docById("myOpenAll"),Qa=!0,Ra=1,Sa=!0,Ta=null,Ua=!0,Va=null,Wa=!1,Xa="",Ya=0,Za=null,$a=null,_a=null;if(_THIS_IS_TURTLE_BLOCKS_)var ab;for(var bb in PALETTECOLORS)PALETTEFILLCOLORS[bb]=getMunsellColor(PALETTECOLORS[bb][0],PALETTECOLORS[bb][1],PALETTECOLORS[bb][2]),PALETTESTROKECOLORS[bb]=getMunsellColor(PALETTECOLORS[bb][0],PALETTECOLORS[bb][1]-30,PALETTECOLORS[bb][2]),PALETTEHIGHLIGHTCOLORS[bb]=getMunsellColor(PALETTECOLORS[bb][0],PALETTECOLORS[bb][1]+10,PALETTECOLORS[bb][2]),HIGHLIGHTSTROKECOLORS[bb]=getMunsellColor(PALETTECOLORS[bb][0],PALETTECOLORS[bb][1]-50,PALETTECOLORS[bb][2]);pluginObjs={PALETTEPLUGINS:{},PALETTEFILLCOLORS:{},PALETTESTROKECOLORS:{},PALETTEHIGHLIGHTCOLORS:{},FLOWPLUGINS:{},ARGPLUGINS:{},BLOCKPLUGINS:{},ONLOAD:{},ONSTART:{},ONSTOP:{}};var cb={},db=null,eb=0,fb=0,gb=[],hb=0,ib=0;const jb=500,kb=-1,lb=[1,1.5,2,3,4];var mb=lb.indexOf(DEFAULTBLOCKSCALE);-1===mb&&(mb=1);var nb=!1,ob=0,pb=0,qb=1200===screen.width&&900===screen.height||900===screen.width&&1200===screen.height,rb=55;qb&&(rb=75);var sb=[],tb=[],ub=null,vb=null,wb=null,xb=0,yb=!0;pluginsImages={},console.log("initing i18n for music terms"),initDrumI18N(),initModeI18N(),initVoiceI18N(),window.onblur=function(){Ja.doStopTurtle()};var zb=!1,Ab=!1,Bb=!0,Cb=null,Db=null,Eb=null,Fb=null,Gb=null,Hb={};const Ib=["emptybox","emptyheap","negroot","noinput","zerodivide","notanumber","nostack","notastring","nomicrophone"];s(),window.onresize=function(){G()},window.prepareExport=oa,window.saveLocally=$}requirejs(["domReady!","activity/sugarizer-compatibility"],function(a){sugarizerCompatibility.isInsideSugarizer()?(window.addEventListener("localized",function(){sugarizerCompatibility.loadData(function(){b(a)})}),document.webL10n.setLanguage(sugarizerCompatibility.getLanguage())):b(a)})});