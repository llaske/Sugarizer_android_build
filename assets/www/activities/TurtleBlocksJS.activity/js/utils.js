/*! Sugarizer 2020-03-14 */
function format(a,b){return a=a.replace(/{([a-zA-Z0-9.]*)}/g,function(c,d){return x=b,d.split(".").forEach(function(b){void 0===x&&console.log("Undefined value in template string",a,d,x,b),x=x[b]}),x}),a.replace(/{_([a-zA-Z0-9]+)}/g,function(a,b){return _(b)})}function canvasPixelRatio(){var a=window.devicePixelRatio||1,b=document.querySelector("#myCanvas").getContext("2d");return a/(b.webkitBackingStorePixelRatio||b.mozBackingStorePixelRatio||b.msBackingStorePixelRatio||b.oBackingStorePixelRatio||b.backingStorePixelRatio||1)}function windowHeight(){return/Android/i.test(navigator.userAgent)?window.outerHeight:window.innerHeight}function windowWidth(){return/Android/i.test(navigator.userAgent)?window.outerWidth:window.innerWidth}function httpGet(a){var b=null;if(b=new XMLHttpRequest,null===a?(b.open("GET",window.server,!1),b.setRequestHeader("x-api-key","3tgTzMXbbw6xEKX7")):(b.open("GET",window.server+a,!1),b.setRequestHeader("x-api-key","3tgTzMXbbw6xEKX7")),b.send(),b.status>299)throw"Error from server";return b.responseText}function httpPost(a,b){var c=null;return c=new XMLHttpRequest,c.open("POST",window.server+a,!1),c.setRequestHeader("x-api-key","3tgTzMXbbw6xEKX7"),c.send(b),"https://apps.facebook.com/turtleblocks/?file="+a}function HttpRequest(a,b,c){var d=this.request=new XMLHttpRequest;this.handler=b,this.url=a,this.localmode=Boolean(0===self.location.href.search(/^file:/i)),this.userCallback=c;var e=this;try{d.open("GET",a),d.onreadystatechange=function(){e.handler()},d.send("")}catch(b){self.console&&console.log("Failed to load resource from "+a+": Network error."),"function"==typeof c&&c(!1,"network error"),this.request=this.handler=this.userCallback=null}}function docByTagName(a){document.getElementsByTagName(a)}function docById(a){return document.getElementById(a)}function last(a){var b=a.length;return 0===b?null:a[b-1]}function doSVG(a,b,c,d,e,f){var g='<g transform="matrix(20,0,0,20,-2500,-200)"> <g style="font-size:20px;font-family:Sans;text-anchor:end;fill:#000000" transform="translate(0.32906,-0.2)"> <path d="m 138.47094,26.82 q 0,-1.16 1.24,-2.02 0.96,-0.64 1.94,-0.64 0.68,0.02 1.18,0.34 l 0,-11.84 0.44,0 0,12.94 q 0,1.32 -1.34,2.1 -0.86,0.5 -1.8,0.5 -0.98,0 -1.44,-0.7 -0.22,-0.32 -0.22,-0.68 z" /> </g> <g transform="translate(-12.52094,4.8)" style="font-size:20px;font-family:Sans;text-anchor:end;fill:#000000"> <path d="m 138.47094,26.82 q 0,-1.16 1.24,-2.02 0.96,-0.64 1.94,-0.64 0.68,0.02 1.18,0.34 l 0,-11.84 0.44,0 0,12.94 q 0,1.32 -1.34,2.1 -0.86,0.5 -1.8,0.5 -0.98,0 -1.44,-0.7 -0.22,-0.32 -0.22,-0.68 z" /> </g> <path style="fill:#000000;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" d="m 130.81346,17 12.29007,-5 0,2 -12.29007,5 z" /> </g>',h="";for(var i in c.turtleList)c.turtleList[i].closeSVG(),h+=c.turtleList[i].svgOutput;var j='<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg xmlns="http://www.w3.org/2000/svg" width="'+d+'" height="'+e+'">\n';return j+='<g transform="scale('+f+","+f+')">\n',j+=b.svgOutput,j+="</g>",j+=""===h?g:h,j+="</svg>"}function isSVGEmpty(a){for(var b in a.turtleList)if(a.turtleList[b].closeSVG(),""!==a.turtleList[b].svgOutput)return!1;return!0}function fileExt(a){var b=a.split(".");return 1===b.length||""===b[0]&&2===b.length?"":b.pop()}function fileBasename(a){var b=a.split(".");return 1===b.length?b[0]:""===b[0]&&2===b.length?a:(b.pop(),b.join("."))}function _(a){replaced=a,replace=[",","(",")","?","¿","<",">",".",'"\n','"',":","%s","%d","/","'",";","×","!","¡"];for(var b=0;b<replace.length;b++)replaced=replaced.replace(replace[b],"");replaced=replaced.replace(/ /g,"-");try{return translation=document.webL10n.get(replaced),""===translation&&(translation=a),translation}catch(b){return console.log("i18n error: "+a),a}}function toTitleCase(a){if("string"==typeof a){var b="";return a.length>1&&(b=a.substring(1)),a.toUpperCase()[0]+b}}function processRawPluginData(a,b,c,d,e,f,g,h,i,j){for(var k=a.split("\n"),l="",m=0;m<k.length;m++)0!==k[m].length&&"/"!==k[m][0]&&(l+=k[m]);try{var n=processPluginData(l.replace(/\n/g,""),b,c,e,f,g,h,i,j)}catch(a){var n=null;d("Error loading plugin: "+a)}return n}function processPluginData(pluginData,palettes,blocks,evalFlowDict,evalArgDict,evalParameterDict,evalSetterDict,evalOnStartList,evalOnStopList){var obj=JSON.parse(pluginData),newPalette=!1;if("PALETTEPLUGINS"in obj)for(var name in obj.PALETTEPLUGINS){PALETTEICONS[name]=obj.PALETTEPLUGINS[name];var fillColor="#ff0066";if("PALETTEFILLCOLORS"in obj&&name in obj.PALETTEFILLCOLORS)var fillColor=obj.PALETTEFILLCOLORS[name];PALETTEFILLCOLORS[name]=fillColor;var strokeColor="#ef003e";if("PALETTESTROKECOLORS"in obj&&name in obj.PALETTESTROKECOLORS)var strokeColor=obj.PALETTESTROKECOLORS[name];PALETTESTROKECOLORS[name]=strokeColor;var highlightColor="#ffb1b3";if("PALETTEHIGHLIGHTCOLORS"in obj&&name in obj.PALETTEHIGHLIGHTCOLORS)var highlightColor=obj.PALETTEHIGHLIGHTCOLORS[name];PALETTEHIGHLIGHTCOLORS[name]=highlightColor;var strokeHighlightColor="#404040";if("HIGHLIGHTSTROKECOLORS"in obj&&name in obj.HIGHLIGHTSTROKECOLORS)var strokeHighlightColor=obj.HIGHLIGHTSTROKECOLORS[name];HIGHLIGHTSTROKECOLORS[name]=strokeHighlightColor,name in palettes.buttons?console.log("palette "+name+" already exists"):(console.log("adding palette "+name),palettes.add(name),newPalette=!0)}if(newPalette)try{palettes.makePalettes()}catch(a){console.log("makePalettes: "+a)}if("IMAGES"in obj)for(var blkName in obj.IMAGES)pluginsImages[blkName]=obj.IMAGES[blkName];if("FLOWPLUGINS"in obj)for(var flow in obj.FLOWPLUGINS)evalFlowDict[flow]=obj.FLOWPLUGINS[flow];if("ARGPLUGINS"in obj)for(var arg in obj.ARGPLUGINS)evalArgDict[arg]=obj.ARGPLUGINS[arg];if("SETTERPLUGINS"in obj)for(var setter in obj.SETTERPLUGINS)evalSetterDict[setter]=obj.SETTERPLUGINS[setter];if("BLOCKPLUGINS"in obj)for(var block in obj.BLOCKPLUGINS){console.log("adding plugin block "+block);try{eval(obj.BLOCKPLUGINS[block])}catch(a){console.log("Failed to load plugin for "+block+": "+a)}}if("GLOBALS"in obj&&eval(obj.GLOBALS),"PARAMETERPLUGINS"in obj)for(var parameter in obj.PARAMETERPLUGINS)evalParameterDict[parameter]=obj.PARAMETERPLUGINS[parameter];if("ONLOAD"in obj)for(var arg in obj.ONLOAD)eval(obj.ONLOAD[arg]);if("ONSTART"in obj)for(var arg in obj.ONSTART)evalOnStartList[arg]=obj.ONSTART[arg];if("ONSTOP"in obj)for(var arg in obj.ONSTOP)evalOnStopList[arg]=obj.ONSTOP[arg];for(var protoblock in blocks.protoBlockDict)void 0===blocks.protoBlockDict[protoblock].palette?console.log("Cannot find palette for protoblock "+protoblock):blocks.protoBlockDict[protoblock].palette.add(blocks.protoBlockDict[protoblock]);return palettes.updatePalettes(),blocks.findBlockTypes(),obj}function updatePluginObj(a){for(var b in a.PALETTEPLUGINS)pluginObjs.PALETTEPLUGINS[b]=a.PALETTEPLUGINS[b];for(var b in a.PALETTEFILLCOLORS)pluginObjs.PALETTEFILLCOLORS[b]=a.PALETTEFILLCOLORS[b];for(var b in a.PALETTESTROKECOLORS)pluginObjs.PALETTESTROKECOLORS[b]=a.PALETTESTROKECOLORS[b];for(var b in a.PALETTEHIGHLIGHTCOLORS)pluginObjs.PALETTEHIGHLIGHTCOLORS[b]=a.PALETTEHIGHLIGHTCOLORS[b];for(var c in a.FLOWPLUGINS)pluginObjs.FLOWPLUGINS[c]=a.FLOWPLUGINS[c];for(var d in a.ARGPLUGINS)pluginObjs.ARGPLUGINS[d]=a.ARGPLUGINS[d];for(var e in a.BLOCKPLUGINS)pluginObjs.BLOCKPLUGINS[e]=a.BLOCKPLUGINS[e];"GLOBALS"in a&&("GLOBALS"in pluginObjs||(pluginObjs.GLOBALS=""),pluginObjs.GLOBALS+=a.GLOBALS),"IMAGES"in a&&(pluginObjs.IMAGES=a.IMAGES);for(var b in a.ONLOAD)pluginObjs.ONLOAD[b]=a.ONLOAD[b];for(var b in a.ONSTART)pluginObjs.ONSTART[b]=a.ONSTART[b];for(var b in a.ONSTOP)pluginObjs.ONSTOP[b]=a.ONSTOP[b]}function preparePluginExports(a){return updatePluginObj(a),JSON.stringify(pluginObjs)}function processMacroData(a,b,c,d){if("{}"!==a){var e=JSON.parse(a);b.add("myblocks","black","#a0a0a0");for(var f in e)console.log("adding "+f+" to macroDict"),d[f]=e[f],c.addToMyPalette(f,d[f]);b.makePalettes()}}function prepareMacroExports(a,b,c){return null!==a&&(c[a]=b),JSON.stringify(c)}function doSaveSVG(a,b){download(b,"data:image/svg+xml;utf8,"+doSVG(a.canvas,a,a.turtles,a.canvas.width,a.canvas.height,1),b,'"width='+a.canvas.width+", height="+a.canvas.height+'"')}function doSaveLilypond(a,b){download(b,"data:text;utf8,"+encodeURIComponent(a.lilypondOutput),b,'"width='+a.canvas.width+", height="+a.canvas.height+'"')}function download(a,b){var c=document.createElement("a");c.setAttribute("href",b),c.setAttribute("download",a),document.body.appendChild(c),c.click(),document.body.removeChild(c)}function doPublish(a){var b=doSave();console.log("push "+b+" to FB");var c=docById("description"),d=a+" "+c.value+" "+b;console.log("comment: "+d);var e=function(){FB.api("/me/feed","post",{message:d})};FB.login(e,{scope:"publish_actions"})}function doUseCamera(a,b,c,d,e,f,g){function h(){m.width=i,m.height=j,m.getContext("2d").drawImage(l,0,0,i,j);var d=m.toDataURL("image/png");b.turtleList[c].doShowImage(a[0],d)}var i=320,j=240,k=!1,l=document.querySelector("#camVideo"),m=document.querySelector("#camCanvas");navigator.getMedia=navigator.getUserMedia||navigator.mozGetUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia,void 0===navigator.getMedia&&g("Your browser does not support the webcam"),hasSetupCamera?(k=!0,l.play(),d?(e=window.setInterval(h,100),f(e)):h()):navigator.getMedia({video:!0,audio:!1},function(a){if(navigator.mozGetUserMedia)l.mozSrcObject=a;else{var b=window.URL||window.webkitURL;l.src=b.createObjectURL(a)}l.play(),hasSetupCamera=!0},function(a){g("Could not connect to camera"),console.log("Could not connect to camera",a)}),l.addEventListener("canplay",function(a){console.log("canplay",k,hasSetupCamera),k||(l.setAttribute("width",i),l.setAttribute("height",j),m.setAttribute("width",i),m.setAttribute("height",j),k=!0,d?(e=window.setInterval(h,100),f(e)):h())},!1)}function doStopVideoCam(a,b){null!==a&&window.clearInterval(a),b(null),document.querySelector("#camVideo").pause()}function hideDOMLabel(){var a=docById("textLabel");null!==a&&(a.style.display="none");var b=docById("numberLabel");null!==b&&(b.style.display="none");var c=docById("solfegeLabel");null!==c&&(c.style.display="none");var d=docById("notenameLabel");null!==d&&(d.style.display="none");var e=docById("noteattrLabel");null!==e&&(e.style.display="none");var f=docById("drumnameLabel");null!==f&&(f.style.display="none");var g=docById("voicenameLabel");null!==g&&(g.style.display="none");var h=docById("modenameLabel");null!==h&&(h.style.display="none")}function displayMsg(a,b){}function toFixed2(a){return a!==Math.floor(a)?a.toFixed(2).toString():a.toString()}function mixedNumber(a){var b=Math.floor(a);if(a>b){var c=rationalToFraction(a-b);return 0===b?c[0]+"/"+c[1]:1===c[0]&&1===c[1]?b+1:c[1]>99?a.toFixed(2):b+" "+c[0]+"/"+c[1]}return a.toString()}function LCD(a,b){return Math.abs(a*b/GCD(a,b))}function GCD(a,b){for(a=Math.abs(a),b=Math.abs(b);b;){var c=b;b=a%b,a=c}return a}function rationalToFraction(a){if(a>1){var b=!0;a=1/a}else var b=!1;for(var c=1,d=1,e=1;Math.abs(c-a)>1e-8;)c<a?d+=1:(e+=1,d=Math.floor(a*e)),c=d/e;return 0===e||0===d?[0,1]:b?[e,d]:[d,e]}var hasSetupCamera=!1;