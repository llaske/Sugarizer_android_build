/*! Sugarizer 2018-05-08 */
!function(a,b){"function"==typeof define&&define.amd?define("p5.sound",["p5"],function(a){b(a)}):b("object"==typeof exports?require("../p5"):a.p5)}(this,function(p5){var sndcore;sndcore=function(){"use strict";!function(a,b,c){function d(a){a&&(a.setTargetAtTime||(a.setTargetAtTime=a.setTargetValueAtTime))}return b=b||{},window.hasOwnProperty("webkitAudioContext")&&!window.hasOwnProperty("AudioContext")&&(window.AudioContext=webkitAudioContext,"function"!=typeof AudioContext.prototype.createGain&&(AudioContext.prototype.createGain=AudioContext.prototype.createGainNode),"function"!=typeof AudioContext.prototype.createDelay&&(AudioContext.prototype.createDelay=AudioContext.prototype.createDelayNode),"function"!=typeof AudioContext.prototype.createScriptProcessor&&(AudioContext.prototype.createScriptProcessor=AudioContext.prototype.createJavaScriptNode),"function"!=typeof AudioContext.prototype.createPeriodicWave&&(AudioContext.prototype.createPeriodicWave=AudioContext.prototype.createWaveTable),AudioContext.prototype.internal_createGain=AudioContext.prototype.createGain,AudioContext.prototype.createGain=function(){var a=this.internal_createGain();return d(a.gain),a},AudioContext.prototype.internal_createDelay=AudioContext.prototype.createDelay,AudioContext.prototype.createDelay=function(a){var b=a?this.internal_createDelay(a):this.internal_createDelay();return d(b.delayTime),b},AudioContext.prototype.internal_createBufferSource=AudioContext.prototype.createBufferSource,AudioContext.prototype.createBufferSource=function(){var a=this.internal_createBufferSource();return a.start?(a.internal_start=a.start,a.start=function(b,c,d){"undefined"!=typeof d?a.internal_start(b||0,c,d):a.internal_start(b||0,c||0)}):a.start=function(a,b,c){b||c?this.noteGrainOn(a||0,b,c):this.noteOn(a||0)},a.stop?(a.internal_stop=a.stop,a.stop=function(b){a.internal_stop(b||0)}):a.stop=function(a){this.noteOff(a||0)},d(a.playbackRate),a},AudioContext.prototype.internal_createDynamicsCompressor=AudioContext.prototype.createDynamicsCompressor,AudioContext.prototype.createDynamicsCompressor=function(){var a=this.internal_createDynamicsCompressor();return d(a.threshold),d(a.knee),d(a.ratio),d(a.reduction),d(a.attack),d(a.release),a},AudioContext.prototype.internal_createBiquadFilter=AudioContext.prototype.createBiquadFilter,AudioContext.prototype.createBiquadFilter=function(){var a=this.internal_createBiquadFilter();return d(a.frequency),d(a.detune),d(a.Q),d(a.gain),a},"function"!=typeof AudioContext.prototype.createOscillator&&(AudioContext.prototype.internal_createOscillator=AudioContext.prototype.createOscillator,AudioContext.prototype.createOscillator=function(){var a=this.internal_createOscillator();return a.start?(a.internal_start=a.start,a.start=function(b){a.internal_start(b||0)}):a.start=function(a){this.noteOn(a||0)},a.stop?(a.internal_stop=a.stop,a.stop=function(b){a.internal_stop(b||0)}):a.stop=function(a){this.noteOff(a||0)},a.setPeriodicWave||(a.setPeriodicWave=a.setWaveTable),d(a.frequency),d(a.detune),a})),window.hasOwnProperty("webkitOfflineAudioContext")&&!window.hasOwnProperty("OfflineAudioContext")&&(window.OfflineAudioContext=webkitOfflineAudioContext),b}(window);var a=new window.AudioContext;p5.prototype.getAudioContext=function(){return a},navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;var b=document.createElement("audio");p5.prototype.isSupported=function(){return!!b.canPlayType};var c=function(){return!!b.canPlayType&&b.canPlayType('audio/ogg; codecs="vorbis"')},d=function(){return!!b.canPlayType&&b.canPlayType("audio/mpeg;")},e=function(){return!!b.canPlayType&&b.canPlayType('audio/wav; codecs="1"')},f=function(){return!!b.canPlayType&&(b.canPlayType("audio/x-m4a;")||b.canPlayType("audio/aac;"))},g=function(){return!!b.canPlayType&&b.canPlayType("audio/x-aiff;")};p5.prototype.isFileSupported=function(a){switch(a.toLowerCase()){case"mp3":return d();case"wav":return e();case"ogg":return c();case"mp4":return f();case"aiff":return g();default:return!1}};var h=!!navigator.userAgent.match(/(iPad|iPhone|iPod)/g);if(h){var i=!1,j=function(){if(!i){var b=a.createBuffer(1,1,22050),c=a.createBufferSource();c.buffer=b,c.connect(a.destination),c.start(0),console.log("start ios!"),"running"===a.state&&(i=!0)}};document.addEventListener("touchend",j,!1),document.addEventListener("touchstart",j,!1)}}();var master;master=function(){"use strict";var a=function(){var a=p5.prototype.getAudioContext();this.input=a.createGain(),this.output=a.createGain(),this.limiter=a.createDynamicsCompressor(),this.limiter.threshold.value=0,this.limiter.ratio.value=20,this.audiocontext=a,this.output.disconnect(),this.inputSources=[],this.input.connect(this.limiter),this.limiter.connect(this.output),this.meter=a.createGain(),this.fftMeter=a.createGain(),this.output.connect(this.meter),this.output.connect(this.fftMeter),this.output.connect(this.audiocontext.destination),this.soundArray=[],this.parts=[],this.extensions=[]},b=new a;return p5.prototype.getMasterVolume=function(){return b.output.gain.value},p5.prototype.masterVolume=function(a,c,d){if("number"==typeof a){var c=c||0,d=d||0,e=b.audiocontext.currentTime,f=b.output.gain.value;b.output.gain.cancelScheduledValues(e+d),b.output.gain.linearRampToValueAtTime(f,e+d),b.output.gain.linearRampToValueAtTime(a,e+d+c)}else{if(!a)return b.output.gain;a.connect(b.output.gain)}},p5.prototype.soundOut=p5.soundOut=b,p5.soundOut._silentNode=b.audiocontext.createGain(),p5.soundOut._silentNode.gain.value=0,p5.soundOut._silentNode.connect(b.audiocontext.destination),b}(sndcore);var helpers;helpers=function(){"use strict";var a=master;p5.prototype.sampleRate=function(){return a.audiocontext.sampleRate},p5.prototype.freqToMidi=function(a){var b=Math.log(a/440)/Math.log(2),c=Math.round(12*b)+57;return c},p5.prototype.midiToFreq=function(a){return 440*Math.pow(2,(a-69)/12)},p5.prototype.soundFormats=function(){a.extensions=[];for(var b=0;b<arguments.length;b++){if(arguments[b]=arguments[b].toLowerCase(),!(["mp3","wav","ogg","m4a","aac"].indexOf(arguments[b])>-1))throw arguments[b]+" is not a valid sound format!";a.extensions.push(arguments[b])}},p5.prototype.disposeSound=function(){for(var b=0;b<a.soundArray.length;b++)a.soundArray[b].dispose()},p5.prototype.registerMethod("remove",p5.prototype.disposeSound),p5.prototype._checkFileFormats=function(b){var c;if("string"==typeof b){c=b;var d=c.split(".").pop();if(["mp3","wav","ogg","m4a","aac"].indexOf(d)>-1){var e=p5.prototype.isFileSupported(d);if(e)c=c;else for(var f=c.split("."),g=f[f.length-1],h=0;h<a.extensions.length;h++){var i=a.extensions[h],e=p5.prototype.isFileSupported(i);if(e){g="",2===f.length&&(g+=f[0]);for(var h=1;h<=f.length-2;h++){var j=f[h];g+="."+j}c=g+=".",c=c+=i;break}}}else for(var h=0;h<a.extensions.length;h++){var i=a.extensions[h],e=p5.prototype.isFileSupported(i);if(e){c=c+"."+i;break}}}else if("object"==typeof b)for(var h=0;h<b.length;h++){var i=b[h].split(".").pop(),e=p5.prototype.isFileSupported(i);if(e){c=b[h];break}}return c},p5.prototype._mathChain=function(a,b,c,d,e){for(var f in a.mathOps)a.mathOps[f]instanceof e&&(a.mathOps[f].dispose(),c=f,c<a.mathOps.length-1&&(d=a.mathOps[f+1]));return a.mathOps[c-1].disconnect(),a.mathOps[c-1].connect(b),b.connect(d),a.mathOps[c]=b,a}}(master);var errorHandler;errorHandler=function(){"use strict";var a=function(a,b,c){var d,e,f=new Error;f.name=a,f.originalStack=f.stack+b,d=f.stack+b,f.failedPath=c;var e=d.split("\n");return e=e.filter(function(a){return!a.match(/(p5.|native code|globalInit)/g)}),f.stack=e.join("\n"),f};return a}();var panner;panner=function(){"use strict";var a=master,b=a.audiocontext;"undefined"!=typeof b.createStereoPanner?(p5.Panner=function(a,c,d){this.stereoPanner=this.input=b.createStereoPanner(),a.connect(this.stereoPanner),this.stereoPanner.connect(c)},p5.Panner.prototype.pan=function(a,c){var d=c||0,e=b.currentTime+d;this.stereoPanner.pan.linearRampToValueAtTime(a,e)},p5.Panner.prototype.inputChannels=function(a){},p5.Panner.prototype.connect=function(a){this.stereoPanner.connect(a)},p5.Panner.prototype.disconnect=function(a){this.stereoPanner.disconnect()}):(p5.Panner=function(a,c,d){this.input=b.createGain(),a.connect(this.input),this.left=b.createGain(),this.right=b.createGain(),this.left.channelInterpretation="discrete",this.right.channelInterpretation="discrete",d>1?(this.splitter=b.createChannelSplitter(2),this.input.connect(this.splitter),this.splitter.connect(this.left,1),this.splitter.connect(this.right,0)):(this.input.connect(this.left),this.input.connect(this.right)),this.output=b.createChannelMerger(2),this.left.connect(this.output,0,1),this.right.connect(this.output,0,0),this.output.connect(c)},p5.Panner.prototype.pan=function(a,c){var d=c||0,e=b.currentTime+d,f=(a+1)/2,g=Math.cos(f*Math.PI/2),h=Math.sin(f*Math.PI/2);this.left.gain.linearRampToValueAtTime(h,e),this.right.gain.linearRampToValueAtTime(g,e)},p5.Panner.prototype.inputChannels=function(a){1===a?(this.input.disconnect(),this.input.connect(this.left),this.input.connect(this.right)):2===a&&(this.splitter=b.createChannelSplitter(2),this.input.disconnect(),this.input.connect(this.splitter),this.splitter.connect(this.left,1),this.splitter.connect(this.right,0))},p5.Panner.prototype.connect=function(a){this.output.connect(a)},p5.Panner.prototype.disconnect=function(a){this.output.disconnect()}),p5.Panner3D=function(a,c){var d=b.createPanner();return d.panningModel="HRTF",d.distanceModel="linear",d.setPosition(0,0,0),a.connect(d),d.connect(c),d.pan=function(a,b,c){d.setPosition(a,b,c)},d}}(master);var soundfile;soundfile=function(){"use strict";function a(a,b){for(var c={},d=a.length,e=0;d>e;e++){if(a[e]>b){var f=a[e],g=new j(f,e);c[e]=g,e+=6e3}e++}return c}function b(a){for(var b=[],c=Object.keys(a).sort(),d=0;d<c.length;d++)for(var e=0;10>e;e++){var f=a[c[d]],g=a[c[d+e]];if(f&&g){var h=f.sampleIndex,i=g.sampleIndex,j=i-h;j>0&&f.intervals.push(j);var k=b.some(function(a,b){return a.interval===j?(a.count++,a):void 0});k||b.push({interval:j,count:1})}}return b}function c(a,b){var c=[];return a.forEach(function(a,d){try{var f=Math.abs(60/(a.interval/b));f=e(f);var g=c.some(function(b){return b.tempo===f?b.count+=a.count:void 0});if(!g){if(isNaN(f))return;c.push({tempo:Math.round(f),count:a.count})}}catch(a){throw a}}),c}function d(a,b,c,d){for(var f=[],g=Object.keys(a).sort(),h=0;h<g.length;h++)for(var i=g[h],j=a[i],k=0;k<j.intervals.length;k++){var l=Math.round(Math.abs(60/(j.intervals[k]/c)));l=e(l),Math.abs(l-b)<d&&f.push(j.sampleIndex/44100)}return f=f.filter(function(a,b,c){var d=c[b+1]-a;return d>.01||void 0})}function e(a){if(isFinite(a)&&0!=a){for(;90>a;)a*=2;for(;a>180&&a>90;)a/=2;return a}}var f=errorHandler,g=master,h=g.audiocontext;p5.SoundFile=function(a,b,c,d){if("undefined"!=typeof a){if("string"==typeof a||"string"==typeof a[0]){var e=p5.prototype._checkFileFormats(a);this.url=e}else if("object"==typeof a&&!(window.File&&window.FileReader&&window.FileList&&window.Blob))throw"Unable to load file because the File API is not supported";a.file&&(a=a.file),this.file=a}this._onended=function(){},this._looping=!1,this._playing=!1,this._paused=!1,this._pauseTime=0,this._cues=[],this._lastPos=0,this._counterNode,this._scopeNode,this.bufferSourceNodes=[],this.bufferSourceNode=null,this.buffer=null,this.playbackRate=1,this.gain=1,this.input=g.audiocontext.createGain(),this.output=g.audiocontext.createGain(),this.reversed=!1,this.startTime=0,this.endTime=null,this.pauseTime=0,this.mode="sustain",this.startMillis=null,this.panPosition=0,this.panner=new p5.Panner(this.output,g.input,2),(this.url||this.file)&&this.load(b,c),g.soundArray.push(this),"function"==typeof d?this._whileLoading=d:this._whileLoading=function(){}},p5.prototype.registerPreloadMethod("loadSound",p5.prototype),p5.prototype.loadSound=function(a,b,c,d){window.location.origin.indexOf("file://")>-1&&"undefined"===window.cordova&&alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS");var e=new p5.SoundFile(a,b,c,d);return e},p5.SoundFile.prototype.load=function(a,b){var c=this,d=(new Error).stack;if(void 0!=this.url&&""!=this.url){var e=new XMLHttpRequest;e.addEventListener("progress",function(a){c._updateProgress(a)},!1),e.open("GET",this.url,!0),e.responseType="arraybuffer",e.onload=function(){if(200==e.status)h.decodeAudioData(e.response,function(b){c.buffer=b,c.panner.inputChannels(b.numberOfChannels),a&&a(c)},function(a){var e=new f("decodeAudioData",d,c.url),g="AudioContext error at decodeAudioData for "+c.url;b?(e.msg=g,b(e)):console.error(g+"\n The error stack trace includes: \n"+e.stack)});else{var g=new f("loadSound",d,c.url),i="Unable to load "+c.url+". The request status was: "+e.status+" ("+e.statusText+")";b?(g.message=i,b(g)):console.error(i+"\n The error stack trace includes: \n"+g.stack)}},e.onerror=function(a){var e=new f("loadSound",d,c.url),g="There was no response from the server at "+c.url+". Check the url and internet connectivity.";b?(e.message=g,b(e)):console.error(g+"\n The error stack trace includes: \n"+e.stack)},e.send()}else if(void 0!=this.file){var g=new FileReader,c=this;g.onload=function(){h.decodeAudioData(g.result,function(b){c.buffer=b,c.panner.inputChannels(b.numberOfChannels),a&&a(c)})},g.onerror=function(a){onerror&&onerror(a)},g.readAsArrayBuffer(this.file)}},p5.SoundFile.prototype._updateProgress=function(a){if(a.lengthComputable){var b=a.loaded/a.total*.99;this._whileLoading(b,a)}else this._whileLoading("size unknown")},p5.SoundFile.prototype.isLoaded=function(){return!!this.buffer},p5.SoundFile.prototype.play=function(a,b,c,d,e){var f,h,i=this,j=g.audiocontext.currentTime,a=a||0;if(0>a&&(a=0),a+=j,!this.buffer)throw"not ready to play file, buffer has yet to load. Try preload()";if(this._pauseTime=0,"restart"===this.mode&&this.buffer&&this.bufferSourceNode){var j=g.audiocontext.currentTime;this.bufferSourceNode.stop(a),this._counterNode.stop(a)}if(b&&(this.playbackRate=b),this.bufferSourceNode=this._initSourceNode(),this._counterNode&&(this._counterNode=void 0),this._counterNode=this._initCounterNode(),d){if(!(d>=0&&d<this.buffer.duration))throw"start time out of range";f=d}else f=0;e=e?e<=this.buffer.duration-f?e:this.buffer.duration:this.buffer.duration-f;var k=c||1;this.bufferSourceNode.connect(this.output),this.output.gain.value=k,this._paused?(this.bufferSourceNode.start(a,this.pauseTime,e),this._counterNode.start(a,this.pauseTime,e)):(this.bufferSourceNode.start(a,f,e),this._counterNode.start(a,f,e)),this._playing=!0,this._paused=!1,this.bufferSourceNodes.push(this.bufferSourceNode),this.bufferSourceNode._arrayIndex=this.bufferSourceNodes.length-1;var l=function(a){this._playing=!1,this.removeEventListener("ended",l,!1),i._onended(i),i.bufferSourceNodes.forEach(function(a,b){a._playing===!1&&i.bufferSourceNodes.splice(b)}),0===i.bufferSourceNodes.length&&(i._playing=!1)};if(this.bufferSourceNode.onended=l,this.bufferSourceNode.loop=this._looping,this._counterNode.loop=this._looping,this._looping===!0){var h=f+e;this.bufferSourceNode.loopStart=f,this.bufferSourceNode.loopEnd=h,this._counterNode.loopStart=f,this._counterNode.loopEnd=h}},p5.SoundFile.prototype.playMode=function(a){var b=a.toLowerCase();if("restart"===b&&this.buffer&&this.bufferSourceNode)for(var c=0;c<this.bufferSourceNodes.length-1;c++){var d=g.audiocontext.currentTime;this.bufferSourceNodes[c].stop(d)}if("restart"!==b&&"sustain"!==b)throw'Invalid play mode. Must be either "restart" or "sustain"';this.mode=b},p5.SoundFile.prototype.pause=function(a){var b=g.audiocontext.currentTime,a=a||0,c=a+b;this.isPlaying()&&this.buffer&&this.bufferSourceNode?(this.pauseTime=this.currentTime(),this.bufferSourceNode.stop(c),this._counterNode.stop(c),this._paused=!0,this._playing=!1,this._pauseTime=this.currentTime()):this._pauseTime=0},p5.SoundFile.prototype.loop=function(a,b,c,d,e){this._looping=!0,this.play(a,b,c,d,e)},p5.SoundFile.prototype.setLoop=function(a){if(a===!0)this._looping=!0;else{if(a!==!1)throw"Error: setLoop accepts either true or false";this._looping=!1}this.bufferSourceNode&&(this.bufferSourceNode.loop=this._looping,this._counterNode.loop=this._looping)},p5.SoundFile.prototype.isLooping=function(){return!(!this.bufferSourceNode||this._looping!==!0||this.isPlaying()!==!0)},p5.SoundFile.prototype.isPlaying=function(){return this._playing},p5.SoundFile.prototype.isPaused=function(){return this._paused},p5.SoundFile.prototype.stop=function(a){var b=a||0;if("sustain"==this.mode)this.stopAll(b),this._playing=!1,this.pauseTime=0,this._paused=!1;else if(this.buffer&&this.bufferSourceNode){var c=g.audiocontext.currentTime,d=b||0;this.pauseTime=0,this.bufferSourceNode.stop(c+d),this._counterNode.stop(c+d),this._playing=!1,this._paused=!1}},p5.SoundFile.prototype.stopAll=function(a){var b=g.audiocontext.currentTime,c=a||0;if(this.buffer&&this.bufferSourceNode){for(var d=0;d<this.bufferSourceNodes.length;d++)if(void 0!=typeof this.bufferSourceNodes[d])try{this.bufferSourceNodes[d].onended=function(){},this.bufferSourceNodes[d].stop(b+c)}catch(a){}this._counterNode.stop(b+c),this._onended(this)}},p5.SoundFile.prototype.setVolume=function(a,b,c){if("number"==typeof a){var b=b||0,c=c||0,d=g.audiocontext.currentTime,e=this.output.gain.value;this.output.gain.cancelScheduledValues(d+c),this.output.gain.linearRampToValueAtTime(e,d+c),this.output.gain.linearRampToValueAtTime(a,d+c+b)}else{if(!a)return this.output.gain;a.connect(this.output.gain)}},p5.SoundFile.prototype.amp=p5.SoundFile.prototype.setVolume,p5.SoundFile.prototype.fade=p5.SoundFile.prototype.setVolume,p5.SoundFile.prototype.getVolume=function(){return this.output.gain.value},p5.SoundFile.prototype.pan=function(a,b){this.panPosition=a,this.panner.pan(a,b)},p5.SoundFile.prototype.getPan=function(){return this.panPosition},p5.SoundFile.prototype.rate=function(a){if(this.playbackRate!==a||!this.bufferSourceNode||this.bufferSourceNode.playbackRate.value!==a){this.playbackRate=a;var b=a;if(0===this.playbackRate&&this._playing&&this.pause(),this.playbackRate<0&&!this.reversed){var c=this.currentTime();this.bufferSourceNode.playbackRate.value,this.reverseBuffer(),b=Math.abs(a);var d=(c-this.duration())/b;this.pauseTime=d}else this.playbackRate>0&&this.reversed&&this.reverseBuffer();if(this.bufferSourceNode){var e=g.audiocontext.currentTime;this.bufferSourceNode.playbackRate.cancelScheduledValues(e),this.bufferSourceNode.playbackRate.linearRampToValueAtTime(Math.abs(b),e),this._counterNode.playbackRate.cancelScheduledValues(e),this._counterNode.playbackRate.linearRampToValueAtTime(Math.abs(b),e)}}},p5.SoundFile.prototype.setPitch=function(a){var b=midiToFreq(a)/midiToFreq(60);this.rate(b)},p5.SoundFile.prototype.getPlaybackRate=function(){return this.playbackRate},p5.SoundFile.prototype.duration=function(){return this.buffer?this.buffer.duration:0},p5.SoundFile.prototype.currentTime=function(){return this._pauseTime>0?this._pauseTime:this._lastPos/h.sampleRate},p5.SoundFile.prototype.jump=function(a,b){if(0>a||a>this.buffer.duration)throw"jump time out of range";if(b>this.buffer.duration-a)throw"end time out of range";var c=a||0,d=b||this.buffer.duration-a;this.isPlaying()&&this.stop(),this.play(0,this.playbackRate,this.output.gain.value,c,d)},p5.SoundFile.prototype.channels=function(){return this.buffer.numberOfChannels},p5.SoundFile.prototype.sampleRate=function(){return this.buffer.sampleRate},p5.SoundFile.prototype.frames=function(){return this.buffer.length},p5.SoundFile.prototype.getPeaks=function(a){if(!this.buffer)throw"Cannot load peaks yet, buffer is not loaded";if(a||(a=5*window.width),this.buffer){for(var b=this.buffer,c=b.length/a,d=~~(c/10)||1,e=b.numberOfChannels,f=new Float32Array(Math.round(a)),g=0;e>g;g++)for(var h=b.getChannelData(g),i=0;a>i;i++){for(var j=~~(i*c),k=~~(j+c),l=0,m=j;k>m;m+=d){var n=h[m];n>l?l=n:-n>l&&(l=n)}(0===g||Math.abs(l)>f[i])&&(f[i]=l)}return f}},p5.SoundFile.prototype.reverseBuffer=function(){var a=this.getVolume();if(this.setVolume(0,.01,0),this.pause(),!this.buffer)throw"SoundFile is not done loading";for(var b=0;b<this.buffer.numberOfChannels;b++)Array.prototype.reverse.call(this.buffer.getChannelData(b));this.reversed=!this.reversed,this.setVolume(a,.01,.0101),this.play()},p5.SoundFile.prototype.onended=function(a){return this._onended=a,this},p5.SoundFile.prototype.add=function(){},p5.SoundFile.prototype.dispose=function(){var a=g.audiocontext.currentTime,b=g.soundArray.indexOf(this);if(g.soundArray.splice(b,1),this.stop(a),this.buffer&&this.bufferSourceNode){for(var c=0;c<this.bufferSourceNodes.length-1;c++)if(null!==this.bufferSourceNodes[c]){this.bufferSourceNodes[c].disconnect();try{this.bufferSourceNodes[c].stop(a)}catch(a){}this.bufferSourceNodes[c]=null}if(this.isPlaying()){try{this._counterNode.stop(a)}catch(a){console.log(a)}this._counterNode=null}}this.output&&(this.output.disconnect(),this.output=null),this.panner&&(this.panner.disconnect(),this.panner=null)},p5.SoundFile.prototype.connect=function(a){a?a.hasOwnProperty("input")?this.panner.connect(a.input):this.panner.connect(a):this.panner.connect(g.input)},p5.SoundFile.prototype.disconnect=function(){this.panner.disconnect()},p5.SoundFile.prototype.getLevel=function(a){console.warn("p5.SoundFile.getLevel has been removed from the library. Use p5.Amplitude instead")},p5.SoundFile.prototype.setPath=function(a,b){var c=p5.prototype._checkFileFormats(a);this.url=c,this.load(b)},p5.SoundFile.prototype.setBuffer=function(a){var b=a.length,c=a[0].length,d=h.createBuffer(b,c,h.sampleRate);!a[0]instanceof Float32Array&&(a[0]=new Float32Array(a[0]));for(var e=0;b>e;e++){var f=d.getChannelData(e);f.set(a[e])}this.buffer=d,this.panner.inputChannels(b)},p5.SoundFile.prototype._initCounterNode=function(){var a=this,b=h.currentTime,c=h.createBufferSource();return a._scopeNode&&(a._scopeNode.disconnect(),a._scopeNode.onaudioprocess=void 0,a._scopeNode=null),a._scopeNode=h.createScriptProcessor(256,1,1),c.buffer=i(a.buffer),c.playbackRate.setValueAtTime(a.playbackRate,b),c.connect(a._scopeNode),a._scopeNode.connect(p5.soundOut._silentNode),a._scopeNode.onaudioprocess=function(b){var c=b.inputBuffer.getChannelData(0);a._lastPos=c[c.length-1]||0,a._onTimeUpdate(a._lastPos)},c},p5.SoundFile.prototype._initSourceNode=function(){var a=this,b=(h.currentTime,h.createBufferSource());return b.buffer=a.buffer,b.playbackRate.value=a.playbackRate,b};var i=function(a){for(var b=new Float32Array(a.length),c=h.createBuffer(1,a.length,44100),d=0;d<a.length;d++)b[d]=d;return c.getChannelData(0).set(b),c};p5.SoundFile.prototype.processPeaks=function(e,f,g,h){var i=this.buffer.length,j=this.buffer.sampleRate,l=this.buffer,m=f||.9,n=m,o=g||.22,p=h||200,q=new OfflineAudioContext(1,i,j),r=q.createBufferSource();r.buffer=l;var s=q.createBiquadFilter();s.type="lowpass",r.connect(s),s.connect(q.destination),r.start(0),q.startRendering(),q.oncomplete=function(f){var g=f.renderedBuffer,h=g.getChannelData(0);do k=a(h,n),n-=.005;while(Object.keys(k).length<p&&n>=o);var i=b(k),j=c(i,g.sampleRate),l=j.sort(function(a,b){return b.count-a.count}).splice(0,5);this.tempo=l[0].tempo;var m=5,q=d(k,l[0].tempo,g.sampleRate,m);e(q)}};var j=function(a,b){this.sampleIndex=b,this.amplitude=a,this.tempos=[],this.intervals=[]},k=[];p5.SoundFile.prototype.addCue=function(a,b,c){var d=this._cueIDCounter++,e=new l(b,a,d,c);return this._cues.push(e),d},p5.SoundFile.prototype.removeCue=function(a){for(var b=this._cues.length,c=0;b>c;c++){var d=this._cues[c];d.id===a&&this.cues.splice(c,1)}0===this._cues.length},p5.SoundFile.prototype.clearCues=function(){this._cues=[]},p5.SoundFile.prototype._onTimeUpdate=function(a){for(var b=a/this.buffer.sampleRate,c=this._cues.length,d=0;c>d;d++){var e=this._cues[d],f=e.time,g=e.val;this._prevTime<f&&b>=f&&e.callback(g)}this._prevTime=b};var l=function(a,b,c,d){this.callback=a,this.time=b,this.id=c,this.val=d}}(sndcore,errorHandler,master);var amplitude;amplitude=function(){"use strict";var a=master;p5.Amplitude=function(b){this.bufferSize=2048,this.audiocontext=a.audiocontext,this.processor=this.audiocontext.createScriptProcessor(this.bufferSize,2,1),this.input=this.processor,this.output=this.audiocontext.createGain(),this.smoothing=b||0,this.volume=0,this.average=0,this.stereoVol=[0,0],this.stereoAvg=[0,0],this.stereoVolNorm=[0,0],this.volMax=.001,this.normalize=!1,this.processor.onaudioprocess=this._audioProcess.bind(this),this.processor.connect(this.output),this.output.gain.value=0,this.output.connect(this.audiocontext.destination),a.meter.connect(this.processor),a.soundArray.push(this)},p5.Amplitude.prototype.setInput=function(b,c){a.meter.disconnect(),c&&(this.smoothing=c),null==b?(console.log("Amplitude input source is not ready! Connecting to master output instead"),a.meter.connect(this.processor)):b instanceof p5.Signal?b.output.connect(this.processor):b?(b.connect(this.processor),this.processor.disconnect(),this.processor.connect(this.output)):a.meter.connect(this.processor)},p5.Amplitude.prototype.connect=function(b){b?b.hasOwnProperty("input")?this.output.connect(b.input):this.output.connect(b):this.output.connect(this.panner.connect(a.input))},p5.Amplitude.prototype.disconnect=function(a){this.output.disconnect()},p5.Amplitude.prototype._audioProcess=function(a){for(var b=0;b<a.inputBuffer.numberOfChannels;b++){for(var c,d=a.inputBuffer.getChannelData(b),e=d.length,f=0,g=0,h=0;e>h;h++)c=d[h],this.normalize?(f+=Math.max(Math.min(c/this.volMax,1),-1),g+=Math.max(Math.min(c/this.volMax,1),-1)*Math.max(Math.min(c/this.volMax,1),-1)):(f+=c,g+=c*c);var i=f/e,j=Math.sqrt(g/e);this.stereoVol[b]=Math.max(j,this.stereoVol[b]*this.smoothing),this.stereoAvg[b]=Math.max(i,this.stereoVol[b]*this.smoothing),this.volMax=Math.max(this.stereoVol[b],this.volMax)}var k=this,l=this.stereoVol.reduce(function(a,b,c){return k.stereoVolNorm[c-1]=Math.max(Math.min(k.stereoVol[c-1]/k.volMax,1),0),k.stereoVolNorm[c]=Math.max(Math.min(k.stereoVol[c]/k.volMax,1),0),a+b});this.volume=l/this.stereoVol.length,this.volNorm=Math.max(Math.min(this.volume/this.volMax,1),0)},p5.Amplitude.prototype.getLevel=function(a){return"undefined"!=typeof a?this.normalize?this.stereoVolNorm[a]:this.stereoVol[a]:this.normalize?this.volNorm:this.volume},p5.Amplitude.prototype.toggleNormalize=function(a){"boolean"==typeof a?this.normalize=a:this.normalize=!this.normalize},p5.Amplitude.prototype.smooth=function(a){a>=0&&1>a?this.smoothing=a:console.log("Error: smoothing must be between 0 and 1")},p5.Amplitude.prototype.dispose=function(){var b=a.soundArray.indexOf(this);a.soundArray.splice(b,1),this.input.disconnect(),this.output.disconnect(),this.input=this.processor=void 0,this.output=void 0}}(master);var fft;fft=function(){"use strict";var a=master;p5.FFT=function(b,c){this.smoothing=b||.8,this.bins=c||1024;var d=2*c||2048;this.input=this.analyser=a.audiocontext.createAnalyser(),a.fftMeter.connect(this.analyser),this.analyser.smoothingTimeConstant=this.smoothing,this.analyser.fftSize=d,this.freqDomain=new Uint8Array(this.analyser.frequencyBinCount),this.timeDomain=new Uint8Array(this.analyser.frequencyBinCount),this.bass=[20,140],this.lowMid=[140,400],this.mid=[400,2600],this.highMid=[2600,5200],this.treble=[5200,14e3],a.soundArray.push(this)},p5.FFT.prototype.setInput=function(b){b?(b.output?b.output.connect(this.analyser):b.connect&&b.connect(this.analyser),a.fftMeter.disconnect()):a.fftMeter.connect(this.analyser)},p5.FFT.prototype.waveform=function(){for(var a,b,c,f=0;f<arguments.length;f++)"number"==typeof arguments[f]&&(a=arguments[f],this.analyser.fftSize=2*a),"string"==typeof arguments[f]&&(b=arguments[f]);if(b&&!p5.prototype._isSafari())return d(this,this.timeDomain),this.analyser.getFloatTimeDomainData(this.timeDomain),this.timeDomain;e(this,this.timeDomain),this.analyser.getByteTimeDomainData(this.timeDomain);for(var c=new Array,f=0;f<this.timeDomain.length;f++){var g=p5.prototype.map(this.timeDomain[f],0,255,-1,1);c.push(g)}return c},p5.FFT.prototype.analyze=function(){for(var a,d,e=0;e<arguments.length;e++)"number"==typeof arguments[e]&&(a=this.bins=arguments[e],this.analyser.fftSize=2*this.bins),"string"==typeof arguments[e]&&(d=arguments[e]);if(d&&"db"===d.toLowerCase())return b(this),this.analyser.getFloatFrequencyData(this.freqDomain),this.freqDomain;c(this,this.freqDomain),this.analyser.getByteFrequencyData(this.freqDomain);var f=Array.apply([],this.freqDomain);return f.length===this.analyser.fftSize,f.constructor===Array,f},p5.FFT.prototype.getEnergy=function(b,c){var d=a.audiocontext.sampleRate/2;if("bass"===b?(b=this.bass[0],c=this.bass[1]):"lowMid"===b?(b=this.lowMid[0],c=this.lowMid[1]):"mid"===b?(b=this.mid[0],c=this.mid[1]):"highMid"===b?(b=this.highMid[0],c=this.highMid[1]):"treble"===b&&(b=this.treble[0],c=this.treble[1]),"number"!=typeof b)throw"invalid input for getEnergy()";if(c){if(b&&c){if(b>c){var e=c;c=b,b=e}for(var f=Math.round(b/d*this.freqDomain.length),g=Math.round(c/d*this.freqDomain.length),h=0,i=0,j=f;g>=j;j++)h+=this.freqDomain[j],i+=1;var k=h/i;return k}throw"invalid input for getEnergy()"}var l=Math.round(b/d*this.freqDomain.length);return this.freqDomain[l]},p5.FFT.prototype.getFreq=function(a,b){console.log("getFreq() is deprecated. Please use getEnergy() instead.");var c=this.getEnergy(a,b);return c},p5.FFT.prototype.getCentroid=function(){for(var b=a.audiocontext.sampleRate/2,c=0,d=0,e=0;e<this.freqDomain.length;e++)c+=e*this.freqDomain[e],d+=this.freqDomain[e];var f=0;0!=d&&(f=c/d);var g=f*(b/this.freqDomain.length);return g},p5.FFT.prototype.smooth=function(a){a&&(this.smoothing=a),this.analyser.smoothingTimeConstant=a},p5.FFT.prototype.dispose=function(){var b=a.soundArray.indexOf(this);a.soundArray.splice(b,1),this.analyser.disconnect(),this.analyser=void 0},p5.FFT.prototype.linAverages=function(a){for(var a=a||16,b=this.freqDomain,c=b.length,d=Math.floor(c/a),e=new Array(a),f=0,g=0;c>g;g++)e[f]=void 0!==e[f]?(e[f]+b[g])/2:b[g],g%d==d-1&&f++;return e},p5.FFT.prototype.logAverages=function(b){for(var c=a.audiocontext.sampleRate/2,d=this.freqDomain,e=d.length,f=new Array(b.length),g=0,h=0;e>h;h++){var i=Math.round(h*c/this.freqDomain.length);i>b[g].hi&&g++,f[g]=void 0!==f[g]?(f[g]+d[h])/2:d[h]}return f},p5.FFT.prototype.getOctaveBands=function(b,c){var b=b||3,c=c||15.625,d=[],e={lo:c/Math.pow(2,1/(2*b)),ctr:c,hi:c*Math.pow(2,1/(2*b))};d.push(e);for(var f=a.audiocontext.sampleRate/2;e.hi<f;){var g={};g.lo=e.hi,g.ctr=e.ctr*Math.pow(2,1/b),g.hi=g.ctr*Math.pow(2,1/(2*b)),d.push(g),e=g}return d};var b=function(a){a.freqDomain instanceof Float32Array==0&&(a.freqDomain=new Float32Array(a.analyser.frequencyBinCount))},c=function(a){a.freqDomain instanceof Uint8Array==0&&(a.freqDomain=new Uint8Array(a.analyser.frequencyBinCount))},d=function(a){a.timeDomain instanceof Float32Array==0&&(a.timeDomain=new Float32Array(a.analyser.frequencyBinCount))},e=function(a){a.timeDomain instanceof Uint8Array==0&&(a.timeDomain=new Uint8Array(a.analyser.frequencyBinCount))}}(master);var Tone_core_Tone;Tone_core_Tone=function(){"use strict";function a(a){return void 0===a}function b(a){return"function"==typeof a}var c;if(a(window.AudioContext)&&(window.AudioContext=window.webkitAudioContext),a(window.OfflineAudioContext)&&(window.OfflineAudioContext=window.webkitOfflineAudioContext),a(AudioContext))throw new Error("Web Audio is not supported in this browser");c=new AudioContext,b(AudioContext.prototype.createGain)||(AudioContext.prototype.createGain=AudioContext.prototype.createGainNode),b(AudioContext.prototype.createDelay)||(AudioContext.prototype.createDelay=AudioContext.prototype.createDelayNode),b(AudioContext.prototype.createPeriodicWave)||(AudioContext.prototype.createPeriodicWave=AudioContext.prototype.createWaveTable),b(AudioBufferSourceNode.prototype.start)||(AudioBufferSourceNode.prototype.start=AudioBufferSourceNode.prototype.noteGrainOn),b(AudioBufferSourceNode.prototype.stop)||(AudioBufferSourceNode.prototype.stop=AudioBufferSourceNode.prototype.noteOff),
b(OscillatorNode.prototype.start)||(OscillatorNode.prototype.start=OscillatorNode.prototype.noteOn),b(OscillatorNode.prototype.stop)||(OscillatorNode.prototype.stop=OscillatorNode.prototype.noteOff),b(OscillatorNode.prototype.setPeriodicWave)||(OscillatorNode.prototype.setPeriodicWave=OscillatorNode.prototype.setWaveTable),AudioNode.prototype._nativeConnect=AudioNode.prototype.connect,AudioNode.prototype.connect=function(b,c,d){if(b.input)Array.isArray(b.input)?(a(d)&&(d=0),this.connect(b.input[d])):this.connect(b.input,c,d);else try{b instanceof AudioNode?this._nativeConnect(b,c,d):this._nativeConnect(b,c)}catch(a){throw new Error("error connecting to node: "+b)}};var d=function(b,c){a(b)||1===b?this.input=this.context.createGain():b>1&&(this.input=new Array(b)),a(c)||1===c?this.output=this.context.createGain():c>1&&(this.output=new Array(b))};d.prototype.set=function(b,c,e){if(this.isObject(b))e=c;else if(this.isString(b)){var f={};f[b]=c,b=f}for(var g in b){c=b[g];var h=this;if(-1!==g.indexOf(".")){for(var i=g.split("."),j=0;j<i.length-1;j++)h=h[i[j]];g=i[i.length-1]}var k=h[g];a(k)||(d.Signal&&k instanceof d.Signal||d.Param&&k instanceof d.Param?k.value!==c&&(a(e)?k.value=c:k.rampTo(c,e)):k instanceof AudioParam?k.value!==c&&(k.value=c):k instanceof d?k.set(c):k!==c&&(h[g]=c))}return this},d.prototype.get=function(c){a(c)?c=this._collectDefaults(this.constructor):this.isString(c)&&(c=[c]);for(var e={},f=0;f<c.length;f++){var g=c[f],h=this,i=e;if(-1!==g.indexOf(".")){for(var j=g.split("."),k=0;k<j.length-1;k++){var l=j[k];i[l]=i[l]||{},i=i[l],h=h[l]}g=j[j.length-1]}var m=h[g];this.isObject(c[g])?i[g]=m.get():d.Signal&&m instanceof d.Signal?i[g]=m.value:d.Param&&m instanceof d.Param?i[g]=m.value:m instanceof AudioParam?i[g]=m.value:m instanceof d?i[g]=m.get():b(m)||a(m)||(i[g]=m)}return e},d.prototype._collectDefaults=function(b){var c=[];if(a(b.defaults)||(c=Object.keys(b.defaults)),!a(b._super))for(var d=this._collectDefaults(b._super),e=0;e<d.length;e++)-1===c.indexOf(d[e])&&c.push(d[e]);return c},d.prototype.toString=function(){for(var a in d){var c=a[0].match(/^[A-Z]$/),e=d[a]===this.constructor;if(b(d[a])&&c&&e)return a}return"Tone"},d.context=c,d.prototype.context=d.context,d.prototype.bufferSize=2048,d.prototype.blockTime=128/d.context.sampleRate,d.prototype.dispose=function(){return this.isUndef(this.input)||(this.input instanceof AudioNode&&this.input.disconnect(),this.input=null),this.isUndef(this.output)||(this.output instanceof AudioNode&&this.output.disconnect(),this.output=null),this};var e=null;d.prototype.noGC=function(){return this.output.connect(e),this},AudioNode.prototype.noGC=function(){return this.connect(e),this},d.prototype.connect=function(a,b,c){return Array.isArray(this.output)?(b=this.defaultArg(b,0),this.output[b].connect(a,0,c)):this.output.connect(a,b,c),this},d.prototype.disconnect=function(a){return Array.isArray(this.output)?(a=this.defaultArg(a,0),this.output[a].disconnect()):this.output.disconnect(),this},d.prototype.connectSeries=function(){if(arguments.length>1)for(var a=arguments[0],b=1;b<arguments.length;b++){var c=arguments[b];a.connect(c),a=c}return this},d.prototype.connectParallel=function(){var a=arguments[0];if(arguments.length>1)for(var b=1;b<arguments.length;b++){var c=arguments[b];a.connect(c)}return this},d.prototype.chain=function(){if(arguments.length>0)for(var a=this,b=0;b<arguments.length;b++){var c=arguments[b];a.connect(c),a=c}return this},d.prototype.fan=function(){if(arguments.length>0)for(var a=0;a<arguments.length;a++)this.connect(arguments[a]);return this},AudioNode.prototype.chain=d.prototype.chain,AudioNode.prototype.fan=d.prototype.fan,d.prototype.defaultArg=function(b,c){if(this.isObject(b)&&this.isObject(c)){var d={};for(var e in b)d[e]=this.defaultArg(c[e],b[e]);for(var f in c)d[f]=this.defaultArg(b[f],c[f]);return d}return a(b)?c:b},d.prototype.optionsObject=function(a,b,c){var d={};if(1===a.length&&this.isObject(a[0]))d=a[0];else for(var e=0;e<b.length;e++)d[b[e]]=a[e];return this.isUndef(c)?d:this.defaultArg(d,c)},d.prototype.isUndef=a,d.prototype.isFunction=b,d.prototype.isNumber=function(a){return"number"==typeof a},d.prototype.isObject=function(a){return"[object Object]"===Object.prototype.toString.call(a)&&a.constructor===Object},d.prototype.isBoolean=function(a){return"boolean"==typeof a},d.prototype.isArray=function(a){return Array.isArray(a)},d.prototype.isString=function(a){return"string"==typeof a},d.noOp=function(){},d.prototype._readOnly=function(a){if(Array.isArray(a))for(var b=0;b<a.length;b++)this._readOnly(a[b]);else Object.defineProperty(this,a,{writable:!1,enumerable:!0})},d.prototype._writable=function(a){if(Array.isArray(a))for(var b=0;b<a.length;b++)this._writable(a[b]);else Object.defineProperty(this,a,{writable:!0})},d.State={Started:"started",Stopped:"stopped",Paused:"paused"},d.prototype.equalPowerScale=function(a){var b=.5*Math.PI;return Math.sin(a*b)},d.prototype.dbToGain=function(a){return Math.pow(2,a/6)},d.prototype.gainToDb=function(a){return 20*(Math.log(a)/Math.LN10)},d.prototype.now=function(){return this.context.currentTime},d.extend=function(b,c){function e(){}a(c)&&(c=d),e.prototype=c.prototype,b.prototype=new e,b.prototype.constructor=b,b._super=c};var f=[];return d._initAudioContext=function(a){a(d.context),f.push(a)},d.setContext=function(a){d.prototype.context=a,d.context=a;for(var b=0;b<f.length;b++)f[b](a)},d.startMobile=function(){var a=d.context.createOscillator(),b=d.context.createGain();b.gain.value=0,a.connect(b),b.connect(d.context.destination);var c=d.context.currentTime;a.start(c),a.stop(c+1)},d._initAudioContext(function(a){d.prototype.blockTime=128/a.sampleRate,e=a.createGain(),e.gain.value=0,e.connect(a.destination)}),d.version="r7-dev",d}();var Tone_signal_SignalBase;Tone_signal_SignalBase=function(a){"use strict";return a.SignalBase=function(){},a.extend(a.SignalBase),a.SignalBase.prototype.connect=function(b,c,d){return a.Signal&&a.Signal===b.constructor||a.Param&&a.Param===b.constructor||a.TimelineSignal&&a.TimelineSignal===b.constructor?(b._param.cancelScheduledValues(0),b._param.value=0,b.overridden=!0):b instanceof AudioParam&&(b.cancelScheduledValues(0),b.value=0),a.prototype.connect.call(this,b,c,d),this},a.SignalBase}(Tone_core_Tone);var Tone_signal_WaveShaper;Tone_signal_WaveShaper=function(a){"use strict";return a.WaveShaper=function(a,b){this._shaper=this.input=this.output=this.context.createWaveShaper(),this._curve=null,Array.isArray(a)?this.curve=a:isFinite(a)||this.isUndef(a)?this._curve=new Float32Array(this.defaultArg(a,1024)):this.isFunction(a)&&(this._curve=new Float32Array(this.defaultArg(b,1024)),this.setMap(a))},a.extend(a.WaveShaper,a.SignalBase),a.WaveShaper.prototype.setMap=function(a){for(var b=0,c=this._curve.length;c>b;b++){var d=b/c*2-1;this._curve[b]=a(d,b)}return this._shaper.curve=this._curve,this},Object.defineProperty(a.WaveShaper.prototype,"curve",{get:function(){return this._shaper.curve},set:function(a){this._curve=new Float32Array(a),this._shaper.curve=this._curve}}),Object.defineProperty(a.WaveShaper.prototype,"oversample",{get:function(){return this._shaper.oversample},set:function(a){if(-1===["none","2x","4x"].indexOf(a))throw new Error("invalid oversampling: "+a);this._shaper.oversample=a}}),a.WaveShaper.prototype.dispose=function(){return a.prototype.dispose.call(this),this._shaper.disconnect(),this._shaper=null,this._curve=null,this},a.WaveShaper}(Tone_core_Tone);var Tone_core_Type;Tone_core_Type=function(Tone){"use strict";function getTransportBpm(){return Tone.Transport&&Tone.Transport.bpm?Tone.Transport.bpm.value:120}function getTransportTimeSignature(){return Tone.Transport&&Tone.Transport.timeSignature?Tone.Transport.timeSignature:4}function toNotationHelper(a,b,c,d){for(var e=this.toSeconds(a),f=this.notationToSeconds(d[d.length-1],b,c),g="",h=0;h<d.length;h++){var i=this.notationToSeconds(d[h],b,c),j=e/i,k=1e-6;if(k>1-j%1&&(j+=k),j=Math.floor(j),j>0){if(g+=1===j?d[h]:j.toString()+"*"+d[h],e-=j*i,f>e)break;g+=" + "}}return""===g&&(g="0"),g}Tone.Type={Default:"number",Time:"time",Frequency:"frequency",NormalRange:"normalRange",AudioRange:"audioRange",Decibels:"db",Interval:"interval",BPM:"bpm",Positive:"positive",Cents:"cents",Degrees:"degrees",MIDI:"midi",TransportTime:"transportTime",Ticks:"tick",Note:"note",Milliseconds:"milliseconds",Notation:"notation"},Tone.prototype.isNowRelative=function(){var a=new RegExp(/^\s*\+(.)+/i);return function(b){return a.test(b)}}(),Tone.prototype.isTicks=function(){var a=new RegExp(/^\d+i$/i);return function(b){return a.test(b)}}(),Tone.prototype.isNotation=function(){var a=new RegExp(/^[0-9]+[mnt]$/i);return function(b){return a.test(b)}}(),Tone.prototype.isTransportTime=function(){var a=new RegExp(/^(\d+(\.\d+)?\:){1,2}(\d+(\.\d+)?)?$/i);return function(b){return a.test(b)}}(),Tone.prototype.isNote=function(){var a=new RegExp(/^[a-g]{1}(b|#|x|bb)?-?[0-9]+$/i);return function(b){return a.test(b)}}(),Tone.prototype.isFrequency=function(){var a=new RegExp(/^\d*\.?\d+hz$/i);return function(b){return a.test(b)}}(),Tone.prototype.notationToSeconds=function(a,b,c){b=this.defaultArg(b,getTransportBpm()),c=this.defaultArg(c,getTransportTimeSignature());var d=60/b;"1n"===a&&(a="1m");var e=parseInt(a,10),f=0;0===e&&(f=0);var g=a.slice(-1);return f="t"===g?4/e*2/3:"n"===g?4/e:"m"===g?e*c:0,d*f},Tone.prototype.transportTimeToSeconds=function(a,b,c){b=this.defaultArg(b,getTransportBpm()),c=this.defaultArg(c,getTransportTimeSignature());var d=0,e=0,f=0,g=a.split(":");2===g.length?(d=parseFloat(g[0]),e=parseFloat(g[1])):1===g.length?e=parseFloat(g[0]):3===g.length&&(d=parseFloat(g[0]),e=parseFloat(g[1]),f=parseFloat(g[2]));var h=d*c+e+f/4;return h*(60/b)},Tone.prototype.ticksToSeconds=function(a,b){if(this.isUndef(Tone.Transport))return 0;a=parseFloat(a),b=this.defaultArg(b,getTransportBpm());var c=60/b/Tone.Transport.PPQ;return c*a},Tone.prototype.frequencyToSeconds=function(a){return 1/parseFloat(a)},Tone.prototype.samplesToSeconds=function(a){return a/this.context.sampleRate},Tone.prototype.secondsToSamples=function(a){return a*this.context.sampleRate},Tone.prototype.secondsToTransportTime=function(a,b,c){b=this.defaultArg(b,getTransportBpm()),c=this.defaultArg(c,getTransportTimeSignature());var d=60/b,e=a/d,f=Math.floor(e/c),g=e%1*4;e=Math.floor(e)%c;var h=[f,e,g];return h.join(":")},Tone.prototype.secondsToFrequency=function(a){return 1/a},Tone.prototype.toTransportTime=function(a,b,c){var d=this.toSeconds(a);return this.secondsToTransportTime(d,b,c)},Tone.prototype.toFrequency=function(a,b){return this.isFrequency(a)?parseFloat(a):this.isNotation(a)||this.isTransportTime(a)?this.secondsToFrequency(this.toSeconds(a,b)):this.isNote(a)?this.noteToFrequency(a):a},Tone.prototype.toTicks=function(a){if(this.isUndef(Tone.Transport))return 0;var b=Tone.Transport.bpm.value,c=0;if(this.isNowRelative(a))a=a.replace("+",""),c=Tone.Transport.ticks;else if(this.isUndef(a))return Tone.Transport.ticks;var d=this.toSeconds(a),e=60/b,f=d/e,g=f*Tone.Transport.PPQ;return Math.round(g+c)},Tone.prototype.toSamples=function(a){var b=this.toSeconds(a);return Math.round(b*this.context.sampleRate)},Tone.prototype.toSeconds=function(time,now){if(now=this.defaultArg(now,this.now()),this.isNumber(time))return time;if(this.isString(time)){var plusTime=0;this.isNowRelative(time)&&(time=time.replace("+",""),plusTime=now);var betweenParens=time.match(/\(([^)(]+)\)/g);if(betweenParens)for(var j=0;j<betweenParens.length;j++){var symbol=betweenParens[j].replace(/[\(\)]/g,""),symbolVal=this.toSeconds(symbol);time=time.replace(betweenParens[j],symbolVal)}if(-1!==time.indexOf("@")){var quantizationSplit=time.split("@");if(this.isUndef(Tone.Transport))throw new Error("quantization requires Tone.Transport");var toQuantize=quantizationSplit[0].trim();""===toQuantize&&(toQuantize=void 0),plusTime>0&&(toQuantize="+"+toQuantize,plusTime=0);var subdivision=quantizationSplit[1].trim();time=Tone.Transport.quantize(toQuantize,subdivision)}else{var components=time.split(/[\(\)\-\+\/\*]/);if(components.length>1){for(var originalTime=time,i=0;i<components.length;i++){var symb=components[i].trim();if(""!==symb){var val=this.toSeconds(symb);time=time.replace(symb,val)}}try{time=eval(time)}catch(a){throw new EvalError("cannot evaluate Time: "+originalTime)}}else time=this.isNotation(time)?this.notationToSeconds(time):this.isTransportTime(time)?this.transportTimeToSeconds(time):this.isFrequency(time)?this.frequencyToSeconds(time):this.isTicks(time)?this.ticksToSeconds(time):parseFloat(time)}return time+plusTime}return now},Tone.prototype.toNotation=function(a,b,c){var d=["1m","2n","4n","8n","16n","32n","64n","128n"],e=toNotationHelper.call(this,a,b,c,d),f=["1m","2n","2t","4n","4t","8n","8t","16n","16t","32n","32t","64n","64t","128n"],g=toNotationHelper.call(this,a,b,c,f);return g.split("+").length<e.split("+").length?g:e},Tone.prototype.fromUnits=function(a,b){if(!this.convert&&!this.isUndef(this.convert))return a;switch(b){case Tone.Type.Time:return this.toSeconds(a);case Tone.Type.Frequency:return this.toFrequency(a);case Tone.Type.Decibels:return this.dbToGain(a);case Tone.Type.NormalRange:return Math.min(Math.max(a,0),1);case Tone.Type.AudioRange:return Math.min(Math.max(a,-1),1);case Tone.Type.Positive:return Math.max(a,0);default:return a}},Tone.prototype.toUnits=function(a,b){if(!this.convert&&!this.isUndef(this.convert))return a;switch(b){case Tone.Type.Decibels:return this.gainToDb(a);default:return a}};var noteToScaleIndex={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},scaleIndexToNote=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return Tone.A4=440,Tone.prototype.noteToFrequency=function(a){var b=a.split(/(-?\d+)/);if(3===b.length){var c=noteToScaleIndex[b[0].toLowerCase()],d=b[1],e=c+12*(parseInt(d,10)+1);return this.midiToFrequency(e)}return 0},Tone.prototype.frequencyToNote=function(a){var b=Math.log(a/Tone.A4)/Math.LN2,c=Math.round(12*b)+57,d=Math.floor(c/12);0>d&&(c+=-12*d);var e=scaleIndexToNote[c%12];return e+d.toString()},Tone.prototype.intervalToFrequencyRatio=function(a){return Math.pow(2,a/12)},Tone.prototype.midiToNote=function(a){var b=Math.floor(a/12)-1,c=a%12;return scaleIndexToNote[c]+b},Tone.prototype.noteToMidi=function(a){var b=a.split(/(\d+)/);if(3===b.length){var c=noteToScaleIndex[b[0].toLowerCase()],d=b[1];return c+12*(parseInt(d,10)+1)}return 0},Tone.prototype.midiToFrequency=function(a){return Tone.A4*Math.pow(2,(a-69)/12)},Tone}(Tone_core_Tone);var Tone_core_Param;Tone_core_Param=function(a){"use strict";return a.Param=function(){var b=this.optionsObject(arguments,["param","units","convert"],a.Param.defaults);this._param=this.input=b.param,this.units=b.units,this.convert=b.convert,this.overridden=!1,this.isUndef(b.value)||(this.value=b.value)},a.extend(a.Param),a.Param.defaults={units:a.Type.Default,convert:!0,param:void 0},Object.defineProperty(a.Param.prototype,"value",{get:function(){return this._toUnits(this._param.value)},set:function(a){var b=this._fromUnits(a);this._param.value=b}}),a.Param.prototype._fromUnits=function(b){if(!this.convert&&!this.isUndef(this.convert))return b;switch(this.units){case a.Type.Time:return this.toSeconds(b);case a.Type.Frequency:return this.toFrequency(b);case a.Type.Decibels:return this.dbToGain(b);case a.Type.NormalRange:return Math.min(Math.max(b,0),1);case a.Type.AudioRange:return Math.min(Math.max(b,-1),1);case a.Type.Positive:return Math.max(b,0);default:return b}},a.Param.prototype._toUnits=function(b){if(!this.convert&&!this.isUndef(this.convert))return b;switch(this.units){case a.Type.Decibels:return this.gainToDb(b);default:return b}},a.Param.prototype._minOutput=1e-5,a.Param.prototype.setValueAtTime=function(a,b){return a=this._fromUnits(a),this._param.setValueAtTime(a,this.toSeconds(b)),this},a.Param.prototype.setRampPoint=function(a){a=this.defaultArg(a,this.now());var b=this._param.value;return this._param.setValueAtTime(b,a),this},a.Param.prototype.linearRampToValueAtTime=function(a,b){return a=this._fromUnits(a),this._param.linearRampToValueAtTime(a,this.toSeconds(b)),this},a.Param.prototype.exponentialRampToValueAtTime=function(a,b){return a=this._fromUnits(a),a=Math.max(this._minOutput,a),this._param.exponentialRampToValueAtTime(a,this.toSeconds(b)),this},a.Param.prototype.exponentialRampToValue=function(a,b){var c=this.now(),d=this.value;return this.setValueAtTime(Math.max(d,this._minOutput),c),this.exponentialRampToValueAtTime(a,c+this.toSeconds(b)),this},a.Param.prototype.linearRampToValue=function(a,b){var c=this.now();return this.setRampPoint(c),this.linearRampToValueAtTime(a,c+this.toSeconds(b)),this},a.Param.prototype.setTargetAtTime=function(a,b,c){return a=this._fromUnits(a),a=Math.max(this._minOutput,a),c=Math.max(this._minOutput,c),this._param.setTargetAtTime(a,this.toSeconds(b),c),this},a.Param.prototype.setValueCurveAtTime=function(a,b,c){for(var d=0;d<a.length;d++)a[d]=this._fromUnits(a[d]);return this._param.setValueCurveAtTime(a,this.toSeconds(b),this.toSeconds(c)),this},a.Param.prototype.cancelScheduledValues=function(a){return this._param.cancelScheduledValues(this.toSeconds(a)),this},a.Param.prototype.rampTo=function(b,c){return c=this.defaultArg(c,0),this.units===a.Type.Frequency||this.units===a.Type.BPM?this.exponentialRampToValue(b,c):this.linearRampToValue(b,c),this},a.Param.prototype.dispose=function(){return a.prototype.dispose.call(this),this._param=null,this},a.Param}(Tone_core_Tone);var Tone_core_Gain;Tone_core_Gain=function(a){"use strict";return a.Gain=function(){var b=this.optionsObject(arguments,["gain","units"],a.Gain.defaults);this.input=this.output=this._gainNode=this.context.createGain(),this.gain=new a.Param({param:this._gainNode.gain,units:b.units,value:b.gain,convert:b.convert}),this._readOnly("gain")},a.extend(a.Gain),a.Gain.defaults={gain:1,convert:!0},a.Gain.prototype.dispose=function(){a.Param.prototype.dispose.call(this),this._gainNode.disconnect(),this._gainNode=null,this._writable("gain"),this.gain.dispose(),this.gain=null},a.Gain}(Tone_core_Tone,Tone_core_Param);var Tone_signal_Signal;Tone_signal_Signal=function(a){"use strict";return a.Signal=function(){var b=this.optionsObject(arguments,["value","units"],a.Signal.defaults);this.output=this._gain=this.context.createGain(),b.param=this._gain.gain,a.Param.call(this,b),this.input=this._param=this._gain.gain,a.Signal._constant.chain(this._gain)},a.extend(a.Signal,a.Param),a.Signal.defaults={value:0,units:a.Type.Default,convert:!0},a.Signal.prototype.connect=a.SignalBase.prototype.connect,a.Signal.prototype.dispose=function(){return a.Param.prototype.dispose.call(this),this._param=null,this._gain.disconnect(),this._gain=null,this},a.Signal._constant=null,a._initAudioContext(function(b){for(var c=b.createBuffer(1,128,b.sampleRate),d=c.getChannelData(0),e=0;e<d.length;e++)d[e]=1;a.Signal._constant=b.createBufferSource(),a.Signal._constant.channelCount=1,a.Signal._constant.channelCountMode="explicit",a.Signal._constant.buffer=c,a.Signal._constant.loop=!0,a.Signal._constant.start(0),a.Signal._constant.noGC()}),a.Signal}(Tone_core_Tone,Tone_signal_WaveShaper,Tone_core_Type,Tone_core_Param);var Tone_signal_Add;Tone_signal_Add=function(a){"use strict";return a.Add=function(b){a.call(this,2,0),this._sum=this.input[0]=this.input[1]=this.output=this.context.createGain(),this._param=this.input[1]=new a.Signal(b),this._param.connect(this._sum)},a.extend(a.Add,a.Signal),a.Add.prototype.dispose=function(){return a.prototype.dispose.call(this),this._sum.disconnect(),this._sum=null,this._param.dispose(),this._param=null,this},a.Add}(Tone_core_Tone);var Tone_signal_Multiply;Tone_signal_Multiply=function(a){"use strict";return a.Multiply=function(b){a.call(this,2,0),this._mult=this.input[0]=this.output=this.context.createGain(),this._param=this.input[1]=this.output.gain,this._param.value=this.defaultArg(b,0)},a.extend(a.Multiply,a.Signal),a.Multiply.prototype.dispose=function(){return a.prototype.dispose.call(this),this._mult.disconnect(),this._mult=null,this._param=null,this},a.Multiply}(Tone_core_Tone);var Tone_signal_Scale;Tone_signal_Scale=function(a){"use strict";return a.Scale=function(b,c){this._outputMin=this.defaultArg(b,0),this._outputMax=this.defaultArg(c,1),this._scale=this.input=new a.Multiply(1),this._add=this.output=new a.Add(0),this._scale.connect(this._add),this._setRange()},a.extend(a.Scale,a.SignalBase),Object.defineProperty(a.Scale.prototype,"min",{get:function(){return this._outputMin},set:function(a){this._outputMin=a,this._setRange()}}),Object.defineProperty(a.Scale.prototype,"max",{get:function(){return this._outputMax},set:function(a){this._outputMax=a,this._setRange()}}),a.Scale.prototype._setRange=function(){this._add.value=this._outputMin,this._scale.value=this._outputMax-this._outputMin},a.Scale.prototype.dispose=function(){return a.prototype.dispose.call(this),this._add.dispose(),this._add=null,this._scale.dispose(),this._scale=null,this},a.Scale}(Tone_core_Tone,Tone_signal_Add,Tone_signal_Multiply);var signal;signal=function(){"use strict";var a=Tone_signal_Signal,b=Tone_signal_Add,c=Tone_signal_Multiply,d=Tone_signal_Scale,e=Tone_core_Tone,f=master;e.setContext(f.audiocontext),p5.Signal=function(b){var c=new a(b);return c},a.prototype.fade=a.prototype.linearRampToValueAtTime,c.prototype.fade=a.prototype.fade,b.prototype.fade=a.prototype.fade,d.prototype.fade=a.prototype.fade,a.prototype.setInput=function(a){a.connect(this)},c.prototype.setInput=a.prototype.setInput,b.prototype.setInput=a.prototype.setInput,d.prototype.setInput=a.prototype.setInput,a.prototype.add=function(a){var c=new b(a);return this.connect(c),c},c.prototype.add=a.prototype.add,b.prototype.add=a.prototype.add,d.prototype.add=a.prototype.add,a.prototype.mult=function(a){var b=new c(a);return this.connect(b),b},c.prototype.mult=a.prototype.mult,b.prototype.mult=a.prototype.mult,d.prototype.mult=a.prototype.mult,a.prototype.scale=function(a,b,c,e){var f,g;4===arguments.length?(f=p5.prototype.map(c,a,b,0,1)-.5,g=p5.prototype.map(e,a,b,0,1)-.5):(f=arguments[0],g=arguments[1]);var h=new d(f,g);return this.connect(h),h},c.prototype.scale=a.prototype.scale,b.prototype.scale=a.prototype.scale,d.prototype.scale=a.prototype.scale}(Tone_signal_Signal,Tone_signal_Add,Tone_signal_Multiply,Tone_signal_Scale,Tone_core_Tone,master);var oscillator;oscillator=function(){"use strict";var a=master,b=Tone_signal_Add,c=Tone_signal_Multiply,d=Tone_signal_Scale;p5.Oscillator=function(b,c){if("string"==typeof b){var d=c;c=b,b=d}if("number"==typeof c){var d=c;c=b,b=d}this.started=!1,this.phaseAmount=void 0,this.oscillator=a.audiocontext.createOscillator(),this.f=b||440,this.oscillator.type=c||"sine",this.oscillator.frequency.setValueAtTime(this.f,a.audiocontext.currentTime),this.oscillator,this.output=a.audiocontext.createGain(),this._freqMods=[],this.output.gain.value=.5,this.output.gain.setValueAtTime(.5,a.audiocontext.currentTime),this.oscillator.connect(this.output),this.panPosition=0,this.connection=a.input,this.panner=new p5.Panner(this.output,this.connection,1),this.mathOps=[this.output],a.soundArray.push(this)},p5.Oscillator.prototype.start=function(b,c){if(this.started){var d=a.audiocontext.currentTime;this.stop(d)}if(!this.started){var e=c||this.f,f=this.oscillator.type;this.oscillator&&(this.oscillator.disconnect(),this.oscillator=void 0),this.oscillator=a.audiocontext.createOscillator(),this.oscillator.frequency.exponentialRampToValueAtTime(Math.abs(e),a.audiocontext.currentTime),this.oscillator.type=f,this.oscillator.connect(this.output),b=b||0,this.oscillator.start(b+a.audiocontext.currentTime),this.freqNode=this.oscillator.frequency;for(var g in this._freqMods)"undefined"!=typeof this._freqMods[g].connect&&this._freqMods[g].connect(this.oscillator.frequency);this.started=!0}},p5.Oscillator.prototype.stop=function(b){if(this.started){var c=b||0,d=a.audiocontext.currentTime;this.oscillator.stop(c+d),this.started=!1}},p5.Oscillator.prototype.amp=function(b,c,d){var e=this;if("number"==typeof b){var c=c||0,d=d||0,f=a.audiocontext.currentTime,g=this.output.gain.value;this.output.gain.cancelScheduledValues(f),this.output.gain.linearRampToValueAtTime(g,f+d),this.output.gain.linearRampToValueAtTime(b,f+d+c)}else{if(!b)return this.output.gain;b.connect(e.output.gain)}},p5.Oscillator.prototype.fade=p5.Oscillator.prototype.amp,p5.Oscillator.prototype.getAmp=function(){return this.output.gain.value},p5.Oscillator.prototype.freq=function(b,c,d){if("number"!=typeof b||isNaN(b)){if(!b)return this.oscillator.frequency;b.output&&(b=b.output),b.connect(this.oscillator.frequency),this._freqMods.push(b)}else{this.f=b;var e=a.audiocontext.currentTime,c=c||0,d=d||0;0==c?(this.oscillator.frequency.cancelScheduledValues(e),this.oscillator.frequency.setValueAtTime(b,d+e)):b>0?this.oscillator.frequency.exponentialRampToValueAtTime(b,d+c+e):this.oscillator.frequency.linearRampToValueAtTime(b,d+c+e),this.phaseAmount&&this.phase(this.phaseAmount)}},p5.Oscillator.prototype.getFreq=function(){return this.oscillator.frequency.value},p5.Oscillator.prototype.setType=function(a){this.oscillator.type=a},p5.Oscillator.prototype.getType=function(){return this.oscillator.type},p5.Oscillator.prototype.connect=function(b){b?b.hasOwnProperty("input")?(this.panner.connect(b.input),this.connection=b.input):(this.panner.connect(b),this.connection=b):this.panner.connect(a.input)},p5.Oscillator.prototype.disconnect=function(a){this.output.disconnect(),this.panner.disconnect(),this.output.connect(this.panner),this.oscMods=[]},p5.Oscillator.prototype.pan=function(a,b){this.panPosition=a,this.panner.pan(a,b)},p5.Oscillator.prototype.getPan=function(){return this.panPosition},p5.Oscillator.prototype.dispose=function(){var b=a.soundArray.indexOf(this);if(a.soundArray.splice(b,1),this.oscillator){var c=a.audiocontext.currentTime;this.stop(c),this.disconnect(),this.panner=null,this.oscillator=null}this.osc2&&this.osc2.dispose()},p5.Oscillator.prototype.phase=function(b){var c=p5.prototype.map(b,0,1,0,1/this.f),d=a.audiocontext.currentTime;this.phaseAmount=b,this.dNode||(this.dNode=a.audiocontext.createDelay(),this.oscillator.disconnect(),this.oscillator.connect(this.dNode),this.dNode.connect(this.output)),this.dNode.delayTime.setValueAtTime(c,d)};var e=function(a,b,c,d,e){var f=a.oscillator;for(var g in a.mathOps)a.mathOps[g]instanceof e&&(f.disconnect(),a.mathOps[g].dispose(),c=g,c<a.mathOps.length-2&&(d=a.mathOps[g+1]));return c==a.mathOps.length-1&&a.mathOps.push(d),g>0&&(f=a.mathOps[g-1]),f.disconnect(),f.connect(b),b.connect(d),a.mathOps[c]=b,a};p5.Oscillator.prototype.add=function(a){var c=new b(a),d=this.mathOps.length-1,f=this.output;return e(this,c,d,f,b)},p5.Oscillator.prototype.mult=function(a){var b=new c(a),d=this.mathOps.length-1,f=this.output;return e(this,b,d,f,c)},p5.Oscillator.prototype.scale=function(a,b,c,f){var g,h;4===arguments.length?(g=p5.prototype.map(c,a,b,0,1)-.5,h=p5.prototype.map(f,a,b,0,1)-.5):(g=arguments[0],h=arguments[1]);var i=new d(g,h),j=this.mathOps.length-1,k=this.output;return e(this,i,j,k,d)},p5.SinOsc=function(a){p5.Oscillator.call(this,a,"sine")},p5.SinOsc.prototype=Object.create(p5.Oscillator.prototype),p5.TriOsc=function(a){p5.Oscillator.call(this,a,"triangle")},p5.TriOsc.prototype=Object.create(p5.Oscillator.prototype),p5.SawOsc=function(a){p5.Oscillator.call(this,a,"sawtooth")},p5.SawOsc.prototype=Object.create(p5.Oscillator.prototype),p5.SqrOsc=function(a){p5.Oscillator.call(this,a,"square")},p5.SqrOsc.prototype=Object.create(p5.Oscillator.prototype)}(master,Tone_signal_Signal,Tone_signal_Add,Tone_signal_Multiply,Tone_signal_Scale);var Tone_core_Timeline;Tone_core_Timeline=function(a){"use strict";return a.Timeline=function(){var b=this.optionsObject(arguments,["memory"],a.Timeline.defaults);this._timeline=[],this._toRemove=[],this._iterating=!1,this.memory=b.memory},a.extend(a.Timeline),a.Timeline.defaults={memory:1/0},Object.defineProperty(a.Timeline.prototype,"length",{get:function(){return this._timeline.length}}),a.Timeline.prototype.addEvent=function(a){if(this.isUndef(a.time))throw new Error("events must have a time attribute");if(a.time=this.toSeconds(a.time),this._timeline.length){var b=this._search(a.time);this._timeline.splice(b+1,0,a)}else this._timeline.push(a);if(this.length>this.memory){var c=this.length-this.memory;this._timeline.splice(0,c)}return this},a.Timeline.prototype.removeEvent=function(a){if(this._iterating)this._toRemove.push(a);else{var b=this._timeline.indexOf(a);-1!==b&&this._timeline.splice(b,1)}return this},a.Timeline.prototype.getEvent=function(a){a=this.toSeconds(a);var b=this._search(a);return-1!==b?this._timeline[b]:null},a.Timeline.prototype.getEventAfter=function(a){a=this.toSeconds(a);var b=this._search(a);return b+1<this._timeline.length?this._timeline[b+1]:null},a.Timeline.prototype.getEventBefore=function(a){a=this.toSeconds(a);var b=this._search(a);return b-1>=0?this._timeline[b-1]:null},a.Timeline.prototype.cancel=function(a){if(this._timeline.length>1){a=this.toSeconds(a);var b=this._search(a);b>=0?this._timeline=this._timeline.slice(0,b):this._timeline=[]}else 1===this._timeline.length&&this._timeline[0].time>=a&&(this._timeline=[]);return this},a.Timeline.prototype.cancelBefore=function(a){if(this._timeline.length){a=this.toSeconds(a);var b=this._search(a);b>=0&&(this._timeline=this._timeline.slice(b+1))}return this},a.Timeline.prototype._search=function(a){for(var b=0,c=this._timeline.length,d=c;d>=b&&c>b;){var e=Math.floor(b+(d-b)/2),f=this._timeline[e];if(f.time===a){for(var g=e;g<this._timeline.length;g++){var h=this._timeline[g];h.time===a&&(e=g)}return e}f.time>a?d=e-1:f.time<a&&(b=e+1)}return b-1},a.Timeline.prototype._iterate=function(a,b,c){this._iterating=!0,b=this.defaultArg(b,0),c=this.defaultArg(c,this._timeline.length-1);for(var d=b;c>=d;d++)a(this._timeline[d]);if(this._iterating=!1,this._toRemove.length>0){for(var e=0;e<this._toRemove.length;e++){var f=this._timeline.indexOf(this._toRemove[e]);-1!==f&&this._timeline.splice(f,1)}this._toRemove=[]}},a.Timeline.prototype.forEach=function(a){return this._iterate(a),this},a.Timeline.prototype.forEachBefore=function(a,b){a=this.toSeconds(a);var c=this._search(a);return-1!==c&&this._iterate(b,0,c),this},a.Timeline.prototype.forEachAfter=function(a,b){a=this.toSeconds(a);var c=this._search(a);return this._iterate(b,c+1),this},a.Timeline.prototype.forEachFrom=function(a,b){a=this.toSeconds(a);for(var c=this._search(a);c>=0&&this._timeline[c].time>=a;)c--;return this._iterate(b,c+1),this},a.Timeline.prototype.forEachAtTime=function(a,b){a=this.toSeconds(a);var c=this._search(a);return-1!==c&&this._iterate(function(c){c.time===a&&b(c)},0,c),this},a.Timeline.prototype.dispose=function(){a.prototype.dispose.call(this),this._timeline=null,this._toRemove=null},a.Timeline}(Tone_core_Tone);var Tone_signal_TimelineSignal;Tone_signal_TimelineSignal=function(a){"use strict";return a.TimelineSignal=function(){var b=this.optionsObject(arguments,["value","units"],a.Signal.defaults);a.Signal.apply(this,b),b.param=this._param,a.Param.call(this,b),this._events=new a.Timeline(10),this._initial=this._fromUnits(this._param.value)},a.extend(a.TimelineSignal,a.Param),a.TimelineSignal.Type={Linear:"linear",Exponential:"exponential",Target:"target",Set:"set"},Object.defineProperty(a.TimelineSignal.prototype,"value",{get:function(){return this._toUnits(this._param.value)},set:function(a){var b=this._fromUnits(a);this._initial=b,this._param.value=b}}),a.TimelineSignal.prototype.setValueAtTime=function(b,c){return b=this._fromUnits(b),c=this.toSeconds(c),this._events.addEvent({type:a.TimelineSignal.Type.Set,value:b,time:c}),this._param.setValueAtTime(b,c),this},a.TimelineSignal.prototype.linearRampToValueAtTime=function(b,c){return b=this._fromUnits(b),
c=this.toSeconds(c),this._events.addEvent({type:a.TimelineSignal.Type.Linear,value:b,time:c}),this._param.linearRampToValueAtTime(b,c),this},a.TimelineSignal.prototype.exponentialRampToValueAtTime=function(b,c){return b=this._fromUnits(b),b=Math.max(this._minOutput,b),c=this.toSeconds(c),this._events.addEvent({type:a.TimelineSignal.Type.Exponential,value:b,time:c}),this._param.exponentialRampToValueAtTime(b,c),this},a.TimelineSignal.prototype.setTargetAtTime=function(b,c,d){return b=this._fromUnits(b),b=Math.max(this._minOutput,b),d=Math.max(this._minOutput,d),c=this.toSeconds(c),this._events.addEvent({type:a.TimelineSignal.Type.Target,value:b,time:c,constant:d}),this._param.setTargetAtTime(b,c,d),this},a.TimelineSignal.prototype.cancelScheduledValues=function(a){return this._events.cancel(a),this._param.cancelScheduledValues(this.toSeconds(a)),this},a.TimelineSignal.prototype.setRampPoint=function(b){b=this.toSeconds(b);var c=this.getValueAtTime(b),d=this._searchAfter(b);return d&&(this.cancelScheduledValues(b),d.type===a.TimelineSignal.Type.Linear?this.linearRampToValueAtTime(c,b):d.type===a.TimelineSignal.Type.Exponential&&this.exponentialRampToValueAtTime(c,b)),this.setValueAtTime(c,b),this},a.TimelineSignal.prototype.linearRampToValueBetween=function(a,b,c){return this.setRampPoint(b),this.linearRampToValueAtTime(a,c),this},a.TimelineSignal.prototype.exponentialRampToValueBetween=function(a,b,c){return this.setRampPoint(b),this.exponentialRampToValueAtTime(a,c),this},a.TimelineSignal.prototype._searchBefore=function(a){return this._events.getEvent(a)},a.TimelineSignal.prototype._searchAfter=function(a){return this._events.getEventAfter(a)},a.TimelineSignal.prototype.getValueAtTime=function(b){var c=this._searchAfter(b),d=this._searchBefore(b),e=this._initial;if(null===d)e=this._initial;else if(d.type===a.TimelineSignal.Type.Target){var f,g=this._events.getEventBefore(d.time);f=null===g?this._initial:g.value,e=this._exponentialApproach(d.time,f,d.value,d.constant,b)}else e=null===c?d.value:c.type===a.TimelineSignal.Type.Linear?this._linearInterpolate(d.time,d.value,c.time,c.value,b):c.type===a.TimelineSignal.Type.Exponential?this._exponentialInterpolate(d.time,d.value,c.time,c.value,b):d.value;return e},a.TimelineSignal.prototype.connect=a.SignalBase.prototype.connect,a.TimelineSignal.prototype._exponentialApproach=function(a,b,c,d,e){return c+(b-c)*Math.exp(-(e-a)/d)},a.TimelineSignal.prototype._linearInterpolate=function(a,b,c,d,e){return b+(d-b)*((e-a)/(c-a))},a.TimelineSignal.prototype._exponentialInterpolate=function(a,b,c,d,e){return b=Math.max(this._minOutput,b),b*Math.pow(d/b,(e-a)/(c-a))},a.TimelineSignal.prototype.dispose=function(){a.Signal.prototype.dispose.call(this),a.Param.prototype.dispose.call(this),this._events.dispose(),this._events=null},a.TimelineSignal}(Tone_core_Tone,Tone_signal_Signal);var env;env=function(){"use strict";var a=master,b=Tone_signal_Add,c=Tone_signal_Multiply,d=Tone_signal_Scale,e=Tone_signal_TimelineSignal,f=Tone_core_Tone;f.setContext(a.audiocontext),p5.Env=function(b,c,d,f,g,h){a.audiocontext.currentTime,this.aTime=b||.1,this.aLevel=c||1,this.dTime=d||.5,this.dLevel=f||0,this.rTime=g||0,this.rLevel=h||0,this._rampHighPercentage=.98,this._rampLowPercentage=.02,this.output=a.audiocontext.createGain(),this.control=new e,this._init(),this.control.connect(this.output),this.connection=null,this.mathOps=[this.control],this.isExponential=!1,this.sourceToClear=null,this.wasTriggered=!1,a.soundArray.push(this)},p5.Env.prototype._init=function(){var b=a.audiocontext.currentTime,c=b;this.control.setTargetAtTime(1e-5,c,.001),this._setRampAD(this.aTime,this.dTime)},p5.Env.prototype.set=function(a,b,c,d,e,f){this.aTime=a,this.aLevel=b,this.dTime=c||0,this.dLevel=d||0,this.rTime=e||0,this.rLevel=f||0,this._setRampAD(a,c)},p5.Env.prototype.setADSR=function(a,b,c,d){this.aTime=a,this.dTime=b||0,this.sPercent=c||0,this.dLevel="undefined"!=typeof c?c*(this.aLevel-this.rLevel)+this.rLevel:0,this.rTime=d||0,this._setRampAD(a,b)},p5.Env.prototype.setRange=function(a,b){this.aLevel=a||1,this.rLevel=b||0},p5.Env.prototype._setRampAD=function(a,b){this._rampAttackTime=this.checkExpInput(a),this._rampDecayTime=this.checkExpInput(b);var c=1;c=Math.log(1/this.checkExpInput(1-this._rampHighPercentage)),this._rampAttackTC=a/this.checkExpInput(c),c=Math.log(1/this._rampLowPercentage),this._rampDecayTC=b/this.checkExpInput(c)},p5.Env.prototype.setRampPercentages=function(a,b){this._rampHighPercentage=this.checkExpInput(a),this._rampLowPercentage=this.checkExpInput(b);var c=1;c=Math.log(1/this.checkExpInput(1-this._rampHighPercentage)),this._rampAttackTC=this._rampAttackTime/this.checkExpInput(c),c=Math.log(1/this._rampLowPercentage),this._rampDecayTC=this._rampDecayTime/this.checkExpInput(c)},p5.Env.prototype.setInput=function(a){for(var b=0;b<arguments.length;b++)this.connect(arguments[b])},p5.Env.prototype.setExp=function(a){this.isExponential=a},p5.Env.prototype.checkExpInput=function(a){return 0>=a&&(a=1e-8),a},p5.Env.prototype.play=function(b,c,d){var e=(a.audiocontext.currentTime,c||0),d=d||0;b&&this.connection!==b&&this.connect(b),this.triggerAttack(b,e),this.triggerRelease(b,e+this.aTime+this.dTime+d)},p5.Env.prototype.triggerAttack=function(b,c){var d=a.audiocontext.currentTime,e=c||0,f=d+e;this.lastAttack=f,this.wasTriggered=!0,b&&this.connection!==b&&this.connect(b);var g=this.control.getValueAtTime(f);this.control.cancelScheduledValues(f),1==this.isExponential?this.control.exponentialRampToValueAtTime(this.checkExpInput(g),f):this.control.linearRampToValueAtTime(g,f),f+=this.aTime,1==this.isExponential?(this.control.exponentialRampToValueAtTime(this.checkExpInput(this.aLevel),f),g=this.checkExpInput(this.control.getValueAtTime(f)),this.control.cancelScheduledValues(f),this.control.exponentialRampToValueAtTime(g,f)):(this.control.linearRampToValueAtTime(this.aLevel,f),g=this.control.getValueAtTime(f),this.control.cancelScheduledValues(f),this.control.linearRampToValueAtTime(g,f)),f+=this.dTime,1==this.isExponential?(this.control.exponentialRampToValueAtTime(this.checkExpInput(this.dLevel),f),g=this.checkExpInput(this.control.getValueAtTime(f)),this.control.cancelScheduledValues(f),this.control.exponentialRampToValueAtTime(g,f)):(this.control.linearRampToValueAtTime(this.dLevel,f),g=this.control.getValueAtTime(f),this.control.cancelScheduledValues(f),this.control.linearRampToValueAtTime(g,f))},p5.Env.prototype.triggerRelease=function(b,c){if(this.wasTriggered){var d=a.audiocontext.currentTime,e=c||0,f=d+e;b&&this.connection!==b&&this.connect(b);var g=this.control.getValueAtTime(f);this.control.cancelScheduledValues(f),1==this.isExponential?this.control.exponentialRampToValueAtTime(this.checkExpInput(g),f):this.control.linearRampToValueAtTime(g,f),f+=this.rTime,1==this.isExponential?(this.control.exponentialRampToValueAtTime(this.checkExpInput(this.rLevel),f),g=this.checkExpInput(this.control.getValueAtTime(f)),this.control.cancelScheduledValues(f),this.control.exponentialRampToValueAtTime(g,f)):(this.control.linearRampToValueAtTime(this.rLevel,f),g=this.control.getValueAtTime(f),this.control.cancelScheduledValues(f),this.control.linearRampToValueAtTime(g,f)),this.wasTriggered=!1}},p5.Env.prototype.ramp=function(b,c,d,e){var f=a.audiocontext.currentTime,g=c||0,h=f+g,i=this.checkExpInput(d),j="undefined"!=typeof e?this.checkExpInput(e):void 0;b&&this.connection!==b&&this.connect(b);var k=this.checkExpInput(this.control.getValueAtTime(h));this.control.cancelScheduledValues(h),i>k?(this.control.setTargetAtTime(i,h,this._rampAttackTC),h+=this._rampAttackTime):k>i&&(this.control.setTargetAtTime(i,h,this._rampDecayTC),h+=this._rampDecayTime),void 0!==j&&(j>i?this.control.setTargetAtTime(j,h,this._rampAttackTC):i>j&&this.control.setTargetAtTime(j,h,this._rampDecayTC))},p5.Env.prototype.connect=function(b){this.connection=b,(b instanceof p5.Oscillator||b instanceof p5.SoundFile||b instanceof p5.AudioIn||b instanceof p5.Reverb||b instanceof p5.Noise||b instanceof p5.Filter||b instanceof p5.Delay)&&(b=b.output.gain),b instanceof AudioParam&&b.setValueAtTime(0,a.audiocontext.currentTime),b instanceof p5.Signal&&b.setValue(0),this.output.connect(b)},p5.Env.prototype.disconnect=function(a){this.output.disconnect()},p5.Env.prototype.add=function(a){var c=new b(a),d=this.mathOps.length,e=this.output;return p5.prototype._mathChain(this,c,d,e,b)},p5.Env.prototype.mult=function(a){var b=new c(a),d=this.mathOps.length,e=this.output;return p5.prototype._mathChain(this,b,d,e,c)},p5.Env.prototype.scale=function(a,b,c,e){var f=new d(a,b,c,e),g=this.mathOps.length,h=this.output;return p5.prototype._mathChain(this,f,g,h,d)},p5.Env.prototype.dispose=function(){var b=a.soundArray.indexOf(this);a.soundArray.splice(b,1),a.audiocontext.currentTime,this.disconnect();try{this.control.dispose(),this.control=null}catch(a){}for(var c=1;c<this.mathOps.length;c++)mathOps[c].dispose()}}(master,Tone_signal_Add,Tone_signal_Multiply,Tone_signal_Scale,Tone_signal_TimelineSignal,Tone_core_Tone);var pulse;pulse=function(){"use strict";function a(){for(var a=b.audiocontext,c=a.createBuffer(1,2048,a.sampleRate),d=c.getChannelData(0),e=0;2048>e;e++)d[e]=1;var f=a.createBufferSource();return f.buffer=c,f.loop=!0,f}var b=master;p5.Pulse=function(c,d){p5.Oscillator.call(this,c,"sawtooth"),this.w=d||0,this.osc2=new p5.SawOsc(c),this.dNode=b.audiocontext.createDelay(),this.dcOffset=a(),this.dcGain=b.audiocontext.createGain(),this.dcOffset.connect(this.dcGain),this.dcGain.connect(this.output),this.f=c||440;var e=this.w/this.oscillator.frequency.value;this.dNode.delayTime.value=e,this.dcGain.gain.value=1.7*(.5-this.w),this.osc2.disconnect(),this.osc2.panner.disconnect(),this.osc2.amp(-1),this.osc2.output.connect(this.dNode),this.dNode.connect(this.output),this.output.gain.value=1,this.output.connect(this.panner)},p5.Pulse.prototype=Object.create(p5.Oscillator.prototype),p5.Pulse.prototype.width=function(a){if("number"==typeof a){if(1>=a&&a>=0){this.w=a;var b=this.w/this.oscillator.frequency.value;this.dNode.delayTime.value=b}this.dcGain.gain.value=1.7*(.5-this.w)}else{a.connect(this.dNode.delayTime);var c=new p5.SignalAdd(-.5);c.setInput(a),c=c.mult(-1),c=c.mult(1.7),c.connect(this.dcGain.gain)}},p5.Pulse.prototype.start=function(c,d){var e=b.audiocontext.currentTime,f=d||0;if(!this.started){var g=c||this.f,h=this.oscillator.type;this.oscillator=b.audiocontext.createOscillator(),this.oscillator.frequency.setValueAtTime(g,e),this.oscillator.type=h,this.oscillator.connect(this.output),this.oscillator.start(f+e),this.osc2.oscillator=b.audiocontext.createOscillator(),this.osc2.oscillator.frequency.setValueAtTime(g,f+e),this.osc2.oscillator.type=h,this.osc2.oscillator.connect(this.osc2.output),this.osc2.start(f+e),this.freqNode=[this.oscillator.frequency,this.osc2.oscillator.frequency],this.dcOffset=a(),this.dcOffset.connect(this.dcGain),this.dcOffset.start(f+e),void 0!==this.mods&&void 0!==this.mods.frequency&&(this.mods.frequency.connect(this.freqNode[0]),this.mods.frequency.connect(this.freqNode[1])),this.started=!0,this.osc2.started=!0}},p5.Pulse.prototype.stop=function(a){if(this.started){var c=a||0,d=b.audiocontext.currentTime;this.oscillator.stop(c+d),this.osc2.oscillator.stop(c+d),this.dcOffset.stop(c+d),this.started=!1,this.osc2.started=!1}},p5.Pulse.prototype.freq=function(a,c,d){if("number"==typeof a){this.f=a;var e=b.audiocontext.currentTime,c=c||0,d=d||0,f=this.oscillator.frequency.value;this.oscillator.frequency.cancelScheduledValues(e),this.oscillator.frequency.setValueAtTime(f,e+d),this.oscillator.frequency.exponentialRampToValueAtTime(a,d+c+e),this.osc2.oscillator.frequency.cancelScheduledValues(e),this.osc2.oscillator.frequency.setValueAtTime(f,e+d),this.osc2.oscillator.frequency.exponentialRampToValueAtTime(a,d+c+e),this.freqMod&&(this.freqMod.output.disconnect(),this.freqMod=null)}else a.output&&(a.output.disconnect(),a.output.connect(this.oscillator.frequency),a.output.connect(this.osc2.oscillator.frequency),this.freqMod=a)}}(master,oscillator);var noise;noise=function(){"use strict";var a=master;p5.Noise=function(a){var e;p5.Oscillator.call(this),delete this.f,delete this.freq,delete this.oscillator,e="brown"===a?d:"pink"===a?c:b,this.buffer=e},p5.Noise.prototype=Object.create(p5.Oscillator.prototype);var b=function(){for(var b=2*a.audiocontext.sampleRate,c=a.audiocontext.createBuffer(1,b,a.audiocontext.sampleRate),d=c.getChannelData(0),e=0;b>e;e++)d[e]=2*Math.random()-1;return c.type="white",c}(),c=function(){var b,c,d,e,f,g,h,i=2*a.audiocontext.sampleRate,j=a.audiocontext.createBuffer(1,i,a.audiocontext.sampleRate),k=j.getChannelData(0);b=c=d=e=f=g=h=0;for(var l=0;i>l;l++){var m=2*Math.random()-1;b=.99886*b+.0555179*m,c=.99332*c+.0750759*m,d=.969*d+.153852*m,e=.8665*e+.3104856*m,f=.55*f+.5329522*m,g=-.7616*g-.016898*m,k[l]=b+c+d+e+f+g+h+.5362*m,k[l]*=.11,h=.115926*m}return j.type="pink",j}(),d=function(){for(var b=2*a.audiocontext.sampleRate,c=a.audiocontext.createBuffer(1,b,a.audiocontext.sampleRate),d=c.getChannelData(0),e=0,f=0;b>f;f++){var g=2*Math.random()-1;d[f]=(e+.02*g)/1.02,e=d[f],d[f]*=3.5}return c.type="brown",c}();p5.Noise.prototype.setType=function(e){switch(e){case"white":this.buffer=b;break;case"pink":this.buffer=c;break;case"brown":this.buffer=d;break;default:this.buffer=b}if(this.started){var f=a.audiocontext.currentTime;this.stop(f),this.start(f+.01)}},p5.Noise.prototype.getType=function(){return this.buffer.type},p5.Noise.prototype.start=function(){this.started&&this.stop(),this.noise=a.audiocontext.createBufferSource(),this.noise.buffer=this.buffer,this.noise.loop=!0,this.noise.connect(this.output);var b=a.audiocontext.currentTime;this.noise.start(b),this.started=!0},p5.Noise.prototype.stop=function(){var b=a.audiocontext.currentTime;this.noise&&(this.noise.stop(b),this.started=!1)},p5.Noise.prototype.dispose=function(){var b=a.audiocontext.currentTime,c=a.soundArray.indexOf(this);a.soundArray.splice(c,1),this.noise&&(this.noise.disconnect(),this.stop(b)),this.output&&this.output.disconnect(),this.panner&&this.panner.disconnect(),this.output=null,this.panner=null,this.buffer=null,this.noise=null}}(master);var audioin;audioin=function(){"use strict";var a=master;p5.AudioIn=function(b){this.input=a.audiocontext.createGain(),this.output=a.audiocontext.createGain(),this.stream=null,this.mediaStream=null,this.currentSource=0,this.enabled=!1,this.amplitude=new p5.Amplitude,this.output.connect(this.amplitude.input),"undefined"==typeof window.MediaStreamTrack?b?b():console.log("This browser does not support AudioIn"):"function"==typeof window.MediaStreamTrack.getSources&&window.MediaStreamTrack.getSources(this._gotSources),a.soundArray.push(this)},p5.AudioIn.prototype.start=function(b,c){var d=this;if(a.inputSources[d.currentSource]){var e=a.inputSources[d.currentSource].id,f={audio:{optional:[{sourceId:e}]}};window.navigator.getUserMedia(f,this._onStream=function(c){d.stream=c,d.enabled=!0,d.mediaStream=a.audiocontext.createMediaStreamSource(c),d.mediaStream.connect(d.output),b&&b(),d.amplitude.setInput(d.output)},this._onStreamError=function(a){c?c(a):console.error(a)})}else window.navigator.getUserMedia({audio:!0},this._onStream=function(c){d.stream=c,d.enabled=!0,d.mediaStream=a.audiocontext.createMediaStreamSource(c),d.mediaStream.connect(d.output),d.amplitude.setInput(d.output),b&&b()},this._onStreamError=function(a){c?c(a):console.error(a)})},p5.AudioIn.prototype.stop=function(){this.stream&&this.stream.getTracks()[0].stop()},p5.AudioIn.prototype.connect=function(b){b?b.hasOwnProperty("input")?this.output.connect(b.input):b.hasOwnProperty("analyser")?this.output.connect(b.analyser):this.output.connect(b):this.output.connect(a.input)},p5.AudioIn.prototype.disconnect=function(){this.output.disconnect(),this.output.connect(this.amplitude.input)},p5.AudioIn.prototype.getLevel=function(a){return a&&(this.amplitude.smoothing=a),this.amplitude.getLevel()},p5.AudioIn.prototype._gotSources=function(a){for(var b=0;b<a.length;b++){var c=a[b];if("audio"===c.kind)return c}},p5.AudioIn.prototype.amp=function(b,c){if(c){var d=c||0,e=this.output.gain.value;this.output.gain.cancelScheduledValues(a.audiocontext.currentTime),this.output.gain.setValueAtTime(e,a.audiocontext.currentTime),this.output.gain.linearRampToValueAtTime(b,d+a.audiocontext.currentTime)}else this.output.gain.cancelScheduledValues(a.audiocontext.currentTime),this.output.gain.setValueAtTime(b,a.audiocontext.currentTime)},p5.AudioIn.prototype.listSources=function(){return console.log("listSources is deprecated - please use AudioIn.getSources"),console.log("input sources: "),a.inputSources.length>0?a.inputSources:"This browser does not support MediaStreamTrack.getSources()"},p5.AudioIn.prototype.getSources=function(b){"function"==typeof window.MediaStreamTrack.getSources?window.MediaStreamTrack.getSources(function(c){for(var d=0,e=c.length;e>d;d++){var f=c[d];"audio"===f.kind&&a.inputSources.push(f)}b(a.inputSources)}):console.log("This browser does not support MediaStreamTrack.getSources()")},p5.AudioIn.prototype.setSource=function(b){var c=this;a.inputSources.length>0&&b<a.inputSources.length?(c.currentSource=b,console.log("set source to "+a.inputSources[c.currentSource].id)):console.log("unable to set input source")},p5.AudioIn.prototype.dispose=function(){var b=a.soundArray.indexOf(this);a.soundArray.splice(b,1),this.stop(),this.output&&this.output.disconnect(),this.amplitude&&this.amplitude.disconnect(),this.amplitude=null,this.output=null}}(master,errorHandler);var filter;filter=function(){"use strict";var a=master;p5.Filter=function(b){this.ac=a.audiocontext,this.input=this.ac.createGain(),this.output=this.ac.createGain(),this.biquad=this.ac.createBiquadFilter(),this.input.connect(this.biquad),this.biquad.connect(this.output),this.connect(),b&&this.setType(b),a.soundArray.push(this)},p5.Filter.prototype.process=function(a,b,c){a.connect(this.input),this.set(b,c)},p5.Filter.prototype.set=function(a,b,c){a&&this.freq(a,c),b&&this.res(b,c)},p5.Filter.prototype.freq=function(a,b){var c=this,d=b||0;return 0>=a&&(a=1),"number"==typeof a?(c.biquad.frequency.value=a,c.biquad.frequency.cancelScheduledValues(this.ac.currentTime+.01+d),c.biquad.frequency.exponentialRampToValueAtTime(a,this.ac.currentTime+.02+d)):a&&a.connect(this.biquad.frequency),c.biquad.frequency.value},p5.Filter.prototype.res=function(a,b){var c=this,d=b||0;return"number"==typeof a?(c.biquad.Q.value=a,c.biquad.Q.cancelScheduledValues(c.ac.currentTime+.01+d),c.biquad.Q.linearRampToValueAtTime(a,c.ac.currentTime+.02+d)):a&&freq.connect(this.biquad.Q),c.biquad.Q.value},p5.Filter.prototype.setType=function(a){this.biquad.type=a},p5.Filter.prototype.amp=function(b,c,d){var c=c||0,d=d||0,e=a.audiocontext.currentTime,f=this.output.gain.value;this.output.gain.cancelScheduledValues(e),this.output.gain.linearRampToValueAtTime(f,e+d+.001),this.output.gain.linearRampToValueAtTime(b,e+d+c+.001)},p5.Filter.prototype.connect=function(a){var b=a||p5.soundOut.input;this.output.connect(b)},p5.Filter.prototype.disconnect=function(){this.output.disconnect()},p5.Filter.prototype.dispose=function(){var b=a.soundArray.indexOf(this);a.soundArray.splice(b,1),this.input.disconnect(),this.input=void 0,this.output.disconnect(),this.output=void 0,this.biquad.disconnect(),this.biquad=void 0},p5.LowPass=function(){p5.Filter.call(this,"lowpass")},p5.LowPass.prototype=Object.create(p5.Filter.prototype),p5.HighPass=function(){p5.Filter.call(this,"highpass")},p5.HighPass.prototype=Object.create(p5.Filter.prototype),p5.BandPass=function(){p5.Filter.call(this,"bandpass")},p5.BandPass.prototype=Object.create(p5.Filter.prototype)}(master);var delay;delay=function(){"use strict";var a=master;p5.Delay=function(){this.ac=a.audiocontext,this.input=this.ac.createGain(),this.output=this.ac.createGain(),this._split=this.ac.createChannelSplitter(2),this._merge=this.ac.createChannelMerger(2),this._leftGain=this.ac.createGain(),this._rightGain=this.ac.createGain(),this.leftDelay=this.ac.createDelay(),this.rightDelay=this.ac.createDelay(),this._leftFilter=new p5.Filter,this._rightFilter=new p5.Filter,this._leftFilter.disconnect(),this._rightFilter.disconnect(),this._leftFilter.biquad.frequency.setValueAtTime(1200,this.ac.currentTime),this._rightFilter.biquad.frequency.setValueAtTime(1200,this.ac.currentTime),this._leftFilter.biquad.Q.setValueAtTime(.3,this.ac.currentTime),this._rightFilter.biquad.Q.setValueAtTime(.3,this.ac.currentTime),this.input.connect(this._split),this.leftDelay.connect(this._leftGain),this.rightDelay.connect(this._rightGain),this._leftGain.connect(this._leftFilter.input),this._rightGain.connect(this._rightFilter.input),this._merge.connect(this.output),this.output.connect(p5.soundOut.input),this._leftFilter.biquad.gain.setValueAtTime(1,this.ac.currentTime),this._rightFilter.biquad.gain.setValueAtTime(1,this.ac.currentTime),this.setType(0),this._maxDelay=this.leftDelay.delayTime.maxValue,a.soundArray.push(this)},p5.Delay.prototype.process=function(a,b,c,d){var e=c||0,f=b||0;if(e>=1)throw new Error("Feedback value will force a positive feedback loop.");if(f>=this._maxDelay)throw new Error("Delay Time exceeds maximum delay time of "+this._maxDelay+" second.");a.connect(this.input),this.leftDelay.delayTime.setValueAtTime(f,this.ac.currentTime),this.rightDelay.delayTime.setValueAtTime(f,this.ac.currentTime),this._leftGain.gain.setValueAtTime(e,this.ac.currentTime),this._rightGain.gain.setValueAtTime(e,this.ac.currentTime),d&&(this._leftFilter.freq(d),this._rightFilter.freq(d))},p5.Delay.prototype.delayTime=function(a){"number"!=typeof a?(a.connect(this.leftDelay.delayTime),a.connect(this.rightDelay.delayTime)):(this.leftDelay.delayTime.cancelScheduledValues(this.ac.currentTime),this.rightDelay.delayTime.cancelScheduledValues(this.ac.currentTime),this.leftDelay.delayTime.linearRampToValueAtTime(a,this.ac.currentTime),this.rightDelay.delayTime.linearRampToValueAtTime(a,this.ac.currentTime))},p5.Delay.prototype.feedback=function(a){if("number"!=typeof a)a.connect(this._leftGain.gain),a.connect(this._rightGain.gain);else{if(a>=1)throw new Error("Feedback value will force a positive feedback loop.");this._leftGain.gain.exponentialRampToValueAtTime(a,this.ac.currentTime),this._rightGain.gain.exponentialRampToValueAtTime(a,this.ac.currentTime)}},p5.Delay.prototype.filter=function(a,b){this._leftFilter.set(a,b),this._rightFilter.set(a,b)},p5.Delay.prototype.setType=function(a){switch(1===a&&(a="pingPong"),this._split.disconnect(),this._leftFilter.disconnect(),this._rightFilter.disconnect(),this._split.connect(this.leftDelay,0),this._split.connect(this.rightDelay,1),a){case"pingPong":this._rightFilter.setType(this._leftFilter.biquad.type),this._leftFilter.output.connect(this._merge,0,0),this._rightFilter.output.connect(this._merge,0,1),this._leftFilter.output.connect(this.rightDelay),this._rightFilter.output.connect(this.leftDelay);break;default:this._leftFilter.output.connect(this._merge,0,0),this._leftFilter.output.connect(this._merge,0,1),this._leftFilter.output.connect(this.leftDelay),this._leftFilter.output.connect(this.rightDelay)}},p5.Delay.prototype.amp=function(b,c,d){var c=c||0,d=d||0,e=a.audiocontext.currentTime,f=this.output.gain.value;this.output.gain.cancelScheduledValues(e),this.output.gain.linearRampToValueAtTime(f,e+d+.001),this.output.gain.linearRampToValueAtTime(b,e+d+c+.001)},p5.Delay.prototype.connect=function(a){var b=a||p5.soundOut.input;this.output.connect(b)},p5.Delay.prototype.disconnect=function(){this.output.disconnect()},p5.Delay.prototype.dispose=function(){var b=a.soundArray.indexOf(this);a.soundArray.splice(b,1),this.input.disconnect(),this.output.disconnect(),this._split.disconnect(),this._leftFilter.disconnect(),this._rightFilter.disconnect(),this._merge.disconnect(),this._leftGain.disconnect(),this._rightGain.disconnect(),this.leftDelay.disconnect(),this.rightDelay.disconnect(),this.input=void 0,this.output=void 0,this._split=void 0,this._leftFilter=void 0,this._rightFilter=void 0,this._merge=void 0,this._leftGain=void 0,this._rightGain=void 0,this.leftDelay=void 0,this.rightDelay=void 0}}(master,filter);var reverb;reverb=function(){"use strict";var a=master,b=errorHandler;p5.Reverb=function(){this.ac=a.audiocontext,this.convolverNode=this.ac.createConvolver(),this.input=this.ac.createGain(),this.output=this.ac.createGain(),this.input.gain.value=.5,this.input.connect(this.convolverNode),this.convolverNode.connect(this.output),this._seconds=3,this._decay=2,this._reverse=!1,this._buildImpulse(),this.connect(),a.soundArray.push(this)},p5.Reverb.prototype.process=function(a,b,c,d){a.connect(this.input);var e=!1;b&&(this._seconds=b,e=!0),c&&(this._decay=c),d&&(this._reverse=d),e&&this._buildImpulse()},p5.Reverb.prototype.set=function(a,b,c){var d=!1;a&&(this._seconds=a,d=!0),b&&(this._decay=b),c&&(this._reverse=c),d&&this._buildImpulse()},p5.Reverb.prototype.amp=function(b,c,d){var c=c||0,d=d||0,e=a.audiocontext.currentTime,f=this.output.gain.value;this.output.gain.cancelScheduledValues(e),this.output.gain.linearRampToValueAtTime(f,e+d+.001),this.output.gain.linearRampToValueAtTime(b,e+d+c+.001)},p5.Reverb.prototype.connect=function(a){var b=a||p5.soundOut.input;this.output.connect(b.input?b.input:b)},p5.Reverb.prototype.disconnect=function(){this.output.disconnect()},p5.Reverb.prototype._buildImpulse=function(){var a,b,c=this.ac.sampleRate,d=c*this._seconds,e=this._decay,f=this.ac.createBuffer(2,d,c),g=f.getChannelData(0),h=f.getChannelData(1);for(b=0;d>b;b++)a=this.reverse?d-b:b,g[b]=(2*Math.random()-1)*Math.pow(1-a/d,e),h[b]=(2*Math.random()-1)*Math.pow(1-a/d,e);this.convolverNode.buffer=f},p5.Reverb.prototype.dispose=function(){var b=a.soundArray.indexOf(this);a.soundArray.splice(b,1),this.convolverNode&&(this.convolverNode.buffer=null,this.convolverNode=null),"undefined"!=typeof this.output&&(this.output.disconnect(),this.output=null),"undefined"!=typeof this.panner&&(this.panner.disconnect(),this.panner=null)},p5.Convolver=function(b,c,d){this.ac=a.audiocontext,this.convolverNode=this.ac.createConvolver(),this.input=this.ac.createGain(),this.output=this.ac.createGain(),this.input.gain.value=.5,this.input.connect(this.convolverNode),this.convolverNode.connect(this.output),b?(this.impulses=[],this._loadBuffer(b,c,d)):(this._seconds=3,this._decay=2,this._reverse=!1,this._buildImpulse()),this.connect(),a.soundArray.push(this)},p5.Convolver.prototype=Object.create(p5.Reverb.prototype),p5.prototype.registerPreloadMethod("createConvolver",p5.prototype),p5.prototype.createConvolver=function(a,b,c){window.location.origin.indexOf("file://")>-1&&"undefined"===window.cordova&&alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS");var d=new p5.Convolver(a,b,c);return d.impulses=[],d},p5.Convolver.prototype._loadBuffer=function(a,c,d){var a=p5.prototype._checkFileFormats(a),e=this,f=(new Error).stack,g=p5.prototype.getAudioContext(),h=new XMLHttpRequest;h.open("GET",a,!0),h.responseType="arraybuffer",h.onload=function(){if(200==h.status)g.decodeAudioData(h.response,function(b){var d={},f=a.split("/");d.name=f[f.length-1],d.audioBuffer=b,e.impulses.push(d),e.convolverNode.buffer=d.audioBuffer,c&&c(d)},function(a){var c=new b("decodeAudioData",f,e.url),g="AudioContext error at decodeAudioData for "+e.url;d?(c.msg=g,d(c)):console.error(g+"\n The error stack trace includes: \n"+c.stack)});else{var i=new b("loadConvolver",f,e.url),j="Unable to load "+e.url+". The request status was: "+h.status+" ("+h.statusText+")";d?(i.message=j,d(i)):console.error(j+"\n The error stack trace includes: \n"+i.stack)}},h.onerror=function(a){var c=new b("loadConvolver",f,e.url),g="There was no response from the server at "+e.url+". Check the url and internet connectivity.";d?(c.message=g,d(c)):console.error(g+"\n The error stack trace includes: \n"+c.stack)},h.send()},p5.Convolver.prototype.set=null,p5.Convolver.prototype.process=function(a){a.connect(this.input)},p5.Convolver.prototype.impulses=[],p5.Convolver.prototype.addImpulse=function(a,b,c){window.location.origin.indexOf("file://")>-1&&"undefined"===window.cordova&&alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS"),this._loadBuffer(a,b,c)},p5.Convolver.prototype.resetImpulse=function(a,b,c){window.location.origin.indexOf("file://")>-1&&"undefined"===window.cordova&&alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS"),this.impulses=[],this._loadBuffer(a,b,c)},p5.Convolver.prototype.toggleImpulse=function(a){if("number"==typeof a&&a<this.impulses.length&&(this.convolverNode.buffer=this.impulses[a].audioBuffer),"string"==typeof a)for(var b=0;b<this.impulses.length;b++)if(this.impulses[b].name===a){this.convolverNode.buffer=this.impulses[b].audioBuffer;break}},p5.Convolver.prototype.dispose=function(){for(var a in this.impulses)this.impulses[a]=null;this.convolverNode.disconnect(),this.concolverNode=null,"undefined"!=typeof this.output&&(this.output.disconnect(),this.output=null),"undefined"!=typeof this.panner&&(this.panner.disconnect(),this.panner=null)}}(master,errorHandler,sndcore);var Tone_core_TimelineState;Tone_core_TimelineState=function(a){"use strict";return a.TimelineState=function(b){a.Timeline.call(this),this._initial=b},a.extend(a.TimelineState,a.Timeline),a.TimelineState.prototype.getStateAtTime=function(a){var b=this.getEvent(a);return null!==b?b.state:this._initial},a.TimelineState.prototype.setStateAtTime=function(a,b){this.addEvent({state:a,time:this.toSeconds(b)})},a.TimelineState}(Tone_core_Tone,Tone_core_Timeline);var Tone_core_Clock;Tone_core_Clock=function(a){"use strict";return a.Clock=function(){var b=this.optionsObject(arguments,["callback","frequency"],a.Clock.defaults);this.callback=b.callback,this._lookAhead="auto",this._computedLookAhead=1/60,this._threshold=.5,this._nextTick=-1,this._lastUpdate=0,this._loopID=-1,this.frequency=new a.TimelineSignal(b.frequency,a.Type.Frequency),this.ticks=0,this._state=new a.TimelineState(a.State.Stopped),this._boundLoop=this._loop.bind(this),this._readOnly("frequency"),this._loop()},a.extend(a.Clock),a.Clock.defaults={callback:a.noOp,frequency:1,lookAhead:"auto"},Object.defineProperty(a.Clock.prototype,"state",{get:function(){return this._state.getStateAtTime(this.now())}}),Object.defineProperty(a.Clock.prototype,"lookAhead",{get:function(){return this._lookAhead},set:function(a){"auto"===a?this._lookAhead="auto":this._lookAhead=this.toSeconds(a)}}),a.Clock.prototype.start=function(b,c){return b=this.toSeconds(b),this._state.getStateAtTime(b)!==a.State.Started&&this._state.addEvent({state:a.State.Started,time:b,offset:c}),this},a.Clock.prototype.stop=function(b){return b=this.toSeconds(b),this._state.getStateAtTime(b)!==a.State.Stopped&&this._state.setStateAtTime(a.State.Stopped,b),this},a.Clock.prototype.pause=function(b){return b=this.toSeconds(b),this._state.getStateAtTime(b)===a.State.Started&&this._state.setStateAtTime(a.State.Paused,b),this},a.Clock.prototype._loop=function(b){if(this._loopID=requestAnimationFrame(this._boundLoop),"auto"===this._lookAhead){if(!this.isUndef(b)){var c=(b-this._lastUpdate)/1e3;this._lastUpdate=b,c<this._threshold&&(this._computedLookAhead=(9*this._computedLookAhead+c)/10)}}else this._computedLookAhead=this._lookAhead;var d=this.now(),e=2*this._computedLookAhead,f=this._state.getEvent(d+e),g=a.State.Stopped;if(f&&(g=f.state,-1===this._nextTick&&g===a.State.Started&&(this._nextTick=f.time,this.isUndef(f.offset)||(this.ticks=f.offset))),g===a.State.Started)for(;d+e>this._nextTick;){d>this._nextTick+this._threshold&&(this._nextTick=d);var h=this._nextTick;this._nextTick+=1/this.frequency.getValueAtTime(this._nextTick),this.callback(h),this.ticks++}else g===a.State.Stopped&&(this._nextTick=-1,this.ticks=0)},a.Clock.prototype.getStateAtTime=function(a){return this._state.getStateAtTime(a)},a.Clock.prototype.dispose=function(){
cancelAnimationFrame(this._loopID),a.TimelineState.prototype.dispose.call(this),this._writable("frequency"),this.frequency.dispose(),this.frequency=null,this._boundLoop=a.noOp,this._nextTick=1/0,this.callback=null,this._state.dispose(),this._state=null},a.Clock}(Tone_core_Tone,Tone_signal_TimelineSignal);var metro;metro=function(){"use strict";var a=master,b=Tone_core_Clock;a.audiocontext,p5.Metro=function(){this.clock=new b({callback:this.ontick.bind(this)}),this.syncedParts=[],this.bpm=120,this._init(),this.tickCallback=function(){}};var c=0,d=0;p5.Metro.prototype.ontick=function(b){var e=b-c,f=b-a.audiocontext.currentTime;if(!(-.02>=e-d)){c=b;for(var g in this.syncedParts){var h=this.syncedParts[g];if(!h.isPlaying)return;h.incrementStep(f);for(var i in h.phrases){var j=h.phrases[i],k=j.sequence,l=this.metroTicks%k.length;0!==k[l]&&(this.metroTicks<k.length||!j.looping)&&j.callback(f,k[l])}}this.metroTicks+=1,this.tickCallback(f)}},p5.Metro.prototype.setBPM=function(b,c){var e=60/(b*this.tatums),f=a.audiocontext.currentTime;d=e;var c=c||0;this.clock.frequency.setValueAtTime(this.clock.frequency.value,f),this.clock.frequency.linearRampToValueAtTime(b,f+c),this.bpm=b},p5.Metro.prototype.getBPM=function(a){return this.clock.getRate()/this.tatums*60},p5.Metro.prototype._init=function(){this.metroTicks=0},p5.Metro.prototype.resetSync=function(a){this.syncedParts=[a]},p5.Metro.prototype.pushSync=function(a){this.syncedParts.push(a)},p5.Metro.prototype.start=function(b){var c=b||0,d=a.audiocontext.currentTime;this.clock.start(d+c),this.setBPM(this.bpm)},p5.Metro.prototype.stop=function(b){var c=b||0,d=a.audiocontext.currentTime;this.clock._oscillator&&this.clock.stop(d+c)},p5.Metro.prototype.beatLength=function(a){this.tatums=1/a/4}}(master,Tone_core_Clock);var looper;looper=function(){"use strict";function a(a){a.currentPart++,a.currentPart>=a.parts.length?(a.scoreStep=0,a.onended()):(a.scoreStep=0,a.parts[a.currentPart-1].stop(),a.parts[a.currentPart].start())}var b=master,c=120;p5.prototype.setBPM=function(a,d){c=a;for(var e in b.parts)b.parts[e].setBPM(c,d)},p5.Phrase=function(a,b,c){this.phraseStep=0,this.name=a,this.callback=b,this.sequence=c},p5.Part=function(a,d){this.length=a||0,this.partStep=0,this.phrases=[],this.isPlaying=!1,this.noLoop(),this.tatums=d||.0625,this.metro=new p5.Metro,this.metro._init(),this.metro.beatLength(this.tatums),this.metro.setBPM(c),b.parts.push(this),this.callback=function(){}},p5.Part.prototype.setBPM=function(a,b){this.metro.setBPM(a,b)},p5.Part.prototype.getBPM=function(){return this.metro.getBPM()},p5.Part.prototype.start=function(a){if(!this.isPlaying){this.isPlaying=!0,this.metro.resetSync(this);var b=a||0;this.metro.start(b)}},p5.Part.prototype.loop=function(a){this.looping=!0,this.onended=function(){this.partStep=0};var b=a||0;this.start(b)},p5.Part.prototype.noLoop=function(){this.looping=!1,this.onended=function(){this.stop()}},p5.Part.prototype.stop=function(a){this.partStep=0,this.pause(a)},p5.Part.prototype.pause=function(a){this.isPlaying=!1;var b=a||0;this.metro.stop(b)},p5.Part.prototype.addPhrase=function(a,b,c){var d;if(3===arguments.length)d=new p5.Phrase(a,b,c);else{if(!(arguments[0]instanceof p5.Phrase))throw"invalid input. addPhrase accepts name, callback, array or a p5.Phrase";d=arguments[0]}this.phrases.push(d),d.sequence.length>this.length&&(this.length=d.sequence.length)},p5.Part.prototype.removePhrase=function(a){for(var b in this.phrases)this.phrases[b].name===a&&this.phrases.splice(b,1)},p5.Part.prototype.getPhrase=function(a){for(var b in this.phrases)if(this.phrases[b].name===a)return this.phrases[b]},p5.Part.prototype.replaceSequence=function(a,b){for(var c in this.phrases)this.phrases[c].name===a&&(this.phrases[c].sequence=b)},p5.Part.prototype.incrementStep=function(a){this.partStep<this.length-1?(this.callback(a),this.partStep+=1):this.looping||this.partStep!=this.length-1||(console.log("done"),this.onended())},p5.Part.prototype.onStep=function(a){this.callback=a},p5.Score=function(){this.parts=[],this.currentPart=0;var b=this;for(var c in arguments)this.parts[c]=arguments[c],this.parts[c].nextPart=this.parts[c+1],this.parts[c].onended=function(){b.resetPart(c),a(b)};this.looping=!1},p5.Score.prototype.onended=function(){this.looping?this.parts[0].start():this.parts[this.parts.length-1].onended=function(){this.stop(),this.resetParts()},this.currentPart=0},p5.Score.prototype.start=function(){this.parts[this.currentPart].start(),this.scoreStep=0},p5.Score.prototype.stop=function(){this.parts[this.currentPart].stop(),this.currentPart=0,this.scoreStep=0},p5.Score.prototype.pause=function(){this.parts[this.currentPart].stop()},p5.Score.prototype.loop=function(){this.looping=!0,this.start()},p5.Score.prototype.noLoop=function(){this.looping=!1},p5.Score.prototype.resetParts=function(){for(var a in this.parts)this.resetPart(a)},p5.Score.prototype.resetPart=function(a){this.parts[a].stop(),this.parts[a].partStep=0;for(var b in this.parts[a].phrases)this.parts[a].phrases[b].phraseStep=0},p5.Score.prototype.setBPM=function(a,b){for(var c in this.parts)this.parts[c].setBPM(a,b)}}(master);var soundRecorder;soundRecorder=function(){"use strict";function a(a,b){for(var c=a.length+b.length,d=new Float32Array(c),e=0,f=0;c>f;)d[f++]=a[e],d[f++]=b[e],e++;return d}function b(a,b,c){for(var d=c.length,e=0;d>e;e++)a.setUint8(b+e,c.charCodeAt(e))}var c=master,d=c.audiocontext;p5.SoundRecorder=function(){this.input=d.createGain(),this.output=d.createGain(),this.recording=!1,this.bufferSize=1024,this._channels=2,this._clear(),this._jsNode=d.createScriptProcessor(this.bufferSize,this._channels,2),this._jsNode.onaudioprocess=this._audioprocess.bind(this),this._callback=function(){},this._jsNode.connect(p5.soundOut._silentNode),this.setInput(),c.soundArray.push(this)},p5.SoundRecorder.prototype.setInput=function(a){this.input.disconnect(),this.input=null,this.input=d.createGain(),this.input.connect(this._jsNode),this.input.connect(this.output),a?a.connect(this.input):p5.soundOut.output.connect(this.input)},p5.SoundRecorder.prototype.record=function(a,b,c){this.recording=!0,b&&(this.sampleLimit=Math.round(b*d.sampleRate)),a&&c?this._callback=function(){this.buffer=this._getBuffer(),a.setBuffer(this.buffer),c()}:a&&(this._callback=function(){this.buffer=this._getBuffer(),a.setBuffer(this.buffer)})},p5.SoundRecorder.prototype.stop=function(){this.recording=!1,this._callback(),this._clear()},p5.SoundRecorder.prototype._clear=function(){this._leftBuffers=[],this._rightBuffers=[],this.recordedSamples=0,this.sampleLimit=null},p5.SoundRecorder.prototype._audioprocess=function(a){if(this.recording!==!1&&this.recording===!0)if(this.sampleLimit&&this.recordedSamples>=this.sampleLimit)this.stop();else{var b=a.inputBuffer.getChannelData(0),c=a.inputBuffer.getChannelData(1);this._leftBuffers.push(new Float32Array(b)),this._rightBuffers.push(new Float32Array(c)),this.recordedSamples+=this.bufferSize}},p5.SoundRecorder.prototype._getBuffer=function(){var a=[];return a.push(this._mergeBuffers(this._leftBuffers)),a.push(this._mergeBuffers(this._rightBuffers)),a},p5.SoundRecorder.prototype._mergeBuffers=function(a){for(var b=new Float32Array(this.recordedSamples),c=0,d=a.length,e=0;d>e;e++){var f=a[e];b.set(f,c),c+=f.length}return b},p5.SoundRecorder.prototype.dispose=function(){this._clear();var a=c.soundArray.indexOf(this);c.soundArray.splice(a,1),this._callback=function(){},this.input&&this.input.disconnect(),this.input=null,this._jsNode=null},p5.prototype.saveSound=function(c,d){var e,f;e=c.buffer.getChannelData(0),f=c.buffer.numberOfChannels>1?c.buffer.getChannelData(1):e;var g=a(e,f),h=new ArrayBuffer(44+2*g.length),i=new DataView(h);b(i,0,"RIFF"),i.setUint32(4,36+2*g.length,!0),b(i,8,"WAVE"),b(i,12,"fmt "),i.setUint32(16,16,!0),i.setUint16(20,1,!0),i.setUint16(22,2,!0),i.setUint32(24,44100,!0),i.setUint32(28,176400,!0),i.setUint16(32,4,!0),i.setUint16(34,16,!0),b(i,36,"data"),i.setUint32(40,2*g.length,!0);for(var j=g.length,k=44,l=1,m=0;j>m;m++)i.setInt16(k,g[m]*(32767*l),!0),k+=2;p5.prototype.writeFile([i],d,"wav")}}(sndcore,master);var peakdetect;peakdetect=function(){"use strict";p5.PeakDetect=function(a,b,c,d){this.framesPerPeak=d||20,this.framesSinceLastPeak=0,this.decayRate=.95,this.threshold=c||.35,this.cutoff=0,this.cutoffMult=1.5,this.energy=0,this.penergy=0,this.currentValue=0,this.isDetected=!1,this.f1=a||40,this.f2=b||2e4,this._onPeak=function(){}},p5.PeakDetect.prototype.update=function(a){var b=this.energy=a.getEnergy(this.f1,this.f2)/255;b>this.cutoff&&b>this.threshold&&b-this.penergy>0?(this._onPeak(),this.isDetected=!0,this.cutoff=b*this.cutoffMult,this.framesSinceLastPeak=0):(this.isDetected=!1,this.framesSinceLastPeak<=this.framesPerPeak?this.framesSinceLastPeak++:(this.cutoff*=this.decayRate,this.cutoff=Math.max(this.cutoff,this.threshold))),this.currentValue=b,this.penergy=b},p5.PeakDetect.prototype.onPeak=function(a,b){var c=this;c._onPeak=function(){a(c.energy,b)}}}(master);var gain;gain=function(){"use strict";var a=master;p5.Gain=function(){this.ac=a.audiocontext,this.input=this.ac.createGain(),this.output=this.ac.createGain(),this.input.gain.value=.5,this.input.connect(this.output),a.soundArray.push(this)},p5.Gain.prototype.setInput=function(a){a.connect(this.input)},p5.Gain.prototype.connect=function(a){var b=a||p5.soundOut.input;this.output.connect(b.input?b.input:b)},p5.Gain.prototype.disconnect=function(){this.output.disconnect()},p5.Gain.prototype.amp=function(b,c,d){var c=c||0,d=d||0,e=a.audiocontext.currentTime,f=this.output.gain.value;this.output.gain.cancelScheduledValues(e),this.output.gain.linearRampToValueAtTime(f,e+d),this.output.gain.linearRampToValueAtTime(b,e+d+c)},p5.Gain.prototype.dispose=function(){var b=a.soundArray.indexOf(this);a.soundArray.splice(b,1),this.output.disconnect(),this.input.disconnect(),this.output=void 0,this.input=void 0}}(master,sndcore);var distortion;distortion=function(){"use strict";function a(a){for(var b,c="number"==typeof a?a:50,d=44100,e=new Float32Array(d),f=Math.PI/180,g=0;d>g;++g)b=2*g/d-1,e[g]=(3+c)*b*20*f/(Math.PI+c*Math.abs(b));return e}var b=master;p5.Distortion=function(c,d){if("undefined"==typeof c&&(c=.25),"number"!=typeof c)throw new Error("amount must be a number");if("undefined"==typeof d&&(d="2x"),"string"!=typeof d)throw new Error("oversample must be a String");var e=p5.prototype.map(c,0,1,0,2e3);this.ac=b.audiocontext,this.input=this.ac.createGain(),this.output=this.ac.createGain(),this.waveShaperNode=this.ac.createWaveShaper(),this.amount=e,this.waveShaperNode.curve=a(e),this.waveShaperNode.oversample=d,this.input.connect(this.waveShaperNode),this.waveShaperNode.connect(this.output),this.connect(),b.soundArray.push(this)},p5.Distortion.prototype.process=function(a,b,c){a.connect(this.input),this.set(b,c)},p5.Distortion.prototype.set=function(b,c){if(b){var d=p5.prototype.map(b,0,1,0,2e3);this.amount=d,this.waveShaperNode.curve=a(d)}c&&(this.waveShaperNode.oversample=c)},p5.Distortion.prototype.getAmount=function(){return this.amount},p5.Distortion.prototype.getOversample=function(){return this.waveShaperNode.oversample},p5.Distortion.prototype.connect=function(a){var b=a||p5.soundOut.input;this.output.connect(b)},p5.Distortion.prototype.disconnect=function(){this.output.disconnect()},p5.Distortion.prototype.dispose=function(){var a=b.soundArray.indexOf(this);b.soundArray.splice(a,1),this.input.disconnect(),this.waveShaperNode.disconnect(),this.input=null,this.waveShaperNode=null,"undefined"!=typeof this.output&&(this.output.disconnect(),this.output=null)}}(master);var src_app;src_app=function(){"use strict";var a=sndcore;return a}(sndcore,master,helpers,errorHandler,panner,soundfile,amplitude,fft,signal,oscillator,env,pulse,noise,audioin,filter,delay,reverb,metro,looper,soundRecorder,peakdetect,gain,distortion)});