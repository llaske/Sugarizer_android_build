/*! Sugarizer 2020-03-14 */
define(["events"],function(a){function b(a,b){return STATUS={STOPPED:0,RUNNING:1,COMPLETE:2},this.stoptime=0,this.refTime=0,this.tickTimer=0,this.almostDoneFired=!1,this.doneFired=!1,this.countDownMS=a||!1,this.ms=this.countDownMS||0,this._elapsedMS=0,this.state=STATUS.STOPPED,b||(b={}),this.refreshRateMS=b.refreshRateMS||50,this.almostDoneMS=b.almostDoneMS||1e4,this.reset(a),this}return a=a.EventEmitter,b.prototype={start:function(){this.tickTimer&&clearInterval(this.tickTimer),this.state=STATUS.RUNNING,this.refTime=(new Date).getTime(),this.refTime-=this._elapsedMS;var a=this;this.tickTimer=setInterval(function(){a._updateTime()},this.refreshRateMS),this._updateTime(this)},stop:function(){this.tickTimer&&clearInterval(this.tickTimer),this.state===STATUS.RUNNING&&(this.state=STATUS.STOPPED,this._updateTime(this),this.emit("stop"),this.emit("forcestop"))},reset:function(a){this.stop(),this.state=STATUS.STOPPED,this.doneFired=!1,this.almostDoneFired=!1,this._elapsedMS=0,this.refTime=(new Date).getTime(),a&&(this.countDownMS=a),this.ms=this.countDownMS||0,this.emit("time",{ms:this.ms})},startstop:function(){return this.state===STATUS.STOPPED?(this.start(),!0):(this.stop(),!1)},_updateTime:function(){var a=this;a.countDownMS>0?a._timerCountdown(a):a._stopwatchCountup(a)},_timerCountdown:function(){var a=this,b=(new Date).getTime();a._elapsedMS=b-a.refTime;var c=a.countDownMS-a._elapsedMS;c<0&&(c=0),a.ms=c,a.emit("time",{ms:a.ms}),c<=0?(a.stop(),a.doneFired||(a.doneFired=!0,a.state=STATUS.COMPLETE,a.emit("done"))):c<a.almostDoneMS&&(a.almostDoneFired||(a.almostDoneFired=!0,a.emit("almostdone")))},_stopwatchCountup:function(){var a=this,b=(new Date).getTime();a._elapsedMS=b-a.refTime,a.ms=a._elapsedMS,a.emit("time",{ms:a.ms})},onDone:function(a){return this.on("done",a),this},onAlmostDone:function(a){return this.on("almostDone",a),this},onTime:function(a){return this.on("time",a),this},onStop:function(a){return this.on("stop",a),this}},Object.assign(b.prototype,a.prototype),b});