/*! Sugarizer 2020-03-14 */
function convertReadableMS(a){var b=parseMs(a);return(b.hours?b.hours+24*b.days+":"+b.minutes+":"+b.seconds:b.minutes+":"+b.seconds).split(":").map(function(a){return(""+a).padStart(2,"0")}).join(":")}function main(a,b,c,d,e){function f(){"work"===this.state.status?k():l(),p(),m(c.get(this.state.status));var b=document.getElementById("pomodoro-container");this.pomodoro=new a(280,d.stroke,this.state.progress,b),this.pomodoro.draw(),q("work"===this.state.status?d.stroke:d.fill)}function g(a,b){return(b-a.from[0])*(a.to[1]-a.to[0])/(a.from[1]-a.from[0])+a.to[0]}function h(a){if("number"!=typeof a)throw new TypeError("Expected a number");var b=a>0?Math.floor:Math.ceil;return{days:b(a/864e5),hours:b(a/36e5)%24,minutes:b(a/6e4)%60,seconds:b(a/1e3)%60,milliseconds:b(a)%1e3}}function i(){e.setDataAsText({state:this.state}),e.save(function(a){a&&console.errror(a)})}function j(a){var b=h(a);return(b.hours?b.hours+24*b.days+":"+b.minutes+":"+b.seconds:b.minutes+":"+b.seconds).split(":").map(function(a){return(""+a).padStart(2,"0")}).join(":")}function k(){var a=this,e=!1===this.state.timerLeftAt?60*this.state.workTimerLimit*1e3:this.state.timerLeftAt;this.workTimer=new b(e),this.state.status="work";const f=!1===this.state.progressLeftAt?1:this.state.progressLeftAt;this.workTimer.onTime(function(a){n(g({from:[e,0],to:[f,0]},a.ms),a.ms),i()}),this.workTimer.onDone(function(){q(d.fill),setTimeout(function(){this.state.timerLeftAt=!1,this.state.progressLeftAt=!1,m(c.get("break")),l(),a.breakTimer.start()},1e3)})}function l(){var a=this,e=!1===this.state.timerLeftAt?60*this.state.breakTimerLimit*1e3:this.state.timerLeftAt;this.breakTimer=new b(e),this.state.status="break";const f=!1===this.state.progressLeftAt?1:this.state.progressLeftAt;this.breakTimer.onTime(function(a){n(g({from:[e,0],to:[f,0]},a.ms),a.ms),i()}),this.breakTimer.onDone(function(){q(d.stroke),setTimeout(function(){this.state.timerLeftAt=!1,this.state.progressLeftAt=!1,m(c.get("work")),k(),a.workTimer.start()},1e3)})}function m(a){document.querySelector(".status").innerText=a}function n(a,b){this.state.progress=a,"work"===this.state.status?this.state.currentWorkText=j(b):this.state.currentBreakText=j(b),this.state.timerLeftAt=b,this.state.progressLeftAt=a,o(),p()}function o(){this.pomodoro.update(this.state.progress)}function p(){var a=document.querySelector(".info-circle span");"work"===this.state.status?a.innerText=this.state.currentWorkText:a.innerText=this.state.currentBreakText}function q(a){this.state.themeColor=a,document.querySelector(".info-circle").style.backgroundColor=a,document.querySelector(".base-circle").style.backgroundColor=a+"2b",this.pomodoro.updateColor(a,this.state.progress),r()}function r(){var a=this;document.querySelectorAll(".button").forEach(function(b){b.style.background=a.state.themeColor}),document.querySelectorAll(".button-label, .button-time").forEach(function(b){b.style.color=a.state.themeColor})}function s(){this.state.isButtonsDisable=!0,document.querySelectorAll(".button, .button-time, .button-label").forEach(function(a){a.classList.add("disable")})}function t(){this.state.isButtonsDisable=!1,document.querySelectorAll(".button, .button-time, .button-label").forEach(function(a){a.classList.remove("disable")})}function u(){this.state.currentWorkText=j(60*this.state.workTimerLimit*1e3),document.querySelector(".button-time.work").innerText=this.state.workTimerLimit,this.pomodoro.update(1),p(),"work"===this.state.status&&k()}function v(){this.state.currentBreakText=j(60*this.state.breakTimerLimit*1e3),document.querySelector(".button-time.break").innerText=this.state.breakTimerLimit,p(),"break"===this.state.status&&l()}function w(){n(1,60*this.state.workTimerLimit*1e3),this.state.timerLeftAt=!1,this.state.progressLeftAt=!1}function x(){document.querySelector(".button-time.work").innerText=this.state.workTimerLimit,document.querySelector(".button-time.break").innerText=this.state.breakTimerLimit}var y=this;this.state={status:"work",workTimerLimit:defaultWorkTimerLimit,breakTimerLimit:defaultBreakTimerLimit,progress:1,currentWorkText:j(1e3*defaultWorkTimerLimit*60),currentBreakText:j(1e3*defaultBreakTimerLimit*60),themeColor:"#FF0060",isButtonsDisable:!1,timerLeftAt:!1,progressLeftAt:!1},e.loadAsText(function(a,b,c){a&&console.error(a),c&&(y.state=c.state),t(),f()}),this.handlePausePlay=function(){var a=document.getElementById("play-button");"work"===this.state.status?1===this.workTimer.state?(this.workTimer.stop(),t(),a.classList.remove("pause"),a.classList.add("play")):(this.workTimer.start(),s(),a.classList.remove("play"),a.classList.add("pause")):1===this.breakTimer.state?(this.breakTimer.stop(),t(),a.classList.remove("pause"),a.classList.add("play")):(s(),this.breakTimer.start(),a.classList.remove("play"),a.classList.add("pause"))},this.handleWorkPlusClick=function(){this.state.isButtonsDisable||(this.state.workTimerLimit=this.state.workTimerLimit+1,w(),u(),i())},this.handleWorkMinusClick=function(){!this.state.isButtonsDisable&&this.state.workTimerLimit>1&&(this.state.workTimerLimit=this.state.workTimerLimit-1,w(),u(),i())},this.handleBreakPlusClick=function(){this.state.isButtonsDisable||(this.state.breakTimerLimit=this.state.breakTimerLimit+1,w(),v(),i())},this.handleBreakMinusClick=function(){!this.state.isButtonsDisable&&this.state.breakTimerLimit>1&&(this.state.breakTimerLimit=this.state.breakTimerLimit-1,w(),v(),i())},x(),document.querySelector(".plus-button.work").addEventListener("click",handleWorkPlusClick.bind(this)),document.querySelector(".minus-button.work").addEventListener("click",handleWorkMinusClick.bind(this)),document.querySelector(".plus-button.break").addEventListener("click",handleBreakPlusClick.bind(this)),document.querySelector(".minus-button.break").addEventListener("click",handleBreakMinusClick.bind(this)),document.querySelector("#play-button").addEventListener("click",function(){y.handlePausePlay()}),document.querySelector("#replay-button").addEventListener("click",function(){var a;a=y.workTimer&&y.breakTimer?1===y.workTimer.state||1===y.breakTimer.state:y.workTimer?1===y.workTimer.state:1===y.breakTimer.state,a&&this.handlePausePlay(),w(),k(),y.breakTimer&&y.breakTimer.stop(),q(d.stroke),m(c.get("work")),y.pomodoro.update(1)}.bind(this))}define(["sugar-web/activity/activity","webL10n","activity/progress","activity/stopwatch","sugar-web/env"],function(a,b,c,d,e){requirejs(["domReady!"],function(f){a.setup(),e.getEnvironment(function(e,f){currentenv=f;var g="undefined"!=typeof chrome&&chrome.app&&chrome.app.runtime?chrome.i18n.getUILanguage():navigator.language,h=f.user?f.user.language:g;b.language.code=h;var i=a.getDatastoreObject();main(c,d,b,currentenv.user.colorvalue,i)})})});var defaultWorkTimerLimit=1,defaultBreakTimerLimit=1;