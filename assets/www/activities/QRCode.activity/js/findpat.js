/*! Sugarizer 2017-08-25 */
function FinderPattern(a,b,c){this.x=a,this.y=b,this.count=1,this.estimatedModuleSize=c,this.__defineGetter__("EstimatedModuleSize",function(){return this.estimatedModuleSize}),this.__defineGetter__("Count",function(){return this.count}),this.__defineGetter__("X",function(){return this.x}),this.__defineGetter__("Y",function(){return this.y}),this.incrementCount=function(){this.count++},this.aboutEquals=function(a,b,c){if(Math.abs(b-this.y)<=a&&Math.abs(c-this.x)<=a){var d=Math.abs(a-this.estimatedModuleSize);return d<=1||d/this.estimatedModuleSize<=1}return!1}}function FinderPatternInfo(a){this.bottomLeft=a[0],this.topLeft=a[1],this.topRight=a[2],this.__defineGetter__("BottomLeft",function(){return this.bottomLeft}),this.__defineGetter__("TopLeft",function(){return this.topLeft}),this.__defineGetter__("TopRight",function(){return this.topRight})}function FinderPatternFinder(){this.image=null,this.possibleCenters=[],this.hasSkipped=!1,this.crossCheckStateCount=new Array(0,0,0,0,0),this.resultPointCallback=null,this.__defineGetter__("CrossCheckStateCount",function(){return this.crossCheckStateCount[0]=0,this.crossCheckStateCount[1]=0,this.crossCheckStateCount[2]=0,this.crossCheckStateCount[3]=0,this.crossCheckStateCount[4]=0,this.crossCheckStateCount}),this.foundPatternCross=function(a){for(var b=0,c=0;c<5;c++){var d=a[c];if(0==d)return!1;b+=d}if(b<7)return!1;var e=Math.floor((b<<INTEGER_MATH_SHIFT)/7),f=Math.floor(e/2);return Math.abs(e-(a[0]<<INTEGER_MATH_SHIFT))<f&&Math.abs(e-(a[1]<<INTEGER_MATH_SHIFT))<f&&Math.abs(3*e-(a[2]<<INTEGER_MATH_SHIFT))<3*f&&Math.abs(e-(a[3]<<INTEGER_MATH_SHIFT))<f&&Math.abs(e-(a[4]<<INTEGER_MATH_SHIFT))<f},this.centerFromEnd=function(a,b){return b-a[4]-a[3]-a[2]/2},this.crossCheckVertical=function(a,b,c,d){for(var e=this.image,f=qrcode.height,g=this.CrossCheckStateCount,h=a;h>=0&&e[b+h*qrcode.width];)g[2]++,h--;if(h<0)return NaN;for(;h>=0&&!e[b+h*qrcode.width]&&g[1]<=c;)g[1]++,h--;if(h<0||g[1]>c)return NaN;for(;h>=0&&e[b+h*qrcode.width]&&g[0]<=c;)g[0]++,h--;if(g[0]>c)return NaN;for(h=a+1;h<f&&e[b+h*qrcode.width];)g[2]++,h++;if(h==f)return NaN;for(;h<f&&!e[b+h*qrcode.width]&&g[3]<c;)g[3]++,h++;if(h==f||g[3]>=c)return NaN;for(;h<f&&e[b+h*qrcode.width]&&g[4]<c;)g[4]++,h++;if(g[4]>=c)return NaN;var i=g[0]+g[1]+g[2]+g[3]+g[4];return 5*Math.abs(i-d)>=2*d?NaN:this.foundPatternCross(g)?this.centerFromEnd(g,h):NaN},this.crossCheckHorizontal=function(a,b,c,d){for(var e=this.image,f=qrcode.width,g=this.CrossCheckStateCount,h=a;h>=0&&e[h+b*qrcode.width];)g[2]++,h--;if(h<0)return NaN;for(;h>=0&&!e[h+b*qrcode.width]&&g[1]<=c;)g[1]++,h--;if(h<0||g[1]>c)return NaN;for(;h>=0&&e[h+b*qrcode.width]&&g[0]<=c;)g[0]++,h--;if(g[0]>c)return NaN;for(h=a+1;h<f&&e[h+b*qrcode.width];)g[2]++,h++;if(h==f)return NaN;for(;h<f&&!e[h+b*qrcode.width]&&g[3]<c;)g[3]++,h++;if(h==f||g[3]>=c)return NaN;for(;h<f&&e[h+b*qrcode.width]&&g[4]<c;)g[4]++,h++;if(g[4]>=c)return NaN;var i=g[0]+g[1]+g[2]+g[3]+g[4];return 5*Math.abs(i-d)>=d?NaN:this.foundPatternCross(g)?this.centerFromEnd(g,h):NaN},this.handlePossibleCenter=function(a,b,c){var d=a[0]+a[1]+a[2]+a[3]+a[4],e=this.centerFromEnd(a,c),f=this.crossCheckVertical(b,Math.floor(e),a[2],d);if(!isNaN(f)&&(e=this.crossCheckHorizontal(Math.floor(e),Math.floor(f),a[2],d),!isNaN(e))){for(var g=d/7,h=!1,i=this.possibleCenters.length,j=0;j<i;j++){var k=this.possibleCenters[j];if(k.aboutEquals(g,f,e)){k.incrementCount(),h=!0;break}}if(!h){var l=new FinderPattern(e,f,g);this.possibleCenters.push(l),null!=this.resultPointCallback&&this.resultPointCallback.foundPossibleResultPoint(l)}return!0}return!1},this.selectBestPatterns=function(){var a=this.possibleCenters.length;if(a<3)throw"Couldn't find enough finder patterns (found "+a+")";if(a>3){for(var b=0,c=0,d=0;d<a;d++){var e=this.possibleCenters[d].EstimatedModuleSize;b+=e,c+=e*e}var f=b/a;this.possibleCenters.sort(function(a,b){var c=Math.abs(b.EstimatedModuleSize-f),d=Math.abs(a.EstimatedModuleSize-f);return c<d?-1:c==d?0:1});for(var g=Math.sqrt(c/a-f*f),h=Math.max(.2*f,g),d=this.possibleCenters.length-1;d>=0;d--){var i=this.possibleCenters[d];Math.abs(i.EstimatedModuleSize-f)>h&&this.possibleCenters.splice(d,1)}}return this.possibleCenters.length>3&&this.possibleCenters.sort(function(a,b){return a.count>b.count?-1:a.count<b.count?1:0}),new Array(this.possibleCenters[0],this.possibleCenters[1],this.possibleCenters[2])},this.findRowSkip=function(){var a=this.possibleCenters.length;if(a<=1)return 0;for(var b=null,c=0;c<a;c++){var d=this.possibleCenters[c];if(d.Count>=CENTER_QUORUM){if(null!=b)return this.hasSkipped=!0,Math.floor((Math.abs(b.X-d.X)-Math.abs(b.Y-d.Y))/2);b=d}}return 0},this.haveMultiplyConfirmedCenters=function(){for(var a=0,b=0,c=this.possibleCenters.length,d=0;d<c;d++){var e=this.possibleCenters[d];e.Count>=CENTER_QUORUM&&(a++,b+=e.EstimatedModuleSize)}if(a<3)return!1;for(var f=b/c,g=0,d=0;d<c;d++)e=this.possibleCenters[d],g+=Math.abs(e.EstimatedModuleSize-f);return g<=.05*b},this.findFinderPattern=function(a){var b=!1;this.image=a;var c=qrcode.height,d=qrcode.width,e=Math.floor(3*c/(4*MAX_MODULES));(e<MIN_SKIP||b)&&(e=MIN_SKIP);for(var f=!1,g=new Array(5),h=e-1;h<c&&!f;h+=e){g[0]=0,g[1]=0,g[2]=0,g[3]=0,g[4]=0;for(var i=0,j=0;j<d;j++)if(a[j+h*qrcode.width])1==(1&i)&&i++,g[i]++;else if(0==(1&i))if(4==i)if(this.foundPatternCross(g)){var k=this.handlePossibleCenter(g,h,j);if(k)if(e=2,this.hasSkipped)f=this.haveMultiplyConfirmedCenters();else{var l=this.findRowSkip();l>g[2]&&(h+=l-g[2]-e,j=d-1)}else{do j++;while(j<d&&!a[j+h*qrcode.width]);j--}i=0,g[0]=0,g[1]=0,g[2]=0,g[3]=0,g[4]=0}else g[0]=g[2],g[1]=g[3],g[2]=g[4],g[3]=1,g[4]=0,i=3;else g[++i]++;else g[i]++;if(this.foundPatternCross(g)){var k=this.handlePossibleCenter(g,h,d);k&&(e=g[0],this.hasSkipped&&(f=this.haveMultiplyConfirmedCenters()))}}var m=this.selectBestPatterns();return qrcode.orderBestPatterns(m),new FinderPatternInfo(m)}}var MIN_SKIP=3,MAX_MODULES=57,INTEGER_MATH_SHIFT=8,CENTER_QUORUM=2;qrcode.orderBestPatterns=function(a){function b(a,b){var c=a.X-b.X,d=a.Y-b.Y;return Math.sqrt(c*c+d*d)}function c(a,b,c){var d=b.x,e=b.y;return(c.x-d)*(a.y-e)-(c.y-e)*(a.x-d)}var d,e,f,g=b(a[0],a[1]),h=b(a[1],a[2]),i=b(a[0],a[2]);if(h>=g&&h>=i?(e=a[0],d=a[1],f=a[2]):i>=h&&i>=g?(e=a[1],d=a[0],f=a[2]):(e=a[2],d=a[0],f=a[1]),c(d,e,f)<0){var j=d;d=f,f=j}a[0]=d,a[1]=e,a[2]=f};