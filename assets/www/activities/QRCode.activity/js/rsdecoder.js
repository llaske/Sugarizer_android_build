/*! Sugarizer 2019-09-21 */
function ReedSolomonDecoder(a){this.field=a,this.decode=function(a,b){for(var c=new GF256Poly(this.field,a),d=new Array(b),e=0;e<d.length;e++)d[e]=0;for(var f=!1,g=!0,e=0;e<b;e++){var h=c.evaluateAt(this.field.exp(f?e+1:e));d[d.length-1-e]=h,0!=h&&(g=!1)}if(!g)for(var i=new GF256Poly(this.field,d),j=this.runEuclideanAlgorithm(this.field.buildMonomial(b,1),i,b),k=j[0],l=j[1],m=this.findErrorLocations(k),n=this.findErrorMagnitudes(l,m,f),e=0;e<m.length;e++){var o=a.length-1-this.field.log(m[e]);if(o<0)throw"ReedSolomonException Bad error location";a[o]=GF256.addOrSubtract(a[o],n[e])}},this.runEuclideanAlgorithm=function(a,b,c){if(a.Degree<b.Degree){var d=a;a=b,b=d}for(var e=a,f=b,g=this.field.One,h=this.field.Zero,i=this.field.Zero,j=this.field.One;f.Degree>=Math.floor(c/2);){var k=e,l=g,m=i;if(e=f,g=h,i=j,e.Zero)throw"r_{i-1} was zero";f=k;for(var n=this.field.Zero,o=e.getCoefficient(e.Degree),p=this.field.inverse(o);f.Degree>=e.Degree&&!f.Zero;){var q=f.Degree-e.Degree,r=this.field.multiply(f.getCoefficient(f.Degree),p);n=n.addOrSubtract(this.field.buildMonomial(q,r)),f=f.addOrSubtract(e.multiplyByMonomial(q,r))}h=n.multiply1(g).addOrSubtract(l),j=n.multiply1(i).addOrSubtract(m)}var s=j.getCoefficient(0);if(0==s)throw"ReedSolomonException sigmaTilde(0) was zero";var t=this.field.inverse(s),u=j.multiply2(t),v=f.multiply2(t);return new Array(u,v)},this.findErrorLocations=function(a){var b=a.Degree;if(1==b)return new Array(a.getCoefficient(1));for(var c=new Array(b),d=0,e=1;e<256&&d<b;e++)0==a.evaluateAt(e)&&(c[d]=this.field.inverse(e),d++);if(d!=b)throw"Error locator degree does not match number of roots";return c},this.findErrorMagnitudes=function(a,b,c){for(var d=b.length,e=new Array(d),f=0;f<d;f++){for(var g=this.field.inverse(b[f]),h=1,i=0;i<d;i++)f!=i&&(h=this.field.multiply(h,GF256.addOrSubtract(1,this.field.multiply(b[i],g))));e[f]=this.field.multiply(a.evaluateAt(g),this.field.inverse(h)),c&&(e[f]=this.field.multiply(e[f],g))}return e}}