/*! Sugarizer 2020-03-14 */
define(["sugar-web/activity/activity","sugar-web/env","worldpalette","viewpalette","webL10n","tutorial"],function(a,b,c,d,e,f){requirejs(["domReady!"],function(g){a.setup();var h,i=document.getElementById("canvas");a.getXOColor(function(a,b){h=b}),i.style.backgroundColor=h.fill;var j=a.getDatastoreObject(),k=document.getElementById("world-button"),l=(new c.ActivityPalette(k,j),document.getElementById("view-button"));new d.ActivityPalette(l,j);$(document).ready(function(){function c(){document.getElementById("add-button").title=e.get("AddDay"),document.getElementById("minus-button").title=e.get("MinusDay"),document.getElementById("const-button").title=e.get("ToggleConst"),document.getElementById("star-button").title=e.get("ToggleStar"),document.getElementById("location-button").title=e.get("Location"),document.getElementById("world-button").title=e.get("WorldList"),document.getElementById("view-button").title=e.get("View"),document.getElementById("55.3781,-3.4360").innerHTML=e.get("Britain"),document.getElementById("23.6345,-102.5528").innerHTML=e.get("Mexico"),document.getElementById("40.4637,-3.7492").innerHTML=e.get("Spain"),document.getElementById("51.1657,10.4515").innerHTML=e.get("Germany"),document.getElementById("40.3399,127.5101").innerHTML=e.get("NorthKorea"),document.getElementById("23.8859,45.0792").innerHTML=e.get("SaudiArabia"),document.getElementById("35.9078,127.7669").innerHTML=e.get("SouthKorea"),document.getElementById("46.2276,2.2137").innerHTML=e.get("France"),document.getElementById("51.9194,19.1451").innerHTML=e.get("Poland"),document.getElementById("41.8719,12.5674").innerHTML=e.get("Italy"),document.getElementById("20.5937,78.9629").innerHTML=e.get("India"),document.getElementById("9.0820,8.6753").innerHTML=e.get("Nigeria"),document.getElementById("0.7893,113.9213").innerHTML=e.get("Indonesia"),document.getElementById("-14.2350,-51.9253").innerHTML=e.get("Brazil"),document.getElementById("54.5260,-105.2551").innerHTML=e.get("NorthAmerica"),document.getElementById("-8.7832,-55.4915").innerHTML=e.get("SouthAmerica"),document.getElementById("-8.7832,34.5085").innerHTML=e.get("Africa"),document.getElementById("-25.2744,133.7751").innerHTML=e.get("Australia"),document.getElementById("12.8797,121.7740").innerHTML=e.get("Philippines"),document.getElementById("4.2105,101.9758").innerHTML=e.get("Malaysia"),document.getElementById("36.2048,138.2529").innerHTML=e.get("Japan"),document.getElementById("39.9042,116.4074").innerHTML=e.get("China")}function d(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(g)}function g(a){$("button#location-button").on("click",function(){console.log(j);try{document.getElementById(j).style.backgroundColor="black"}catch(a){}j=a.coords.latitude+","+a.coords.longitude,k=h.setLatitude(parseFloat(j.split(",")[0])),l=h.setLongitude(parseFloat(j.split(",")[1])),h.setGeo($(k,l)).setClock(0).draw(),i[2]=j,console.log(i)})}var h=$.virtualsky({id:"starmap",projection:"stereo",keyboard:!1,showposition:!1,showstars:!0,constellations:!0,constellationlabels:!0,showplanets:!0,showplanetlabels:!0,live:!0,clock:new Date});b.getEnvironment(function(b,d){currentenv=d;var f="undefined"!=typeof chrome&&chrome.app&&chrome.app.runtime?chrome.i18.getUILanguage():navigator.language,g=d.user?d.user.language:f;e.language.code=g,h.loadLanguage(g),document.getElementById("locale-date").innerHTML=g,window.addEventListener("localized",function(){c()}),d.objectId?a.getDatastoreObject().loadAsText(function(a,b,c){if(null==a&&null!=c){i=JSON.parse(c),k=h.setLatitude(parseFloat(i[2].split(",")[0])),l=h.setLongitude(parseFloat(i[2].split(",")[1])),h.setGeo($(k,l)).setClock(0).draw();try{document.getElementById(i[2]).style.backgroundColor="grey"}catch(a){console.log("User location used")}h.selectProjection(i[3]),document.getElementById(i[3]).style.backgroundColor="grey",0==i[0]?(document.getElementById("const-button").classList.remove("active"),h.toggleConstellationLines(),h.toggleConstellationLabels()):1==i[0]&&document.getElementById("const-button").classList.add("active"),1==i[1]&&(document.getElementById("star-button").classList.add("active"),h.toggleStarLabels())}}):(console.log("New instance"),document.getElementById(i[2]).style.backgroundColor="grey",document.getElementById(i[3]).style.backgroundColor="grey")});var i=[!0,!1,"55.3781,-3.4360","stereo"],j=document.getElementById("worldConst").innerHTML,k=h.setLatitude(parseFloat(j.split(",")[0])),l=h.setLongitude(parseFloat(j.split(",")[1]));document.getElementById("const-button").classList.add("active"),d(),$("button#add-button").on("click",function(){h.clock.setDate(h.clock.getDate()+1),h.updateClock(h.clock),h.draw()}),$("button#minus-button").on("click",function(){h.clock.setDate(h.clock.getDate()-1),h.updateClock(h.clock),h.draw()}),$("button#const-button").on("click",function(){h.toggleConstellationLines(),h.toggleConstellationLabels(),1==i[0]?(document.getElementById("const-button").classList.remove("active"),i[0]=!1):(document.getElementById("const-button").classList.add("active"),i[0]=!0),console.log(i[0])}),$("button#star-button").on("click",function(){h.toggleStarLabels(),1==i[1]?(document.getElementById("star-button").classList.remove("active"),i[1]=!1):(document.getElementById("star-button").classList.add("active"),i[1]=!0),console.log(i[1])}),$("button.country").on("click",function(){j=document.getElementById("worldConst").innerHTML,k=h.setLatitude(parseFloat(j.split(",")[0])),l=h.setLongitude(parseFloat(j.split(",")[1])),h.setGeo($(k,l)).setClock(0).draw(),i[2]=j,console.log(i)}),$("button.view").on("click",function(){var a=document.getElementById("projection-view").innerHTML;h.selectProjection(a),i[3]=a,h.draw(),console.log(i)}),document.getElementById("help-button").addEventListener("click",function(a){f.start()}),document.getElementById("fullscreen-button").addEventListener("click",function(){document.getElementById("main-toolbar").style.opacity=1,document.getElementById("canvas").style.top="0px",document.getElementById("unfullscreen-button").style.visibility="visible",h.resize()}),document.getElementById("unfullscreen-button").addEventListener("click",function(){document.getElementById("main-toolbar").style.opacity=1,document.getElementById("canvas").style.top="55px",document.getElementById("unfullscreen-button").style.visibility="hidden",h.resize()}),document.getElementById("stop-button").addEventListener("click",function(b){console.log("writing...");var c=JSON.stringify(i);a.getDatastoreObject().setDataAsText(c),a.getDatastoreObject().save(function(a){null===a?(console.log("write done."),console.log(c)):console.log("write failed.")})})})})});