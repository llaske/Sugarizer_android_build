!function(){var e={},t={},n={},o=window.document,i=window.RegExp,r=window.navigator,a=72,l=/msie/.test(r.userAgent.toLowerCase()),s=/msie 6/.test(r.userAgent.toLowerCase())||/msie 5/.test(r.userAgent.toLowerCase()),c=/opera/.test(r.userAgent.toLowerCase()),d={bold:"Strong <strong> Ctrl+B",boldexample:"strong text",italic:"Emphasis <em> Ctrl+I",italicexample:"emphasized text",link:"Hyperlink <a> Ctrl+L",linkdescription:"enter link description here",linkdialog:'<p><b>Insert Hyperlink</b></p><p>http://example.com/ "optional title"</p>',quote:"Blockquote <blockquote> Ctrl+Q",quoteexample:"Blockquote",code:"Code Sample <pre><code> Ctrl+K",codeexample:"enter code here",image:"Image <img> Ctrl+G",imagedescription:"enter image description here",imagedialog:"<p><b>Insert Image</b></p><p>http://example.com/images/diagram.jpg \"optional title\"<br><br>Need <a href='http://www.google.com/search?q=free+image+hosting' target='_blank'>free image hosting?</a></p>",olist:"Numbered List <ol> Ctrl+O",ulist:"Bulleted List <ul> Ctrl+U",litem:"List item",heading:"Heading <h1>/<h2> Ctrl+H",headingexample:"Heading",hr:"Horizontal Rule <hr> Ctrl+R",undo:"Undo - Ctrl+Z",redo:"Redo - Ctrl+Y",redomac:"Redo - Ctrl+Shift+Z",help:"Markdown Editing Help"};function Chunks(){}function PanelCollection(e){this.buttonBar=o.getElementById("wmd-button-bar"+e),this.preview=o.getElementById("wmd-preview"+e),this.input=o.getElementById("wmd-input"+e)}function UndoManager(t,n){var o,i,r,a=this,s=[],c=0,d="none",setMode=function(e,t){d!=e&&(d=e,t||saveState()),l&&"moving"==d?r=null:i=setTimeout(refreshState,1)},refreshState=function(e){r=new TextareaState(n,e),i=void 0};this.setCommandMode=function(){d="command",saveState(),i=setTimeout(refreshState,0)},this.canUndo=function(){return c>1},this.canRedo=function(){return!!s[c+1]},this.undo=function(){a.canUndo()&&(o?(o.restore(),o=null):(s[c]=new TextareaState(n),s[--c].restore(),t&&t())),d="none",n.input.focus(),refreshState()},this.redo=function(){a.canRedo()&&(s[++c].restore(),t&&t()),d="none",n.input.focus(),refreshState()};var saveState=function(){var e=r||new TextareaState(n);if(!e)return!1;"moving"!=d?(o&&(s[c-1].text!=o.text&&(s[c++]=o),o=null),s[c++]=e,s[c+1]=null,t&&t()):o||(o=e)},handleCtrlYZ=function(e){var t=!1;if((e.ctrlKey||e.metaKey)&&!e.altKey){var n=e.charCode||e.keyCode;switch(String.fromCharCode(n).toLowerCase()){case"y":a.redo(),t=!0;break;case"z":e.shiftKey?a.redo():a.undo(),t=!0}}if(t)return e.preventDefault&&e.preventDefault(),void(window.event&&(window.event.returnValue=!1))},handleModeChange=function(e){if(!e.ctrlKey&&!e.metaKey){var t=e.keyCode;t>=33&&t<=40||t>=63232&&t<=63235?setMode("moving"):8==t||46==t||127==t?setMode("deleting"):13==t?setMode("newlines"):27==t?setMode("escape"):(t<16||t>20)&&91!=t&&setMode("typing")}};!function(){e.addEvent(n.input,"keypress",(function(e){!e.ctrlKey&&!e.metaKey||e.altKey||89!=e.keyCode&&90!=e.keyCode||e.preventDefault()}));var handlePaste=function(){(l||r&&r.text!=n.input.value)&&null==i&&(d="paste",saveState(),refreshState())};e.addEvent(n.input,"keydown",handleCtrlYZ),e.addEvent(n.input,"keydown",handleModeChange),e.addEvent(n.input,"mousedown",(function(){setMode("moving")})),n.input.onpaste=handlePaste,n.input.ondrop=handlePaste}(),refreshState(!0),saveState()}function TextareaState(t,n){var i=this,r=t.input;this.init=function(){e.isVisible(r)&&(!n&&o.activeElement&&o.activeElement!==r||(this.setInputAreaSelectionStartEnd(),this.scrollTop=r.scrollTop,(!this.text&&r.selectionStart||0===r.selectionStart)&&(this.text=r.value)))},this.setInputAreaSelection=function(){if(e.isVisible(r))if(void 0===r.selectionStart||c){if(o.selection){if(o.activeElement&&o.activeElement!==r)return;r.focus();var t=r.createTextRange();t.moveStart("character",-r.value.length),t.moveEnd("character",-r.value.length),t.moveEnd("character",i.end),t.moveStart("character",i.start),t.select()}}else r.focus(),r.selectionStart=i.start,r.selectionEnd=i.end,r.scrollTop=i.scrollTop},this.setInputAreaSelectionStartEnd=function(){if(t.ieCachedRange||!r.selectionStart&&0!==r.selectionStart){if(o.selection){i.text=e.fixEolChars(r.value);var n=t.ieCachedRange||o.selection.createRange(),a=e.fixEolChars(n.text),l=""+a+"";n.text=l;var s=e.fixEolChars(r.value);n.moveStart("character",-l.length),n.text=a,i.start=s.indexOf(""),i.end=s.lastIndexOf("")-"".length;var c=i.text.length-e.fixEolChars(r.value).length;if(c){for(n.moveStart("character",-a.length);c--;)a+="\n",i.end+=1;n.text=a}t.ieCachedRange&&(i.scrollTop=t.ieCachedScrollTop),t.ieCachedRange=null,this.setInputAreaSelection()}}else i.start=r.selectionStart,i.end=r.selectionEnd},this.restore=function(){null!=i.text&&i.text!=r.value&&(r.value=i.text),this.setInputAreaSelection(),r.scrollTop=i.scrollTop},this.getChunks=function(){var t=new Chunks;return t.before=e.fixEolChars(i.text.substring(0,i.start)),t.startTag="",t.selection=e.fixEolChars(i.text.substring(i.start,i.end)),t.endTag="",t.after=e.fixEolChars(i.text.substring(i.end)),t.scrollTop=i.scrollTop,t},this.setChunks=function(e){e.before=e.before+e.startTag,e.after=e.endTag+e.after,this.start=e.before.length,this.end=e.before.length+e.selection.length,this.text=e.before+e.selection+e.after,this.scrollTop=e.scrollTop},this.init()}function PreviewManager(n,i,r){var a,s,c,getDocScrollTop=function(){var e=0;return window.innerHeight?e=window.pageYOffset:o.documentElement&&o.documentElement.scrollTop?e=o.documentElement.scrollTop:o.body&&(e=o.body.scrollTop),e},makePreviewHtml=function(){if(i.preview){var e=i.input.value;if(!e||e!=c){c=e;var t=(new Date).getTime();e=n.makeHtml(e);var o=(new Date).getTime();s=o-t,pushPreviewHtml(e)}}},applyTimeout=function(){a&&(clearTimeout(a),a=void 0);var e=0;(e=s)>3e3&&(e=3e3),a=setTimeout(makePreviewHtml,e)};this.refresh=function(e){e?(c="",makePreviewHtml()):applyTimeout()},this.processingTime=function(){return s};var d,u,f,p=!0,ieSafePreviewSet=function(e){var t=i.preview,n=t.parentNode,o=t.nextSibling;n.removeChild(t),t.innerHTML=e,o?n.insertBefore(t,o):n.appendChild(t)},nonSuckyBrowserPreviewSet=function(e){var t=i.preview.contentWindow.document;t.open(),t.writeln(e),t.close()},pushPreviewHtml=function(e){var n,o=t.getTop(i.input)-getDocScrollTop();if(i.preview&&(!function(e){if(d)return d(e);try{nonSuckyBrowserPreviewSet(e),d=nonSuckyBrowserPreviewSet}catch(t){(d=ieSafePreviewSet)(e)}}(e),r()),i.preview&&(i.preview.scrollTop=(i.preview.scrollHeight-i.preview.clientHeight)*((n=i.preview).scrollHeight<=n.clientHeight?1:n.scrollTop/(n.scrollHeight-n.clientHeight))),p)p=!1;else{var a=t.getTop(i.input)-getDocScrollTop();l?setTimeout((function(){window.scrollBy(0,a-o)}),0):window.scrollBy(0,a-o)}};u=i.input,f=applyTimeout,e.addEvent(u,"input",f),u.onpaste=f,u.ondrop=f,e.addEvent(u,"keypress",f),e.addEvent(u,"keydown",f),makePreviewHtml(),i.preview&&(i.preview.scrollTop=0)}function UIManager(t,n,i,a,s,d,u){var f=n.input,p={};!function makeSpritedButtonRow(){var e=document.getElementById("main-toolbar"),makeButton=function(t,n,o,i){var r=document.createElement("button");return r.className="toolbutton",r.id=t,r.title=n,i&&(r.textOp=i),e.appendChild(r),r};if(null==o.getElementById("wmd-bold-button-second")){p.bold=makeButton("wmd-bold-button-second",u("bold"),0,bindCommand("doBold")),p.bold.onclick=function(){doClick(p.bold)},p.italic=makeButton("wmd-italic-button-second",u("italic"),0,bindCommand("doItalic")),p.italic.onclick=function(){doClick(p.italic)},p.heading=makeButton("wmd-heading-button",u("heading"),0,bindCommand("doHeading")),p.heading.onclick=function(){doClick(p.heading)},p.hr=makeButton("wmd-hr-button",u("hr"),0,bindCommand("doHorizontalRule")),p.hr.onclick=function(){doClick(p.hr)},p.olist=makeButton("wmd-olist-button",u("olist"),0,bindCommand((function(e,t){this.doList(e,t,!0)}))),p.olist.onclick=function(){doClick(p.olist)},p.ulist=makeButton("wmd-ulist-button",u("ulist"),0,bindCommand((function(e,t){this.doList(e,t,!1)}))),p.ulist.onclick=function(){doClick(p.ulist)},p.code=makeButton("wmd-code-button",u("code"),0,bindCommand("doCode")),p.code.onclick=function(){doClick(p.code)},p.quote=makeButton("wmd-quote-button",u("quote"),0,bindCommand("doBlockquote")),p.quote.onclick=function(){doClick(p.quote)},p.link=makeButton("wmd-link-button",u("link"),0,bindCommand((function(e,t){return this.doLinkOrImage(e,t,!1)}))),p.link.onclick=function(){doClick(p.link)};var n=/win/.test(r.platform.toLowerCase())?u("redo"):u("redomac");p.undo=makeButton("wmd-undo-button",u("undo"),0,null),p.undo.execute=function(e){e&&e.undo()},p.undo.onclick=function(){doClick(p.undo)},p.redo=makeButton("wmd-redo-button",n,0,null),p.redo.execute=function(e){e&&e.redo()},p.redo.onclick=function(){doClick(p.redo)}}if(d){var i=document.createElement("li"),a=document.createElement("span");i.appendChild(a),i.className="wmd-button wmd-help-button",i.id="wmd-help-button"+t,i.XShift="-240px",i.isHelp=!0,i.style.right="0px",i.title=u("help"),i.onclick=d.handler,p.help=i}setUndoRedoButtonStates()}();var g="keydown";function doClick(e){if(f.focus(),e.textOp){i&&i.setCommandMode();var t=new TextareaState(n);if(!t)return;var o=t.getChunks(),fixupInputArea=function(){f.focus(),o&&t.setChunks(o),t.restore(),a.refresh()};e.textOp(o,fixupInputArea)||fixupInputArea()}e.execute&&e.execute(i)}function bindCommand(e){return"string"==typeof e&&(e=s[e]),function(){e.apply(s,arguments)}}function setUndoRedoButtonStates(){}c&&(g="keypress"),e.addEvent(f,g,(function(e){if((e.ctrlKey||e.metaKey)&&!e.altKey&&!e.shiftKey){var t=e.charCode||e.keyCode;switch(String.fromCharCode(t).toLowerCase()){case"b":doClick(p.bold);break;case"i":doClick(p.italic);break;case"l":doClick(p.link);break;case"q":doClick(p.quote);break;case"k":doClick(p.code);break;case"g":doClick(p.image);break;case"o":doClick(p.olist);break;case"u":doClick(p.ulist);break;case"h":doClick(p.heading);break;case"r":doClick(p.hr);break;case"y":doClick(p.redo);break;case"z":e.shiftKey?doClick(p.redo):doClick(p.undo);break;default:return}e.preventDefault&&e.preventDefault(),window.event&&(window.event.returnValue=!1)}})),e.addEvent(f,"keyup",(function(e){if(e.shiftKey&&!e.ctrlKey&&!e.metaKey&&13===(e.charCode||e.keyCode)){var t={};t.textOp=bindCommand("doAutoindent"),doClick(t)}})),l&&e.addEvent(f,"keydown",(function(e){if(27===e.keyCode)return!1})),this.setUndoRedoButtonStates=setUndoRedoButtonStates}function CommandManager(e,t){this.hooks=e,this.getString=t}Markdown.Editor=function(e,t,n){"function"==typeof(n=n||{}).handler&&(n={helpButton:n}),n.strings=n.strings||{},n.helpButton&&(n.strings.help=n.strings.help||n.helpButton.title);var getString=function(e){return n.strings[e]||d[e]};t=t||"";var i=this.hooks=new Markdown.HookCollection;i.addNoop("onPreviewRefresh"),i.addNoop("postBlockquoteCreation"),i.addFalse("insertImageDialog"),this.getConverter=function(){return e};var r,a=this;this.run=function(){if(!r){r=new PanelCollection(t);var l,s,c=new CommandManager(i,getString),d=new PreviewManager(e,r,(function(){i.onPreviewRefresh()}));/\?noundo/.test(o.location.href)||(l=new UndoManager((function(){d.refresh(),s&&s.setUndoRedoButtonStates()}),r),this.textOperation=function(e){l.setCommandMode(),e(),a.refreshPreview()}),(s=new UIManager(t,r,l,d,c,n.helpButton,getString)).setUndoRedoButtonStates(),(a.refreshPreview=function(){d.refresh(!0)})()}}},Chunks.prototype.findTags=function(t,n){var o,i=this;t&&(o=e.extendRegExp(t,"","$"),this.before=this.before.replace(o,(function(e){return i.startTag=i.startTag+e,""})),o=e.extendRegExp(t,"^",""),this.selection=this.selection.replace(o,(function(e){return i.startTag=i.startTag+e,""}))),n&&(o=e.extendRegExp(n,"","$"),this.selection=this.selection.replace(o,(function(e){return i.endTag=e+i.endTag,""})),o=e.extendRegExp(n,"^",""),this.after=this.after.replace(o,(function(e){return i.endTag=e+i.endTag,""})))},Chunks.prototype.trimWhitespace=function(e){var t,n,o=this;e?t=n="":(t=function(e){return o.before+=e,""},n=function(e){return o.after=e+o.after,""}),this.selection=this.selection.replace(/^(\s*)/,t).replace(/(\s*)$/,n)},Chunks.prototype.skipLines=function(e,t,n){var o,r;if(void 0===e&&(e=1),void 0===t&&(t=1),e++,t++,navigator.userAgent.match(/Chrome/)&&"X".match(/()./),this.selection=this.selection.replace(/(^\n*)/,""),this.startTag=this.startTag+i.$1,this.selection=this.selection.replace(/(\n*$)/,""),this.endTag=this.endTag+i.$1,this.startTag=this.startTag.replace(/(^\n*)/,""),this.before=this.before+i.$1,this.endTag=this.endTag.replace(/(\n*$)/,""),this.after=this.after+i.$1,this.before){for(o=r="";e--;)o+="\\n?",r+="\n";n&&(o="\\n*"),this.before=this.before.replace(new i(o+"$",""),r)}if(this.after){for(o=r="";t--;)o+="\\n?",r+="\n";n&&(o="\\n*"),this.after=this.after.replace(new i(o,""),r)}},e.isVisible=function(e){return window.getComputedStyle?"none"!==window.getComputedStyle(e,null).getPropertyValue("display"):e.currentStyle?"none"!==e.currentStyle.display:void 0},e.addEvent=function(e,t,n){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener(t,n,!1)},e.removeEvent=function(e,t,n){e.detachEvent?e.detachEvent("on"+t,n):e.removeEventListener(t,n,!1)},e.fixEolChars=function(e){return e=(e=e.replace(/\r\n/g,"\n")).replace(/\r/g,"\n")},e.extendRegExp=function(e,t,n){null==t&&(t=""),null==n&&(n="");var o,r=e.toString();return r=(r=r.replace(/\/([gim]*)$/,(function(e,t){return o=t,""}))).replace(/(^\/|\/$)/g,""),new i(r=t+r+n,o)},t.getTop=function(e,t){var n=e.offsetTop;if(!t)for(;e=e.offsetParent;)n+=e.offsetTop;return n},t.getHeight=function(e){return e.offsetHeight||e.scrollHeight},t.getWidth=function(e){return e.offsetWidth||e.scrollWidth},t.getPageSize=function(){var e,t,n,i;return self.innerHeight&&self.scrollMaxY?(e=o.body.scrollWidth,t=self.innerHeight+self.scrollMaxY):o.body.scrollHeight>o.body.offsetHeight?(e=o.body.scrollWidth,t=o.body.scrollHeight):(e=o.body.offsetWidth,t=o.body.offsetHeight),self.innerHeight?(n=self.innerWidth,i=self.innerHeight):o.documentElement&&o.documentElement.clientHeight?(n=o.documentElement.clientWidth,i=o.documentElement.clientHeight):o.body&&(n=o.body.clientWidth,i=o.body.clientHeight),[Math.max(e,n),Math.max(t,i),n,i]},n.createBackground=function(){var e=o.createElement("div"),n=e.style;e.className="wmd-prompt-background",n.position="absolute",n.top="0",n.zIndex="1000",l?n.filter="alpha(opacity=50)":n.opacity="0.5";var i=t.getPageSize();return n.height=i[1]+"px",l?(n.left=o.documentElement.scrollLeft,n.width=o.documentElement.clientWidth):(n.left="0",n.width="100%"),o.body.appendChild(e),e},n.prompt=function(n,i,r){var a,l;void 0===i&&(i="");var checkEscape=function(e){27===(e.charCode||e.keyCode)&&close(!0)},close=function(t){e.removeEvent(o.body,"keydown",checkEscape);var n=l.value;return t?n=null:(n=n.replace(/^http:\/\/(https?|ftp):\/\//,"$1://"),/^(?:https?|ftp):\/\//.test(n)||(n="http://"+n)),a.parentNode.removeChild(a),r(n),!1};setTimeout((function(){!function(){(a=o.createElement("div")).className="wmd-prompt-dialog",a.style.padding="10px;",a.style.position="fixed",a.style.width="400px",a.style.zIndex="1001";var r=o.createElement("div");r.innerHTML=n,r.style.padding="5px",a.appendChild(r);var c=o.createElement("form"),d=c.style;c.onsubmit=function(){return close(!1)},d.padding="0",d.margin="0",d.cssFloat="left",d.width="100%",d.textAlign="center",d.position="relative",a.appendChild(c),(l=o.createElement("input")).type="text",l.value=i,(d=l.style).display="block",d.width="80%",d.marginLeft=d.marginRight="auto",c.appendChild(l);var u=o.createElement("input");u.type="button",u.onclick=function(){return close(!1)},u.value="OK",(d=u.style).margin="10px",d.display="inline",d.width="7em";var f=o.createElement("input");f.type="button",f.onclick=function(){return close(!0)},f.value="Cancel",(d=f.style).margin="10px",d.display="inline",d.width="7em",c.appendChild(u),c.appendChild(f),e.addEvent(o.body,"keydown",checkEscape),a.style.top="50%",a.style.left="50%",a.style.display="block",s&&(a.style.position="absolute",a.style.top=o.documentElement.scrollTop+200+"px",a.style.left="50%"),o.body.appendChild(a),a.style.marginTop=-t.getHeight(a)/2+"px",a.style.marginLeft=-t.getWidth(a)/2+"px"}();var r=i.length;if(void 0!==l.selectionStart)l.selectionStart=0,l.selectionEnd=r;else if(l.createTextRange){var c=l.createTextRange();c.collapse(!1),c.moveStart("character",-r),c.moveEnd("character",r),c.select()}l.focus()}),0)};var u=CommandManager.prototype;u.prefixes="(?:\\s{4,}|\\s*>|\\s*-\\s+|\\s*\\d+\\.|=|\\+|-|_|\\*|#|\\s*\\[[^\n]]+\\]:)",u.unwrap=function(e){var t=new i("([^\\n])\\n(?!(\\n|"+this.prefixes+"))","g");e.selection=e.selection.replace(t,"$1 $2")},u.wrap=function(e,t){this.unwrap(e);var n=new i("(.{1,"+t+"})( +|$\\n?)","gm"),o=this;e.selection=e.selection.replace(n,(function(e,t){return new i("^"+o.prefixes,"").test(e)?e:t+"\n"})),e.selection=e.selection.replace(/\s+$/,"")},u.doBold=function(e,t){return this.doBorI(e,t,2,this.getString("boldexample"))},u.doItalic=function(e,t){return this.doBorI(e,t,1,this.getString("italicexample"))},u.doBorI=function(e,t,n,o){e.trimWhitespace(),e.selection=e.selection.replace(/\n{2,}/g,"\n");var r=/(\**$)/.exec(e.before)[0],a=/(^\**)/.exec(e.after)[0],l=Math.min(r.length,a.length);if(l>=n&&(2!=l||1!=n))e.before=e.before.replace(i("[*]{"+n+"}$",""),""),e.after=e.after.replace(i("^[*]{"+n+"}",""),"");else if(!e.selection&&a){e.after=e.after.replace(/^([*_]*)/,""),e.before=e.before.replace(/(\s?)$/,"");var s=i.$1;e.before=e.before+a+s}else{e.selection||a||(e.selection=o);var c=n<=1?"*":"**";e.before=e.before+c,e.after=c+e.after}},u.stripLinkDefs=function(e,t){return e=e.replace(/^[ ]{0,3}\[(\d+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+|$)/gm,(function(e,n,o,i,r){return t[n]=e.replace(/\s*$/,""),i?(t[n]=e.replace(/["(](.+?)[")]$/,""),i+r):""}))},u.addLinkDef=function(e,t){var n=0,o={};e.before=this.stripLinkDefs(e.before,o),e.selection=this.stripLinkDefs(e.selection,o),e.after=this.stripLinkDefs(e.after,o);var i="",r=/(\[)((?:\[[^\]]*\]|[^\[\]])*)(\][ ]?(?:\n[ ]*)?\[)(\d+)(\])/g,addDefNumber=function(e){n++,e=e.replace(/^[ ]{0,3}\[(\d+)\]:/,"  ["+n+"]:"),i+="\n"+e},getLink=function(e,t,i,a,l,s){return i=i.replace(r,getLink),o[l]?(addDefNumber(o[l]),t+i+a+n+s):e};e.before=e.before.replace(r,getLink),t?addDefNumber(t):e.selection=e.selection.replace(r,getLink);var a=n;return e.after=e.after.replace(r,getLink),e.after&&(e.after=e.after.replace(/\n*$/,"")),e.after||(e.selection=e.selection.replace(/\n*$/,"")),e.after+="\n\n"+i,a},u.doLinkOrImage=function(e,t,o){var i;if(e.trimWhitespace(),e.findTags(/\s*!?\[/,/\][ ]?(?:\n[ ]*)?(\[.*?\])?/),!(e.endTag.length>1&&e.startTag.length>0)){if(e.selection=e.startTag+e.selection+e.endTag,e.startTag=e.endTag="",/\n\n/.test(e.selection))return void this.addLinkDef(e,null);var r=this,linkEnteredCallback=function(n){if(i.parentNode.removeChild(i),null!==n){e.selection=(" "+e.selection).replace(/([^\\](?:\\\\)*)(?=[[\]])/g,"$1\\").substr(1);var a=" [999]: "+function properlyEncoded(e){return e.replace(/^\s*(.*?)(?:\s+"(.+)")?\s*$/,(function(e,t,n){return t=t.replace(/\?.*$/,(function(e){return e.replace(/\+/g," ")})),t=decodeURIComponent(t),t=(t=encodeURI(t).replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")).replace(/\?.*$/,(function(e){return e.replace(/\+/g,"%2b")})),n&&(n=(n=n.trim?n.trim():n.replace(/^\s*/,"").replace(/\s*$/,"")).replace(/"/g,"quot;").replace(/\(/g,"&#40;").replace(/\)/g,"&#41;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),n?t+' "'+n+'"':t}))}(n),l=r.addLinkDef(e,a);e.startTag=o?"![":"[",e.endTag="]["+l+"]",e.selection||(e.selection=o?r.getString("imagedescription"):r.getString("linkdescription"))}t()};return i=n.createBackground(),o?this.hooks.insertImageDialog(linkEnteredCallback)||n.prompt(this.getString("imagedialog"),"http://",linkEnteredCallback):n.prompt(this.getString("linkdialog"),"http://",linkEnteredCallback),!0}e.startTag=e.startTag.replace(/!?\[/,""),e.endTag="",this.addLinkDef(e,null)},u.doAutoindent=function(e,t){var n=!1;e.before=e.before.replace(/(\n|^)[ ]{0,3}([*+-]|\d+[.])[ \t]*\n$/,"\n\n"),e.before=e.before.replace(/(\n|^)[ ]{0,3}>[ \t]*\n$/,"\n\n"),e.before=e.before.replace(/(\n|^)[ \t]+\n$/,"\n\n"),e.selection||/^[ \t]*(?:\n|$)/.test(e.after)||(e.after=e.after.replace(/^[^\n]*/,(function(t){return e.selection=t,""})),n=!0),/(\n|^)[ ]{0,3}([*+-]|\d+[.])[ \t]+.*\n$/.test(e.before)&&this.doList&&this.doList(e),/(\n|^)[ ]{0,3}>[ \t]+.*\n$/.test(e.before)&&this.doBlockquote&&this.doBlockquote(e),/(\n|^)(\t|[ ]{4,}).*\n$/.test(e.before)&&this.doCode&&this.doCode(e),n&&(e.after=e.selection+e.after,e.selection="")},u.doBlockquote=function(e,t){e.selection=e.selection.replace(/^(\n*)([^\r]+?)(\n*)$/,(function(t,n,o,i){return e.before+=n,e.after=i+e.after,o})),e.before=e.before.replace(/(>[ \t]*)$/,(function(t,n){return e.selection=n+e.selection,""})),e.selection=e.selection.replace(/^(\s|>)+$/,""),e.selection=e.selection||this.getString("quoteexample");var n,o="",i="";if(e.before){for(var r=e.before.replace(/\n$/,"").split("\n"),l=!1,s=0;s<r.length;s++){var c=!1;n=r[s],l=l&&n.length>0,/^>/.test(n)?(c=!0,!l&&n.length>1&&(l=!0)):c=!!/^[ \t]*$/.test(n)||l,c?o+=n+"\n":(i+=o+n,o="\n")}/(^|\n)>/.test(o)||(i+=o,o="")}e.startTag=o,e.before=i,e.after&&(e.after=e.after.replace(/^\n?/,"\n")),e.after=e.after.replace(/^(((\n|^)(\n[ \t]*)*>(.+\n)*.*)+(\n[ \t]*)*)/,(function(t){return e.endTag=t,""}));var replaceBlanksInTags=function(t){var n=t?"> ":"";e.startTag&&(e.startTag=e.startTag.replace(/\n((>|\s)*)\n$/,(function(e,t){return"\n"+t.replace(/^[ ]{0,3}>?[ \t]*$/gm,n)+"\n"}))),e.endTag&&(e.endTag=e.endTag.replace(/^\n((>|\s)*)\n/,(function(e,t){return"\n"+t.replace(/^[ ]{0,3}>?[ \t]*$/gm,n)+"\n"})))};/^(?![ ]{0,3}>)/m.test(e.selection)?(this.wrap(e,a-2),e.selection=e.selection.replace(/^/gm,"> "),replaceBlanksInTags(!0),e.skipLines()):(e.selection=e.selection.replace(/^[ ]{0,3}> ?/gm,""),this.unwrap(e),replaceBlanksInTags(!1),!/^(\n|^)[ ]{0,3}>/.test(e.selection)&&e.startTag&&(e.startTag=e.startTag.replace(/\n{0,2}$/,"\n\n")),!/(\n|^)[ ]{0,3}>.*$/.test(e.selection)&&e.endTag&&(e.endTag=e.endTag.replace(/^\n{0,2}/,"\n\n"))),e.selection=this.hooks.postBlockquoteCreation(e.selection),/\n/.test(e.selection)||(e.selection=e.selection.replace(/^(> *)/,(function(t,n){return e.startTag+=n,""})))},u.doCode=function(e,t){var n=/\S[ ]*$/.test(e.before);if(!/^[ ]*\S/.test(e.after)&&!n||/\n/.test(e.selection)){e.before=e.before.replace(/[ ]{4}$/,(function(t){return e.selection=t+e.selection,""}));var o=1,i=1;/(\n|^)(\t|[ ]{4,}).*\n$/.test(e.before)&&(o=0),/^\n(\t|[ ]{4,})/.test(e.after)&&(i=0),e.skipLines(o,i),e.selection?/^[ ]{0,3}\S/m.test(e.selection)?/\n/.test(e.selection)?e.selection=e.selection.replace(/^/gm,"    "):e.before+="    ":e.selection=e.selection.replace(/^(?:[ ]{4}|[ ]{0,3}\t)/gm,""):(e.startTag="    ",e.selection=this.getString("codeexample"))}else e.trimWhitespace(),e.findTags(/`/,/`/),e.startTag||e.endTag?e.endTag&&!e.startTag?(e.before+=e.endTag,e.endTag=""):e.startTag=e.endTag="":(e.startTag=e.endTag="`",e.selection||(e.selection=this.getString("codeexample")))},u.doList=function(e,t,n){var o=/^\n*(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*/,r="-",l=1,getItemPrefix=function(){var e;return n?(e=" "+l+". ",l++):e=" "+r+" ",e},getPrefixedItem=function(e){return void 0===n&&(n=/^\s*\d/.test(e)),e=e.replace(/^[ ]{0,3}([*+-]|\d+[.])\s/gm,(function(e){return getItemPrefix()}))};if(e.findTags(/(\n|^)*[ ]{0,3}([*+-]|\d+[.])\s+/,null),!e.before||/\n$/.test(e.before)||/^\n/.test(e.startTag)||(e.before+=e.startTag,e.startTag=""),e.startTag){var s=/\d+[.]/.test(e.startTag);if(e.startTag="",e.selection=e.selection.replace(/\n[ ]{4}/g,"\n"),this.unwrap(e),e.skipLines(),s&&(e.after=e.after.replace(o,getPrefixedItem)),n==s)return}var c=1;e.before=e.before.replace(/(\n|^)(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*$/,(function(e){return/^\s*([*+-])/.test(e)&&(r=i.$1),c=/[^\n]\n\n[^\n]/.test(e)?1:0,getPrefixedItem(e)})),e.selection||(e.selection=this.getString("litem"));var d=getItemPrefix(),u=1;e.after=e.after.replace(o,(function(e){return u=/[^\n]\n\n[^\n]/.test(e)?1:0,getPrefixedItem(e)})),e.trimWhitespace(!0),e.skipLines(c,u,!0),e.startTag=d;var f=d.replace(/./g," ");this.wrap(e,a-f.length),e.selection=e.selection.replace(/\n/g,"\n"+f)},u.doHeading=function(e,t){if(e.selection=e.selection.replace(/\s+/g," "),e.selection=e.selection.replace(/(^\s+|\s+$)/g,""),!e.selection)return e.startTag="## ",e.selection=this.getString("headingexample"),void(e.endTag=" ##");var n=0;e.findTags(/#+[ ]*/,/[ ]*#+/),/#+/.test(e.startTag)&&(n=i.lastMatch.length),e.startTag=e.endTag="",e.findTags(null,/\s?(-+|=+)/),/=+/.test(e.endTag)&&(n=1),/-+/.test(e.endTag)&&(n=2),e.startTag=e.endTag="",e.skipLines(1,1);var o=0==n?2:n-1;if(o>0){var r=o>=2?"-":"=",l=e.selection.length;for(l>a&&(l=a),e.endTag="\n";l--;)e.endTag+=r}},u.doHorizontalRule=function(e,t){e.startTag="----------\n",e.selection="",e.skipLines(2,1,!0)}}();