/*! Sugarizer 2019-01-12 */
define(["sugar-web/activity/activity","webL10n","sugar-web/datastore","activity/model","activity/view","activity/controller"],function(a,b,c,d,e,f){requirejs(["domReady!"],function(b){function c(){this.model=new d.Model,this.view=new e.View,this.controller=new f.Controller(this.model,this.view)}function g(a,b,c){i.controller.loadItems(JSON.parse(c))}function h(a){for(var b=a;"LI"!==b.nodeName;)b=b.parentNode;return b.dataset.id}var i;a.setup(),document.getElementById("new-todo").placeholder=l10n_s.get("new-todo"),document.getElementById("stop-button").addEventListener("click",function(b){console.log("writing...");var c=JSON.stringify(i.model.items);a.getDatastoreObject().setDataAsText(c),a.getDatastoreObject().save(function(a){null===a?console.log("write done."):console.log("write failed.")})});var j;document.allowDrop=function(a){a.preventDefault()},document.drag=function(a){j=a.target,a.dataTransfer.setData("text/plain",a.target.id)},document.drop=function(a){a.preventDefault();var b=j.childNodes[0].childNodes[1],c=parseInt(j.dataset.id),d=a.target,e=a.target.parentNode.parentNode,f=parseInt(e.dataset.id),g=d.innerText;d.innerText=b.innerText,b.innerText=g;var h=e.className;e.className=j.className,j.className=h,e.childNodes[0].childNodes[0].hasAttribute("checked")?j.childNodes[0].childNodes[0].hasAttribute("checked")||(e.childNodes[0].childNodes[0].removeAttribute("checked"),j.childNodes[0].childNodes[0].setAttribute("checked",null)):j.childNodes[0].childNodes[0].hasAttribute("checked")&&(e.childNodes[0].childNodes[0].hasAttribute("checked")||(j.childNodes[0].childNodes[0].removeAttribute("checked"),e.childNodes[0].childNodes[0].setAttribute("checked",null)));var k=i.controller.model.items.map(function(a){return a.id}).indexOf(c),l=i.controller.model.items.map(function(a){return a.id}).indexOf(f);i.controller.model.items[k].title=b.innerText,i.controller.model.items[l].title=d.innerText;var m=parseInt(i.controller.model.items[l].completed);i.controller.model.items[l].completed=i.controller.model.items[k].completed,i.controller.model.items[k].completed=m},i=new c,a.getDatastoreObject().loadAsText(g);var k=document.getElementById("new-todo");k.addEventListener("keypress",function(a){if(a.keyCode===i.controller.ENTER_KEY){i.controller.addItem(a.target.value)&&(a.target.value="")}}),document.getElementById("new-todo-button").addEventListener("click",function(a){i.controller.addItem(k.value)&&(k.value="")}),document.getElementById("todo-list").addEventListener("click",function(a){var b=a.target;b.className.indexOf("remove")>-1&&i.controller.removeItem(h(b)),b.className.indexOf("toggle")>-1&&i.controller.toggleComplete(h(b),b)})})});