requirejs.config({baseUrl:"lib",paths:{activity:"../js"}});var app=new Vue({el:"#app",components:{game:Game,result:Result,"dataset-list":DatasetList,"setting-editor":SettingEditor,categoryForm:CategoryForm,leaderboard:Leaderboard},data:{currentScreen:"",strokeColor:"#f0d9b5",fillColor:"#b58863",currentenv:null,SugarL10n:null,SugarPresence:null,SugarJournal:null,SugarPopup:null,DataSetHandler:null,mode:"non-timer",view:"play",score:0,level:0,gameLevelBonus:!1,timer:null,clock:{active:!1,time:0,initial:0,type:0},timeMarks:[],tangramCategories:["Animals"],puzzles:[],pNo:0,gameTans:[],userResponse:[],gameOver:null,hintNumber:0,hintsUsed:[!1,!1,!1,!1,!1,!1,!1],noOfHintsUsed:0,showHint:!1,gameScale:1,gameStage:{width:1,height:1},tanColors:["blue","purple","red","green","yellow","yellow"],puzzleToBeEdited:null,categoryToBeEdited:null,puzzleChosen:null,playersAll:[],connectedPlayers:[],playersPlaying:[],multiplayer:!1,disabled:!1,startGameConfig:null,l10n:{stringNetwork:"",stringView:"",stringRandom:"",stringTimer:"",stringDifficultyLevel:"",stringNewCategory:"",stringCategory:"",stringHint:"",stringTutorial:"",stringFullscreen:"",stringUnfullscreen:"",stringStop:"",stringScore:"",stringTotalScore:"",stringTotalTime:"",stringRank:"",stringUser:"",stringConfirm:"",stringCancel:"",stringTitle:"",stringNewTitle:"",stringHintsUsed:"",stringMyTangram:"",stringEasy:"",stringHard:"",stringTangramDifficulty:"",stringValidPuzzle:"",stringInvalidShape:"",stringInvalidName:"",stringTutoExplainTitle:"",stringTutoExplainContent:"",stringTutoAboutTitle:"",stringTutoAboutContent:"",stringTutoEachPuzzleTitle:"",stringTutoEachPuzzleContent:"",stringTutoTangramCategoryTitle:"",stringTutoTangramCategoryContent:"",stringTutoTargetTitle:"",stringTutoTargetContent:"",stringTutoBoardTitle:"",stringTutoBoardContent:"",stringTutoRefreshTitle:"",stringTutoRefreshContent:"",stringTutoNewCategoryTitle:"",stringTutoNewCategoryContent:"",stringTutoSettingViewTitle:"",stringTutoSettingViewContent:"",stringTutoScoreTitle:"",stringTutoScoreContent:"",stringTutoRandomPlayTitle:"",stringTutoRandomPlayContent:"",stringTutoHintTitle:"",stringTutoHintContent:"",stringTutoLevelTitle:"",stringTutoLevelContent:"",stringTutoTimerTitle:"",stringTutoTimerContent:"",stringTutoGameActionsTitle:"",stringTutoGameActionsContent:"",stringTutoViewTitle:"",stringTutoViewContent:"",stringTutoRedoTitle:"",stringTutoRedoContent:"",stringTutoKeyBoardTitle:"",stringTutoKeyBoardContent:"",stringTutoValidPuzzleIndicatorTitle:"",stringTutoValidPuzzleIndicatorContent:"",stringTutoResultTitle:"",stringTutoResultContent:"",stringTutoTangramCardTitle:"",stringTutoTangramCardContent:"",stringTutoNewPuzzleTitle:"",stringTutoNewPuzzleContent:"",stringTutoClockInfoTitle:"",stringTutoClockInfoContent:"",stringTutoScoreInfoTitle:"",stringTutoScoreInfoContent:"",stringTutoRestartTitle:"",stringTutoRestartContent:"",stringTutoLeaderboardPaginationTitle:"",stringTutoLeaderboardPaginationContent:"",stringTutoLeaderboardMainTitle:"",stringTutoLeaderboardMainContent:"",stringTutoGoBackTitle:"",stringTutoGoBackContent:"",stringTutoPlayViewTitle:"",stringTutoPlayViewContent:"",stringTutoRandomButtonTitle:"",stringTutoRandomButtonContent:"",stringTutoBoardEditorTitle:"",stringTutoBoardEditorContent:"",stringTutoValidPuzzleTitle:"",stringTutoValidPuzzleContent:"",stringTutoCategoryNameTitle:"",stringTutoCategoryNameContent:"",stringTutoEditPuzzleTitle:"",stringTutoEditPuzzleContent:"",stringTutoDeletePuzzleTitle:"",stringTutoDeletePuzzleContent:"",stringTutoEditCategoryTitle:"",stringTutoEditCategoryContent:"",stringTutoDeleteCategoryTitle:"",stringTutoDeleteCategoryContent:""}},created:function(){Konva.Util.getRandomColor=function(){for(var e=(11390624*Math.random()<<0).toString(15);e.length<6;)e="0"+e;return"#"+e}},watch:{currentScreen:function(){var e=this;document.getElementById("spinner").style.visibility="visible","game"===e.currentScreen?(e.multiplayer||e.newGame(),e.clock.active||null!==e.gameOver||e.startClock()):"dataset-list"===e.currentScreen&&("Random"===e.tangramCategories[0]||e.tangramCategories.length>1)&&e.onTangramCategorySelected({index:"Animals"}),"setting-editor"!==e.currentScreen&&(e.puzzleToBeEdited=null),"categoryForm"!==e.currentScreen&&(e.categoryToBeEdited=null),"game"!==e.currentScreen&&(e.puzzleChosen=null)},pNo:function(){let e=this;e.gameOver=null,e.hintNumber=0,e.hintsUsed=[!1,!1,!1,!1,!1,!1,!1],e.Level?e.gameLevelBonus=!0:e.gameLevelBonus=!1;let t=e.populatePuzzles(e.puzzles[e.pNo].tangram.tans);e.$set(e.puzzles[e.pNo],"targetTans",t.targetTans),e.$set(e.puzzles[e.pNo],"outline",computeOutline(e.puzzles[e.pNo].tangram.tans,!0)),e.noOfHintsUsed=0;let n=e.puzzles.length-e.pNo;if(10===n)if(e.multiplayer&&!e.SugarPresence.isHost)e.SugarPresence.sendMessage({user:this.SugarPresence.getUserInfo(),content:{action:"add-questions"}});else{let t=e.generatePuzzles(10,!0);e.puzzles=e.puzzles.concat(t),e.multiplayer&&e.SugarPresence.isHost&&e.SugarPresence.sendMessage({user:this.SugarPresence.getUserInfo(),content:{action:"update-questions",data:{puzzles:t}}})}if(n<=5&&e.multiplayer&&!e.SugarPresence.isHost){let t=e.generatePuzzles(5,!0);e.puzzles=e.puzzles.concat(t)}e.centerTangram()},"DataSetHandler.AllCategories":function(e,t){this.fillCategoryPalette()},playersPlaying:function(){0===this.playersPlaying.length&&this.SugarPresence.isHost?this.disabled=!1:this.disabled=!0}},mounted:function(){this.SugarJournal=this.$refs.SugarJournal,this.SugarL10n=this.$refs.SugarL10n,this.SugarPresence=this.$refs.SugarPresence,this.DataSetHandler=this.$refs.DataSetHandler,this.SugarPresence=this.$refs.SugarPresence,this.SugarPopup=this.$refs.SugarPopup,generating=!1},methods:{initialized:function(){let e=this;e.currentenv=e.$refs.SugarActivity.getEnvironment(),document.getElementById("app").style.background=e.currentenv.user.colorvalue.stroke,e.strokeColor=e.currentenv.user.colorvalue.stroke,e.fillColor=e.currentenv.user.colorvalue.fill},localized:function(){document.getElementById("no-timer-button")&&(document.getElementById("no-timer-button").innerHTML=this.SugarL10n.get("NoTimer")),this.fillCategoryPalette(),this.SugarL10n.localize(this.l10n)},pulseEffect:function(){let e=document.querySelector(".pulse-main");e&&(e.classList.add("pulse"),setTimeout(()=>{e.classList.remove("pulse")},600))},fillCategoryPalette:function(){let e="",t=!0;for(var n=0;n<this.DataSetHandler.AllCategories.length;n++){let a=this.DataSetHandler.currentCategories.findIndex(e=>e===this.DataSetHandler.AllCategories[n]),r=this.SugarL10n.dictionary?this.SugarL10n.dictionary["Data"+this.DataSetHandler.AllCategories[n].replace(/ /g,"")]:null,o=r?r.textContent:this.DataSetHandler.AllCategories[n];e+='<div id="category-button-'+(n+1)+'" tangramcategory="'+this.DataSetHandler.AllCategories[n]+'" class="palette-item'+(-1!==a?" palette-item-selected":"")+'">'+o+"</div>",this.DataSetHandler.AllCategories[n]===this.tangramCategories[0]&&(t=!1)}let a=document.getElementById("category-buttons");if(a){a.innerHTML=e;let r=this.$refs.categoryPalette.paletteObject,o=this.$refs.categoryPalette.paletteObject.tangramCategorySelectedEvent,s=document.getElementById("category-buttons").children;for(n=0;n<s.length;n++){let e=this.DataSetHandler.AllCategories[n];s[n].addEventListener("click",(function(t){r.tangramCategorySelectedEvent.index=e,r.getPalette().dispatchEvent(o),r.popDown()}))}t&&(this.tangramCategories=[this.DataSetHandler.AllCategories[0]],this.DataSetHandler.onChangeCategory(this.tangramCategories),this.selectTangramCategoryItem(this.tangramCategories))}},startClock:function(){var e=this;e.$set(e.clock,"time",e.clock.initial),e.$set(e.clock,"active",!0),null===e.timer&&e.tick()},stopClock:function(){var e=this;e.timer&&clearInterval(e.timer),e.timer=null,e.$set(e.clock,"active",!1)},pushTimeMark:function(){let e=this;0===e.timeMarks.length&&e.timeMarks.push(e.clock.initial),e.timeMarks.push(e.clock.time)},tick:function(){var e=this;e.timer=setInterval((function(){if(e.clock.active)if("timer"===e.mode){if(e.$set(e.clock,"time",e.clock.time-1),e.clock.time<=0){e.stopClock(),e.pushTimeMark();let n=[];if(e.setUserResponse(n),e.multiplayer){for(var t=0;t<e.playersAll.length;t++)if(e.playersAll[t].user.networkId===e.currentenv.user.networkId&&null===e.playersAll[t].score){e.$set(e.playersAll[t],"score",e.score);break}e.playersPlaying=e.playersPlaying.filter((function(t){return t.networkId!==e.currentenv.user.networkId})),e.SugarPresence.isHost&&0===e.playersPlaying.length&&(e.disabled=!1),e.SugarPresence.sendMessage({user:e.SugarPresence.getUserInfo(),content:{action:"game-over",data:{score:e.score}}})}e.currentScreen="result"}}else e.$set(e.clock,"time",e.clock.time+1)}),1e3)},newGame:function(e){let t=this;t.score=0,t.userResponse=[],t.timeMarks=[],t.pNo=0,t.gameOver=null,t.hintNumber=0,t.noOfHintsUsed=0,t.level?t.gameLevelBonus=!0:t.gameLevelBonus=!1,t.startClock(),e||t.generateQuestionSet(),t.centerTangram()},onMultiplayerGameStarted:function(e){var t=this;t.multiplayer=!0,t.disabled=!0,"non-timer"===t.mode&&(t.mode="timer",t.$set(t.clock,"initial",120),t.$set(t.clock,"type",1),t.selectTimerItem(t.clock.type)),t.startGameConfig={level:t.level,clockType:t.clock.type,clockInitial:t.clock.initial,tangramCategories:t.tangramCategories};var n={colorvalue:t.currentenv.user.colorvalue,name:t.currentenv.user.name,networkId:t.currentenv.user.networkId};if(e){t.playersAll=[];for(var a=0;a<t.connectedPlayers.length;a++)t.playersAll.push({user:t.connectedPlayers[a],score:null})}else{var r={user:n,score:null};t.playersAll.push(r),t.connectedPlayers.push(n)}t.playersPlaying.push(n),t.newGame(),"game"!==t.currentScreen&&(t.currentScreen="game"),t.SugarPresence.isHost&&e&&(t.SugarPresence.sendMessage({user:this.SugarPresence.getUserInfo(),content:{action:"update-players",data:{playersAll:t.playersAll,playersPlaying:t.playersPlaying,connectedPlayers:t.connectedPlayers}}}),t.SugarPresence.sendMessage({user:this.SugarPresence.getUserInfo(),content:{action:"start-game",data:{type:"restart",puzzles:t.puzzles,clockType:t.startGameConfig.clockType,clockInitial:t.startGameConfig.clockInitial,level:t.startGameConfig.level,tangramCategories:t.startGameConfig.tangramCategories}}}))},generateQuestionSet:function(e){var t=this;"non-timer"===t.mode?t.puzzles=t.generatePuzzles(1,!1):t.puzzles=t.generatePuzzles(15,!0),t.pNo=0},generatePuzzles:function(e,t){let n=this,a=[],r=0;for(;r<e;){let e,o;if(generating=!0,"Random"!==n.tangramCategories[0]){let a;if(n.puzzleChosen)a=n.puzzleChosen,n.puzzleChosen=null,e=a.tangram.dup(),o=a.name;else if(0===n.DataSetHandler.nextArr.length&&t){e=generateTangrams(2)[0],o="Random"}else a=n.DataSetHandler.generateTangramFromSet(),e=a.tangram.dup(),o=a.name}else{e=generateTangrams(2)[0],o="Random"}if(generating=!1,void 0===e.evaluation)continue;let s=checkDifficultyOfTangram(e);e.positionCentered();let l={name:o,difficulty:s,tangram:e,targetTans:[],outline:[],outlinePoints:[]};if(0===r){let t=n.populatePuzzles(e.tans);l.targetTans=t.targetTans,l.outline=[...e.outline]}a.push(l),r++}return a},populatePuzzles:function(e){let t=this;targetTans=[];let n=[];for(var a=0;a<e.length;a++){let r=e[a].anchor.x.coeffInt,o=e[a].anchor.x.coeffSqrt,s=e[a].anchor.y.coeffInt,l=e[a].anchor.y.coeffSqrt,i=new Point(new IntAdjoinSqrt2(r,o),new IntAdjoinSqrt2(s,l)),u={id:a+50,x:100,y:100,offsetX:100,offsetY:100,anchor:null,pointsObjs:[],tanObj:new Tan(e[a].tanType,i.dup(),e[a].orientation),tanType:e[a].tanType,orientation:e[a].orientation,points:[],stroke:t.fillColor,strokeEnabled:!0,strokeWidth:.3,closed:!0,lineJoin:"round",shadowColor:"black",shadowBlur:10,shadowOpacity:.8,shadowEnabled:!1},c=[...u.tanObj.getPoints()],g=u.tanObj.center(),m=[],p=[];for(let e=0;e<c.length;e++){let t=c[e].dup();p.push(t),m.push(t.toFloatX()),m.push(t.toFloatY())}u.offsetX=g.toFloatX(),u.offsetY=g.toFloatY(),u.x=u.offsetX,u.y=u.offsetY,u.points=m,u.anchor=u.tanObj.anchor.dup(),u.pointsObjs=p,u.stroke=0===t.level?t.fillColor:t.strokeColor,targetTans.push(u),n.push(u.tanObj)}return{targetTans:targetTans,tans:n}},centerTangram:function(){let e=this,t=e.puzzles[e.pNo].targetTans,n=e.gameScale,a=e.gameStage.width/(3*n)-30,r=e.gameStage.height/(2*n)-30;for(let n=0;n<t.length;n++){let l=[...t[n].tanObj.getPoints()],i=t[n].tanObj.center(),u=[];for(let e=0;e<l.length;e++){let t=l[e].dup();t.x.add(new IntAdjoinSqrt2(a,0)),t.y.add(new IntAdjoinSqrt2(r,0)),u.push(t.toFloatX()),u.push(t.toFloatY())}let c=[];for(var o=0;o<e.puzzles[e.pNo].outline.length;o++){let t=[];for(var s=0;s<e.puzzles[e.pNo].outline[o].length;s++)t.push(e.puzzles[e.pNo].outline[o][s].toFloatX()+a),t.push(e.puzzles[e.pNo].outline[o][s].toFloatY()+r);c.push(t)}e.$set(e.puzzles[e.pNo],"outlinePoints",c),e.$set(e.puzzles[e.pNo].targetTans[n],"points",u),e.$set(e.puzzles[e.pNo].targetTans[n],"offsetX",i.toFloatX()+a),e.$set(e.puzzles[e.pNo].targetTans[n],"offsetY",i.toFloatY()+r),e.$set(e.puzzles[e.pNo].targetTans[n],"x",i.toFloatX()+a),e.$set(e.puzzles[e.pNo].targetTans[n],"y",i.toFloatY()+r)}},setUserResponse:function(e){let t,n=this,a=!0,r=n.puzzles[n.pNo].difficulty?2:0,o=n.gameLevelBonus?2:0;if(0===e.length){a=!1,t=0;for(var s=0;s<7;s++){let t=n.puzzles[n.pNo].targetTans[s];e.push(t.tanObj)}}else t=6-Math.min(6,n.noOfHintsUsed)+Math.max(0,15-Math.floor(Math.abs(n.timeMarks[n.pNo+1]-n.timeMarks[n.pNo])/4))+r+o;n.score+=t,n.$set(n.userResponse,n.pNo,{isSolved:a,score:t,tans:e})},onConfigChanged:function(e){this.gameScale=e.scale,this.gameStage.width=e.stageWidth,this.gameStage.height=e.stageHeight},onUpdateTansPlaced:function(e){let t=this;if(t.gameOver)return;let n=[!0,!0,!0,!0,!0,!0,!0];for(var a=0;a<7;a++){let t=e[a];-1!=t&&(n[t]=!1)}for(a=0;a<n.length;a++)if(n[a]){t.hintNumber=a;break}},onTangramStatus:function(e){let t=this;if(t.gameOver)return;let n=e.res;for(var a=0;a<t.puzzles[t.pNo].targetTans.length;a++)t.$set(t.puzzles[t.pNo].targetTans[a],"shadowEnabled",n);if(n){for(a=0;a<7;a++)t.puzzles[t.pNo].targetTans[a].strokeEnabled=!1;t.pushTimeMark();let n=e.tans;t.setUserResponse(n),t.pulseEffect(),"non-timer"===t.mode?(t.stopClock(),t.gameOver="solved"):t.pNo++}},handleRestartButton:function(){var e=this;if("game"===e.currentScreen){if(e.pushTimeMark(),"timer"===e.mode){e.stopClock();let t=[];e.setUserResponse(t),e.currentScreen="result"}"non-timer"===e.mode&&e.gameOver&&(e.gameOver=null,e.pulseEffect(),e.newGame())}else e.SugarPresence.isHost&&e.onMultiplayerGameStarted(!0),e.currentScreen="game"},handlePassButton:function(){var e=this;if("game"===e.currentScreen){e.pushTimeMark();let n=[];if(e.setUserResponse(n),e.pulseEffect(),"non-timer"===e.mode){e.stopClock();for(var t=0;t<e.puzzles[e.pNo].targetTans.length;t++){let n=e.tanColors[e.puzzles[e.pNo].targetTans[t].tanType];e.$set(e.puzzles[e.pNo].targetTans[t],"fill",n),e.$set(e.puzzles[e.pNo].targetTans[t],"strokeEnabled",!1)}e.gameOver="passed"}else e.pNo++}},onRandom:function(){let e=this;"Random"===e.tangramCategories[0]?(e.tangramCategories=["Animals"],e.DataSetHandler.onChangeCategory(e.tangramCategories)):e.tangramCategories=["Random"],e.selectTangramCategoryItem(e.tangramCategories),"result"!==e.currentScreen&&(e.pulseEffect(),e.currentScreen="game",e.newGame())},onTangramCategorySelected:function(e){let t=this,n=t.DataSetHandler.dataSet.findIndex(t=>t.name===e.index);("game"!==t.currentScreen||-1!==n&&0!==t.DataSetHandler.dataSet[n].tangrams.length)&&(document.getElementById("spinner").style.visibility="visible",t.DataSetHandler.tangramSet=[],setTimeout(()=>{t.pulseEffect(),t.tangramCategories=[e.index],t.DataSetHandler.onChangeCategory(t.tangramCategories),t.selectTangramCategoryItem(t.tangramCategories),"game"===t.currentScreen&&t.newGame(),document.getElementById("spinner").style.visibility="hidden"},0))},selectTangramCategoryItem:function(e){let t=document.getElementById("category-buttons").children;for(var n=0;n<t.length;n++){let a=t[n],r=a.getAttribute("tangramcategory");e.includes(r)?a.classList.add("palette-item-selected"):a.classList.remove("palette-item-selected")}},onDifficultySelected:function(){var e=this;if(e.level=e.level?0:1,0==e.level&&(e.gameLevelBonus=!1),"game"!==e.currentScreen)return void(e.gameLevelBonus=e.level);if(e.gameOver)return e.pulseEffect(),void e.newGame();let t=e.populatePuzzles(e.puzzles[e.pNo].tangram.tans);e.$set(e.puzzles[e.pNo],"targetTans",t.targetTans),e.$set(e.puzzles[e.pNo],"outline",computeOutline(e.puzzles[e.pNo].tangram.tans,!0)),e.centerTangram()},onTimerSelected:function(e){var t=this;switch(t.pulseEffect(),e.index){case 0:t.mode="non-timer",t.$set(t.clock,"initial",0),t.$set(t.clock,"type",0);break;case 1:t.mode="timer",t.$set(t.clock,"initial",120),t.$set(t.clock,"type",1);break;case 2:t.mode="timer",t.$set(t.clock,"initial",300),t.$set(t.clock,"type",2);break;case 3:t.mode="timer",t.$set(t.clock,"initial",600),t.$set(t.clock,"type",3)}t.selectTimerItem(e.index),"game"===t.currentScreen&&t.newGame()},selectTimerItem:function(e){for(var t=[document.getElementById("no-timer-button"),document.getElementById("first-timer-button"),document.getElementById("second-timer-button"),document.getElementById("third-timer-button")],n=0;n<t.length;n++){var a=t[n];n===e?a.classList.add("palette-item-selected"):a.classList.remove("palette-item-selected")}},onHint:function(){let e=this;if(0===e.level||e.gameOver)return;e.hintsUsed[e.hintNumber]=!0,e.noOfHintsUsed=0;for(var t=0;t<7;t++)e.hintsUsed[t]&&e.noOfHintsUsed++;let n=e.tanColors[e.puzzles[e.pNo].targetTans[e.hintNumber].tanType];e.$set(e.puzzles[e.pNo].targetTans[e.hintNumber],"fill",n),e.puzzles[e.pNo].targetTans[e.hintNumber].shadowEnabled=!0,e.showHint=!0,setTimeout(()=>{e.$set(e.puzzles[e.pNo].targetTans[e.hintNumber],"fill",e.strokeColor),e.puzzles[e.pNo].targetTans[e.hintNumber].shadowEnabled=!1,e.showHint=!1},1e3)},onChangeView:function(){let e=this;e.pulseEffect(),"play"===e.view?e.view="setting":e.view="play","game"===e.currentScreen&&(e.stopClock(),e.view="setting",e.currentScreen="dataset-list")},goToSettingEditor:function(){this.currentScreen="setting-editor"},goToDatasetList:function(){"game"===this.currentScreen&&this.stopClock(),this.currentScreen="dataset-list"},onEditPuzzle:function(e){this.puzzleToBeEdited=this.DataSetHandler.getTangramPuzzle(e),this.goToSettingEditor()},onEditCategory:function(e){this.categoryToBeEdited=this.tangramCategories[0],this.currentScreen="categoryForm"},onSavePuzzle:function(e){this.DataSetHandler.editTangramPuzzle(e.puzzle,e.id)},onPlayPuzzle:function(e){this.puzzleChosen=this.DataSetHandler.getTangramPuzzle(e);let t=this.DataSetHandler.tangramSet.findIndex(t=>t.id===e),n=this.DataSetHandler.nextArr.findIndex(e=>e===t);-1!==n&&this.DataSetHandler.nextArr.splice(n,1),this.currentScreen="game"},importDataSet:function(e){this.DataSetHandler.dataSet=e,this.DataSetHandler.loadTangramSet(),this.newGame()},deserealizePuzzles:function(e){let t=[];for(var n=0;n<e.length;n++){let a=e[n].tangram.tans.map(e=>{let t=e.anchor.x.coeffInt,n=e.anchor.x.coeffSqrt,a=e.anchor.y.coeffInt,r=e.anchor.y.coeffSqrt,o=new Point(new IntAdjoinSqrt2(t,n),new IntAdjoinSqrt2(a,r));return new Tan(e.tanType,o.dup(),e.orientation)}),r={...e[n],targetTans:[],tangram:null,outline:[],outlinePoints:[]};r.tangram=new Tangram(a),t.push(r)}return t},fullscreen:function(){this.$refs.SugarToolbar.hide(),setTimeout(()=>{window.dispatchEvent(new Event("resize"))},0)},unfullscreen:function(){this.$refs.SugarToolbar.show(),setTimeout(()=>{window.dispatchEvent(new Event("resize"))},0)},onStop:function(){let e=this,t=[];for(var n=0;n<e.puzzles.length;n++){let r={name:e.puzzles[n].name,targetTans:[]};for(var a=0;a<e.puzzles[n].tangram.tans.length;a++){let t={tanType:e.puzzles[n].tangram.tans[a].tanType,orientation:e.puzzles[n].tangram.tans[a].orientation,anchor:e.puzzles[n].tangram.tans[a].anchor.dup()};r.targetTans.push(t)}t.push(r)}let r=[];for(n=0;n<e.userResponse.length;n++){let t={isSolved:e.userResponse[n].isSolved,score:e.userResponse[n].score,tans:[]};for(a=0;a<e.userResponse[n].tans.length;a++)t.tans.push({...e.userResponse[n].tans[a]});r.push(t)}let o,s,l,i,u,c=[];if("game"===e.currentScreen||"setting-editor"===e.currentScreen){let t=e.$refs[e.currentScreen].tans;for(n=0;n<t.length;n++){let e=t[n];c.push({...e.tanObj,placedAnchor:e.placedAnchor})}s=e.$refs[e.currentScreen].configKonva,o=e.$refs[e.currentScreen].configLayer.scaleX,"game"===e.currentScreen?(l=e.$refs[e.currentScreen].tansPlaced,i=e.$refs[e.currentScreen].tansSnapped):"setting-editor"===e.currentScreen&&(u=e.$refs[e.currentScreen].puzzleCreated)}let g={type:"game-context",currentScreen:e.currentScreen,mode:e.mode,view:e.view,level:e.level,gameLevelBonus:e.gameLevelBonus,tangramCategories:e.tangramCategories,puzzles:t,pNo:e.pNo,score:e.score,clock:e.clock,timeMarks:e.timeMarks,gameOver:e.gameOver,userResponse:r,noOfHintsUsed:e.noOfHintsUsed,hintNumber:e.hintNumber,hintsUsed:e.hintsUsed,gameTans:c,gameTansPlaced:l,gameTansSnapped:i,gameScale:o,gameStage:s,puzzleCreated:u,tangramSet:e.DataSetHandler.tangramSet,dataSet:e.DataSetHandler.dataSet,nextArr:e.DataSetHandler.nextArr,currentCategories:e.DataSetHandler.currentCategories,currentCategories:e.DataSetHandler.currentCategories,puzzleToBeEdited:e.puzzleToBeEdited};e.SugarJournal.saveData(g)},onJournalNewInstance:function(){console.log("New instance"),this.currentScreen="dataset-list"},onJournalDataLoaded:function(e,t){var n=this;if(console.log("Existing instance"),"game-dataset"===e.type)return n.importDataSet(e.dataSet),void(n.currentScreen="dataset-list");n.clock={...e.clock},n.DataSetHandler.dataSet=e.dataSet,n.DataSetHandler.tangramSet=e.tangramSet,n.DataSetHandler.currentCategories=e.currentCategories,n.DataSetHandler.nextArr=e.nextArr,n.DataSetHandler.AllCategories=e.dataSet.map(e=>e.name),n.tangramCategories=e.tangramCategories,e.clock.active?n.startClock():n.stopClock(),"categoryForm"===e.currentScreen?n.currentScreen="dataset-list":"leaderboard"===e.currentScreen?n.currentScreen="result":n.currentScreen=e.currentScreen,setTimeout(()=>{n.mode=e.mode,n.level=e.level,n.timeMarks=e.timeMarks,n.hintNumber=e.hintNumber,n.hintsUsed=e.hintsUsed,n.noOfHintsUsed=e.noOfHintsUsed,n.gameLevelBonus=n.gameLevelBonus,n.pNo=e.pNo,n.score=e.score,n.gameOver=e.gameOver,n.userResponse=[];for(var t=0;t<e.userResponse.length;t++){let r={isSolved:e.userResponse[t].isSolved,score:e.userResponse[t].score,tans:[]};for(var a=0;a<e.userResponse[t].tans.length;a++){let n=e.userResponse[t].tans[a].anchor.x.coeffInt,o=e.userResponse[t].tans[a].anchor.x.coeffSqrt,s=e.userResponse[t].tans[a].anchor.y.coeffInt,l=e.userResponse[t].tans[a].anchor.y.coeffSqrt,i=new Point(new IntAdjoinSqrt2(n,o),new IntAdjoinSqrt2(s,l));r.tans.push(new Tan(e.userResponse[t].tans[a].tanType,i,e.userResponse[t].tans[a].orientation))}n.userResponse.push(r)}n.clock={...e.clock},e.clock.active||n.stopClock(),n.puzzles=[];for(t=0;t<e.puzzles.length;t++){let a={...e.puzzles[t],tangram:null,outline:[],outlinePoints:[]};a.targetTans=[];let r=[],o=n.populatePuzzles(e.puzzles[t].targetTans);a.targetTans=o.targetTans,r=o.tans,a.tangram=new Tangram(r),a.difficulty=checkDifficultyOfTangram(a.tangram),a.outline=computeOutline(r,!0),n.puzzles.push(a)}if("game"===n.currentScreen)if(n.centerTangram(),"solved"===e.gameOver)for(t=0;t<n.puzzles[n.pNo].targetTans.length;t++)n.$set(n.puzzles[n.pNo].targetTans[t],"shadowEnabled",!0),n.$set(n.puzzles[n.pNo].targetTans[t],"strokeEnabled",!1);else if("passed"===e.gameOver)for(t=0;t<n.puzzles[n.pNo].targetTans.length;t++){n.$set(n.puzzles[n.pNo].targetTans[t],"strokeEnabled",!1);let e=n.tanColors[n.puzzles[n.pNo].targetTans[t].tanType];n.$set(n.puzzles[n.pNo].targetTans[t],"fill",e)}"game"===e.currentScreen&&setTimeout(()=>{n.$refs.game.loadContext({tans:e.gameTans,tansSnapped:e.gameTansSnapped,tansPlaced:e.gameTansPlaced,pScale:e.gameScale,pStage:e.gameStage})},0),"setting-editor"===e.currentScreen&&setTimeout(()=>{n.puzzleToBeEdited=e.puzzleToBeEdited,n.$refs["setting-editor"].loadContext({tans:e.gameTans,pScale:e.gameScale,pStage:e.gameStage,puzzle:e.puzzleCreated})},0)},0),n.selectTangramCategoryItem(n.tangramCategories),n.selectTimerItem(n.clock.type)},onJournalLoadError:function(e){console.log("Error loading from journal"),this.currentScreen="dataset-list"},onActivityShared:function(e,t){this.onMultiplayerGameStarted(),this.SugarPresence.onShared(e,t)},onNetworkDataReceived:function(e){if((a=this).SugarPresence.getUserInfo().networkId!==e.user.networkId)switch(e.content.action){case"start-game":var t=e.content.data;if(!a.multiplayer&&"init"===t.type||a.multiplayer&&"restart"===t.type){a.multiplayer=!0,a.startGameConfig={level:t.level,clockType:t.clockType,clockInitial:t.clockInitial,tangramCategories:t.tangramCategories},a.puzzles=a.deserealizePuzzles(t.puzzles);let e=a.populatePuzzles(a.puzzles[0].tangram.tans);a.puzzles[0].targetTans=e.targetTans,a.puzzles[0].outline=computeOutline(a.puzzles[0].tangram.tans,!0),a.pNo=0,a.level=t.level,a.tangramCategories=t.tangramCategories,a.mode="timer",a.$set(a.clock,"type",t.clockType),a.$set(a.clock,"initial",t.clockInitial),"game"!==a.currentScreen&&(a.currentScreen="game"),a.selectTangramCategoryItem(a.tangramCategories),a.selectTimerItem(a.clock.type),a.disabled=!0,a.newGame(!0)}break;case"game-over":t=e.content.data;for(var n=0;n<a.playersAll.length;n++)if(a.playersAll[n].user.networkId===e.user.networkId&&null===a.playersAll[n].score){a.$set(a.playersAll[n],"score",t.score);break}a.playersPlaying=a.playersPlaying.filter((function(t){return t.networkId!==e.user.networkId})),a.SugarPresence.isHost&&0===a.playersPlaying.length&&(a.disabled=!1);break;case"update-players":t=e.content.data;a.playersAll=t.playersAll,a.playersPlaying=t.playersPlaying,a.connectedPlayers=t.connectedPlayers,a.SugarPresence.isHost&&0===a.playersPlaying.length&&(a.disabled=!1);break;case"add-questions":if(a.SugarPresence.isHost){let e=a.generatePuzzles(10,!0);a.puzzles=a.puzzles.concat(e),a.SugarPresence.sendMessage({user:this.SugarPresence.getUserInfo(),content:{action:"update-questions",data:{puzzles:e}}})}break;case"update-questions":t=e.content.data;let r=a.deserealizePuzzles(t.puzzles);a.puzzles=a.puzzles.concat(r)}else var a=this},onNetworkUserChanged:function(e){var t=this;if(1===e.move){if(t.SugarPresence.isHost){var n={user:e.user,score:null};t.playersAll.push(n),t.playersPlaying.push(e.user),t.connectedPlayers.push(e.user),t.SugarPresence.sendMessage({user:this.SugarPresence.getUserInfo(),content:{action:"update-players",data:{playersAll:t.playersAll,playersPlaying:t.playersPlaying,connectedPlayers:t.connectedPlayers}}}),t.SugarPresence.sendMessage({user:this.SugarPresence.getUserInfo(),content:{action:"start-game",data:{type:"init",puzzles:t.puzzles,clockType:t.startGameConfig.clockType,clockInitial:t.startGameConfig.clockInitial,level:t.startGameConfig.level,tangramCategories:t.startGameConfig.tangramCategories}}})}}else{t.playersPlaying=t.playersPlaying.filter((function(t){return t.networkId!==e.user.networkId}));for(var a=0;a<t.playersAll.length;a++)if(t.playersAll[a].user.networkId===e.user.networkId&&null===t.playersAll[a].score){t.$set(t.playersAll[a],"score",0);break}t.connectedPlayers=t.connectedPlayers.filter((function(t){return t.networkId!==e.user.networkId})),t.SugarPresence.isHost=t.connectedPlayers[0].networkId===t.SugarPresence.getUserInfo().networkId}},onHelp:function(){var e=this,t=[];"leaderboard"===e.currentScreen?t=[{element:".leaderboard-main",placement:"top",title:this.l10n.stringTutoLeaderboardMainTitle,content:this.l10n.stringTutoLeaderboardMainContent},{element:".btn-back",placement:"auto top",title:this.l10n.stringTutoGoBackTitle,content:this.l10n.stringTutoGoBackContent},{element:".page-no",placement:"auto top",title:this.l10n.stringTutoLeaderboardPaginationTitle,content:this.l10n.stringTutoLeaderboardPaginationContent}]:"result"===e.currentScreen?(document.querySelector(".result-panel-primary").scrollTo({top:0}),t=[{element:"",orphan:!0,placement:"bottom",title:this.l10n.stringTutoResultTitle,content:this.l10n.stringTutoResultContent},{element:".result-card:first-child",placement:"auto right",title:this.l10n.stringTutoTangramCardTitle,content:this.l10n.stringTutoTangramCardContent},{element:".result-card:first-child .clock-info-block",placement:"auto bottom",title:this.l10n.stringTutoClockInfoTitle,content:this.l10n.stringTutoClockInfoContent},{element:".result-card:first-child .score-info-block",placement:"auto bottom",title:this.l10n.stringTutoScoreInfoTitle,content:this.l10n.stringTutoScoreInfoContent},{element:".btn-restart",placement:"auto top",title:this.l10n.stringTutoRestartTitle,content:this.l10n.stringTutoRestartContent},{element:".btn-see-leaderboard",placement:"auto top",title:this.l10n.stringTutoRestartTitle,content:this.l10n.stringTutoRestartContent}]):"game"===e.currentScreen?t=[{element:"",orphan:!0,placement:"bottom",title:this.l10n.stringTutoExplainTitle,content:this.l10n.stringTutoExplainContent},{element:"",orphan:!0,placement:"bottom",title:this.l10n.stringTutoEachPuzzleTitle,content:this.l10n.stringTutoEachPuzzleContent},{element:".stage",placement:"top",title:this.l10n.stringTutoBoardTitle,content:this.l10n.stringTutoBoardContent},{element:".stage",placement:"top",title:this.l10n.stringTutoKeyBoardTitle,content:this.l10n.stringTutoKeyBoardContent},{element:"",orphan:!0,placement:"bottom",title:this.l10n.stringTutoAboutTitle,content:this.l10n.stringTutoAboutContent},{element:".footer-actions",placement:"top",title:this.l10n.stringTutoGameActionsTitle,content:this.l10n.stringTutoGameActionsContent},{element:"",orphan:!0,placement:"bottom",title:this.l10n.stringTutoScoreTitle,content:this.l10n.stringTutoScoreContent},{element:"#puzzle-category-button",placement:"bottom",title:this.l10n.stringTutoTangramCategoryTitle,content:this.l10n.stringTutoTangramCategoryContent},{element:"#random-play-button",placement:"bottom",title:this.l10n.stringTutoRandomPlayTitle,content:this.l10n.stringTutoRandomPlayContent},{element:"#level-button",placement:"bottom",title:this.l10n.stringTutoLevelTitle,content:this.l10n.stringTutoLevelContent},{element:"#timer-button",placement:"bottom",title:this.l10n.stringTutoTimerTitle,content:this.l10n.stringTutoTimerContent},{element:"#view-button",placement:"bottom",title:this.l10n.stringTutoViewTitle,content:this.l10n.stringTutoViewContent},{element:"#hint-button",placement:"bottom",title:this.l10n.stringTutoHintTitle,content:this.l10n.stringTutoHintContent}]:"dataset-list"===e.currentScreen&&"play"===e.view?t=[{element:"",orphan:!0,placement:"bottom",title:this.l10n.stringTutoExplainTitle,content:this.l10n.stringTutoExplainContent},{element:"",orphan:!0,placement:"bottom",title:this.l10n.stringTutoEachPuzzleTitle,content:this.l10n.stringTutoEachPuzzleContent},{element:"",orphan:!0,placement:"bottom",title:this.l10n.stringTutoPlayViewTitle,content:this.l10n.stringTutoPlayViewContent},{element:"#puzzle-category-button",placement:"bottom",title:this.l10n.stringTutoTangramCategoryTitle,content:this.l10n.stringTutoTangramCategoryContent},{element:"#view-button",placement:"bottom",title:this.l10n.stringTutoViewTitle,content:this.l10n.stringTutoViewContent}]:"dataset-list"===e.currentScreen&&"setting"===e.view?(document.querySelector(".dataset-list-panel-primary").scrollTo({top:0}),t=[{element:"",orphan:!0,placement:"bottom",title:this.l10n.stringTutoExplainTitle,content:this.l10n.stringTutoExplainContent},{element:"",orphan:!0,placement:"bottom",title:this.l10n.stringTutoSettingViewTitle,content:this.l10n.stringTutoSettingViewContent},{element:".tangram-card:first-child .edit-btn",placement:"auto bottom",title:this.l10n.stringTutoEditPuzzleTitle,content:this.l10n.stringTutoEditPuzzleContent},{element:".tangram-card:first-child .delete-btn",placement:"auto bottom",title:this.l10n.stringTutoDeletePuzzleTitle,content:this.l10n.stringTutoDeletePuzzleContent},{element:".dataset-list-bar-block .edit-btn",placement:"auto bottom",title:this.l10n.stringTutoEditCategoryTitle,content:this.l10n.stringTutoEditCategoryContent},{element:".dataset-list-bar-block .delete-btn",placement:"auto bottom",title:this.l10n.stringTutoDeleteCategoryTitle,content:this.l10n.stringTutoDeleteCategoryContent},{element:"#puzzle-category-button",placement:"bottom",title:this.l10n.stringTutoTangramCategoryTitle,content:this.l10n.stringTutoTangramCategoryContent},{element:"#view-button",placement:"bottom",title:this.l10n.stringTutoViewTitle,content:this.l10n.stringTutoViewContent},{element:"#create-category-button",placement:"bottom",title:this.l10n.stringTutoNewCategoryTitle,content:this.l10n.stringTutoNewCategoryContent},{element:".btn-add-puzzle",placement:"auto top",title:this.l10n.stringTutoNewPuzzleTitle,content:this.l10n.stringTutoNewPuzzleContent}]):t="setting-editor"===e.currentScreen?[{element:"",orphan:!0,placement:"bottom",title:this.l10n.stringTutoExplainTitle,content:this.l10n.stringTutoExplainContent},{element:".stage",placement:"auto left",title:this.l10n.stringTutoBoardEditorTitle,content:this.l10n.stringTutoBoardEditorContent},{element:"",orphan:!0,placement:"bottom",title:this.l10n.stringTutoValidPuzzleTitle,content:this.l10n.stringTutoValidPuzzleContent},{element:".valid-puzzle-indicator",placement:"auto left",title:this.l10n.stringTutoValidPuzzleIndicatorTitle,content:this.l10n.stringTutoValidPuzzleIndicatorContent},{element:".btn-replay",placement:"auto top",title:this.l10n.stringTutoRefreshTitle,content:this.l10n.stringTutoRefreshContent},{element:".btn-random",placement:"auto top",title:this.l10n.stringTutoRandomButtonTitle,content:this.l10n.stringTutoRandomButtonContent},{element:".btn-back",placement:"auto top",title:this.l10n.stringTutoGoBackTitle,content:this.l10n.stringTutoGoBackContent}]:[{element:"",orphan:!0,placement:"bottom",title:this.l10n.stringTutoExplainTitle,content:this.l10n.stringTutoExplainContent}],this.$refs.SugarTutorial.show(t)}}});