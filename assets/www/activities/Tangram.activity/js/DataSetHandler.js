Vue.component("data-set-handler",{name:"DataSetHandler",data:function(){return{tangramSet:[],dataSet:[],currentCategories:["Animals"],AllCategories:[],nextArr:[]}},mounted(){this.loadDataSet()},methods:{loadList:()=>new Promise((t,a)=>{requirejs(["text!../data/dataSet.json"],(function(a){t(a)}))}),loadDataSet:function(){let t=this;this.loadList().then(async a=>{a=JSON.parse(a),t.dataSet=a.data,t.AllCategories=t.dataSet.map(t=>t.name),t.loadTangramSet()})},loadTangramSet:function(){let t=this;t.tangramSet=[];for(var a=0;a<t.dataSet.length;a++)if(t.currentCategories.includes(t.dataSet[a].name))for(let e of t.dataSet[a].tangrams)t.tangramSet.push(e);t.nextArr=[...Array(t.tangramSet.length).keys()]},generateTangramFromSet:function(){0==this.nextArr.length&&(this.nextArr=[...Array(this.tangramSet.length).keys()]);let t=Math.floor(Math.random()*this.nextArr.length),a=this.nextArr[t];return this.nextArr.splice(t,1),this.buildTangramPuzzle(a)},getTangramPuzzle:function(t){let a=this.tangramSet.findIndex(a=>a.id===t);return-1===a?null:this.buildTangramPuzzle(a)},buildTangramPuzzle:function(t){if(0===this.tangramSet.length)return;let a=this.tangramSet[t],e=[];for(var n=0;n<a.targetTans.length;n++){let t=a.targetTans[n].anchor.x[0],r=a.targetTans[n].anchor.x[1],i=a.targetTans[n].anchor.y[0],d=a.targetTans[n].anchor.y[1],g=new Point(new IntAdjoinSqrt2(t,r),new IntAdjoinSqrt2(i,d)),s=new Tan(a.targetTans[n].tanType,g.dup(),a.targetTans[n].orientation);e.push(s)}let r=parseInt(a.id.substr(0,1)),i=this.dataSet.find(t=>t.id===r).name,d={id:a.id,name:a.name,tangram:new Tangram(e),category:i};return d.tangram.positionCentered(),d},addNewCategory:function(t){let a=this,e=a.dataSet.findIndex(a=>a.name===t);-1===e&&(a.dataSet.push({id:a.dataSet.length+1,name:t,tangrams:[]}),e=a.dataSet.length-1,a.AllCategories=a.dataSet.map(t=>t.name))},editCategory:function(t,a){let e=this.dataSet.findIndex(a=>a.name===t);-1!==e&&(this.dataSet[e].name=a,this.AllCategories=this.dataSet.map(t=>t.name),this.onChangeCategory([a]))},deleteCategory:function(t){let a=this.dataSet.findIndex(a=>a.name===t);-1!==a&&this.dataSet.length>1&&(this.dataSet.splice(a,1),this.AllCategories=this.dataSet.map(t=>t.name),this.onChangeCategory([this.AllCategories[0]]))},onChangeCategory:function(t){this.currentCategories=t,this.loadTangramSet()},generateId:function(t){let a=this.dataSet.findIndex(a=>a.name===t);return-1===a&&(a=this.dataSet.length),a+"#"+Date.now()},searchTangramPuzzle:function(t){let a=this;if(t.tangram&&t.tangram.outline)for(var e=0;e<a.dataSet.length;e++)if(a.dataSet[e].name===t.category)for(var n=0;n<a.dataSet[e].tangrams.length;n++)if(a.dataSet[n].tangrams[n].id===t.id)return a.dataSet[e].tangrams[n]},deleteTangramPuzzle:function(t){let a=this;if(!t)return;let e=parseInt(t.substr(0,1)),n=a.dataSet.findIndex(t=>t.id===e);if(-1!==n){let e=a.dataSet[n].tangrams.findIndex(a=>a.id===t);a.dataSet[n].tangrams.splice(e,1);let r=a.tangramSet.findIndex(a=>a.id===t);-1!==r&&a.tangramSet.splice(r,1),a.nextArr=[...Array(a.tangramSet.length).keys()],0===a.dataSet[n].tangrams.length&&(a.dataSet.splice(n,1),a.AllCategories=a.dataSet.map(t=>t.name))}},addTangramPuzzle:function(t){let a=this;if(!t.tangram||!t.tangram.outline)return;let e=a.dataSet.findIndex(a=>a.name===t.category);-1===e&&(a.dataSet.push({id:a.dataSet.length+1,name:t.category,tangrams:[]}),e=a.dataSet.length-1,a.AllCategories=a.dataSet.map(t=>t.name));let n=a.dataSet[e].id+"#"+Date.now(),r=a.createDataSetElem(t,n);return a.dataSet[e].tangrams.push(r),a.currentCategories[0]===t.category&&(a.tangramSet.push(r),a.nextArr.push(a.tangramSet.length-1)),r},editTangramPuzzle:function(t,a){let e=this;if(!t.tangram||!t.tangram.outline)return;let n=e.dataSet.findIndex(a=>a.name===t.category);if(-1===n)return e.deleteTangramPuzzle(a),e.addTangramPuzzle(t);let r=e.createDataSetElem(t,a),i=e.dataSet[n].tangrams.findIndex(t=>t.id===a);if(-1===i)return e.addTangramPuzzle(t);e.dataSet[n].tangrams[i]=r;let d=e.tangramSet.findIndex(t=>t.id===a);return e.tangramSet[d]=r,r},createDataSetElem:function(t,a){let e={id:a,name:t.name,targetTans:[]};for(var n=0;n<t.tangram.tans.length;n++){let a=t.tangram.tans[n];e.targetTans.push({anchor:{x:[a.anchor.x.coeffInt,a.anchor.x.coeffSqrt],y:[a.anchor.y.coeffInt,a.anchor.y.coeffSqrt]},tanType:a.tanType,orientation:a.orientation})}return e}}});