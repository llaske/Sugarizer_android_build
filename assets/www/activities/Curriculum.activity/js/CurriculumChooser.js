define(["mustache"],(function(t){var e={stringHolderSearchCurriculum:""},i={id:"curriculum-button",title:"Curriculum",icon:"activity/activity-icon.svg",beforeActivate:function(){document.getElementById("favorite-button").style.visibility="hidden",i.curriculumInit(i.curriculumFill)},beforeUnactivate:function(){document.getElementById("favorite-button").style.visibility="visible"},onFavorite:function(){},onScroll:function(){var t=document.getElementById("journal-container");t.scrollTop/(t.scrollHeight-t.clientHeight)>.9&&(i.resultCount+=30,i.curriculumDisplay(i.results,i.resultCount))},onSearch:function(){i.curriculumFill()},onCancelSearch:function(){i.curriculumFill()},fileformat:".jpg",filelocation:"images/skills/",mimetype:"image/png",curriculumInit:function(t){app.$refs.SugarL10n.localize(e),i.database={},document.getElementById("journal-empty").style.visibility="visible",i.placeholder=e.stringHolderSearchCurriculum,i.baseURL=document.location.href.substr(0,document.location.href.indexOf("/activities/"))+"/activities/Curriculum.activity/",requirejs(["text!../defaultTemplates/Kindergarten.json"],(function(e){for(var n=(e=JSON.parse(e)).categories,r=[],l=0;l<n.length;l++)for(var a=0;a<n[l].skills.length;a++)r.push({code:n[l].skills[a].image,text:app.$refs.SugarL10n.get(n[l].skills[a].title)});r.sort((function(t,e){return t.text.localeCompare(e.text,"en",{sensitivity:"base"})}));var o=[];for(l=0;l<r.length;l++)r[l].id=l,o.push(r[l]);i.database.content=o,t()}))},curriculumFill:function(){var t=i.database.content,e=document.getElementById("search-text").value.toLowerCase();if(e.length){t=[];for(var n=0;n<i.database.content.length;n++)-1!=i.database.content[n].text.toLowerCase().indexOf(e)&&t.push(i.database.content[n])}i.results=t,i.resultCount=30,i.curriculumDisplay(t,i.resultCount)},curriculumDisplay:function(e,n){var r={items:e.slice(0,n)},l=t.render("\t\t\t{{#items}}\t\t\t<div id='entry_{{id}}' style='height:60px'>\t\t\t\t<div id='eicon_{{id}}' class='toolbutton' style='background-image:url(../../activities/MediaViewer.activity/activity/activity-icon.svg);background-size:40px 40px;width:40px;height:40px;display:inline-block;margin-left:20px;margin-top:5px;'></div>\t\t\t\t<div id='etext_{{id}}' style='color:black;display:inline-block;vertical-align:middle;margin-left:30px;height:60px;margin-top:10px;font-weight:bold;font-size:14px;'>{{text}}</div>\t\t\t</div>\t\t\t{{/items}}\t\t",r);document.getElementById("journal-empty").style.visibility=0!=e.length?"hidden":"visible",document.getElementById("journal-container").innerHTML=l;for(var a=Math.min(n,e.length),o=0;o<a;o++){document.getElementById("entry_"+e[o].id).addEventListener("click",(function(t){var e=t.target.id;e=e.substr(e.indexOf("_")+1),document.getElementById("entry_"+e).style.backgroundColor="#808080";var n={metadata:{mimetype:i.mimetype,title:i.database.content[e].text+i.fileformat,activity:"org.olpcfrance.Curriculum",timestamp:(new Date).getTime(),creation_time:(new Date).getTime(),file_size:0},path:i.database.content[e].code};requirejs(["sugar-web/graphics/journalchooser"],(function(t){t.close(n)}))})),"image/png"==i.mimetype&&(document.getElementById("eicon_"+e[o].id).style.backgroundImage="url("+i.baseURL+e[o].code+")")}}};return i}));