/*! Sugarizer 2019-01-12 */
define(["activity/data-model","webL10n"],function(a,b){"use strict";function c(){var b=null,c=null;m.strokeStyle="black",m.fillStyle="black",m.fillRect(0,0,j,j),a.phase_of_moon<.25?(b=a.phase_of_moon-Math.abs(Math.sin(a.phase_of_moon*Math.PI*4)/18),c=1-4*b,m.fillStyle="white",m.fillRect(k,0,k,j),m.fillStyle="black",f(k-j*c/2,0,j*c,j,0,3*Math.PI/2,Math.PI/2),m.fill()):a.phase_of_moon<.5?(b=a.phase_of_moon+Math.abs(Math.sin(a.phase_of_moon*Math.PI*4)/18),c=4*(b-.25),m.fillStyle="white",m.fillRect(k,0,k,j),m.fillStyle="white",f(k-j*c/2,0,j*c,j,0,Math.PI/2,3*Math.PI/2),m.fill()):a.phase_of_moon<.75?(b=a.phase_of_moon-Math.abs(Math.sin(a.phase_of_moon*Math.PI*4)/18),c=1-4*(b-.5),m.fillStyle="white",m.fillRect(0,0,k,j),m.fillStyle="white",f(k-j*c/2,0,j*c,j,0,3*Math.PI/2,Math.PI/2),m.fill()):(b=a.phase_of_moon+Math.abs(Math.sin(a.phase_of_moon*Math.PI*4)/18),c=4*(b-.75),m.fillStyle="white",m.fillRect(0,0,k,j),m.fillStyle="black",f(k-j*c/2,0,j*c,j,0,Math.PI/2,3*Math.PI/2),m.fill()),m.save(),m.globalCompositeOperation="multiply",m.drawImage(n,0,0,j,j),m.globalAlpha=.5,m.globalCompositeOperation="source-over",m.drawImage(n,0,0,j,j),m.restore(),d()}function d(){if((-1!==a.next_lunar_eclipse_sec||a.last_lunar_eclipse_sec<=7200)&&(a.next_lunar_eclipse_sec<=7200||-1!==a.last_lunar_eclipse_sec)&&Math.min(a.next_lunar_eclipse_sec,a.last_lunar_eclipse_sec)<=7200){var b;b=-1==a.next_lunar_eclipse_sec?a.last_lunar_eclipse_sec/7200:-1==a.last_lunar_eclipse_sec?a.next_lunar_eclipse_sec/7200:Math.min(a.next_lunar_eclipse_sec,a.last_lunar_eclipse_sec)/7200,m.save(),m.globalAlpha=.25*(1-b),m.globalCompositeOperation="multiply",m.fillStyle="red",m.fillRect(0,0,j,j),m.restore()}}function e(a){var b=.08*j;m.font="16px Sans",m.lineWidth=3,m.fillStyle="blue",h(k+1,k,26,22,"0°"),h(k+1,.5*k,36,22,"30°"),h(k+1,1.5*k,36,22,"30°"),h(k+1,.15*k,36,22,"60°"),h(k+1,1.85*k,36,22,"60°"),m.fillStyle="red",h(.48*k,k,36,22,"30°"),h(1.52*k,k,36,22,"30°"),h(.15*k,k,36,22,"60°"),h(1.85*k,k,36,22,"60°"),m.strokeStyle="blue",g(0,k,j,k),g(.15*k,.5*k,j-.15*k,.5*k),g(.15*k,1.5*k,j-.15*k,1.5*k),g(.5*k,.15*k,j-.5*k,.15*k),g(.5*k,1.85*k,j-.5*k,1.85*k),m.strokeStyle="red",g(k,0,k,j),f(.15*k,0,j-.15*j,j,0,0,2*Math.PI),f(.48*k,0,j-.48*j,j,0,0,2*Math.PI),m.fillStyle="red",m.fillRect(16,b,b,4),m.fillText(a[3],0,b+8),m.fillText(a[2],b+16+4,b+8),m.fillText(o("Longitude"),0,j-16),m.fillStyle="blue",m.fillRect(.5*b+16,.5*b,4,b),m.fillText(a[0],.5*b+16-4,.5*b-8),m.fillText(a[1],.5*b+16-4,1.5*b+16+4),m.fillText(o("Latitude"),0,j-40)}function f(a,b,c,d,e,f,g,h){m.beginPath(),a+=c/2,b+=d/2;var i=c/2,j=d/2;m.ellipse(a,b,i,j,e,f,g,h),m.stroke()}function g(a,b,c,d){m.beginPath(),m.moveTo(a,b),m.lineTo(c,d),m.stroke()}function h(a,b,c,d,e){var f=m.fillStyle;m.fillRect(a,b,c,d),m.fillStyle="white",m.fillText(e,a+5,b+18),m.fillStyle=f}function i(a){j=a,k=.5*j}var j,k,l=document.querySelector("canvas"),m=l.getContext("2d"),n=document.querySelector("img#moon"),o=b.get;return m.ellipse||(m.ellipse=function(a,b,c,d,e,f,g,h){a-=c,b-=d,c*=2,d*=2;var i=.5522848,j=c/2*i,k=d/2*i,l=a+c,n=b+d,o=a+c/2,p=b+d/2;f===Math.PI/2&&g===3*Math.PI/2?(m.moveTo(o,n),m.bezierCurveTo(o-j,n,a,p+k,a,p),m.bezierCurveTo(a,p-k,o-j,b,o,b)):f===3*Math.PI/2&&g===Math.PI/2?(m.moveTo(o,b),m.bezierCurveTo(o+j,b,l,p-k,l,p),m.bezierCurveTo(l,p+k,o+j,n,o,n)):0===f&&g===2*Math.PI&&(m.moveTo(l,p),m.bezierCurveTo(l,p+k,o+j,n,o,n),m.bezierCurveTo(o-j,n,a,p+k,a,p),m.bezierCurveTo(a,p-k,o-j,b,o,b),m.bezierCurveTo(o+j,b,l,p-k,l,p))}),{moon:c,eclipse:d,grid:e,setImageSize:i}});