/*! Sugarizer 2020-03-14 */
var entriesByGame=4;enyo.kind({name:"Abcd.Play",kind:enyo.Control,classes:"board",published:{context:null},components:[{kind:"Signals",onEndOfSound:"endSound"},{components:[{name:"colorBar",classes:"colorBar"},{name:"home",kind:"Abcd.HomeButton"},{kind:"Abcd.CaseButton"},{kind:"Abcd.LanguageButton"}]},{components:[{name:"filterLetter",kind:"Abcd.Letter",letter:"",classes:"filterLetter"},{name:"filterCollection",kind:"Abcd.Collection",index:0,classes:"filterCollection",showing:!1},{name:"itemCount",content:"-/-",classes:"itemCount",showing:!1},{name:"back",kind:"Image",src:"images/back.png",showing:!1,classes:"standardButton backButton",ontap:"backTaped"},{name:"filter",kind:"Image",src:"images/filter.png",showing:!1,classes:"standardButton filterButton",ontap:"filterTaped"},{name:"check",kind:"Image",src:"images/check.png",showing:!1,classes:"standardButton checkButton",ontap:"checkTaped"},{name:"gameFinished",kind:"Control",showing:!1,classes:"gameFinished",components:[{name:"gameFinishedMsg",content:"",classes:"gameFinsihed-message"},{classes:"gameFinished-controls",components:[{name:"replay",kind:"Image",src:"images/redo.svg",classes:"standardButton replayButton",ontap:"replayTaped"},{name:"backToSelection",kind:"Image",src:"images/back.png",classes:"standardButton backButton backSelection",ontap:"backToSelectionTaped"}]}]}]},{name:"box",classes:"playbox",components:[]},{name:"filterPopup",kind:"Abcd.FilterPopup",onFilterChanged:"filterChanged"}],create:function(){this.inherited(arguments),this.theme=-1,this.themeButton=null,this.gamecount=0,this.playing=null,this.from=null,this.selected=null,this.forbidentry=!1,this.filter=null,this.restoreContext(),this.filterChanged({filter:this.filter}),-1!=this.theme?this.doGame(this.themeButton):this.displayButtons(),this.gamecount===entriesByGame&&this.showGameFinished()},restoreContext:function(){if(null!=this.context&&""!=this.context){var a=this.context.split("|");this.theme=a[0],this.gamecount=parseInt(a[1]),this.themeButton={from:a[2],to:a[3]},""!=a[4]&&(this.filter={kind:a[4],index:a[5],letter:a[5]})}},saveContext:function(){var a=[];return a.push(this.theme),a.push(this.gamecount),null!=this.themeButton?(a.push(this.themeButton.from),a.push(this.themeButton.to)):(a.push(""),a.push("")),null!=this.filter?(a.push(this.filter.kind),a.push("Abcd.Letter"==this.filter.kind?this.filter.letter:this.filter.index)):(a.push(""),a.push("")),a.join("|")},cleanBox:function(){var a=[];enyo.forEach(this.$.box.getControls(),function(b){a.push(b)});for(var b=0;b<a.length;b++)a[b].destroy()},displayButtons:function(){this.cleanBox(),Abcd.changeVisibility(this,{home:!0,back:!1,filter:!0,check:!1,itemCount:!1}),this.$.colorBar.removeClass("themeColor"+this.theme),this.theme=-1,this.$.colorBar.addClass("themeColor"+this.theme),null==this.filter&&this.$.filterLetter.hide(),this.$.box.createComponent({kind:"Abcd.PlayTypeButton",from:"picture",to:"letter"+Abcd.context.casevalue,ontap:"doGame",theme:"play-button-color1"},{owner:this}).render(),this.$.box.createComponent({kind:"Abcd.PlayTypeButton",from:"picture",to:"listen",ontap:"doGame",theme:"play-button-color1"},{owner:this}).render(),this.$.box.createComponent({kind:"Abcd.PlayTypeButton",from:"letter"+Abcd.context.casevalue,to:"picture",ontap:"doGame",theme:"play-button-color2"},{owner:this}).render(),this.$.box.createComponent({kind:"Abcd.PlayTypeButton",from:"letter"+Abcd.context.casevalue,to:"listen",ontap:"doGame",theme:"play-button-color2"},{owner:this}).render(),this.$.box.createComponent({kind:"Abcd.PlayTypeButton",from:"listen",to:"picture",ontap:"doGame",theme:"play-button-color3"},{owner:this}).render(),this.$.box.createComponent({kind:"Abcd.PlayTypeButton",from:"listen",to:"letter"+Abcd.context.casevalue,ontap:"doGame",theme:"play-button-color3"},{owner:this}).render()},setLocale:function(){this.filter=null,this.$.filterLetter.hide(),this.$.filterCollection.hide(),-1!=this.theme&&this.computeGame()},setCase:function(){enyo.forEach(this.$.box.getControls(),function(a){"Abcd.Entry"==a.kind?a.indexChanged():a.setCase()}),null!=this.filter&&("Abcd.Letter"==this.filter.kind?this.$.filterLetter.letterChanged():this.$.filterCollection.indexChanged())},filterTaped:function(){this.$.filterPopup.display(this.filter)},filterChanged:function(a,b){this.filter=a.filter,this.$.filterLetter.hide(),this.$.filterCollection.hide(),null!=this.filter&&("Abcd.Letter"==this.filter.kind?(this.$.filterLetter.show(),this.$.filterLetter.setLetter(this.filter.letter)):(this.$.filterCollection.show(),this.$.filterCollection.setIndex(this.filter.index)))},convertToEntryOption:function(a){return{soundonly:"listen"==a,imageonly:"picture"==a,textonly:"letter"==a.substr(0,6)}},doGame:function(a,b){Abcd.changeVisibility(this,{home:!1,back:!0,filter:!1,check:!0,itemCount:!0}),this.themeButton=a,"picture"==this.themeButton.from?this.theme=5:"listen"==this.themeButton.from?this.theme=7:this.theme=6,this.$.colorBar.removeClass("themeColor-1"),this.$.colorBar.addClass("themeColor"+this.theme),this.computeGame()},computeGame:function(){this.cleanBox(),this.forbidentry=!1,this.$.itemCount.setContent(this.gamecount+1+"/"+entriesByGame);var a=Abcd.randomEntryIndex(void 0,this.filter),b=this.convertToEntryOption(this.themeButton.from),c=this.from=this.$.box.createComponent({kind:"Abcd.Entry",index:a,soundonly:b.soundonly,imageonly:b.imageonly,textonly:b.textonly,ontap:"entryTaped"},{owner:this});c.addClass("entryPlayFrom"),c.render(),b.soundonly&&(this.playing=c,this.playing.play(Abcd.sound));var d=[];d.push(a);for(var e=0;e<2;e++){var f=Abcd.randomEntryIndex(d,this.filter);d.push(f)}d=Abcd.mix(d);for(var g=d.length,e=0;e<g;e++){b=this.convertToEntryOption(this.themeButton.to);var h=this.$.box.createComponent({kind:"Abcd.Entry",index:d[e],soundonly:b.soundonly,imageonly:b.imageonly,textonly:b.textonly,ontap:"entryTaped"},{owner:this});h.addClass("entryPlayTo"),h.render()}Abcd.saveContext()},entryTaped:function(a,b){this.forbidentry||(a.soundonly&&(null!=this.playing&&this.playing.abort(),this.playing=a,this.playing.play(Abcd.sound)),a.hasClass("entryPlayFrom")||a.hasClass("entryPlaySelected")||(null!=this.selected&&this.selected.removeClass("entryPlaySelected"),a.addClass("entryPlaySelected"),this.selected=a))},showGameFinished:function(){this.cleanBox(),Abcd.changeVisibility(this,{home:!1,back:!1,filter:!1,check:!1,itemCount:!1}),Abcd.hideLang(),this.$.caseButton.hide();var a=this;requirejs(["webL10n"],function(b){a.$.gameFinishedMsg.setContent(b.get("GameFinised"))}),this.$.gameFinished.show()},hideGameFinished:function(){this.$.gameFinished.hide(),Abcd.showLang(),this.$.caseButton.show()},replayTaped:function(){this.hideGameFinished(),Abcd.changeVisibility(this,{home:!1,back:!0,filter:!1,check:!0,itemCount:!0}),this.gamecount=0,this.computeGame()},backToSelectionTaped:function(){this.hideGameFinished(),this.backTaped()},backTaped:function(){this.$.colorBar.removeClass("themeColor"+this.theme),this.theme=-1,this.gamecount=0,this.selected=null,this.displayButtons()},checkTaped:function(){this.forbidentry=!0,null!=this.playing&&this.playing.abort(),null==this.selected?(Abcd.sound.play("audio/disappointed"),this.selected=this.from,this.selected.addClass("entryPlayWrong")):this.selected.index==this.from.index?(Abcd.sound.play("audio/applause"),this.selected.removeClass("entryPlaySelected"),this.selected.addClass("entryPlayRight")):(Abcd.sound.play("audio/disappointed"),this.selected.removeClass("entryPlaySelected"),this.selected.addClass("entryPlayWrong"))},endSound:function(a,b){null!=this.selected&&("audio/disappointed"==b.sound?(this.selected.removeClass("entryPlaySelected"),this.selected.removeClass("entryPlayWrong"),this.selected=null,this.forbidentry=!1):"audio/applause"==b.sound&&(this.selected.removeClass("entryPlaySelected"),this.selected.removeClass("entryPlayRight"),this.selected=null,++this.gamecount==entriesByGame?this.showGameFinished():this.computeGame()))}});