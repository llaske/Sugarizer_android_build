define(["sugar-web/activity/activity","sugar-web/datastore","sugar-web/env"],(function(e,t,n){requirejs(["domReady!"],(function(t){e.setup();var o=document.getElementById("stop-button"),a=o.cloneNode(!0);document.getElementById("main-toolbar").replaceChild(a,o),a.addEventListener("click",(function(t){document.getElementById("myBlocks").addEventListener("click",(function(t){console.log("writing...");var n=document.getElementById("myBlocks").value;e.getDatastoreObject().setDataAsText(n),e.getDatastoreObject().save((function(t){null===t?console.log("write done."):console.log("write failed."),window.onbeforeunload=null,e.close()}))}));for(var n=!1,o=0;o<document.body.getElementsByTagName("span").length;o++){var a=document.getElementsByTagName("span")[o];if("Save to Sugarizer"==a.innerHTML){a.click(),n=!0;break}}console.log(n?"Call saved successfully":"Unable to save")})),n.getEnvironment((function(t,n){n.objectId&&e.getDatastoreObject().loadAsText((function(e,t,n){if(null==e&&null!=n){for(var o=!1,a=0;a<document.body.getElementsByTagName("span").length;a++){if("Load from Sugarizer"==document.getElementsByTagName("span")[a].innerHTML){document.getElementById("myBlocks").value=n,o=!0;break}}console.log(o?"Loaded successfully":"Unable to load")}}))}))}))}));