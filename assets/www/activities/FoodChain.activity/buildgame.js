FoodChain.buildLevels=[{size:2,time:2},{size:3,time:5},{size:3,time:3},{size:3,time:2},{size:4,time:5},{size:4,time:3},{size:5,time:3}],enyo.kind({name:"FoodChain.BuildGame",kind:enyo.Control,published:{level:1},classes:"board",components:[{name:"cards",components:[{components:[{classes:"level-zone",components:[{name:"textlevel",classes:"title level-value"},{name:"level",content:"0",classes:"title level-value"}]},{classes:"score-zone",components:[{name:"textscore",classes:"title score-text"},{name:"score",content:"0000",classes:"title score-value"},{name:"timercount",content:"0:0,0",classes:"title timer-value"}]}]},{name:"gamebox",classes:"box",ontap:"unselect",ondrop:"drop",ondragover:"dragover",components:[]},{name:"validate",kind:"ShadowButton",img:"validate",classes:"validate",ontap:"controlOrder"},{name:"play",kind:"ShadowButton",img:"play",classes:"play",ontap:"play"},{name:"pause",kind:"ShadowButton",img:"pause",classes:"play",ontap:"pause"},{name:"restart",kind:"ShadowButton",img:"restart",classes:"restart",ontap:"restart"},{name:"forward",kind:"ShadowButton",img:"forward",classes:"restart",ontap:"next"},{name:"home",kind:"ShadowButton",img:"home",classes:"home",ontap:"home"},{kind:"enyo.Signals",onEndOfSound:"endSound"}]}],create:function(){this.inherited(arguments),this.previous=null,this.mixed=null,this.createComponent({name:"timer",kind:"Timer",paused:!0,onTriggered:"updateTimer"},{owner:this}),this.setLocale(),this.$.score.setContent(String("0000"+FoodChain.context.score).slice(-4)),FoodChain.context.game=this.kindName,this.levelChanged()},setLocale:function(){this.$.textlevel.setContent(__$FC("level")),this.$.textscore.setContent(__$FC("score")),enyo.forEach(this.$.gamebox.getControls(),(function(e){e.setLocale()}))},levelChanged:function(){FoodChain.context.level=this.level;var e=[];enyo.forEach(this.$.gamebox.getControls(),(function(t){e.push(t)}));for(var t=0;t<e.length;t++)e[t].destroy();if(null==this.mixed){var s;do{if(this.chain=FoodChain.randomChain(FoodChain.buildLevels[this.level-1].size),null==this.previous||this.previous.length!=this.chain.length)s=!1;else{s=!0;for(t=0;s&&t<this.chain.length;t++)this.previous[t]!=this.chain[t]&&(s=!1)}}while(s);this.mixed=FoodChain.mix(this.chain)}var i=99/this.mixed.length,o=5-this.mixed.length;this.cards=[];for(t=0;t<this.mixed.length;t++){this.cards.push(this.$.gamebox.createComponent({kind:"FoodChain.Card",cardname:this.mixed[t],x:o+"%",y:8,ontap:"taped",ondragstart:"dragstart",ondragfinish:"dragfinish"},{owner:this})),0==t?FoodChain.sound.play(this.cards[t].sound):this.cards[t].hide(),o+=i}this.dragobject=null,this.selectedobject=null,this.zmax=0,this.$.gamebox.removeClass("box-win"),this.$.gamebox.removeClass("box-lost"),FoodChain.saveContext(),this.$.play.hide(),this.$.pause.show(),this.$.validate.show(),this.$.restart.hide(),this.$.forward.hide(),this.$.home.hide(),this.$.level.setContent(" "+this.level),this.timecount={mins:0,secs:0,tenth:0},this.$.timercount.removeClass("timer-overtime"),this.displayTimer(),this.$.timer.pause(),this.render()},endSound:function(e,t){if(null!=this.cards){for(var s=0;s<this.cards.length;s++)if(null!=this.cards[s]&&FoodChain.soundMatch(this.cards[s].sound,t.sound)&&(this.cards[s]=null,s+1<this.cards.length))return this.cards[s+1].show(),void FoodChain.sound.play(this.cards[s+1].sound);this.cards=null,this.$.timer.resume()}},displayTimer:function(){this.$.timercount.setContent(this.timecount.mins+":"+String("00"+this.timecount.secs).slice(-2)+","+this.timecount.tenth)},updateTimer:function(e,t){(this.timecount.tenth=this.timecount.tenth+1,10==this.timecount.tenth)&&(this.timecount.tenth=0,this.timecount.secs=this.timecount.secs+1,60*this.timecount.mins+this.timecount.secs>=FoodChain.buildLevels[this.level-1].time&&this.$.timercount.addClass("timer-overtime"),60==this.timecount.secs&&(this.timecount.secs=0,this.timecount.mins=this.timecount.mins+1));this.displayTimer()},taped:function(e,t){if(this.$.timer.paused)return!0;if(FoodChain.log(e.cardname+" taped"),null==this.selectedobject)return this.selectedobject=e,e.addClass("card-dragged"),FoodChain.sound.play(e.sound),this.toTop(e),!0;if(e!=this.selectedobject){var s=this.selectedobject.getX(),i=this.selectedobject.getY(),o=e.getX(),n=e.getY();return this.selectedobject.moveTo(o,n),e.moveTo(s,i),this.selectedobject.removeClass("card-dragged"),this.selectedobject=null,!0}},unselect:function(){null!=this.selectedobject&&(this.selectedobject.removeClass("card-dragged"),this.selectedobject=null)},dragstart:function(e,t){if(this.$.timer.paused)return!0;e.addClass("card-dragged"),this.$.gamebox.addClass("box-dragging"),FoodChain.sound.play(e.sound),this.dragobject=e,this.selectedobject=null,this.dragx=0,this.dragy=t.clientY-e.y,this.toTop(this.dragobject)},dragfinish:function(e,t){e.removeClass("card-dragged"),this.$.gamebox.removeClass("box-dragging")},dragover:function(e,t){return null==this.dragobject||(t.preventDefault(),!1)},drop:function(e,t){if(null==this.dragobject||this.$.timer.paused)return!0;t.preventDefault(),this.dragobject.moveTo(t.clientX/window.innerWidth*100+"%",t.clientY-this.dragy),this.dragobject=null},toTop:function(e){this.zmax=this.zmax+1,e.applyStyle("z-index",this.zmax)},controlOrder:function(){this.$.timer.pause(),this.$.play.hide(),this.$.pause.hide(),this.$.validate.hide();var e=[];enyo.forEach(this.$.gamebox.getControls(),(function(t){e.push(t)})),e=e.sort((function(e,t){return e.x.replace("%","")-t.x.replace("%","")}));for(var t=!0,s=0;t&&s<this.chain.length;s++)e[s].cardname!=this.chain[s]&&(t=!1);t?(FoodChain.sound.play("audio/applause"),this.$.gamebox.addClass("box-win"),this.computeScore(),this.$.home.show(),this.level!=FoodChain.buildLevels.length&&this.$.forward.show()):(FoodChain.sound.play("audio/disappointed"),this.$.gamebox.addClass("box-lost"),this.$.home.show(),this.$.restart.show())},computeScore:function(){var e=10,t=60*this.timecount.mins+this.timecount.secs;t<FoodChain.buildLevels[this.level-1].time&&(e+=FoodChain.buildLevels[this.level-1].time-t),FoodChain.context.score+=e,this.$.score.setContent(String("0000"+FoodChain.context.score).slice(-4))},play:function(){enyo.forEach(this.$.gamebox.getControls(),(function(e){e.show()})),this.$.timer.resume(),this.$.play.hide(),this.$.pause.show(),this.$.home.hide()},pause:function(){enyo.forEach(this.$.gamebox.getControls(),(function(e){e.hide()})),this.$.timer.pause(),this.$.pause.hide(),this.$.play.show(),this.$.home.show()},restart:function(){this.levelChanged()},next:function(){this.level=this.level+1,this.previous=this.chain,this.mixed=null,this.levelChanged()},home:function(){this.$.timer.stop(),FoodChain.goHome()}});