/*! Sugarizer 2020-03-14 */
enyo.kind({name:"enyo.Panels",classes:"enyo-panels",published:{index:0,draggable:!0,animate:!0,wrap:!1,arrangerKind:"CardArranger",narrowFit:!0},events:{onTransitionStart:"",onTransitionFinish:""},handlers:{ondragstart:"dragstart",ondrag:"drag",ondragfinish:"dragfinish"},tools:[{kind:"Animator",onStep:"step",onEnd:"completed"}],fraction:0,create:function(){this.transitionPoints=[],this.inherited(arguments),this.arrangerKindChanged(),this.avoidFitChanged(),this.indexChanged()},initComponents:function(){this.createChrome(this.tools),this.inherited(arguments)},arrangerKindChanged:function(){this.setLayoutKind(this.arrangerKind)},avoidFitChanged:function(){this.addRemoveClass("enyo-panels-fit-narrow",this.narrowFit)},removeControl:function(a){this.inherited(arguments),this.controls.length>1&&this.isPanel(a)&&(this.setIndex(Math.max(this.index-1,0)),this.flow(),this.reflow())},isPanel:function(){return!0},flow:function(){this.arrangements=[],this.inherited(arguments)},reflow:function(){this.arrangements=[],this.inherited(arguments),this.refresh()},getPanels:function(){return(this.controlParent||this).children},getActive:function(){return this.getPanels()[this.index]},getAnimator:function(){return this.$.animator},setIndex:function(a){this.setPropertyValue("index",a,"indexChanged")},setIndexDirect:function(a){this.setIndex(a),this.completed()},previous:function(){this.setIndex(this.index-1)},next:function(){this.setIndex(this.index+1)},clamp:function(a){var b=this.getPanels().length-1;return this.wrap?a:Math.max(0,Math.min(a,b))},indexChanged:function(a){this.lastIndex=a,this.index=this.clamp(this.index),this.dragging||(this.$.animator.isAnimating()&&this.completed(),this.$.animator.stop(),this.hasNode()&&(this.animate?(this.startTransition(),this.$.animator.play({startValue:this.fraction})):this.refresh()))},step:function(a){this.fraction=a.value,this.stepTransition()},completed:function(){this.$.animator.isAnimating()&&this.$.animator.stop(),this.fraction=1,this.stepTransition(),this.finishTransition()},dragstart:function(a,b){if(this.draggable&&this.layout&&this.layout.canDragEvent(b))return b.preventDefault(),this.dragstartTransition(b),this.dragging=!0,this.$.animator.stop(),!0},drag:function(a,b){this.dragging&&(b.preventDefault(),this.dragTransition(b))},dragfinish:function(a,b){this.dragging&&(this.dragging=!1,b.preventTap(),this.dragfinishTransition(b))},dragstartTransition:function(a){if(this.$.animator.isAnimating())this.verifyDragTransition(a);else{var b=this.fromIndex=this.index;this.toIndex=b-(this.layout?this.layout.calcDragDirection(a):0)}this.fromIndex=this.clamp(this.fromIndex),this.toIndex=this.clamp(this.toIndex),this.fireTransitionStart(),this.layout&&this.layout.start()},dragTransition:function(a){var b=this.layout?this.layout.calcDrag(a):0,c=this.transitionPoints,d=c[0],e=c[c.length-1],f=this.fetchArrangement(d),g=this.fetchArrangement(e),h=this.layout?this.layout.drag(b,d,f,e,g):0,i=b&&!h;this.fraction+=h;var j=this.fraction;(j>1||j<0||i)&&((j>0||i)&&this.dragfinishTransition(a),this.dragstartTransition(a),this.fraction=0),this.stepTransition()},dragfinishTransition:function(a){this.verifyDragTransition(a),this.setIndex(this.toIndex),this.dragging&&this.fireTransitionFinish()},verifyDragTransition:function(a){var b=this.layout?this.layout.calcDragDirection(a):0,c=Math.min(this.fromIndex,this.toIndex),d=Math.max(this.fromIndex,this.toIndex);if(b>0){var e=c;c=d,d=e}c!=this.fromIndex&&(this.fraction=1-this.fraction),this.fromIndex=c,this.toIndex=d},refresh:function(){this.$.animator.isAnimating()&&this.$.animator.stop(),this.startTransition(),this.fraction=1,this.stepTransition(),this.finishTransition()},startTransition:function(){this.fromIndex=null!=this.fromIndex?this.fromIndex:this.lastIndex||0,this.toIndex=null!=this.toIndex?this.toIndex:this.index,this.layout&&this.layout.start(),this.fireTransitionStart()},finishTransition:function(){this.layout&&this.layout.finish(),this.transitionPoints=[],this.fraction=0,this.fromIndex=this.toIndex=null,this.fireTransitionFinish()},fireTransitionStart:function(){var a=this.startTransitionInfo;!this.hasNode()||a&&a.fromIndex==this.fromIndex&&a.toIndex==this.toIndex||(this.startTransitionInfo={fromIndex:this.fromIndex,toIndex:this.toIndex},this.doTransitionStart(enyo.clone(this.startTransitionInfo)))},fireTransitionFinish:function(){var a=this.finishTransitionInfo;!this.hasNode()||a&&a.fromIndex==this.lastIndex&&a.toIndex==this.index||(this.finishTransitionInfo={fromIndex:this.lastIndex,toIndex:this.index},this.doTransitionFinish(enyo.clone(this.finishTransitionInfo))),this.lastIndex=this.index},stepTransition:function(){if(this.hasNode()){var a=this.transitionPoints,b=(this.fraction||0)*(a.length-1),c=Math.floor(b);b-=c;var d=a[c],e=a[c+1],f=this.fetchArrangement(d),g=this.fetchArrangement(e);this.arrangement=f&&g?enyo.Panels.lerp(f,g,b):f||g,this.arrangement&&this.layout&&this.layout.flowArrangement()}},fetchArrangement:function(a){return null!=a&&!this.arrangements[a]&&this.layout&&(this.layout._arrange(a),this.arrangements[a]=this.readArrangement(this.getPanels())),this.arrangements[a]},readArrangement:function(a){for(var b,c=[],d=0,e=a;b=e[d];d++)c.push(enyo.clone(b._arranger));return c},statics:{isScreenNarrow:function(){return enyo.dom.getWindowWidth()<=800},lerp:function(a,b,c){for(var d,e=[],f=0,g=enyo.keys(a);d=g[f];f++)e.push(this.lerpObject(a[d],b[d],c));return e},lerpObject:function(a,b,c){var d,e,f=enyo.clone(a);if(b)for(var g in a)d=a[g],e=b[g],d!=e&&(f[g]=d-(d-e)*c);return f}}});