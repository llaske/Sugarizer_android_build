/*! Sugarizer 2020-03-14 */
FoodChain.learnLevels=[{size:2,count:5,time:10},{size:2,count:10,time:15},{size:2,count:15,time:20},{size:3,count:5,time:10},{size:3,count:10,time:15},{size:3,count:15,time:20}],enyo.kind({name:"FoodChain.LearnGame",kind:enyo.Control,published:{level:1},classes:"board",components:[{name:"cards",components:[{components:[{classes:"level-zone",components:[{name:"textlevel",classes:"title level-value"},{name:"level",content:"0",classes:"title level-value"}]},{classes:"score-zone",components:[{name:"textscore",classes:"title score-text"},{name:"score",content:"0000",classes:"title score-value"},{name:"timercount",content:"0:0,0",classes:"title timer-value"}]}]},{name:"startbox",classes:"start-box",components:[]},{components:[{name:"herbbox",classes:"end-box",ontap:"chooseAsEnd",ondrop:"drop",ondragover:"dragover",components:[{name:"herbname",classes:"box-name herb-color"}]},{name:"carnbox",classes:"end-box",ontap:"chooseAsEnd",ondrop:"drop",ondragover:"dragover",components:[{name:"carnname",classes:"box-name"}]},{name:"omnibox",classes:"end-box omni-box-two",ontap:"chooseAsEnd",ondrop:"drop",ondragover:"dragover",components:[{name:"omniname",classes:"box-name"}]}]},{name:"play",kind:"ShadowButton",img:"play",classes:"play",ontap:"play"},{name:"pause",kind:"ShadowButton",img:"pause",classes:"play",ontap:"pause"},{name:"forward",kind:"ShadowButton",img:"forward",classes:"restart",ontap:"next"},{name:"home",kind:"ShadowButton",img:"home",classes:"home",ontap:"home"},{kind:"Signals",onEndOfSound:"endSound"}]}],create:function(){this.inherited(arguments),this.cardlist=null,this.nextaction=0,this.createComponent({name:"timer",kind:"Timer",paused:!0,onTriggered:"updateTimer"},{owner:this}),this.setLocale(),this.$.score.setContent(String("0000"+FoodChain.context.score).slice(-4)),FoodChain.context.game=this.kindName,this.levelChanged()},setLocale:function(){this.$.textlevel.setContent(__$FC("level")),this.$.textscore.setContent(__$FC("score")),this.$.herbname.setContent(__$FC(FoodChain.feedStrategy[0].name)),this.$.carnname.setContent(__$FC(FoodChain.feedStrategy[1].name)),this.$.omniname.setContent(__$FC(FoodChain.feedStrategy[2].name)),enyo.forEach(this.$.startbox.getControls(),function(a){a.setLocale()})},levelChanged:function(){FoodChain.context.level=this.level,2==FoodChain.learnLevels[this.level-1].size?(FoodChain.addRemoveClass(this.$.herbbox,"herb-box-two","herb-box-three"),FoodChain.addRemoveClass(this.$.carnbox,"carn-box-two","carn-box-three"),FoodChain.addRemoveClass(this.$.omnibox,"omni-box-two","omni-box-three"),this.$.omnibox.hide()):(FoodChain.addRemoveClass(this.$.herbbox,"herb-box-three","herb-box-two"),FoodChain.addRemoveClass(this.$.carnbox,"carn-box-three","carn-box-two"),FoodChain.addRemoveClass(this.$.omnibox,"omni-box-three","omni-box-two"),this.$.omnibox.show()),this.dragobject=null,this.selectedobject=null,null==this.cardlist&&(this.cardlist=FoodChain.randomFeedList(FoodChain.learnLevels[this.level-1].size,FoodChain.learnLevels[this.level-1].count)),this.currentcard=0;var a=this.$.startbox.createComponent({kind:"FoodChain.Card",cardname:this.cardlist[this.currentcard].cardname,x:10,y:10,ontap:"taped",ondragstart:"dragstart",ondragfinish:"dragfinish"},{owner:this});FoodChain.sound.play(a.sound),FoodChain.saveContext(),this.$.play.hide(),this.$.pause.show(),this.$.forward.hide(),this.$.home.hide(),this.$.level.setContent(" "+this.level),this.timecount={mins:0,secs:0,tenth:0},this.$.timercount.removeClass("timer-overtime"),this.displayTimer(),this.render()},endSound:function(a,b){if(1!=this.nextaction)2==this.nextaction&&(this.nextaction=0,this.dragobject.getContainer().removeClass("box-lost"),this.dragobject.setContainer(this.$.startbox),this.dragobject=null,this.render()),this.$.timer.resume();else if(this.nextaction=0,this.dragobject.getContainer().removeClass("box-win"),this.dragobject.destroy(),this.dragobject=null,this.currentcard+1==this.cardlist.length)this.computeLevelScore(),this.$.play.hide(),this.$.pause.hide(),this.$.home.show(),this.render(),this.level!=FoodChain.learnLevels.length&&this.$.forward.show();else{this.currentcard=this.currentcard+1;var c=this.$.startbox.createComponent({kind:"FoodChain.Card",cardname:this.cardlist[this.currentcard].cardname,x:5,y:5,ontap:"taped",ondragstart:"dragstart",ondragfinish:"dragfinish"},{owner:this});FoodChain.sound.play(c.sound),this.render()}},displayTimer:function(){this.$.timercount.setContent(this.timecount.mins+":"+String("00"+this.timecount.secs).slice(-2)+","+this.timecount.tenth)},updateTimer:function(a,b){if(this.timecount.tenth=this.timecount.tenth+1,10==this.timecount.tenth){this.timecount.tenth=0,this.timecount.secs=this.timecount.secs+1;60*this.timecount.mins+this.timecount.secs>=FoodChain.learnLevels[this.level-1].time&&this.$.timercount.addClass("timer-overtime"),60==this.timecount.secs&&(this.timecount.secs=0,this.timecount.mins=this.timecount.mins+1)}this.displayTimer()},taped:function(a,b){if(this.$.timer.paused)return!0;FoodChain.sound.play(a.sound),FoodChain.log(a.cardname+" taped"),this.selectedobject=a,a.addClass("card-dragged")},dragstart:function(a,b){if(this.$.timer.paused)return!0;a.addClass("card-dragged"),this.$.startbox.addClass("box-dragging"),this.$.herbbox.addClass("box-dragging"),this.$.carnbox.addClass("box-dragging"),this.$.omnibox.addClass("box-dragging"),FoodChain.sound.play(a.sound),this.dragobject=a,this.selectedobject=null},dragfinish:function(a,b){a.removeClass("card-dragged"),this.$.startbox.removeClass("box-dragging"),this.$.herbbox.removeClass("box-dragging"),this.$.carnbox.removeClass("box-dragging"),this.$.omnibox.removeClass("box-dragging")},dragover:function(a,b){return null==this.dragobject||(b.preventDefault(),!1)},chooseAsEnd:function(a,b){if(null==this.selectedobject)return!0;this.selectedobject.removeClass("card-dragged"),this.dragobject=this.selectedobject,this.drop(a,b),this.selectedobject=null},drop:function(a,b){if(null==this.dragobject||this.$.timer.paused)return!0;b.preventDefault(),this.dragobject.setContainer(a),this.dragobject.moveTo(5,0),this.render(),this.$.timer.pause(),a.name.substring(0,4)==FoodChain.feedStrategy[this.cardlist[this.currentcard].strategy].name.substring(0,4)?(this.nextaction=1,this.addScore(1),FoodChain.sound.play("audio/applause"),a.addClass("box-win")):(this.nextaction=2,FoodChain.sound.play("audio/disappointed"),a.addClass("box-lost"))},addScore:function(a){FoodChain.context.score+=a,this.$.score.setContent(String("0000"+FoodChain.context.score).slice(-4))},computeLevelScore:function(){var a=0,b=60*this.timecount.mins+this.timecount.secs;b<FoodChain.learnLevels[this.level-1].time&&(a+=FoodChain.learnLevels[this.level-1].time-b),this.addScore(a)},play:function(){enyo.forEach(this.$.startbox.getControls(),function(a){a.show()}),this.$.timer.resume(),this.$.play.hide(),this.$.pause.show(),this.$.home.hide()},pause:function(){enyo.forEach(this.$.startbox.getControls(),function(a){a.hide()}),this.$.timer.pause(),this.$.pause.hide(),this.$.play.show(),this.$.home.show()},next:function(){this.level=this.level+1,this.cardlist=null,this.levelChanged()},home:function(){this.$.timer.stop(),FoodChain.goHome()}});