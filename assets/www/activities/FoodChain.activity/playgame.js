FoodChain.playLevels=[{flies:2,rocks:2,snakes:0,time:15},{flies:2,rocks:3,snakes:0,time:10},{flies:3,rocks:3,snakes:0,time:15},{flies:3,rocks:4,snakes:1,time:30},{flies:4,rocks:4,snakes:1,time:40},{flies:3,rocks:3,snakes:2,time:50}],FoodChain.playKeys=[{key:75,heading:0,dx:1,dy:0},{key:107,heading:0,dx:1,dy:0},{key:73,heading:90,dx:0,dy:-1},{key:105,heading:90,dx:0,dy:-1},{key:74,heading:0,dx:1,dy:0},{key:106,heading:180,dx:-1,dy:0},{key:76,heading:270,dx:0,dy:1},{key:108,heading:270,dx:0,dy:1}],FoodChain.playArea={width:-1,height:-1},FoodChain.sprites={frog:{dx:100,dy:152},rock:{dx:112,dy:101},fly:{dx:50,dy:80},snake:{dx:100,dy:250}},enyo.kind({name:"FoodChain.PlayGame",kind:enyo.Control,published:{level:1,life:3},classes:"board",components:[{name:"cards",components:[{classes:"status-bar",components:[{classes:"level-zone",components:[{name:"textlevel",classes:"title level-value"},{name:"level",content:"0",classes:"title level-value"}]},{classes:"score-zone",components:[{name:"textscore",classes:"title score-text"},{name:"score",content:"0000",classes:"title score-value"},{name:"timercount",content:"0:0,0",classes:"title timer-value"}]}]},{name:"lifes",classes:"life-border",components:[{kind:"Image",classes:"life",src:"images/frog9.png"},{kind:"Image",classes:"life",src:"images/frog9.png"},{kind:"Image",classes:"life",src:"images/frog9.png"}]},{name:"gamebox",classes:"game-box",components:[]},{name:"play",kind:"ShadowButton",img:"play",classes:"play",ontap:"play"},{name:"pause",kind:"ShadowButton",img:"pause",classes:"play",ontap:"pause"},{name:"forward",kind:"ShadowButton",img:"forward",classes:"restart",ontap:"next"},{name:"home",kind:"ShadowButton",img:"home",classes:"home2",ontap:"home"},{kind:"Signals",onEndOfSound:"endSound",onkeypress:"keyPressed"},{showing:!1,components:[{kind:"Image",id:"frog1",src:"images/frog1.png",classes:"image-preload",onload:"imageLoaded"},{kind:"Image",id:"frog2",src:"images/frog2.png",classes:"image-preload",onload:"imageLoaded"},{kind:"Image",id:"frog3",src:"images/frog3.png",classes:"image-preload",onload:"imageLoaded"},{kind:"Image",id:"frog4",src:"images/frog4.png",classes:"image-preload",onload:"imageLoaded"},{kind:"Image",id:"frog5",src:"images/frog5.png",classes:"image-preload",onload:"imageLoaded"},{kind:"Image",id:"frog6",src:"images/frog6.png",classes:"image-preload",onload:"imageLoaded"},{kind:"Image",id:"frog7",src:"images/frog7.png",classes:"image-preload",onload:"imageLoaded"},{kind:"Image",id:"frog8",src:"images/frog8.png",classes:"image-preload",onload:"imageLoaded"},{kind:"Image",id:"frog9",src:"images/frog9.png",classes:"image-preload",onload:"imageLoaded"},{kind:"Image",id:"fly1",src:"images/fly1.png",classes:"image-preload",onload:"imageLoaded"},{kind:"Image",id:"fly2",src:"images/fly2.png",classes:"image-preload",onload:"imageLoaded"},{kind:"Image",id:"snake1",src:"images/snake1.png",classes:"image-preload",onload:"imageLoaded"},{kind:"Image",id:"snake2",src:"images/snake2.png",classes:"image-preload",onload:"imageLoaded"},{kind:"Image",id:"snake3",src:"images/snake3.png",classes:"image-preload",onload:"imageLoaded"},{kind:"Image",id:"snake4",src:"images/snake4.png",classes:"image-preload",onload:"imageLoaded"},{kind:"Image",id:"snake5",src:"images/snake5.png",classes:"image-preload",onload:"imageLoaded"},{kind:"Image",id:"snake6",src:"images/snake6.png",classes:"image-preload",onload:"imageLoaded"},{kind:"Image",id:"snake7",src:"images/snake7.png",classes:"image-preload",onload:"imageLoaded"},{kind:"Image",id:"snake8",src:"images/snake8.png",classes:"image-preload",onload:"imageLoaded"},{kind:"Image",id:"rock",src:"images/rock.png",classes:"image-preload",onload:"imageLoaded"}]}]}],create:function(){this.inherited(arguments),this.imagesToLoad=20,this.nextaction=0,FoodChain.playArea={width:984,height:560};var e=FoodChain.getZoomLevel();this.$.gamebox.setStyle("max-height: "+FoodChain.playArea.height*e+"px;max-width: "+FoodChain.playArea.width*e+"px;"),this.canvas=this.$.gamebox.createComponent({kind:"Canvas",id:"acanvas",name:"canvas",ontap:"clickToMove",attributes:{width:FoodChain.playArea.width,height:FoodChain.playArea.height}},{owner:this}),this.createComponent({name:"timer",kind:"Timer",paused:!0,onTriggered:"updateTimer"},{owner:this}),this.createComponent({name:"timerMonster",kind:"Timer",baseInterval:500,onTriggered:"monsterEngine"},{owner:this}),this.setLocale(),this.$.score.setContent(String("0000"+FoodChain.context.score).slice(-4)),FoodChain.context.game=this.kindName,this.levelChanged()},setLocale:function(){this.$.textlevel.setContent(__$FC("level")),this.$.textscore.setContent(__$FC("score"))},levelChanged:function(){FoodChain.context.level=this.level,this.frog=new Sprite({x:70,y:FoodChain.playArea.height/2-20,heading:0,images:["frog1","frog2","frog3","frog4","frog5","frog6","frog7","frog8","frog9"],width:FoodChain.sprites.frog.dx,height:FoodChain.sprites.frog.dy,index:0,sound:"audio/frog"}),this.frog.alive=!0,this.rocks=[];for(var e=0;e<FoodChain.playLevels[this.level-1].rocks;e++){var i=FoodChain.createWithCondition((function(){var e=130+Math.floor(Math.random()*(FoodChain.playArea.width-300)),i=130+Math.floor(Math.random()*(FoodChain.playArea.height-200)),t=90*Math.floor(4*Math.random());return new Sprite({x:e,y:i,heading:t,images:["rock"],width:FoodChain.sprites.rock.dx,height:FoodChain.sprites.rock.dy,index:0})}),(function(e,i){return!e.intersect(i)}),enyo.cloneArray(this.rocks).concat(this.frog));this.rocks.push(i)}this.flies=[];for(e=0;e<FoodChain.playLevels[this.level-1].flies;e++){var t=FoodChain.createWithCondition((function(){var e=100+Math.floor(Math.random()*(FoodChain.playArea.width-300)),i=100+Math.floor(Math.random()*(FoodChain.playArea.height-200)),t=90*Math.floor(4*Math.random());return new Sprite({x:e,y:i,heading:t,images:["fly1","fly2"],width:FoodChain.sprites.fly.dx,height:FoodChain.sprites.fly.dy,index:0,sound:"audio/flies"})}),(function(e,i){return!e.intersect(i)}),enyo.cloneArray(this.rocks).concat(this.flies).concat(this.frog));t.alive=!0,this.flies.push(t)}this.snakes=[];for(e=0;e<FoodChain.playLevels[this.level-1].snakes;e++){var s=new Sprite({x:0,y:0,heading:0,images:["snake1","snake2","snake3","snake4","snake5","snake6","snake7","snake8"],width:FoodChain.sprites.snake.dx,height:FoodChain.sprites.snake.dy,index:0,sound:"audio/snake"});s.alive=!1,this.snakes.push(s)}FoodChain.saveContext(),this.$.play.hide(),this.$.pause.show(),this.$.forward.hide(),this.$.home.hide(),this.$.level.setContent(" "+this.level),this.timecount={mins:0,secs:0,tenth:0},this.$.timercount.removeClass("timer-overtime"),this.displayTimer()},imageLoaded:function(){0==--this.imagesToLoad&&this.initGame()},initGame:function(){var e=FoodChain.getZoomLevel();this.canvas.hasNode().style.MozTransform="scale("+e+")",this.canvas.hasNode().style.MozTransformOrigin="0 0",this.canvas.hasNode().style.zoom=e,this.ctx=this.canvas.node.getContext("2d"),this.ctx.clearRect(0,0,this.canvas.attributes.width,this.canvas.attributes.height);for(var i=0;i<this.rocks.length;i++)this.rocks[i].draw(this.ctx);this.frog.draw(this.ctx);for(i=0;i<this.flies.length;i++)this.flies[i].draw(this.ctx);this.$.timer.resume()},clickToMove:function(e,i){var t=i.clientX-this.frog.getX(),s=i.clientY-this.frog.getY();if(0!=t||0!=s){Math.abs(t)>Math.abs(s)?(t=t>0?1:-1,s=0):(t=0,s=s>0?1:-1);for(var a=0;a<FoodChain.playKeys.length;a++){var o=FoodChain.playKeys[a];if(o.dx==t&&o.dy==s)return i.charCode=o.key,void this.keyPressed(e,i)}}},keyPressed:function(e,i){var t=i.charCode;if(!this.$.timer.paused&&this.frog.alive){for(var s,a=0,o=0,n=!1,h=0;h<FoodChain.playKeys.length;h++){var r=FoodChain.playKeys[h];t==r.key&&(a=r.dx,o=r.dy,s=r.heading,n=!0)}n?(this.frog.unDraw(this.ctx),s!=this.frog.getHeading()?(this.frog.setHeading(s),this.frog.firstImage()):this.frog.animate(this.ctx,[1,2,3,4,5,6,0],10*a,10*o,enyo.bind(this,"frogEngine")),this.frog.draw(this.ctx)):FoodChain.log("key pressed: "+t)}},frogEngine:function(){for(var e=0;e<this.rocks.length;e++)if(this.frog.intersect(this.rocks[e]))return this.frog.unDraw(this.ctx),this.frog.useImage(7),this.frog.draw(this.ctx),this.rocks[e].draw(this.ctx),this.frog.alive=!1,this.testEndOfGame(),!1;for(e=0;e<this.flies.length;e++)if(this.flies[e].alive&&this.frog.intersect(this.flies[e]))return this.flies[e].unDraw(this.ctx),this.flies[e].alive=!1,this.frog.playSound(),this.addScore(1),!this.testEndOfGame();if(this.frog.getX()<=this.frog.width/2||this.frog.getX()>=this.canvas.attributes.width-this.frog.width/2||this.frog.getY()<=this.frog.height/2||this.frog.getY()>=this.canvas.attributes.height-this.frog.height/2)return this.frog.setX(Math.max(this.frog.width/2+1,this.frog.getX())),this.frog.setX(Math.min(this.canvas.attributes.width-this.frog.width/2-1,this.frog.getX())),this.frog.setY(Math.max(this.frog.height/2+1,this.frog.getY())),this.frog.setY(Math.min(this.canvas.attributes.height-this.frog.height/2-1,this.frog.getY())),this.frog.unDraw(this.ctx),this.frog.firstImage(),this.frog.draw(this.ctx),this.frog.playSound(),!1;for(e=0;e<this.snakes.length;e++)if(this.frog.intersect(this.snakes[e]))return this.frog.unDraw(this.ctx),this.frog.useImage(7),this.frog.draw(this.ctx),this.snakes[e].draw(this.ctx),this.frog.alive=!1,this.testEndOfGame(),!1;return!0},monsterEngine:function(){this.fliesEngine(),this.snakesEngine()},fliesEngine:function(){if(!this.$.timer.paused)for(var e=0;e<this.flies.length;e++)if(this.flies[e].alive){var i=Math.floor(10*Math.random());1==i?this.moveFly(this.flies[e]):i<=2&&this.flies[e].animate(this.ctx,[0,1,0,1,0,1],0,0,enyo.bind(this,"testFlyDead"))}},moveFly:function(e){var i=e,t=FoodChain.createWithCondition((function(){var e=100+Math.floor(Math.random()*(FoodChain.playArea.width-300)),i=100+Math.floor(Math.random()*(FoodChain.playArea.height-200)),t=90*Math.floor(4*Math.random());return new Sprite({x:e,y:i,heading:t,width:FoodChain.sprites.fly.dx,height:FoodChain.sprites.fly.dy})}),(function(e,t){return t==i||!e.intersect(t)}),enyo.cloneArray(this.rocks).concat(this.flies).concat(this.frog).concat(this.snakes));i.unDraw(this.ctx),i.setX(t.getX()),i.setY(t.getY()),i.setHeading(t.getHeading()),i.draw(this.ctx),i.playSound()},snakesEngine:function(){if(!this.$.timer.paused)for(var e=0;e<this.snakes.length;e++){if(0==Math.floor(4*Math.random())){var i=this.snakes[e],t=this.canvas.attributes.height;this.canvas.attributes.width;if((90==i.getHeading()&&i.getY()+i.height<0||270==i.getHeading()&&i.getY()-i.height/2>t)&&(i.alive=!1),i.alive){l=90==i.getHeading()?-6:6;i.animate(this.ctx,[0,1,2,3,4,5,6,7,0,1,2,3,4,5,6,7],0,l,enyo.bind(this,"snakeCollisionEngine"))}else{for(var s=enyo.cloneArray(this.rocks).concat(this.snakes),a=[],o=100;o<FoodChain.playArea.width-300;o+=50){for(var n=!0,h=0;n&&h<s.length;h++){var r=s[h];r!=i&&((o>r.getX()&&o-i.width/2<r.getX()+r.width/2||o<r.getX()&&o+i.width/2>r.getX()-r.width/2)&&(n=!1))}n&&a.push(o)}o=a[Math.floor(Math.random()*a.length)];var d=0==Math.floor(2*Math.random())?90:270,g=90==d?t:0;i.setX(o),i.setY(g),i.setHeading(d),i.alive=!0,i.playSound();var l=90==i.getHeading()?-6:6;i.animate(this.ctx,[0,1,2,3,4,5,6,7,0,1,2,3,4,5,6,7],0,l,enyo.bind(this,"snakeCollisionEngine"))}}}},snakeCollisionEngine:function(e){if(e.intersect(this.frog))return this.frog.alive?(this.frog.alive=!1,this.frog.unDraw(this.ctx),this.frog.useImage(7),this.frog.draw(this.ctx),this.testEndOfGame(),!0):(this.frog.draw(this.ctx),!0);for(var i=0;i<this.flies.length;i++)if(this.flies[i].alive&&e.intersect(this.flies[i]))return this.moveFly(this.flies[i]),!0;return!0},testFlyDead:function(e){return!!e.alive||(e.unDraw(this.ctx),!1)},testEndOfGame:function(){if(this.frog.alive){for(var e=0,i=0;i<this.flies.length;i++)this.flies[i].alive&&e++;return!(e>0)&&(this.frog.unDraw(this.ctx),this.frog.setX(this.frog.getX()+50),this.frog.setY(this.frog.getY()+50),this.frog.useImage(8),this.frog.setHeading(90),this.frog.draw(this.ctx),this.$.timer.pause(),FoodChain.sound.play("audio/applause"),this.computeLevelScore(),this.$.play.hide(),this.$.pause.hide(),this.$.home.show(),this.level!=FoodChain.playLevels.length&&this.$.forward.show(),!0)}this.life--,this.$.lifes.getControls()[this.life].hide(),this.life>0?this.nextaction=1:(this.$.timer.pause(),this.$.pause.hide(),this.$.home.show()),FoodChain.sound.play("audio/disappointed")},endSound:function(e,i){if(1==this.nextaction)return this.nextaction=0,this.frog.unDraw(this.ctx),this.frog.setX(70),this.frog.setY(FoodChain.playArea.height/2-20),this.frog.setHeading(0),this.frog.useImage(0),this.frog.draw(this.ctx),void(this.frog.alive=!0)},displayTimer:function(){this.$.timercount.setContent(this.timecount.mins+":"+String("00"+this.timecount.secs).slice(-2)+","+this.timecount.tenth)},updateTimer:function(e,i){(this.timecount.tenth=this.timecount.tenth+1,10==this.timecount.tenth)&&(this.timecount.tenth=0,this.timecount.secs=this.timecount.secs+1,60*this.timecount.mins+this.timecount.secs>=FoodChain.playLevels[this.level-1].time&&this.$.timercount.addClass("timer-overtime"),60==this.timecount.secs&&(this.timecount.secs=0,this.timecount.mins=this.timecount.mins+1));this.displayTimer()},addScore:function(e){FoodChain.context.score+=e,this.$.score.setContent(String("0000"+FoodChain.context.score).slice(-4))},computeLevelScore:function(){var e=0,i=60*this.timecount.mins+this.timecount.secs;i<FoodChain.playLevels[this.level-1].time&&(e+=FoodChain.playLevels[this.level-1].time-i),this.addScore(e)},play:function(){this.$.timer.resume(),this.$.play.hide(),this.$.pause.show(),this.$.home.hide()},pause:function(){this.$.timer.pause(),this.$.pause.hide(),this.$.play.show(),this.$.home.show()},next:function(){this.level=this.level+1,this.levelChanged(),this.initGame()},home:function(){this.$.timer.stop(),this.$.timerMonster.stop(),FoodChain.goHome()}});