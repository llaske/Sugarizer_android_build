/*! Sugarizer 2019-09-21 */
FoodChain.playLevels=[{flies:2,rocks:2,snakes:0,time:15},{flies:2,rocks:3,snakes:0,time:10},{flies:3,rocks:3,snakes:0,time:15},{flies:3,rocks:4,snakes:1,time:30},{flies:4,rocks:4,snakes:1,time:40},{flies:3,rocks:3,snakes:2,time:50}],FoodChain.playKeys=[{key:75,heading:0,dx:1,dy:0},{key:107,heading:0,dx:1,dy:0},{key:73,heading:90,dx:0,dy:-1},{key:105,heading:90,dx:0,dy:-1},{key:74,heading:0,dx:1,dy:0},{key:106,heading:180,dx:-1,dy:0},{key:76,heading:270,dx:0,dy:1},{key:108,heading:270,dx:0,dy:1}],FoodChain.playArea={width:-1,height:-1},FoodChain.sprites={frog:{dx:100,dy:152},rock:{dx:112,dy:101},fly:{dx:50,dy:80},snake:{dx:100,dy:250}},enyo.kind({name:"FoodChain.PlayGame",kind:enyo.Control,published:{level:1,life:3},classes:"board",components:[{name:"cards",components:[{classes:"status-bar",components:[{classes:"level-zone",components:[{name:"textlevel",classes:"title level-value"},{name:"level",content:"0",classes:"title level-value"}]},{classes:"score-zone",components:[{name:"textscore",classes:"title score-text"},{name:"score",content:"0000",classes:"title score-value"},{name:"timercount",content:"0:0,0",classes:"title timer-value"}]}]},{name:"lifes",classes:"life-border",components:[{kind:"Image",classes:"life",src:"images/frog9.png"},{kind:"Image",classes:"life",src:"images/frog9.png"},{kind:"Image",classes:"life",src:"images/frog9.png"}]},{name:"gamebox",classes:"game-box",components:[]},{name:"play",kind:"ShadowButton",img:"play",classes:"play",ontap:"play"},{name:"pause",kind:"ShadowButton",img:"pause",classes:"play",ontap:"pause"},{name:"forward",kind:"ShadowButton",img:"forward",classes:"restart",ontap:"next"},{name:"home",kind:"ShadowButton",img:"home",classes:"home2",ontap:"home"},{kind:"Signals",onEndOfSound:"endSound",onkeypress:"keyPressed"},{showing:!1,components:[{kind:"Image",id:"frog1",src:"images/frog1.png",classes:"image-preload",onload:"imageLoaded"},{kind:"Image",id:"frog2",src:"images/frog2.png",classes:"image-preload",onload:"imageLoaded"},{kind:"Image",id:"frog3",src:"images/frog3.png",classes:"image-preload",onload:"imageLoaded"},{kind:"Image",id:"frog4",src:"images/frog4.png",classes:"image-preload",onload:"imageLoaded"},{kind:"Image",id:"frog5",src:"images/frog5.png",classes:"image-preload",onload:"imageLoaded"},{kind:"Image",id:"frog6",src:"images/frog6.png",classes:"image-preload",onload:"imageLoaded"},{kind:"Image",id:"frog7",src:"images/frog7.png",classes:"image-preload",onload:"imageLoaded"},{kind:"Image",id:"frog8",src:"images/frog8.png",classes:"image-preload",onload:"imageLoaded"},{kind:"Image",id:"frog9",src:"images/frog9.png",classes:"image-preload",onload:"imageLoaded"},{kind:"Image",id:"fly1",src:"images/fly1.png",classes:"image-preload",onload:"imageLoaded"},{kind:"Image",id:"fly2",src:"images/fly2.png",classes:"image-preload",onload:"imageLoaded"},{kind:"Image",id:"snake1",src:"images/snake1.png",classes:"image-preload",onload:"imageLoaded"},{kind:"Image",id:"snake2",src:"images/snake2.png",classes:"image-preload",onload:"imageLoaded"},{kind:"Image",id:"snake3",src:"images/snake3.png",classes:"image-preload",onload:"imageLoaded"},{kind:"Image",id:"snake4",src:"images/snake4.png",classes:"image-preload",onload:"imageLoaded"},{kind:"Image",id:"snake5",src:"images/snake5.png",classes:"image-preload",onload:"imageLoaded"},{kind:"Image",id:"snake6",src:"images/snake6.png",classes:"image-preload",onload:"imageLoaded"},{kind:"Image",id:"snake7",src:"images/snake7.png",classes:"image-preload",onload:"imageLoaded"},{kind:"Image",id:"snake8",src:"images/snake8.png",classes:"image-preload",onload:"imageLoaded"},{kind:"Image",id:"rock",src:"images/rock.png",classes:"image-preload",onload:"imageLoaded"}]}]}],create:function(){this.inherited(arguments),this.imagesToLoad=20,this.nextaction=0,FoodChain.playArea={width:984,height:560};var a=FoodChain.getZoomLevel();this.$.gamebox.setStyle("max-height: "+FoodChain.playArea.height*a+"px;max-width: "+FoodChain.playArea.width*a+"px;"),this.canvas=this.$.gamebox.createComponent({kind:"Canvas",id:"acanvas",name:"canvas",ontap:"clickToMove",attributes:{width:FoodChain.playArea.width,height:FoodChain.playArea.height}},{owner:this}),this.createComponent({name:"timer",kind:"Timer",paused:!0,onTriggered:"updateTimer"},{owner:this}),this.createComponent({name:"timerMonster",kind:"Timer",baseInterval:500,onTriggered:"monsterEngine"},{owner:this}),this.setLocale(),this.$.score.setContent(String("0000"+FoodChain.context.score).slice(-4)),FoodChain.context.game=this.kindName,this.levelChanged()},setLocale:function(){this.$.textlevel.setContent(__$FC("level")),this.$.textscore.setContent(__$FC("score"))},levelChanged:function(){FoodChain.context.level=this.level,this.frog=new Sprite({x:70,y:FoodChain.playArea.height/2-20,heading:0,images:["frog1","frog2","frog3","frog4","frog5","frog6","frog7","frog8","frog9"],width:FoodChain.sprites.frog.dx,height:FoodChain.sprites.frog.dy,index:0,sound:"audio/frog"}),this.frog.alive=!0,this.rocks=[];for(var a=0;a<FoodChain.playLevels[this.level-1].rocks;a++){var b=FoodChain.createWithCondition(function(){var a=130+Math.floor(Math.random()*(FoodChain.playArea.width-300)),b=130+Math.floor(Math.random()*(FoodChain.playArea.height-200)),c=90*Math.floor(4*Math.random());return new Sprite({x:a,y:b,heading:c,images:["rock"],width:FoodChain.sprites.rock.dx,height:FoodChain.sprites.rock.dy,index:0})},function(a,b){return!a.intersect(b)},enyo.cloneArray(this.rocks).concat(this.frog));this.rocks.push(b)}this.flies=[];for(var a=0;a<FoodChain.playLevels[this.level-1].flies;a++){var c=FoodChain.createWithCondition(function(){var a=100+Math.floor(Math.random()*(FoodChain.playArea.width-300)),b=100+Math.floor(Math.random()*(FoodChain.playArea.height-200)),c=90*Math.floor(4*Math.random());return new Sprite({x:a,y:b,heading:c,images:["fly1","fly2"],width:FoodChain.sprites.fly.dx,height:FoodChain.sprites.fly.dy,index:0,sound:"audio/flies"})},function(a,b){return!a.intersect(b)},enyo.cloneArray(this.rocks).concat(this.flies).concat(this.frog));c.alive=!0,this.flies.push(c)}this.snakes=[];for(var a=0;a<FoodChain.playLevels[this.level-1].snakes;a++){var d=new Sprite({x:0,y:0,heading:0,images:["snake1","snake2","snake3","snake4","snake5","snake6","snake7","snake8"],width:FoodChain.sprites.snake.dx,height:FoodChain.sprites.snake.dy,index:0,sound:"audio/snake"});d.alive=!1,this.snakes.push(d)}FoodChain.saveContext(),this.$.play.hide(),this.$.pause.show(),this.$.forward.hide(),this.$.home.hide(),this.$.level.setContent(" "+this.level),this.timecount={mins:0,secs:0,tenth:0},this.$.timercount.removeClass("timer-overtime"),this.displayTimer()},imageLoaded:function(){0==--this.imagesToLoad&&this.initGame()},initGame:function(){var a=FoodChain.getZoomLevel();this.canvas.hasNode().style.MozTransform="scale("+a+")",this.canvas.hasNode().style.MozTransformOrigin="0 0",this.canvas.hasNode().style.zoom=a,this.ctx=this.canvas.node.getContext("2d"),this.ctx.clearRect(0,0,this.canvas.attributes.width,this.canvas.attributes.height);for(var b=0;b<this.rocks.length;b++)this.rocks[b].draw(this.ctx);this.frog.draw(this.ctx);for(var b=0;b<this.flies.length;b++)this.flies[b].draw(this.ctx);this.$.timer.resume()},clickToMove:function(a,b){var c=b.clientX-this.frog.getX(),d=b.clientY-this.frog.getY();if(0!=c||0!=d){Math.abs(c)>Math.abs(d)?(c=c>0?1:-1,d=0):(c=0,d=d>0?1:-1);for(var e=0;e<FoodChain.playKeys.length;e++){var f=FoodChain.playKeys[e];if(f.dx==c&&f.dy==d)return b.charCode=f.key,void this.keyPressed(a,b)}}},keyPressed:function(a,b){var c=b.charCode;if(!this.$.timer.paused&&this.frog.alive){for(var d,e=0,f=0,g=!1,h=0;h<FoodChain.playKeys.length;h++){var i=FoodChain.playKeys[h];c==i.key&&(e=i.dx,f=i.dy,d=i.heading,g=!0)}if(!g)return void FoodChain.log("key pressed: "+c);this.frog.unDraw(this.ctx),d!=this.frog.getHeading()?(this.frog.setHeading(d),this.frog.firstImage()):this.frog.animate(this.ctx,[1,2,3,4,5,6,0],10*e,10*f,enyo.bind(this,"frogEngine")),this.frog.draw(this.ctx)}},frogEngine:function(){for(var a=0;a<this.rocks.length;a++)if(this.frog.intersect(this.rocks[a]))return this.frog.unDraw(this.ctx),this.frog.useImage(7),this.frog.draw(this.ctx),this.rocks[a].draw(this.ctx),this.frog.alive=!1,this.testEndOfGame(),!1;for(var a=0;a<this.flies.length;a++)if(this.flies[a].alive&&this.frog.intersect(this.flies[a]))return this.flies[a].unDraw(this.ctx),this.flies[a].alive=!1,this.frog.playSound(),this.addScore(1),!this.testEndOfGame();if(this.frog.getX()<=this.frog.width/2||this.frog.getX()>=this.canvas.attributes.width-this.frog.width/2||this.frog.getY()<=this.frog.height/2||this.frog.getY()>=this.canvas.attributes.height-this.frog.height/2)return this.frog.setX(Math.max(this.frog.width/2+1,this.frog.getX())),this.frog.setX(Math.min(this.canvas.attributes.width-this.frog.width/2-1,this.frog.getX())),this.frog.setY(Math.max(this.frog.height/2+1,this.frog.getY())),this.frog.setY(Math.min(this.canvas.attributes.height-this.frog.height/2-1,this.frog.getY())),this.frog.unDraw(this.ctx),this.frog.firstImage(),this.frog.draw(this.ctx),this.frog.playSound(),!1;for(var a=0;a<this.snakes.length;a++)if(this.frog.intersect(this.snakes[a]))return this.frog.unDraw(this.ctx),this.frog.useImage(7),this.frog.draw(this.ctx),this.snakes[a].draw(this.ctx),this.frog.alive=!1,this.testEndOfGame(),!1;return!0},monsterEngine:function(){this.fliesEngine(),this.snakesEngine()},fliesEngine:function(){if(!this.$.timer.paused)for(var a=0;a<this.flies.length;a++)if(this.flies[a].alive){var b=Math.floor(10*Math.random());1==b?this.moveFly(this.flies[a]):b<=2&&this.flies[a].animate(this.ctx,[0,1,0,1,0,1],0,0,enyo.bind(this,"testFlyDead"))}},moveFly:function(a){var b=a,c=FoodChain.createWithCondition(function(){var a=100+Math.floor(Math.random()*(FoodChain.playArea.width-300)),b=100+Math.floor(Math.random()*(FoodChain.playArea.height-200)),c=90*Math.floor(4*Math.random());return new Sprite({x:a,y:b,heading:c,width:FoodChain.sprites.fly.dx,height:FoodChain.sprites.fly.dy})},function(a,c){return c==b||!a.intersect(c)},enyo.cloneArray(this.rocks).concat(this.flies).concat(this.frog).concat(this.snakes));b.unDraw(this.ctx),b.setX(c.getX()),b.setY(c.getY()),b.setHeading(c.getHeading()),b.draw(this.ctx),b.playSound()},snakesEngine:function(){if(!this.$.timer.paused)for(var a=0;a<this.snakes.length;a++){var b=Math.floor(4*Math.random());if(0==b){var c=this.snakes[a],d=this.canvas.attributes.height;this.canvas.attributes.width;if((90==c.getHeading()&&c.getY()+c.height<0||270==c.getHeading()&&c.getY()-c.height/2>d)&&(c.alive=!1),c.alive){var e=90==c.getHeading()?-6:6;c.animate(this.ctx,[0,1,2,3,4,5,6,7,0,1,2,3,4,5,6,7],0,e,enyo.bind(this,"snakeCollisionEngine"))}else{for(var f=enyo.cloneArray(this.rocks).concat(this.snakes),g=[],h=100;h<FoodChain.playArea.width-300;h+=50){for(var i=!0,j=0;i&&j<f.length;j++){var k=f[j];k!=c&&((h>k.getX()&&h-c.width/2<k.getX()+k.width/2||h<k.getX()&&h+c.width/2>k.getX()-k.width/2)&&(i=!1))}i&&g.push(h)}h=g[Math.floor(Math.random()*g.length)];var l=0==Math.floor(2*Math.random())?90:270,m=90==l?d:0;c.setX(h),c.setY(m),c.setHeading(l),c.alive=!0,c.playSound();var e=90==c.getHeading()?-6:6;c.animate(this.ctx,[0,1,2,3,4,5,6,7,0,1,2,3,4,5,6,7],0,e,enyo.bind(this,"snakeCollisionEngine"))}}}},snakeCollisionEngine:function(a){if(a.intersect(this.frog))return this.frog.alive?(this.frog.alive=!1,this.frog.unDraw(this.ctx),this.frog.useImage(7),this.frog.draw(this.ctx),this.testEndOfGame(),!0):(this.frog.draw(this.ctx),!0);for(var b=0;b<this.flies.length;b++)if(this.flies[b].alive&&a.intersect(this.flies[b]))return this.moveFly(this.flies[b]),!0;return!0},testFlyDead:function(a){return!!a.alive||(a.unDraw(this.ctx),!1)},testEndOfGame:function(){if(this.frog.alive){for(var a=0,b=0;b<this.flies.length;b++)this.flies[b].alive&&a++;return!(a>0)&&(this.frog.unDraw(this.ctx),this.frog.setX(this.frog.getX()+50),this.frog.setY(this.frog.getY()+50),this.frog.useImage(8),this.frog.setHeading(90),this.frog.draw(this.ctx),this.$.timer.pause(),FoodChain.sound.play("audio/applause"),this.computeLevelScore(),this.$.play.hide(),this.$.pause.hide(),this.$.home.show(),this.level!=FoodChain.playLevels.length&&this.$.forward.show(),!0)}this.life--,this.$.lifes.getControls()[this.life].hide(),this.life>0?this.nextaction=1:(this.$.timer.pause(),this.$.pause.hide(),this.$.home.show()),FoodChain.sound.play("audio/disappointed")},endSound:function(a,b){if(1==this.nextaction)return this.nextaction=0,this.frog.unDraw(this.ctx),this.frog.setX(70),this.frog.setY(FoodChain.playArea.height/2-20),this.frog.setHeading(0),this.frog.useImage(0),this.frog.draw(this.ctx),void(this.frog.alive=!0)},displayTimer:function(){this.$.timercount.setContent(this.timecount.mins+":"+String("00"+this.timecount.secs).slice(-2)+","+this.timecount.tenth)},updateTimer:function(a,b){if(this.timecount.tenth=this.timecount.tenth+1,10==this.timecount.tenth){this.timecount.tenth=0,this.timecount.secs=this.timecount.secs+1;60*this.timecount.mins+this.timecount.secs>=FoodChain.playLevels[this.level-1].time&&this.$.timercount.addClass("timer-overtime"),60==this.timecount.secs&&(this.timecount.secs=0,this.timecount.mins=this.timecount.mins+1)}this.displayTimer()},addScore:function(a){FoodChain.context.score+=a,this.$.score.setContent(String("0000"+FoodChain.context.score).slice(-4))},computeLevelScore:function(){var a=0,b=60*this.timecount.mins+this.timecount.secs;b<FoodChain.playLevels[this.level-1].time&&(a+=FoodChain.playLevels[this.level-1].time-b),this.addScore(a)},play:function(){this.$.timer.resume(),this.$.play.hide(),this.$.pause.show(),this.$.home.hide()},pause:function(){this.$.timer.pause(),this.$.pause.hide(),this.$.play.show(),this.$.home.show()},next:function(){this.level=this.level+1,this.levelChanged(),this.initGame()},home:function(){this.$.timer.stop(),this.$.timerMonster.stop(),FoodChain.goHome()}});