define(["sugar-web/datastore"],(function(r){var e={},s=r.localStorage.getValue("sugar_history");return e.get=function(){return s},e.addUser=function(e){for(var a=s||[],t=0;t<a.length;t++)if(e.name.toLowerCase()==a[t].name.toLowerCase()&&(null==e.server&&null==a[t].server||e.server&&e.server.url&&a[t].server&&a[t].server.url&&e.server.url==a[t].server.url))return a[t]=a[a.length-1],a[a.length-1]=e,r.localStorage.setValue("sugar_history",a),void(s=a);if(a.push(e),a.length>constant.maxUserHistory){var l=[];for(t=0;t<a.length-1;t++)l.push(a[t+1]);a=l}r.localStorage.setValue("sugar_history",a),s=a},e.removeUser=function(e){for(var a=s||[],t=[],l=!1,o=0;o<a.length;o++)e.name.toLowerCase()==a[o].name.toLowerCase()&&(null==e.server&&null==a[o].server||e.server&&e.server.url&&a[o].server&&a[o].server.url&&e.server.url==a[o].server.url)?l=!0:t.push(a[o]);return l&&(s=t,r.localStorage.setValue("sugar_history",s)),l},e.clean=function(){r.localStorage.removeValue("sugar_history")},e}));