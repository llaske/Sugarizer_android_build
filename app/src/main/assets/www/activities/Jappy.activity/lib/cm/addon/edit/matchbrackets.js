!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)}((function(t){var e=/MSIE \d/.test(navigator.userAgent)&&(null==document.documentMode||document.documentMode<8),n=t.Pos,r={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<"};function findMatchingBracket(t,e,i,a){var c=t.getLineHandle(e.line),o=e.ch-1,f=o>=0&&r[c.text.charAt(o)]||r[c.text.charAt(++o)];if(!f)return null;var h=">"==f.charAt(1)?1:-1;if(i&&h>0!=(o==e.ch))return null;var l=t.getTokenTypeAt(n(e.line,o+1)),s=scanForBracket(t,n(e.line,o+(h>0?1:0)),h,l||null,a);return null==s?null:{from:n(e.line,o),to:s&&s.pos,match:s&&s.ch==f.charAt(0),forward:h>0}}function scanForBracket(t,e,i,a,c){for(var o=c&&c.maxScanLineLength||1e4,f=c&&c.maxScanLines||1e3,h=[],l=c&&c.bracketRegex?c.bracketRegex:/[(){}[\]]/,s=i>0?Math.min(e.line+f,t.lastLine()+1):Math.max(t.firstLine()-1,e.line-f),u=e.line;u!=s;u+=i){var m=t.getLine(u);if(m){var d=i>0?0:m.length-1,g=i>0?m.length:-1;if(!(m.length>o))for(u==e.line&&(d=e.ch-(i<0?1:0));d!=g;d+=i){var k=m.charAt(d);if(l.test(k)&&(void 0===a||t.getTokenTypeAt(n(u,d+1))==a))if(">"==r[k].charAt(1)==i>0)h.push(k);else{if(!h.length)return{pos:n(u,d),ch:k};h.pop()}}}}return u-i!=(i>0?t.lastLine():t.firstLine())&&null}function matchBrackets(t,r,i){for(var a=t.state.matchBrackets.maxHighlightLineLength||1e3,c=[],o=t.listSelections(),f=0;f<o.length;f++){var h=o[f].empty()&&findMatchingBracket(t,o[f].head,!1,i);if(h&&t.getLine(h.from.line).length<=a){var l=h.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket";c.push(t.markText(h.from,n(h.from.line,h.from.ch+1),{className:l})),h.to&&t.getLine(h.to.line).length<=a&&c.push(t.markText(h.to,n(h.to.line,h.to.ch+1),{className:l}))}}if(c.length){e&&t.state.focused&&t.focus();var clear=function(){t.operation((function(){for(var t=0;t<c.length;t++)c[t].clear()}))};if(!r)return clear;setTimeout(clear,800)}}var i=null;function doMatchBrackets(t){t.operation((function(){i&&(i(),i=null),i=matchBrackets(t,!1,t.state.matchBrackets)}))}t.defineOption("matchBrackets",!1,(function(e,n,r){r&&r!=t.Init&&(e.off("cursorActivity",doMatchBrackets),i&&(i(),i=null)),n&&(e.state.matchBrackets="object"==typeof n?n:{},e.on("cursorActivity",doMatchBrackets))})),t.defineExtension("matchBrackets",(function(){matchBrackets(this,!0)})),t.defineExtension("findMatchingBracket",(function(t,e,n){return findMatchingBracket(this,t,e,n)})),t.defineExtension("scanForBracket",(function(t,e,n,r){return scanForBracket(this,t,e,n,r)}))}));