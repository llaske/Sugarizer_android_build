requirejs.config({baseUrl:"lib",paths:{activity:"../js"}});const templates=[{name:"Colors",image:"colors.png",icons:[],colors:[-1],size:80,blink:1500,message:{content:"",color:"#ff0000",size:60,weight:"bold",style:"normal"}},{name:"Blue Moon",image:"bluemoon.png",icons:["org.sugarlabs.Falabracman","org.sugarlabs.moon"],colors:[124,120,122,123,121],size:60,blink:1e3,message:{content:"Blue Moon",color:"#00008b",size:100,weight:"normal",style:"italic"}},{name:"Merry Christmas",image:"merrychristmas.png",icons:["org.olpcfrance.XmasLights"],colors:[83,82,256,23,22,256],size:60,blink:1e3,message:{content:"Merry\nChristmas",color:"#ff0000",size:80,weight:"bold",style:"normal"}},{name:"Happy New Year",image:"happynewyear.png",icons:["com.homegrownapps.xoeditor"],colors:[],size:60,blink:1e3,message:{content:"Happy\nNew Year!",color:"#000000",size:80,weight:"normal",style:"normal"}}],initTemplate=0,initIcons=templates[0].icons,initColors=templates[0].colors,initSize=templates[0].size,initBlinkTime=templates[0].blink,initMessageContent=templates[0].message.content,initMessageColor=templates[0].message.color,initMessageSize=templates[0].message.size,initMessageWeight=templates[0].message.weight,initMessageStyle=templates[0].message.style,minSize=30,maxSize=90,viewGrid=1,viewDetail=2,displayDebug=!1;var app=new Vue({el:"#app",data:{currentView:1,activitiesIcons:[],randomIcon:null,gridContent:[],pattern:initIcons,colors:initColors,detailContent:{dropIcons:[],dragIcons:[],dropColors:[],dragColors:[]},draggedItem:null,size:initSize,blinkTime:initBlinkTime,message:"",messageStyle:{color:initMessageColor,fontWeight:initMessageWeight,fontStyle:initMessageStyle,size:initMessageSize},interval:null,paused:!1,SugarL10n:null,SugarPresence:null,l10n:{stringUnfullscreen:"",stringFullscreen:"",stringSettings:"",stringSpeed:"",stringZoom:"",stringTemplates:"",stringText:"",stringPlay:"",stringPause:"",stringEmptyIcon:"",stringEmptyColor:"",stringDragIcons:"",stringDragColors:"",stringTutoGridWelcomeTitle:"",stringTutoGridWelcomeContent:"",stringTutoGridBoardTitle:"",stringTutoGridBoardContent:"",stringTutoGridTemplateButtonTitle:"",stringTutoGridTemplateButtonContent:"",stringTutoGridPlayButtonTitle:"",stringTutoGridPlayButtonContent:"",stringTutoGridSettingsButtonTitle:"",stringTutoGridSettingsButtonContent:"",stringTutoGridSpeedButtonTitle:"",stringTutoGridSpeedButtonContent:"",stringTutoGridTextButtonTitle:"",stringTutoGridTextButtonContent:"",stringTutoGridZoomButtonTitle:"",stringTutoGridZoomButtonContent:"",stringTutoGridNetworkButtonTitle:"",stringTutoGridNetworkButtonContent:"",stringTutoDetailWelcomeTitle:"",stringTutoDetailWelcomeContent:"",stringTutoDetailDropIconTitle:"",stringTutoDetailDropIconContent:"",stringTutoDetailDragIconTitle:"",stringTutoDetailDragIconContent:"",stringTutoDetailDeleteIconTitle:"",stringTutoDetailDeleteIconContent:"",stringTutoDetailDropColorTitle:"",stringTutoDetailDropColorContent:"",stringTutoDetailDragColorTitle:"",stringTutoDetailDragColorContent:"",stringTutoDetailDeleteColorTitle:"",stringTutoDetailDeleteColorContent:"",stringTutoDetailGridButtonTitle:"",stringTutoDetailGridButtonContent:""}},mounted(){this.SugarL10n=this.$refs.SugarL10n,this.SugarPresence=this.$refs.SugarPresence},created(){let t=this;document.getElementById("message");var computeHeight=function(){let e=document.getElementById("body").offsetHeight-(t.$refs.SugarToolbar&&t.$refs.SugarToolbar.isHidden()?0:55),n=document.getElementById("grid"),o=document.getElementById("detail");o&&(o.style.height=e+"px"),n&&(n.style.height=e+"px",Object.keys(t.activitiesIcons).length>0&&(t.generateGrid(),t.blink()))};computeHeight(),window.addEventListener("resize",computeHeight)},methods:{initialize:function(){let t=this;return new Promise((function(e,n){let o=[];_loadActivities().then((function(n){n.push({directory:"activities/XmasLights.activity",icon:"icons/color.svg",id:"color"}),n.push({directory:"icons",icon:"activity-journal.svg",id:"journal"}),n.push({directory:"icons",icon:"emblem-favorite.svg",id:"favorite"}),n.push({directory:"icons",icon:"network-wireless-connected-100.svg",id:"server"}),n.push({directory:"icons",icon:"cloud-settings.svg",id:"cloud"});let i=n.length;for(let l=0;l<i;l++){let s=n[l];_loadIcon("../../"+s.directory+"/"+s.icon).then((function(n){if(o[s.id]=n,Object.keys(o).length==i){let n=[...Object.keys(o)];n.sort(),n.forEach((function(n){t.activitiesIcons[n]=o[n],Object.keys(t.activitiesIcons).length==i&&e()}))}}))}})),_loadIcon("../../activities/XmasLights.activity/icons/random.svg").then((function(e){t.randomIcon=e}))}))},localized:function(){this.SugarL10n.localize(this.l10n)},generateGrid:function(){let t=this;t.gridContent=[];let e=document.getElementById("body").offsetHeight-(t.$refs.SugarToolbar.isHidden()?0:55),n=document.getElementById("body").offsetWidth,o=Math.floor(1*e/t.size)*Math.floor(1*n/t.size),i=Object.keys(t.activitiesIcons),l=o/i.length;for(var s=0;s<l;s++)i.forEach((function(e){let n=t.gridContent.length,o=0==t.pattern.length?e:t.pattern[n%t.pattern.length],l=t.activitiesIcons["random"==o?i[Math.floor(Math.random()*i.length)]:o],s=0==t.colors.length?n%180:t.colors[n%t.colors.length];-1==s&&(s=Math.floor(180*Math.random()));let r=t.size;t.gridContent.push({name:e,svg:l,color:s,size:r,step:0==t.colors.length?0:n%t.colors.length})}))},blink:function(){let t=this;t.interval&&(clearInterval(t.interval),t.interval=null),t.interval=setInterval((function(){if(!t.paused)for(let e=0;e<t.gridContent.length;e++){let n;0==t.colors.length?n=(t.gridContent[e].color+1)%180:(t.gridContent[e].step=(t.gridContent[e].step+1)%t.colors.length,n=t.colors[t.gridContent[e].step]),-1==n&&(n=Math.floor(180*Math.random())),t.gridContent[e].color=n}}),t.blinkTime)},onPlayPause:function(){let t=this;t.paused=!t.paused,document.getElementById("playpause-button").style.backgroundImage=t.paused?"url(icons/play.svg)":"url(icons/pause.svg)",document.getElementById("playpause-button").title=t.paused?t.l10n.stringPlay:t.l10n.stringPause},onSettingsClicked:function(){let t=this;if(t.currentView=1==t.currentView?2:1,2==t.currentView){t.detailContent.dropIcons=[];for(let e=0;e<t.pattern.length;e++)t.detailContent.dropIcons.push({id:"pi"+_getCount(),name:t.pattern[e],svg:"random"==t.pattern[e]?t.randomIcon:t.activitiesIcons[t.pattern[e]],color:512,size:40});t.detailContent.dropColors=[];for(let e=0;e<t.colors.length;e++)t.detailContent.dropColors.push({id:"pc"+_getCount(),name:e,svg:-1==t.colors[e]?t.randomIcon:t.activitiesIcons.color,color:t.colors[e],size:40});t.detailContent.dragIcons=[],t.detailContent.dragIcons.push({id:"gi"+_getCount(),name:"random",svg:t.randomIcon,color:512,size:40});let e=Object.keys(t.activitiesIcons);for(let n=0;n<e.length;n++)t.detailContent.dragIcons.push({id:"gi"+_getCount(),name:e[n],svg:t.activitiesIcons[e[n]],color:512,size:40});t.detailContent.dragColors=[],t.detailContent.dragColors.push({id:"gc"+_getCount(),name:"random",svg:t.randomIcon,color:512,size:40});for(let e=0;e<180;e++)t.detailContent.dragColors.push({id:"gc"+_getCount(),name:e,svg:t.activitiesIcons.color,color:e,size:40});t.detailContent.dragColors.push({id:"gc"+_getCount(),name:256,svg:t.activitiesIcons.color,color:256,size:40}),t.detailContent.dragColors.push({id:"gc"+_getCount(),name:512,svg:t.activitiesIcons.color,color:512,size:40})}else{t.pattern=[];for(let e=0;e<t.detailContent.dropIcons.length;e++)t.pattern.push(t.detailContent.dropIcons[e].name);t.colors=[];for(let e=0;e<t.detailContent.dropColors.length;e++){let n=t.detailContent.dropColors[e];t.colors.push("random"==n.name?-1:n.color)}t.generateGrid(),t.sendUpdateToNetwork()}},onMouseDown:function(t){let e=null;-1!=t.type.indexOf("touch")&&(t=t.changedTouches[0]);let n=document.elementFromPoint(t.clientX,t.clientY);for(;n&&!e;)"padded-icon"==n.className&&(e=n.id),n=n.parentNode;e&&(doLog("drag icon "+e),this.draggedItem=e,this.$refs.detail.className="grabbing")},onMouseMove:function(t){t.target.classList.contains("scrollable")||t.preventDefault()},onMouseUp:function(t){let e=this;if(!e.draggedItem)return void doLog("nothing to drop");-1!=t.type.indexOf("touch")&&(t=t.changedTouches[0]);let n=null,o=null,i=document.elementFromPoint(t.clientX,t.clientY);for(;i&&!n&&!o;)"padded-icon"==i.className?n=i.id:"drop-icons-zone"==i.id?o="pi":"drag-icons-zone"==i.id?o="gi":"drop-colors-zone"==i.id?o="pc":"drag-colors-zone"==i.id&&(o="gc"),i=i.parentNode;if(n)if(e.draggedItem[1]!=n[1])doLog("dropped on the wrong icon");else{doLog("dropped on icon "+n);let t="i"==e.draggedItem[1]?e.detailContent.dragIcons:e.detailContent.dragColors,o="i"==e.draggedItem[1]?e.detailContent.dropIcons:e.detailContent.dropColors;if("p"==e.draggedItem[0]&&"g"==n[0]){let t=_findItemById(o,e.draggedItem);o.splice(t,1)}else if("g"==e.draggedItem[0]&&"p"==n[0]){let i=_findItemById(o,n),l=_findItemById(t,e.draggedItem);o.splice(i,0,{id:"p"+e.draggedItem[1]+_getCount(),name:t[l].name,svg:t[l].svg,color:t[l].color,size:40})}else if("p"==e.draggedItem[0]&&"p"==n[0]&&e.dragged!=n){let t=_findItemById(o,e.draggedItem),i=o[t];o.splice(t,1);let l=_findItemById(o,n);o.splice(l,0,i)}}else if(o)if(e.draggedItem[1]!=o[1])doLog("dropped in the wrong zone");else{doLog("dropped in "+o+" zone");let t="i"==e.draggedItem[1]?e.detailContent.dragIcons:e.detailContent.dragColors,n="i"==e.draggedItem[1]?e.detailContent.dropIcons:e.detailContent.dropColors;if("g"==e.draggedItem[0]&&"p"==o[0]){let o=_findItemById(t,e.draggedItem);n.push({id:"p"+e.draggedItem[1]+_getCount(),name:t[o].name,svg:t[o].svg,color:t[o].color,size:40})}else if("p"==e.draggedItem[0]&&"g"==o[0]){let t=_findItemById(n,e.draggedItem);n.splice(t,1)}}else doLog("dropped outside");e.draggedItem=null,e.$refs.detail.className="grab"},onDeleteIconClicked:function(){this.detailContent.dropIcons=[]},onDeleteColorClicked:function(){this.detailContent.dropColors=[]},onZoomChanged:function(t){let e=this,n=t.detail.zoom,o=e.size,i=o;2==n?i=initSize:0==n?i=Math.max(30,o-10):1==n&&(i=Math.min(90,o+10)),i!=o&&(e.size=i,e.generateGrid(),e.sendUpdateToNetwork())},onTextChanged:function(t){let e=this;e.message=t.detail.value,e.messageStyle.color=t.detail.color,e.messageStyle.fontWeight=t.detail.fontWeight,e.messageStyle.fontStyle=t.detail.fontStyle,e.messageStyle.size=t.detail.size,e.sendUpdateToNetwork()},onSpeedChanged:function(t){this.blinkTime=500+10*t.detail.speed,this.blink(),this.sendUpdateToNetwork()},fullscreen:function(){this.$refs.SugarToolbar.hide(),this.generateGrid()},unfullscreen:function(){this.$refs.SugarToolbar.show(),this.generateGrid()},onStop:function(){let t=this,e={pattern:t.pattern,colors:t.colors,size:t.size,blinkTime:t.blinkTime,message:t.message,messageStyle:t.messageStyle};t.$refs.SugarJournal.saveData(e)},onTemplateSelected:function(t){let e=this,n=t.detail.value;e.pattern=n.icons,e.colors=n.colors,e.size=n.size,e.blinkTime=n.blink,e.message=n.message.content,e.messageStyle.color=n.message.color,e.messageStyle.fontWeight=n.message.weight,e.messageStyle.fontStyle=n.message.style,e.messageStyle.size=n.message.size,e.generateGrid(),e.blink(),e.sendUpdateToNetwork()},onJournalDataLoaded:function(t,e){let n=this;n.pattern=t.pattern,n.colors=t.colors,n.size=t.size,n.blinkTime=t.blinkTime,n.messageStyle=t.messageStyle,n.initialize().then((function(){document.getElementById("spinner").style.visibility="hidden",n.message=t.message,n.generateGrid(),n.blink()}))},onJournalNewInstance:function(){let t=this;t.initialize().then((function(){document.getElementById("spinner").style.visibility="hidden",t.message=initMessageContent,t.generateGrid(),t.blink()}))},onJournalSharedInstance:function(){this.initialize().then((function(){document.getElementById("spinner").style.visibility="hidden"}))},onNetworkDataReceived:function(t){let e=this;e.pattern=t.pattern,e.colors=t.colors,e.size=t.size,e.blinkTime=t.blinkTime,e.messageStyle=t.messageStyle,e.message=t.message,e.generateGrid(),e.blink()},onNetworkUserChanged:function(t){this.SugarPresence.isHost&&this.sendUpdateToNetwork()},sendUpdateToNetwork:function(){let t=this;if(!t.SugarPresence.isShared())return;let e={user:t.SugarPresence.getUserInfo(),pattern:t.pattern,colors:t.colors,size:t.size,blinkTime:t.blinkTime,message:t.message,messageStyle:t.messageStyle};this.SugarPresence.sendMessage(e)},onHelp:function(){let t=this,e=[];e=1==t.currentView?e.concat([{element:"",orphan:!0,placement:"bottom",title:t.l10n.stringTutoGridWelcomeTitle,content:t.l10n.stringTutoGridWelcomeContent},{element:"#grid",placement:"top",title:t.l10n.stringTutoGridBoardTitle,content:t.l10n.stringTutoGridBoardContent},{element:"#list-button",placement:"bottom",title:t.l10n.stringTutoGridTemplateButtonTitle,content:t.l10n.stringTutoGridTemplateButtonContent},{element:"#playpause-button",placement:"bottom",title:t.l10n.stringTutoGridPlayButtonTitle,content:t.l10n.stringTutoGridPlayButtonContent},{element:"#settings-button",placement:"bottom",title:t.l10n.stringTutoGridSettingsButtonTitle,content:t.l10n.stringTutoGridSettingsButtonContent},{element:"#speed-button",placement:"bottom",title:t.l10n.stringTutoGridSpeedButtonTitle,content:t.l10n.stringTutoGridSpeedButtonContent},{element:"#text-button",placement:"bottom",title:t.l10n.stringTutoGridTextButtonTitle,content:t.l10n.stringTutoGridTextButtonContent},{element:"#zoom-button",placement:"bottom",title:t.l10n.stringTutoGridZoomButtonTitle,content:t.l10n.stringTutoGridZoomButtonContent},{element:"#network-button",placement:"bottom",title:t.l10n.stringTutoGridNetworkButtonTitle,content:t.l10n.stringTutoGridNetworkButtonContent}]):e.concat([{element:"",orphan:!0,placement:"bottom",title:t.l10n.stringTutoDetailWelcomeTitle,content:t.l10n.stringTutoDetailWelcomeContent},{element:"#drop-icons-zone",placement:"right",title:t.l10n.stringTutoDetailDropIconTitle,content:t.l10n.stringTutoDetailDropIconContent},{element:"#drag-icons-zone",placement:"top",title:t.l10n.stringTutoDetailDragIconTitle,content:t.l10n.stringTutoDetailDragIconContent},{element:"#delete-icons-button",placement:"bottom",title:t.l10n.stringTutoDetailDeleteIconTitle,content:t.l10n.stringTutoDetailDeleteIconContent},{element:"#drop-colors-zone",placement:"left",title:t.l10n.stringTutoDetailDropColorTitle,content:t.l10n.stringTutoDetailDropColorContent},{element:"#drag-colors-zone",placement:"top",title:t.l10n.stringTutoDetailDragColorTitle,content:t.l10n.stringTutoDetailDragColorContent},{element:"#delete-colors-button",placement:"left",title:t.l10n.stringTutoDetailDeleteColorTitle,content:t.l10n.stringTutoDetailDeleteColorContent},{element:"#settings-button",placement:"bottom",title:t.l10n.stringTutoDetailGridButtonTitle,content:t.l10n.stringTutoDetailGridButtonContent}]),this.$refs.SugarTutorial.show(e)}}});function _loadActivities(){return new Promise((function(t,e){axios.get("../../activities.json").then((function(e){t(e.data)})).catch((function(t){e(t)}))}))}let idCount=1;function _getCount(){return idCount++}function _findItemById(t,e){for(let n=0;n<t.length;n++)if(t[n].id==e)return n;return-1}function _loadIcon(t){return new Promise((function(e,n){axios.get(t).then((function(t){e(t.data)})).catch((function(t){n(t)}))}))}function doLog(t){0}