define(["sugar-web/graphics/palette"],(function(t){"use strict";var e={TextPalette:function(e){t.Palette.call(this,e),this.getPalette().id="text-palette";var n=document.createElement("div"),o='<div class="row small"><label id="messageLabel">Texte:</label></div><div class="row expand"><textarea rows="8" id="editor" class="expand"></textarea></div>';o+='<div class="toolbar" id="text-style-toolbar"><button class="toolbutton" id="text-inc-size"></button><button class="toolbutton" id="text-dec-size"></button><button class="toolbutton" id="text-set-bold"></button><button class="toolbutton" id="text-set-italic"></button></div>';var r=["#000000","#ff0000","#00008b","#006400","#8b008b","#c0c0c0","#ffd700","#008000","#ff4500","#8b4513"];o+="<table><tr>";for(var l=0;l<r.length;l++)o=o+'<td><button class="color-picker" value="'+r[l]+'" style="background-color: '+r[l]+'"></button></td>',4==l&&(o+="</tr><tr>");o+="</tr></table>",n.innerHTML=o,this.setContent([n]),this.editorElem=n.querySelector("#editor"),this.colorButtons=document.querySelectorAll(".color-picker"),this.incTextBtn=n.querySelector("#text-inc-size"),this.decTextBtn=n.querySelector("#text-dec-size"),this.boldTextBtn=n.querySelector("#text-set-bold"),this.italicTextBtn=n.querySelector("#text-set-italic");var i=this,refreshColorStyle=function(){for(var t=i.colorButtons,e=0;e<=9;e++)t[e].value==i.currentColor?t[e].style.border="5px solid #696969":t[e].style.border="2px solid white";"bold"==i.currentFontWeight?document.getElementById("text-set-bold").style.backgroundColor="grey":document.getElementById("text-set-bold").style.backgroundColor="","italic"==i.currentFontStyle?document.getElementById("text-set-italic").style.backgroundColor="grey":document.getElementById("text-set-italic").style.backgroundColor=""};e.addEventListener("click",(function(t){document.getElementById("messageLabel").innerHTML=document.getElementById("text-button").title+":",i.currentMessage=i.editorElem.value=app.message,i.currentColor=app.messageStyle.color,i.currentFontWeight=app.messageStyle.fontWeight,i.currentFontStyle=app.messageStyle.fontStyle,i.currentFontSize=app.messageStyle.size,refreshColorStyle()}));var sendMessage=function(){i.textEvent.detail.color=i.currentColor,i.textEvent.detail.value=i.currentMessage,i.textEvent.detail.fontWeight=i.currentFontWeight,i.textEvent.detail.fontStyle=i.currentFontStyle,i.textEvent.detail.size=i.currentFontSize,refreshColorStyle(),i.getPalette().dispatchEvent(i.textEvent)},c=(this.editorElem,this.colorButtons);for(l=0;l<c.length;l++)c[l].addEventListener("click",(function(t){i.currentColor=this.value,sendMessage()}));this.incTextBtn.addEventListener("click",(function(t){i.currentFontSize=Math.min(100,i.currentFontSize+2),sendMessage()})),this.decTextBtn.addEventListener("click",(function(t){i.currentFontSize=Math.max(24,i.currentFontSize-2),sendMessage()})),this.boldTextBtn.addEventListener("click",(function(t){i.currentFontWeight="bold"==i.currentFontWeight?"normal":"bold",sendMessage()})),this.italicTextBtn.addEventListener("click",(function(t){i.currentFontStyle="italic"==i.currentFontStyle?"normal":"italic",sendMessage()})),this.textEvent=document.createEvent("CustomEvent"),this.textEvent.initCustomEvent("text",!0,!0,{value:""}),this.editorElem.addEventListener("input",(function(){i.currentMessage=this.value,sendMessage()}),!1)}};return e.TextPalette.prototype=Object.create(t.Palette.prototype,{addEventListener:{value:function(t,e,n){return this.getPalette().addEventListener(t,e,n)},enumerable:!0,configurable:!0,writable:!0}}),e}));