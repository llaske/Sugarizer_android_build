function encode64(t){for(var r,n,i,o,f,a,c,y="",w=0,s=t.length,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";w<s;)o=(r=t.charCodeAt(w++))>>2,f=(3&r)<<4|(n=t.charCodeAt(w++))>>4,a=(15&n)<<2|(i=t.charCodeAt(w++))>>6,c=63&i,isNaN(n)?a=c=64:isNaN(i)&&(c=64),y=y+l.charAt(o)+l.charAt(f)+l.charAt(a)+l.charAt(c);return y}LZWEncoder=function(){var t,r,n,i,o,f,a,c,y,w,s,l,B={},v=[],p=[],g=5003,A=0,m=!1,F=0,N=0,C=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],E=[],T=B.LZWEncoder=function lt(o,f,a,c){t=o,r=f,n=a,i=Math.max(2,c)},nt=function(t,r){E[l++]=t,l>=254&&Q(r)},at=function(t){tt(g),A=w+2,m=!0,e(w,t)},tt=function(t){for(var r=0;r<t;++r)v[r]=-1},D=B.compress=function yt(t,r){var n,i,o,f,B,F,N;for(m=!1,c=b(a=y=t),s=(w=1<<t-1)+1,A=w+2,l=0,f=d(),N=0,n=g;n<65536;n*=2)++N;N=8-N,tt(F=g),e(w,r);t:for(;-1!=(o=d());)if(n=(o<<12)+f,v[i=o<<N^f]!=n){if(v[i]>=0){B=F-i,0==i&&(B=1);do{if((i-=B)<0&&(i+=F),v[i]==n){f=p[i];continue t}}while(v[i]>=0)}e(f,r),f=o,A<4096?(p[i]=A++,v[i]=n):at(r)}else f=p[i];e(f,r),e(s,r)},Q=(B.encode=function(n){n.writeByte(i),o=t*r,f=0,D(i+1,n),n.writeByte(0)},function(t){l>0&&(t.writeByte(l),t.writeBytes(E,0,l),l=0)}),b=function(t){return(1<<t)-1},d=function(){return 0==o?-1:(--o,255&n[f++])},e=function(t,r){for(F&=C[N],N>0?F|=t<<N:F=t,N+=a;N>=8;)nt(255&F,r),F>>=8,N-=8;if((A>c||m)&&(m?(c=b(a=y),m=!1):(++a,c=12==a?4096:b(a))),t==s){for(;N>0;)nt(255&F,r),F>>=8,N-=8;Q(r)}};return T.apply(this,arguments),B},NeuQuant=function(){var t,r,n,i,o,f={},a=256,c=1024,y=1<<18,w=[],s=[],l=[],B=[],v=f.NeuQuant=function ht(t,f,c){var y,w;for(r=t,n=f,i=c,o=new Array(a),y=0;y<a;y++)o[y]=new Array(4),(w=o[y])[0]=w[1]=w[2]=(y<<12)/a,l[y]=256,s[y]=0},p=(f.map=function(t,r,n){var i,f,c,y,s,l,B;for(s=1e3,B=-1,f=(i=w[r])-1;i<a||f>=0;)i<a&&((c=(l=o[i])[1]-r)>=s?i=a:(i++,c<0&&(c=-c),(y=l[0]-t)<0&&(y=-y),(c+=y)<s&&((y=l[2]-n)<0&&(y=-y),(c+=y)<s&&(s=c,B=l[3])))),f>=0&&((c=r-(l=o[f])[1])>=s?f=-1:(f--,c<0&&(c=-c),(y=l[0]-t)<0&&(y=-y),(c+=y)<s&&((y=l[2]-n)<0&&(y=-y),(c+=y)<s&&(s=c,B=l[3]))));return B},f.process=function(){return function(){var o,f,a,y,w,s,l,v,p,g,A,m,F,N;for(n<1509&&(i=1),t=30+(i-1)/3,m=r,F=0,N=n,g=(A=n/(3*i))/100|0,v=c,(l=(s=2048)>>6)<=1&&(l=0),o=0;o<l;o++)B[o]=v*(256*(l*l-o*o)/(l*l));for(p=n<1509?3:n%499!=0?1497:n%491!=0?1473:n%487!=0?1461:1509,o=0;o<A;)if(a=(255&m[F+0])<<4,y=(255&m[F+1])<<4,w=(255&m[F+2])<<4,f=yt(a,y,w),at(v,f,a,y,w),0!=l&&lt(l,f,a,y,w),(F+=p)>=N&&(F-=n),0==g&&(g=1),++o%g==0)for(v-=v/t,(l=(s-=s/30)>>6)<=1&&(l=0),f=0;f<l;f++)B[f]=v*(256*(l*l-f*f)/(l*l))}(),p(),function(){var t,r,n,i,f,c,y,s;for(y=0,s=0,t=0;t<a;t++){for(n=t,i=(f=o[t])[1],r=t+1;r<a;r++)(c=o[r])[1]<i&&(n=r,i=c[1]);if(c=o[n],t!=n&&(r=c[0],c[0]=f[0],f[0]=r,r=c[1],c[1]=f[1],f[1]=r,r=c[2],c[2]=f[2],f[2]=r,r=c[3],c[3]=f[3],f[3]=r),i!=y){for(w[y]=s+t>>1,r=y+1;r<i;r++)w[r]=t;y=i,s=t}}for(w[y]=s+255>>1,r=y+1;r<256;r++)w[r]=255}(),function(){for(var t,r,n,i=[],f=new Array(a),c=0;c<a;c++)f[o[c][3]]=c;for(t=0,r=0;r<a;r++)n=f[r],i[t++]=o[n][0],i[t++]=o[n][1],i[t++]=o[n][2];return i}()},function(){for(var t=0;t<a;t++)o[t][0]>>=4,o[t][1]>>=4,o[t][2]>>=4,o[t][3]=t}),lt=function(t,r,n,i,f){var c,w,s,l,v,p,g;for((s=r-t)<-1&&(s=-1),(l=r+t)>a&&(l=a),c=r+1,w=r-1,p=1;c<l||w>s;){if(v=B[p++],c<l){g=o[c++];try{g[0]-=v*(g[0]-n)/y,g[1]-=v*(g[1]-i)/y,g[2]-=v*(g[2]-f)/y}catch(t){}}if(w>s){g=o[w--];try{g[0]-=v*(g[0]-n)/y,g[1]-=v*(g[1]-i)/y,g[2]-=v*(g[2]-f)/y}catch(t){}}}},at=function(t,r,n,i,f){var a=o[r];a[0]-=t*(a[0]-n)/c,a[1]-=t*(a[1]-i)/c,a[2]-=t*(a[2]-f)/c},yt=function(t,r,n){var i,f,c,y,w,B,v,p,g,A;for(g=p=2147483647,v=B=-1,i=0;i<a;i++)(f=(A=o[i])[0]-t)<0&&(f=-f),(c=A[1]-r)<0&&(c=-c),f+=c,(c=A[2]-n)<0&&(c=-c),(f+=c)<p&&(p=f,B=i),(y=f-(s[i]>>12))<g&&(g=y,v=i),w=l[i]>>10,l[i]-=w,s[i]+=w<<10;return l[B]+=64,s[B]-=65536,v};return v.apply(this,arguments),f},GIFEncoder=function(){function h(){this.bin=[]}for(var t=0,r={};t<256;t++)r[t]=String.fromCharCode(t);h.prototype.getData=function(){for(var t="",n=this.bin.length,i=0;i<n;i++)t+=r[this.bin[i]];return t},h.prototype.writeByte=function(t){this.bin.push(t)},h.prototype.writeUTFBytes=function(t){for(var r=t.length,n=0;n<r;n++)this.writeByte(t.charCodeAt(n))},h.prototype.writeBytes=function(t,r,n){for(var i=n||t.length,o=r||0;o<i;o++)this.writeByte(t[o])};var n,i,o,f,a,c,y,w,s,l={},B=null,v=-1,p=0,g=!1,A=[],m=7,F=-1,N=!0,C=!1,E=10,T=(l.setDelay=function(t){p=Math.round(t/10)},l.setDispose=function(t){t>=0&&(F=t)},l.setRepeat=function(t){t>=0&&(v=t)},l.setTransparent=function(t){B=t},l.addFrame=function(t,r){if(null==t||!g||null==f)throw new Error("Please call start method before calling addFrame");var n=!0;try{r?a=t:(a=t.getImageData(0,0,t.canvas.width,t.canvas.height).data,C||D(t.canvas.width,t.canvas.height)),ct(),Q(),N&&(vt(),tt(),v>=0&&lt()),st(),ot(),N||tt(),at(),N=!1}catch(t){n=!1}return n},l.finish=function(){if(!g)return!1;var t=!0;g=!1;try{f.writeByte(59)}catch(r){t=!1}return t},function(){o=0,a=null,c=null,y=null,s=null,!1,N=!0}),D=(l.setFrameRate=function(t){15!=t&&(p=Math.round(100/t))},l.setQuality=function(t){t<1&&(t=1),E=t},l.setSize=function et(t,r){(!g||N)&&((n=t)<1&&(n=320),(i=r)<1&&(i=240),C=!0)}),Q=(l.start=function(){T();var t=!0;!1,f=new h;try{f.writeUTFBytes("GIF89a")}catch(r){t=!1}return g=t},l.cont=function(){T();return!1,f=new h,g=!0},function(){var t,r,n,i,f=c.length,a=f/3;for(y=[],t=new NeuQuant(c,f,E),s=t.process(),r=0,n=0;n<a;n++)i=t.map(255&c[r++],255&c[r++],255&c[r++]),A[i]=!0,y[n]=i;c=null,w=8,m=7,null!=B&&(o=yt(B))}),yt=function(t){var r;if(null==s)return-1;var n=(16711680&t)>>16,i=(65280&t)>>8,o=255&t,f=0,a=16777216,c=s.length;for(r=0;r<c;){var y=n-(255&s[r++]),w=i-(255&s[r++]),l=o-(255&s[r]),B=y*y+w*w+l*l,v=r/3;A[v]&&B<a&&(a=B,f=v),r++}return f},ct=function(){var t,r,o,f,y,w=n,s=i;for(c=[],t=a,r=0,o=0;o<s;o++)for(f=0;f<w;f++)y=o*w*4+4*f,c[r++]=t[y],c[r++]=t[y+1],c[r++]=t[y+2]},st=function(){var t,r;f.writeByte(33),f.writeByte(249),f.writeByte(4),null==B?(t=0,r=0):(t=1,r=2),F>=0&&(r=7&F),r<<=2,f.writeByte(0|r|t),u(p),f.writeByte(o),f.writeByte(0)},ot=function(){f.writeByte(44),u(0),u(0),u(n),u(i),N?f.writeByte(0):f.writeByte(128|m)},vt=function(){u(n),u(i),f.writeByte(240|m),f.writeByte(0),f.writeByte(0)},lt=function(){f.writeByte(33),f.writeByte(255),f.writeByte(11),f.writeUTFBytes("NETSCAPE2.0"),f.writeByte(3),f.writeByte(1),u(v),f.writeByte(0)},tt=function(){var t,r;for(f.writeBytes(s),t=768-s.length,r=0;r<t;r++)f.writeByte(0)},u=function(t){f.writeByte(255&t),f.writeByte(t>>8&255)},at=function(){new LZWEncoder(n,i,y,w).encode(f)};l.stream=function(){return f},l.setProperties=function(t,r){g=t,N=r};return l};