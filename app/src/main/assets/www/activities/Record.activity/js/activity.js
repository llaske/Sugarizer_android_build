define(["sugar-web/activity/activity","sugar-web/presence","activity/capture-helper","sugar-web/datastore","webL10n","tutorial","sugar-web/env"],(function(e,t,n,a,i,o,d){requirejs(["domReady!"],(function(t){window.addEventListener("localized",(function(){if(window.l10n=i,void 0!==a&&void 0!==a.localStorage){var e=a.localStorage.getValue("sugar_settings");if(null===e||void 0===e.name)return;void 0!==e.language&&i.language.code!==e.language&&(i.language.code=e.language)}void 0!==i.get("by")&&i.get("by").length>0&&(n.by=i.get("by"))}),!1),e.setup(),d.getEnvironment((function(e,t){currentenv=t;var n="undefined"!=typeof chrome&&chrome.app&&chrome.app.runtime?chrome.i18n.getUILanguage():navigator.language,a=t.user?t.user.language:n;i.language.code=a})),"undefined"!=typeof chrome&&chrome.app&&chrome.app.runtime?chrome.storage.local.get("sugar_settings",(function(e){n.buddy_name=JSON.parse(e.sugar_settings).name})):n.buddy_name=JSON.parse(localStorage.sugar_settings).name,n.init();var l=document.getElementById("photo-button"),r=document.getElementById("audio-button"),u=document.getElementById("video-button"),s=document.getElementById("vidDisplay");l.addEventListener("click",(function(){n.helper.takePicture(),"none"==s.style.display&&(s.style.display="block")})),r.addEventListener("click",(function(){"none"!=s.style.display&&(s.style.display="none"),n.helper.recordAudio()})),u.addEventListener("click",(function(){"none"==s.style.display&&(s.style.display="block"),n.helper.recordVideo()})),document.getElementById("help-button").addEventListener("click",(function(e){o.start()})),e.getDatastoreObject().loadAsText((function(e,t,a){if(null!=a){var i=JSON.parse(a);null!=i&&(n.ids=i.ids,i.ids&&i.ids.length>0&&n.getData(i.ids,(function(e){n.displayAllData(e)})))}}))}))}));