define(["sugar-web/activity/activity","sugar-web/presence","activity/capture-helper","sugar-web/datastore","l10n","tutorial","sugar-web/env"],(function(e,t,n,i,a,o,d){requirejs(["domReady!"],(function(t){window.addEventListener("localized",(function(){window.l10n=a,void 0!==a.get("by")&&a.get("by").length>0&&(n.by=a.get("by"))}),!1),e.setup(),d.getEnvironment((function(e,t){currentenv=t;var n="undefined"!=typeof chrome&&chrome.app&&chrome.app.runtime?chrome.i18n.getUILanguage():navigator.language,i=t.user?t.user.language:n;a.init(i)})),"undefined"!=typeof chrome&&chrome.app&&chrome.app.runtime?chrome.storage.local.get("sugar_settings",(function(e){n.buddy_name=JSON.parse(e.sugar_settings).name})):n.buddy_name=JSON.parse(localStorage.sugar_settings).name,n.init();var i=document.getElementById("photo-button"),r=document.getElementById("audio-button"),l=document.getElementById("video-button"),s=document.getElementById("vidDisplay");i.addEventListener("click",(function(){n.helper.takePicture(),"none"==s.style.display&&(s.style.display="block")})),r.addEventListener("click",(function(){"none"!=s.style.display&&(s.style.display="none"),n.helper.recordAudio()})),l.addEventListener("click",(function(){"none"==s.style.display&&(s.style.display="block"),n.helper.recordVideo()})),document.getElementById("help-button").addEventListener("click",(function(e){o.start()})),e.getDatastoreObject().loadAsText((function(e,t,i){if(null!=i){var a=JSON.parse(i);null!=a&&(n.ids=a.ids,a.ids&&a.ids.length>0&&n.getData(a.ids,(function(e){n.displayAllData(e)})))}}))}))}));