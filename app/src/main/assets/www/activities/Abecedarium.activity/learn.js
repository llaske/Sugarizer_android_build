var entriesByScreen=8;enyo.kind({name:"Abcd.Learn",kind:enyo.Control,classes:"board",published:{context:null},components:[{components:[{name:"colorBar",classes:"colorBar"},{name:"home",kind:"Abcd.HomeButton"},{name:"startSlideshow",kind:"Image",src:"images/slideshow.png",showing:!1,ontap:"startSlideshow",classes:"standardButton slideshow"},{name:"stopSlideshow",kind:"Image",src:"images/pause.png",showing:!1,ontap:"stopSlideshow",classes:"standardButton slideshow"},{kind:"Abcd.CaseButton"},{kind:"Abcd.LanguageButton"}]},{components:[{name:"pageCount",content:"-/-",classes:"pageCount",showing:!1},{name:"back",kind:"Image",src:"images/back.png",showing:!1,classes:"standardButton backButton",ontap:"backTaped"},{name:"prev",kind:"Image",src:"images/previous.png",showing:!1,classes:"standardButton prevButton",ontap:"displayPrevEntries"},{name:"next",kind:"Image",src:"images/next.png",showing:!1,classes:"standardButton nextButton",ontap:"displayNextEntries"}]},{name:"box",classes:"learnBox",components:[]}],create:function(){this.inherited(arguments),this.theme=this.collection=this.entry=this.position=-1,this.collections=[],this.playing=null,this.slideshowIndex=-1,this.exportPNG=enyo.bind(this,"clickExportPNG"),this.exportSOUND=enyo.bind(this,"clickExportSOUND"),this.restoreContext(),-1!=this.theme?4==this.theme?this.displayLetters({letter:this.collection}):-1!=this.collection?this.displayEntries({index:this.collection}):this.displayCollections({index:this.theme}):this.displayThemes()},restoreContext:function(){if(null!=this.context&&""!=this.context){var t=this.context.split("|");this.theme=t[0],this.collection=t[1],this.entry=parseInt(t[2])}},saveContext:function(){var t=[];return t.push(this.theme),t.push(this.collection),t.push(this.position),t.join("|")},setLocale:function(){var t=this.$.box.getControls()[0];if("Abcd.Entry"==t.kind)return this.entry=-1,void(4!=this.theme?this.displayEntries({index:Abcd.entries[t.index].coll}):this.displayLetters({letter:this.collection}));enyo.forEach(this.$.box.getControls(),(function(t){"Control"!=t.kind&&t.setLocale()}))},setCase:function(){enyo.forEach(this.$.box.getControls(),(function(t){"hidden"==document.getElementById("main-toolbar").style.visibility&&Abcd.changeVisibility({switchToEnglish:!1,switchToFrench:!1,switchToSpanish:!1}),"Abcd.Letter"==t.kind?t.letterChanged():"Control"!=t.kind&&t.indexChanged()}))},clickExportPNG:function(){var t;t=document.getElementById("png-button").classList.contains("active")?0:1,this.putEntriesJournalModeTo(t)},clickExportSOUND:function(){var t;t=document.getElementById("sound-button").classList.contains("active")?0:2,this.putEntriesJournalModeTo(t)},putEntriesJournalModeTo:function(t){1==t?(document.getElementById("png-button").classList.add("active"),document.getElementById("sound-button").classList.remove("active")):2==t?(document.getElementById("sound-button").classList.add("active"),document.getElementById("png-button").classList.remove("active")):(document.getElementById("png-button").classList.remove("active"),document.getElementById("sound-button").classList.remove("active")),enyo.forEach(this.$.box.getControls(),(function(e){"Abcd.Entry"==e.kind&&(e.tojournal=t,e.tojournalChanged())}))},displayThemes:function(){this.theme=-1;var t=Abcd.themes.length;this.cleanBox(),this.$.box.addClass("box-4-theme"),this.$.box.createComponent({classes:"linebreak"}).render(),Abcd.changeVisibility(this,{home:!0,back:!1,prev:!1,next:!1,pageCount:!1,startSlideshow:!1,stopSlideshow:!1}),document.getElementById("png-button").style.visibility="hidden",document.getElementById("sound-button").style.visibility="hidden",document.getElementById("png-button").classList.remove("active"),document.getElementById("sound-button").classList.remove("active"),document.getElementById("png-button").removeEventListener("click",this.exportPNG),document.getElementById("sound-button").removeEventListener("click",this.exportSOUND),this.$.colorBar.addClass("themeColor"+this.theme);for(var e=0;e<t;e++)this.$.box.createComponent({kind:"Abcd.Theme",index:e,ontap:"displayCollections"},{owner:this}).render();this.$.box.createComponent({classes:"linebreak"}).render();for(e=0;e<26;e++)this.$.box.createComponent({kind:"Abcd.Letter",letter:String.fromCharCode(65+e),ontap:"displayLetters"},{owner:this}).render();Abcd.saveContext()},displayCollections:function(t,e){this.theme=t.index;var n=Abcd.collections.length;this.cleanBox(),Abcd.changeVisibility(this,{home:!1,back:!0,prev:!1,next:!1,pageCount:!1,startSlideshow:!1,stopSlideshow:!1}),this.$.colorBar.removeClass("themeColor-1"),this.$.colorBar.addClass("themeColor"+this.theme),this.$.box.removeClass("box-4-theme"),this.$.box.addClass("box-4-collection"),document.getElementById("png-button").style.visibility="hidden",document.getElementById("sound-button").style.visibility="hidden",document.getElementById("png-button").classList.remove("active"),document.getElementById("sound-button").classList.remove("active"),document.getElementById("png-button").removeEventListener("click",this.exportPNG),document.getElementById("sound-button").removeEventListener("click",this.exportSOUND),this.$.box.createComponent({classes:"linebreak"}).render(),this.$.box.createComponent({classes:"linebreak"}).render();for(var s=0;s<n;s++)Abcd.collections[s].theme==this.theme&&this.$.box.createComponent({kind:"Abcd.Collection",index:s,ontap:"displayEntries"},{owner:this}).render();Abcd.saveContext()},displayEntries:function(t,e){this.$.box.removeClass("box-4-collection"),this.$.colorBar.addClass("themeColor"+this.theme);var n=t.index;this.collection=n,this.collections=[];for(var s=Abcd.collections[n].entries.length,i=0;i<s;i++){var o=Abcd.collections[n].entries[i];1==Abcd.entries[o][Abcd.context.lang]&&this.collections.push(o)}this.displayEntriesFrom(this.entry+1)},displayLetters:function(t,e){void 0!==t.kind&&t.play(Abcd.sound),this.collection=t.letter,void 0!==Abcd.letters[this.collection]&&(this.collections=Abcd.letters[this.collection],this.theme=4,this.$.colorBar.addClass("themeColor"+this.theme),this.$.box.removeClass("box-4-theme"),document.getElementById("png-button").style.visibility="hidden",document.getElementById("sound-button").style.visibility="hidden",document.getElementById("png-button").classList.remove("active"),document.getElementById("sound-button").classList.remove("active"),document.getElementById("png-button").removeEventListener("click",this.exportPNG),document.getElementById("sound-button").removeEventListener("click",this.exportSOUND),this.displayEntriesFrom(this.entry+1))},displayEntriesFrom:function(t){this.cleanBox(),this.$.box.addClass("box-4-entry"),Abcd.changeVisibility(this,{home:!1,back:!0,pageCount:!0,startSlideshow:!0,stopSlideshow:!1}),length=this.collections.length;for(var e=0,n=t;n<length&&(this.$.box.createComponent({kind:"Abcd.Entry",index:this.collections[n],ontap:"play",onEntrySoundEnded:"soundEnd"},{owner:this}).render(),this.entry=n,++e!=entriesByScreen);n++);0!=t?this.$.prev.show():this.$.prev.hide(),this.entry+1<length?this.$.next.show():this.$.next.hide(),this.$.pageCount.setContent(Math.ceil(n/entriesByScreen)+"/"+Math.ceil(length/entriesByScreen)),this.position=t-1,document.getElementById("png-button").style.visibility="visible",document.getElementById("sound-button").style.visibility="visible",document.getElementById("png-button").addEventListener("click",this.exportPNG),document.getElementById("sound-button").addEventListener("click",this.exportSOUND),Abcd.saveContext()},displayNextEntries:function(){this.entry+1<this.collections.length&&this.displayEntriesFrom(this.entry+1)},displayPrevEntries:function(){this.displayEntriesFrom(Math.max(0,this.entry-entriesByScreen-this.entry%entriesByScreen))},backTaped:function(){var t=this.$.box.getControls()[0];if(this.entry=-1,"Abcd.Entry"==t.kind&&4!=this.theme)return this.collection=-1,this.displayCollections({index:this.theme}),void this.$.box.removeClass("box-4-entry");this.$.colorBar.removeClass("themeColor"+this.theme),this.$.box.removeClass("box-4-collection"),this.displayThemes()},cleanBox:function(){var t=[];enyo.forEach(this.$.box.getControls(),(function(e){t.push(e)}));for(var e=0;e<t.length;e++)t[e].destroy()},startSlideshow:function(t,e){this.slideshowIndex=0,Abcd.changeVisibility(this,{startSlideshow:!1,stopSlideshow:!0});var n=this.$.box.getControls()[this.slideshowIndex];this.play(n)},stopSlideshow:function(t,e){this.slideshowIndex=-1,Abcd.changeVisibility(this,{startSlideshow:!0,stopSlideshow:!1})},play:function(t,e){null!=this.playing&&this.playing.abort(),this.playing=t;var n=t.tojournal;t.play(Abcd.sound),n&&this.putEntriesJournalModeTo(!1)},soundEnd:function(t,e){if(this.playing=null,-1!=this.slideshowIndex){var n=this.$.box.getControls()[++this.slideshowIndex];void 0!==n?this.play(n):this.stopSlideshow()}}});