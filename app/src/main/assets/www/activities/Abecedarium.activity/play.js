var entriesByGame=4;enyo.kind({name:"Abcd.Play",kind:enyo.Control,classes:"board",published:{context:null},components:[{kind:"Signals",onEndOfSound:"endSound"},{components:[{name:"colorBar",classes:"colorBar"},{name:"home",kind:"Abcd.HomeButton"},{kind:"Abcd.CaseButton"},{kind:"Abcd.LanguageButton"}]},{components:[{name:"filterLetter",kind:"Abcd.Letter",letter:"",classes:"filterLetter"},{name:"filterCollection",kind:"Abcd.Collection",index:0,classes:"filterCollection",showing:!1},{name:"itemCount",content:"-/-",classes:"itemCount",showing:!1},{name:"back",kind:"Image",src:"images/back.png",showing:!1,classes:"standardButton backButton",ontap:"backTaped"},{name:"filter",kind:"Image",src:"images/filter.png",showing:!1,classes:"standardButton filterButton",ontap:"filterTaped"},{name:"check",kind:"Image",src:"images/check.png",showing:!1,classes:"standardButton checkButton",ontap:"checkTaped"},{name:"gameFinished",kind:"Control",showing:!1,classes:"gameFinished",components:[{name:"gameFinishedMsg",content:"",classes:"gameFinsihed-message"},{classes:"gameFinished-controls",components:[{name:"replay",kind:"Image",src:"images/redo.svg",classes:"standardButton replayButton",ontap:"replayTaped"},{name:"backToSelection",kind:"Image",src:"images/back.png",classes:"standardButton backButton backSelection",ontap:"backToSelectionTaped"}]}]}]},{name:"box",classes:"playbox",components:[]},{name:"filterPopup",kind:"Abcd.FilterPopup",onFilterChanged:"filterChanged"}],create:function(){this.inherited(arguments),this.theme=-1,this.themeButton=null,this.gamecount=0,this.playing=null,this.from=null,this.selected=null,this.forbidentry=!1,this.filter=null,this.restoreContext(),this.filterChanged({filter:this.filter}),-1!=this.theme?this.doGame(this.themeButton):this.displayButtons(),this.gamecount===entriesByGame&&this.showGameFinished()},restoreContext:function(){if(null!=this.context&&""!=this.context){var e=this.context.split("|");this.theme=e[0],this.gamecount=parseInt(e[1]),this.themeButton={from:e[2],to:e[3]},""!=e[4]&&(this.filter={kind:e[4],index:e[5],letter:e[5]})}},saveContext:function(){var e=[];return e.push(this.theme),e.push(this.gamecount),null!=this.themeButton?(e.push(this.themeButton.from),e.push(this.themeButton.to)):(e.push(""),e.push("")),null!=this.filter?(e.push(this.filter.kind),e.push("Abcd.Letter"==this.filter.kind?this.filter.letter:this.filter.index)):(e.push(""),e.push("")),e.join("|")},cleanBox:function(){var e=[];enyo.forEach(this.$.box.getControls(),(function(t){e.push(t)}));for(var t=0;t<e.length;t++)e[t].destroy()},displayButtons:function(){this.cleanBox(),Abcd.changeVisibility(this,{home:!0,back:!1,filter:!0,check:!1,itemCount:!1}),this.$.colorBar.removeClass("themeColor"+this.theme),this.theme=-1,this.$.colorBar.addClass("themeColor"+this.theme),null==this.filter&&this.$.filterLetter.hide(),this.$.box.createComponent({kind:"Abcd.PlayTypeButton",from:"picture",to:"letter"+Abcd.context.casevalue,ontap:"doGame",theme:"play-button-color1"},{owner:this}).render(),this.$.box.createComponent({kind:"Abcd.PlayTypeButton",from:"picture",to:"listen",ontap:"doGame",theme:"play-button-color1"},{owner:this}).render(),this.$.box.createComponent({kind:"Abcd.PlayTypeButton",from:"letter"+Abcd.context.casevalue,to:"picture",ontap:"doGame",theme:"play-button-color2"},{owner:this}).render(),this.$.box.createComponent({kind:"Abcd.PlayTypeButton",from:"letter"+Abcd.context.casevalue,to:"listen",ontap:"doGame",theme:"play-button-color2"},{owner:this}).render(),this.$.box.createComponent({kind:"Abcd.PlayTypeButton",from:"listen",to:"picture",ontap:"doGame",theme:"play-button-color3"},{owner:this}).render(),this.$.box.createComponent({kind:"Abcd.PlayTypeButton",from:"listen",to:"letter"+Abcd.context.casevalue,ontap:"doGame",theme:"play-button-color3"},{owner:this}).render()},setLocale:function(){this.filter=null,this.$.filterLetter.hide(),this.$.filterCollection.hide(),-1!=this.theme&&this.computeGame()},setCase:function(){enyo.forEach(this.$.box.getControls(),(function(e){"Abcd.Entry"==e.kind?e.indexChanged():e.setCase()})),null!=this.filter&&("Abcd.Letter"==this.filter.kind?this.$.filterLetter.letterChanged():this.$.filterCollection.indexChanged())},filterTaped:function(){this.$.filterPopup.display(this.filter)},filterChanged:function(e,t){this.filter=e.filter,this.$.filterLetter.hide(),this.$.filterCollection.hide(),null!=this.filter&&("Abcd.Letter"==this.filter.kind?(this.$.filterLetter.show(),this.$.filterLetter.setLetter(this.filter.letter)):(this.$.filterCollection.show(),this.$.filterCollection.setIndex(this.filter.index)))},convertToEntryOption:function(e){return{soundonly:"listen"==e,imageonly:"picture"==e,textonly:"letter"==e.substr(0,6)}},doGame:function(e,t){Abcd.changeVisibility(this,{home:!1,back:!0,filter:!1,check:!0,itemCount:!0}),this.themeButton=e,"picture"==this.themeButton.from?this.theme=5:"listen"==this.themeButton.from?this.theme=7:this.theme=6,this.$.colorBar.removeClass("themeColor-1"),this.$.colorBar.addClass("themeColor"+this.theme),this.computeGame()},computeGame:function(){this.cleanBox(),this.forbidentry=!1,this.$.itemCount.setContent(this.gamecount+1+"/"+entriesByGame);var e=Abcd.randomEntryIndex(void 0,this.filter),t=this.convertToEntryOption(this.themeButton.from),n=this.from=this.$.box.createComponent({kind:"Abcd.Entry",index:e,soundonly:t.soundonly,imageonly:t.imageonly,textonly:t.textonly,ontap:"entryTaped"},{owner:this});n.addClass("entryPlayFrom"),n.render(),t.soundonly&&(this.playing=n,this.playing.play(Abcd.sound));var i=[];i.push(e);for(var s=0;s<2;s++){var o=Abcd.randomEntryIndex(i,this.filter);i.push(o)}var l=(i=Abcd.mix(i)).length;for(s=0;s<l;s++){t=this.convertToEntryOption(this.themeButton.to);var a=this.$.box.createComponent({kind:"Abcd.Entry",index:i[s],soundonly:t.soundonly,imageonly:t.imageonly,textonly:t.textonly,ontap:"entryTaped"},{owner:this});a.addClass("entryPlayTo"),a.render()}Abcd.saveContext()},entryTaped:function(e,t){this.forbidentry||(e.soundonly&&(null!=this.playing&&this.playing.abort(),this.playing=e,this.playing.play(Abcd.sound)),e.hasClass("entryPlayFrom")||e.hasClass("entryPlaySelected")||(null!=this.selected&&this.selected.removeClass("entryPlaySelected"),e.addClass("entryPlaySelected"),this.selected=e))},showGameFinished:function(){this.cleanBox(),Abcd.changeVisibility(this,{home:!1,back:!1,filter:!1,check:!1,itemCount:!1}),Abcd.hideLang(),this.$.caseButton.hide(),this.$.colorBar.removeClass("themeColor"+this.theme),this.$.colorBar.addClass("themeColor-1");var e=this;requirejs(["webL10n"],(function(t){e.$.gameFinishedMsg.setContent(t.get("GameFinised"))})),this.$.gameFinished.show()},hideGameFinished:function(){this.$.gameFinished.hide(),Abcd.showLang(),this.$.caseButton.show()},replayTaped:function(){this.hideGameFinished(),Abcd.changeVisibility(this,{home:!1,back:!0,filter:!1,check:!0,itemCount:!0}),this.gamecount=0,this.computeGame()},backToSelectionTaped:function(){this.hideGameFinished(),this.backTaped()},backTaped:function(){this.$.colorBar.removeClass("themeColor"+this.theme),this.theme=-1,this.gamecount=0,this.selected=null,this.displayButtons()},checkTaped:function(){this.forbidentry=!0,null!=this.playing&&this.playing.abort(),null==this.selected?(Abcd.sound.play("audio/disappointed"),this.selected=this.from,this.selected.addClass("entryPlayWrong")):this.selected.index==this.from.index?(Abcd.sound.play("audio/applause"),this.selected.removeClass("entryPlaySelected"),this.selected.addClass("entryPlayRight")):(Abcd.sound.play("audio/disappointed"),this.selected.removeClass("entryPlaySelected"),this.selected.addClass("entryPlayWrong"))},endSound:function(e,t){null!=this.selected&&("audio/disappointed"==t.sound?(this.selected.removeClass("entryPlaySelected"),this.selected.removeClass("entryPlayWrong"),this.selected=null,this.forbidentry=!1):"audio/applause"==t.sound&&(this.selected.removeClass("entryPlaySelected"),this.selected.removeClass("entryPlayRight"),this.selected=null,++this.gamecount==entriesByGame?this.showGameFinished():this.computeGame()))}});