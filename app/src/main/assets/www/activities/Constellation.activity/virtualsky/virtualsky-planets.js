/*!
 * Virtual Sky add on to display planets without 
 * needing a file regularly updated from JPL Horizons
 * Written by Stuart Lowe (http://www.strudel.org.uk/)
 */
!function(e){function Planets(){return this.planets=[{name:"Me",radius:2439.7,interval:.5,colour:"rgb(170,150,170)",magnitude:function(e){return 5*log10(e.r*e.R)-.36+.027*e.FV+22e-14*Math.pow(e.FV,6)},elements:[{jd:2456280.5,i:7.0053,o:48.485,p:77.658,a:.3871,n:4.09232,e:.205636,L:191.7001},{jd:2456320.5,i:7.0052,o:48.486,p:77.661,a:.387097,n:4.09236,e:.205644,L:355.3943},{jd:2456360.5,i:7.0052,o:48.487,p:77.663,a:.387098,n:4.09235,e:.205646,L:159.0899},{jd:2456400.5,i:7.0052,o:48.489,p:77.665,a:.387097,n:4.09236,e:.205649,L:322.7854},{jd:2456440.5,i:7.0052,o:48.49,p:77.665,a:.387097,n:4.09236,e:.20565,L:126.4812},{jd:2456480.5,i:7.0052,o:48.492,p:77.667,a:.387098,n:4.09235,e:.205645,L:290.1771},{jd:2456520.5,i:7.0052,o:48.493,p:77.669,a:.387098,n:4.09235,e:.205645,L:93.8725},{jd:2456560.5,i:7.0052,o:48.494,p:77.671,a:.387098,n:4.09235,e:.205642,L:257.5683},{jd:2456600.5,i:7.0052,o:48.495,p:77.672,a:.387099,n:4.09234,e:.205635,L:61.2628},{jd:2456640.5,i:7.0052,o:48.497,p:77.674,a:.387099,n:4.09233,e:.205635,L:224.9579},{jd:2456680.5,i:7.0052,o:48.498,p:77.677,a:.387098,n:4.09234,e:.205633,L:28.6524}]},{name:"V",radius:6051.9,interval:1,colour:"rgb(245,222,179)",magnitude:function(e){return 5*log10(e.a*e.R)-4.34+.013*e.FV+42e-8*Math.pow(e.FV,3)},elements:[{jd:2456280.5,i:3.3949,o:76.797,p:132,a:.723328,n:1.60214,e:.006777,L:209.0515},{jd:2456320.5,i:3.3949,o:76.798,p:132.05,a:.723332,n:1.60213,e:.00678,L:273.138},{jd:2456360.5,i:3.3949,o:76.799,p:132.07,a:.723327,n:1.60215,e:.006787,L:337.2248},{jd:2456400.5,i:3.3949,o:76.801,p:132.03,a:.723331,n:1.60214,e:.006785,L:41.3121},{jd:2456440.5,i:3.3949,o:76.802,p:131.97,a:.723333,n:1.60213,e:.00678,L:105.398},{jd:2456480.5,i:3.3949,o:76.803,p:131.96,a:.723325,n:1.60216,e:.006769,L:169.4851},{jd:2456520.5,i:3.3949,o:76.804,p:131.99,a:.723327,n:1.60215,e:.006769,L:233.5729},{jd:2456560.5,i:3.3949,o:76.806,p:132.03,a:.723328,n:1.60214,e:.00677,L:297.6598},{jd:2456600.5,i:3.3949,o:76.807,p:132.03,a:.723326,n:1.60215,e:.006775,L:1.7475},{jd:2456640.5,i:3.3949,o:76.808,p:131.89,a:.723337,n:1.60211,e:.006775,L:65.8345},{jd:2456680.5,i:3.3948,o:76.808,p:131.63,a:.723345,n:1.60209,e:.00677,L:129.9169}]},{name:"E",elements:[{jd:2450680.5,i:41e-5,o:349.2,p:102.8517,a:1.00002,n:.9855796,e:.0166967,L:328.40353},{jd:2456280.5,i:0,o:349.2,p:103.042,a:1.000008,n:.985598,e:.016703,L:87.995},{jd:2456320.5,i:0,o:349.2,p:103.005,a:.999986,n:.985631,e:.016682,L:127.4201},{jd:2456360.5,i:0,o:349.2,p:102.99,a:.999978,n:.985642,e:.016675,L:166.8472},{jd:2456400.5,i:0,o:349.2,p:103.022,a:.999987,n:.98563,e:.016677,L:206.274},{jd:2456440.5,i:0,o:349.2,p:103.077,a:1,n:.985611,e:.016677,L:245.6993},{jd:2456480.5,i:0,o:349.2,p:103.119,a:1.000005,n:.985603,e:.016675,L:285.1238},{jd:2456520.5,i:0,o:349.2,p:103.147,a:1,n:.985611,e:.016679,L:324.5489},{jd:2456560.5,i:0,o:349.2,p:103.161,a:.999995,n:.985618,e:.016682,L:3.9752},{jd:2456600.5,i:0,o:349.2,p:103.146,a:1.000002,n:.985608,e:.01669,L:43.402},{jd:2456640.5,i:0,o:349.2,p:103.135,a:1.00001,n:.985596,e:.016698,L:82.8279},{jd:2456680.5,i:0,o:349.2,p:103.166,a:1.000005,n:.985603,e:.016693,L:122.2544}]},{name:"Ma",radius:3386,interval:1,colour:"rgb(255,50,50)",magnitude:function(e){return 5*log10(e.r*e.R)-1.51+.016*e.FV},elements:[{jd:2450680.5,i:1.84992,o:49.5664,p:336.0882,a:1.5236365,n:.5240613,e:.0934231,L:262.42784},{jd:2456280.5,i:1.8497,o:49.663,p:336.246,a:1.523624,n:.524069,e:.093285,L:317.1847},{jd:2456320.5,i:1.8497,o:49.664,p:336.249,a:1.523605,n:.524079,e:.093274,L:338.1493},{jd:2456360.5,i:1.8497,o:49.665,p:336.255,a:1.523601,n:.524081,e:.093269,L:359.115},{jd:2456400.5,i:1.8497,o:49.666,p:336.268,a:1.523627,n:.524068,e:.093276,L:20.0806},{jd:2456440.5,i:1.8497,o:49.667,p:336.287,a:1.523678,n:.524041,e:.093292,L:41.0443},{jd:2456480.5,i:1.8496,o:49.668,p:336.306,a:1.523731,n:.524014,e:.093316,L:62.0048},{jd:2456520.5,i:1.8496,o:49.668,p:336.322,a:1.523762,n:.523998,e:.093346,L:82.9625},{jd:2456560.5,i:1.8495,o:49.666,p:336.329,a:1.523748,n:.524005,e:.093385,L:103.9196},{jd:2456600.5,i:1.8495,o:49.665,p:336.333,a:1.523709,n:.524025,e:.093425,L:124.8784},{jd:2456640.5,i:1.8495,o:49.665,p:336.333,a:1.523665,n:.524048,e:.093458,L:145.8405},{jd:2456680.5,i:1.8495,o:49.665,p:336.33,a:1.523631,n:.524066,e:.093482,L:166.8051}]},{name:"J",radius:69173,interval:10,colour:"rgb(255,150,150)",magnitude:function(e){return 5*log10(e.r*e.R)-9.25+.014*e.FV},elements:[{jd:2456280.5,i:1.3033,o:100.624,p:14.604,a:5.20269,n:.083094,e:.048895,L:68.0222},{jd:2456320.5,i:1.3033,o:100.624,p:14.591,a:5.20263,n:.083095,e:.048893,L:71.3469},{jd:2456360.5,i:1.3033,o:100.625,p:14.588,a:5.20262,n:.083095,e:.048895,L:74.6719},{jd:2456400.5,i:1.3033,o:100.626,p:14.589,a:5.20262,n:.083095,e:.048896,L:77.9971},{jd:2456440.5,i:1.3033,o:100.627,p:14.586,a:5.20259,n:.083096,e:.048892,L:81.3228},{jd:2456480.5,i:1.3033,o:100.628,p:14.568,a:5.2025,n:.083098,e:.048888,L:84.6481},{jd:2456520.5,i:1.3033,o:100.629,p:14.556,a:5.20245,n:.083099,e:.048892,L:87.9728},{jd:2456560.5,i:1.3033,o:100.63,p:14.555,a:5.20245,n:.083099,e:.048901,L:91.2973},{jd:2456600.5,i:1.3033,o:100.631,p:14.576,a:5.20254,n:.083097,e:.048907,L:94.6223},{jd:2456640.5,i:1.3033,o:100.632,p:14.593,a:5.20261,n:.083096,e:.048901,L:97.9485},{jd:2456680.5,i:1.3033,o:100.633,p:14.592,a:5.20259,n:.083096,e:.048891,L:101.2751}]},{name:"S",radius:57316,interval:10,colour:"rgb(200,150,150)",magnitude:function(e){for(var n=Math.atan2(e.y,e.x),a=Math.atan2(e.z,Math.sqrt(e.x*e.x+e.y*e.y));n<0;)n+=2*Math.PI;for(;n>=360;)n-=2*Math.PI;var t=28.06*e.d2r,i=e.d2r*(169.51+382e-7*(e.jd-2451543.5)),o=Math.asin(Math.sin(a)*Math.cos(t)-Math.cos(a)*Math.sin(t)*Math.sin(n-i));return 5*log10(e.r*e.R)-9+.044*e.FV+(-2.6*Math.sin(Math.abs(o))+1.2*Math.pow(Math.sin(o),2))},elements:[{jd:2456280.5,i:2.4869,o:113.732,p:90.734,a:9.51836,n:.033583,e:.055789,L:208.6057},{jd:2456320.5,i:2.4869,o:113.732,p:90.856,a:9.51931,n:.033578,e:.055791,L:209.943},{jd:2456360.5,i:2.4869,o:113.732,p:90.979,a:9.52024,n:.033574,e:.055794,L:211.2797},{jd:2456400.5,i:2.4869,o:113.733,p:91.105,a:9.52121,n:.033568,e:.055793,L:212.6162},{jd:2456440.5,i:2.4869,o:113.732,p:91.245,a:9.52234,n:.033562,e:.055779,L:213.9525},{jd:2456480.5,i:2.4869,o:113.732,p:91.38,a:9.52349,n:.033556,e:.05575,L:215.2901},{jd:2456520.5,i:2.4869,o:113.732,p:91.5,a:9.5245,n:.033551,e:.055724,L:216.6279},{jd:2456560.5,i:2.487,o:113.732,p:91.611,a:9.52541,n:.033546,e:.055704,L:217.9654},{jd:2456600.5,i:2.487,o:113.732,p:91.727,a:9.5263,n:.033541,e:.055691,L:219.3014},{jd:2456640.5,i:2.487,o:113.732,p:91.87,a:9.52748,n:.033535,e:.055657,L:220.6368},{jd:2456680.5,i:2.487,o:113.733,p:92.021,a:9.52885,n:.033528,e:.0556,L:221.973}]},{name:"U",radius:25266,interval:20,colour:"rgb(130,150,255)",magnitude:function(e){return 5*log10(e.r*e.R)-7.15+.001*e.FV},elements:[{jd:2456280.5,i:.7726,o:74.004,p:169.227,a:19.2099,n:.011713,e:.046728,L:9.14},{jd:2456320.5,i:.7727,o:74.001,p:169.271,a:19.2064,n:.011716,e:.046913,L:9.6133},{jd:2456360.5,i:.7727,o:73.997,p:169.314,a:19.203,n:.01172,e:.047102,L:10.0873},{jd:2456400.5,i:.7727,o:73.991,p:169.364,a:19.1994,n:.011723,e:.047297,L:10.561},{jd:2456440.5,i:.7728,o:73.989,p:169.434,a:19.1953,n:.011727,e:.047509,L:11.034},{jd:2456480.5,i:.7728,o:73.989,p:169.522,a:19.1916,n:.01173,e:.047703,L:11.5048},{jd:2456520.5,i:.7728,o:73.989,p:169.602,a:19.1882,n:.011733,e:.047874,L:11.9756},{jd:2456560.5,i:.7728,o:73.989,p:169.674,a:19.185,n:.011736,e:.048035,L:12.447},{jd:2456600.5,i:.7728,o:73.985,p:169.74,a:19.1816,n:.011739,e:.048215,L:12.92},{jd:2456640.5,i:.7728,o:73.984,p:169.836,a:19.1774,n:.011743,e:.048431,L:13.392},{jd:2456680.5,i:.7728,o:73.983,p:169.962,a:19.1729,n:.011747,e:.04865,L:13.8617}]},{name:"N",radius:24553,interval:20,colour:"rgb(100,100,255)",magnitude:function(e){return 5*log10(e.r*e.R)-6.9+.001*e.FV},elements:[{jd:2456280.5,i:1.7686,o:131.93,p:53.89,a:30.0401,n:.00599,e:.010281,L:333.6121},{jd:2456320.5,i:1.7687,o:131.932,p:55.15,a:30.0331,n:.005992,e:.010207,L:333.8487},{jd:2456360.5,i:1.7688,o:131.935,p:56.47,a:30.0259,n:.005994,e:.010138,L:334.0856},{jd:2456400.5,i:1.7688,o:131.937,p:57.82,a:30.0185,n:.005996,e:.010067,L:334.322},{jd:2456440.5,i:1.769,o:131.94,p:59.24,a:30.0108,n:.005999,e:.009985,L:334.5566},{jd:2456480.5,i:1.7691,o:131.943,p:60.44,a:30.0044,n:.006,e:.009894,L:334.7895},{jd:2456520.5,i:1.7692,o:131.946,p:61.52,a:29.9987,n:.006002,e:.009816,L:335.0233},{jd:2456560.5,i:1.7693,o:131.949,p:62.57,a:29.9932,n:.006004,e:.009748,L:335.2581},{jd:2456600.5,i:1.7694,o:131.951,p:63.84,a:29.9867,n:.006006,e:.00969,L:335.4937},{jd:2456640.5,i:1.7695,o:131.954,p:65.29,a:29.9793,n:.006008,e:.009609,L:335.7265},{jd:2456680.5,i:1.7697,o:131.957,p:66.66,a:29.9725,n:.00601,e:.009508,L:335.9564}]}],this.d2r=Math.PI/180,this.r2d=180/Math.PI,this.AUinkm=149597870.7,this}function log10(e){return Math.LOG10E*Math.log(e)}Planets.prototype.build=function(e,n){var a=new Array(this.planets.length-1),t=0;n||(n=365.25);for(var i=0;i<this.planets.length;i++)this.planets[i].colour&&(a[t++]=this.buildPlanet(i,e,n));return a},Planets.prototype.buildPlanet=function(e,n,a){var t,i,o,r,s;if("number"==typeof e)t=e;else{for(var p=-1,d=0;d<this.planets.length;d++)this.planets[d].name==e&&(p=d);if(p<0)return this;if(2==p)return this;t=p}o="number"==typeof this.planets[t].interval?this.planets[t].interval:1,r=Math.floor(a/o);var h=new Array(3);h[0]=this.planets[t].name,h[1]=this.planets[t].colour,h[2]=new Array(4*r),s=n;for(var l=0;l<r;l++)s+=o,i=this.getEphem(t,s),h[2][4*l+0]=s,h[2][4*l+1]=i[0],h[2][4*l+2]=i[1],h[2][4*l+3]=i[2];return h},Planets.prototype.getEphem=function(e,n){var a,t,i,o,r,s,p,d,h,l,j,L;if("number"==typeof e)a=e;else{for(var u=-1,M=0;M<this.planets.length;M++)this.planets[M].name==e&&(u=M);if(u<0)return this;if(2==u)return this;a=u}t=this.getHeliocentric(this.planets[a],n),i=this.getHeliocentric(this.planets[2],n),o=t.xyz[0]-i.xyz[0],r=t.xyz[1]-i.xyz[1],s=t.xyz[2]-i.xyz[2],p=23.439292*this.d2r,d=[o,r*Math.cos(p)-s*Math.sin(p),r*Math.sin(p)+s*Math.cos(p)],h=Math.atan(d[1]/d[0])*this.r2d,d[0]<0&&(h+=180),d[0]>=0&&d[1]<0&&(h+=360),l=Math.atan(d[2]/Math.sqrt(d[0]*d[0]+d[1]*d[1]))*this.r2d,j=Math.sqrt(d[0]*d[0]+d[1]*d[1]+d[2]*d[2]);this.planets[a].radius,this.AUinkm;return 1,L=Math.acos((t.r*t.r+j*j-i.r*i.r)/(2*t.r*j)),(1+Math.cos(L))/2,[h,l,this.planets[a].magnitude({a:t.r,r:t.r,R:j,FV:L*this.r2d,x:o,y:r,z:s,jd:n,d2r:this.d2r})]},Planets.prototype.getHeliocentric=function(e,n,a){var t,i,o,r,s,p,d=1e10;if(!a)for(var h=0;h<e.elements.length;h++)(t=Math.abs(e.elements[h].jd-n))<d&&(a=h,d=t);return o=n-(i=e.elements[a]).jd,r=this.meanAnomaly(i.n,o,i.L,i.p),s=this.trueAnomaly(r*this.d2r,i.e,10),p=i.a*(1-Math.pow(i.e,2))/(1+i.e*Math.cos(s*this.d2r)),{xyz:this.heliocentric(s*this.d2r,p,i.p*this.d2r,i.o*this.d2r,i.i*this.d2r),M:r,v:s,r:p,i:a,d:o,elements:i}},Planets.prototype.meanAnomaly=function(e,n,a,t){for(var i=n*e+a-t;i<0;)i+=360;for(;i>=360;)i-=360;return i},Planets.prototype.heliocentric=function(e,n,a,t,i){var o=e+a-t,r=Math.sin(o),s=Math.cos(o),p=Math.cos(t),d=Math.sin(t),h=Math.cos(i);return[n*(p*s-d*r*h),n*(d*s+p*r*h),n*(r*Math.sin(i))]},Planets.prototype.trueAnomaly=function(e,n,a){var t=e;if("number"==typeof a){var i=.05;for(a=10;Math.abs(i)>=Math.pow(10,-a);)t-=(i=t-n*Math.sin(t)-e)/(1-n*Math.cos(t));var o=2*Math.atan(Math.pow((1+n)/(1-n),.5)*Math.tan(.5*t));o<0&&(o+=2*Math.PI)}else o=e+((2*n-Math.pow(n,3)/4)*Math.sin(e)+1.25*Math.pow(n,2)*Math.sin(2*e)+13/12*Math.pow(n,3)*Math.sin(3*e));return o*this.r2d};for(var n=!1,a=0;a<e.virtualsky.plugins.length;a++)"planets"==e.virtualsky.plugins[a].name&&(n=!0);n||e.virtualsky.plugins.push({init:function init(){this.bind("loadedPlanets",(function(e){this.jd=this.times.JD;var n=new Planets;this.planets=n.build(Math.floor(this.jd)-91.3125,456.5625);var a=this.times.JD,t=this.calendarevents.length;this.calendarevents.push((function(){Math.abs(a-this.times.JD)>=91.3125&&(this.calendarevents.splice(t,1),this.trigger("loadedPlanets"),this.draw())})),this.draw()}))},name:"planets",version:"1.0"})}(jQuery);