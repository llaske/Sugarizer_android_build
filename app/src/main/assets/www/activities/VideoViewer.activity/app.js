enyo.kind({name:"VideoViewer.App",kind:"FittableRows",published:{activity:null,filter:null},components:[{name:"spinner",kind:"Image",src:"images/spinner-light.gif",classes:"mainspinner",showing:!1},{name:"cloudwarning",kind:"Image",src:"images/cloud-warning.svg",classes:"cloudwarning",showing:!1},{name:"content",kind:"Scroller",fit:!0,classes:"main-content",onresize:"resize",components:[{name:"items",classes:"items",components:[]}]},{name:"footer",classes:"viewer-footer toolbar",fit:!1,components:[{name:"previousbutton",kind:"Button",classes:"toolbutton previous-button pull-left",title:"Previous",ontap:"showPrevious",showing:!1},{name:"pagecount",content:"0/0",classes:"page-count"},{name:"nextbutton",kind:"Button",classes:"toolbutton next-button pull-right",title:"Next",ontap:"showNext",showing:!1}]},{name:"libraryDialog",kind:"VideoViewer.LibraryDialog",onHide:"librariesHidden"},{name:"addLibraryDialog",kind:"VideoViewer.AddLibraryDialog"},{name:"videoDialog",kind:"VideoViewer.VideoDialog"}],create:function(){app=this,this.inherited(arguments),this.collection=[],this.index=0,this.computeSize(),this.favorite=!1,document.getElementById("exportvideo-button").addEventListener("click",enyo.bind(this,"clickExportVideo"));var t=this;requirejs(["sugar-web/env","sugar-web/datastore"],(function(e,i){e.getEnvironment((function(e,n){t.$.content.applyStyle("background-color",n.user.colorvalue.fill),t.datastore=i}))}))},loadLibraries:function(){var t=this;Util.loadLibraries((function(){app.showLibraries()}),(function(e){t.$.spinner.setShowing(!1),t.$.cloudwarning.setShowing(!0),console.log("Error loading library on '"+e.url+"'")}))},loadDatabase:function(){var t=this;this.$.spinner.setShowing(!0),Util.loadDatabase((function(e){t.index=0,t.collection=e,t.$.spinner.setShowing(!1),t.$.cloudwarning.setShowing(!1),t.draw()}),(function(e){t.$.spinner.setShowing(!1),t.$.cloudwarning.setShowing(!0),console.log("Error loading database on '"+e.url+"'")}))},computeSize:function(){var t=document.getElementById("main-toolbar"),e=Util.onSugar()?37.5:t.offsetHeight,i=document.getElementById("body").offsetHeight;this.$.content.applyStyle("height",i-(e+55)+"px")},resize:function(){Util.onSugar()||(this.computeSize(),this.draw())},draw:function(){var t=[];enyo.forEach(this.$.items.getControls(),(function(e){t.push(e)}));for(var e=0;e<t.length;e++)t[e].destroy();var i=this.collection,n=i.length,o=document.getElementById("exportvideo-button");for(e=0;e<constant.pageCount&&this.index+e<n;e++)this.$.items.createComponent({kind:"VideoViewer.Item",code:i[this.index+e].id,title:i[this.index+e].title,category:i[this.index+e].category,isFavorite:Util.getFavorite(i[this.index+e].id),image:i[this.index+e].image,onVideoPlayed:"showVideo",tojournal:o.classList.contains("active")},{owner:this}).render();this.$.previousbutton.setShowing(this.index-constant.pageCount>=0);var s=(n?1:0)+Math.ceil(this.index/constant.pageCount),a=Math.ceil(n/constant.pageCount);this.$.pagecount.setContent(s+"/"+a),this.$.nextbutton.setShowing(s<a)},putItemsJournalModeTo:function(t){t?document.getElementById("exportvideo-button").classList.add("active"):document.getElementById("exportvideo-button").classList.remove("active"),enyo.forEach(this.$.items.getControls(),(function(e){e.tojournal=t,e.tojournalChanged()}))},showPrevious:function(){this.index-=constant.pageCount,this.saveContext(),this.draw()},showNext:function(){this.index+=constant.pageCount,this.saveContext(),this.draw()},showVideo:function(t){t.tojournal?this.putItemsJournalModeTo(!1):(this.$.videoDialog.show(),this.$.videoDialog.setItem(t))},showLibraries:function(){this.$.libraryDialog.reload(),this.$.libraryDialog.show()},hideLibraries:function(){this.$.libraryDialog.hide()},librariesHidden:function(){null==Util.getLibrary()&&this.showLibraries()},setFilter:function(t){Util.setFilter(t)},filterChanged:function(t){this.collection=Util.getCollection(),this.index=void 0!==t?t:0,this.saveContext(),this.draw()},clickExportVideo:function(){var t;t=!document.getElementById("exportvideo-button").classList.contains("active"),this.putItemsJournalModeTo(t)},saveContext:function(){Util.setIndex(this.index),Util.saveContext()}});