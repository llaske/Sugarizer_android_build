function loadData(e,t,n){var i=0;"undefined"!=typeof chrome&&chrome.app&&chrome.app.runtime?chrome.storage.local.get("sugar_settings",(function(e){i=500})):i=0,setTimeout((function(){e.getDatastoreObject().loadAsText((function(e,i,o){if(null!=o){var r=JSON.parse(o);null!=r&&(r.game&&(t.game=r.game,t.game.multiplayer=!1,t.game.selectedCards=[],t.game.currentPlayer="",t.game.players=[]),n&&n())}}))}),i)}function initPresence(e,t,n,i){e.getPresenceObject((function(o,r){t.presence=r;var l=document.getElementById("network-button"),a=new n.PresencePalette(l,void 0,r);r.onSharedActivityUserChanged(t.presenceOnSharedActivityUserChanged),a.onUsersListChanged((function(e){t.onUsersListChanged(e)})),window.top&&window.top.sugar&&window.top.sugar.environment&&window.top.sugar.environment.sharedId?(shareActivity(e,r,t,!1),a.setShared(!0)):a.addEventListener("shared",(function(){a.popDown(),shareActivity(e,r,t,!0)})),i&&i()}))}function shareActivity(e,t,n,i){n.shareActivity(i);t.getUserInfo();window.top.sugar.environment.sharedId||t.createSharedActivity("org.olpcfrance.MemorizeActivity",(function(e){})),t.onConnectionClosed((function(e){console.log(e),console.log("Connection closed")})),t.onDataReceived((function(e){n.onDataReceived(e)})),t.listUsers((function(e){console.log(e)}))}define((function(e){requirejs(["domReady!","sugar-web/activity/activity","sugar-web/graphics/presencepalette","sugar-web/env","webL10n","activity/memorize-app"],(function(e,t,n,i,o,r){window.memorizeApp=r,r.activity=t,r.activity.setup(),i.getEnvironment((function(e,t){var n="undefined"!=typeof chrome&&chrome.app&&chrome.app.runtime?chrome.i18n.getUILanguage():navigator.language,i=t.user?t.user.language:n;window.addEventListener("localized",(function(e){document.getElementById("network-button").title=o.get("TutoTitleNetwork"),e.language!=i&&setTimeout((function(){o.language.code=i}),50)}))})),window.top.sugar.environment.sharedId?r.initUI((function(){initPresence(r.activity,r,n)})):r.initUI((function(){initPresence(r.activity,r,n),r.computeCards(!0),r.drawGame(),loadData(r.activity,r,(function(){r.drawGame()}))}));function displayUsers(e){null!=c&&c(e)}function findUsersInsideAllActivities(e,t){for(var n=[],i=0;i<e.users.length;i++)for(var o=0;o<t.length;o++)t[o].networkId===e.users[i]&&n.push(t[o]);return n}var l=null,a=null;function showQuickModal(e){null!==l&&(l.parentElement.removeChild(l),null!==a&&clearTimeout(a));var t=document.createElement("div");l=t,t.style.background="#000",t.style.color="#fff",t.style.bottom="5px",t.style.padding="15px",t.style.right="5px",t.style.position="absolute",t.innerHTML=e,document.body.appendChild(t),a=setTimeout((function(){a=null,t.parentElement.removeChild(t),l=null}),3e3)}r.presenceOnSharedActivityUserChanged=function(e){var t=e.user.name.replace("<","&lt;").replace(">","&gt;"),n="<img style='height:30px;vertical-align:middle;' src='"+function generateXOLogoWithColor(e){var t='<?xml version="1.0" ?><!DOCTYPE svg  PUBLIC \'-//W3C//DTD SVG 1.1//EN\'  \'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\' [<!ENTITY stroke_color "#010101"><!ENTITY fill_color "#FFFFFF">]><svg enable-background="new 0 0 55 55" height="55px" version="1.1" viewBox="0 0 55 55" width="55px" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px"><g display="block" id="stock-xo_1_"><path d="M33.233,35.1l10.102,10.1c0.752,0.75,1.217,1.783,1.217,2.932   c0,2.287-1.855,4.143-4.146,4.143c-1.145,0-2.178-0.463-2.932-1.211L27.372,40.961l-10.1,10.1c-0.75,0.75-1.787,1.211-2.934,1.211   c-2.284,0-4.143-1.854-4.143-4.141c0-1.146,0.465-2.184,1.212-2.934l10.104-10.102L11.409,24.995   c-0.747-0.748-1.212-1.785-1.212-2.93c0-2.289,1.854-4.146,4.146-4.146c1.143,0,2.18,0.465,2.93,1.214l10.099,10.102l10.102-10.103   c0.754-0.749,1.787-1.214,2.934-1.214c2.289,0,4.146,1.856,4.146,4.145c0,1.146-0.467,2.18-1.217,2.932L33.233,35.1z" fill="&fill_color;" stroke="&stroke_color;" stroke-width="3.5"/><circle cx="27.371" cy="10.849" fill="&fill_color;" r="8.122" stroke="&stroke_color;" stroke-width="3.5"/></g></svg>';return t=(t=t.replace("#010101",e.stroke)).replace("#FFFFFF",e.fill),"data:image/svg+xml;base64,"+btoa(t)}(e.user.colorvalue)+"'>";1===e.move&&showQuickModal(n+o.get("PlayerJoin",{user:t})),-1===e.move&&showQuickModal(n+o.get("PlayerLeave",{user:t})),r.presence.listUsers((function(e){r.presence.listSharedActivities((function(t){for(var n=0;n<t.length;n++)if(t[n].id===r.presence.sharedInfo.id){displayUsers(findUsersInsideAllActivities(t[n],e));break}}))}))};var c=null;n.PresencePalette.prototype.onUsersListChanged=function(e){c=e};document.getElementById("fullscreen-button").addEventListener("click",(function(){var e;document.getElementById("main-toolbar").style.display="none",document.getElementById("unfullscreen-button").style.visibility="visible",e=Math.min(document.body.clientHeight,document.body.clientWidth)/document.getElementById("game-grid").offsetWidth,document.getElementById("game-grid").style.zoom=e})),document.getElementById("unfullscreen-button").addEventListener("click",(function(){document.getElementById("main-toolbar").style.display="",document.getElementById("unfullscreen-button").style.visibility="hidden",document.getElementById("game-grid").style.zoom=1}))}))}));