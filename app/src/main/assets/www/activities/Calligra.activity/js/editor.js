var Editor={template:'\n\t\t<div>\n\t\t\t<div id="back" class="editor-goback" v-on:click="goBack()"></div>\n\t\t\t<img id="miniletter" class="editor-miniletter" v-bind:src="item.image"></img>\n\t\t\t<div id="area" class="editor-area">\n\t\t\t\t<canvas id="letter"></canvas>\n\t\t\t</div>\n\t\t\t<button id="editor-add" class="editor-add"></button>\n\t\t\t<button id="editor-remove" class="editor-remove"></button>\n\t\t\t<div class="editor-start"></div>\n\t\t\t<button id="editor-addpath" class="editor-addpath"></button>\n\t\t\t<button id="editor-removepath" class="editor-removepath"></button>\n\t\t\t<div class="editor-path"></div>\n\t\t</div>',props:["item"],data:function(){return{size:-1,imageSize:-1,zoom:-1,current:-1,keyboardEvent:null}},methods:{computeSize:function(){var t=this,e=document.getElementById("canvas")||document.getElementById("body"),i=e.offsetHeight-50,n={width:e.offsetWidth-50,height:i};t.size=Math.min(n.width,n.height);var d=document.getElementById("letter");d.width=t.size,d.height=t.size,d.style.marginLeft=(n.width-t.size)/2-50+"px",t.zoom=t.size/t.imageSize,this.draw()},initEvent:function(){var t=this,e="click",i="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0;i&&(e="touchend");var n=document.getElementById("letter");n.addEventListener(e,(function(e){e.preventDefault(),i&&(e=e.changedTouches[0]);var d=Math.floor((e.clientX-n.getBoundingClientRect().left)/t.zoom),a=Math.floor((e.clientY-n.getBoundingClientRect().top)/t.zoom);if(-1!=t.current){var o=t.item.starts[t.current];if(o.path&&o.path.length){var r=o.path[o.path.length-1];r.x=d,r.y=a}else o.x=d,o.y=a;t.draw()}})),document.getElementById("editor-add").addEventListener("click",(function(){t.item.starts||(t.item.starts=[]);var e=t.item.starts.length;t.item.starts.push({x:5+5*e,y:5+5*e,path:[]}),t.draw()})),document.getElementById("editor-remove").addEventListener("click",(function(){t.item.starts.pop(),t.draw()})),document.getElementById("editor-addpath").addEventListener("click",(function(){var e=t.item.starts[t.current];e.path||(e.path=[]);var i=e.path.length;e.path.push({x:5+5*i,y:5+5*i}),t.draw()})),document.getElementById("editor-removepath").addEventListener("click",(function(){t.item.starts[t.current].path.pop(),t.draw()})),t.keyboardEvent=function(e){if(-1!=t.current){var i=t.item.starts[t.current];i.path&&i.path.length&&(i=i.path[i.path.length-1]),"38"==e.keyCode?i.y--:"40"==e.keyCode?i.y++:"37"==e.keyCode?i.x--:"39"==e.keyCode?i.x++:"80"==e.keyCode&&document.getElementById("editor-addpath").click(),t.draw()}},document.addEventListener("keydown",t.keyboardEvent)},draw:function(){var t=this,e=document.getElementById("letter").getContext("2d");e.clearRect(0,0,t.size,t.size);var i=new Image;i.onload=function(){e.drawImage(i,0,0,t.size,t.size),t.item.starts&&t.item.starts.length?(document.getElementById("editor-remove").disabled=!1,document.getElementById("editor-addpath").disabled=!1,t.item.starts.forEach((function(i,n){e.beginPath(),e.arc(i.x*t.zoom,i.y*t.zoom,2*t.zoom,0,2*Math.PI),e.fillStyle="red",e.fill(),t.current=n,document.getElementById("editor-removepath").disabled=!(i.path&&i.path.length),i.path&&i.path.length&&i.path.forEach((function(i){e.beginPath(),e.arc(i.x*t.zoom,i.y*t.zoom,1*t.zoom,0,2*Math.PI),e.fillStyle="yellow",e.fill()}))}))):(document.getElementById("editor-remove").disabled=!0,document.getElementById("editor-addpath").disabled=!0,document.getElementById("editor-removepath").disabled=!0)},i.src=t.item.image},onLoad:function(){this.computeSize(),this.initEvent()},goBack:function(){app.displayTemplateView()}},mounted:function(){var t=this,e=new Image;e.onload=function(){t.imageSize=e.width,t.onLoad()},e.src=t.item.image},beforeDestroy:function(){document.removeEventListener("keydown",this.keyboardEvent)}};