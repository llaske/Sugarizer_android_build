var requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;const obstaclesPossiblePos=[[1,1,1,0,1,1],[1,0,1,0,0,1],[1,0,1,1,1,1],[1,0,0,0,1,0],[1,1,1,0,1,1],[1,0,1,0,1,1]],framesSequence={LEFT:[4,5,4,6],RIGHT:[1,2,1,3],UP:[9,10,9,11],DOWN:[0,7,0,8]};function Game(t,e,i,s){this.homeScreen=!0,this.playScreen=!1,this.PlayerStop=!0,this.gameEnded=!1,this.obstacles=[],this.frameWidth=76,this.frameHeight=80,this.obstWidth=130,this.obstHeight=64,this.prevCanvasWidth=t.width,this.prevCanvasHeight=t.height,this.lives=3,this.frameX=0,this.frameY=0,this.frameNo=0,this.framesSequenceNo=0,this.playerX=.88*t.width,this.playerY=.15*t.height,this.key=void 0,this.lastTime=Date.now(),this.PlayerTimeInterval=25,this.playerSpeed=(2+t.width/screen.width*(screen.width/300))/this.PlayerTimeInterval,this.targetWord="",this.targetWordLetters=[],this.targetLetterSize=.1*screen.height,this.homeScreenFontSize=.07*t.height,this.menuSelected=0,this.menuTexts=[],this.settingScreen=!1,this.useCustomDict=!1,this.customDictWordEdit=!1,this.wordInSetting=null,this.customDict=[],this.wordToBeEdited=null,this.customDictLang=null,this.splashAudio=new Audio("./sounds/splash.mp3"),this.aplausoAudio=new Audio("./sounds/aplauso.mp3"),this.moneyAudio=new Audio("./sounds/money.mp3"),this.menuAudio=new Audio("./sounds/menu.mp3"),this.gameAudio=new Audio("./sounds/menumusic22.mp3"),this.main=function(){this.useCustomDict||this.initializeCustomDict(),this.homeScreen?this.drawHomeScreen():this.creditScreen?this.drawCreditScreen():this.settingScreen?this.drawSettingScreen():this.playScreen&&(this.initializeObstacles(),this.generateTargetWord(),this.run())},this.reset=function(e,i){this.PlayerStop=!0,this.gameEnded=!1,this.lives=null!=i?i:3,this.targetWordLetters=[],this.obstacles=[],this.frameNo=0,this.playerX=.88*t.width,this.playerY=.15*t.height,e||(this.initializeObstacles(),this.generateTargetWord())},this.resizeImagesAndFont=function(){var e=.95,i=130/64,s=t.width/t.height;e>=s?(this.frameWidth=.1*t.width,this.frameHeight=this.frameWidth/e):(this.frameHeight=.1*t.height,this.frameWidth=this.frameHeight*e),i>=s?(this.obstWidth=.1*t.width,this.obstHeight=this.obstWidth/i):(this.obstHeight=.1*t.height,this.obstWidth=this.obstHeight*i),this.targetLetterSize=1>=s?.1*t.width:.1*t.height,this.homeScreenFontSize=.07*t.height},this.resizeGame=function(e,i){for(var s=this.playerX/this.prevCanvasWidth,h=this.playerY/this.prevCanvasHeight,r=[],a=[],n=0;n<this.obstacles.length;n++){var o={xr:this.obstacles[n].x/this.prevCanvasWidth,yr:this.obstacles[n].y/this.prevCanvasHeight};r.push(o)}for(n=0;n<this.targetWordLetters.length;n++){o={xr:this.targetWordLetters[n].x/this.prevCanvasWidth,yr:this.targetWordLetters[n].y/this.prevCanvasHeight};a.push(o)}t.width=e,t.height=i,this.prevCanvasWidth=e,this.prevCanvasHeight=i,this.resizeImagesAndFont(),this.playerX=s*t.width,this.playerY=h*t.height,this.playerSpeed=(2+t.width/screen.width*(2+screen.width/300))/this.PlayerTimeInterval;for(n=0;n<this.obstacles.length;n++)this.obstacles[n].x=r[n].xr*t.width,this.obstacles[n].y=r[n].yr*t.height;for(n=0;n<a.length;n++)this.targetWordLetters[n].x=a[n].xr*t.width,this.targetWordLetters[n].y=a[n].yr*t.height;this.resizeSettingScreen(),this.homeScreen?this.drawHomeScreen():this.settingScreen&&this.drawSettingScreen()},this.drawHomeScreen=function(){var i=t.getContext("2d"),s=e.get("./images/menu.jpg");i.drawImage(s,0,0,t.width,t.height),this.drawMenu()},this.drawMenu=function(){var e=t.getContext("2d");e.textBaseline="top";var i=["Play","Credits","Settings","Quit"];this.menuTexts=[];var h=this;document.fonts.load(h.homeScreenFontSize+"px ds_moster").then((function(){for(var r=0;r<i.length;r++){h.menuSelected==r?e.fillStyle="Red":e.fillStyle="Black",e.font=h.homeScreenFontSize+"px ds_moster";var a=s.get(i[r]),n={x:t.width/4,y:t.height/2+r*h.homeScreenFontSize+10*r,text:a};h.menuTexts.push(n),e.fillText(a,n.x,n.y)}}))},this.drawCreditScreen=function(){var i=t.getContext("2d"),s=e.get("./images/splash.jpg"),h=e.get("./images/creditos.jpg");i.drawImage(s,0,0,t.width,t.height);var r=this;setTimeout((function(){i.drawImage(h,0,0,t.width,t.height),setTimeout((function(){r.homeScreen=!0,r.creditScreen=!1,r.drawHomeScreen()}),2e3)}),2e3)},this.initializeCustomDict=function(t){if(this.customDict=[],this.customDictLang=s.language.code,null==t)for(var e=i.defaultDict.length,h=0;h<e;h++){var r=s.get(i.defaultDict[h]);this.customDict.push(r)}else this.customDict=t},this.resizeSettingScreen=function(){var t=document.getElementById("settingScreen"),e=document.getElementById("panel-body"),i=document.getElementById("word");t.style.top=.15*window.innerHeight+"px",t.style.left=.05*window.innerWidth+"px",t.style.right=.05*window.innerWidth+"px",t.style.width=.9*window.innerWidth+"px",t.style.height=.8*window.innerHeight+"px",window.innerHeight<500?e.style.height=.2*window.innerHeight+"px":e.style.height=.4*window.innerHeight+"px",e.style.width="100%",i.style.width=.9*window.innerWidth+"px"},this.drawSettingScreen=function(){var i=t.getContext("2d"),s=e.get("./images/setting.jpg");i.drawImage(s,0,0,t.width,t.height);var h=document.getElementById("settingScreen"),r=document.getElementById("dictionary");h.style.visibility="visible",this.resizeSettingScreen();var a=this.wordInSetting;if(r.innerHTML="",this.customDictWordEdit){var n=document.createElement("li"),o='<div class="dictRow"><div>'+a+'</div><div><button type="button" id="'+this.wordToBeEdited+'" class="settingButtons saveEditWord" name="button" title="Okay"></button><button type="button" id="'+this.wordToBeEdited+'" class="settingButtons resetEditWord" name="button" title="Cancel"></button></div></div>';n.innerHTML=o,r.appendChild(n)}else for(var d=0;d<this.customDict.length;d++){var l=this.customDict[d];if(null!=a){if(l.toUpperCase().startsWith(a.toUpperCase())){n=document.createElement("li"),o='<div class="dictRow"><div>'+l+'</div><div><button type="button" id="'+l+'" class="settingButtons editWord" name="button" title="Edit"></button>';1!=this.customDict.length&&(o+='<button type="button" id="'+l+'" class="settingButtons deleteWord" name="button title="Delete""></button>'),o+="</div></div>",n.innerHTML=o,r.appendChild(n)}}else{n=document.createElement("li"),o='<div class="dictRow"><div>'+l+'</div><div><button type="button" id="'+l+'" class="settingButtons editWord" name="button" title="Edit"></button>';1!=this.customDict.length&&(o+='<button type="button" id="'+l+'" class="settingButtons deleteWord" name="button" title="Delete"></button>'),o+="</div></div>",n.innerHTML=o,r.appendChild(n)}}},this.run=function(){var i=t.getContext("2d");if(i.clearRect(0,0,t.width,t.height),this.playScreen){var s,h;null!=this.key&&this.gameAudio.play(),s=e.get("./images/barra.jpg"),i.drawImage(s,0,0,t.width,.15*t.height),h=e.get("./images/fondo.jpg"),i.drawImage(h,0,.15*t.height,t.width,.85*t.height);for(var r=0;r<this.obstacles.length;r++){var a,n=this.obstacles[r].x,o=this.obstacles[r].y,d=this.obstacles[r].j;a=e.get("./images/lago"+d+".png"),i.drawImage(a,n,o,this.obstWidth,this.obstHeight)}this.drawTargetLetters();for(r=1;r<=this.lives;r++){var l;l=e.get("./images/zeek0.png");n=.95*t.width-r*this.frameWidth;i.drawImage(l,n,10,this.frameWidth,this.frameHeight)}this.movePlayerSprite();var g=this.checkIfGameEnded();if(this.gameEnded){this.gameEnded=!1,this.drawEndGameScreen(g);var m=this;setTimeout((function(){if(g){var t=m.lives;m.reset(!1,t)}else m.reset(!0),m.playScreen=!1,m.homeScreen=!0,display="homeScreen",m.gameAudio.pause();requestAnimationFrame(m.run.bind(m))}),2e3)}else requestAnimationFrame(this.run.bind(this))}else this.main()},this.initializeObstacles=function(){this.resizeImagesAndFont();for(var e=0;e<6;){for(var i=[],s=0;s<6;s++)1==obstaclesPossiblePos[e][s]&&i.push(s);var h=e*this.obstWidth+this.frameWidth,r=i[Math.floor(Math.random()*i.length)]*t.height*.1+this.frameHeight+.15*t.height,a={x:h,y:r,j:Math.floor(4*Math.random())},n=!0;for(s=0;s<this.obstacles.length;s++){if(this.collides({x:h,y:r,width:this.obstWidth,height:this.obstHeight},{x:this.obstacles[s].x,y:this.obstacles[s].y,width:this.obstWidth,height:this.obstHeight})){n=!1;break}n=!0}n&&(e++,this.obstacles.push(a))}this.aplausoAudio.play()},this.generateTargetWord=function(){var e=i.getRandomWord();this.useCustomDict?this.targetWord=e.toUpperCase():this.targetWord=s.get(e).toUpperCase();for(var h=this.targetWord.split(""),r=0;r<h.length;){for(var a=Math.floor(Math.random()*t.width*.7)+.1*t.width,n=Math.floor(Math.random()*t.height*.65)+.2*t.height,o={x:a,y:n,letter:h[r]},d=!0,l=!0,g=0;g<this.obstacles.length;g++){if(this.collides({x:a,y:n,width:this.targetLetterSize,height:this.targetLetterSize},{x:this.obstacles[g].x,y:this.obstacles[g].y,width:.1*screen.width,height:.1*screen.height})){d=!1;break}d=!0}for(g=0;g<this.targetWordLetters.length;g++){if(this.collides({x:a,y:n,width:this.targetLetterSize,height:this.targetLetterSize},{x:this.targetWordLetters[g].x,y:this.targetWordLetters[g].y,width:this.targetLetterSize,height:this.targetLetterSize})){l=!1;break}l=!0}d&&l&&(r++,this.targetWordLetters.push(o))}},this.drawTargetLetters=function(){var e=t.getContext("2d"),i=this.targetWord.length-this.targetWordLetters.length;e.font=this.targetLetterSize+"px VeraBd",e.fillStyle="white",e.strokeStyle="Black";var s=this.targetWord.substr(0,i);e.strokeText(s,15,20),e.fillText(s,15,20),e.fillStyle="Black",e.strokeStyle="White";var h=this.targetWord.substr(i);e.strokeText(h,15+e.measureText(s).width,20),e.fillText(h,15+e.measureText(s).width,20);for(var r=0;r<this.targetWordLetters.length;r++){var a=this.targetWordLetters[r].x,n=this.targetWordLetters[r].y,o=this.targetWordLetters[r].letter;e.font=this.targetLetterSize+"px VeraBd",e.fillStyle="White",e.textBaseline="top",e.strokeStyle="Black",e.fillText(o,a,n),e.strokeText(o,a,n),e.stroke()}},this.movePlayerSprite=function(){var i,s=t.getContext("2d");"LEFT"==this.key&&Date.now()-this.lastTime>=this.PlayerTimeInterval&&(this.playerNobstaclesCollision(),this.playerX<=0&&(this.PlayerStop=!0,this.frameNo=4),this.PlayerStop||(3==this.framesSequenceNo?(this.framesSequenceNo=0,this.frameNo=framesSequence.LEFT[this.framesSequenceNo]):(this.framesSequenceNo++,this.frameNo=framesSequence.LEFT[this.framesSequenceNo]),this.playerX-=this.playerSpeed*this.PlayerTimeInterval),this.lastTime=Date.now()),"UP"==this.key&&Date.now()-this.lastTime>=this.PlayerTimeInterval&&(this.playerNobstaclesCollision(),this.playerY<=.15*t.height&&(this.PlayerStop=!0,this.frameNo=9),this.PlayerStop||(3==this.framesSequenceNo?(this.framesSequenceNo=0,this.frameNo=framesSequence.UP[this.framesSequenceNo]):(this.framesSequenceNo++,this.frameNo=framesSequence.UP[this.framesSequenceNo]),this.playerY-=this.playerSpeed*this.PlayerTimeInterval),this.lastTime=Date.now()),"RIGHT"==this.key&&Date.now()-this.lastTime>=this.PlayerTimeInterval&&(this.playerNobstaclesCollision(),this.playerX+this.frameWidth>=t.width&&(this.PlayerStop=!0,this.frameNo=1),this.PlayerStop||(3==this.framesSequenceNo?(this.framesSequenceNo=0,this.frameNo=framesSequence.RIGHT[this.framesSequenceNo]):(this.framesSequenceNo++,this.frameNo=framesSequence.RIGHT[this.framesSequenceNo]),this.playerX+=this.playerSpeed*this.PlayerTimeInterval),this.lastTime=Date.now()),"DOWN"==this.key&&Date.now()-this.lastTime>=this.PlayerTimeInterval&&(this.playerNobstaclesCollision(),this.playerY+this.frameHeight>=t.height&&(this.PlayerStop=!0,this.frameNo=0),this.PlayerStop||(3==this.framesSequenceNo?(this.framesSequenceNo=0,this.frameNo=framesSequence.DOWN[this.framesSequenceNo]):(this.framesSequenceNo++,this.frameNo=framesSequence.DOWN[this.framesSequenceNo]),this.playerY+=this.playerSpeed*this.PlayerTimeInterval),this.lastTime=Date.now()),this.checkIfWordsCollected(),i=e.get("./images/zeek"+this.frameNo+".png"),s.drawImage(i,this.playerX,this.playerY,this.frameWidth,this.frameHeight)},this.checkIfWordsCollected=function(){if(this.targetWordLetters.length>0)for(var t=0;t<this.targetWordLetters.length;t++)if(this.targetWordLetters[t].letter==this.targetWordLetters[0].letter&&this.collides({x:this.playerX,y:this.playerY,width:this.frameWidth,height:this.frameHeight},{x:this.targetWordLetters[t].x,y:this.targetWordLetters[t].y,width:30,height:30})){if(0!=t){var e=this.targetWordLetters[0].x,i=this.targetWordLetters[0].y;this.targetWordLetters[0].x=this.targetWordLetters[t].x,this.targetWordLetters[0].y=this.targetWordLetters[t].y,this.targetWordLetters[t].x=e,this.targetWordLetters[t].y=i}this.targetWordLetters.splice(0,1),this.moneyAudio.play(),this.drawTargetLetters();break}},this.playerNobstaclesCollision=function(){for(var e,i=0;i<this.obstacles.length&&!(e=this.collides({x:this.obstacles[i].x,y:this.obstacles[i].y,width:this.obstWidth,height:this.obstHeight},{x:this.playerX,y:this.playerY,width:this.frameWidth,height:this.frameHeight}));i++);return e&&(this.PlayerStop=!0,this.lives--,this.playerX=.88*t.width,this.playerY=.15*t.height,this.frameNo=0,this.splashAudio.play()),e},this.collides=function(t,e){return t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y},this.drawEndGameScreen=function(i){var s,h=t.getContext("2d");s=i?e.get("./images/ganaste.png"):e.get("./images/perdio.png"),h.drawImage(s,0,0,t.width,t.height)},this.checkIfGameEnded=function(){return 0!=this.targetWordLetters.length||this.gameEnded?-1!=this.lives||this.gameEnded?void 0:(this.gameEnded=!0,!1):(this.gameEnded=!0,!0)}}define((function(){return Game}));