define(["sugar-web/activity/activity","sugar-web/env","activity/game","activity/resources","activity/paladict","data/en/dict.js","l10n","tutorial"],(function(e,t,n,i,a,o,d,c){requirejs(["domReady!"],(function(r){e.setup(),display="homeScreen";var l=new i;l.load(["./images/barra.jpg","./images/creditos.jpg","./images/fondo.jpg","./images/ganaste.png","./images/grossini.png","./images/lago0.png","./images/lago1.png","./images/lago2.png","./images/lago3.png","./images/menu.jpg","./images/setting.jpg","./images/perdio.png","./images/splash.jpg","./images/spritesheet.png","./images/zeek0.png","./images/zeek1.png","./images/zeek2.png","./images/zeek3.png","./images/zeek4.png","./images/zeek5.png","./images/zeek6.png","./images/zeek7.png","./images/zeek8.png","./images/zeek9.png","./images/zeek10.png","./images/zeek11.png"]);var s=document.getElementById("main-toolbar"),u=document.getElementById("word");s.style.opacity=1;var m=document.getElementById("canvas"),g=m.getContext("2d");m.width=window.innerWidth,m.height=window.innerHeight-s.offsetHeight-3;var y=new a(o),h=new n(m,l,y,d);t.getEnvironment((function(t,n){n;var i="undefined"!=typeof chrome&&chrome.app&&chrome.app.runtime?chrome.i18n.getUILanguage():navigator.language,a=n.user?n.user.language:i;d.init(a),window.addEventListener("localized",(function(){document.getElementById("WordHeading").innerHTML=d.get("Word"),document.getElementById("DictHeading").innerHTML=d.get("Dictionary"),l.onReady((function(){n.objectId?e.getDatastoreObject().loadAsText((function(e,t,n){null==e&&null!=n&&(h.customDict=n.customDict,h.useCustomDict=n.useCustomDict,h.useCustomDict&&y.changeDict(n.customDict),n.playScreen?(h.playScreen=!0,display="playScreen",h.homeScreen=!1,h.obstacles=n.obstacles,h.playerX=n.playerX,h.playerY=n.playerY,h.lives=n.lives,h.targetWordLetters=n.targetWordLetters,h.targetWord=n.targetWord,h.prevCanvasWidth=n.prevCanvasWidth,h.prevCanvasHeight=n.prevCanvasHeight,h.resizeGame(m.width,m.height),h.useCustomDict||h.initializeCustomDict(),h.run()):(h.homeScreen=!0,display="homeScreen",h.playScreen=!1,h.main()),document.getElementById("spinner").style.visibility="hidden")})):(display="homeScreen",h.main(),document.getElementById("spinner").style.visibility="hidden")}))}))}));var p={x:void 0,y:void 0},v={x:void 0,y:void 0};document.addEventListener("keyup",(function handleOnKeyDown(e,t){switch(e.keyCode){case 13:if(h.homeScreen)handleMenuChoose(h.menuSelected);break;case 37:handleKeyLeft();break;case 38:h.homeScreen?(0==h.menuSelected?h.menuSelected=3:h.menuSelected--,h.menuAudio.play(),h.drawHomeScreen()):handleKeyUp();break;case 39:handleKeyRight();break;case 40:h.homeScreen?(3==h.menuSelected?h.menuSelected=0:h.menuSelected++,h.menuAudio.play(),h.drawHomeScreen()):handleKeyDown()}}),!1),document.getElementById("word").addEventListener("input",(function handleOnTextChange(e){h.wordInSetting=e.target.value,h.menuAudio.play(),""==h.wordInSetting&&(h.wordInSetting=null);if(h.customDictWordEdit){document.getElementById("dictionary").children[0].children[0].children[0].innerHTML=e.target.value}else h.drawSettingScreen()}));var S="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0;function handleKeyLeft(){h.key="LEFT",h.frameNo=4,h.PlayerStop=!1}function handleKeyUp(){h.key="UP",h.frameNo=9,h.PlayerStop=!1}function handleKeyRight(){h.key="RIGHT",h.frameNo=1,h.PlayerStop=!1}function handleKeyDown(){h.key="DOWN",h.frameNo=7,h.PlayerStop=!1}function handleMenuChoose(e){h.menuAudio.play(),0==e?(h.homeScreen=!1,h.creditScreen=!1,h.playScreen=!0,display="playScreen",h.main()):1==e?(h.homeScreen=!1,h.creditScreen=!0,h.drawCreditScreen()):2==e?(h.homeScreen=!1,h.creditScreen=!1,h.settingScreen=!0,display="settingScreen",h.drawSettingScreen()):3==e&&w.click()}function handleOnMouseDown(e){S&&(e=e.changedTouches[0]);const t=m.getBoundingClientRect();p.x=e.clientX-t.left,p.y=e.clientY-t.top}function handleOnMouseUp(e){S&&(e=e.changedTouches[0]);const t=m.getBoundingClientRect();if(v.x=e.clientX-t.left,v.y=e.clientY-t.top,h.homeScreen)for(var n=0;n<h.menuTexts.length;n++){if(h.collides({x:h.menuTexts[n].x,y:h.menuTexts[n].y,width:g.measureText(h.menuTexts[n].text).width,height:h.homeScreenFontSize+10},{x:p.x,y:p.y,width:10,height:10})){handleMenuChoose(n);break}}if(h.playScreen){var i=Math.abs(v.y-p.y),a=Math.abs(v.x-p.x),o=Math.atan2(i,a);v.y<=p.y?v.x>=p.x?(o<15*Math.PI/180&&handleKeyRight(),o>75*Math.PI/180&&handleKeyUp()):(o<15*Math.PI/180&&handleKeyLeft(),o>75*Math.PI/180&&handleKeyUp()):v.x>=p.x?(o<15*Math.PI/180&&handleKeyRight(),o>75*Math.PI/180&&handleKeyDown()):(o<15*Math.PI/180&&handleKeyLeft(),o>75*Math.PI/180&&handleKeyDown())}}function handleButtonClick(e){(e=e||window.event).target=e.target||e.srcElement;for(var t=e.target,n=document.getElementById("addWord"),i=document.getElementById("deleteAllWords"),a=document.getElementById("saveDict"),o=document.getElementById("resetDict");t;){if("BUTTON"===t.nodeName&&/deleteWord/.test(t.className)){h.menuAudio.play();var d=h.customDict.filter((function(e,n,i){return e!=t.id}));h.customDict=d,h.drawSettingScreen();break}if("BUTTON"===t.nodeName&&/editWord/.test(t.className)){h.menuAudio.play(),u.value=t.id,h.wordInSetting=u.value,h.wordToBeEdited=u.value,h.customDictWordEdit=!0,n.style.opacity=.5,i.style.opacity=.5,a.style.opacity=.5,o.style.opacity=.5,h.drawSettingScreen();break}if("BUTTON"===t.nodeName&&/saveEditWord/.test(t.className)){h.menuAudio.play(),null!=h.wordInSetting&&(h.customDict[h.customDict.indexOf(h.wordToBeEdited)]=h.wordInSetting,h.customDictWordEdit=!1,u.value="",h.wordInSetting=null,n.style.opacity=1,i.style.opacity=1,a.style.opacity=1,o.style.opacity=1,h.drawSettingScreen());break}if("BUTTON"===t.nodeName&&/resetEditWord/.test(t.className)){h.menuAudio.play(),h.customDict[h.customDict.indexOf(h.wordToBeEdited)]=h.wordToBeEdited,h.customDictWordEdit=!1,h.wordInSetting="",u.value=null,n.style.opacity=1,i.style.opacity=1,a.style.opacity=1,o.style.opacity=1,h.drawSettingScreen();break}t=t.parentNode}}S?(m.addEventListener("touchstart",handleOnMouseDown,!1),m.addEventListener("touchend",handleOnMouseUp,!1)):(m.addEventListener("mousedown",handleOnMouseDown,!1),m.addEventListener("mouseup",handleOnMouseUp,!1)),document.getElementById("addWord").addEventListener("click",(function(){var e=document.getElementById("dictionary"),t=0;if(!h.customDictWordEdit&&(h.menuAudio.play(),null!=h.wordInSetting)){for(var n=0;n<e.children.length;n++){if(e.children[n].children[0].children[0].innerHTML.toUpperCase()==h.wordInSetting.toUpperCase()){t=1;break}}0==t&&(h.customDict.unshift(h.wordInSetting),u.value="",h.wordInSetting=null,h.drawSettingScreen())}})),document.getElementById("deleteAllWords").addEventListener("click",(function(){if(!h.customDictWordEdit){h.menuAudio.play();var e=d.get("Play");h.customDict=[e],u.value="",h.wordInSetting=null,h.drawSettingScreen()}})),document.getElementById("saveDict").addEventListener("click",(function(){h.customDictWordEdit||(h.menuAudio.play(),y.changeDict(h.customDict),h.useCustomDict=!0,h.drawSettingScreen())})),document.getElementById("resetDict").addEventListener("click",(function(){h.customDictWordEdit||(h.menuAudio.play(),h.initializeCustomDict(),u.value="",h.wordInSetting=null,h.drawSettingScreen())})),document.addEventListener?document.addEventListener("click",handleButtonClick,!0):document.attachEvent&&document.attachEvent("onclick",handleButtonClick,!0),window.addEventListener("resize",(function(){var e=window.innerWidth,t=1==s.style.opacity?s.offsetHeight+3:0,n=window.innerHeight-t;h.resizeGame(e,n)})),document.getElementById("restart-button").addEventListener("click",(function(){h.homeScreen=!0,display="homeScreen",h.playScreen=!1,h.reset(!0),h.gameAudio.pause(),h.settingScreen&&(h.settingScreen=!1,u.value="",h.wordInSetting=null,h.customDict=[].concat(y.dict),h.customDictWordEdit=!1,document.getElementById("settingScreen").style.visibility="hidden",document.getElementById("addWord").style.opacity=1,document.getElementById("deleteAllWords").style.opacity=1,document.getElementById("saveDict").style.opacity=1,document.getElementById("resetDict").style.opacity=1,h.main())}),!1);var w=document.getElementById("stop-button");w.addEventListener("click",(function(t){var n={homeScreen:h.homeScreen,playScreen:h.playScreen,playerX:h.playerX,playerY:h.playerY,obstacles:h.obstacles,lives:h.lives,targetWordLetters:h.targetWordLetters,targetWord:h.targetWord,frameNo:h.frameNo,prevCanvasWidth:h.prevCanvasWidth,prevCanvasHeight:h.prevCanvasHeight,customDict:h.customDict,useCustomDict:h.useCustomDict,customDictLang:h.customDictLang};e.getDatastoreObject().setDataAsText(n),e.getDatastoreObject().save((function(e){null===e?console.log("write done."):console.log("write failed.")}))})),document.getElementById("fullscreen-button").addEventListener("click",(function(){document.getElementById("main-toolbar").style.opacity=0,document.getElementById("canvas").style.top="0px",document.getElementById("unfullscreen-button").style.visibility="visible";var e=window.innerWidth,t=window.innerHeight;h.resizeGame(e,t)})),document.getElementById("unfullscreen-button").addEventListener("click",(function(){document.getElementById("main-toolbar").style.opacity=1,document.getElementById("canvas").style.top="55px",document.getElementById("unfullscreen-button").style.visibility="hidden";var e=window.innerWidth,t=window.innerHeight-s.offsetHeight-3;h.resizeGame(e,t)})),document.getElementById("help-button").addEventListener("click",(function(e){c.start()}))}))}));