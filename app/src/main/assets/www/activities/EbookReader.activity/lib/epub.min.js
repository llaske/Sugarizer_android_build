!function(v,m){"object"==typeof exports&&"object"==typeof module?module.exports=m(require("xmldom"),function(){try{return require("jszip")}catch(v){}}()):"function"==typeof define&&define.amd?define(["xmldom","jszip"],m):"object"==typeof exports?exports.ePub=m(require("xmldom"),function(){try{return require("jszip")}catch(v){}}()):v.ePub=m(v.xmldom,v.jszip)}("undefined"==typeof self?this:self,(function(v,m){var y=String.prototype,b=Math.ceil,w=Math.round,k=Math.max,x=Math.floor;return function(v){function t(y){if(m[y])return m[y].exports;var b=m[y]={i:y,l:!1,exports:{}};return v[y].call(b.exports,b,b.exports,t),b.l=!0,b.exports}var m={};return t.m=v,t.c=m,t.d=function(v,m,y){t.o(v,m)||Object.defineProperty(v,m,{configurable:!1,enumerable:!0,get:y})},t.n=function(v){var m=v&&v.__esModule?function(){return v.default}:function(){return v};return t.d(m,"a",m),m},t.o=function(v,m){return Object.prototype.hasOwnProperty.call(v,m)},t.p="/dist/",t(t.s=25)}([function(v,m,y){"use strict";function i(){var v=(new Date).getTime(),m="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(m){var y=0|(v+16*Math.random())%16;return v=x(v/16),("x"==m?y:8|7&y).toString(16)}));return m}function r(v){return!isNaN(parseFloat(v))&&isFinite(v)}function l(v,m,y,b,w){var k,x=b||0,E=w||m.length,_=parseInt(x+(E-x)/2);return y||(y=function(v,m){return v>m?1:v<m?-1:v==m?0:void 0}),0>=E-x?_:(k=y(m[_],v),1==E-x?0<=k?_:_+1:0===k?_:-1===k?l(v,m,y,_,E):l(v,m,y,x,_))}function u(v,m){for(var y,b=v.parentNode.childNodes,w=-1,k=0;k<b.length&&((y=b[k]).nodeType===m&&w++,y!=v);k++);return w}function c(v,m){return new Blob([v],{type:m})}function p(v,m){return void 0===v.querySelector?v.getElementsByTagName(m):v.querySelectorAll(m)}function h(v,m,y){for(var b=document.createTreeWalker(v,y,null,!1),w=void 0;w=b.nextNode();)m(w)}function g(v,m){if(m(v))return!0;if(v=v.firstChild)do{if(g(v,m))return!0;v=v.nextSibling}while(v)}function f(v){for(var m=[v];v;v=v.parentNode)m.unshift(v);return m}Object.defineProperty(m,"__esModule",{value:!0});var b=function(){function e(v,m){for(var y,b=0;b<m.length;b++)(y=m[b]).enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(v,y.key,y)}return function(v,m,y){return m&&e(v.prototype,m),y&&e(v,y),v}}();m.uuid=i,m.documentHeight=function(){return k(document.documentElement.clientHeight,document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight)},m.isElement=function(v){return!(!v||1!=v.nodeType)},m.isNumber=r,m.isFloat=function(v){var m=parseFloat(v);return m===v&&r(v)&&x(m)!==v},m.prefixed=function(v){var m=["Webkit","webkit","Moz","O","ms"],y=["-webkit-","-webkit-","-moz-","-o-","-ms-"],b=v[0].toUpperCase()+v.slice(1),w=m.length;if("undefined"==typeof document||void 0!==document.body.style[v])return v;for(var k=0;k<w;k++)if(void 0!==document.body.style[m[k]+b])return y[k]+v;return v},m.defaults=function(v){for(var m,y=1,b=arguments.length;y<b;y++)for(var w in m=arguments[y])void 0===v[w]&&(v[w]=m[w]);return v},m.extend=function(v){return[].slice.call(arguments,1).forEach((function(m){m&&Object.getOwnPropertyNames(m).forEach((function(y){Object.defineProperty(v,y,Object.getOwnPropertyDescriptor(m,y))}))})),v},m.insert=function(v,m,y){var b=l(v,m,y);return m.splice(b,0,v),b},m.locationOf=l,m.indexOfSorted=function d(v,m,y,b,w){var k,x=b||0,E=w||m.length,_=parseInt(x+(E-x)/2);return y||(y=function(v,m){return v>m?1:v<m?-1:v==m?0:void 0}),0>=E-x?-1:(k=y(m[_],v),1==E-x?0===k?_:-1:0===k?_:-1===k?d(v,m,y,_,E):d(v,m,y,x,_))},m.bounds=function(v){var m=window.getComputedStyle(v),y=0,b=0;return["width","paddingRight","paddingLeft","marginRight","marginLeft","borderRightWidth","borderLeftWidth"].forEach((function(v){y+=parseFloat(m[v])||0})),["height","paddingTop","paddingBottom","marginTop","marginBottom","borderTopWidth","borderBottomWidth"].forEach((function(v){b+=parseFloat(m[v])||0})),{height:b,width:y}},m.borders=function(v){var m=window.getComputedStyle(v),y=0,b=0;return["paddingRight","paddingLeft","marginRight","marginLeft","borderRightWidth","borderLeftWidth"].forEach((function(v){y+=parseFloat(m[v])||0})),["paddingTop","paddingBottom","marginTop","marginBottom","borderTopWidth","borderBottomWidth"].forEach((function(v){b+=parseFloat(m[v])||0})),{height:b,width:y}},m.windowBounds=function(){var v=window.innerWidth,m=window.innerHeight;return{top:0,left:0,right:v,bottom:m,width:v,height:m}},m.indexOfNode=u,m.indexOfTextNode=function(v){return u(v,E)},m.indexOfElementNode=function(v){return u(v,w)},m.isXml=function(v){return-1<["xml","opf","ncx"].indexOf(v)},m.createBlob=c,m.createBlobUrl=function(v,m){var y=c(v,m);return _.createObjectURL(y)},m.revokeBlobUrl=function(v){return _.revokeObjectURL(v)},m.createBase64Url=function(v,m){if("string"==typeof v)return"data:"+m+";base64,"+btoa(encodeURIComponent(v))},m.type=function(v){return Object.prototype.toString.call(v).slice(8,-1)},m.parse=function(v,m,b){var w;return w="undefined"==typeof DOMParser||b?y(16).DOMParser:DOMParser,65279===v.charCodeAt(0)&&(v=v.slice(1)),(new w).parseFromString(v,m)},m.qs=function(v,m){var y;if(!v)throw new Error("No Element Provided");return void 0===v.querySelector?(y=v.getElementsByTagName(m)).length?y[0]:void 0:v.querySelector(m)},m.qsa=p,m.qsp=function(v,m,y){var b,w;if(void 0!==v.querySelector){for(var k in m+="[",y)m+=k+"~='"+y[k]+"'";return m+="]",v.querySelector(m)}return b=v.getElementsByTagName(m),w=Array.prototype.slice.call(b,0).filter((function(v){for(var m in y)if(v.getAttribute(m)===y[m])return!0;return!1})),w?w[0]:void 0},m.sprint=function(v,m){void 0===(v.ownerDocument||v).createTreeWalker?g(v,(function(v){v&&3===v.nodeType&&m(v)})):h(v,m,NodeFilter.SHOW_TEXT)},m.treeWalker=h,m.walk=g,m.blob2base64=function(v){return new Promise((function(m){var y=new FileReader;y.readAsDataURL(v),y.onloadend=function(){m(y.result)}}))},m.defer=function(){var v=this;this.resolve=null,this.reject=null,this.id=i(),this.promise=new Promise((function(m,y){v.resolve=m,v.reject=y})),Object.freeze(this)},m.querySelectorByType=function(v,m,y){var b;if(void 0!==v.querySelector&&(b=v.querySelector(m+'[*|type="'+y+'"]')),b&&0!==b.length)return b;b=p(v,m);for(var w=0;w<b.length;w++)if(b[w].getAttributeNS("http://www.idpf.org/2007/ops","type")===y||b[w].getAttribute("epub:type")===y)return b[w]},m.findChildren=function(v){for(var m,y=[],b=v.childNodes,w=0;w<b.length;w++)1===(m=b[w]).nodeType&&y.push(m);return y},m.parents=f,m.filterChildren=function(v,m,y){for(var b,w=[],k=v.childNodes,x=0;x<k.length;x++)if(1===(b=k[x]).nodeType&&b.nodeName.toLowerCase()===m){if(y)return b;w.push(b)}if(!y)return w},m.getParentByTagName=function(v,m){var y;if(null!==v&&""!==m)for(y=v.parentNode;1===y.nodeType;){if(y.tagName.toLowerCase()===m)return y;y=y.parentNode}};m.requestAnimationFrame="undefined"!=typeof window&&(window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame);var w=1,E=3,_="undefined"==typeof URL?"undefined"==typeof window?void 0:window.URL||window.webkitURL||window.mozURL:URL;m.RangeObject=function(){function e(){(function a(v,m){if(!(v instanceof m))throw new TypeError("Cannot call a class as a function")})(this,e),this.collapsed=!1,this.commonAncestorContainer=void 0,this.endContainer=void 0,this.endOffset=void 0,this.startContainer=void 0,this.startOffset=void 0}return b(e,[{key:"setStart",value:function(v,m){this.startContainer=v,this.startOffset=m,this.endContainer?this.commonAncestorContainer=this._commonAncestorContainer():this.collapse(!0),this._checkCollapsed()}},{key:"setEnd",value:function(v,m){this.endContainer=v,this.endOffset=m,this.startContainer?(this.collapsed=!1,this.commonAncestorContainer=this._commonAncestorContainer()):this.collapse(!1),this._checkCollapsed()}},{key:"collapse",value:function(v){this.collapsed=!0,v?(this.endContainer=this.startContainer,this.endOffset=this.startOffset,this.commonAncestorContainer=this.startContainer.parentNode):(this.startContainer=this.endContainer,this.startOffset=this.endOffset,this.commonAncestorContainer=this.endOffset.parentNode)}},{key:"selectNode",value:function(v){var m=v.parentNode,y=Array.prototype.indexOf.call(m.childNodes,v);this.setStart(m,y),this.setEnd(m,y+1)}},{key:"selectNodeContents",value:function(v){v.childNodes[v.childNodes-1];var m=3===v.nodeType?v.textContent.length:parent.childNodes.length;this.setStart(v,0),this.setEnd(v,m)}},{key:"_commonAncestorContainer",value:function(v,m){var y=f(v||this.startContainer),b=f(m||this.endContainer);if(y[0]==b[0])for(var w=0;w<y.length;w++)if(y[w]!=b[w])return y[w-1]}},{key:"_checkCollapsed",value:function(){this.collapsed=this.startContainer===this.endContainer&&this.startOffset===this.endOffset}},{key:"toString",value:function(){}}]),e}()},function(v,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(v){return typeof v}:function(v){return v&&"function"==typeof Symbol&&v.constructor===Symbol&&v!==Symbol.prototype?"symbol":typeof v},w=function(){function e(v,m){for(var y,b=0;b<m.length;b++)(y=m[b]).enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(v,y.key,y)}return function(v,m,y){return m&&e(v.prototype,m),y&&e(v,y),v}}(),k=y(0),x=function(){function e(v,m,y){var w;if(function a(v,m){if(!(v instanceof m))throw new TypeError("Cannot call a class as a function")}(this,e),this.str="",this.base={},this.spinePos=0,this.range=!1,this.path={},this.start=null,this.end=null,!(this instanceof e))return new e(v,m,y);if("string"==typeof m?this.base=this.parseComponent(m):"object"===(void 0===m?"undefined":b(m))&&m.steps&&(this.base=m),"string"===(w=this.checkType(v)))return this.str=v,(0,k.extend)(this,this.parse(v));if("range"===w)return(0,k.extend)(this,this.fromRange(v,this.base,y));if("node"===w)return(0,k.extend)(this,this.fromNode(v,this.base,y));if("EpubCFI"===w&&v.path)return v;if(!v)return this;throw new TypeError("not a valid argument for EpubCFI")}return w(e,[{key:"checkType",value:function(v){return this.isCfiString(v)?"string":"object"!==(void 0===v?"undefined":b(v))||"Range"!==(0,k.type)(v)&&void 0===v.startContainer?"object"===(void 0===v?"undefined":b(v))&&void 0!==v.nodeType?"node":"object"===(void 0===v?"undefined":b(v))&&v instanceof e&&"EpubCFI":"range"}},{key:"parse",value:function(v){var m,y,b,w={spinePos:-1,range:!1,base:{},path:{},start:null,end:null};return"string"==typeof v?(0===v.indexOf("epubcfi(")&&")"===v[v.length-1]&&(v=v.slice(8,v.length-1)),(m=this.getChapterComponent(v))?(w.base=this.parseComponent(m),y=this.getPathComponent(v),w.path=this.parseComponent(y),(b=this.getRange(v))&&(w.range=!0,w.start=this.parseComponent(b[0]),w.end=this.parseComponent(b[1])),w.spinePos=w.base.steps[1].index,w):{spinePos:-1}):{spinePos:-1}}},{key:"parseComponent",value:function(v){var m,y={steps:[],terminal:{offset:null,assertion:null}},b=v.split(":"),w=b[0].split("/");return 1<b.length&&(m=b[1],y.terminal=this.parseTerminal(m)),""===w[0]&&w.shift(),y.steps=w.map(function(v){return this.parseStep(v)}.bind(this)),y}},{key:"parseStep",value:function(v){var m,y,b,w,k;if((w=v.match(/\[(.*)\]/))&&w[1]&&(k=w[1]),y=parseInt(v),!isNaN(y))return 0==y%2?(m="element",b=y/2-1):(m="text",b=(y-1)/2),{type:m,index:b,id:k||null}}},{key:"parseTerminal",value:function(v){var m,y,b=v.match(/\[(.*)\]/);return b&&b[1]?(m=parseInt(v.split("[")[0]),y=b[1]):m=parseInt(v),(0,k.isNumber)(m)||(m=null),{offset:m,assertion:y}}},{key:"getChapterComponent",value:function(v){return v.split("!")[0]}},{key:"getPathComponent",value:function(v){var m=v.split("!");if(m[1])return m[1].split(",")[0]}},{key:"getRange",value:function(v){var m=v.split(",");return 3===m.length&&[m[1],m[2]]}},{key:"getCharecterOffsetComponent",value:function(v){return v.split(":")[1]||""}},{key:"joinSteps",value:function(v){return v?v.map((function(v){var m="";return"element"===v.type&&(m+=2*(v.index+1)),"text"===v.type&&(m+=1+2*v.index),v.id&&(m+="["+v.id+"]"),m})).join("/"):""}},{key:"segmentString",value:function(v){var m="/";return m+=this.joinSteps(v.steps),v.terminal&&null!=v.terminal.offset&&(m+=":"+v.terminal.offset),v.terminal&&null!=v.terminal.assertion&&(m+="["+v.terminal.assertion+"]"),m}},{key:"toString",value:function(){var v="epubcfi(";return v+=this.segmentString(this.base),v+="!",v+=this.segmentString(this.path),this.range&&this.start&&(v+=",",v+=this.segmentString(this.start)),this.range&&this.end&&(v+=",",v+=this.segmentString(this.end)),v+=")"}},{key:"compare",value:function(v,m){var y,b,w,k;if("string"==typeof v&&(v=new e(v)),"string"==typeof m&&(m=new e(m)),v.spinePos>m.spinePos)return 1;if(v.spinePos<m.spinePos)return-1;v.range?(y=v.path.steps.concat(v.start.steps),w=v.start.terminal):(y=v.path.steps,w=v.path.terminal),m.range?(b=m.path.steps.concat(m.start.steps),k=m.start.terminal):(b=m.path.steps,k=m.path.terminal);for(var x=0;x<y.length;x++){if(!y[x])return-1;if(!b[x])return 1;if(y[x].index>b[x].index)return 1;if(y[x].index<b[x].index)return-1}return y.length<b.length||w.offset>k.offset?1:w.offset<k.offset?-1:0}},{key:"step",value:function(v){var m=3===v.nodeType?"text":"element";return{id:v.id,tagName:v.tagName,type:m,index:this.position(v)}}},{key:"filteredStep",value:function(v,m){var y,b=this.filter(v,m);if(b)return y=3===b.nodeType?"text":"element",{id:b.id,tagName:b.tagName,type:y,index:this.filteredPosition(b,m)}}},{key:"pathTo",value:function(v,m,y){for(var b,w={steps:[],terminal:{offset:null,assertion:null}},k=v;k&&k.parentNode&&9!=k.parentNode.nodeType;)(b=y?this.filteredStep(k,y):this.step(k))&&w.steps.unshift(b),k=k.parentNode;return null!=m&&0<=m&&(w.terminal.offset=m,"text"!=w.steps[w.steps.length-1].type&&w.steps.push({type:"text",index:0})),w}},{key:"equalStep",value:function(v,m){return v&&m&&v.index===m.index&&v.id===m.id&&v.type===m.type}},{key:"fromRange",value:function(v,m,y){var w={range:!1,base:{},path:{},start:null,end:null},k=v.startContainer,x=v.endContainer,E=v.startOffset,_=v.endOffset,S=!1;if(y&&(S=null!=k.ownerDocument.querySelector("."+y)),"string"==typeof m?(w.base=this.parseComponent(m),w.spinePos=w.base.steps[1].index):"object"===(void 0===m?"undefined":b(m))&&(w.base=m),v.collapsed)S&&(E=this.patchOffset(k,E,y)),w.path=this.pathTo(k,E,y);else{w.range=!0,S&&(E=this.patchOffset(k,E,y)),w.start=this.pathTo(k,E,y),S&&(_=this.patchOffset(x,_,y)),w.end=this.pathTo(x,_,y),w.path={steps:[],terminal:null};var C,T=w.start.steps.length;for(C=0;C<T&&this.equalStep(w.start.steps[C],w.end.steps[C]);C++)C===T-1?w.start.terminal===w.end.terminal&&(w.path.steps.push(w.start.steps[C]),w.range=!1):w.path.steps.push(w.start.steps[C]);w.start.steps=w.start.steps.slice(w.path.steps.length),w.end.steps=w.end.steps.slice(w.path.steps.length)}return w}},{key:"fromNode",value:function(v,m,y){var w={range:!1,base:{},path:{},start:null,end:null};return"string"==typeof m?(w.base=this.parseComponent(m),w.spinePos=w.base.steps[1].index):"object"===(void 0===m?"undefined":b(m))&&(w.base=m),w.path=this.pathTo(v,null,y),w}},{key:"filter",value:function(v,m){var y,b,w,k,x,E=!1;return 3===v.nodeType?(E=!0,w=v.parentNode,y=v.parentNode.classList.contains(m)):(E=!1,y=v.classList.contains(m)),y&&E?(k=w.previousSibling,x=w.nextSibling,k&&3===k.nodeType?b=k:x&&3===x.nodeType&&(b=x),b||v):!(y&&!E)&&v}},{key:"patchOffset",value:function(v,m,y){if(3!=v.nodeType)throw new Error("Anchor must be a text node");var b=v,w=m;for(v.parentNode.classList.contains(y)&&(b=v.parentNode);b.previousSibling;){if(1!==b.previousSibling.nodeType)w+=b.previousSibling.textContent.length;else{if(!b.previousSibling.classList.contains(y))break;w+=b.previousSibling.textContent.length}b=b.previousSibling}return w}},{key:"normalizedMap",value:function(v,m,y){var b,w,k,x={},E=-1,_=v.length;for(b=0;b<_;b++)1===(w=v[b].nodeType)&&v[b].classList.contains(y)&&(w=3),0<b&&3===w&&3===k?x[b]=E:m===w&&(++E,x[b]=E),k=w;return x}},{key:"position",value:function(v){var m,y;return 1===v.nodeType?(!(m=v.parentNode.children)&&(m=(0,k.findChildren)(v.parentNode)),y=Array.prototype.indexOf.call(m,v)):y=(m=this.textNodes(v.parentNode)).indexOf(v),y}},{key:"filteredPosition",value:function(v,m){var y,b;return 1===v.nodeType?(y=v.parentNode.children,b=this.normalizedMap(y,1,m)):(y=v.parentNode.childNodes,v.parentNode.classList.contains(m)&&(y=(v=v.parentNode).parentNode.childNodes),b=this.normalizedMap(y,3,m)),b[Array.prototype.indexOf.call(y,v)]}},{key:"stepsToXpath",value:function(v){var m=[".","*"];return v.forEach((function(v){var y=v.index+1;v.id?m.push("*[position()="+y+" and @id='"+v.id+"']"):"text"===v.type?m.push("text()["+y+"]"):m.push("*["+y+"]")})),m.join("/")}},{key:"stepsToQuerySelector",value:function(v){var m=["html"];return v.forEach((function(v){var y=v.index+1;v.id?m.push("#"+v.id):"text"===v.type||m.push("*:nth-child("+y+")")})),m.join(">")}},{key:"textNodes",value:function(v,m){return Array.prototype.slice.call(v.childNodes).filter((function(v){return 3===v.nodeType||m&&v.classList.contains(m)}))}},{key:"walkToNode",value:function(v,m,y){var b,w,x=m||document,E=x.documentElement,_=v.length;for(w=0;w<_&&("element"===(b=v[w]).type?b.id?E=x.getElementById(b.id):E=(E.children||(0,k.findChildren)(E))[b.index]:"text"===b.type&&(E=this.textNodes(E,y)[b.index]),E);w++);return E}},{key:"findNode",value:function(v,m,y){var b,w,k=m||document;return y||void 0===k.evaluate?b=y?this.walkToNode(v,k,y):this.walkToNode(v,k):(w=this.stepsToXpath(v),b=k.evaluate(w,k,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue),b}},{key:"fixMiss",value:function(v,m,y,b){var w,k,x=this.findNode(v.slice(0,-1),y,b),E=x.childNodes,_=this.normalizedMap(E,3,b),S=v[v.length-1].index;for(var C in _){if(!_.hasOwnProperty(C))return;if(_[C]===S){if(!(m>(k=(w=E[C]).textContent.length))){x=1===w.nodeType?w.childNodes[0]:w;break}m-=k}}return{container:x,offset:m}}},{key:"toRange",value:function(v,m){var y,b,w,x,E,_,S,C,T=v||document,N=this,O=!!m&&null!=T.querySelector("."+m);if(y=void 0===T.createRange?new k.RangeObject:T.createRange(),N.range?(b=N.start,_=N.path.steps.concat(b.steps),x=this.findNode(_,T,O?m:null),w=N.end,S=N.path.steps.concat(w.steps),E=this.findNode(S,T,O?m:null)):(b=N.path,_=N.path.steps,x=this.findNode(N.path.steps,T,O?m:null)),!x)return console.log("No startContainer found for",this.toString()),null;try{null==b.terminal.offset?y.setStart(x,0):y.setStart(x,b.terminal.offset)}catch(N){C=this.fixMiss(_,b.terminal.offset,T,O?m:null),y.setStart(C.container,C.offset)}if(E)try{null==w.terminal.offset?y.setEnd(E,0):y.setEnd(E,w.terminal.offset)}catch(v){C=this.fixMiss(S,N.end.terminal.offset,T,O?m:null),y.setEnd(C.container,C.offset)}return y}},{key:"isCfiString",value:function(v){return"string"==typeof v&&0===v.indexOf("epubcfi(")&&")"===v[v.length-1]}},{key:"generateChapterComponent",value:function(v,m,y){var b="/"+2*(v+1)+"/";return b+=2*(parseInt(m)+1),y&&(b+="["+y+"]"),b}},{key:"collapse",value:function(v){this.range&&(this.range=!1,v?(this.path.steps=this.path.steps.concat(this.start.steps),this.path.terminal=this.start.terminal):(this.path.steps=this.path.steps.concat(this.end.steps),this.path.terminal=this.end.terminal))}}]),e}();m.default=x,v.exports=m.default},function(v,m,y){"use strict";var b,w,k,x,E,_,S,C=y(27),T=y(41),N=Function.prototype.apply,O=Function.prototype.call,R=Object.create,L=Object.defineProperty,P=Object.defineProperties,A=Object.prototype.hasOwnProperty,j={configurable:!0,enumerable:!1,writable:!0};b=function(v,m){var y;return T(m),A.call(this,"__ee__")?y=this.__ee__:(y=j.value=R(null),L(this,"__ee__",j),j.value=null),y[v]?"object"==typeof y[v]?y[v].push(m):y[v]=[y[v],m]:y[v]=m,this},w=function(v,m){var y,w;return T(m),w=this,b.call(this,v,y=function(){k.call(w,v,y),N.call(m,this,arguments)}),y.__eeOnceListener__=m,this},k=function(v,m){var y,b,w,k;if(T(m),!A.call(this,"__ee__"))return this;if(!(y=this.__ee__)[v])return this;if("object"==typeof(b=y[v]))for(k=0;w=b[k];++k)(w===m||w.__eeOnceListener__===m)&&(2===b.length?y[v]=b[k?0:1]:b.splice(k,1));else(b===m||b.__eeOnceListener__===m)&&delete y[v];return this},x=function(v){var m,y,b,w,k;if(A.call(this,"__ee__")&&(w=this.__ee__[v]))if("object"==typeof w){for(y=arguments.length,k=Array(y-1),m=1;m<y;++m)k[m-1]=arguments[m];for(w=w.slice(),m=0;b=w[m];++m)N.call(b,this,k)}else switch(arguments.length){case 1:O.call(w,this);break;case 2:O.call(w,this,arguments[1]);break;case 3:O.call(w,this,arguments[1],arguments[2]);break;default:for(y=arguments.length,k=Array(y-1),m=1;m<y;++m)k[m-1]=arguments[m];N.call(w,this,k)}},E={on:b,once:w,off:k,emit:x},_={on:C(b),once:C(w),off:C(k),emit:C(x)},S=P({},_),v.exports=m=function(v){return null==v?R(S):P(Object(v),_)},m.methods=E},function(v,m){"use strict";Object.defineProperty(m,"__esModule",{value:!0});m.DOM_EVENTS=["keydown","keyup","keypressed","mouseup","mousedown","click","touchend","touchstart"],m.EVENTS={BOOK:{OPEN_FAILED:"openFailed"},CONTENTS:{EXPAND:"expand",RESIZE:"resize",SELECTED:"selected",SELECTED_RANGE:"selectedRange",LINK_CLICKED:"linkClicked"},LOCATIONS:{CHANGED:"changed"},MANAGERS:{RESIZE:"resize",RESIZED:"resized",ORIENTATION_CHANGE:"orientationchange",ADDED:"added",SCROLL:"scroll",SCROLLED:"scrolled"},VIEWS:{AXIS:"axis",LOAD_ERROR:"loaderror",RENDERED:"rendered",RESIZED:"resized",DISPLAYED:"displayed",SHOWN:"shown",HIDDEN:"hidden",MARK_CLICKED:"markClicked"},RENDITION:{STARTED:"started",ATTACHED:"attached",DISPLAYED:"displayed",DISPLAY_ERROR:"displayerror",RENDERED:"rendered",REMOVED:"removed",RESIZED:"resized",ORIENTATION_CHANGE:"orientationchange",LOCATION_CHANGED:"locationChanged",RELOCATED:"relocated",MARK_CLICKED:"markClicked",SELECTED:"selected",LAYOUT:"layout"},LAYOUT:{UPDATED:"updated"}}},function(v,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var b=function(){function e(v,m){for(var y,b=0;b<m.length;b++)(y=m[b]).enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(v,y.key,y)}return function(v,m,y){return m&&e(v.prototype,m),y&&e(v,y),v}}(),w=function(v){return v&&v.__esModule?v:{default:v}}(y(6)),k=function(){function e(v){var m;!function a(v,m){if(!(v instanceof m))throw new TypeError("Cannot call a class as a function")}(this,e),-1<v.indexOf("://")&&(v=new URL(v).pathname),m=this.parse(v),this.path=v,this.directory=this.isDirectory(v)?v:m.dir+"/",this.filename=m.base,this.extension=m.ext.slice(1)}return b(e,[{key:"parse",value:function(v){return w.default.parse(v)}},{key:"isAbsolute",value:function(v){return w.default.isAbsolute(v||this.path)}},{key:"isDirectory",value:function(v){return"/"===v.charAt(v.length-1)}},{key:"resolve",value:function(v){return w.default.resolve(this.directory,v)}},{key:"relative",value:function(v){return w.default.relative(this.directory,v)}},{key:"splitPath",value:function(v){return this.splitPathRe.exec(v).slice(1)}},{key:"toString",value:function(){return this.path}}]),e}();m.default=k,v.exports=m.default},function(v,m,y){"use strict";function a(v){return v&&v.__esModule?v:{default:v}}Object.defineProperty(m,"__esModule",{value:!0});var b=function(){function e(v,m){for(var y,b=0;b<m.length;b++)(y=m[b]).enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(v,y.key,y)}return function(v,m,y){return m&&e(v.prototype,m),y&&e(v,y),v}}(),w=a(y(4)),k=a(y(6)),x=function(){function e(v,m){!function i(v,m){if(!(v instanceof m))throw new TypeError("Cannot call a class as a function")}(this,e);var y=-1<v.indexOf("://"),b=v;if(this.Url=void 0,this.href=v,this.protocol="",this.origin="",this.hash="",this.hash="",this.search="",this.base=m,!y&&!1!==m&&"string"!=typeof m&&window&&window.location&&(this.base=window.location.href),y||this.base)try{this.Url=this.base?new URL(v,this.base):new URL(v),this.href=this.Url.href,this.protocol=this.Url.protocol,this.origin=this.Url.origin,this.hash=this.Url.hash,this.search=this.Url.search,b=this.Url.pathname}catch(v){this.Url=void 0,this.base&&(b=new w.default(this.base).resolve(b))}this.Path=new w.default(b),this.directory=this.Path.directory,this.filename=this.Path.filename,this.extension=this.Path.extension}return b(e,[{key:"path",value:function(){return this.Path}},{key:"resolve",value:function(v){var m;return-1<v.indexOf("://")?v:(m=k.default.resolve(this.directory,v),this.origin+m)}},{key:"relative",value:function(v){return k.default.relative(v,this.directory)}},{key:"toString",value:function(){return this.href}}]),e}();m.default=x,v.exports=m.default},function(v){"use strict";function t(v){if("string"!=typeof v)throw new TypeError("Path must be a string. Received "+v)}function n(v,m){for(var y,b="",w=-1,k=0,x=0;x<=v.length;++x){if(x<v.length)y=v.charCodeAt(x);else{if(47===y)break;y=47}if(47===y){if(w==x-1||1==k);else if(w!=x-1&&2==k){if(2>b.length||46!==b.charCodeAt(b.length-1)||46!==b.charCodeAt(b.length-2))if(2<b.length){for(var E=b.length-1,_=E;0<=_&&47!==b.charCodeAt(_);--_);if(_!=E){b=-1==_?"":b.slice(0,_),w=x,k=0;continue}}else if(2===b.length||1===b.length){b="",w=x,k=0;continue}m&&(0<b.length?b+="/..":b="..")}else 0<b.length?b+="/"+v.slice(w+1,x):b=v.slice(w+1,x);w=x,k=0}else 46===y&&-1!=k?++k:k=-1}return b}if(!m)var m={cwd:function(){return"/"}};var y={resolve:function(){for(var v,y="",b=!1,w=arguments.length-1;-1<=w&&!b;w--){var k;0<=w?k=arguments[w]:(null==v&&(v=m.cwd()),k=v),t(k),0!==k.length&&(y=k+"/"+y,b=47===k.charCodeAt(0))}return y=n(y,!b),b?0<y.length?"/"+y:"/":0<y.length?y:"."},normalize:function(v){if(t(v),0===v.length)return".";var m=47===v.charCodeAt(0),y=47===v.charCodeAt(v.length-1);return 0!==(v=n(v,!m)).length||m||(v="."),0<v.length&&y&&(v+="/"),m?"/"+v:v},isAbsolute:function(v){return t(v),0<v.length&&47===v.charCodeAt(0)},join:function(){if(0===arguments.length)return".";for(var v,m,b=0;b<arguments.length;++b)t(m=arguments[b]),0<m.length&&(null==v?v=m:v+="/"+m);return void 0===v?".":y.normalize(v)},relative:function(v,m){if(t(v),t(m),v===m)return"";if((v=y.resolve(v))===(m=y.resolve(m)))return"";for(var b=1;b<v.length&&47===v.charCodeAt(b);++b);for(var w=v.length,k=w-b,x=1;x<m.length&&47===m.charCodeAt(x);++x);for(var E=m.length-x,_=k<E?k:E,S=-1,C=0;C<=_;++C){if(C==_){if(E>_){if(47===m.charCodeAt(x+C))return m.slice(x+C+1);if(0==C)return m.slice(x+C)}else k>_&&(47===v.charCodeAt(b+C)?S=C:0==C&&(S=0));break}var T=v.charCodeAt(b+C);if(T!==m.charCodeAt(x+C))break;47===T&&(S=C)}var N="";for(C=b+S+1;C<=w;++C)(C===w||47===v.charCodeAt(C))&&(N+=0===N.length?"..":"/..");return 0<N.length?N+m.slice(x+S):(x+=S,47===m.charCodeAt(x)&&++x,m.slice(x))},_makeLong:function(v){return v},dirname:function(v){if(t(v),0===v.length)return".";for(var m=v.charCodeAt(0),y=47===m,b=-1,w=!0,k=v.length-1;1<=k;--k)if(47!==(m=v.charCodeAt(k)))w=!1;else if(!w){b=k;break}return-1===b?y?"/":".":y&&1===b?"//":v.slice(0,b)},basename:function(v,m){if(void 0!==m&&"string"!=typeof m)throw new TypeError('"ext" argument must be a string');t(v);var y,b=0,w=-1,k=!0;if(void 0!==m&&0<m.length&&m.length<=v.length){if(m.length===v.length&&m===v)return"";var x=m.length-1,E=-1;for(y=v.length-1;0<=y;--y){var _=v.charCodeAt(y);if(47!==_)-1==E&&(k=!1,E=y+1),0<=x&&(_===m.charCodeAt(x)?-1==--x&&(w=y):(x=-1,w=E));else if(!k){b=y+1;break}}return b===w?w=E:-1===w&&(w=v.length),v.slice(b,w)}for(y=v.length-1;0<=y;--y)if(47!==v.charCodeAt(y))-1==w&&(k=!1,w=y+1);else if(!k){b=y+1;break}return-1===w?"":v.slice(b,w)},extname:function(v){t(v);for(var m,y=-1,b=0,w=-1,k=!0,x=0,E=v.length-1;0<=E;--E)if(47!==(m=v.charCodeAt(E)))-1==w&&(k=!1,w=E+1),46===m?-1==y?y=E:1!=x&&(x=1):-1!==y&&(x=-1);else if(!k){b=E+1;break}return-1===y||-1===w||0==x||1==x&&y===w-1&&y===b+1?"":v.slice(y,w)},format:function(v){if(null===v||"object"!=typeof v)throw new TypeError('Parameter "pathObject" must be an object, not '+typeof v);return function a(v,m){var y=m.dir||m.root,b=m.base||(m.name||"")+(m.ext||"");return y?y===m.root?y+b:y+v+b:b}("/",v)},parse:function(v){t(v);var m={root:"",dir:"",base:"",ext:"",name:""};if(0===v.length)return m;var y,b=v.charCodeAt(0),w=47===b;w?(m.root="/",y=1):y=0;for(var k=-1,x=0,E=-1,_=!0,S=v.length-1,C=0;S>=y;--S)if(47!==(b=v.charCodeAt(S)))-1==E&&(_=!1,E=S+1),46===b?-1==k?k=S:1!=C&&(C=1):-1!=k&&(C=-1);else if(!_){x=S+1;break}return-1==k||-1==E||0==C||1==C&&k==E-1&&k==x+1?-1!=E&&(m.base=m.name=0==x&&w?v.slice(1,E):v.slice(x,E)):(0==x&&w?(m.name=v.slice(1,k),m.base=v.slice(1,E)):(m.name=v.slice(x,k),m.base=v.slice(x,E)),m.ext=v.slice(k,E)),0<x?m.dir=v.slice(0,x-1):w&&(m.dir="/"),m},sep:"/",delimiter:":",posix:null};v.exports=y},function(v,m,y){"use strict";function a(v){return v&&v.__esModule?v:{default:v}}Object.defineProperty(m,"__esModule",{value:!0}),m.replaceBase=function(v,m){var y,w,k=m.url,x=-1<k.indexOf("://");v&&(w=(0,b.qs)(v,"head"),!(y=(0,b.qs)(w,"base"))&&(y=v.createElement("base"),w.insertBefore(y,w.firstChild)),!x&&window&&window.location&&(k=window.location.origin+k),y.setAttribute("href",k))},m.replaceCanonical=function(v,m){var y,w,k=m.canonical;v&&(y=(0,b.qs)(v,"head"),(w=(0,b.qs)(y,"link[rel='canonical']"))?w.setAttribute("href",k):((w=v.createElement("link")).setAttribute("rel","canonical"),w.setAttribute("href",k),y.appendChild(w)))},m.replaceMeta=function(v,m){var y,w,k=m.idref;v&&(y=(0,b.qs)(v,"head"),(w=(0,b.qs)(y,"link[property='dc.identifier']"))?w.setAttribute("content",k):((w=v.createElement("meta")).setAttribute("name","dc.identifier"),w.setAttribute("content",k),y.appendChild(w)))},m.replaceLinks=function(v,m){var y=v.querySelectorAll("a[href]");if(y.length)for(var k=(0,b.qs)(v.ownerDocument,"base"),x=k?k.getAttribute("href"):void 0,E=function(v){var y=v.getAttribute("href");if(0!==y.indexOf("mailto:")){var b=-1<y.indexOf("://"),k=new w.default(y,x);b?v.setAttribute("target","_blank"):v.onclick=function(){return k&&k.hash?m(k.Path.path+k.hash):m(k?k.Path.path:y),!1}}}.bind(this),_=0;_<y.length;_++)E(y[_])},m.substitute=function(v,m,y){return m.forEach((function(m,b){m&&y[b]&&(v=v.replace(new RegExp(m,"g"),y[b]))})),v};var b=y(0),w=a(y(5));a(y(4))},function(v){var m=function(){return this}();try{m=m||Function("return this")()||(0,eval)("this")}catch(v){"object"==typeof window&&(m=window)}v.exports=m},function(v,m,y){"use strict";var b=y(34)();v.exports=function(v){return v!==b&&null!==v}},function(v,m){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var y=function(){function e(v,m){for(var y,b=0;b<m.length;b++)(y=m[b]).enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(v,y.key,y)}return function(v,m,y){return m&&e(v.prototype,m),y&&e(v,y),v}}(),b=function(){function e(v){(function n(v,m){if(!(v instanceof m))throw new TypeError("Cannot call a class as a function")})(this,e),this.context=v||this,this.hooks=[]}return y(e,[{key:"register",value:function(){for(var v=0;v<arguments.length;++v)if("function"==typeof arguments[v])this.hooks.push(arguments[v]);else for(var m=0;m<arguments[v].length;++m)this.hooks.push(arguments[v][m])}},{key:"trigger",value:function(){var v=arguments,m=this.context,y=[];return this.hooks.forEach((function(b){var w=b.apply(m,v);w&&"function"==typeof w.then&&y.push(w)})),Promise.all(y)}},{key:"list",value:function(){return this.hooks}},{key:"clear",value:function(){return this.hooks=[]}}]),e}();m.default=b,v.exports=m.default},function(v,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var b=y(0),w=function(v){return v&&v.__esModule?v:{default:v}}(y(4));m.default=function(v,m,y,k){var x,E="undefined"!=typeof window&&window.URL,_=E?"blob":"arraybuffer",S=new b.defer,C=new XMLHttpRequest,T=XMLHttpRequest.prototype;for(x in"overrideMimeType"in T||Object.defineProperty(T,"overrideMimeType",{value:function(){}}),y&&(C.withCredentials=!0),C.onreadystatechange=function r(){if(this.readyState===XMLHttpRequest.DONE){var v=!1;if((""===this.responseType||"document"===this.responseType)&&(v=this.responseXML),200===this.status||0===this.status||v){var y;if(!this.response&&!v)return S.reject({status:this.status,message:"Empty Response",stack:(new Error).stack}),S.promise;if(403===this.status)return S.reject({status:this.status,response:this.response,message:"Forbidden",stack:(new Error).stack}),S.promise;y=v?this.responseXML:(0,b.isXml)(m)?(0,b.parse)(this.response,"text/xml"):"xhtml"==m?(0,b.parse)(this.response,"application/xhtml+xml"):"html"==m||"htm"==m?(0,b.parse)(this.response,"text/html"):"json"==m?JSON.parse(this.response):"blob"==m?E?this.response:new Blob([this.response]):this.response,S.resolve(y)}else S.reject({status:this.status,message:this.response,stack:(new Error).stack})}},C.onerror=function s(v){S.reject(v)},C.open("GET",v,!0),k)C.setRequestHeader(x,k[x]);return"json"==m&&C.setRequestHeader("Accept","application/json"),m||(m=new w.default(v).extension),"blob"==m&&(C.responseType=_),(0,b.isXml)(m)&&C.overrideMimeType("text/xml"),"binary"==m&&(C.responseType="arraybuffer"),C.send(),S.promise},v.exports=m.default},function(v,m,y){"use strict";function a(v,m){if(!(v instanceof m))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(m,"__esModule",{value:!0}),m.Task=void 0;var b=function(){function e(v,m){for(var y,b=0;b<m.length;b++)(y=m[b]).enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(v,y.key,y)}return function(v,m,y){return m&&e(v.prototype,m),y&&e(v,y),v}}(),w=y(0),k=function(){function e(v){a(this,e),this._q=[],this.context=v,this.tick=w.requestAnimationFrame,this.running=!1,this.paused=!1}return b(e,[{key:"enqueue",value:function(){var v,m,y=[].shift.call(arguments),b=arguments;if(!y)throw new Error("No Task Provided");return"function"==typeof y?m={task:y,args:b,deferred:v=new w.defer,promise:v.promise}:m={promise:y},this._q.push(m),0!=this.paused||this.running||this.run(),m.promise}},{key:"dequeue",value:function(){var v,m,y;return!this._q.length||this.paused?((v=new w.defer).deferred.resolve(),v.promise):(m=(v=this._q.shift()).task)?(y=m.apply(this.context,v.args))&&"function"==typeof y.then?y.then(function(){v.deferred.resolve.apply(this.context,arguments)}.bind(this),function(){v.deferred.reject.apply(this.context,arguments)}.bind(this)):(v.deferred.resolve.apply(this.context,y),v.promise):v.promise?v.promise:void 0}},{key:"dump",value:function(){for(;this._q.length;)this.dequeue()}},{key:"run",value:function(){var v=this;return this.running||(this.running=!0,this.defered=new w.defer),this.tick.call(window,(function(){v._q.length?v.dequeue().then(function(){this.run()}.bind(v)):(v.defered.resolve(),v.running=void 0)})),1==this.paused&&(this.paused=!1),this.defered.promise}},{key:"flush",value:function(){return this.running?this.running:this._q.length?(this.running=this.dequeue().then(function(){return this.running=void 0,this.flush()}.bind(this)),this.running):void 0}},{key:"clear",value:function(){this._q=[]}},{key:"length",value:function(){return this._q.length}},{key:"pause",value:function(){this.paused=!0}},{key:"stop",value:function(){this._q=[],this.running=!1,this.paused=!0}}]),e}();m.default=k,m.Task=function e(v,m,y){return a(this,e),function(){var m=this,b=arguments||[];return new Promise((function(w,k){b.push((function(v,m){!v&&m?k(m):w(v)})),v.apply(y||m,b)}))}}},function(v,m,y){"use strict";function a(v){return v&&v.__esModule?v:{default:v}}Object.defineProperty(m,"__esModule",{value:!0});var b=function(){function e(v,m){for(var y,b=0;b<m.length;b++)(y=m[b]).enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(v,y.key,y)}return function(v,m,y){return m&&e(v.prototype,m),y&&e(v,y),v}}(),k=a(y(2)),x=y(0),E=a(y(1)),_=a(y(19)),S=y(7),C=y(3),T="undefined"!=typeof navigator,N=T&&/Chrome/.test(navigator.userAgent),O=T&&!N&&/AppleWebKit/.test(navigator.userAgent),R=function(){function e(v,m,y,b){(function o(v,m){if(!(v instanceof m))throw new TypeError("Cannot call a class as a function")})(this,e),this.epubcfi=new E.default,this.document=v,this.documentElement=this.document.documentElement,this.content=m||this.document.body,this.window=this.document.defaultView,this._size={width:0,height:0},this.sectionIndex=b||0,this.cfiBase=y||"",this.epubReadingSystem("epub.js",ePub.VERSION),this.listeners()}return b(e,[{key:"width",value:function(v){var m=this.content;return v&&(0,x.isNumber)(v)&&(v+="px"),v&&(m.style.width=v),this.window.getComputedStyle(m).width}},{key:"height",value:function(v){var m=this.content;return v&&(0,x.isNumber)(v)&&(v+="px"),v&&(m.style.height=v),this.window.getComputedStyle(m).height}},{key:"contentWidth",value:function(v){var m=this.content||this.document.body;return v&&(0,x.isNumber)(v)&&(v+="px"),v&&(m.style.width=v),this.window.getComputedStyle(m).width}},{key:"contentHeight",value:function(v){var m=this.content||this.document.body;return v&&(0,x.isNumber)(v)&&(v+="px"),v&&(m.style.height=v),this.window.getComputedStyle(m).height}},{key:"textWidth",value:function(){var v=void 0,m=this.document.createRange(),y=this.content||this.document.body,b=(0,x.borders)(y);return m.selectNodeContents(y),v=m.getBoundingClientRect().width,b&&b.width&&(v+=b.width),w(v)}},{key:"textHeight",value:function(){var v=void 0,m=this.document.createRange(),y=this.content||this.document.body,b=(0,x.borders)(y);return m.selectNodeContents(y),(v=m.getBoundingClientRect().height)&&b.height&&(v+=b.height),w(v)}},{key:"scrollWidth",value:function(){return this.documentElement.scrollWidth}},{key:"scrollHeight",value:function(){return this.documentElement.scrollHeight}},{key:"overflow",value:function(v){return v&&(this.documentElement.style.overflow=v),this.window.getComputedStyle(this.documentElement).overflow}},{key:"overflowX",value:function(v){return v&&(this.documentElement.style.overflowX=v),this.window.getComputedStyle(this.documentElement).overflowX}},{key:"overflowY",value:function(v){return v&&(this.documentElement.style.overflowY=v),this.window.getComputedStyle(this.documentElement).overflowY}},{key:"css",value:function(v,m,y){var b=this.content||this.document.body;return m&&b.style.setProperty(v,m,y?"important":""),this.window.getComputedStyle(b)[v]}},{key:"viewport",value:function(v){var m,y=this.document.querySelector("meta[name='viewport']"),b={width:void 0,height:void 0,scale:void 0,minimum:void 0,maximum:void 0,scalable:void 0},w=[];if(y&&y.hasAttribute("content")){var k=y.getAttribute("content"),E=k.match(/width\s*=\s*([^,]*)/),_=k.match(/height\s*=\s*([^,]*)/),S=k.match(/initial-scale\s*=\s*([^,]*)/),C=k.match(/minimum-scale\s*=\s*([^,]*)/),T=k.match(/maximum-scale\s*=\s*([^,]*)/),N=k.match(/user-scalable\s*=\s*([^,]*)/);E&&E.length&&void 0!==E[1]&&(b.width=E[1]),_&&_.length&&void 0!==_[1]&&(b.height=_[1]),S&&S.length&&void 0!==S[1]&&(b.scale=S[1]),C&&C.length&&void 0!==C[1]&&(b.minimum=C[1]),T&&T.length&&void 0!==T[1]&&(b.maximum=T[1]),N&&N.length&&void 0!==N[1]&&(b.scalable=N[1])}return m=(0,x.defaults)(v||{},b),v&&(m.width&&w.push("width="+m.width),m.height&&w.push("height="+m.height),m.scale&&w.push("initial-scale="+m.scale),"no"===m.scalable?(w.push("minimum-scale="+m.scale),w.push("maximum-scale="+m.scale),w.push("user-scalable="+m.scalable)):(m.scalable&&w.push("user-scalable="+m.scalable),m.minimum&&w.push("minimum-scale="+m.minimum),m.maximum&&w.push("minimum-scale="+m.maximum)),!y&&((y=this.document.createElement("meta")).setAttribute("name","viewport"),this.document.querySelector("head").appendChild(y)),y.setAttribute("content",w.join(", ")),this.window.scrollTo(0,0)),m}},{key:"expand",value:function(){this.emit(C.EVENTS.CONTENTS.EXPAND)}},{key:"listeners",value:function(){this.imageLoadListeners(),this.mediaQueryListeners(),this.addEventListeners(),this.addSelectionListeners(),this.resizeListeners(),this.linksHandler()}},{key:"removeListeners",value:function(){this.removeEventListeners(),this.removeSelectionListeners(),clearTimeout(this.expanding)}},{key:"resizeCheck",value:function(){var v=this.textWidth(),m=this.textHeight();(v!=this._size.width||m!=this._size.height)&&(this._size={width:v,height:m},this.onResize&&this.onResize(this._size),this.emit(C.EVENTS.CONTENTS.RESIZE,this._size))}},{key:"resizeListeners",value:function(){clearTimeout(this.expanding),requestAnimationFrame(this.resizeCheck.bind(this)),this.expanding=setTimeout(this.resizeListeners.bind(this),350)}},{key:"transitionListeners",value:function(){var v=this.content;v.style.transitionProperty="font, font-size, font-size-adjust, font-stretch, font-variation-settings, font-weight, width, height",v.style.transitionDuration="0.001ms",v.style.transitionTimingFunction="linear",v.style.transitionDelay="0",this.document.addEventListener("transitionend",this.resizeCheck.bind(this))}},{key:"mediaQueryListeners",value:function(){for(var v=this.document.styleSheets,m=function(v){v.matches&&!this._expanding&&setTimeout(this.expand.bind(this),1)}.bind(this),y=0;y<v.length;y+=1){var b;try{b=v[y].cssRules}catch(m){return}if(!b)return;for(var w=0;w<b.length;w+=1)if(b[w].media){this.window.matchMedia(b[w].media.mediaText).addListener(m)}}}},{key:"resizeObservers",value:function(){var v=this;this.observer=new MutationObserver((function(){v.resizeCheck()})),this.observer.observe(this.document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})}},{key:"imageLoadListeners",value:function(){for(var v,m=this.document.querySelectorAll("img"),y=0;y<m.length;y++)void 0!==(v=m[y]).naturalWidth&&0===v.naturalWidth&&(v.onload=this.expand.bind(this))}},{key:"fontLoadListeners",value:function(){this.document&&this.document.fonts&&this.document.fonts.ready.then(function(){this.resizeCheck()}.bind(this))}},{key:"root",value:function(){return this.document?this.document.documentElement:null}},{key:"locationOf",value:function(v,m){var y,b={left:0,top:0};if(!this.document)return b;if(this.epubcfi.isCfiString(v)){var w=new E.default(v).toRange(this.document,m);if(w)if(w.startContainer.nodeType===Node.ELEMENT_NODE)y=w.startContainer.getBoundingClientRect(),b.left=y.left,b.top=y.top;else if(O){var k=w.startContainer,x=new Range;try{1===k.nodeType?y=k.getBoundingClientRect():w.startOffset+2<k.length?(x.setStart(k,w.startOffset),x.setEnd(k,w.startOffset+2),y=x.getBoundingClientRect()):0<w.startOffset-2?(x.setStart(k,w.startOffset-2),x.setEnd(k,w.startOffset),y=x.getBoundingClientRect()):y=k.parentNode.getBoundingClientRect()}catch(m){console.error(m,m.stack)}}else y=w.getBoundingClientRect()}else if("string"==typeof v&&-1<v.indexOf("#")){var _=v.substring(v.indexOf("#")+1),S=this.document.getElementById(_);S&&(y=S.getBoundingClientRect())}return y&&(b.left=y.left,b.top=y.top),b}},{key:"addStylesheet",value:function(v){return new Promise(function(m){var y,b=!1;return this.document?(y=this.document.querySelector("link[href='"+v+"']"))?void m(!0):((y=this.document.createElement("link")).type="text/css",y.rel="stylesheet",y.href=v,y.onload=y.onreadystatechange=function(){b||this.readyState&&"complete"!=this.readyState||(b=!0,setTimeout((function(){m(!0)}),1))},void this.document.head.appendChild(y)):void m(!1)}.bind(this))}},{key:"addStylesheetRules",value:function(v){var m,y,b="epubjs-inserted-css";if(this.document&&v&&0!==v.length)if((m=this.document.getElementById("#"+b))||((m=this.document.createElement("style")).id=b),this.document.head.appendChild(m),y=m.sheet,"[object Array]"===Object.prototype.toString.call(v))for(var w=0,k=v.length;w<k;w++){var x=1,E=v[w],_=v[w][0],S="";"[object Array]"===Object.prototype.toString.call(E[1][0])&&(E=E[1],x=0);for(var C,T=E.length;x<T;x++)S+=(C=E[x])[0]+":"+C[1]+(C[2]?" !important":"")+";\n";y.insertRule(_+"{"+S+"}",y.cssRules.length)}else{Object.keys(v).forEach((function(m){var b=v[m];if(Array.isArray(b))b.forEach((function(v){var b=Object.keys(v).map((function(m){return m+":"+v[m]})).join(";");y.insertRule(m+"{"+b+"}",y.cssRules.length)}));else{var w=Object.keys(b).map((function(v){return v+":"+b[v]})).join(";");y.insertRule(m+"{"+w+"}",y.cssRules.length)}}))}}},{key:"addScript",value:function(v){return new Promise(function(m){var y,b=!1;return this.document?((y=this.document.createElement("script")).type="text/javascript",y.async=!0,y.src=v,y.onload=y.onreadystatechange=function(){b||this.readyState&&"complete"!=this.readyState||(b=!0,setTimeout((function(){m(!0)}),1))},void this.document.head.appendChild(y)):void m(!1)}.bind(this))}},{key:"addClass",value:function(v){var m;this.document&&((m=this.content||this.document.body)&&m.classList.add(v))}},{key:"removeClass",value:function(v){var m;this.document&&((m=this.content||this.document.body)&&m.classList.remove(v))}},{key:"addEventListeners",value:function(){this.document&&C.DOM_EVENTS.forEach((function(v){this.document.addEventListener(v,this.triggerEvent.bind(this),!1)}),this)}},{key:"removeEventListeners",value:function(){this.document&&C.DOM_EVENTS.forEach((function(v){this.document.removeEventListener(v,this.triggerEvent,!1)}),this)}},{key:"triggerEvent",value:function(v){this.emit(v.type,v)}},{key:"addSelectionListeners",value:function(){this.document&&this.document.addEventListener("selectionchange",this.onSelectionChange.bind(this),!1)}},{key:"removeSelectionListeners",value:function(){this.document&&this.document.removeEventListener("selectionchange",this.onSelectionChange,!1)}},{key:"onSelectionChange",value:function(){this.selectionEndTimeout&&clearTimeout(this.selectionEndTimeout),this.selectionEndTimeout=setTimeout(function(){var v=this.window.getSelection();this.triggerSelectedEvent(v)}.bind(this),250)}},{key:"triggerSelectedEvent",value:function(v){var m,y;v&&0<v.rangeCount&&(!(m=v.getRangeAt(0)).collapsed&&(y=new E.default(m,this.cfiBase).toString(),this.emit(C.EVENTS.CONTENTS.SELECTED,y),this.emit(C.EVENTS.CONTENTS.SELECTED_RANGE,m)))}},{key:"range",value:function(v,m){return new E.default(v).toRange(this.document,m)}},{key:"cfiFromRange",value:function(v,m){return new E.default(v,this.cfiBase,m).toString()}},{key:"cfiFromNode",value:function(v,m){return new E.default(v,this.cfiBase,m).toString()}},{key:"map",value:function(v){return new _.default(v).section()}},{key:"size",value:function(v,m){var y={scale:1,scalable:"no"};this.layoutStyle("scrolling"),0<=v&&(this.width(v),y.width=v,this.css("padding","0 "+v/12+"px",!0)),0<=m&&(this.height(m),y.height=m),this.css("margin","0"),this.css("box-sizing","border-box"),this.viewport(y)}},{key:"columns",value:function(v,m,y,b){var w=(0,x.prefixed)("column-axis"),k=(0,x.prefixed)("column-gap"),E=(0,x.prefixed)("column-width"),_=(0,x.prefixed)("column-fill"),S=0===this.writingMode().indexOf("vertical")?"vertical":"horizontal";this.layoutStyle("paginated"),"rtl"===this.content.dir&&this.direction("rtl"),this.width(v),this.height(m),this.viewport({width:v,height:m,scale:1,scalable:"no"}),this.css("overflow-y","hidden"),this.css("margin","0",!0),"vertical"==S?this.css("padding",b/2+"px 20px",!0):this.css("padding","20px "+b/2+"px",!0),this.css("box-sizing","border-box"),this.css("max-width","inherit"),this.css(w,"horizontal"),this.css(_,"auto"),this.css(k,b+"px"),this.css(E,y+"px")}},{key:"scaler",value:function(v,m,y){var b="";this.css("transform-origin","top left"),(0<=m||0<=y)&&(b=" translate("+(m||0)+"px, "+(y||0)+"px )"),this.css("transform","scale("+v+")"+b)}},{key:"fit",value:function(v,m){var y=this.viewport(),b=v/parseInt(y.width),w=m/parseInt(y.height),k=b<w?b:w,x=(m-y.height*k)/2;this.layoutStyle("paginated"),this.width(v),this.height(m),this.overflow("hidden"),this.scaler(k,0,x),this.css("background-color","transparent")}},{key:"direction",value:function(v){this.documentElement&&(this.documentElement.style.direction=v)}},{key:"mapPage",value:function(v,m,y,b,w){return new _.default(m,w).page(this,v,y,b)}},{key:"linksHandler",value:function(){var v=this;(0,S.replaceLinks)(this.content,(function(m){v.emit(C.EVENTS.CONTENTS.LINK_CLICKED,m)}))}},{key:"writingMode",value:function(v){var m=(0,x.prefixed)("writing-mode");return v&&this.documentElement&&(this.documentElement.style[m]=v),this.window.getComputedStyle(this.documentElement)[m]||""}},{key:"layoutStyle",value:function(v){return v&&(this._layoutStyle=v,navigator.epubReadingSystem.layoutStyle=this._layoutStyle),this._layoutStyle||"paginated"}},{key:"epubReadingSystem",value:function(v,m){return navigator.epubReadingSystem={name:v,version:m,layoutStyle:this.layoutStyle(),hasFeature:function(v){return"dom-manipulation"===v||"layout-changes"===v||"touch-events"===v||"mouse-events"===v||"keyboard-events"===v||"spine-scripting"!==v&&!1}},navigator.epubReadingSystem}},{key:"destroy",value:function(){this.observer&&this.observer.disconnect(),this.document.removeEventListener("transitionend",this.resizeCheck),this.removeListeners()}}],[{key:"listenedEvents",get:function(){return C.DOM_EVENTS}}]),e}();(0,k.default)(R.prototype),m.default=R,v.exports=m.default},function(v,m,y){"use strict";function i(v){return v&&v.__esModule?v:{default:v}}Object.defineProperty(m,"__esModule",{value:!0});var w=function(){function e(v,m){for(var y,b=0;b<m.length;b++)(y=m[b]).enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(v,y.key,y)}return function(v,m,y){return m&&e(v.prototype,m),y&&e(v,y),v}}(),k=i(y(2)),E=y(0),_=i(y(19)),S=i(y(12)),C=i(y(56)),T=i(y(66)),N=y(3),O=function(){function e(v){(function o(v,m){if(!(v instanceof m))throw new TypeError("Cannot call a class as a function")})(this,e),this.name="default",this.View=v.view,this.request=v.request,this.renditionQueue=v.queue,this.q=new S.default(this),this.settings=(0,E.extend)(this.settings||{},{infinite:!0,hidden:!1,width:void 0,height:void 0,axis:void 0,flow:"scrolled",ignoreClass:""}),(0,E.extend)(this.settings,v.settings||{}),this.viewSettings={ignoreClass:this.settings.ignoreClass,axis:this.settings.axis,flow:this.settings.flow,layout:this.layout,method:this.settings.method,width:0,height:0,forceEvenPages:!0},this.rendered=!1}return w(e,[{key:"render",value:function(v,m){var y=v.tagName;y&&("body"==y.toLowerCase()||"html"==y.toLowerCase())&&(this.fullsize=!0),this.fullsize&&(this.settings.overflow="visible",this.overflow=this.settings.overflow),this.settings.size=m,this.stage=new C.default({width:m.width,height:m.height,overflow:this.overflow,hidden:this.settings.hidden,axis:this.settings.axis,fullsize:this.fullsize,direction:this.settings.direction}),this.stage.attachTo(v),this.container=this.stage.getContainer(),this.views=new T.default(this.container),this._bounds=this.bounds(),this._stageSize=this.stage.size(),this.viewSettings.width=this._stageSize.width,this.viewSettings.height=this._stageSize.height,this.stage.onResize(this.onResized.bind(this)),this.stage.onOrientationChange(this.onOrientationChange.bind(this)),this.addEventListeners(),this.layout&&this.updateLayout(),this.rendered=!0}},{key:"addEventListeners",value:function(){window.addEventListener("unload",function(){this.destroy()}.bind(this)),(this.fullsize?window:this.container).addEventListener("scroll",this.onScroll.bind(this))}},{key:"removeEventListeners",value:function(){(this.fullsize?window:this.container).removeEventListener("scroll",this.onScroll.bind(this))}},{key:"destroy",value:function(){clearTimeout(this.orientationTimeout),clearTimeout(this.resizeTimeout),clearTimeout(this.afterScrolled),this.clear(),this.removeEventListeners(),this.stage.destroy(),this.rendered=!1}},{key:"onOrientationChange",value:function(){var v=window.orientation;this.resize(),clearTimeout(this.orientationTimeout),this.orientationTimeout=setTimeout(function(){this.orientationTimeout=void 0,this.resize(),this.emit(N.EVENTS.MANAGERS.ORIENTATION_CHANGE,v)}.bind(this),500)}},{key:"onResized",value:function(){this.resize()}},{key:"resize",value:function(v,m){var y=this.stage.size(v,m);return this.winBounds=(0,E.windowBounds)(),this.orientationTimeout&&this.winBounds.width===this.winBounds.height?void(this._stageSize=void 0):void(this._stageSize&&this._stageSize.width===y.width&&this._stageSize.height===y.height||(this._stageSize=y,this._bounds=this.bounds(),this.clear(),this.viewSettings.width=this._stageSize.width,this.viewSettings.height=this._stageSize.height,this.updateLayout(),this.emit(N.EVENTS.MANAGERS.RESIZED,{width:this._stageSize.width,height:this._stageSize.height})))}},{key:"createView",value:function(v){return new this.View(v,this.viewSettings)}},{key:"display",value:function(v,m){var y=new E.defer,b=y.promise;(m===v.href||(0,E.isNumber)(m))&&(m=void 0);var w=this.views.find(v);if(w&&v){var k=w.offset();if("ltr"===this.settings.direction)this.scrollTo(k.left,k.top,!0);else{var x=w.width();this.scrollTo(k.left+x,k.top,!0)}if(m){var _=w.locationOf(m);this.moveTo(_)}return y.resolve(),b}return this.clear(),this.add(v).then(function(v){if(m){var y=v.locationOf(m);this.moveTo(y)}}.bind(this),(function(v){y.reject(v)})).then(function(){var m;if("pre-paginated"===this.layout.name&&1<this.layout.divisor&&(m=v.next()))return this.add(m)}.bind(this)).then(function(){this.views.show(),y.resolve()}.bind(this)),b}},{key:"afterDisplayed",value:function(v){this.emit(N.EVENTS.MANAGERS.ADDED,v)}},{key:"afterResized",value:function(v){this.emit(N.EVENTS.MANAGERS.RESIZE,v.section)}},{key:"moveTo",value:function(v){var m=0,y=0;this.isPaginated?(m=x(v.left/this.layout.delta)*this.layout.delta)+this.layout.delta>this.container.scrollWidth&&(m=this.container.scrollWidth-this.layout.delta):y=v.top,this.scrollTo(m,y,!0)}},{key:"add",value:function(v){var m=this,y=this.createView(v);return this.views.append(y),y.onDisplayed=this.afterDisplayed.bind(this),y.onResize=this.afterResized.bind(this),y.on(N.EVENTS.VIEWS.AXIS,(function(v){m.updateAxis(v)})),y.display(this.request)}},{key:"append",value:function(v){var m=this,y=this.createView(v);return this.views.append(y),y.onDisplayed=this.afterDisplayed.bind(this),y.onResize=this.afterResized.bind(this),y.on(N.EVENTS.VIEWS.AXIS,(function(v){m.updateAxis(v)})),y.display(this.request)}},{key:"prepend",value:function(v){var m=this,y=this.createView(v);return y.on(N.EVENTS.VIEWS.RESIZED,(function(v){m.counter(v)})),this.views.prepend(y),y.onDisplayed=this.afterDisplayed.bind(this),y.onResize=this.afterResized.bind(this),y.on(N.EVENTS.VIEWS.AXIS,(function(v){m.updateAxis(v)})),y.display(this.request)}},{key:"counter",value:function(v){"vertical"===this.settings.axis?this.scrollBy(0,v.heightDelta,!0):this.scrollBy(v.widthDelta,0,!0)}},{key:"next",value:function(){var v,m=this.settings.direction;if(this.views.length){if(!this.isPaginated||"horizontal"!==this.settings.axis||m&&"ltr"!==m)if(this.isPaginated&&"horizontal"===this.settings.axis&&"rtl"===m)this.scrollLeft=this.container.scrollLeft,0<this.container.scrollLeft?this.scrollBy(this.layout.delta,0,!0):v=this.views.last().section.next();else if(this.isPaginated&&"vertical"===this.settings.axis){this.scrollTop=this.container.scrollTop,this.container.scrollTop+this.container.offsetHeight<this.container.scrollHeight?this.scrollBy(0,this.layout.height,!0):v=this.views.last().section.next()}else v=this.views.last().section.next();else this.scrollLeft=this.container.scrollLeft,this.container.scrollLeft+this.container.offsetWidth+this.layout.delta<=this.container.scrollWidth?this.scrollBy(this.layout.delta,0,!0):v=this.views.last().section.next();return v?(this.clear(),this.append(v).then(function(){var m;if("pre-paginated"===this.layout.name&&1<this.layout.divisor&&(m=v.next()))return this.append(m)}.bind(this),(function(v){displaying.reject(v)})).then(function(){this.views.show()}.bind(this))):void 0}}},{key:"prev",value:function(){var v,m=this.settings.direction;if(this.views.length){if(!this.isPaginated||"horizontal"!==this.settings.axis||m&&"ltr"!==m)if(this.isPaginated&&"horizontal"===this.settings.axis&&"rtl"===m)this.scrollLeft=this.container.scrollLeft,this.container.scrollLeft+this.container.offsetWidth+this.layout.delta<=this.container.scrollWidth?this.scrollBy(-this.layout.delta,0,!0):v=this.views.first().section.prev();else if(this.isPaginated&&"vertical"===this.settings.axis){this.scrollTop=this.container.scrollTop,0<this.container.scrollTop?this.scrollBy(0,-this.layout.height,!0):v=this.views.first().section.prev()}else v=this.views.first().section.prev();else this.scrollLeft=this.container.scrollLeft,0<this.container.scrollLeft?this.scrollBy(-this.layout.delta,0,!0):v=this.views.first().section.prev();return v?(this.clear(),this.prepend(v).then(function(){var m;if("pre-paginated"===this.layout.name&&1<this.layout.divisor&&(m=v.prev()))return this.prepend(m)}.bind(this),(function(v){displaying.reject(v)})).then(function(){this.isPaginated&&"horizontal"===this.settings.axis&&("rtl"===this.settings.direction?this.scrollTo(0,0,!0):this.scrollTo(this.container.scrollWidth-this.layout.delta,0,!0)),this.views.show()}.bind(this))):void 0}}},{key:"current",value:function(){var v=this.visible();return v.length?v[v.length-1]:null}},{key:"clear",value:function(){this.views&&(this.views.hide(),this.scrollTo(0,0,!0),this.views.clear())}},{key:"currentLocation",value:function(){return this.location="vertical"===this.settings.axis?this.scrolledLocation():this.paginatedLocation(),this.location}},{key:"scrolledLocation",value:function(){var v=this,m=this.visible(),y=this.container.getBoundingClientRect(),w=y.height<window.innerHeight?y.height:window.innerHeight,k=0,x=0;this.fullsize&&(k=window.scrollY);var E=m.map((function(m){var E=m.section,_=E.index,S=E.href,C=m.position(),T=m.height(),N=k+y.top-C.top+x,O=N+w-x;O>T&&(x=(O=T)-N);var R=v.layout.count(T,w).pages,L=b(N/w),P=[],A=b(O/w);P=[];for(var j,I=L;I<=A;I++)j=I+1,P.push(j);return{index:_,href:S,pages:P,totalPages:R,mapping:v.mapping.page(m.contents,m.section.cfiBase,N,O)}}));return E}},{key:"paginatedLocation",value:function(){var v=this,m=this.visible(),y=this.container.getBoundingClientRect(),b=0;this.fullsize&&(b=window.scrollX);var w=m.map((function(m){var w=m.section,k=w.index,E=w.href,_=(m.offset().left,m.position().left),S=m.width(),C=b+y.left-_+0,T=C+v.layout.width-0,N=v.mapping.page(m.contents,m.section.cfiBase,C,T),O=v.layout.count(S).pages,R=x(C/v.layout.pageWidth),L=[],P=x(T/v.layout.pageWidth);if(0>R&&(R=0,++P),"rtl"===v.settings.direction){var A=R;R=O-P,P=O-A}for(var j,I=R+1;I<=P;I++)j=I,L.push(j);return{index:k,href:E,pages:L,totalPages:O,mapping:N}}));return w}},{key:"isVisible",value:function(v,m,y,b){var w=v.position(),k=b||this.bounds();return"horizontal"===this.settings.axis&&w.right>k.left-m&&w.left<k.right+y||"vertical"===this.settings.axis&&w.bottom>k.top-m&&w.top<k.bottom+y}},{key:"visible",value:function(){for(var v,m=this.bounds(),y=this.views.displayed(),b=y.length,w=[],k=0;k<b;k++)v=y[k],!0===this.isVisible(v,0,0,m)&&w.push(v);return w}},{key:"scrollBy",value:function(v,m,y){var b="rtl"===this.settings.direction?-1:1;y&&(this.ignore=!0),this.fullsize?window.scrollBy(v*b,m*b):(v&&(this.container.scrollLeft+=v*b),m&&(this.container.scrollTop+=m)),this.scrolled=!0}},{key:"scrollTo",value:function(v,m,y){y&&(this.ignore=!0),this.fullsize?window.scrollTo(v,m):(this.container.scrollLeft=v,this.container.scrollTop=m),this.scrolled=!0}},{key:"onScroll",value:function(){var v=void 0,m=void 0;this.fullsize?(v=window.scrollY,m=window.scrollX):(v=this.container.scrollTop,m=this.container.scrollLeft),this.scrollTop=v,this.scrollLeft=m,this.ignore?this.ignore=!1:(this.emit(N.EVENTS.MANAGERS.SCROLL,{top:v,left:m}),clearTimeout(this.afterScrolled),this.afterScrolled=setTimeout(function(){this.emit(N.EVENTS.MANAGERS.SCROLLED,{top:this.scrollTop,left:this.scrollLeft})}.bind(this),20))}},{key:"bounds",value:function(){return this.stage.bounds()}},{key:"applyLayout",value:function(v){this.layout=v,this.updateLayout()}},{key:"updateLayout",value:function(){this.stage&&(this._stageSize=this.stage.size(),this.isPaginated?(this.layout.calculate(this._stageSize.width,this._stageSize.height,this.settings.gap),this.settings.offset=this.layout.delta):this.layout.calculate(this._stageSize.width,this._stageSize.height),this.viewSettings.width=this.layout.width,this.viewSettings.height=this.layout.height,this.setLayout(this.layout))}},{key:"setLayout",value:function(v){this.viewSettings.layout=v,this.mapping=new _.default(v.props,this.settings.direction,this.settings.axis),this.views&&this.views.forEach((function(m){m&&m.setLayout(v)}))}},{key:"updateAxis",value:function(v,m){this.isPaginated||(v="vertical"),(m||v!==this.settings.axis)&&(this.settings.axis=v,this.stage&&this.stage.axis(v),this.viewSettings.axis=v,this.mapping&&(this.mapping=new _.default(this.layout.props,this.settings.direction,this.settings.axis)),this.layout&&("vertical"===v?this.layout.spread("none"):this.layout.spread(this.layout.settings.spread)))}},{key:"updateFlow",value:function(v){var m="paginated"===v||"auto"===v;this.isPaginated=m,("scrolled-doc"===v||"scrolled-continuous"===v||"scrolled"===v)&&this.updateAxis("vertical"),this.viewSettings.flow=v,this.overflow=this.settings.overflow?this.settings.overflow:m?"hidden":"auto",this.updateLayout()}},{key:"getContents",value:function(){var v=[];return this.views?(this.views.forEach((function(m){var y=m&&m.contents;y&&v.push(y)})),v):v}},{key:"direction",value:function(){var v=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"ltr";this.settings.direction=v,this.stage&&this.stage.direction(v),this.viewSettings.direction=v,this.updateLayout()}},{key:"isRendered",value:function(){return this.rendered}}]),e}();(0,k.default)(O.prototype),m.default=O,v.exports=m.default},function(v){v.exports=function(v){var m=typeof v;return null!=v&&("object"==m||"function"==m)}},function(m){m.exports=v},function(v){"use strict";var m={application:{ecmascript:["es","ecma"],javascript:"js",ogg:"ogx",pdf:"pdf",postscript:["ps","ai","eps","epsi","epsf","eps2","eps3"],"rdf+xml":"rdf",smil:["smi","smil"],"xhtml+xml":["xhtml","xht"],xml:["xml","xsl","xsd","opf","ncx"],zip:"zip","x-httpd-eruby":"rhtml","x-latex":"latex","x-maker":["frm","maker","frame","fm","fb","book","fbdoc"],"x-object":"o","x-shockwave-flash":["swf","swfl"],"x-silverlight":"scr","epub+zip":"epub","font-tdpfr":"pfr","inkml+xml":["ink","inkml"],json:"json","jsonml+json":"jsonml","mathml+xml":"mathml","metalink+xml":"metalink",mp4:"mp4s","omdoc+xml":"omdoc",oxps:"oxps","vnd.amazon.ebook":"azw",widget:"wgt","x-dtbook+xml":"dtb","x-dtbresource+xml":"res","x-font-bdf":"bdf","x-font-ghostscript":"gsf","x-font-linux-psf":"psf","x-font-otf":"otf","x-font-pcf":"pcf","x-font-snf":"snf","x-font-ttf":["ttf","ttc"],"x-font-type1":["pfa","pfb","pfm","afm"],"x-font-woff":"woff","x-mobipocket-ebook":["prc","mobi"],"x-mspublisher":"pub","x-nzb":"nzb","x-tgif":"obj","xaml+xml":"xaml","xml-dtd":"dtd","xproc+xml":"xpl","xslt+xml":"xslt","internet-property-stream":"acx","x-compress":"z","x-compressed":"tgz","x-gzip":"gz"},audio:{flac:"flac",midi:["mid","midi","kar","rmi"],mpeg:["mpga","mpega","mp2","mp3","m4a","mp2a","m2a","m3a"],mpegurl:"m3u",ogg:["oga","ogg","spx"],"x-aiff":["aif","aiff","aifc"],"x-ms-wma":"wma","x-wav":"wav",adpcm:"adp",mp4:"mp4a",webm:"weba","x-aac":"aac","x-caf":"caf","x-matroska":"mka","x-pn-realaudio-plugin":"rmp",xm:"xm",mid:["mid","rmi"]},image:{gif:"gif",ief:"ief",jpeg:["jpeg","jpg","jpe"],pcx:"pcx",png:"png","svg+xml":["svg","svgz"],tiff:["tiff","tif"],"x-icon":"ico",bmp:"bmp",webp:"webp","x-pict":["pic","pct"],"x-tga":"tga","cis-cod":"cod"},text:{"cache-manifest":["manifest","appcache"],css:"css",csv:"csv",html:["html","htm","shtml","stm"],mathml:"mml",plain:["txt","text","brf","conf","def","list","log","in","bas"],richtext:"rtx","tab-separated-values":"tsv","x-bibtex":"bib"},video:{mpeg:["mpeg","mpg","mpe","m1v","m2v","mp2","mpa","mpv2"],mp4:["mp4","mp4v","mpg4"],quicktime:["qt","mov"],ogg:"ogv","vnd.mpegurl":["mxu","m4u"],"x-flv":"flv","x-la-asf":["lsf","lsx"],"x-mng":"mng","x-ms-asf":["asf","asx","asr"],"x-ms-wm":"wm","x-ms-wmv":"wmv","x-ms-wmx":"wmx","x-ms-wvx":"wvx","x-msvideo":"avi","x-sgi-movie":"movie","x-matroska":["mpv","mkv","mk3d","mks"],"3gpp2":"3g2",h261:"h261",h263:"h263",h264:"h264",jpeg:"jpgv",jpm:["jpm","jpgm"],mj2:["mj2","mjp2"],"vnd.ms-playready.media.pyv":"pyv","vnd.uvvu.mp4":["uvu","uvvu"],"vnd.vivo":"viv",webm:"webm","x-f4v":"f4v","x-m4v":"m4v","x-ms-vob":"vob","x-smv":"smv"}},y=function(){var v,y,b,w,k={};for(v in m)if(m.hasOwnProperty(v))for(y in m[v])if(m[v].hasOwnProperty(y))if("string"==typeof(b=m[v][y]))k[b]=v+"/"+y;else for(w=0;w<b.length;w++)k[b[w]]=v+"/"+y;return k}();v.exports={lookup:function(v){return v&&y[v.split(".").pop().toLowerCase()]||"text/plain"}}},function(v,m,y){"use strict";function a(v){return v&&v.__esModule?v:{default:v}}Object.defineProperty(m,"__esModule",{value:!0});var b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(v){return typeof v}:function(v){return v&&"function"==typeof Symbol&&v.constructor===Symbol&&v!==Symbol.prototype?"symbol":typeof v},w=function(){function e(v,m){for(var y,b=0;b<m.length;b++)(y=m[b]).enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(v,y.key,y)}return function(v,m,y){return m&&e(v.prototype,m),y&&e(v,y),v}}(),k=a(y(2)),x=y(0),E=a(y(10)),_=a(y(1)),S=a(y(12)),C=a(y(50)),T=a(y(51)),N=a(y(13)),O=a(y(52)),R=y(3),L=a(y(20)),P=a(y(14)),A=a(y(24)),j=function(){function e(v,m){(function i(v,m){if(!(v instanceof m))throw new TypeError("Cannot call a class as a function")})(this,e),this.settings=(0,x.extend)(this.settings||{},{width:null,height:null,ignoreClass:"",manager:"default",view:"iframe",flow:null,layout:null,spread:null,minSpreadWidth:800,stylesheet:null,script:null}),(0,x.extend)(this.settings,m),"object"===b(this.settings.manager)&&(this.manager=this.settings.manager),this.book=v,this.hooks={},this.hooks.display=new E.default(this),this.hooks.serialize=new E.default(this),this.hooks.content=new E.default(this),this.hooks.unloaded=new E.default(this),this.hooks.layout=new E.default(this),this.hooks.render=new E.default(this),this.hooks.show=new E.default(this),this.hooks.content.register(this.handleLinks.bind(this)),this.hooks.content.register(this.passEvents.bind(this)),this.hooks.content.register(this.adjustImages.bind(this)),this.book.spine.hooks.content.register(this.injectIdentifier.bind(this)),this.settings.stylesheet&&this.book.spine.hooks.content.register(this.injectStylesheet.bind(this)),this.settings.script&&this.book.spine.hooks.content.register(this.injectScript.bind(this)),this.themes=new T.default(this),this.annotations=new O.default(this),this.epubcfi=new _.default,this.q=new S.default(this),this.location=void 0,this.q.enqueue(this.book.opened),this.starting=new x.defer,this.started=this.starting.promise,this.q.enqueue(this.start)}return w(e,[{key:"setManager",value:function(v){this.manager=v}},{key:"requireManager",value:function(v){return"string"==typeof v&&"default"===v?P.default:"string"==typeof v&&"continuous"===v?A.default:v}},{key:"requireView",value:function(v){return"string"==typeof v&&"iframe"===v?L.default:v}},{key:"start",value:function(){this.manager||(this.ViewManager=this.requireManager(this.settings.manager),this.View=this.requireView(this.settings.view),this.manager=new this.ViewManager({view:this.View,queue:this.q,request:this.book.load.bind(this.book),settings:this.settings})),this.direction(this.book.package.metadata.direction),this.settings.globalLayoutProperties=this.determineLayoutProperties(this.book.package.metadata),this.flow(this.settings.globalLayoutProperties.flow),this.layout(this.settings.globalLayoutProperties),this.manager.on(R.EVENTS.MANAGERS.ADDED,this.afterDisplayed.bind(this)),this.manager.on(R.EVENTS.MANAGERS.REMOVED,this.afterRemoved.bind(this)),this.manager.on(R.EVENTS.MANAGERS.RESIZED,this.onResized.bind(this)),this.manager.on(R.EVENTS.MANAGERS.ORIENTATION_CHANGE,this.onOrientationChange.bind(this)),this.manager.on(R.EVENTS.MANAGERS.SCROLLED,this.reportLocation.bind(this)),this.emit(R.EVENTS.RENDITION.STARTED),this.starting.resolve()}},{key:"attachTo",value:function(v){return this.q.enqueue(function(){this.manager.render(v,{width:this.settings.width,height:this.settings.height}),this.emit(R.EVENTS.RENDITION.ATTACHED)}.bind(this))}},{key:"display",value:function(v){return this.displaying&&this.displaying.resolve(),this.q.enqueue(this._display,v)}},{key:"_display",value:function(v){var m=this;if(this.book){this.epubcfi.isCfiString(v);var y,b=new x.defer,w=b.promise;return this.displaying=b,this.book.locations.length()&&((0,x.isFloat)(v)||"1.0"===v)&&(v=this.book.locations.cfiFromPercentage(parseFloat(v))),(y=this.book.spine.get(v))?(this.manager.display(y,v).then((function(){b.resolve(y),m.displaying=void 0,m.emit(R.EVENTS.RENDITION.DISPLAYED,y),m.reportLocation()}),(function(v){m.emit(R.EVENTS.RENDITION.DISPLAY_ERROR,v)})),w):(b.reject(new Error("No Section Found")),w)}}},{key:"afterDisplayed",value:function(v){var m=this;v.on(R.EVENTS.VIEWS.MARK_CLICKED,(function(y,b){return m.triggerMarkEvent(y,b,v)})),this.hooks.render.trigger(v,this).then((function(){v.contents?m.hooks.content.trigger(v.contents,m).then((function(){m.emit(R.EVENTS.RENDITION.RENDERED,v.section,v)})):m.emit(R.EVENTS.RENDITION.RENDERED,v.section,v)}))}},{key:"afterRemoved",value:function(v){var m=this;this.hooks.unloaded.trigger(v,this).then((function(){m.emit(R.EVENTS.RENDITION.REMOVED,v.section,v)}))}},{key:"onResized",value:function(v){this.emit(R.EVENTS.RENDITION.RESIZED,{width:v.width,height:v.height}),this.location&&this.location.start&&this.display(this.location.start.cfi)}},{key:"onOrientationChange",value:function(v){this.emit(R.EVENTS.RENDITION.ORIENTATION_CHANGE,v)}},{key:"moveTo",value:function(v){this.manager.moveTo(v)}},{key:"resize",value:function(v,m){v&&(this.settings.width=v),m&&(this.settings.height=m),this.manager.resize(v,m)}},{key:"clear",value:function(){this.manager.clear()}},{key:"next",value:function(){return this.q.enqueue(this.manager.next.bind(this.manager)).then(this.reportLocation.bind(this))}},{key:"prev",value:function(){return this.q.enqueue(this.manager.prev.bind(this.manager)).then(this.reportLocation.bind(this))}},{key:"determineLayoutProperties",value:function(v){var m=this.settings.layout||v.layout||"reflowable",y=this.settings.spread||v.spread||"auto",b=this.settings.orientation||v.orientation||"auto",w=this.settings.flow||v.flow||"auto",k=v.viewport||"",x=this.settings.minSpreadWidth||v.minSpreadWidth||800,E=this.settings.direction||v.direction||"ltr";return(0===this.settings.width||0<this.settings.width)&&(0===this.settings.height||this.settings.height),{layout:m,spread:y,orientation:b,flow:w,viewport:k,minSpreadWidth:x,direction:E}}},{key:"flow",value:function(v){var m=v;("scrolled"===v||"scrolled-doc"===v||"scrolled-continuous"===v)&&(m="scrolled"),("auto"===v||"paginated"===v)&&(m="paginated"),this.settings.flow=v,this._layout&&this._layout.flow(m),this.manager&&this._layout&&this.manager.applyLayout(this._layout),this.manager&&this.manager.updateFlow(m),this.manager&&this.manager.isRendered()&&this.location&&(this.manager.clear(),this.display(this.location.start.cfi))}},{key:"layout",value:function(v){var m=this;return v&&(this._layout=new C.default(v),this._layout.spread(v.spread,this.settings.minSpreadWidth),this._layout.on(R.EVENTS.LAYOUT.UPDATED,(function(v,y){m.emit(R.EVENTS.RENDITION.LAYOUT,v,y)}))),this.manager&&this._layout&&this.manager.applyLayout(this._layout),this._layout}},{key:"spread",value:function(v,m){this._layout.spread(v,m),this.manager.isRendered()&&this.manager.updateLayout()}},{key:"direction",value:function(v){this.settings.direction=v||"ltr",this.manager&&this.manager.direction(this.settings.direction),this.manager&&this.manager.isRendered()&&this.location&&(this.manager.clear(),this.display(this.location.start.cfi))}},{key:"reportLocation",value:function(){return this.q.enqueue(function(){requestAnimationFrame(function(){var v=this.manager.currentLocation();if(v&&v.then&&"function"==typeof v.then)v.then(function(v){var m=this.located(v);m&&m.start&&m.end&&(this.location=m,this.emit(R.EVENTS.RENDITION.LOCATION_CHANGED,{index:this.location.start.index,href:this.location.start.href,start:this.location.start.cfi,end:this.location.end.cfi,percentage:this.location.start.percentage}),this.emit(R.EVENTS.RENDITION.RELOCATED,this.location))}.bind(this));else if(v){var m=this.located(v);if(!m||!m.start||!m.end)return;this.location=m,this.emit(R.EVENTS.RENDITION.LOCATION_CHANGED,{index:this.location.start.index,href:this.location.start.href,start:this.location.start.cfi,end:this.location.end.cfi,percentage:this.location.start.percentage}),this.emit(R.EVENTS.RENDITION.RELOCATED,this.location)}}.bind(this))}.bind(this))}},{key:"currentLocation",value:function(){var v=this.manager.currentLocation();if(v&&v.then&&"function"==typeof v.then)v.then(function(v){return this.located(v)}.bind(this));else if(v){return this.located(v)}}},{key:"located",value:function(v){if(!v.length)return{};var m=v[0],y=v[v.length-1],b={start:{index:m.index,href:m.href,cfi:m.mapping.start,displayed:{page:m.pages[0]||1,total:m.totalPages}},end:{index:y.index,href:y.href,cfi:y.mapping.end,displayed:{page:y.pages[y.pages.length-1]||1,total:y.totalPages}}},w=this.book.locations.locationFromCfi(m.mapping.start),k=this.book.locations.locationFromCfi(y.mapping.end);null!=w&&(b.start.location=w,b.start.percentage=this.book.locations.percentageFromLocation(w)),null!=k&&(b.end.location=k,b.end.percentage=this.book.locations.percentageFromLocation(k));var x=this.book.pageList.pageFromCfi(m.mapping.start),E=this.book.pageList.pageFromCfi(y.mapping.end);return-1!=x&&(b.start.page=x),-1!=E&&(b.end.page=E),y.index===this.book.spine.last().index&&b.end.displayed.page>=b.end.displayed.total&&(b.atEnd=!0),m.index===this.book.spine.first().index&&1===b.start.displayed.page&&(b.atStart=!0),b}},{key:"destroy",value:function(){this.manager&&this.manager.destroy(),this.book=void 0}},{key:"passEvents",value:function(v){var m=this;N.default.listenedEvents.forEach((function(y){v.on(y,(function(y){return m.triggerViewEvent(y,v)}))})),v.on(R.EVENTS.CONTENTS.SELECTED,(function(y){return m.triggerSelectedEvent(y,v)}))}},{key:"triggerViewEvent",value:function(v,m){this.emit(v.type,v,m)}},{key:"triggerSelectedEvent",value:function(v,m){this.emit(R.EVENTS.RENDITION.SELECTED,v,m)}},{key:"triggerMarkEvent",value:function(v,m,y){this.emit(R.EVENTS.RENDITION.MARK_CLICKED,v,m,y)}},{key:"getRange",value:function(v,m){var y=new _.default(v),b=this.manager.visible().filter((function(v){if(y.spinePos===v.index)return!0}));if(b.length)return b[0].contents.range(y,m)}},{key:"adjustImages",value:function(v){return"pre-paginated"===this._layout.name?new Promise((function(v){v()})):(v.addStylesheetRules({img:{"max-width":(this._layout.columnWidth?this._layout.columnWidth+"px":"100%")+"!important","max-height":(this._layout.height?.6*this._layout.height+"px":"60%")+"!important","object-fit":"contain","page-break-inside":"avoid"},svg:{"max-width":(this._layout.columnWidth?this._layout.columnWidth+"px":"100%")+"!important","max-height":(this._layout.height?.6*this._layout.height+"px":"60%")+"!important","page-break-inside":"avoid"}}),new Promise((function(v){setTimeout((function(){v()}),1)})))}},{key:"getContents",value:function(){return this.manager?this.manager.getContents():[]}},{key:"views",value:function(){return(this.manager?this.manager.views:void 0)||[]}},{key:"handleLinks",value:function(v){var m=this;v&&v.on(R.EVENTS.CONTENTS.LINK_CLICKED,(function(v){var y=m.book.path.relative(v);m.display(y)}))}},{key:"injectStylesheet",value:function(v){var m=v.createElement("link");m.setAttribute("type","text/css"),m.setAttribute("rel","stylesheet"),m.setAttribute("href",this.settings.stylesheet),v.getElementsByTagName("head")[0].appendChild(m)}},{key:"injectScript",value:function(v){var m=v.createElement("script");m.setAttribute("type","text/javascript"),m.setAttribute("src",this.settings.script),m.textContent=" ",v.getElementsByTagName("head")[0].appendChild(m)}},{key:"injectIdentifier",value:function(v){var m=this.book.package.metadata.identifier,y=v.createElement("meta");y.setAttribute("name","dc.relation.ispartof"),m&&y.setAttribute("content",m),v.getElementsByTagName("head")[0].appendChild(y)}}]),e}();(0,k.default)(j.prototype),m.default=j,v.exports=m.default},function(v,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var k=function(){function e(v,m){for(var y,b=0;b<m.length;b++)(y=m[b]).enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(v,y.key,y)}return function(v,m,y){return m&&e(v.prototype,m),y&&e(v,y),v}}(),x=function(v){return v&&v.__esModule?v:{default:v}}(y(1)),E=function(){function e(v,m,y,b){(function o(v,m){if(!(v instanceof m))throw new TypeError("Cannot call a class as a function")})(this,e),this.layout=v,this.horizontal="horizontal"===y,this.direction=m||"ltr",this._dev=b}return k(e,[{key:"section",value:function(v){var m=this.findRanges(v);return this.rangeListToCfiList(v.section.cfiBase,m)}},{key:"page",value:function(v,m,y,b){var w,k=v&&v.document&&v.document.body;if(k){if(w=this.rangePairToCfiPair(m,{start:this.findStart(k,y,b),end:this.findEnd(k,y,b)}),!0===this._dev){var E=v.document,_=new x.default(w.start).toRange(E),S=new x.default(w.end).toRange(E),C=E.defaultView.getSelection(),T=E.createRange();C.removeAllRanges(),T.setStart(_.startContainer,_.startOffset),T.setEnd(S.endContainer,S.endOffset),C.addRange(T)}return w}}},{key:"walk",value:function(v,m){if(!v||v.nodeType!==Node.TEXT_NODE){var y={acceptNode:function(v){return 0<v.data.trim().length?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}},b=y.acceptNode;b.acceptNode=y.acceptNode;for(var w,k,x=document.createTreeWalker(v,NodeFilter.SHOW_TEXT,b,!1);(w=x.nextNode())&&!(k=m(w)););return k}}},{key:"findRanges",value:function(v){for(var m,y,w=[],k=v.contents.scrollWidth(),x=b(k/this.layout.spreadWidth)*this.layout.divisor,E=this.layout.columnWidth,_=this.layout.gap,S=0;S<x.pages;S++)m=(E+_)*S,y=E*(S+1)+_*S,w.push({start:this.findStart(v.document.body,m,y),end:this.findEnd(v.document.body,m,y)});return w}},{key:"findStart",value:function(v,m,y){for(var b,w,k=this,x=[v],E=v;x.length;)if(b=x.shift(),w=this.walk(b,(function(v){var b,w,_,S,C;if(C=k.getBounds(v),k.horizontal&&"ltr"===k.direction){if(b=k.horizontal?C.left:C.top,w=k.horizontal?C.right:C.bottom,b>=m&&b<=y)return v;if(w>m)return v;E=v,x.push(v)}else if(k.horizontal&&"rtl"===k.direction){if(b=C.left,(w=C.right)<=y&&w>=m)return v;if(b<y)return v;E=v,x.push(v)}else{if(_=C.top,S=C.bottom,_>=m&&_<=y)return v;if(S>m)return v;E=v,x.push(v)}})),w)return this.findTextStartRange(w,m,y);return this.findTextStartRange(E,m,y)}},{key:"findEnd",value:function(v,m,y){for(var b,k,x=this,E=[v],_=v;E.length;)if(b=E.shift(),k=this.walk(b,(function(v){var b,k,S,C,T;if(T=x.getBounds(v),x.horizontal&&"ltr"===x.direction){if(b=w(T.left),k=w(T.right),b>y&&_)return _;if(k>y)return v;_=v,E.push(v)}else if(x.horizontal&&"rtl"===x.direction){if(b=w(x.horizontal?T.left:T.top),(k=w(x.horizontal?T.right:T.bottom))<m&&_)return _;if(b<m)return v;_=v,E.push(v)}else{if(S=w(T.top),C=w(T.bottom),S>y&&_)return _;if(C>y)return v;_=v,E.push(v)}})),k)return this.findTextEndRange(k,m,y);return this.findTextEndRange(_,m,y)}},{key:"findTextStartRange",value:function(v,m,y){for(var b,w,k=this.splitTextNodeIntoRanges(v),x=0;x<k.length;x++)if(w=(b=k[x]).getBoundingClientRect(),this.horizontal&&"ltr"===this.direction){if(w.left>=m)return b}else if(this.horizontal&&"rtl"===this.direction){if(w.right<=y)return b}else if(w.top>=m)return b;return k[0]}},{key:"findTextEndRange",value:function(v,m,y){for(var b,w,k,x,E,_,S,C=this.splitTextNodeIntoRanges(v),T=0;T<C.length;T++){if(k=(w=C[T]).getBoundingClientRect(),this.horizontal&&"ltr"===this.direction){if(x=k.left,E=k.right,x>y&&b)return b;if(E>y)return w}else if(this.horizontal&&"rtl"===this.direction){if(x=k.left,(E=k.right)<m&&b)return b;if(x<m)return w}else{if(_=k.top,S=k.bottom,_>y&&b)return b;if(S>y)return w}b=w}return C[C.length-1]}},{key:"splitTextNodeIntoRanges",value:function(v,m){var y,b=[],w=(v.textContent||"").trim(),k=v.ownerDocument,x=m||" ",E=w.indexOf(x);if(-1===E||v.nodeType!=Node.TEXT_NODE)return(y=k.createRange()).selectNodeContents(v),[y];for((y=k.createRange()).setStart(v,0),y.setEnd(v,E),b.push(y),y=!1;-1!=E;)0<(E=w.indexOf(x,E+1))&&(y&&(y.setEnd(v,E),b.push(y)),(y=k.createRange()).setStart(v,E+1));return y&&(y.setEnd(v,w.length),b.push(y)),b}},{key:"rangePairToCfiPair",value:function(v,m){var y=m.start,b=m.end;return y.collapse(!0),b.collapse(!1),{start:new x.default(y,v).toString(),end:new x.default(b,v).toString()}}},{key:"rangeListToCfiList",value:function(v,m){for(var y,b=[],w=0;w<m.length;w++)y=this.rangePairToCfiPair(v,m[w]),b.push(y);return b}},{key:"getBounds",value:function(v){var m;if(v.nodeType==Node.TEXT_NODE){var y=document.createRange();y.selectNodeContents(v),m=y.getBoundingClientRect()}else m=v.getBoundingClientRect();return m}},{key:"axis",value:function(v){return v&&(this.horizontal="horizontal"===v),this.horizontal}}]),e}();m.default=E,v.exports=m.default},function(v,m,y){"use strict";function i(v){return v&&v.__esModule?v:{default:v}}Object.defineProperty(m,"__esModule",{value:!0});var w=function(){function e(v,m){for(var y,b=0;b<m.length;b++)(y=m[b]).enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(v,y.key,y)}return function(v,m,y){return m&&e(v.prototype,m),y&&e(v,y),v}}(),k=i(y(2)),x=y(0),E=i(y(1)),_=i(y(13)),S=y(3),C=y(53),T=function(){function e(v,m){(function o(v,m){if(!(v instanceof m))throw new TypeError("Cannot call a class as a function")})(this,e),this.settings=(0,x.extend)({ignoreClass:"",axis:m.layout&&"scrolled"===m.layout.props.flow?"vertical":"horizontal",direction:void 0,width:0,height:0,layout:void 0,globalLayoutProperties:{},method:void 0},m||{}),this.id="epubjs-view-"+(0,x.uuid)(),this.section=v,this.index=v.index,this.element=this.container(this.settings.axis),this.added=!1,this.displayed=!1,this.rendered=!1,this.fixedWidth=0,this.fixedHeight=0,this.epubcfi=new E.default,this.layout=this.settings.layout,this.pane=void 0,this.highlights={},this.underlines={},this.marks={}}return w(e,[{key:"container",value:function(v){var m=document.createElement("div");return m.classList.add("epub-view"),m.style.height="0px",m.style.width="0px",m.style.overflow="hidden",m.style.position="relative",m.style.display="block",m.style.flex=v&&"horizontal"==v?"none":"initial",m}},{key:"create",value:function(){return this.iframe||(this.element||(this.element=this.createContainer()),this.iframe=document.createElement("iframe"),this.iframe.id=this.id,this.iframe.scrolling="no",this.iframe.style.overflow="hidden",this.iframe.seamless="seamless",this.iframe.style.border="none",this.iframe.setAttribute("enable-annotation","true"),this.resizing=!0,this.element.style.visibility="hidden",this.iframe.style.visibility="hidden",this.iframe.style.width="0",this.iframe.style.height="0",this._width=0,this._height=0,this.element.setAttribute("ref",this.index),this.element.appendChild(this.iframe),this.added=!0,this.elementBounds=(0,x.bounds)(this.element),this.supportsSrcdoc=!!("srcdoc"in this.iframe),this.settings.method||(this.settings.method=this.supportsSrcdoc?"srcdoc":"write")),this.iframe}},{key:"render",value:function(v){return this.create(),this.size(),this.sectionRender||(this.sectionRender=this.section.render(v)),this.sectionRender.then(function(v){return this.load(v)}.bind(this)).then(function(){var v=this;this.layout.format(this.contents);var m=0===this.contents.writingMode().indexOf("vertical")?"vertical":"horizontal";return this.setAxis(m),this.emit(S.EVENTS.VIEWS.AXIS,m),this.addListeners(),new Promise((function(m){v.expand(),m()}))}.bind(this),function(v){return this.emit(S.EVENTS.VIEWS.LOAD_ERROR,v),new Promise((function(m,y){y(v)}))}.bind(this)).then(function(){this.emit(S.EVENTS.VIEWS.RENDERED,this.section)}.bind(this))}},{key:"reset",value:function(){this.iframe&&(this.iframe.style.width="0",this.iframe.style.height="0",this._width=0,this._height=0,this._textWidth=void 0,this._contentWidth=void 0,this._textHeight=void 0,this._contentHeight=void 0),this._needsReframe=!0}},{key:"size",value:function(v,m){var y=v||this.settings.width,b=m||this.settings.height;"pre-paginated"===this.layout.name?this.lock("both",y,b):"horizontal"===this.settings.axis?this.lock("height",y,b):this.lock("width",y,b),this.settings.width=y,this.settings.height=b}},{key:"lock",value:function(v,m,y){var b,w=(0,x.borders)(this.element);b=this.iframe?(0,x.borders)(this.iframe):{width:0,height:0},"width"==v&&(0,x.isNumber)(m)&&(this.lockedWidth=m-w.width-b.width),"height"==v&&(0,x.isNumber)(y)&&(this.lockedHeight=y-w.height-b.height),"both"===v&&(0,x.isNumber)(m)&&(0,x.isNumber)(y)&&(this.lockedWidth=m-w.width-b.width,this.lockedHeight=y-w.height-b.height),this.displayed&&this.iframe&&this.expand()}},{key:"expand",value:function(){var v,m=this.lockedWidth,y=this.lockedHeight;!this.iframe||this._expanding||(this._expanding=!0,"pre-paginated"===this.layout.name?(m=this.layout.columnWidth,y=this.layout.height):"horizontal"===this.settings.axis?(0<(m=this.contents.textWidth())%this.layout.pageWidth&&(m=b(m/this.layout.pageWidth)*this.layout.pageWidth),this.settings.forceEvenPages&&(v=m/this.layout.delta,1<this.layout.divisor&&"reflowable"===this.layout.name&&0<v%2&&(m+=this.layout.gap+this.layout.columnWidth))):"vertical"===this.settings.axis&&(y=this.contents.textHeight()),(this._needsReframe||m!=this._width||y!=this._height)&&this.reframe(m,y),this._expanding=!1)}},{key:"reframe",value:function(v,m){var y;(0,x.isNumber)(v)&&(this.element.style.width=v+"px",this.iframe.style.width=v+"px",this._width=v),(0,x.isNumber)(m)&&(this.element.style.height=m+"px",this.iframe.style.height=m+"px",this._height=m),y={width:v,height:m,widthDelta:this.prevBounds?v-this.prevBounds.width:v,heightDelta:this.prevBounds?m-this.prevBounds.height:m},this.pane&&this.pane.render(),this.onResize(this,y),this.emit(S.EVENTS.VIEWS.RESIZED,y),this.prevBounds=y,this.elementBounds=(0,x.bounds)(this.element)}},{key:"load",value:function(v){var m=new x.defer,y=m.promise;if(!this.iframe)return m.reject(new Error("No Iframe Available")),y;if(this.iframe.onload=function(v){this.onLoad(v,m)}.bind(this),"blobUrl"===this.settings.method)this.blobUrl=(0,x.createBlobUrl)(v,"application/xhtml+xml"),this.iframe.src=this.blobUrl;else if("srcdoc"===this.settings.method)this.iframe.srcdoc=v;else{if(this.document=this.iframe.contentDocument,!this.document)return m.reject(new Error("No Document Available")),y;this.iframe.contentDocument.open(),this.iframe.contentDocument.write(v),this.iframe.contentDocument.close()}return y}},{key:"onLoad",value:function(v,m){var y=this;this.window=this.iframe.contentWindow,this.document=this.iframe.contentDocument,this.contents=new _.default(this.document,this.document.body,this.section.cfiBase,this.section.index),this.rendering=!1;var b=this.document.querySelector("link[rel='canonical']");b?b.setAttribute("href",this.section.canonical):((b=this.document.createElement("link")).setAttribute("rel","canonical"),b.setAttribute("href",this.section.canonical),this.document.querySelector("head").appendChild(b)),this.contents.on(S.EVENTS.CONTENTS.EXPAND,(function(){y.displayed&&y.iframe&&(y.expand(),y.contents&&y.layout.format(y.contents))})),this.contents.on(S.EVENTS.CONTENTS.RESIZE,(function(){y.displayed&&y.iframe&&(y.expand(),y.contents&&y.layout.format(y.contents))})),m.resolve(this.contents)}},{key:"setLayout",value:function(v){this.layout=v,this.contents&&(this.layout.format(this.contents),this.expand())}},{key:"setAxis",value:function(v){"scrolled"===this.layout.props.flow&&(v="vertical"),this.settings.axis=v,this.element.style.flex="horizontal"==v?"none":"initial",this.size()}},{key:"addListeners",value:function(){}},{key:"removeListeners",value:function(){}},{key:"display",value:function(v){var m=new x.defer;return this.displayed?m.resolve(this):this.render(v).then(function(){this.emit(S.EVENTS.VIEWS.DISPLAYED,this),this.onDisplayed(this),this.displayed=!0,m.resolve(this)}.bind(this),(function(v){m.reject(v,this)})),m.promise}},{key:"show",value:function(){this.element.style.visibility="visible",this.iframe&&(this.iframe.style.visibility="visible"),this.emit(S.EVENTS.VIEWS.SHOWN,this)}},{key:"hide",value:function(){this.element.style.visibility="hidden",this.iframe.style.visibility="hidden",this.stopExpanding=!0,this.emit(S.EVENTS.VIEWS.HIDDEN,this)}},{key:"offset",value:function(){return{top:this.element.offsetTop,left:this.element.offsetLeft}}},{key:"width",value:function(){return this._width}},{key:"height",value:function(){return this._height}},{key:"position",value:function(){return this.element.getBoundingClientRect()}},{key:"locationOf",value:function(v){this.iframe.getBoundingClientRect();var m=this.contents.locationOf(v,this.settings.ignoreClass);return{left:m.left,top:m.top}}},{key:"onDisplayed",value:function(){}},{key:"onResize",value:function(){}},{key:"bounds",value:function(v){return(v||!this.elementBounds)&&(this.elementBounds=(0,x.bounds)(this.element)),this.elementBounds}},{key:"highlight",value:function(v){var m=this,y=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},b=arguments[2];if(this.contents){var w=this.contents.range(v),o=function(){m.emit(S.EVENTS.VIEWS.MARK_CLICKED,v,y)};y.epubcfi=v,this.pane||(this.pane=new C.Pane(this.iframe,this.element));var k=new C.Highlight(w,"epubjs-hl",y,{fill:"yellow","fill-opacity":"0.3","mix-blend-mode":"multiply"}),x=this.pane.addMark(k);return this.highlights[v]={mark:x,element:x.element,listeners:[o,b]},x.element.setAttribute("ref","epubjs-hl"),x.element.addEventListener("click",o),x.element.addEventListener("touchstart",o),b&&(x.element.addEventListener("click",b),x.element.addEventListener("touchstart",b)),x}}},{key:"underline",value:function(v){var m=this,y=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},b=arguments[2];if(this.contents){var w=this.contents.range(v),o=function(){m.emit(S.EVENTS.VIEWS.MARK_CLICKED,v,y)};y.epubcfi=v,this.pane||(this.pane=new C.Pane(this.iframe,this.element));var k=new C.Underline(w,"epubjs-ul",y,{stroke:"black","stroke-opacity":"0.3","mix-blend-mode":"multiply"}),x=this.pane.addMark(k);return this.underlines[v]={mark:x,element:x.element,listeners:[o,b]},x.element.setAttribute("ref","epubjs-ul"),x.element.addEventListener("click",o),x.element.addEventListener("touchstart",o),b&&(x.element.addEventListener("click",b),x.element.addEventListener("touchstart",b)),x}}},{key:"mark",value:function(v){var m=this,y=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},b=arguments[2];if(this.contents){if(v in this.marks)return this.marks[v];var w=this.contents.range(v);if(w){var k,x,E,_=w.commonAncestorContainer,C=1===_.nodeType?_:_.parentNode,d=function(){m.emit(S.EVENTS.VIEWS.MARK_CLICKED,v,y)};if(w.collapsed&&1===_.nodeType?(w=new Range).selectNodeContents(_):w.collapsed&&(w=new Range).selectNodeContents(C),"pre-paginated"===this.layout.name||"horizontal"!==this.settings.axis){var T=w.getBoundingClientRect();k=T.top,x=T.right}else for(var N=w.getClientRects(),O=void 0,R=0;R!=N.length;R++)O=N[R],(!E||O.left<E)&&(x=(E=O.left)+this.layout.columnWidth-this.layout.gap,k=O.top);var L=this.document.createElement("a");return L.setAttribute("ref","epubjs-mk"),L.style.position="absolute",L.style.top=k+"px",L.style.left=x+"px",L.dataset.epubcfi=v,y&&Object.keys(y).forEach((function(v){L.dataset[v]=y[v]})),b&&(L.addEventListener("click",b),L.addEventListener("touchstart",b)),L.addEventListener("click",d),L.addEventListener("touchstart",d),this.element.appendChild(L),this.marks[v]={element:L,listeners:[d,b]},C}}}},{key:"unhighlight",value:function(v){var m;v in this.highlights&&(m=this.highlights[v],this.pane.removeMark(m.mark),m.listeners.forEach((function(v){v&&m.element.removeEventListener("click",v)})),delete this.highlights[v])}},{key:"ununderline",value:function(v){var m;v in this.underlines&&(m=this.underlines[v],this.pane.removeMark(m.mark),m.listeners.forEach((function(v){v&&m.element.removeEventListener("click",v)})),delete this.underlines[v])}},{key:"unmark",value:function(v){var m;v in this.marks&&(m=this.marks[v],this.element.removeChild(m.element),m.listeners.forEach((function(v){v&&m.element.removeEventListener("click",v)})),delete this.marks[v])}},{key:"destroy",value:function(){for(var v in this.highlights)this.unhighlight(v);for(var m in this.underlines)this.ununderline(m);for(var y in this.marks)this.unmark(y);this.blobUrl&&(0,x.revokeBlobUrl)(this.blobUrl),this.displayed&&(this.displayed=!1,this.removeListeners(),this.stopExpanding=!0,this.element.removeChild(this.iframe),this.iframe=void 0,this.contents=void 0,this._textWidth=null,this._textHeight=null,this._width=null,this._height=null)}}]),e}();(0,k.default)(T.prototype),m.default=T,v.exports=m.default},function(v,m,y){var b=y(15),w=y(58),x=y(60),E=Math.min;v.exports=function(v,m,y){function l(m){var y=_,b=S;return _=S=void 0,R=m,T=v.apply(b,y)}function c(v){var y=v-O;return null==O||y>=m||0>y||P&&v-R>=C}function p(){var v=w();return c(v)?h(v):void(N=setTimeout(p,function u(v){var y=m-(v-O);return P?E(y,C-(v-R)):y}(v)))}function h(v){return N=void 0,A&&_?l(v):(_=S=void 0,T)}function g(){var v=w(),y=c(v);if(_=arguments,S=this,O=v,y){if(void 0===N)return function d(v){return R=v,N=setTimeout(p,m),L?l(v):T}(O);if(P)return N=setTimeout(p,m),l(O)}return void 0===N&&(N=setTimeout(p,m)),T}var _,S,C,T,N,O,R=0,L=!1,P=!1,A=!0;if("function"!=typeof v)throw new TypeError("Expected a function");return m=x(m)||0,b(y)&&(L=!!y.leading,C=(P="maxWait"in y)?k(x(y.maxWait)||0,m):C,A="trailing"in y?!!y.trailing:A),g.cancel=function(){void 0!==N&&clearTimeout(N),R=0,_=O=S=N=void 0},g.flush=function(){return void 0===N?T:h(w())},g}},function(v,m,y){var b=y(59),w="object"==typeof self&&self&&self.Object===Object&&self,k=b||w||Function("return this")();v.exports=k},function(v,m,y){var b=y(22).Symbol;v.exports=b},function(v,m,y){"use strict";function a(v){return v&&v.__esModule?v:{default:v}}Object.defineProperty(m,"__esModule",{value:!0});var b=function(){function e(v,m){for(var y,b=0;b<m.length;b++)(y=m[b]).enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(v,y.key,y)}return function(v,m,y){return m&&e(v.prototype,m),y&&e(v,y),v}}(),w=y(0),k=a(y(14)),E=y(3),_=a(y(21)),S=function(v){function t(v){!function i(v,m){if(!(v instanceof m))throw new TypeError("Cannot call a class as a function")}(this,t);var m=function o(v,m){if(!v)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!m||"object"!=typeof m&&"function"!=typeof m?v:m}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,v));return m.name="continuous",m.settings=(0,w.extend)(m.settings||{},{infinite:!0,overflow:void 0,axis:void 0,flow:"scrolled",offset:500,offsetDelta:250,width:void 0,height:void 0}),(0,w.extend)(m.settings,v.settings||{}),"undefined"!=v.settings.gap&&0===v.settings.gap&&(m.settings.gap=v.settings.gap),m.viewSettings={ignoreClass:m.settings.ignoreClass,axis:m.settings.axis,flow:m.settings.flow,layout:m.layout,width:0,height:0,forceEvenPages:!1},m.scrollTop=0,m.scrollLeft=0,m}return function r(v,m){if("function"!=typeof m&&null!==m)throw new TypeError("Super expression must either be null or a function, not "+typeof m);v.prototype=Object.create(m&&m.prototype,{constructor:{value:v,enumerable:!1,writable:!0,configurable:!0}}),m&&(Object.setPrototypeOf?Object.setPrototypeOf(v,m):v.__proto__=m)}(t,v),b(t,[{key:"display",value:function(v,m){return k.default.prototype.display.call(this,v,m).then(function(){return this.fill()}.bind(this))}},{key:"fill",value:function(v){var m=this,y=v||new w.defer;return this.q.enqueue((function(){return m.check()})).then((function(v){v?m.fill(y):y.resolve()})),y.promise}},{key:"moveTo",value:function(v){var m=0,y=0;this.isPaginated?(m=x(v.left/this.layout.delta)*this.layout.delta,this.settings.offset):(y=v.top,v.top,this.settings.offset),(0<m||0<y)&&this.scrollBy(m,y,!0)}},{key:"afterResized",value:function(v){this.emit(E.EVENTS.MANAGERS.RESIZE,v.section)}},{key:"removeShownListeners",value:function(v){v.onDisplayed=function(){}}},{key:"add",value:function(v){var m=this,y=this.createView(v);return this.views.append(y),y.on(E.EVENTS.VIEWS.RESIZED,(function(){y.expanded=!0})),y.on(E.EVENTS.VIEWS.AXIS,(function(v){m.updateAxis(v)})),y.onDisplayed=this.afterDisplayed.bind(this),y.onResize=this.afterResized.bind(this),y.display(this.request)}},{key:"append",value:function(v){var m=this.createView(v);return m.on(E.EVENTS.VIEWS.RESIZED,(function(){m.expanded=!0})),this.views.append(m),m.onDisplayed=this.afterDisplayed.bind(this),m}},{key:"prepend",value:function(v){var m=this,y=this.createView(v);return y.on(E.EVENTS.VIEWS.RESIZED,(function(v){m.counter(v),y.expanded=!0})),this.views.prepend(y),y.onDisplayed=this.afterDisplayed.bind(this),y}},{key:"counter",value:function(v){"vertical"===this.settings.axis?this.scrollBy(0,v.heightDelta,!0):this.scrollBy(v.widthDelta,0,!0)}},{key:"update",value:function(v){for(var m,y=this.bounds(),b=this.views.all(),k=b.length,x=[],E=void 0===v?this.settings.offset||0:v,_=new w.defer,S=[],C=0;C<k;C++)if(m=b[C],!0===this.isVisible(m,E,E,y)){if(m.displayed)m.show();else{var T=m.display(this.request).then((function(v){v.show()}),(function(){m.hide()}));S.push(T)}x.push(m)}else this.q.enqueue(m.destroy.bind(m)),clearTimeout(this.trimTimeout),this.trimTimeout=setTimeout(function(){this.q.enqueue(this.trim.bind(this))}.bind(this),250);return S.length?Promise.all(S).catch((function(v){_.reject(v)})):(_.resolve(),_.promise)}},{key:"check",value:function(v,m){var y=this,b=new w.defer,k=[],x="horizontal"===this.settings.axis,E=this.settings.offset||0;v&&x&&(E=v),m&&!x&&(E=m);var _=this._bounds,S="rtl"===this.settings.direction,C=x&&S?-1:1,T=x?this.scrollLeft:this.scrollTop*C,N=x?_.width:_.height,O=x?this.container.scrollWidth:this.container.scrollHeight,g=function(){var v=y.views.first(),m=v&&v.section.prev();m&&k.push(y.prepend(m))},f=function(){var v=y.views.last(),m=v&&v.section.next();m&&k.push(y.append(m))};T+N+E>=O&&(x&&S?g():f()),0>T-E&&(x&&S?f():g());var R=k.map((function(v){return v.displayed}));return k.length?Promise.all(R).then((function(){if("pre-paginated"===y.layout.name&&y.layout.props.spread)return y.check()})).then((function(){return y.update(E)}),(function(v){return v})):(this.q.enqueue(function(){this.update()}.bind(this)),b.resolve(!1),b.promise)}},{key:"trim",value:function(){for(var v=new w.defer,m=this.views.displayed(),y=m[0],b=m[m.length-1],k=this.views.indexOf(y),x=this.views.indexOf(b),E=this.views.slice(0,k),_=this.views.slice(x+1),S=0;S<E.length-1;S++)this.erase(E[S],E);for(var C=1;C<_.length;C++)this.erase(_[C]);return v.resolve(),v.promise}},{key:"erase",value:function(v,m){var y,b;this.settings.height?(y=this.container.scrollTop,b=this.container.scrollLeft):(y=window.scrollY,b=window.scrollX);var w=v.bounds();this.views.remove(v),m&&("vertical"===this.settings.axis?this.scrollTo(0,y-w.height,!0):this.scrollTo(b-w.width,0,!0))}},{key:"addEventListeners",value:function(){window.addEventListener("unload",function(){this.ignore=!0,this.destroy()}.bind(this)),this.addScrollListeners()}},{key:"addScrollListeners",value:function(){var v;this.tick=w.requestAnimationFrame,this.settings.height?(this.prevScrollTop=this.container.scrollTop,this.prevScrollLeft=this.container.scrollLeft):(this.prevScrollTop=window.scrollY,this.prevScrollLeft=window.scrollX),this.scrollDeltaVert=0,this.scrollDeltaHorz=0,this.settings.height?(v=this.container,this.scrollTop=this.container.scrollTop,this.scrollLeft=this.container.scrollLeft):(v=window,this.scrollTop=window.scrollY,this.scrollLeft=window.scrollX),v.addEventListener("scroll",this.onScroll.bind(this)),this._scrolled=(0,_.default)(this.scrolled.bind(this),30),this.didScroll=!1}},{key:"removeEventListeners",value:function(){(this.settings.height?this.container:window).removeEventListener("scroll",this.onScroll.bind(this))}},{key:"onScroll",value:function(){var v=Math.abs,m=void 0,y=void 0,b="rtl"===this.settings.direction?-1:1;this.settings.height?(m=this.container.scrollTop,y=this.container.scrollLeft):(m=window.scrollY*b,y=window.scrollX*b),this.scrollTop=m,this.scrollLeft=y,this.ignore?this.ignore=!1:this._scrolled(),this.scrollDeltaVert+=v(m-this.prevScrollTop),this.scrollDeltaHorz+=v(y-this.prevScrollLeft),this.prevScrollTop=m,this.prevScrollLeft=y,clearTimeout(this.scrollTimeout),this.scrollTimeout=setTimeout(function(){this.scrollDeltaVert=0,this.scrollDeltaHorz=0}.bind(this),150),this.didScroll=!1}},{key:"scrolled",value:function(){this.q.enqueue(function(){this.check()}.bind(this)),this.emit(E.EVENTS.MANAGERS.SCROLL,{top:this.scrollTop,left:this.scrollLeft}),clearTimeout(this.afterScrolled),this.afterScrolled=setTimeout(function(){this.emit(E.EVENTS.MANAGERS.SCROLLED,{top:this.scrollTop,left:this.scrollLeft})}.bind(this))}},{key:"next",value:function(){this.settings.direction;var v="pre-paginated"===this.layout.props.name&&this.layout.props.spread?2*this.layout.props.delta:this.layout.props.delta;this.views.length&&(this.isPaginated&&"horizontal"===this.settings.axis?this.scrollBy(v,0,!0):this.scrollBy(0,this.layout.height,!0),this.q.enqueue(function(){this.check()}.bind(this)))}},{key:"prev",value:function(){this.settings.direction;var v="pre-paginated"===this.layout.props.name&&this.layout.props.spread?2*this.layout.props.delta:this.layout.props.delta;this.views.length&&(this.isPaginated&&"horizontal"===this.settings.axis?this.scrollBy(-v,0,!0):this.scrollBy(0,-this.layout.height,!0),this.q.enqueue(function(){this.check()}.bind(this)))}},{key:"updateAxis",value:function(v,m){this.isPaginated||(v="vertical"),(m||v!==this.settings.axis)&&(this.settings.axis=v,this.stage&&this.stage.axis(v),this.viewSettings.axis=v,this.mapping&&this.mapping.axis(v),this.layout&&("vertical"===v?this.layout.spread("none"):this.layout.spread(this.layout.settings.spread)),this.settings.infinite="vertical"===v)}}]),t}(k.default);m.default=S,v.exports=m.default},function(v,m,y){"use strict";(function(b){function i(v){return v&&v.__esModule?v:{default:v}}function o(v,m){return new w.default(v,m)}Object.defineProperty(m,"__esModule",{value:!0});var w=i(y(26)),k=i(y(18)),x=i(y(1)),E=i(y(13)),_=function(v){if(v&&v.__esModule)return v;var m={};if(null!=v)for(var y in v)Object.prototype.hasOwnProperty.call(v,y)&&(m[y]=v[y]);return m.default=v,m}(y(0));y(69);i(y(20)),i(y(14)),i(y(24));o.VERSION="0.3",void 0!==b&&(b.EPUBJS_VERSION=o.VERSION),o.Book=w.default,o.Rendition=k.default,o.Contents=E.default,o.CFI=x.default,o.utils=_,m.default=o,v.exports=m.default}).call(m,y(8))},function(v,m,y){"use strict";function a(v){return v&&v.__esModule?v:{default:v}}Object.defineProperty(m,"__esModule",{value:!0});var b=function(){function e(v,m){for(var y,b=0;b<m.length;b++)(y=m[b]).enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(v,y.key,y)}return function(v,m,y){return m&&e(v.prototype,m),y&&e(v,y),v}}(),w=a(y(2)),k=y(0),x=a(y(5)),E=a(y(4)),_=a(y(42)),S=a(y(44)),C=a(y(45)),T=a(y(46)),N=a(y(47)),O=a(y(48)),R=a(y(49)),L=a(y(18)),P=a(y(67)),A=a(y(11)),j=a(y(1)),I=y(3),z="META-INF/container.xml",q="binary",D="base64",B="epub",M="opf",V="json",U="directory",F=function(){function e(v,m){var y=this;(function i(v,m){if(!(v instanceof m))throw new TypeError("Cannot call a class as a function")})(this,e),void 0===m&&"string"!=typeof v&&0==v instanceof Blob&&(m=v,v=void 0),this.settings=(0,k.extend)(this.settings||{},{requestMethod:void 0,requestCredentials:void 0,requestHeaders:void 0,encoding:void 0,replacements:void 0,canonical:void 0,openAs:void 0}),(0,k.extend)(this.settings,m),this.opening=new k.defer,this.opened=this.opening.promise,this.isOpen=!1,this.loading={manifest:new k.defer,spine:new k.defer,metadata:new k.defer,cover:new k.defer,navigation:new k.defer,pageList:new k.defer,resources:new k.defer},this.loaded={manifest:this.loading.manifest.promise,spine:this.loading.spine.promise,metadata:this.loading.metadata.promise,cover:this.loading.cover.promise,navigation:this.loading.navigation.promise,pageList:this.loading.pageList.promise,resources:this.loading.resources.promise},this.ready=Promise.all([this.loaded.manifest,this.loaded.spine,this.loaded.metadata,this.loaded.cover,this.loaded.navigation,this.loaded.resources]),this.isRendered=!1,this.request=this.settings.requestMethod||A.default,this.spine=new _.default,this.locations=new S.default(this.spine,this.load.bind(this)),this.navigation=void 0,this.pageList=void 0,this.url=void 0,this.path=void 0,this.archived=!1,this.archive=void 0,this.resources=void 0,this.rendition=void 0,this.container=void 0,this.packaging=void 0,v&&this.open(v,this.settings.openAs).catch((function(){var m=new Error("Cannot load book at "+v);y.emit(I.EVENTS.BOOK.OPEN_FAILED,m)}))}return b(e,[{key:"open",value:function(v,m){var y,b=m||this.determineType(v);return b===q?(this.archived=!0,this.url=new x.default("/",""),y=this.openEpub(v)):b===D?(this.archived=!0,this.url=new x.default("/",""),y=this.openEpub(v,b)):b===B?(this.archived=!0,this.url=new x.default("/",""),y=this.request(v,"binary").then(this.openEpub.bind(this))):b==M?(this.url=new x.default(v),y=this.openPackaging(this.url.Path.toString())):b==V?(this.url=new x.default(v),y=this.openManifest(this.url.Path.toString())):(this.url=new x.default(v),y=this.openContainer(z).then(this.openPackaging.bind(this))),y}},{key:"openEpub",value:function(v,m){var y=this;return this.unarchive(v,m||this.settings.encoding).then((function(){return y.openContainer(z)})).then((function(v){return y.openPackaging(v)}))}},{key:"openContainer",value:function(v){var m=this;return this.load(v).then((function(v){return m.container=new C.default(v),m.resolve(m.container.packagePath)}))}},{key:"openPackaging",value:function(v){var m=this;return this.path=new E.default(v),this.load(v).then((function(v){return m.packaging=new T.default(v),m.unpack(m.packaging)}))}},{key:"openManifest",value:function(v){var m=this;return this.path=new E.default(v),this.load(v).then((function(v){return m.packaging=new T.default,m.packaging.load(v),m.unpack(m.packaging)}))}},{key:"load",value:function(v){var m;return this.archived?(m=this.resolve(v),this.archive.request(m)):(m=this.resolve(v),this.request(m,null,this.settings.requestCredentials,this.settings.requestHeaders))}},{key:"resolve",value:function(v,m){if(v){var y=v;return-1<v.indexOf("://")?v:(this.path&&(y=this.path.resolve(v)),0!=m&&this.url&&(y=this.url.resolve(y)),y)}}},{key:"canonical",value:function(v){return v?this.settings.canonical?this.settings.canonical(v):this.resolve(v,!0):""}},{key:"determineType",value:function(v){var m;return"base64"===this.settings.encoding?D:"string"==typeof v?(m=new x.default(v).path().extension)?"epub"===m?B:"opf"===m?M:"json"===m?V:void 0:U:q}},{key:"unpack",value:function(v){var m=this;this.package=v,this.spine.unpack(this.package,this.resolve.bind(this),this.canonical.bind(this)),this.resources=new O.default(this.package.manifest,{archive:this.archive,resolver:this.resolve.bind(this),request:this.request.bind(this),replacements:this.settings.replacements||(this.archived?"blobUrl":"base64")}),this.loadNavigation(this.package).then((function(){m.loading.navigation.resolve(m.navigation)})),this.package.coverPath&&(this.cover=this.resolve(this.package.coverPath)),this.loading.manifest.resolve(this.package.manifest),this.loading.metadata.resolve(this.package.metadata),this.loading.spine.resolve(this.spine),this.loading.cover.resolve(this.cover),this.loading.resources.resolve(this.resources),this.loading.pageList.resolve(this.pageList),this.isOpen=!0,this.archived||this.settings.replacements&&"none"!=this.settings.replacements?this.replacements().then((function(){m.opening.resolve(m)})).catch((function(v){console.error(v)})):this.opening.resolve(this)}},{key:"loadNavigation",value:function(v){var m=this,y=v.navPath||v.ncxPath,b=v.toc;return b?new Promise((function(y){m.navigation=new N.default(b),v.pageList&&(m.pageList=new R.default(v.pageList)),y(m.navigation)})):y?this.load(y,"xml").then((function(v){return m.navigation=new N.default(v),m.pageList=new R.default(v),m.navigation})):new Promise((function(v){m.navigation=new N.default,m.pageList=new R.default,v(m.navigation)}))}},{key:"section",value:function(v){return this.spine.get(v)}},{key:"renderTo",value:function(v,m){return this.rendition=new L.default(this,m),this.rendition.attachTo(v),this.rendition}},{key:"setRequestCredentials",value:function(v){this.settings.requestCredentials=v}},{key:"setRequestHeaders",value:function(v){this.settings.requestHeaders=v}},{key:"unarchive",value:function(v,m){return this.archive=new P.default,this.archive.open(v,m)}},{key:"coverUrl",value:function(){var v=this;return this.loaded.cover.then((function(){return v.archived?v.resources.get(v.cover):v.cover}))}},{key:"replacements",value:function(){var v=this;return this.spine.hooks.serialize.register((function(m,y){y.output=v.resources.substitute(m,y.url)})),this.resources.replacements().then((function(){return v.resources.replaceCss()}))}},{key:"getRange",value:function(v){var m=new j.default(v),y=this.spine.get(m.spinePos),b=this.load.bind(this);return y?y.load(b).then((function(){return m.toRange(y.document)})):new Promise((function(v,m){m("CFI could not be found")}))}},{key:"key",value:function(v){return"epubjs:0.3:"+(v||this.package.metadata.identifier||this.url.filename)}},{key:"destroy",value:function(){this.opened=void 0,this.loading=void 0,this.loaded=void 0,this.ready=void 0,this.isOpen=!1,this.isRendered=!1,this.spine&&this.spine.destroy(),this.locations&&this.locations.destroy(),this.pageList&&this.pageList.destroy(),this.archive&&this.archive.destroy(),this.resources&&this.resources.destroy(),this.container&&this.container.destroy(),this.packaging&&this.packaging.destroy(),this.rendition&&this.rendition.destroy(),this.spine=void 0,this.locations=void 0,this.pageList=void 0,this.archive=void 0,this.resources=void 0,this.container=void 0,this.packaging=void 0,this.rendition=void 0,this.navigation=void 0,this.url=void 0,this.path=void 0,this.archived=!1}}]),e}();(0,w.default)(F.prototype),m.default=F,v.exports=m.default},function(v,m,y){"use strict";var b,w=y(28),k=y(36),x=y(37),E=y(38);b=v.exports=function(v,m){var y,b,x,_,S;return 2>arguments.length||"string"!=typeof v?(_=m,m=v,v=null):_=arguments[2],null==v?(y=x=!0,b=!1):(y=E.call(v,"c"),b=E.call(v,"e"),x=E.call(v,"w")),S={value:m,configurable:y,enumerable:b,writable:x},_?w(k(_),S):S},b.gs=function(v,m,y){var b,_,S,C;return"string"==typeof v?S=arguments[3]:(S=y,y=m,m=v,v=null),null==m?m=void 0:x(m)?null==y?y=void 0:!x(y)&&(S=y,y=void 0):(S=m,m=y=void 0),null==v?(b=!0,_=!1):(b=E.call(v,"c"),_=E.call(v,"e")),C={get:m,set:y,configurable:b,enumerable:_},S?w(k(S),C):C}},function(v,m,y){"use strict";v.exports=y(29)()?Object.assign:y(30)},function(v){"use strict";v.exports=function(){var v,m=Object.assign;return!("function"!=typeof m)&&(m(v={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),"razdwatrzy"===v.foo+v.bar+v.trzy)}},function(v,m,y){"use strict";var b=y(31),w=y(35);v.exports=function(v,m){var y,x,E,_=k(arguments.length,2);for(v=Object(w(v)),E=function(b){try{v[b]=m[b]}catch(v){y||(y=v)}},x=1;x<_;++x)b(m=arguments[x]).forEach(E);if(void 0!==y)throw y;return v}},function(v,m,y){"use strict";v.exports=y(32)()?Object.keys:y(33)},function(v){"use strict";v.exports=function(){try{return Object.keys("primitive"),!0}catch(v){return!1}}},function(v,m,y){"use strict";var b=y(9),w=Object.keys;v.exports=function(v){return w(b(v)?Object(v):v)}},function(v){"use strict";v.exports=function(){}},function(v,m,y){"use strict";var b=y(9);v.exports=function(v){if(!b(v))throw new TypeError("Cannot use null or undefined");return v}},function(v,m,y){"use strict";var b=y(9),w=Array.prototype.forEach,k=Object.create,s=function(v,m){for(var y in v)m[y]=v[y]};v.exports=function(){var v=k(null);return w.call(arguments,(function(m){b(m)&&s(Object(m),v)})),v}},function(v){"use strict";v.exports=function(v){return"function"==typeof v}},function(v,m,b){"use strict";v.exports=b(39)()?y.contains:b(40)},function(v){"use strict";var m="razdwatrzy";v.exports=function(){return!("function"!=typeof m.contains)&&!0===m.contains("dwa")&&!1===m.contains("foo")}},function(v){"use strict";var m=y.indexOf;v.exports=function(v){return-1<m.call(this,v,arguments[1])}},function(v){"use strict";v.exports=function(v){if("function"!=typeof v)throw new TypeError(v+" is not a function");return v}},function(v,m,y){"use strict";function a(v){return v&&v.__esModule?v:{default:v}}Object.defineProperty(m,"__esModule",{value:!0});var b=function(){function e(v,m){for(var y,b=0;b<m.length;b++)(y=m[b]).enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(v,y.key,y)}return function(v,m,y){return m&&e(v.prototype,m),y&&e(v,y),v}}(),w=a(y(1)),k=a(y(10)),x=a(y(43)),E=y(7),_=function(){function e(){(function i(v,m){if(!(v instanceof m))throw new TypeError("Cannot call a class as a function")})(this,e),this.spineItems=[],this.spineByHref={},this.spineById={},this.hooks={},this.hooks.serialize=new k.default,this.hooks.content=new k.default,this.hooks.content.register(E.replaceBase),this.hooks.content.register(E.replaceCanonical),this.hooks.content.register(E.replaceMeta),this.epubcfi=new w.default,this.loaded=!1,this.items=void 0,this.manifest=void 0,this.spineNodeIndex=void 0,this.baseUrl=void 0,this.length=void 0}return b(e,[{key:"unpack",value:function(v,m,y){var b=this;this.items=v.spine,this.manifest=v.manifest,this.spineNodeIndex=v.spineNodeIndex,this.baseUrl=v.baseUrl||v.basePath||"",this.length=this.items.length,this.items.forEach((function(v,w){var k,E=b.manifest[v.idref];v.index=w,v.cfiBase=b.epubcfi.generateChapterComponent(b.spineNodeIndex,v.index,v.idref),v.href&&(v.url=m(v.href,!0),v.canonical=y(v.href)),E&&(v.href=E.href,v.url=m(v.href,!0),v.canonical=y(v.href),E.properties.length&&v.properties.push.apply(v.properties,E.properties)),"yes"===v.linear?(v.prev=function(){for(var m,y=v.index;0<y;){if((m=this.get(y-1))&&m.linear)return m;y-=1}}.bind(b),v.next=function(){for(var m,y=v.index;y<this.spineItems.length-1;){if((m=this.get(y+1))&&m.linear)return m;y+=1}}.bind(b)):(v.prev=function(){},v.next=function(){}),k=new x.default(v,b.hooks),b.append(k)})),this.loaded=!0}},{key:"get",value:function(v){var m=0;if(void 0===v)for(;m<this.spineItems.length;){var y=this.spineItems[m];if(y&&y.linear)break;m+=1}else if(this.epubcfi.isCfiString(v)){m=new w.default(v).spinePos}else"number"==typeof v||!1===isNaN(v)?m=v:"string"==typeof v&&0===v.indexOf("#")?m=this.spineById[v.substring(1)]:"string"==typeof v&&(v=v.split("#")[0],m=this.spineByHref[v]||this.spineByHref[encodeURI(v)]);return this.spineItems[m]||null}},{key:"append",value:function(v){var m=this.spineItems.length;return v.index=m,this.spineItems.push(v),this.spineByHref[decodeURI(v.href)]=m,this.spineByHref[encodeURI(v.href)]=m,this.spineByHref[v.href]=m,this.spineById[v.idref]=m,m}},{key:"prepend",value:function(v){return this.spineByHref[v.href]=0,this.spineById[v.idref]=0,this.spineItems.forEach((function(v,m){v.index=m})),0}},{key:"remove",value:function(v){var m=this.spineItems.indexOf(v);if(-1<m)return delete this.spineByHref[v.href],delete this.spineById[v.idref],this.spineItems.splice(m,1)}},{key:"each",value:function(){return this.spineItems.forEach.apply(this.spineItems,arguments)}},{key:"first",value:function(){var v=0;do{var m=this.get(v);if(m&&m.linear)return m;v+=1}while(v<this.spineItems.length)}},{key:"last",value:function(){var v=this.spineItems.length-1;do{var m=this.get(v);if(m&&m.linear)return m;v-=1}while(0<=v)}},{key:"destroy",value:function(){this.each((function(v){return v.destroy()})),this.spineItems=void 0,this.spineByHref=void 0,this.spineById=void 0,this.hooks.serialize.clear(),this.hooks.content.clear(),this.hooks=void 0,this.epubcfi=void 0,this.loaded=!1,this.items=void 0,this.manifest=void 0,this.spineNodeIndex=void 0,this.baseUrl=void 0,this.length=void 0}}]),e}();m.default=_,v.exports=m.default},function(v,m,y){"use strict";function a(v){return v&&v.__esModule?v:{default:v}}Object.defineProperty(m,"__esModule",{value:!0});var b=function(){function e(v,m){for(var y,b=0;b<m.length;b++)(y=m[b]).enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(v,y.key,y)}return function(v,m,y){return m&&e(v.prototype,m),y&&e(v,y),v}}(),w=y(0),k=a(y(1)),x=a(y(10)),E=y(7),_=function(){function e(v,m){(function i(v,m){if(!(v instanceof m))throw new TypeError("Cannot call a class as a function")})(this,e),this.idref=v.idref,this.linear="yes"===v.linear,this.properties=v.properties,this.index=v.index,this.href=v.href,this.url=v.url,this.canonical=v.canonical,this.next=v.next,this.prev=v.prev,this.cfiBase=v.cfiBase,m?this.hooks=m:(this.hooks={},this.hooks.serialize=new x.default(this),this.hooks.content=new x.default(this)),this.document=void 0,this.contents=void 0,this.output=void 0}return b(e,[{key:"load",value:function(v){var m=v||this.request||y(11),b=new w.defer,k=b.promise;return this.contents?b.resolve(this.contents):m(this.url).then(function(v){return this.document=v,this.contents=v.documentElement,this.hooks.content.trigger(this.document,this)}.bind(this)).then(function(){b.resolve(this.contents)}.bind(this)).catch((function(v){b.reject(v)})),k}},{key:"base",value:function(){return(0,E.replaceBase)(this.document,this)}},{key:"render",value:function(v){var m=new w.defer,b=m.promise;return this.output,this.load(v).then(function(v){var m=0<=("undefined"!=typeof navigator&&navigator.userAgent||"").indexOf("Trident"),b=new("undefined"==typeof XMLSerializer||m?y(16).XMLSerializer:XMLSerializer);return this.output=b.serializeToString(v),this.output}.bind(this)).then(function(){return this.hooks.serialize.trigger(this.output,this)}.bind(this)).then(function(){m.resolve(this.output)}.bind(this)).catch((function(v){m.reject(v)})),b}},{key:"find",value:function(v){var m=this,y=[],b=v.toLowerCase();return(0,w.sprint)(m.document,(function(v){!function(v){for(var w,k,x,E=v.textContent.toLowerCase(),_=m.document.createRange(),S=-1;-1!=k;)-1!=(k=E.indexOf(b,S+1))&&((_=m.document.createRange()).setStart(v,k),_.setEnd(v,k+b.length),w=m.cfiFromRange(_),x=v.textContent.length<150?v.textContent:"..."+(x=v.textContent.substring(k-75,k+75))+"...",y.push({cfi:w,excerpt:x})),S=k}(v)})),y}},{key:"reconcileLayoutSettings",value:function(v){var m={layout:v.layout,spread:v.spread,orientation:v.orientation};return this.properties.forEach((function(v){var y,b,w=v.replace("rendition:",""),k=w.indexOf("-");-1!=k&&(y=w.slice(0,k),b=w.slice(k+1),m[y]=b)})),m}},{key:"cfiFromRange",value:function(v){return new k.default(v,this.cfiBase).toString()}},{key:"cfiFromElement",value:function(v){return new k.default(v,this.cfiBase).toString()}},{key:"unload",value:function(){this.document=void 0,this.contents=void 0,this.output=void 0}},{key:"destroy",value:function(){this.unload(),this.hooks.serialize.clear(),this.hooks.content.clear(),this.hooks=void 0,this.idref=void 0,this.linear=void 0,this.properties=void 0,this.index=void 0,this.href=void 0,this.url=void 0,this.next=void 0,this.prev=void 0,this.cfiBase=void 0}}]),e}();m.default=_,v.exports=m.default},function(v,m,y){"use strict";function i(v){return v&&v.__esModule?v:{default:v}}Object.defineProperty(m,"__esModule",{value:!0});var w=function(){function e(v,m){for(var y,b=0;b<m.length;b++)(y=m[b]).enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(v,y.key,y)}return function(v,m,y){return m&&e(v.prototype,m),y&&e(v,y),v}}(),k=y(0),x=i(y(12)),E=i(y(1)),_=y(3),S=i(y(2)),C=function(){function e(v,m,y){(function o(v,m){if(!(v instanceof m))throw new TypeError("Cannot call a class as a function")})(this,e),this.spine=v,this.request=m,this.pause=y||100,this.q=new x.default(this),this.epubcfi=new E.default,this._locations=[],this.total=0,this.break=150,this._current=0,this.currentLocation="",this._currentCfi="",this.processingTimeout=void 0}return w(e,[{key:"generate",value:function(v){return v&&(this.break=v),this.q.pause(),this.spine.each(function(v){v.linear&&this.q.enqueue(this.process.bind(this),v)}.bind(this)),this.q.run().then(function(){return this.total=this._locations.length-1,this._currentCfi&&(this.currentLocation=this._currentCfi),this._locations}.bind(this))}},{key:"createRange",value:function(){return{startContainer:void 0,startOffset:void 0,endContainer:void 0,endOffset:void 0}}},{key:"process",value:function(v){return v.load(this.request).then(function(m){var y=new k.defer,b=this.parse(m,v.cfiBase);return this._locations=this._locations.concat(b),v.unload(),this.processingTimeout=setTimeout((function(){return y.resolve(b)}),this.pause),y.promise}.bind(this))}},{key:"parse",value:function(v,m,y){var b,w,x=[],_=v.ownerDocument,S=(0,k.qs)(_,"body"),C=0,T=y||this.break;if((0,k.sprint)(S,function(v){var y,k=v.length,_=0;if(0===v.textContent.trim().length)return!1;for(0==C&&((b=this.createRange()).startContainer=v,b.startOffset=0),(y=T-C)>k&&(C+=k,_=k);_<k;)if(y=T-C,0===C&&(_+=1,(b=this.createRange()).startContainer=v,b.startOffset=_),_+y>=k)C+=k-_,_=k;else{_+=y,b.endContainer=v,b.endOffset=_;var S=new E.default(b,m).toString();x.push(S),C=0}w=v}.bind(this)),b&&b.startContainer&&w){b.endContainer=w,b.endOffset=w.length;var N=new E.default(b,m).toString();x.push(N),C=0}return x}},{key:"locationFromCfi",value:function(v){var m;return E.default.prototype.isCfiString(v)&&(v=new E.default(v)),0===this._locations.length?-1:(m=(0,k.locationOf)(v,this._locations,this.epubcfi.compare))>this.total?this.total:m}},{key:"percentageFromCfi",value:function(v){if(0===this._locations.length)return null;var m=this.locationFromCfi(v);return this.percentageFromLocation(m)}},{key:"percentageFromLocation",value:function(v){return v&&this.total?v/this.total:0}},{key:"cfiFromLocation",value:function(v){var m=-1;return"number"!=typeof v&&(v=parseInt(v)),0<=v&&v<this._locations.length&&(m=this._locations[v]),m}},{key:"cfiFromPercentage",value:function(v){var m;if(1<v&&console.warn("Normalize cfiFromPercentage value to between 0 - 1"),1<=v){var y=new E.default(this._locations[this.total]);return y.collapse(),y.toString()}return m=b(this.total*v),this.cfiFromLocation(m)}},{key:"load",value:function(v){return this._locations="string"==typeof v?JSON.parse(v):v,this.total=this._locations.length-1,this._locations}},{key:"save",value:function(){return JSON.stringify(this._locations)}},{key:"getCurrent",value:function(){return this._current}},{key:"setCurrent",value:function(v){var m;if("string"==typeof v)this._currentCfi=v;else{if("number"!=typeof v)return;this._current=v}0===this._locations.length||("string"==typeof v?(m=this.locationFromCfi(v),this._current=m):m=v,this.emit(_.EVENTS.LOCATIONS.CHANGED,{percentage:this.percentageFromLocation(m)}))}},{key:"length",value:function(){return this._locations.length}},{key:"destroy",value:function(){this.spine=void 0,this.request=void 0,this.pause=void 0,this.q.stop(),this.q=void 0,this.epubcfi=void 0,this._locations=void 0,this.total=void 0,this.break=void 0,this._current=void 0,this.currentLocation=void 0,this._currentCfi=void 0,clearTimeout(this.processingTimeout)}},{key:"currentLocation",get:function(){return this._current},set:function(v){this.setCurrent(v)}}]),e}();(0,S.default)(C.prototype),m.default=C,v.exports=m.default},function(v,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var b=function(){function e(v,m){for(var y,b=0;b<m.length;b++)(y=m[b]).enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(v,y.key,y)}return function(v,m,y){return m&&e(v.prototype,m),y&&e(v,y),v}}(),w=function(v){return v&&v.__esModule?v:{default:v}}(y(6)),k=y(0),x=function(){function e(v){(function a(v,m){if(!(v instanceof m))throw new TypeError("Cannot call a class as a function")})(this,e),this.packagePath="",this.directory="",this.encoding="",v&&this.parse(v)}return b(e,[{key:"parse",value:function(v){var m;if(!v)throw new Error("Container File Not Found");if(!(m=(0,k.qs)(v,"rootfile")))throw new Error("No RootFile Found");this.packagePath=m.getAttribute("full-path"),this.directory=w.default.dirname(this.packagePath),this.encoding=v.xmlEncoding}},{key:"destroy",value:function(){this.packagePath=void 0,this.directory=void 0,this.encoding=void 0}}]),e}();m.default=x,v.exports=m.default},function(v,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var b=function(){function e(v,m){for(var y,b=0;b<m.length;b++)(y=m[b]).enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(v,y.key,y)}return function(v,m,y){return m&&e(v.prototype,m),y&&e(v,y),v}}(),w=y(0),k=function(){function e(v){(function a(v,m){if(!(v instanceof m))throw new TypeError("Cannot call a class as a function")})(this,e),this.manifest={},this.navPath="",this.ncxPath="",this.coverPath="",this.spineNodeIndex=0,this.spine=[],this.metadata={},v&&this.parse(v)}return b(e,[{key:"parse",value:function(v){var m,y,b;if(!v)throw new Error("Package File Not Found");if(!(m=(0,w.qs)(v,"metadata")))throw new Error("No Metadata Found");if(!(y=(0,w.qs)(v,"manifest")))throw new Error("No Manifest Found");if(!(b=(0,w.qs)(v,"spine")))throw new Error("No Spine Found");return this.manifest=this.parseManifest(y),this.navPath=this.findNavPath(y),this.ncxPath=this.findNcxPath(y,b),this.coverPath=this.findCoverPath(v),this.spineNodeIndex=(0,w.indexOfElementNode)(b),this.spine=this.parseSpine(b,this.manifest),this.metadata=this.parseMetadata(m),this.metadata.direction=b.getAttribute("page-progression-direction"),{metadata:this.metadata,spine:this.spine,manifest:this.manifest,navPath:this.navPath,ncxPath:this.ncxPath,coverPath:this.coverPath,spineNodeIndex:this.spineNodeIndex}}},{key:"parseMetadata",value:function(v){return{title:this.getElementText(v,"title"),creator:this.getElementText(v,"creator"),description:this.getElementText(v,"description"),pubdate:this.getElementText(v,"date"),publisher:this.getElementText(v,"publisher"),identifier:this.getElementText(v,"identifier"),language:this.getElementText(v,"language"),rights:this.getElementText(v,"rights"),modified_date:this.getPropertyText(v,"dcterms:modified"),layout:this.getPropertyText(v,"rendition:layout"),orientation:this.getPropertyText(v,"rendition:orientation"),flow:this.getPropertyText(v,"rendition:flow"),viewport:this.getPropertyText(v,"rendition:viewport")}}},{key:"parseManifest",value:function(v){var m={},y=(0,w.qsa)(v,"item");return Array.prototype.slice.call(y).forEach((function(v){var y=v.getAttribute("id"),b=v.getAttribute("href")||"",w=v.getAttribute("media-type")||"",k=v.getAttribute("properties")||"";m[y]={href:b,type:w,properties:k.length?k.split(" "):[]}})),m}},{key:"parseSpine",value:function(v){var m=[],y=(0,w.qsa)(v,"itemref");return Array.prototype.slice.call(y).forEach((function(v,y){var b=v.getAttribute("idref"),w=v.getAttribute("properties")||"",k=w.length?w.split(" "):[],x={idref:b,linear:v.getAttribute("linear")||"yes",properties:k,index:y};m.push(x)})),m}},{key:"findNavPath",value:function(v){var m=(0,w.qsp)(v,"item",{properties:"nav"});return!!m&&m.getAttribute("href")}},{key:"findNcxPath",value:function(v,m){var y,b=(0,w.qsp)(v,"item",{"media-type":"application/x-dtbncx+xml"});return b||(y=m.getAttribute("toc"))&&(b=v.getElementById(y)),!!b&&b.getAttribute("href")}},{key:"findCoverPath",value:function(v){if("2.0"===(0,w.qs)(v,"package").getAttribute("version")){var m=(0,w.qsp)(v,"meta",{name:"cover"});if(m){var y=m.getAttribute("content"),b=v.getElementById(y);return b?b.getAttribute("href"):""}return!1}var k=(0,w.qsp)(v,"item",{properties:"cover-image"});return k?k.getAttribute("href"):""}},{key:"getElementText",value:function(v,m){var y,b=v.getElementsByTagNameNS("http://purl.org/dc/elements/1.1/",m);return b&&0!==b.length?(y=b[0]).childNodes.length?y.childNodes[0].nodeValue:"":""}},{key:"getPropertyText",value:function(v,m){var y=(0,w.qsp)(v,"meta",{property:m});return y&&y.childNodes.length?y.childNodes[0].nodeValue:""}},{key:"load",value:function(v){var m=this;return this.metadata=v.metadata,this.spine=v.spine.map((function(v,m){return v.index=m,v})),v.resources.forEach((function(v,y){m.manifest[y]=v,v.rel&&"cover"===v.rel[0]&&(m.coverPath=v.href)})),this.spineNodeIndex=0,this.toc=v.toc.map((function(v){return v.label=v.title,v})),{metadata:this.metadata,spine:this.spine,manifest:this.manifest,navPath:this.navPath,ncxPath:this.ncxPath,coverPath:this.coverPath,spineNodeIndex:this.spineNodeIndex,toc:this.toc}}},{key:"destroy",value:function(){this.manifest=void 0,this.navPath=void 0,this.ncxPath=void 0,this.coverPath=void 0,this.spineNodeIndex=void 0,this.spine=void 0,this.metadata=void 0}}]),e}();m.default=k,v.exports=m.default},function(v,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var b=function(){function e(v,m){for(var y,b=0;b<m.length;b++)(y=m[b]).enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(v,y.key,y)}return function(v,m,y){return m&&e(v.prototype,m),y&&e(v,y),v}}(),w=y(0),k=function(){function e(v){(function a(v,m){if(!(v instanceof m))throw new TypeError("Cannot call a class as a function")})(this,e),this.toc=[],this.tocByHref={},this.tocById={},this.landmarks=[],this.landmarksByType={},this.length=0,v&&this.parse(v)}return b(e,[{key:"parse",value:function(v){var m=v.nodeType,y=void 0,b=void 0;m&&(y=(0,w.qs)(v,"html"),b=(0,w.qs)(v,"ncx")),m?y?(this.toc=this.parseNav(v),this.landmarks=this.parseLandmarks(v)):b&&(this.toc=this.parseNcx(v)):this.toc=this.load(v),this.length=0,this.unpack(this.toc)}},{key:"unpack",value:function(v){for(var m,y=0;y<v.length;y++)(m=v[y]).href&&(this.tocByHref[m.href]=y),m.id&&(this.tocById[m.id]=y),this.length++,m.subitems.length&&this.unpack(m.subitems)}},{key:"get",value:function(v){var m;return v?(0===v.indexOf("#")?m=this.tocById[v.substring(1)]:v in this.tocByHref&&(m=this.tocByHref[v]),this.toc[m]):this.toc}},{key:"landmark",value:function(v){var m;return v?(m=this.landmarksByType[v],this.landmarks[m]):this.landmarks}},{key:"parseNav",value:function(v){var m,y,b=(0,w.querySelectorByType)(v,"nav","toc"),k=b?(0,w.qsa)(b,"li"):[],x=k.length,E={},_=[];if(!k||0===x)return _;for(m=0;m<x;++m)(y=this.navItem(k[m]))&&(E[y.id]=y,y.parent?E[y.parent].subitems.push(y):_.push(y));return _}},{key:"navItem",value:function(v){var m=v.getAttribute("id")||void 0,y=(0,w.filterChildren)(v,"a",!0);if(y){var b=y.getAttribute("href")||"",k=y.textContent||"",x=(0,w.getParentByTagName)(v,"li"),E=void 0;for(x&&(E=x.getAttribute("id"));!E&&x;)(x=(0,w.getParentByTagName)(x,"li"))&&(E=x.getAttribute("id"));return{id:m,href:b,label:k,subitems:[],parent:E}}}},{key:"parseLandmarks",value:function(v){var m,y,b=(0,w.querySelectorByType)(v,"nav","landmarks"),k=b?(0,w.qsa)(b,"li"):[],x=k.length,E=[];if(!k||0===x)return E;for(m=0;m<x;++m)(y=this.landmarkItem(k[m]))&&(E.push(y),this.landmarksByType[y.type]=m);return E}},{key:"landmarkItem",value:function(v){var m=(0,w.filterChildren)(v,"a",!0);if(m){var y=m.getAttributeNS("http://www.idpf.org/2007/ops","type")||void 0;return{href:m.getAttribute("href")||"",label:m.textContent||"",type:y}}}},{key:"parseNcx",value:function(v){var m,y,b=(0,w.qsa)(v,"navPoint"),k=b.length,x={},E=[];if(!b||0===k)return E;for(m=0;m<k;++m)x[(y=this.ncxItem(b[m])).id]=y,y.parent?x[y.parent].subitems.push(y):E.push(y);return E}},{key:"ncxItem",value:function(v){var m,y=v.getAttribute("id")||!1,b=(0,w.qs)(v,"content").getAttribute("src"),k=(0,w.qs)(v,"navLabel"),x=k.textContent?k.textContent:"",E=v.parentNode;return E&&"navPoint"===E.nodeName&&(m=E.getAttribute("id")),{id:y,href:b,label:x,subitems:[],parent:m}}},{key:"load",value:function(v){var m=this;return v.map((function(v){return v.label=v.title,v.children&&(v.subitems=m.load(v.children)),v}))}},{key:"forEach",value:function(v){return this.toc.forEach(v)}}]),e}();m.default=k,v.exports=m.default},function(v,m,y){"use strict";function a(v){return v&&v.__esModule?v:{default:v}}Object.defineProperty(m,"__esModule",{value:!0});var b=function(){function e(v,m){for(var y,b=0;b<m.length;b++)(y=m[b]).enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(v,y.key,y)}return function(v,m,y){return m&&e(v.prototype,m),y&&e(v,y),v}}(),w=y(7),k=y(0),x=a(y(5)),E=a(y(17)),_=a(y(4)),S=a(y(6)),C=function(){function e(v,m){(function i(v,m){if(!(v instanceof m))throw new TypeError("Cannot call a class as a function")})(this,e),this.settings={replacements:m&&m.replacements||"base64",archive:m&&m.archive,resolver:m&&m.resolver,request:m&&m.request},this.manifest=v,this.resources=Object.keys(v).map((function(m){return v[m]})),this.replacementUrls=[],this.html=[],this.assets=[],this.css=[],this.urls=[],this.cssUrls=[],this.split(),this.splitUrls()}return b(e,[{key:"split",value:function(){this.html=this.resources.filter((function(v){if("application/xhtml+xml"===v.type||"text/html"===v.type)return!0})),this.assets=this.resources.filter((function(v){if("application/xhtml+xml"!==v.type&&"text/html"!==v.type)return!0})),this.css=this.resources.filter((function(v){if("text/css"===v.type)return!0}))}},{key:"splitUrls",value:function(){this.urls=this.assets.map(function(v){return v.href}.bind(this)),this.cssUrls=this.css.map((function(v){return v.href}))}},{key:"createUrl",value:function(v){var m=new x.default(v),y=E.default.lookup(m.filename);return this.settings.archive?this.settings.archive.createUrl(v,{base64:"base64"===this.settings.replacements}):"base64"===this.settings.replacements?this.settings.request(v,"blob").then((function(v){return(0,k.blob2base64)(v)})).then((function(v){return(0,k.createBase64Url)(v,y)})):this.settings.request(v,"blob").then((function(v){return(0,k.createBlobUrl)(v,y)}))}},{key:"replacements",value:function(){var v=this;if("none"===this.settings.replacements)return new Promise(function(v){v(this.urls)}.bind(this));var m=this.urls.map((function(m){var y=v.settings.resolver(m);return v.createUrl(y).catch((function(v){return console.error(v),null}))}));return Promise.all(m).then((function(m){return v.replacementUrls=m.filter((function(v){return"string"==typeof v})),m}))}},{key:"replaceCss",value:function(v,m){var y=[];return v=v||this.settings.archive,m=m||this.settings.resolver,this.cssUrls.forEach(function(b){var w=this.createCssFile(b,v,m).then(function(v){var m=this.urls.indexOf(b);-1<m&&(this.replacementUrls[m]=v)}.bind(this));y.push(w)}.bind(this)),Promise.all(y)}},{key:"createCssFile",value:function(v){var m=this;if(S.default.isAbsolute(v))return new Promise((function(v){v()}));var y,b=this.settings.resolver(v);y=this.settings.archive?this.settings.archive.getText(b):this.settings.request(b,"text");var x=this.urls.map((function(v){var y=m.settings.resolver(v);return new _.default(b).relative(y)}));return y?y.then((function(v){return v=(0,w.substitute)(v,x,m.replacementUrls),"base64"===m.settings.replacements?(0,k.createBase64Url)(v,"text/css"):(0,k.createBlobUrl)(v,"text/css")}),(function(){return new Promise((function(v){v()}))})):new Promise((function(v){v()}))}},{key:"relativeTo",value:function(v,m){return m=m||this.settings.resolver,this.urls.map(function(y){var b=m(y);return new _.default(v).relative(b)}.bind(this))}},{key:"get",value:function(v){var m=this.urls.indexOf(v);return-1===m?void 0:this.replacementUrls.length?new Promise(function(v){v(this.replacementUrls[m])}.bind(this)):this.createUrl(v)}},{key:"substitute",value:function(v,m){var y;return y=m?this.relativeTo(m):this.urls,(0,w.substitute)(v,y,this.replacementUrls)}},{key:"destroy",value:function(){this.settings=void 0,this.manifest=void 0,this.resources=void 0,this.replacementUrls=void 0,this.html=void 0,this.assets=void 0,this.css=void 0,this.urls=void 0,this.cssUrls=void 0}}]),e}();m.default=C,v.exports=m.default},function(v,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var b=function(){function e(v,m){for(var y,b=0;b<m.length;b++)(y=m[b]).enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(v,y.key,y)}return function(v,m,y){return m&&e(v.prototype,m),y&&e(v,y),v}}(),k=function(v){return v&&v.__esModule?v:{default:v}}(y(1)),x=y(0),E=function(){function e(v){(function a(v,m){if(!(v instanceof m))throw new TypeError("Cannot call a class as a function")})(this,e),this.pages=[],this.locations=[],this.epubcfi=new k.default,this.firstPage=0,this.lastPage=0,this.totalPages=0,this.toc=void 0,this.ncx=void 0,v&&(this.pageList=this.parse(v)),this.pageList&&this.pageList.length&&this.process(this.pageList)}return b(e,[{key:"parse",value:function(v){var m=(0,x.qs)(v,"html");(0,x.qs)(v,"ncx");return m?this.parseNav(v):void 0}},{key:"parseNav",value:function(v){var m,y,b=(0,x.querySelectorByType)(v,"nav","page-list"),w=b?(0,x.qsa)(b,"li"):[],k=w.length,E=[];if(!w||0===k)return E;for(m=0;m<k;++m)y=this.item(w[m]),E.push(y);return E}},{key:"item",value:function(v){var m,y,b=(0,x.qs)(v,"a"),w=b.getAttribute("href")||"",k=b.textContent||"",E=parseInt(k);return-1==w.indexOf("epubcfi")?{href:w,page:E}:(y=(m=w.split("#"))[0],{cfi:!!(1<m.length)&&m[1],href:w,packageUrl:y,page:E})}},{key:"process",value:function(v){v.forEach((function(v){this.pages.push(v.page),v.cfi&&this.locations.push(v.cfi)}),this),this.firstPage=parseInt(this.pages[0]),this.lastPage=parseInt(this.pages[this.pages.length-1]),this.totalPages=this.lastPage-this.firstPage}},{key:"pageFromCfi",value:function(v){var m=-1;if(0===this.locations.length)return-1;var y=(0,x.indexOfSorted)(v,this.locations,this.epubcfi.compare);return-1==y?void 0!==(m=0<=(y=(0,x.locationOf)(v,this.locations,this.epubcfi.compare))-1?this.pages[y-1]:this.pages[0])||(m=-1):m=this.pages[y],m}},{key:"cfiFromPage",value:function(v){var m=-1;"number"!=typeof v&&(v=parseInt(v));var y=this.pages.indexOf(v);return-1!=y&&(m=this.locations[y]),m}},{key:"pageFromPercentage",value:function(v){return w(this.totalPages*v)}},{key:"percentageFromPage",value:function(v){var m=(v-this.firstPage)/this.totalPages;return w(1e3*m)/1e3}},{key:"percentageFromCfi",value:function(v){var m=this.pageFromCfi(v);return this.percentageFromPage(m)}},{key:"destroy",value:function(){this.pages=void 0,this.locations=void 0,this.epubcfi=void 0,this.pageList=void 0,this.toc=void 0,this.ncx=void 0}}]),e}();m.default=E,v.exports=m.default},function(v,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var w=function(){function e(v,m){for(var y,b=0;b<m.length;b++)(y=m[b]).enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(v,y.key,y)}return function(v,m,y){return m&&e(v.prototype,m),y&&e(v,y),v}}(),k=y(0),E=y(3),_=function(v){return v&&v.__esModule?v:{default:v}}(y(2)),S=function(){function e(v){(function i(v,m){if(!(v instanceof m))throw new TypeError("Cannot call a class as a function")})(this,e),this.settings=v,this.name=v.layout||"reflowable",this._spread="none"!==v.spread,this._minSpreadWidth=v.minSpreadWidth||800,this._evenSpreads=v.evenSpreads||!1,this._flow="scrolled"===v.flow||"scrolled-continuous"===v.flow||"scrolled-doc"===v.flow?"scrolled":"paginated",this.width=0,this.height=0,this.spreadWidth=0,this.delta=0,this.columnWidth=0,this.gap=0,this.divisor=1,this.props={name:this.name,spread:this._spread,flow:this._flow,width:0,height:0,spreadWidth:0,delta:0,columnWidth:0,gap:0,divisor:1}}return w(e,[{key:"flow",value:function(v){return void 0!==v&&(this._flow="scrolled"===v||"scrolled-continuous"===v||"scrolled-doc"===v?"scrolled":"paginated",this.update({flow:this._flow})),this._flow}},{key:"spread",value:function(v,m){return v&&(this._spread="none"!==v,this.update({spread:this._spread})),0<=m&&(this._minSpreadWidth=m),this._spread}},{key:"calculate",value:function(v,m,y){var b,w,k,E,_,S=y||0,C=v,T=m,N=x(C/12);b=this._spread&&C>=this._minSpreadWidth?2:1,"reflowable"!==this.name||"paginated"!==this._flow||0<=y||(S=0==N%2?N:N-1),"pre-paginated"===this.name&&(S=0),1<b?E=(w=C/b-S)+S:(w=C,E=C),"pre-paginated"===this.name&&1<b&&(C=w),k=w*b+S,_=C,this.width=C,this.height=T,this.spreadWidth=k,this.pageWidth=E,this.delta=_,this.columnWidth=w,this.gap=S,this.divisor=b,this.update({width:C,height:T,spreadWidth:k,pageWidth:E,delta:_,columnWidth:w,gap:S,divisor:b})}},{key:"format",value:function(v){return"pre-paginated"===this.name?v.fit(this.columnWidth,this.height):"paginated"===this._flow?v.columns(this.width,this.height,this.columnWidth,this.gap):v.size(this.width,null)}},{key:"count",value:function(v,m){var y,w;return"pre-paginated"===this.name?(y=1,w=1):"paginated"===this._flow?(m=m||this.delta,w=(y=b(v/m))*this.divisor):(m=m||this.height,w=y=b(v/m)),{spreads:y,pages:w}}},{key:"update",value:function(v){var m=this;if(Object.keys(v).forEach((function(y){m.props[y]===v[y]&&delete v[y]})),0<Object.keys(v).length){var y=(0,k.extend)(this.props,v);this.emit(E.EVENTS.LAYOUT.UPDATED,y,v)}}}]),e}();(0,_.default)(S.prototype),m.default=S,v.exports=m.default},function(v,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(v){return typeof v}:function(v){return v&&"function"==typeof Symbol&&v.constructor===Symbol&&v!==Symbol.prototype?"symbol":typeof v},w=function(){function e(v,m){for(var y,b=0;b<m.length;b++)(y=m[b]).enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(v,y.key,y)}return function(v,m,y){return m&&e(v.prototype,m),y&&e(v,y),v}}(),k=function(v){return v&&v.__esModule?v:{default:v}}(y(5)),x=function(){function e(v){(function a(v,m){if(!(v instanceof m))throw new TypeError("Cannot call a class as a function")})(this,e),this.rendition=v,this._themes={default:{rules:{},url:"",serialized:""}},this._overrides={},this._current="default",this._injected=[],this.rendition.hooks.content.register(this.inject.bind(this)),this.rendition.hooks.content.register(this.overrides.bind(this))}return w(e,[{key:"register",value:function(){return 0===arguments.length?void 0:1===arguments.length&&"object"===b(arguments[0])?this.registerThemes(arguments[0]):1===arguments.length&&"string"==typeof arguments[0]?this.default(arguments[0]):2===arguments.length&&"string"==typeof arguments[1]?this.registerUrl(arguments[0],arguments[1]):2===arguments.length&&"object"===b(arguments[1])?this.registerRules(arguments[0],arguments[1]):void 0}},{key:"default",value:function(v){return v?"string"==typeof v?this.registerUrl("default",v):"object"===(void 0===v?"undefined":b(v))?this.registerRules("default",v):void 0:void 0}},{key:"registerThemes",value:function(v){for(var m in v)v.hasOwnProperty(m)&&("string"==typeof v[m]?this.registerUrl(m,v[m]):this.registerRules(m,v[m]))}},{key:"registerUrl",value:function(v,m){var y=new k.default(m);this._themes[v]={url:y.toString()},this._injected[v]&&this.update(v)}},{key:"registerRules",value:function(v,m){this._themes[v]={rules:m},this._injected[v]&&this.update(v)}},{key:"select",value:function(v){var m=this._current;this._current=v,this.update(v),this.rendition.getContents().forEach((function(y){y.removeClass(m),y.addClass(v)}))}},{key:"update",value:function(v){var m=this;this.rendition.getContents().forEach((function(y){m.add(v,y)}))}},{key:"inject",value:function(v){var m,y=[],b=this._themes;for(var w in b)b.hasOwnProperty(w)&&(w===this._current||"default"==w)&&(((m=b[w]).rules&&0<Object.keys(m.rules).length||m.url&&-1===y.indexOf(m.url))&&this.add(w,v),this._injected.push(w));"default"!=this._current&&v.addClass(this._current)}},{key:"add",value:function(v,m){var y=this._themes[v];y&&m&&(y.url?m.addStylesheet(y.url):y.serialized||y.rules&&(m.addStylesheetRules(y.rules),y.injected=!0))}},{key:"override",value:function(v,m,y){var b=this,w=this.rendition.getContents();this._overrides[v]={value:m,priority:!0===y},w.forEach((function(m){m.css(v,b._overrides[v].value,b._overrides[v].priority)}))}},{key:"overrides",value:function(v){var m=this._overrides;for(var y in m)m.hasOwnProperty(y)&&v.css(y,m[y].value,m[y].priority)}},{key:"fontSize",value:function(v){this.override("font-size",v)}},{key:"font",value:function(v){this.override("font-family",v,!0)}},{key:"destroy",value:function(){this.rendition=void 0,this._themes=void 0,this._overrides=void 0,this._current=void 0,this._injected=void 0}}]),e}();m.default=x,v.exports=m.default},function(v,m,y){"use strict";function a(v){return v&&v.__esModule?v:{default:v}}function i(v,m){if(!(v instanceof m))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(m,"__esModule",{value:!0});var b=function(){function e(v,m){for(var y,b=0;b<m.length;b++)(y=m[b]).enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(v,y.key,y)}return function(v,m,y){return m&&e(v.prototype,m),y&&e(v,y),v}}(),w=a(y(2)),k=a(y(1)),x=function(){function e(v){i(this,e),this.rendition=v,this.highlights=[],this.underlines=[],this.marks=[],this._annotations={},this._annotationsBySectionIndex={},this.rendition.hooks.render.register(this.inject.bind(this)),this.rendition.hooks.unloaded.register(this.clear.bind(this))}return b(e,[{key:"add",value:function(v,m,y,b){var w=encodeURI(m),x=new k.default(m).spinePos,_=new E({type:v,cfiRange:m,data:y,sectionIndex:x,cb:b});return this._annotations[w]=_,x in this._annotationsBySectionIndex?this._annotationsBySectionIndex[x].push(w):this._annotationsBySectionIndex[x]=[w],this.rendition.views().forEach((function(v){_.sectionIndex===v.index&&_.attach(v)})),_}},{key:"remove",value:function(v,m){var y=this,b=encodeURI(v);if(b in this._annotations){var w=this._annotations[b];if(m&&w.type!==m)return;this.rendition.views().forEach((function(v){y._removeFromAnnotationBySectionIndex(w.sectionIndex,b),w.sectionIndex===v.index&&w.detach(v)})),delete this._annotations[b]}}},{key:"_removeFromAnnotationBySectionIndex",value:function(v,m){this._annotationsBySectionIndex[v]=this._annotationsAt(v).filter((function(v){return v!==m}))}},{key:"_annotationsAt",value:function(v){return this._annotationsBySectionIndex[v]}},{key:"highlight",value:function(v,m,y){this.add("highlight",v,m,y)}},{key:"underline",value:function(v,m,y){this.add("underline",v,m,y)}},{key:"mark",value:function(v,m,y){this.add("mark",v,m,y)}},{key:"each",value:function(){return this._annotations.forEach.apply(this._annotations,arguments)}},{key:"inject",value:function(v){var m=this,y=v.index;y in this._annotationsBySectionIndex&&this._annotationsBySectionIndex[y].forEach((function(y){m._annotations[y].attach(v)}))}},{key:"clear",value:function(v){var m=this,y=v.index;y in this._annotationsBySectionIndex&&this._annotationsBySectionIndex[y].forEach((function(y){m._annotations[y].detach(v)}))}},{key:"show",value:function(){}},{key:"hide",value:function(){}}]),e}(),E=function(){function e(v){var m=v.type,y=v.cfiRange,b=v.data,w=v.sectionIndex,k=v.cb;i(this,e),this.type=m,this.cfiRange=y,this.data=b,this.sectionIndex=w,this.mark=void 0,this.cb=k}return b(e,[{key:"update",value:function(v){this.data=v}},{key:"attach",value:function(v){var m=this.cfiRange,y=this.data,b=this.type,w=(this.mark,this.cb),k=void 0;return"highlight"===b?k=v.highlight(m,y,w):"underline"===b?k=v.underline(m,y,w):"mark"===b&&(k=v.mark(m,y,w)),this.mark=k,k}},{key:"detach",value:function(v){var m=this.cfiRange,y=this.type,b=void 0;return v&&("highlight"===y?b=v.unhighlight(m):"underline"===y?b=v.ununderline(m):"mark"===y&&(b=v.unmark(m))),this.mark=void 0,b}},{key:"text",value:function(){}}]),e}();(0,w.default)(E.prototype),m.default=x,v.exports=m.default},function(v,m,y){"use strict";function a(v){return v&&v.__esModule?v:{default:v}}function i(v,m){if(!v)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!m||"object"!==(void 0===m?"undefined":b(m))&&"function"!=typeof m?v:m}function o(v,m){if("function"!=typeof m&&null!==m)throw new TypeError("Super expression must either be null or a function, not "+(void 0===m?"undefined":b(m)));v.prototype=Object.create(m&&m.prototype,{constructor:{value:v,enumerable:!1,writable:!0,configurable:!0}}),m&&(Object.setPrototypeOf?Object.setPrototypeOf(v,m):v.__proto__=m)}function s(v,m){if(!(v instanceof m))throw new TypeError("Cannot call a class as a function")}function d(v,m){return m.right<=v.right&&m.left>=v.left&&m.top>=v.top&&m.bottom<=v.bottom}var b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(v){return typeof v}:function(v){return v&&"function"==typeof Symbol&&v.constructor===Symbol&&v!==Symbol.prototype?"symbol":typeof v};Object.defineProperty(m,"__esModule",{value:!0}),m.Underline=m.Highlight=m.Mark=m.Pane=void 0;var w=function e(v,m,y){null===v&&(v=Function.prototype);var b=Object.getOwnPropertyDescriptor(v,m);if(void 0===b){var w=Object.getPrototypeOf(v);return null===w?void 0:e(w,m,y)}if("value"in b)return b.value;var k=b.get;return void 0===k?void 0:k.call(y)},k=function(){function e(v,m){for(var y,b=0;b<m.length;b++)(y=m[b]).enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(v,y.key,y)}return function(v,m,y){return m&&e(v.prototype,m),y&&e(v,y),v}}(),x=a(y(54)),E=a(y(55)),_=(m.Pane=function(){function e(v){var m=1<arguments.length&&void 0!==arguments[1]?arguments[1]:document.body;s(this,e),this.target=v,this.element=x.default.createElement("svg"),this.marks=[],this.element.style.position="absolute",this.element.setAttribute("pointer-events","none"),E.default.proxyMouse(this.target,this.marks),this.container=m,this.container.appendChild(this.element),this.render()}return k(e,[{key:"addMark",value:function(v){var m=x.default.createElement("g");return this.element.appendChild(m),v.bind(m,this.container),this.marks.push(v),v.render(),v}},{key:"removeMark",value:function(v){var m=this.marks.indexOf(v);if(-1!==m){var y=v.unbind();this.element.removeChild(y),this.marks.splice(m,1)}}},{key:"render",value:function(){!function l(v,m){v.style.top=m.top+"px",v.style.left=m.left+"px",v.style.height=m.height+"px",v.style.width=m.width+"px"}(this.element,function r(v,m){var y=m.getBoundingClientRect(),b=v.getBoundingClientRect();return{top:b.top-y.top,left:b.left-y.left,height:v.scrollHeight,width:v.scrollWidth}}(this.target,this.container));var v=!0,m=!1,y=void 0;try{for(var b,w=this.marks[Symbol.iterator]();!(v=(b=w.next()).done);v=!0)b.value.render()}catch(v){m=!0,y=v}finally{try{!v&&w.return&&w.return()}finally{if(m)throw y}}}}]),e}(),m.Mark=function(){function e(){s(this,e),this.element=null}return k(e,[{key:"bind",value:function(v,m){this.element=v,this.container=m}},{key:"unbind",value:function(){var v=this.element;return this.element=null,v}},{key:"render",value:function(){}},{key:"dispatchEvent",value:function(v){this.element&&this.element.dispatchEvent(v)}},{key:"getBoundingClientRect",value:function(){return this.element.getBoundingClientRect()}},{key:"getClientRects",value:function(){for(var v=[],m=this.element.firstChild;m;)v.push(m.getBoundingClientRect()),m=m.nextSibling;return v}},{key:"filteredRanges",value:function(){var v=Array.from(this.range.getClientRects());return v.filter((function(m){for(var y=0;y<v.length;y++){if(v[y]===m)return!0;if(d(v[y],m))return!1}return!0}))}}]),e}()),S=m.Highlight=function(v){function t(v,m,y,b){s(this,t);var w=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return w.range=v,w.className=m,w.data=y||{},w.attributes=b||{},w}return o(t,v),k(t,[{key:"bind",value:function(v,m){for(var y in w(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"bind",this).call(this,v,m),this.data)this.data.hasOwnProperty(y)&&(this.element.dataset[y]=this.data[y]);for(var y in this.attributes)this.attributes.hasOwnProperty(y)&&this.element.setAttribute(y,this.attributes[y]);this.className&&this.element.classList.add(this.className)}},{key:"render",value:function(){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);for(var v=this.element.ownerDocument.createDocumentFragment(),m=this.filteredRanges(),y=this.element.getBoundingClientRect(),b=this.container.getBoundingClientRect(),w=0,k=m.length;w<k;w++){var E=m[w],_=x.default.createElement("rect");_.setAttribute("x",E.left-y.left+b.left),_.setAttribute("y",E.top-y.top+b.top),_.setAttribute("height",E.height),_.setAttribute("width",E.width),v.appendChild(_)}this.element.appendChild(v)}}]),t}(_);m.Underline=function(v){function t(v,m,y,b){return s(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,v,m,y,b))}return o(t,v),k(t,[{key:"render",value:function(){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);for(var v=this.element.ownerDocument.createDocumentFragment(),m=this.filteredRanges(),y=this.element.getBoundingClientRect(),b=this.container.getBoundingClientRect(),w=0,k=m.length;w<k;w++){var E=m[w],_=x.default.createElement("rect");_.setAttribute("x",E.left-y.left+b.left),_.setAttribute("y",E.top-y.top+b.top),_.setAttribute("height",E.height),_.setAttribute("width",E.width),_.setAttribute("fill","none");var S=x.default.createElement("line");S.setAttribute("x1",E.left-y.left+b.left),S.setAttribute("x2",E.left-y.left+b.left+E.width),S.setAttribute("y1",E.top-y.top+b.top+E.height-1),S.setAttribute("y2",E.top-y.top+b.top+E.height-1),S.setAttribute("stroke-width",1),S.setAttribute("stroke","black"),S.setAttribute("stroke-linecap","square"),v.appendChild(_),v.appendChild(S)}this.element.appendChild(v)}}]),t}(S)},function(v,m){"use strict";function n(v){return document.createElementNS("http://www.w3.org/2000/svg",v)}Object.defineProperty(m,"__esModule",{value:!0}),m.createElement=n,m.default={createElement:n}},function(v,m){"use strict";function n(v,m){function t(y){for(var b=m.length-1;0<=b;b--){var w=m[b],k=y.clientX,x=y.clientY;if(y.touches&&y.touches.length&&(k=y.touches[0].clientX,x=y.touches[0].clientY),o(w,v,k,x)){w.dispatchEvent(a(y));break}}}if("iframe"===v.nodeName||"IFRAME"===v.nodeName)try{this.target=v.contentDocument}catch(b){this.target=v}else this.target=v;for(var y,b=["mouseup","mousedown","click","touchstart"],w=0;w<b.length;w++)y=b[w],this.target.addEventListener(y,(function(v){return t(v)}),!1)}function a(v){var m=Object.assign({},v,{bubbles:!1});try{return new MouseEvent(v.type,m)}catch(b){var y=document.createEvent("MouseEvents");return y.initMouseEvent(v.type,!1,m.cancelable,m.view,m.detail,m.screenX,m.screenY,m.clientX,m.clientY,m.ctrlKey,m.altKey,m.shiftKey,m.metaKey,m.button,m.relatedTarget),y}}function o(v,m,y,b){function o(v,m,y){var b=v.top-w.top,k=v.left-w.left,x=b+v.height,E=k+v.width;return b<=y&&k<=m&&x>y&&E>m}var w=m.getBoundingClientRect();if(!o(v.getBoundingClientRect(),y,b))return!1;for(var k=v.getClientRects(),x=0,E=k.length;x<E;x++)if(o(k[x],y,b))return!0;return!1}Object.defineProperty(m,"__esModule",{value:!0}),m.proxyMouse=n,m.clone=a,m.default={proxyMouse:n}},function(v,m,y){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var b=function(){function e(v,m){for(var y,b=0;b<m.length;b++)(y=m[b]).enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(v,y.key,y)}return function(v,m,y){return m&&e(v.prototype,m),y&&e(v,y),v}}(),w=y(0),k=function(v){return v&&v.__esModule?v:{default:v}}(y(57)),x=function(){function e(v){(function a(v,m){if(!(v instanceof m))throw new TypeError("Cannot call a class as a function")})(this,e),this.settings=v||{},this.id="epubjs-container-"+(0,w.uuid)(),this.container=this.create(this.settings),this.settings.hidden&&(this.wrapper=this.wrap(this.container))}return b(e,[{key:"create",value:function(v){var m=v.height,y=v.width,b=v.overflow||!1,k=v.axis||"vertical",x=v.direction;v.height&&(0,w.isNumber)(v.height)&&(m=v.height+"px"),v.width&&(0,w.isNumber)(v.width)&&(y=v.width+"px");var E=document.createElement("div");return E.id=this.id,E.classList.add("epub-container"),E.style.wordSpacing="0",E.style.lineHeight="0",E.style.verticalAlign="top",E.style.position="relative","horizontal"===k&&(E.style.display="flex",E.style.flexDirection="row",E.style.flexWrap="nowrap"),y&&(E.style.width=y),m&&(E.style.height=m),b&&(E.style.overflow=b),x&&(E.dir=x,E.style.direction=x),x&&this.settings.fullsize&&(document.body.style.direction=x),E}},{key:"wrap",value:function(v){var m=document.createElement("div");return m.style.visibility="hidden",m.style.overflow="hidden",m.style.width="0",m.style.height="0",m.appendChild(v),m}},{key:"getElement",value:function(v){var m;if((0,w.isElement)(v)?m=v:"string"==typeof v&&(m=document.getElementById(v)),!m)throw new Error("Not an Element");return m}},{key:"attachTo",value:function(v){var m,y=this.getElement(v);if(y)return m=this.settings.hidden?this.wrapper:this.container,y.appendChild(m),this.element=y,y}},{key:"getContainer",value:function(){return this.container}},{key:"onResize",value:function(v){(0,w.isNumber)(this.settings.width)&&(0,w.isNumber)(this.settings.height)||(this.resizeFunc=(0,k.default)(v,50),window.addEventListener("resize",this.resizeFunc,!1))}},{key:"onOrientationChange",value:function(v){this.orientationChangeFunc=v,window.addEventListener("orientationchange",this.orientationChangeFunc,!1)}},{key:"size",value:function(v,m){var y;null===v&&((y=this.element.getBoundingClientRect()).width&&(v=y.width,this.container.style.width=y.width+"px")),null===m&&((y=y||this.element.getBoundingClientRect()).height&&(m=y.height,this.container.style.height=y.height+"px")),(0,w.isNumber)(v)||(v=(y=this.container.getBoundingClientRect()).width),(0,w.isNumber)(m)||(m=(y=y||this.container.getBoundingClientRect()).height),this.containerStyles=window.getComputedStyle(this.container),this.containerPadding={left:parseFloat(this.containerStyles["padding-left"])||0,right:parseFloat(this.containerStyles["padding-right"])||0,top:parseFloat(this.containerStyles["padding-top"])||0,bottom:parseFloat(this.containerStyles["padding-bottom"])||0};var b=(0,w.windowBounds)();return v||(v=b.width),(this.settings.fullsize||!m)&&(m=b.height),{width:v-this.containerPadding.left-this.containerPadding.right,height:m-this.containerPadding.top-this.containerPadding.bottom}}},{key:"bounds",value:function(){var v;return"visible"!==this.container.style.overflow&&(v=this.container&&this.container.getBoundingClientRect()),v&&v.width&&v.height?v:(0,w.windowBounds)()}},{key:"getSheet",value:function(){var v=document.createElement("style");return v.appendChild(document.createTextNode("")),document.head.appendChild(v),v.sheet}},{key:"addStyleRules",value:function(v,m){var y="#"+this.id+" ",b="";this.sheet||(this.sheet=this.getSheet()),m.forEach((function(v){for(var m in v)v.hasOwnProperty(m)&&(b+=m+":"+v[m]+";")})),this.sheet.insertRule(y+v+" {"+b+"}",0)}},{key:"axis",value:function(v){"horizontal"===v?(this.container.style.display="flex",this.container.style.flexDirection="row",this.container.style.flexWrap="nowrap"):this.container.style.display="block"}},{key:"direction",value:function(v){this.container&&(this.container.dir=v,this.container.style.direction=v),this.settings.fullsize&&(document.body.style.direction=v)}},{key:"destroy",value:function(){this.element&&(this.settings.hidden?this.wrapper:this.container,this.element.contains(this.container)&&this.element.removeChild(this.container),window.removeEventListener("resize",this.resizeFunc),window.removeEventListener("orientationChange",this.orientationChangeFunc))}}]),e}();m.default=x,v.exports=m.default},function(v,m,y){var b=y(21),w=y(15);v.exports=function(v,m,y){var k=!0,x=!0;if("function"!=typeof v)throw new TypeError("Expected a function");return w(y)&&(k="leading"in y?!!y.leading:k,x="trailing"in y?!!y.trailing:x),b(v,m,{leading:k,maxWait:m,trailing:x})}},function(v,m,y){var b=y(22);v.exports=function(){return b.Date.now()}},function(v,m,y){(function(m){var y="object"==typeof m&&m&&m.Object===Object&&m;v.exports=y}).call(m,y(8))},function(v,m,y){var b=y(15),w=y(61),k=/^\s+|\s+$/g,x=/^[-+]0x[0-9a-f]+$/i,E=/^0b[01]+$/i,_=/^0o[0-7]+$/i,S=parseInt;v.exports=function(v){if("number"==typeof v)return v;if(w(v))return NaN;if(b(v)){var m="function"==typeof v.valueOf?v.valueOf():v;v=b(m)?m+"":m}if("string"!=typeof v)return 0===v?v:+v;v=v.replace(k,"");var y=E.test(v);return y||_.test(v)?S(v.slice(2),y?2:8):x.test(v)?NaN:+v}},function(v,m,y){var b=y(62),w=y(65);v.exports=function(v){return"symbol"==typeof v||w(v)&&"[object Symbol]"==b(v)}},function(v,m,y){var b=y(23),w=y(63),k=y(64),x=b?b.toStringTag:void 0;v.exports=function(v){return null==v?void 0===v?"[object Undefined]":"[object Null]":x&&x in Object(v)?w(v):k(v)}},function(v,m,y){var b=y(23),w=Object.prototype,k=w.hasOwnProperty,x=w.toString,E=b?b.toStringTag:void 0;v.exports=function(v){var m=k.call(v,E),y=v[E];try{v[E]=void 0}catch(m){}var b=x.call(v);return m?v[E]=y:delete v[E],b}},function(v){var m=Object.prototype.toString;v.exports=function(v){return m.call(v)}},function(v){v.exports=function(v){return null!=v&&"object"==typeof v}},function(v,m){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var y=function(){function e(v,m){for(var y,b=0;b<m.length;b++)(y=m[b]).enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(v,y.key,y)}return function(v,m,y){return m&&e(v.prototype,m),y&&e(v,y),v}}(),b=function(){function e(v){(function n(v,m){if(!(v instanceof m))throw new TypeError("Cannot call a class as a function")})(this,e),this.container=v,this._views=[],this.length=0,this.hidden=!1}return y(e,[{key:"all",value:function(){return this._views}},{key:"first",value:function(){return this._views[0]}},{key:"last",value:function(){return this._views[this._views.length-1]}},{key:"indexOf",value:function(v){return this._views.indexOf(v)}},{key:"slice",value:function(){return this._views.slice.apply(this._views,arguments)}},{key:"get",value:function(v){return this._views[v]}},{key:"append",value:function(v){return this._views.push(v),this.container&&this.container.appendChild(v.element),this.length++,v}},{key:"prepend",value:function(v){return this._views.unshift(v),this.container&&this.container.insertBefore(v.element,this.container.firstChild),this.length++,v}},{key:"insert",value:function(v,m){return this._views.splice(m,0,v),this.container&&(m<this.container.children.length?this.container.insertBefore(v.element,this.container.children[m]):this.container.appendChild(v.element)),this.length++,v}},{key:"remove",value:function(v){var m=this._views.indexOf(v);-1<m&&this._views.splice(m,1),this.destroy(v),this.length--}},{key:"destroy",value:function(v){v.displayed&&v.destroy(),this.container&&this.container.removeChild(v.element),v=null}},{key:"forEach",value:function(){return this._views.forEach.apply(this._views,arguments)}},{key:"clear",value:function(){var v,m=this.length;if(this.length){for(var y=0;y<m;y++)v=this._views[y],this.destroy(v);this._views=[],this.length=0}}},{key:"find",value:function(v){for(var m,y=this.length,b=0;b<y;b++)if((m=this._views[b]).displayed&&m.section.index==v.index)return m}},{key:"displayed",value:function(){for(var v,m=[],y=this.length,b=0;b<y;b++)(v=this._views[b]).displayed&&m.push(v);return m}},{key:"show",value:function(){for(var v,m=this.length,y=0;y<m;y++)(v=this._views[y]).displayed&&v.show();this.hidden=!1}},{key:"hide",value:function(){for(var v,m=this.length,y=0;y<m;y++)(v=this._views[y]).displayed&&v.hide();this.hidden=!0}}]),e}();m.default=b,v.exports=m.default},function(v,m,y){"use strict";function a(v){return v&&v.__esModule?v:{default:v}}Object.defineProperty(m,"__esModule",{value:!0});var b=function(){function e(v,m){for(var y,b=0;b<m.length;b++)(y=m[b]).enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(v,y.key,y)}return function(v,m,y){return m&&e(v.prototype,m),y&&e(v,y),v}}(),w=y(0),k=a(y(11)),x=a(y(17)),E=a(y(4)),_=function(){function e(){(function i(v,m){if(!(v instanceof m))throw new TypeError("Cannot call a class as a function")})(this,e),this.zip=void 0,this.urlCache={},this.checkRequirements()}return b(e,[{key:"checkRequirements",value:function(){try{if("undefined"==typeof JSZip){var v=y(68);this.zip=new v}else this.zip=new JSZip}catch(v){throw new Error("JSZip lib not loaded")}}},{key:"open",value:function(v,m){return this.zip.loadAsync(v,{base64:m})}},{key:"openUrl",value:function(v,m){return(0,k.default)(v,"binary").then(function(v){return this.zip.loadAsync(v,{base64:m})}.bind(this))}},{key:"request",value:function(v,m){var y,b=new w.defer,k=new E.default(v);return m||(m=k.extension),(y="blob"==m?this.getBlob(v):this.getText(v))?y.then(function(v){var y=this.handleResponse(v,m);b.resolve(y)}.bind(this)):b.reject({message:"File not found in the epub: "+v,stack:(new Error).stack}),b.promise}},{key:"handleResponse",value:function(v,m){return"json"==m?JSON.parse(v):(0,w.isXml)(m)?(0,w.parse)(v,"text/xml"):"xhtml"==m?(0,w.parse)(v,"application/xhtml+xml"):"html"==m||"htm"==m?(0,w.parse)(v,"text/html"):v}},{key:"getBlob",value:function(v,m){var y=window.decodeURIComponent(v.substr(1)),b=this.zip.file(y);if(b)return m=m||x.default.lookup(b.name),b.async("uint8array").then((function(v){return new Blob([v],{type:m})}))}},{key:"getText",value:function(v){var m=window.decodeURIComponent(v.substr(1)),y=this.zip.file(m);if(y)return y.async("string").then((function(v){return v}))}},{key:"getBase64",value:function(v,m){var y=window.decodeURIComponent(v.substr(1)),b=this.zip.file(y);if(b)return m=m||x.default.lookup(b.name),b.async("base64").then((function(v){return"data:"+m+";base64,"+v}))}},{key:"createUrl",value:function(v,m){var y,b,k=new w.defer,x=window.URL||window.webkitURL||window.mozURL,E=m&&m.base64;return v in this.urlCache?(k.resolve(this.urlCache[v]),k.promise):(E?(b=this.getBase64(v))&&b.then(function(m){this.urlCache[v]=m,k.resolve(m)}.bind(this)):(b=this.getBlob(v))&&b.then(function(m){y=x.createObjectURL(m),this.urlCache[v]=y,k.resolve(y)}.bind(this)),b||k.reject({message:"File not found in the epub: "+v,stack:(new Error).stack}),k.promise)}},{key:"revokeUrl",value:function(v){var m=window.URL||window.webkitURL||window.mozURL,y=this.urlCache[v];y&&m.revokeObjectURL(y)}},{key:"destroy",value:function(){var v=window.URL||window.webkitURL||window.mozURL;for(var m in this.urlCache)v.revokeObjectURL(m);this.zip=void 0,this.urlCache={}}}]),e}();m.default=_,v.exports=m.default},function(v){if(void 0===m){var y=new Error('Cannot find module "jszip"');throw y.code="MODULE_NOT_FOUND",y}v.exports=m},function(v,m,y){"use strict";(function(v,y){var b,w,k,x,E,_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(v){return typeof v}:function(v){return v&&"function"==typeof Symbol&&v.constructor===Symbol&&v!==Symbol.prototype?"symbol":typeof v};E=function(v){function t(v){return void 0!==b[v]}function n(){r.call(this),this._isInvalid=!0}function a(v){return""==v&&n.call(this),v.toLowerCase()}function o(v){var m=v.charCodeAt(0);return 32<m&&127>m&&-1==[34,35,60,62,63,96].indexOf(m)?v:encodeURIComponent(v)}function s(v){var m=v.charCodeAt(0);return 32<m&&127>m&&-1==[34,35,60,62,96].indexOf(m)?v:encodeURIComponent(v)}function i(v,m,y){function d(v){O.push(v)}var _=m||"scheme start",S=0,C="",T=!1,N=!1,O=[];t:for(;(v[S-1]!=k||0==S)&&!this._isInvalid;){var R=v[S];switch(_){case"scheme start":if(!R||!x.test(R)){if(m){d("Invalid scheme.");break t}C="",_="no scheme";continue}C+=R.toLowerCase(),_="scheme";break;case"scheme":if(R&&E.test(R))C+=R.toLowerCase();else{if(":"!=R){if(m){if(k==R)break t;d("Code point not allowed in scheme: "+R);break t}C="",S=0,_="no scheme";continue}if(this._scheme=C,C="",m)break t;t(this._scheme)&&(this._isRelative=!0),_="file"==this._scheme?"relative":this._isRelative&&y&&y._scheme==this._scheme?"relative or authority":this._isRelative?"authority first slash":"scheme data"}break;case"scheme data":"?"==R?(this._query="?",_="query"):"#"==R?(this._fragment="#",_="fragment"):k!=R&&"\t"!=R&&"\n"!=R&&"\r"!=R&&(this._schemeData+=o(R));break;case"no scheme":if(y&&t(y._scheme)){_="relative";continue}d("Missing scheme."),n.call(this);break;case"relative or authority":if("/"!=R||"/"!=v[S+1]){d("Expected /, got: "+R),_="relative";continue}_="authority ignore slashes";break;case"relative":if(this._isRelative=!0,"file"!=this._scheme&&(this._scheme=y._scheme),k==R){this._host=y._host,this._port=y._port,this._path=y._path.slice(),this._query=y._query,this._username=y._username,this._password=y._password;break t}if("/"==R||"\\"==R)"\\"==R&&d("\\ is an invalid code point."),_="relative slash";else if("?"==R)this._host=y._host,this._port=y._port,this._path=y._path.slice(),this._query="?",this._username=y._username,this._password=y._password,_="query";else{if("#"!=R){var L=v[S+1],P=v[S+2];"file"==this._scheme&&x.test(R)&&(":"==L||"|"==L)&&(k==P||"/"==P||"\\"==P||"?"==P||"#"==P)||(this._host=y._host,this._port=y._port,this._username=y._username,this._password=y._password,this._path=y._path.slice(),this._path.pop()),_="relative path";continue}this._host=y._host,this._port=y._port,this._path=y._path.slice(),this._query=y._query,this._fragment="#",this._username=y._username,this._password=y._password,_="fragment"}break;case"relative slash":if("/"!=R&&"\\"!=R){"file"!=this._scheme&&(this._host=y._host,this._port=y._port,this._username=y._username,this._password=y._password),_="relative path";continue}"\\"==R&&d("\\ is an invalid code point."),_="file"==this._scheme?"file host":"authority ignore slashes";break;case"authority first slash":if("/"!=R){d("Expected '/', got: "+R),_="authority ignore slashes";continue}_="authority second slash";break;case"authority second slash":if(_="authority ignore slashes","/"!=R){d("Expected '/', got: "+R);continue}break;case"authority ignore slashes":if("/"!=R&&"\\"!=R){_="authority";continue}d("Expected authority, got: "+R);break;case"authority":if("@"==R){T&&(d("@ already seen."),C+="%40"),T=!0;for(var A,j=0;j<C.length;j++)if("\t"!=(A=C[j])&&"\n"!=A&&"\r"!=A)if(":"!=A||null!==this._password){var I=o(A);null===this._password?this._username+=I:this._password+=I}else this._password="";else d("Invalid whitespace in authority.");C=""}else{if(k==R||"/"==R||"\\"==R||"?"==R||"#"==R){S-=C.length,C="",_="host";continue}C+=R}break;case"file host":if(k==R||"/"==R||"\\"==R||"?"==R||"#"==R){2!=C.length||!x.test(C[0])||":"!=C[1]&&"|"!=C[1]?(0==C.length||(this._host=a.call(this,C),C=""),_="relative path start"):_="relative path";continue}"\t"==R||"\n"==R||"\r"==R?d("Invalid whitespace in file host."):C+=R;break;case"host":case"hostname":if(":"!=R||N){if(k==R||"/"==R||"\\"==R||"?"==R||"#"==R){if(this._host=a.call(this,C),C="",_="relative path start",m)break t;continue}"\t"!=R&&"\n"!=R&&"\r"!=R?("["==R?N=!0:"]"==R&&(N=!1),C+=R):d("Invalid code point in host/hostname: "+R)}else if(this._host=a.call(this,C),C="",_="port","hostname"==m)break t;break;case"port":if(/[0-9]/.test(R))C+=R;else{if(k==R||"/"==R||"\\"==R||"?"==R||"#"==R||m){if(""!=C){var z=parseInt(C,10);z!=b[this._scheme]&&(this._port=z+""),C=""}if(m)break t;_="relative path start";continue}"\t"==R||"\n"==R||"\r"==R?d("Invalid code point in port: "+R):n.call(this)}break;case"relative path start":if("\\"==R&&d("'\\' not allowed in path."),_="relative path","/"!=R&&"\\"!=R)continue;break;case"relative path":var q;k!=R&&"/"!=R&&"\\"!=R&&(m||"?"!=R&&"#"!=R)?"\t"!=R&&"\n"!=R&&"\r"!=R&&(C+=o(R)):("\\"==R&&d("\\ not allowed in relative path."),(q=w[C.toLowerCase()])&&(C=q),".."==C?(this._path.pop(),"/"!=R&&"\\"!=R&&this._path.push("")):"."==C&&"/"!=R&&"\\"!=R?this._path.push(""):"."!=C&&("file"==this._scheme&&0==this._path.length&&2==C.length&&x.test(C[0])&&"|"==C[1]&&(C=C[0]+":"),this._path.push(C)),C="","?"==R?(this._query="?",_="query"):"#"==R&&(this._fragment="#",_="fragment"));break;case"query":m||"#"!=R?k!=R&&"\t"!=R&&"\n"!=R&&"\r"!=R&&(this._query+=s(R)):(this._fragment="#",_="fragment");break;case"fragment":k!=R&&"\t"!=R&&"\n"!=R&&"\r"!=R&&(this._fragment+=R)}S++}}function r(){this._scheme="",this._schemeData="",this._username="",this._password=null,this._host="",this._port="",this._path=[],this._query="",this._fragment="",this._isInvalid=!1,this._isRelative=!1}function l(v,m){void 0===m||m instanceof l||(m=new l(m+"")),this._url=v,r.call(this);var y=v.replace(/^[ \t\r\n\f]+|[ \t\r\n\f]+$/g,"");i.call(this,y,null,m)}var m=!1;if(!v.forceJURL)try{var y=new URL("b","http://a");y.pathname="c%20d",m="http://a/c%20d"===y.href}catch(t){}if(m)return v.URL;var b=Object.create(null);b.ftp=21,b.file=0,b.gopher=70,b.http=80,b.https=443,b.ws=80,b.wss=443;var w=Object.create(null);w["%2e"]=".",w[".%2e"]="..",w["%2e."]="..",w["%2e%2e"]="..";var k,x=/[a-zA-Z]/,E=/[a-zA-Z0-9\+\-\.]/;l.prototype={toString:function(){return this.href},get href(){if(this._isInvalid)return this._url;var v="";return(""!=this._username||null!=this._password)&&(v=this._username+(null==this._password?"":":"+this._password)+"@"),this.protocol+(this._isRelative?"//"+v+this.host:"")+this.pathname+this._query+this._fragment},set href(v){r.call(this),i.call(this,v)},get protocol(){return this._scheme+":"},set protocol(v){this._isInvalid||i.call(this,v+":","scheme start")},get host(){return this._isInvalid?"":this._port?this._host+":"+this._port:this._host},set host(v){this._isInvalid||!this._isRelative||i.call(this,v,"host")},get hostname(){return this._host},set hostname(v){this._isInvalid||!this._isRelative||i.call(this,v,"hostname")},get port(){return this._port},set port(v){this._isInvalid||!this._isRelative||i.call(this,v,"port")},get pathname(){return this._isInvalid?"":this._isRelative?"/"+this._path.join("/"):this._schemeData},set pathname(v){this._isInvalid||!this._isRelative||(this._path=[],i.call(this,v,"relative path start"))},get search(){return this._isInvalid||!this._query||"?"==this._query?"":this._query},set search(v){this._isInvalid||!this._isRelative||(this._query="?","?"==v[0]&&(v=v.slice(1)),i.call(this,v,"query"))},get hash(){return this._isInvalid||!this._fragment||"#"==this._fragment?"":this._fragment},set hash(v){this._isInvalid||(this._fragment="#","#"==v[0]&&(v=v.slice(1)),i.call(this,v,"fragment"))},get origin(){var v;if(this._isInvalid||!this._scheme)return"";switch(this._scheme){case"file":return"file://";case"data":case"javascript":case"mailto":return"null"}return(v=this.host)?this._scheme+"://"+v:""}};var _=v.URL;return _&&(l.createObjectURL=function(){return _.createObjectURL.apply(_,arguments)},l.revokeObjectURL=function(v){_.revokeObjectURL(v)}),l},(x=void 0)||(x=window||v),"object"===_(y)&&y.exports?y.exports=E(x):(w=[],void 0===(k="function"==typeof(b=E)?b.apply(m,w):b)||(y.exports=k))}).call(m,y(8),y(70)(v))},function(v){v.exports=function(v){return v.webpackPolyfill||(v.deprecate=function(){},v.paths=[],!v.children&&(v.children=[]),Object.defineProperty(v,"loaded",{enumerable:!0,get:function(){return v.l}}),Object.defineProperty(v,"id",{enumerable:!0,get:function(){return v.i}}),v.webpackPolyfill=1),v}}])}));