var CalculateApp={elements:{resultsZoneDiv:void 0,calcInputDiv:void 0,calcInput:void 0,labelInput:void 0,modalDiv:void 0},libs:{mustache:void 0,functionPlot:void 0},data:{buddyColor:{stroke:"#1500A7",fill:"#ff0000"},calculations:[],windowWidth:void 0,windowHeight:void 0,isMobile:/iphone|ipod|ipad|android|blackberry|opera mini|opera mobi|skyfire|maemo|windows phone|palm|iemobile|symbian|symbianos|fennec/i.test(navigator.userAgent.toLowerCase()),isIos:!!navigator.userAgent.match(/iPad|iPhone|iPod/g),outputBase:10,outputDigits:6,isRadian:!1,pi:3.141592653589793},isFullMode:function fullModeEval(){return"undefined"==typeof chrome||!chrome.app||!chrome.app.runtime}(),evalParser:function(a){return Parser.parse(a).evaluate()},evalMathJS:function(a){return mathjs.eval(a)},eval:function(a){var e,t;return CalculateApp.isFullMode?(e=CalculateApp.evalMathJS(a),t=CalculateApp.baseConv(CalculateApp.evalMathJS(a),CalculateApp.data.outputBase,10)):(e=CalculateApp.evalParser(a),t=CalculateApp.baseConv(CalculateApp.evalParser(a),CalculateApp.data.outputBase,10)),{resultBase10:CalculateApp.toFixed(e,CalculateApp.data.outputDigits),result:CalculateApp.toFixed(t,CalculateApp.data.outputDigits)}},evalFunctionAtZero:function(a){var e;if(CalculateApp.isFullMode)try{return e=mathjs.eval(a)(0),isNaN(e)||!isFinite(e)?0:e}catch(a){return 0}else try{return e=Parser.parse(a).evaluate({x:0}),isNaN(e)||!isFinite(e)?0:e}catch(a){return 0}},isGraph:function(a){return-1!=a.indexOf("f(x)")},_graph:function(a,e,t){nanoModal(CalculateApp.elements.modalDiv,{buttons:[]}).onShow((function(a){CalculateApp.elements.modalDiv.style.display="block",CalculateApp.elements.modalDiv.style.marginLeft="auto",CalculateApp.elements.modalDiv.style.marginRight="auto",CalculateApp.elements.modalDiv.style.height=parseInt(80*CalculateApp.data.windowHeight/100)+"px",CalculateApp.elements.modalDiv.style.width=parseInt(80*CalculateApp.data.windowWidth/100)+"px";try{CalculateApp.libs.functionPlot({target:"#plot",yDomain:[e-10,e+10],xDomain:[-10,10],width:parseInt(80*CalculateApp.data.windowWidth/100),height:parseInt(80*CalculateApp.data.windowHeight/100),data:[{fn:t}]});for(var l=0;l<10;l++)window.scroll(0,0)}catch(e){a.hide()}})).onHide((function(a){a.remove(),setTimeout((function(){CalculateApp.focus()}),300)})).show()},graphParser:function(a){var e=CalculateApp.evalFunctionAtZero(a);CalculateApp._graph(a,e,(function(e){return Parser.parse(a).evaluate({x:e})}))},graphMathJS:function(a){var e=CalculateApp.evalFunctionAtZero(a),t=mathjs.eval(a);CalculateApp._graph(a,e,t)},graph:function(a){return a=CalculateApp.tryPatchGraphEquation(a),CalculateApp.isFullMode?CalculateApp.graphMathJS(a):CalculateApp.graphParser(a)},displayCalculation:function(a){var e=document.createElement("div");if(a.error)e.innerHTML=CalculateApp.libs.mustache.render(getErrorTemplate(),a);else if(a.graph){try{e.innerHTML=CalculateApp.libs.mustache.render(getGraphTemplate(),a)}catch(t){a.error=t.message,e.innerHTML=CalculateApp.libs.mustache.render(getErrorTemplate(),a),CalculateApp.elements.calcInput.value=""}for(var t=e.childNodes[0].childNodes,functionGraph=function(a){CalculateApp.graph(a.target.value)},l=0;l<t.length;l++)"BUTTON"===t[l].tagName&&t[l].addEventListener("click",functionGraph)}else try{e.innerHTML=CalculateApp.libs.mustache.render(getResultTemplate(),a)}catch(t){a.error=t.message,e.innerHTML=CalculateApp.libs.mustache.render(getErrorTemplate(),a),CalculateApp.elements.calcInput.value=""}CalculateApp.elements.resultsZoneDiv.insertBefore(e,CalculateApp.elements.resultsZoneDiv.childNodes[0])},storeCalculation:function(a){null===CalculateApp.data.calculations&&(CalculateApp.data.calculations=[]),CalculateApp.data.calculations.push(a)},persistCalculations:function(){for(var a=[],e=CalculateApp.data.calculations.length-1;e>=0&&!(a.length>=20);e--)a.unshift(CalculateApp.data.calculations[e]);var t=JSON.stringify(a);CalculateApp.libs.activity.getDatastoreObject().setDataAsText(t),CalculateApp.libs.activity.getDatastoreObject().save((function(){}))},baseConv:function(a,e,t){return e==t?a:parseInt(a,t||10).toString(e)},onResize:function(){CalculateApp.data.windowHeight=getWindowHeight(),CalculateApp.data.windowWidth=getWindowWidth(),setTimeout((function(){CalculateApp.elements.resultsZoneDiv.style.height=CalculateApp.elements.calcInputDiv.clientHeight+"px",CalculateApp.elements.resultsZoneDiv.style.display="block"}),300)},focus:function(){CalculateApp.data.isMobile||CalculateApp.elements.calcInput.focus()},translateGui:function(){void 0!==CalculateApp.libs.l10n.get("calcul")&&CalculateApp.libs.l10n.get("calcul").length>0&&(CalculateApp.elements.calcInput.placeholder=CalculateApp.libs.l10n.get("calcul")),void 0!==CalculateApp.libs.l10n.get("label")&&CalculateApp.libs.l10n.get("label").length>0&&(CalculateApp.elements.labelInput.placeholder=CalculateApp.libs.l10n.get("label")),void 0!==CalculateApp.libs.l10n.get("clear")&&CalculateApp.libs.l10n.get("clear").length>0&&(CalculateApp.elements.calcButtonClear.innerHTML=CalculateApp.libs.l10n.get("clear"))},displayAllCalculations:function(){for(;CalculateApp.elements.resultsZoneDiv.firstChild;)CalculateApp.elements.resultsZoneDiv.removeChild(CalculateApp.elements.resultsZoneDiv.firstChild);if(null!==CalculateApp.data.calculations)for(var a=0;a<CalculateApp.data.calculations.length;a++)CalculateApp.displayCalculation(CalculateApp.data.calculations[a])},tryPatchEquation:function(a){if(CalculateApp.data.isRadian)return a;for(var e=["cos","sin","tan","cosh","sinh","tanh"],t=0;t<e.length;t++){var l=new RegExp(e[t]+"\\((.+?)\\)","gi"),n=a.match(l),i=a.search(l);if(n)for(var p=0;p<n.length;p++){if(i>0&&"a"===a[i-1])if(1!==i){for(var u=1,c=0;u;)"("===a[i+4+c]?u++:")"===a[i+4+c]&&u--,c++;a=a.substr(0,i-1)+" ( 180 / "+CalculateApp.data.pi+" * "+a.substr(i-1,4+c)+" ) "+a.substr(i+3+c)}else a=" 180 / "+CalculateApp.data.pi+" * "+a.substr(i-1);else{var r=new RegExp("\\(([^\\)]+)\\)","gi").exec(n[p]);r&&r.length>=2&&(a=a.replace(r[1],r[1]+" * "+CalculateApp.data.pi+" / 180"))}i=a.substr(i+1).search(l)}}return a},tryPatchGraphEquation:function(a){return CalculateApp.isFullMode||(a=a.replace("f(x)=","")),a},toFixed:function(a,e){if(isNaN(a)||Number(a)===a&&a%1==0)return a;var t=Math.pow(10,e||0);return String(Math.round(a*t)/t)}};