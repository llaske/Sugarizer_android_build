requirejs.config({baseUrl:"lib",paths:{activity:"../js"}});var app=new Vue({el:"#app",components:{"template-selection":TemplateSelection,"categories-grid":CategoriesGrid,"skills-grid":SkillsGrid,"skill-details":SkillDetails,"category-settings":CategorySettings,"skill-settings":SkillSettings,rewards:Rewards,export:Export},data:{currentenv:null,sharedInstance:!1,settings:!1,rewardsInit:!1,rewardsActive:!1,exporting:"",currentView:"categories-grid",searchText:"",templateTitle:"",templateImage:"",notationLevel:1,categories:[],selectedCategoryId:null,selectedSkillId:null,user:{skills:{}},levels:{1:[{grade:"",textVariable:"LevelNotAcquired",text:"",colors:{fill:"#FFFFFF",stroke:"#838383"}},{grade:"",textVariable:"LevelAcquired",text:"",colors:{fill:"#02F000",stroke:"#0B7000"}}],2:[{grade:"C",textVariable:"LevelNotAcquired",text:"",colors:{fill:"#FF542C",stroke:"#700000"}},{grade:"B",textVariable:"LevelPartiallyAcquired",text:"",colors:{fill:"#FFC72C",stroke:"#705D00"}},{grade:"A",textVariable:"LevelAcquired",text:"",colors:{fill:"#02F000",stroke:"#0B7000"}}],3:[{grade:"C",textVariable:"LevelNotAcquired",text:"",colors:{fill:"#FF542C",stroke:"#700000"}},{grade:"B",textVariable:"LevelPartiallyAcquired",text:"",colors:{fill:"#FFC72C",stroke:"#705D00"}},{grade:"A",textVariable:"LevelAcquired",text:"",colors:{fill:"#98FF5D",stroke:"#10A600"}},{grade:"A+",textVariable:"LevelExceeded",text:"",colors:{fill:"#02F000",stroke:"#0B7000"}}],4:[{grade:"X",textVariable:"LevelNotEvaluated",text:"",colors:{fill:"#FFFFFF",stroke:"#838383"}},{grade:"C",textVariable:"LevelNotAcquired",text:"",colors:{fill:"#FF542C",stroke:"#700000"}},{grade:"B",textVariable:"LevelPartiallyAcquired",text:"",colors:{fill:"#FFC72C",stroke:"#705D00"}},{grade:"A",textVariable:"LevelAcquired",text:"",colors:{fill:"#98FF5D",stroke:"#10A600"}},{grade:"A+",textVariable:"LevelExceeded",text:"",colors:{fill:"#02F000",stroke:"#0B7000"}}]},achievements:[{id:0,title:"Achievement0",info:{icon:"medal-unacquired.svg",text:"#1"},availability:!0,condition:{property:"this[totalSkillsAcquired]",op:">=",value:1}},{id:1,title:"Achievement1",info:{icon:"medal-unacquired.svg",text:"50%"},availability:!0,condition:{property:"this[totalSkillsAcquired]",op:">=",value:{property:"this[totalSkills]",op:"/",value:2}}},{id:2,title:"Achievement2",info:{icon:"medal-unacquired.svg",text:"100%"},availability:!0,condition:{property:"this[totalSkillsAcquired]",op:"==",value:{property:"this[totalSkills]"}}},{id:3,title:"Achievement3",info:{icon:"home.svg",text:"#1"},availability:!0,condition:{property:"this[totalCategoriesAcquired]",op:">=",value:1}},{id:4,title:"Achievement4",info:{icon:"home.svg",text:"100%"},availability:!0,condition:{property:"this[totalCategoriesAcquired]",op:"==",value:{property:"this[totalCategories]"}}},{id:5,title:"Achievement5",info:{icon:"insert-picture.svg",text:"#1"},availability:!0,condition:{property:"this[totalMediaUploaded]",op:">=",value:1}},{id:6,title:"Achievement6",info:{icon:"insert-picture.svg",text:"#10"},availability:!0,condition:{property:"this[totalMediaUploaded]",op:">=",value:10}},{id:7,title:"Achievement7",info:{icon:"medal-unacquired.svg",text:"A+"},availability:{property:"this[notationLevel]",op:">=",value:3},condition:{property:"this[levelWiseAcquired][this[notationLevel]]",op:">=",value:1}}],SugarPresence:null,l10n:{stringCategory:"",stringSkill:"",stringSearch:"",stringCategories:"",stringSettings:"",stringAdd:"",stringAcquire:"",stringUploadMedia:"",stringExport:"",stringFullscreen:"",stringUnfullscreen:"",stringUploadSkill:"",stringLevelNotEvaluated:"",stringLevelAcquired:"",stringLevelNotAcquired:"",stringLevelPartiallyAcquired:"",stringLevelExceeded:"",stringTutoTrophyCardTitle:"",stringTutoTrophyCardContent:"",stringTutoSettingsCategoryCardTitle:"",stringTutoSettingsCategoryCardContent:"",stringTutoSettingsSkillCardTitle:"",stringTutoSettingsSkillCardContent:"",stringTutoSettingsEditButtonTitle:"",stringTutoSettingsEditButtonContent:"",stringTutoSettingsDeleteButtonTitle:"",stringTutoSettingsDeleteButtonContent:"",stringTutoSettingsNotationButtonTitle:"",stringTutoSettingsNotationButtonContent:"",stringTutoSettingsAddButtonTitle:"",stringTutoSettingsAddButtonContent:"",stringTutoExplainTitle:"",stringTutoExplainContent:"",stringTutoTemplateSelectionTitle:"",stringTutoTemplateSelectionContent:"",stringTutoTemplateTitle:"",stringTutoTemplateContent:"",stringTutoAddTemplateTitle:"",stringTutoAddTemplateContent:"",stringTutoCategoryCardTitle:"",stringTutoCategoryCardContent:"",stringTutoCategorySkillsTitle:"",stringTutoCategorySkillsContent:"",stringTutoCategoryProgressTitle:"",stringTutoCategoryProgressContent:"",stringTutoCategorySearchTitle:"",stringTutoCategorySearchContent:"",stringTutoRewardsButtonTitle:"",stringTutoRewardsButtonContent:"",stringTutoSettingsButtonTitle:"",stringTutoSettingsButtonContent:"",stringTutoExportButtonTitle:"",stringTutoExportButtonContent:"",stringTutoNetworkButtonTitle:"",stringTutoNetworkButtonContent:"",stringTutoSkillCardTitle:"",stringTutoSkillCardContent:"",stringTutoHomeButtonTitle:"",stringTutoHomeButtonContent:"",stringTutoSkillSearchTitle:"",stringTutoSkillSearchContent:"",stringTutoSkillUploadsTitle:"",stringTutoSkillUploadsContent:"",stringTutoAcquireButtonTitle:"",stringTutoAcquireButtonContent:"",stringTutoUploadButtonTitle:"",stringTutoUploadButtonContent:"",stringTutoUploadedItemTitle:"",stringTutoUploadedItemContent:""}},watch:{currentView:function(t,e){for(var i of(setTimeout((function(){content.scrollTo(0,0)}),200),document.getElementsByClassName("palette")))i.style.visibility="hidden";this.searchText=""},settings:function(t,e){this.SugarPresence.isShared()&&this.SugarPresence.sendMessage({user:this.SugarPresence.getUserInfo(),content:{action:"updateCategories",data:{categories:this.categories}}})},notationLevel:function(t,e){var i=document.getElementById("notation-selector").children;for(var n of i)n.id.substr(6)==t?n.classList.add("active"):n.classList.remove("active");this.SugarPresence.isShared()&&this.SugarPresence.sendMessage({user:this.SugarPresence.getUserInfo(),content:{action:"updateNotation",data:{notationLevel:t}}})},l10n:function(t,e){this.$refs.SugarL10n.localize(this.l10n);var i=this;this.categories.forEach((function(t){i.l10n["string"+t.title]&&(t.title=i.l10n["string"+t.title]),t.skills.forEach((function(t){i.l10n["string"+t.title]&&(t.title=i.l10n["string"+t.title])}))}))}},computed:{currentAcquired:function(){return null!=this.selectedCategoryId&&null!=this.selectedSkillId?this.user.skills[this.selectedCategoryId][this.selectedSkillId].acquired:0},searchQuery:function(){return this.searchText.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}},mounted:function(){this.SugarPresence=this.$refs.SugarPresence},methods:{initialized:function(){this.currentenv=this.$refs.SugarActivity.getEnvironment()},localized:function(){let t=this;this.addTitlesToL10n(this.achievements),this.$refs.SugarL10n.localize(this.l10n),this.achievements.forEach((function(e){e.title=t.$refs.SugarL10n.get(e.title)}));for(let t of this.achievements)t.title=this.$refs.SugarL10n.get(t.title);for(let t in this.levels)for(let e in this.levels[t])this.levels[t][e].text=this.$refs.SugarL10n.get(this.levels[t][e].textVariable)},openCategory:function(t){this.selectedCategoryId=t,this.selectedSkillId=null,this.currentView="skills-grid"},openSkill:function(t,e){this.selectedCategoryId=t,this.selectedSkillId=e,this.currentView="skill-details"},editCategory:function(t){this.selectedCategoryId=t,this.selectedSkillId=null,this.currentView="category-settings"},editSkill:function(t,e){this.selectedCategoryId=t,this.selectedSkillId=e,this.currentView="skill-settings"},switchSkillLevel:function(){if(!this.sharedInstance){var t=this.user.skills[this.selectedCategoryId][this.selectedSkillId],e=t.acquired;e=(e+1)%(this.notationLevel+1),t.acquired=e,"LevelAcquired"==this.levels[this.notationLevel][e].textVariable||"LevelExceeded"==this.levels[this.notationLevel][e].textVariable?t.timestamp=Date.now():t.timestamp=null,this.SugarPresence.isShared()&&this.SugarPresence.sendMessage({user:this.SugarPresence.getUserInfo(),content:{action:"updateUser",data:{user:this.user}}})}},onUploadItem:function(t){var e,i=this;switch(t.mediaType){case"image":e=[{mimetype:"image/png"},{mimetype:"image/jpeg"},{activity:"org.olpcfrance.PaintActivity"}];break;case"audio":e=[{mimetype:"audio/mpeg"}];break;case"video":e=[{mimetype:"video/mp4"}]}requirejs(["sugar-web/datastore","sugar-web/graphics/journalchooser","activity/CurriculumChooser"],(function(n,s,o){s.init=function(){s.features=[s.featureLocalJournal],"image"==t.mediaType&&s.features.push(o),s.currentFeature=0},setTimeout((function(){s.show((function(e){if(e){var s=i.user.skills[i.selectedCategoryId][i.selectedSkillId],o=s.media;if(o[t.mediaType]||i.$set(o,t.mediaType,new Array),"org.olpcfrance.Curriculum"==e.metadata.activity){var r={title:e.metadata.title,timestamp:e.metadata.timestamp,data:e.path};o[t.mediaType].push(r)}else if(e.objectId){new n.DatastoreObject(e.objectId).loadAsText((function(e,n,s){if(e)console.error(e);else{var r={title:n.title,timestamp:n.timestamp};"org.olpcfrance.PaintActivity"==n.activity?r.data=i.$refs.SugarJournal.LZString.decompressFromUTF16(JSON.parse(s).src):r.data=s,o[t.mediaType].push(r)}}))}s.acquired=i.notationLevel,s.timestamp=Date.now(),i.SugarPresence.isShared()&&i.SugarPresence.sendMessage({user:i.SugarPresence.getUserInfo(),content:{action:"updateUser",data:{user:i.user}}})}}),e[0],e[1],e[2],e[3])}),0)}))},onDeleteItem:function(t){var e=this.user.skills[this.selectedCategoryId][this.selectedSkillId].media,i=e[t.type].findIndex((function(e){return e.timestamp===t.timestamp}));-1!==i&&e[t.type].splice(i,1)},onUpdateCategories:function(t){this.categories=t},onAddClick:function(){"categories-grid"==this.currentView?this.editCategory(null):"skills-grid"==this.currentView&&this.editSkill(this.selectedCategoryId,null)},importTemplate:function(t){var e=this;e.notationLevel=t.notationLevel,e.templateTitle=t.templateTitle,e.templateImage=t.templateImage;var i=t.categories,n=[];i.forEach((function(i){t.fromURL||e.$set(e.l10n,"string"+i.title,""),e.$set(e.user.skills,i.id,new Object),i.skills.forEach((function(n,s){t.fromURL||e.$set(e.l10n,"string"+n.title,""),e.$set(e.user.skills[i.id],n.id,{acquired:0,timestamp:null,media:{}})})),n.push(i)})),e.categories=n,this.addAchievementsToUser(),e.currentView="categories-grid",e.rewardsInit=!0},addAchievementsToUser:function(){var t=this;this.$set(this.user,"achievements",new Object),this.achievements.forEach((function(e){t.$set(t.user.achievements,e.id,{timestamp:null})}))},addTitlesToL10n:function(t){var e=this;t.forEach((function(t){e.$set(e.l10n,"string"+t.title,"")}))},onNotationSelected:function(t){var e=this.notationLevel,i=Math.floor(e/2);for(var n in this.user.skills)for(var s in this.user.skills[n]){if(this.user.skills[n][s].acquired<=i)this.$set(this.user.skills[n][s],"acquired",0);else switch(this.levels[e][this.user.skills[n][s].acquired].textVariable){case"LevelAcquired":var o=this.levels[t.level].findIndex((function(t){return"LevelAcquired"==t.textVariable}));this.$set(this.user.skills[n][s],"acquired",o);break;case"LevelExceeded":-1==(o=this.levels[t.level].findIndex((function(t){return"LevelExceeded"==t.textVariable})))&&(o=this.levels[t.level].findIndex((function(t){return"LevelAcquired"==t.textVariable}))),this.$set(this.user.skills[n][s],"acquired",o)}}if(e>=3&&t.level<3){o=this.achievements.findIndex((function(t){return"object"==typeof t.availability&&"this[notationLevel]"==t.availability.property&&">="==t.availability.op&&3==t.availability.value}));var r=this.achievements[o].id;this.user.achievements[r].timestamp=null}this.notationLevel=parseInt(t.level)},onExportFormatSelected:function(t){this.exporting=t.format},goBackTo:function(t){this.rewardsActive=!1,this.currentView=t,"categories-grid"==t?(this.selectedCategoryId=null,this.selectedSkillId=null):"skills-grid"==t&&(this.selectedSkillId=null)},onJournalDataLoaded:function(t,e){"template-selection"==t.currentView?this.currentView=t.currentView:(this.sharedInstance=t.sharedInstance,this.templateTitle=t.templateTitle,this.templateImage=t.templateImage,this.notationLevel=t.notationLevel,this.categories=t.categories,this.user=t.user,this.selectedCategoryId=t.selectedCategoryId,this.selectedSkillId=t.selectedSkillId,this.currentView=t.currentView,this.rewardsInit=!0)},onJournalNewInstace:function(){this.currentView="template-selection",this.saveContextToJournal()},onNetworkDataReceived:function(t){switch(t.content.action){case"init":this.sharedInstance=!0,this.templateTitle=t.content.data.templateTitle,this.categories=t.content.data.categories,this.user=t.content.data.user,this.notationLevel=t.content.data.notationLevel,this.currentenv={},this.currentenv.user=t.user,this.rewardsInit=!0;break;case"updateCategories":this.categories=t.content.data.categories;break;case"updateNotation":this.notationLevel=t.content.data.notationLevel;break;case"updateUser":this.user=t.content.data.user}},onNetworkUserChanged:function(t){1==t.move&&this.SugarPresence.isHost&&this.SugarPresence.sendMessage({user:this.SugarPresence.getUserInfo(),content:{action:"init",data:{templateTitle:this.templateTitle,categories:this.categories,user:this.user,notationLevel:this.notationLevel}}})},fullscreen:function(){this.$refs.SugarToolbar.hide()},unfullscreen:function(){this.$refs.SugarToolbar.show()},onHelp(){let t=[];if(this.rewardsActive)t=t.concat([{element:'.trophy-card[id="0"]',position:"bottom",title:this.l10n.stringTutoTrophyCardTitle,intro:this.l10n.stringTutoTrophyCardContent}]);else if(this.settings)t=t.concat([{element:'.category-card[id="0"]',position:"right",title:this.l10n.stringTutoSettingsCategoryCardTitle,intro:this.l10n.stringTutoSettingsCategoryCardContent},{element:'.skill-card[id="0"]',position:"right",title:this.l10n.stringTutoSettingsSkillCardTitle,intro:this.l10n.stringTutoSettingsSkillCardContent},{element:"#edit-button",position:"right",title:this.l10n.stringTutoSettingsEditButtonTitle,intro:this.l10n.stringTutoSettingsEditButtonContent},{element:"#delete-button",position:"right",title:this.l10n.stringTutoSettingsDeleteButtonTitle,intro:this.l10n.stringTutoSettingsDeleteButtonContent},{element:"#notation-button",position:"bottom",title:this.l10n.stringTutoSettingsNotationButtonTitle,intro:this.l10n.stringTutoSettingsNotationButtonContent},{element:"#add-button",position:"bottom",title:this.l10n.stringTutoSettingsAddButtonTitle,intro:this.l10n.stringTutoSettingsAddButtonContent}]);else switch(this.currentView){case"template-selection":t=t.concat([{position:"bottom",title:this.l10n.stringTutoExplainTitle,intro:this.l10n.stringTutoExplainContent},{position:"bottom",title:this.l10n.stringTutoTemplateSelectionTitle,intro:this.l10n.stringTutoTemplateSelectionContent},{element:'.template[id="0"]',position:"bottom",title:this.l10n.stringTutoTemplateTitle,intro:this.l10n.stringTutoTemplateContent},{element:".add-template",position:"left",title:this.l10n.stringTutoAddTemplateTitle,intro:this.l10n.stringTutoAddTemplateContent}]);break;case"categories-grid":t=t.concat([{position:"bottom",title:this.l10n.stringTutoExplainTitle,intro:this.l10n.stringTutoExplainContent},{element:'.category-card[id="0"]',position:"right",title:this.l10n.stringTutoCategoryCardTitle,intro:this.l10n.stringTutoCategoryCardContent},{element:'.category-card[id="0"] .category-skills',position:"bottom",title:this.l10n.stringTutoCategorySkillsTitle,intro:this.l10n.stringTutoCategorySkillsContent},{element:'.category-card[id="0"] .progress',position:"bottom",title:this.l10n.stringTutoCategoryProgressTitle,intro:this.l10n.stringTutoCategoryProgressContent},{element:".search-input",position:"bottom",title:this.l10n.stringTutoCategorySearchTitle,intro:this.l10n.stringTutoCategorySearchContent},{element:"#rewards-button",position:"bottom",title:this.l10n.stringTutoRewardsButtonTitle,intro:this.l10n.stringTutoRewardsButtonContent},{element:"#settings-button",position:"bottom",title:this.l10n.stringTutoSettingsButtonTitle,intro:this.l10n.stringTutoSettingsButtonContent},{element:"#export-button",position:"bottom",title:this.l10n.stringTutoExportButtonTitle,intro:this.l10n.stringTutoExportButtonContent},{element:"#network-button",position:"bottom",title:this.l10n.stringTutoNetworkButtonTitle,intro:this.l10n.stringTutoNetworkButtonContent}]);break;case"skills-grid":t=t.concat([{element:'.skill-card[id="0"]',position:"right",title:this.l10n.stringTutoSkillCardTitle,intro:this.l10n.stringTutoSkillCardContent},{element:"#home-button",position:"bottom",title:this.l10n.stringTutoHomeButtonTitle,intro:this.l10n.stringTutoHomeButtonContent},{element:".search-input",position:"bottom",title:this.l10n.stringTutoSkillSearchTitle,intro:this.l10n.stringTutoSkillSearchContent}]);break;case"skill-details":t=t.concat([{element:".skill-uploads",position:"top",title:this.l10n.stringTutoSkillUploadsTitle,intro:this.l10n.stringTutoSkillUploadsContent},{element:"#acquire-button",position:"bottom",title:this.l10n.stringTutoAcquireButtonTitle,intro:this.l10n.stringTutoAcquireButtonContent},{element:"#upload-button",position:"bottom",title:this.l10n.stringTutoUploadButtonTitle,intro:this.l10n.stringTutoUploadButtonContent},{element:'[id="0"] .uploaded-item',position:"top",title:this.l10n.stringTutoUploadedItemTitle,intro:this.l10n.stringTutoUploadedItemContent}])}this.$refs.SugarTutorial.show(t)},saveContextToJournal:function(){var t;t="template-selection"==this.currentView?{currentView:this.currentView}:{sharedInstance:this.sharedInstance,templateTitle:this.templateTitle,templateImage:this.templateImage,notationLevel:this.notationLevel,categories:this.categories,user:this.user,selectedCategoryId:this.selectedCategoryId,selectedSkillId:this.selectedSkillId,currentView:this.currentView};var e=0,i=0;for(var n in this.user.skills)for(var s in this.user.skills[n]){e++;let t=this.levels[this.notationLevel][this.user.skills[n][s].acquired].textVariable;"LevelAcquired"!=t&&"LevelExceeded"!=t||i++}this.$refs.SugarJournal.saveData(t,{score:i+"/"+e})},onStop:function(){this.saveContextToJournal()}}});