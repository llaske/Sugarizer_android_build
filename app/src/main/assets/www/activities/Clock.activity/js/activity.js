define(["sugar-web/activity/activity","sugar-web/env","sugar-web/graphics/radiobuttonsgroup","mustache","moment-with-locales.min","l10n","tutorial"],(function(t,e,i,s,n,a,o){requirejs(["domReady!"],(function(h){t.setup(),function setTranslatedStrings(){document.getElementById("simple-clock-button").title=l10n_s.get("SimpleClock"),document.getElementById("nice-clock-button").title=l10n_s.get("NiceClock"),document.getElementById("write-time-button").title=l10n_s.get("WriteTime"),document.getElementById("write-date-button").title=l10n_s.get("WriteDate"),document.getElementById("write-seconds-button").title=l10n_s.get("WriteSeconds"),document.getElementById("set-time-button").title=l10n_s.get("SetTime"),document.getElementById("set-timeGame-button").title=l10n_s.get("SetTimeGame"),document.getElementById("text-time").innerHTML=l10n_s.get("WhatTime"),document.getElementById("show-am-pm").title=l10n_s.get("ShowAmPmTitle"),document.getElementById("show-mins").title=l10n_s.get("ShowMinsTitle")}(),e.getEnvironment((function(e,i){currentenv=i;var s="undefined"!=typeof chrome&&chrome.app&&chrome.app.runtime?chrome.i18n.getUILanguage():navigator.language,n=i.user?i.user.language:s;a.init(n),i.objectId?t.getDatastoreObject().loadAsText((function(t,e,i){null==t&&null!=i&&(d=i.show_am_pm,r=i.show_mins,d&&document.getElementById("show-am-pm").classList.add("active"),r&&document.getElementById("show-mins").classList.add("active"),Clock.face=i.face,"simple"==i.face?(document.getElementById("simple-clock-button").classList.add("active"),document.getElementById("nice-clock-button").classList.remove("active"),m.changeFace("simple")):(document.getElementById("nice-clock-button").classList.add("active"),document.getElementById("simple-clock-button").classList.remove("active"),m.changeFace("nice")),i.writeDate?(document.getElementById("write-date-button").classList.add("active"),m.changeWriteDate(!0)):document.getElementById("write-date-button").classList.remove("active"),i.writeSeconds?(document.getElementById("write-seconds-button").classList.add("active"),m.changeWriteSeconds(!0)):(document.getElementById("write-seconds-button").classList.remove("active"),m.changeWriteSeconds(!1)),i.isSetTimeGame?(m.setTimeGame=!0,i.isSmiley&&(m.isSmiley=!0),m.handAngles=i.handAngles,m.timeToBeDisplayed=i.timeToBeDisplayed,document.getElementById("set-timeGame-button").classList.add("active"),document.getElementById("write-time-button").classList.add("active"),m.writeTimeInSetTimeGame()):(i.isSetTime&&(m.setTime=!0,m.writeDate=!1,m.handAngles=i.handAngles,m.timeToBeDisplayed=i.timeToBeDisplayed,document.getElementById("set-time-button").classList.add("active"),m.writeTimeInSetTime()),i.writeTime?(document.getElementById("write-time-button").classList.add("active"),m.changeWriteTime(!0)):document.getElementById("write-time-button").classList.remove("active")))})):console.log("New instance")})),document.getElementById("help-button").addEventListener("click",(function(t){o.start()}));var l=new Image;l.src="./clock.svg";var c=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,d=!1,r=!1;function Clock(){this.face="simple",this.handAngles={hours:0,minutes:0,seconds:0},this.initialAngles={hours:void 0,minutes:void 0,seconds:void 0},this.colors={black:"#000000",white:"#FFFFFF",hours:"#005FE4",minutes:"#00B20D",seconds:"#E6000A",yellow:"#FFFF00"},this.writeTime=!1,this.writeDate=!1,this.writeSeconds=!0,this.setTime=!1,this.setTimeGame=!1,this.isDrag=!1,this.isSmiley=!1,this.initiateAngles=!1,this.firstQuad=!1,this.fourthQuad=!1,this.setTimeGameAMHour=!1,this.size=void 0,this.margin=void 0,this.radius=void 0,this.centerX=void 0,this.centerY=void 0,this.lineWidthBase=void 0,this.handSizes=void 0,this.lineWidths=void 0,this.selectedHand=void 0,this.canvasX=void 0,this.canvasY=void 0,this.timeToBeDisplayed={hours:void 0,minutes:void 0,seconds:void 0},this.ctr=0,this.ctr1=0,this.textTimeElem=document.getElementById("text-time"),this.textDateElem=document.getElementById("text-date"),this.clockCanvasElem=document.getElementById("clock-canvas"),this.clockContainerElem=this.clockCanvasElem.parentNode,this.bgCanvasElem=document.createElement("canvas"),this.clockContainerElem.insertBefore(this.bgCanvasElem,this.clockCanvasElem);var t=this;window.onresize=function(e){t.updateSizes(),t.drawBackground()},document.getElementById("fullscreen-button").addEventListener("click",(function(){document.getElementById("main-toolbar").style.display="none",document.getElementById("canvas").style.top="0px",document.getElementById("unfullscreen-button").style.visibility="visible",t.updateSizes(),t.drawBackground()})),document.getElementById("unfullscreen-button").addEventListener("click",(function(){document.getElementById("main-toolbar").style.display="block",document.getElementById("canvas").style.top="55px",document.getElementById("unfullscreen-button").style.visibility="hidden",t.updateSizes(),t.drawBackground()})),document.getElementById("show-am-pm").addEventListener("click",(function(e){if("nice"==t.face)return document.getElementById("show-am-pm").classList.remove("active"),void(d=!1);(d=document.getElementById("show-am-pm").classList.contains("active"))?document.getElementById("show-am-pm").classList.remove("active"):document.getElementById("show-am-pm").classList.add("active"),d=document.getElementById("show-am-pm").classList.contains("active"),t.drawBackground(),t.writeTimeInSetTime()})),document.getElementById("show-mins").addEventListener("click",(function(e){if("nice"==t.face)return document.getElementById("show-mins").classList.remove("active"),void(r=!1);(r=document.getElementById("show-mins").classList.contains("active"))?document.getElementById("show-mins").classList.remove("active"):document.getElementById("show-mins").classList.add("active"),r=document.getElementById("show-mins").classList.contains("active"),t.drawBackground()}));var e=(new Date).getHours();this.toggleAMPM=e<12}Clock.prototype.start=function(t){this.updateSizes(),this.drawBackground(),this.update(),this.setTime||this.setTimeGame?this.moveHandsInSetTime():this.drawHands(),this.previousTime=Date.now(),this.tick()},Clock.prototype.tick=function(){var t=Date.now();this.setTime||this.setTimeGame?this.moveHandsInSetTime():t-this.previousTime>1e3&&(this.previousTime=t,this.update(),this.drawHands(),/Android/i.test(navigator.userAgent)&&"http"!=document.location.protocol.substr(0,4)&&(this.clockCanvasElem.style.display="none",this.clockCanvasElem.offsetHeight,this.clockCanvasElem.style.display="block")),c(this.tick.bind(this))},Clock.prototype.changeFace=function(t){this.face=t,this.drawBackground()},Clock.prototype.changeWriteTime=function(t){this.writeTime=t,this.textTimeElem.style.display=t?"block":"none",this.writeTimeInSetTime()},Clock.prototype.changeWriteDate=function(t){this.writeDate=t,this.textDateElem.style.display=t?"block":"none",this.updateSizes();var e=new Date;this.displayDate(e),this.drawBackground()},Clock.prototype.changeWriteSeconds=function(t){this.writeSeconds=t,this.changeWriteTime(this.writeTime),this.updateSizes();var e=new Date;this.displayDate(e),this.drawBackground()},Clock.prototype.updateSizes=function(){var t=document.getElementById("main-toolbar"),e=document.getElementById("text-container"),i=window.innerHeight-(e.offsetHeight+t.offsetHeight)-1;this.size=Math.min(window.innerWidth,i),this.clockCanvasElem.width=this.size,this.clockCanvasElem.height=this.size,this.bgCanvasElem.width=this.size,this.bgCanvasElem.height=this.size,this.clockContainerElem.style.width=this.size+"px",this.clockContainerElem.style.height=this.size+"px",this.clockCanvasElem.style.width=this.size+4+"px",this.margin=.02*this.size,this.radius=(this.size-2*this.margin)/2,this.centerX=this.radius+this.margin,this.centerY=this.radius+this.margin,this.lineWidthBase=this.radius/150,this.handSizes={hours:.5*this.radius,minutes:.6*this.radius,seconds:.7*this.radius},this.lineWidths={hours:9*this.lineWidthBase,minutes:6*this.lineWidthBase,seconds:4*this.lineWidthBase}},Clock.prototype.update=function(){var t=new Date,e=t.getHours(),i=t.getMinutes(),s=t.getSeconds();d?this.displayTime(e,i,s):0==e?this.displayTime(e+12,i,s):e<=12?this.displayTime(e,i,s):this.displayTime(e-12,i,s),this.displayDate(t),this.handAngles.hours=Math.PI/6*(e%12)+Math.PI/360*i,this.handAngles.minutes=Math.PI/30*i+Math.PI/1800*s,this.handAngles.seconds=Math.PI/30*s,this.drawBackground()},Clock.prototype.displayTime=function(t,e,i,n){n||(n="");var zeroFill=function(t){return("00"+t).substr(-2)},a='<span style="color: {{ colors.hours }}">{{ hours }}</span>:<span style="color: {{ colors.minutes }}">{{ minutes }}</span>'+(this.writeSeconds?':<span style="color: {{ colors.seconds }}">{{ seconds }}</span>':"")+'<span style="color: {{ colors.yellow }}">'+n+"</span>";if(this.writeTime){var o={colors:this.colors,hours:zeroFill(t),minutes:zeroFill(e),seconds:zeroFill(i)};this.textTimeElem.innerHTML=s.render(a,o)}},Clock.prototype.displayDate=function(t){if(this.writeDate){var e=n(t);this.textDateElem.innerHTML=e.format("LLLL").replace(e.format("LT"),"")}},Clock.prototype.drawBackground=function(){if("simple"==this.face){var t=0;r&&(t=48),this.drawSimpleBackground(t),this.drawNumbers(t)}else document.getElementById("show-am-pm").classList.remove("active"),document.getElementById("show-mins").classList.remove("active"),d=!1,r=!1,this.drawNiceBackground();this.setTimeGame||this.setTimeGame?this.moveHandsInSetTime():this.drawHands()},Clock.prototype.drawSimpleBackground=function(t){var e=this.bgCanvasElem.getContext("2d");e.clearRect(0,0,this.size,this.size);var i=4*this.lineWidthBase;e.lineCap="round",e.lineWidth=i;var s=(new Date).getHours();d?this.setTime?this.toggleAMPM?(e.strokeStyle=this.colors.black,e.fillStyle=this.colors.white):(e.strokeStyle=this.colors.white,e.fillStyle=this.colors.black):this.setTimeGame?this.setTimeGameAMHour?(e.strokeStyle=this.colors.black,e.fillStyle=this.colors.white):(e.strokeStyle=this.colors.white,e.fillStyle=this.colors.black):s<12?(e.strokeStyle=this.colors.black,e.fillStyle=this.colors.white):(e.strokeStyle=this.colors.white,e.fillStyle=this.colors.black):(e.strokeStyle=this.colors.black,e.fillStyle=this.colors.white),e.beginPath(),e.arc(this.centerX,this.centerY,this.radius-i-t,0,2*Math.PI),e.fill(),e.stroke();for(var n=0;n<60;n++){var a;n%15==0?(a=.15*this.radius,e.lineWidth=7*this.lineWidthBase):n%5==0?(a=.12*this.radius,e.lineWidth=5*this.lineWidthBase):(a=.08*this.radius,e.lineWidth=4*this.lineWidthBase),e.lineCap="round",e.beginPath();var o=Math.cos(n*Math.PI/30),h=Math.sin(n*Math.PI/30);e.save(),e.translate(this.margin+t,this.margin+t),e.moveTo(this.radius-t+(this.radius-t-a)*o,this.radius-t+(this.radius-t-a)*h),e.lineTo(this.radius-t+(this.radius-t-e.lineWidth)*o,this.radius-t+(this.radius-t-e.lineWidth)*h),e.stroke(),e.restore()}},Clock.prototype.drawNiceBackground=function(){var t=this.bgCanvasElem.getContext("2d");t.clearRect(0,0,this.size,this.size),t.drawImage(l,this.margin,this.margin,2*this.radius,2*this.radius)},Clock.prototype.draw_Numbers=function(t,e,i,s,n){var a=i*this.radius/160;t.font=("hour_pm"==n?"":"bold ")+a+"px sans-serif";for(var o=5,h=0;h<12;h++){var l,c=Math.cos((h-2)*Math.PI/6),d=Math.sin((h-2)*Math.PI/6);"minute"==n?(l=o,o+=5):"hour_am"==n?l=h+1:"hour_pm"==n&&(l=h+13);var r=t.measureText(l).width;t.save(),t.translate(this.centerX-r/2,this.centerY),this.radius=this.radius-e,t.translate(this.radius*s*c,this.radius*s*d),this.radius=this.radius+e,t.fillText(l,0,0),t.restore()}},Clock.prototype.drawNumbers=function(t){var e=this.bgCanvasElem.getContext("2d");e.textBaseline="middle",r&&(e.fillStyle=this.colors.minutes,fontFactor=20,ratioFactor=1.1,this.draw_Numbers(e,t,fontFactor,ratioFactor,"minute")),e.fillStyle=this.colors.hours,d&&(fontFactor=10,ratioFactor=.5,this.draw_Numbers(e,t,fontFactor,ratioFactor,"hour_pm")),fontFactor=30,ratioFactor=.7,this.draw_Numbers(e,t,fontFactor,ratioFactor,"hour_am")},Clock.prototype.drawHands=function(){var t=this.clockCanvasElem.getContext("2d");t.clearRect(this.margin,this.margin,2*this.radius,2*this.radius);for(var e=this.writeSeconds?["hours","minutes","seconds"]:["hours","minutes"],i=0;i<e.length;i++){var s=e[i];t.lineCap="round",t.lineWidth=this.lineWidths[s],t.strokeStyle=this.colors[s],t.beginPath(),t.arc(this.centerX,this.centerY,.6*t.lineWidth,0,2*Math.PI),t.moveTo(this.centerX,this.centerY),t.lineTo(this.centerX+this.handSizes[s]*Math.sin(this.handAngles[s]),this.centerY-this.handSizes[s]*Math.cos(this.handAngles[s])),t.stroke()}},Clock.prototype.drawHandsInSetTime=function(){var t=this.clockCanvasElem.getContext("2d");t.clearRect(this.margin,this.margin,2*this.radius,2*this.radius),this.drawSmiley();for(var e=this.writeSeconds?["hours","minutes","seconds"]:["hours","minutes"],i=[.4,.607,.8125],s=0;s<e.length;s++){var n=e[s];t.lineCap="round",t.lineWidth=this.lineWidths[n],t.strokeStyle=this.colors[n],t.beginPath(),t.arc(this.centerX,this.centerY,.6*t.lineWidth,0,2*Math.PI),t.moveTo(this.centerX,this.centerY);var a=this.handAngles[n],o=.08*this.radius,h=this.centerX+this.handSizes[n]*i[s]*Math.sin(a),l=this.centerY-this.handSizes[n]*i[s]*Math.cos(a);t.lineTo(this.centerX+(this.handSizes[n]*i[s]-o)*Math.sin(a),this.centerY-(this.handSizes[n]*i[s]-o)*Math.cos(a)),t.stroke(),t.beginPath(),t.arc(h,l,o,0,2*Math.PI),t.moveTo(this.centerX+(this.handSizes[n]*i[s]+o)*Math.sin(a),this.centerY-(this.handSizes[n]*i[s]+o)*Math.cos(a)),t.lineTo(this.centerX+this.handSizes[n]*Math.sin(a),this.centerY-this.handSizes[n]*Math.cos(a)),t.stroke()}},Clock.prototype.moveHandsInSetTime=function(){if(this.isDrag){var t=this.canvasX,e=this.canvasY,i=Math.abs(e-this.centerY),s=Math.abs(t-this.centerX),n=Math.atan2(i,s),a=void 0;if(e<=this.centerY?t>=this.centerX?(a=Math.PI/2-n,this.firstQuad=!0,1==this.fourthQuad&&("hours"==this.selectedHand||"minutes"==this.selectedHand&&11==this.timeToBeDisplayed.hours&&this.timeToBeDisplayed.minutes>55||"minutes"==this.selectedHand&&23==this.timeToBeDisplayed.hours&&this.timeToBeDisplayed.minutes>55||"seconds"==this.selectedHand&&11==this.timeToBeDisplayed.hours&&this.timeToBeDisplayed.minutes>=59&&this.timeToBeDisplayed.seconds>55||"seconds"==this.selectedHand&&23==this.timeToBeDisplayed.hours&&this.timeToBeDisplayed.minutes>=59&&this.timeToBeDisplayed.seconds>55)&&(this.toggleAMPM=!this.toggleAMPM,this.fourthQuad=!1)):(a=3*Math.PI/2+n,this.fourthQuad=!0,1==this.firstQuad&&("hours"==this.selectedHand||"minutes"==this.selectedHand&&12==this.timeToBeDisplayed.hours&&this.timeToBeDisplayed.minutes<5||"minutes"==this.selectedHand&&0==this.timeToBeDisplayed.hours&&this.timeToBeDisplayed.minutes<5||"seconds"==this.selectedHand&&12==this.timeToBeDisplayed.hours&&this.timeToBeDisplayed.minutes<1&&this.timeToBeDisplayed.seconds<5||"seconds"==this.selectedHand&&0==this.timeToBeDisplayed.hours&&this.timeToBeDisplayed.minutes<1&&this.timeToBeDisplayed.seconds<5)&&(this.toggleAMPM=!this.toggleAMPM,this.firstQuad=!1)):t>=this.centerX?(a=Math.PI/2+n,this.firstQuad=!1,this.fourthQuad=!1):(a=3*Math.PI/2-n,this.firstQuad=!1,this.fourthQuad=!1),this.initiateAngles){for(var o in this.handAngles)this.initialAngles[o]=this.handAngles[o];this.initiateAngles=!1}if("hours"==this.selectedHand)this.handAngles.hours=Math.floor(a/Math.PI*6)*Math.PI/6+Math.floor(this.handAngles.minutes/Math.PI*30)*Math.PI/360;else if("minutes"==this.selectedHand){var h=Math.floor(this.handAngles.minutes/Math.PI*30);this.handAngles.minutes=Math.floor(a/Math.PI*30)*Math.PI/30+Math.floor(this.handAngles.seconds/Math.PI*30)*Math.PI/1800;var l=Math.floor(this.handAngles.minutes/Math.PI*30);45<h&&h<=59&&0<=l&&l<15?this.ctr++:15>h&&h>=0&&59<=l&&l>=45&&this.ctr--,(c=(Math.floor(this.initialAngles.hours/Math.PI*6)+this.ctr)*Math.PI/6+Math.floor(this.handAngles.minutes/Math.PI*30)*Math.PI/360)<0?(this.handAngles.hours=2*Math.PI+c,this.initialAngles.hours=2*Math.PI+c,this.ctr=0):this.handAngles.hours=c}else{h=Math.floor(this.handAngles.seconds/Math.PI*30);this.handAngles.seconds=Math.floor(a/Math.PI*30)*Math.PI/30;l=Math.floor(this.handAngles.seconds/Math.PI*30);45<h&&h<=59&&0<=l&&l<15?this.ctr++:15>h&&h>=0&&59<=l&&l>=45&&this.ctr--,h=Math.floor(this.handAngles.minutes/Math.PI*30);var c,d=Math.floor(this.handAngles.seconds/Math.PI*30)*Math.PI/1800;0==d&&(d=Math.PI/1800),(c=(Math.floor(this.initialAngles.minutes/Math.PI*30+this.ctr)*Math.PI/30+d)%(2*Math.PI))<0?(this.handAngles.minutes=2*Math.PI+c,this.initialAngles.minutes=2*Math.PI+c,this.ctr=0):this.handAngles.minutes=c,l=Math.floor(this.handAngles.minutes/Math.PI*30),45<h&&h<=59&&0<=l&&l<15?this.ctr1++:15>h&&h>=0&&59<=l&&l>=45&&this.ctr1--,(c=Math.floor(this.initialAngles.hours/Math.PI*6+this.ctr1)*Math.PI/6+Math.floor(this.handAngles.minutes%(2*Math.PI)/Math.PI*30)*Math.PI/360)<0?(this.handAngles.hours=2*Math.PI+c,this.initialAngles.hours=2*Math.PI+c,this.ctr1=0):this.handAngles.hours=c}}this.drawHandsInSetTime()},Clock.prototype.writeTimeInSetTime=function(){var t;this.timeToBeDisplayed.seconds=Math.floor(Number.parseFloat(30*this.handAngles.seconds/Math.PI).toFixed(5)),this.timeToBeDisplayed.minutes=Math.floor(Number.parseFloat(this.handAngles.minutes%(2*Math.PI)*30/Math.PI).toFixed(5))%60,t=Math.floor(Number.parseFloat(this.handAngles.hours%(2*Math.PI)*6/Math.PI).toFixed(5)),this.timeToBeDisplayed.hours=d?0!=t?t:0:0!=t?t:12,d&&!this.toggleAMPM&&12!=this.timeToBeDisplayed.hours&&(this.timeToBeDisplayed.hours+=12),this.displayTime(this.timeToBeDisplayed.hours,this.timeToBeDisplayed.minutes,this.timeToBeDisplayed.seconds),this.updateSizes(),this.drawBackground()},Clock.prototype.writeTimeInSetTimeGame=function(){this.writeTime=!0,this.textTimeElem.style.display="block",null==this.timeToBeDisplayed.hours&&(d?(this.timeToBeDisplayed.hours=Math.floor(24*Math.random()),this.timeToBeDisplayed.hours<12?this.setTimeGameAMHour=!0:this.setTimeGameAMHour=!1):this.timeToBeDisplayed.hours=Math.floor(12*Math.random())+1,this.timeToBeDisplayed.minutes=Math.floor(60*Math.random()),this.timeToBeDisplayed.seconds=this.writeSeconds?Math.floor(60*Math.random()):0);this.displayTime(this.timeToBeDisplayed.hours,this.timeToBeDisplayed.minutes,this.timeToBeDisplayed.seconds,"??"),this.updateSizes(),this.drawBackground()},Clock.prototype.drawSmiley=function(){if(this.isSmiley){var t=this.clockCanvasElem.getContext("2d");t.lineCap="round",t.lineWidth=10*this.lineWidthBase,t.strokeStyle=this.colors.yellow,t.beginPath(),t.arc(this.centerX,this.centerY,.5*this.radius,0,Math.PI),t.stroke(),t.beginPath(),t.arc(this.centerX-.3*this.radius,this.centerY-.3*this.radius,25,0,2*Math.PI),t.stroke(),t.beginPath(),t.arc(this.centerX+.3*this.radius,this.centerY-.3*this.radius,25,0,2*Math.PI),t.stroke()}};var m=new Clock;m.start();var u=document.getElementById("simple-clock-button");u.onclick=function(){m.changeFace("simple")};var g=document.getElementById("nice-clock-button");g.onclick=function(){m.changeFace("nice")};new i.RadioButtonsGroup([u,g]);document.getElementById("write-time-button").onclick=function(){if(!m.setTimeGame){this.classList.toggle("active");var t=this.classList.contains("active");m.changeWriteTime(t)}},document.getElementById("write-date-button").onclick=function(){this.classList.toggle("active");var t=this.classList.contains("active");m.changeWriteDate(t)};document.getElementById("write-seconds-button").onclick=function(){this.classList.toggle("active");var t=this.classList.contains("active");m.changeWriteSeconds(t)},document.getElementById("set-time-button").onclick=function(){m.setTime?(m.setTime=!1,m.isSmiley=!1,document.getElementById("set-time-button").classList.remove("active")):(m.setTime=!0,m.isSmiley=!1,m.setTimeGame=!1,document.getElementById("set-timeGame-button").classList.remove("active"),document.getElementById("set-time-button").classList.add("active"),m.writeTimeInSetTime())},document.getElementById("set-timeGame-button").onclick=function(){m.setTimeGame?(m.setTimeGame=!1,m.isSmiley=!1,m.timeToBeDisplayed={hours:void 0,minutes:void 0,seconds:void 0},document.getElementById("set-timeGame-button").classList.remove("active"),document.getElementById("write-time-button").classList.remove("active"),m.changeWriteTime(!1)):(m.setTimeGame=!0,m.writeDate=!1,m.timeToBeDisplayed={hours:void 0,minutes:void 0,seconds:void 0},m.isSmiley=!1,m.setTime=!1,document.getElementById("set-time-button").classList.remove("active"),document.getElementById("set-timeGame-button").classList.add("active"),document.getElementById("write-time-button").classList.add("active"),m.handAngles.seconds=0,m.handAngles.minutes=0,m.handAngles.hours=0,m.writeTimeInSetTimeGame())};var v="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0;function handleOnMouseDown(t){var e=["hours","minutes","seconds"],i=[.4,.607,.8125];v&&(t=t.touches[0]);for(var s=0;s<3;s++){var n=e[s],a=.08*m.radius,o=m.centerX+m.handSizes[n]*i[s]*Math.sin(m.handAngles[n]),h=m.centerY-m.handSizes[n]*i[s]*Math.cos(m.handAngles[n]);const l=m.clockCanvasElem.getBoundingClientRect(),c=t.clientX-l.left,d=t.clientY-l.top;if(m.canvasX=c,m.canvasY=d,Math.sqrt(Math.pow(o-c,2)+Math.pow(h-d,2))<=a){m.isDrag=!0,m.selectedHand=n,m.initiateAngles=!0;break}}}function handleOnMouseUp(t){for(var e in m.isDrag=!1,m.ctr=0,m.ctr1=0,this.handAngles)this.initialAngles[e]=this.handAngles[e]}function handleOnMouseMove(t){v&&(t=t.touches[0]);const e=m.clockCanvasElem.getBoundingClientRect(),i=t.clientX-e.left,s=t.clientY-e.top;if(m.canvasX=i,m.canvasY=s,m.setTimeGame){var n=m.writeSeconds?["hours","minutes","seconds"]:["hours","minutes"],a=[];a.push(Math.PI/6*(m.timeToBeDisplayed.hours%12)+Math.PI/360*m.timeToBeDisplayed.minutes),a.push(Math.PI/30*m.timeToBeDisplayed.minutes+Math.PI/1800*m.timeToBeDisplayed.seconds),a.push(Math.PI/30*m.timeToBeDisplayed.seconds);for(var o=0,h=0;h<n.length;h++){var l=n[h],c=m.handAngles[l]%(2*Math.PI),d=a[h];Math.abs(c-d)<3*Math.PI/180&&o++}m.isSmiley=o==n.length}m.setTime&&m.writeTimeInSetTime()}v?(m.clockCanvasElem.addEventListener("touchstart",handleOnMouseDown,!1),m.clockCanvasElem.addEventListener("touchend",handleOnMouseUp,!1),m.clockCanvasElem.addEventListener("touchmove",handleOnMouseMove,!1)):(m.clockCanvasElem.onmousedown=handleOnMouseDown,m.clockCanvasElem.onmouseup=handleOnMouseUp,m.clockCanvasElem.onmousemove=handleOnMouseMove),document.getElementById("stop-button").addEventListener("click",(function(e){var i={face:m.face,writeTime:m.writeTime,writeDate:m.writeDate,writeSeconds:m.writeSeconds,isSetTime:m.setTime,isSetTimeGame:m.setTimeGame,isSmiley:m.isSmiley,handAngles:m.handAngles,timeToBeDisplayed:m.timeToBeDisplayed,show_am_pm:d,show_mins:r};t.getDatastoreObject().setDataAsText(i),t.getDatastoreObject().save((function(t){null===t?console.log("write done."):console.log("write failed.")}))}))}))}));