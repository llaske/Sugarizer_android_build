requirejs.config({baseUrl:"lib",paths:{activity:"../js"}});var app=new Vue({el:"#app",components:{game:Game,result:Result,"dataset-list":DatasetList,"setting-editor":SettingEditor,categoryForm:CategoryForm,leaderboard:Leaderboard},data:{currentScreen:"",strokeColor:"#f0d9b5",fillColor:"#b58863",currentenv:null,SugarL10n:null,SugarPresence:null,SugarJournal:null,SugarPopup:null,DataSetHandler:null,mode:"non-timer",view:"play",score:0,level:0,gameLevelBonus:!1,timer:null,clock:{active:!1,time:0,initial:0,type:0},timeMarks:[],tangramCategories:["Animals"],puzzles:[],pNo:0,gameTans:[],userResponse:[],gameOver:null,hintNumber:0,hintsUsed:[!1,!1,!1,!1,!1,!1,!1],noOfHintsUsed:0,showHint:!1,gameScale:1,gameStage:{width:1,height:1},tanColors:["blue","purple","red","green","yellow","yellow"],puzzleToBeEdited:null,categoryToBeEdited:null,puzzleChosen:null,playersAll:[],connectedPlayers:[],playersPlaying:[],multiplayer:!1,disabled:!1,startGameConfig:null,l10n:{stringNetwork:"",stringView:"",stringRandom:"",stringTimer:"",stringDifficultyLevel:"",stringNewCategory:"",stringCategory:"",stringHint:"",stringTutorial:"",stringFullscreen:"",stringUnfullscreen:"",stringStop:"",stringScore:"",stringTotalScore:"",stringTotalTime:"",stringRank:"",stringUser:"",stringConfirm:"",stringCancel:"",stringTitle:"",stringNewTitle:"",stringHintsUsed:"",stringMyTangram:"",stringEasy:"",stringHard:"",stringTangramDifficulty:"",stringValidPuzzle:"",stringInvalidShape:"",stringInvalidName:"",stringTutoExplainTitle:"",stringTutoExplainContent:"",stringTutoAboutTitle:"",stringTutoAboutContent:"",stringTutoEachPuzzleTitle:"",stringTutoEachPuzzleContent:"",stringTutoTangramCategoryTitle:"",stringTutoTangramCategoryContent:"",stringTutoTargetTitle:"",stringTutoTargetContent:"",stringTutoBoardTitle:"",stringTutoBoardContent:"",stringTutoRefreshTitle:"",stringTutoRefreshContent:"",stringTutoNewCategoryTitle:"",stringTutoNewCategoryContent:"",stringTutoSettingViewTitle:"",stringTutoSettingViewContent:"",stringTutoScoreTitle:"",stringTutoScoreContent:"",stringTutoRandomPlayTitle:"",stringTutoRandomPlayContent:"",stringTutoHintTitle:"",stringTutoHintContent:"",stringTutoLevelTitle:"",stringTutoLevelContent:"",stringTutoTimerTitle:"",stringTutoTimerContent:"",stringTutoGameActionsTitle:"",stringTutoGameActionsContent:"",stringTutoViewTitle:"",stringTutoViewContent:"",stringTutoRedoTitle:"",stringTutoRedoContent:"",stringTutoKeyBoardTitle:"",stringTutoKeyBoardContent:"",stringTutoValidPuzzleIndicatorTitle:"",stringTutoValidPuzzleIndicatorContent:"",stringTutoResultTitle:"",stringTutoResultContent:"",stringTutoTangramCardTitle:"",stringTutoTangramCardContent:"",stringTutoNewPuzzleTitle:"",stringTutoNewPuzzleContent:"",stringTutoClockInfoTitle:"",stringTutoClockInfoContent:"",stringTutoScoreInfoTitle:"",stringTutoScoreInfoContent:"",stringTutoRestartTitle:"",stringTutoRestartContent:"",stringTutoLeaderboardPaginationTitle:"",stringTutoLeaderboardPaginationContent:"",stringTutoLeaderboardMainTitle:"",stringTutoLeaderboardMainContent:"",stringTutoGoBackTitle:"",stringTutoGoBackContent:"",stringTutoPlayViewTitle:"",stringTutoPlayViewContent:"",stringTutoRandomButtonTitle:"",stringTutoRandomButtonContent:"",stringTutoBoardEditorTitle:"",stringTutoBoardEditorContent:"",stringTutoValidPuzzleTitle:"",stringTutoValidPuzzleContent:"",stringTutoCategoryNameTitle:"",stringTutoCategoryNameContent:"",stringTutoEditPuzzleTitle:"",stringTutoEditPuzzleContent:"",stringTutoDeletePuzzleTitle:"",stringTutoDeletePuzzleContent:"",stringTutoEditCategoryTitle:"",stringTutoEditCategoryContent:"",stringTutoDeleteCategoryTitle:"",stringTutoDeleteCategoryContent:""}},created:function(){Konva.Util.getRandomColor=function(){for(var e=(11390624*Math.random()<<0).toString(15);e.length<6;)e=`0${e}`;return`#${e}`}},watch:{currentScreen:function(){var e=this;document.getElementById("spinner").style.visibility="visible","game"===e.currentScreen?(e.multiplayer||e.newGame(),e.clock.active||null!==e.gameOver||e.startClock()):"dataset-list"===e.currentScreen&&("Random"===e.tangramCategories[0]||e.tangramCategories.length>1)&&e.onTangramCategorySelected({index:"Animals"}),"setting-editor"!==e.currentScreen&&(e.puzzleToBeEdited=null),"categoryForm"!==e.currentScreen&&(e.categoryToBeEdited=null),"game"!==e.currentScreen&&(e.puzzleChosen=null)},pNo:function(){let e=this;e.gameOver=null,e.hintNumber=0,e.hintsUsed=[!1,!1,!1,!1,!1,!1,!1],e.Level?e.gameLevelBonus=!0:e.gameLevelBonus=!1;let t=e.populatePuzzles(e.puzzles[e.pNo].tangram.tans);e.$set(e.puzzles[e.pNo],"targetTans",t.targetTans),e.$set(e.puzzles[e.pNo],"outline",computeOutline(e.puzzles[e.pNo].tangram.tans,!0)),e.noOfHintsUsed=0;let n=e.puzzles.length-e.pNo;if(10===n)if(e.multiplayer&&!e.SugarPresence.isHost)e.SugarPresence.sendMessage({user:this.SugarPresence.getUserInfo(),content:{action:"add-questions"}});else{let t=e.generatePuzzles(10,!0);e.puzzles=e.puzzles.concat(t),e.multiplayer&&e.SugarPresence.isHost&&e.SugarPresence.sendMessage({user:this.SugarPresence.getUserInfo(),content:{action:"update-questions",data:{puzzles:t}}})}if(n<=5&&e.multiplayer&&!e.SugarPresence.isHost){let t=e.generatePuzzles(5,!0);e.puzzles=e.puzzles.concat(t)}e.centerTangram()},"DataSetHandler.AllCategories":function(e,t){this.fillCategoryPalette()},playersPlaying:function(){var e=this;0===e.playersPlaying.length&&e.SugarPresence.isHost?e.disabled=!1:e.disabled=!0}},mounted:function(){this.SugarJournal=this.$refs.SugarJournal,this.SugarL10n=this.$refs.SugarL10n,this.SugarPresence=this.$refs.SugarPresence,this.DataSetHandler=this.$refs.DataSetHandler,this.SugarPresence=this.$refs.SugarPresence,this.SugarPopup=this.$refs.SugarPopup,generating=!1},methods:{initialized:function(){let e=this;e.currentenv=e.$refs.SugarActivity.getEnvironment(),document.getElementById("app").style.background=e.currentenv.user.colorvalue.stroke,e.strokeColor=e.currentenv.user.colorvalue.stroke,e.fillColor=e.currentenv.user.colorvalue.fill},localized:function(){document.getElementById("no-timer-button")&&(document.getElementById("no-timer-button").innerHTML=this.SugarL10n.get("NoTimer")),this.fillCategoryPalette(),this.SugarL10n.localize(this.l10n)},pulseEffect:function(){let e=document.querySelector(".pulse-main");e&&(e.classList.add("pulse"),setTimeout((()=>{e.classList.remove("pulse")}),600))},fillCategoryPalette:function(){let e="",t=!0;for(var n=0;n<this.DataSetHandler.AllCategories.length;n++){let r=this.DataSetHandler.currentCategories.findIndex((e=>e===this.DataSetHandler.AllCategories[n])),a=this.SugarL10n.dictionary?this.SugarL10n.dictionary["Data"+this.DataSetHandler.AllCategories[n].replace(/ /g,"")]:null,o=a||this.DataSetHandler.AllCategories[n];e+='<div id="category-button-'+(n+1)+'" tangramcategory="'+this.DataSetHandler.AllCategories[n]+'" class="palette-item'+(-1!==r?" palette-item-selected":"")+'">'+o+"</div>",this.DataSetHandler.AllCategories[n]===this.tangramCategories[0]&&(t=!1)}let r=document.getElementById("category-buttons");if(r){r.innerHTML=e;let a=this.$refs.categoryPalette.paletteObject,o=this.$refs.categoryPalette.paletteObject.tangramCategorySelectedEvent,s=document.getElementById("category-buttons").children;for(n=0;n<s.length;n++){let e=this.DataSetHandler.AllCategories[n];s[n].addEventListener("click",(function(t){a.tangramCategorySelectedEvent.index=e,a.getPalette().dispatchEvent(o),a.popDown()}))}t&&(this.tangramCategories=[this.DataSetHandler.AllCategories[0]],this.DataSetHandler.onChangeCategory(this.tangramCategories),this.selectTangramCategoryItem(this.tangramCategories))}},startClock:function(){var e=this;e.$set(e.clock,"time",e.clock.initial),e.$set(e.clock,"active",!0),null===e.timer&&e.tick()},stopClock:function(){var e=this;e.timer&&clearInterval(e.timer),e.timer=null,e.$set(e.clock,"active",!1)},pushTimeMark:function(){let e=this;0===e.timeMarks.length&&e.timeMarks.push(e.clock.initial),e.timeMarks.push(e.clock.time)},tick:function(){var e=this;e.timer=setInterval((function(){if(e.clock.active)if("timer"===e.mode){if(e.$set(e.clock,"time",e.clock.time-1),e.clock.time<=0){e.stopClock(),e.pushTimeMark();let n=[];if(e.setUserResponse(n),e.multiplayer){for(var t=0;t<e.playersAll.length;t++)if(e.playersAll[t].user.networkId===e.currentenv.user.networkId&&null===e.playersAll[t].score){e.$set(e.playersAll[t],"score",e.score);break}e.playersPlaying=e.playersPlaying.filter((function(t){return t.networkId!==e.currentenv.user.networkId})),e.SugarPresence.isHost&&0===e.playersPlaying.length&&(e.disabled=!1),e.SugarPresence.sendMessage({user:e.SugarPresence.getUserInfo(),content:{action:"game-over",data:{score:e.score}}})}e.currentScreen="result"}}else e.$set(e.clock,"time",e.clock.time+1)}),1e3)},newGame:function(e){let t=this;t.score=0,t.userResponse=[],t.timeMarks=[],t.pNo=0,t.gameOver=null,t.hintNumber=0,t.noOfHintsUsed=0,t.level?t.gameLevelBonus=!0:t.gameLevelBonus=!1,t.startClock(),e||t.generateQuestionSet(),t.centerTangram()},onMultiplayerGameStarted:function(e){var t=this;t.multiplayer=!0,t.disabled=!0,"non-timer"===t.mode&&(t.mode="timer",t.$set(t.clock,"initial",120),t.$set(t.clock,"type",1),t.selectTimerItem(t.clock.type)),t.startGameConfig={level:t.level,clockType:t.clock.type,clockInitial:t.clock.initial,tangramCategories:t.tangramCategories};var n={colorvalue:t.currentenv.user.colorvalue,name:t.currentenv.user.name,networkId:t.currentenv.user.networkId};if(e){t.playersAll=[];for(var r=0;r<t.connectedPlayers.length;r++)t.playersAll.push({user:t.connectedPlayers[r],score:null})}else{var a={user:n,score:null};t.playersAll.push(a),t.connectedPlayers.push(n)}t.playersPlaying.push(n),t.newGame(),"game"!==t.currentScreen&&(t.currentScreen="game"),t.SugarPresence.isHost&&e&&(t.SugarPresence.sendMessage({user:this.SugarPresence.getUserInfo(),content:{action:"update-players",data:{playersAll:t.playersAll,playersPlaying:t.playersPlaying,connectedPlayers:t.connectedPlayers}}}),t.SugarPresence.sendMessage({user:this.SugarPresence.getUserInfo(),content:{action:"start-game",data:{type:"restart",puzzles:t.puzzles,clockType:t.startGameConfig.clockType,clockInitial:t.startGameConfig.clockInitial,level:t.startGameConfig.level,tangramCategories:t.startGameConfig.tangramCategories}}}))},generateQuestionSet:function(e){var t=this;"non-timer"===t.mode?t.puzzles=t.generatePuzzles(1,!1):t.puzzles=t.generatePuzzles(15,!0),t.pNo=0},generatePuzzles:function(e,t){let n=this,r=[],a=0;for(;a<e;){let e,o;if(generating=!0,"Random"!==n.tangramCategories[0]){let r;if(n.puzzleChosen)r=n.puzzleChosen,n.puzzleChosen=null,e=r.tangram.dup(),o=r.name;else if(0===n.DataSetHandler.nextArr.length&&t){e=generateTangrams(2)[0],o="Random"}else r=n.DataSetHandler.generateTangramFromSet(),e=r.tangram.dup(),o=r.name}else{e=generateTangrams(2)[0],o="Random"}if(generating=!1,void 0===e.evaluation)continue;let s=checkDifficultyOfTangram(e);e.positionCentered();let i={name:o,difficulty:s,tangram:e,targetTans:[],outline:[],outlinePoints:[]};if(0===a){let t=n.populatePuzzles(e.tans);i.targetTans=t.targetTans,i.outline=[...e.outline]}r.push(i),a++}return r},populatePuzzles:function(e){let t=this;targetTans=[];let n=[];for(var r=0;r<e.length;r++){let a=e[r].anchor.x.coeffInt,o=e[r].anchor.x.coeffSqrt,s=e[r].anchor.y.coeffInt,i=e[r].anchor.y.coeffSqrt,l=new Point(new IntAdjoinSqrt2(a,o),new IntAdjoinSqrt2(s,i)),u={id:r+50,x:100,y:100,offsetX:100,offsetY:100,anchor:null,pointsObjs:[],tanObj:new Tan(e[r].tanType,l.dup(),e[r].orientation),tanType:e[r].tanType,orientation:e[r].orientation,points:[],stroke:t.fillColor,strokeEnabled:!0,strokeWidth:.3,closed:!0,lineJoin:"round",shadowColor:"black",shadowBlur:10,shadowOpacity:.8,shadowEnabled:!1},g=[...u.tanObj.getPoints()],c=u.tanObj.center(),d=[],p=[];for(let e=0;e<g.length;e++){let t=g[e].dup();p.push(t),d.push(t.toFloatX()),d.push(t.toFloatY())}u.offsetX=c.toFloatX(),u.offsetY=c.toFloatY(),u.x=u.offsetX,u.y=u.offsetY,u.points=d,u.anchor=u.tanObj.anchor.dup(),u.pointsObjs=p,u.stroke=0===t.level?t.fillColor:t.strokeColor,targetTans.push(u),n.push(u.tanObj)}return{targetTans:targetTans,tans:n}},centerTangram:function(){let e=this,t=e.puzzles[e.pNo].targetTans,n=e.gameScale,r=e.gameStage.width/(3*n)-30,a=e.gameStage.height/(2*n)-30;for(let n=0;n<t.length;n++){let i=[...t[n].tanObj.getPoints()],l=t[n].tanObj.center(),u=[];for(let e=0;e<i.length;e++){let t=i[e].dup();t.x.add(new IntAdjoinSqrt2(r,0)),t.y.add(new IntAdjoinSqrt2(a,0)),u.push(t.toFloatX()),u.push(t.toFloatY())}let g=[];for(var o=0;o<e.puzzles[e.pNo].outline.length;o++){let t=[];for(var s=0;s<e.puzzles[e.pNo].outline[o].length;s++)t.push(e.puzzles[e.pNo].outline[o][s].toFloatX()+r),t.push(e.puzzles[e.pNo].outline[o][s].toFloatY()+a);g.push(t)}e.$set(e.puzzles[e.pNo],"outlinePoints",g),e.$set(e.puzzles[e.pNo].targetTans[n],"points",u),e.$set(e.puzzles[e.pNo].targetTans[n],"offsetX",l.toFloatX()+r),e.$set(e.puzzles[e.pNo].targetTans[n],"offsetY",l.toFloatY()+a),e.$set(e.puzzles[e.pNo].targetTans[n],"x",l.toFloatX()+r),e.$set(e.puzzles[e.pNo].targetTans[n],"y",l.toFloatY()+a)}},setUserResponse:function(e){let t,n=this,r=!0,a=n.puzzles[n.pNo].difficulty?2:0,o=n.gameLevelBonus?2:0;if(0===e.length){r=!1,t=0;for(var s=0;s<7;s++){let t=n.puzzles[n.pNo].targetTans[s];e.push(t.tanObj)}}else t=6-Math.min(6,n.noOfHintsUsed)+Math.max(0,15-Math.floor(Math.abs(n.timeMarks[n.pNo+1]-n.timeMarks[n.pNo])/4))+a+o;n.score+=t,n.$set(n.userResponse,n.pNo,{isSolved:r,score:t,tans:e})},onConfigChanged:function(e){this.gameScale=e.scale,this.gameStage.width=e.stageWidth,this.gameStage.height=e.stageHeight},onUpdateTansPlaced:function(e){let t=this;if(t.gameOver)return;let n=[!0,!0,!0,!0,!0,!0,!0];for(var r=0;r<7;r++){let t=e[r];-1!=t&&(n[t]=!1)}for(r=0;r<n.length;r++)if(n[r]){t.hintNumber=r;break}},onTangramStatus:function(e){let t=this;if(t.gameOver)return;let n=e.res;for(var r=0;r<t.puzzles[t.pNo].targetTans.length;r++)t.$set(t.puzzles[t.pNo].targetTans[r],"shadowEnabled",n);if(n){for(r=0;r<7;r++)t.puzzles[t.pNo].targetTans[r].strokeEnabled=!1;t.pushTimeMark();let n=e.tans;t.setUserResponse(n),t.pulseEffect(),"non-timer"===t.mode?(t.stopClock(),t.gameOver="solved"):t.pNo++}},handleRestartButton:function(){var e=this;if("game"===e.currentScreen){if(e.pushTimeMark(),"timer"===e.mode){e.stopClock();let t=[];e.setUserResponse(t),e.currentScreen="result"}"non-timer"===e.mode&&e.gameOver&&(e.gameOver=null,e.pulseEffect(),e.newGame())}else e.SugarPresence.isHost&&e.onMultiplayerGameStarted(!0),e.currentScreen="game"},handlePassButton:function(){var e=this;if("game"===e.currentScreen){e.pushTimeMark();let n=[];if(e.setUserResponse(n),e.pulseEffect(),"non-timer"===e.mode){e.stopClock();for(var t=0;t<e.puzzles[e.pNo].targetTans.length;t++){let n=e.tanColors[e.puzzles[e.pNo].targetTans[t].tanType];e.$set(e.puzzles[e.pNo].targetTans[t],"fill",n),e.$set(e.puzzles[e.pNo].targetTans[t],"strokeEnabled",!1)}e.gameOver="passed"}else e.pNo++}},onRandom:function(){let e=this;"Random"===e.tangramCategories[0]?(e.tangramCategories=["Animals"],e.DataSetHandler.onChangeCategory(e.tangramCategories)):e.tangramCategories=["Random"],e.selectTangramCategoryItem(e.tangramCategories),"result"!==e.currentScreen&&(e.pulseEffect(),e.currentScreen="game",e.newGame())},onTangramCategorySelected:function(e){let t=this,n=t.DataSetHandler.dataSet.findIndex((t=>t.name===e.index));("game"!==t.currentScreen||-1!==n&&0!==t.DataSetHandler.dataSet[n].tangrams.length)&&(document.getElementById("spinner").style.visibility="visible",t.DataSetHandler.tangramSet=[],setTimeout((()=>{t.pulseEffect(),t.tangramCategories=[e.index],t.DataSetHandler.onChangeCategory(t.tangramCategories),t.selectTangramCategoryItem(t.tangramCategories),"game"===t.currentScreen&&t.newGame(),document.getElementById("spinner").style.visibility="hidden"}),0))},selectTangramCategoryItem:function(e){let t=document.getElementById("category-buttons").children;for(var n=0;n<t.length;n++){let r=t[n],a=r.getAttribute("tangramcategory");e.includes(a)?r.classList.add("palette-item-selected"):r.classList.remove("palette-item-selected")}},onDifficultySelected:function(){var e=this;if(e.level=e.level?0:1,0==e.level&&(e.gameLevelBonus=!1),"game"!==e.currentScreen)return void(e.gameLevelBonus=e.level);if(e.gameOver)return e.pulseEffect(),void e.newGame();let t=e.populatePuzzles(e.puzzles[e.pNo].tangram.tans);e.$set(e.puzzles[e.pNo],"targetTans",t.targetTans),e.$set(e.puzzles[e.pNo],"outline",computeOutline(e.puzzles[e.pNo].tangram.tans,!0)),e.centerTangram()},onTimerSelected:function(e){var t=this;switch(t.pulseEffect(),e.index){case 0:t.mode="non-timer",t.$set(t.clock,"initial",0),t.$set(t.clock,"type",0);break;case 1:t.mode="timer",t.$set(t.clock,"initial",120),t.$set(t.clock,"type",1);break;case 2:t.mode="timer",t.$set(t.clock,"initial",300),t.$set(t.clock,"type",2);break;case 3:t.mode="timer",t.$set(t.clock,"initial",600),t.$set(t.clock,"type",3)}t.selectTimerItem(e.index),"game"===t.currentScreen&&t.newGame()},selectTimerItem:function(e){for(var t=[document.getElementById("no-timer-button"),document.getElementById("first-timer-button"),document.getElementById("second-timer-button"),document.getElementById("third-timer-button")],n=0;n<t.length;n++){var r=t[n];n===e?r.classList.add("palette-item-selected"):r.classList.remove("palette-item-selected")}},onHint:function(){let e=this;if(0===e.level||e.gameOver)return;e.hintsUsed[e.hintNumber]=!0,e.noOfHintsUsed=0;for(var t=0;t<7;t++)e.hintsUsed[t]&&e.noOfHintsUsed++;let n=e.tanColors[e.puzzles[e.pNo].targetTans[e.hintNumber].tanType];e.$set(e.puzzles[e.pNo].targetTans[e.hintNumber],"fill",n),e.puzzles[e.pNo].targetTans[e.hintNumber].shadowEnabled=!0,e.showHint=!0,setTimeout((()=>{e.$set(e.puzzles[e.pNo].targetTans[e.hintNumber],"fill",e.strokeColor),e.puzzles[e.pNo].targetTans[e.hintNumber].shadowEnabled=!1,e.showHint=!1}),1e3)},onChangeView:function(){let e=this;e.pulseEffect(),"play"===e.view?e.view="setting":e.view="play","game"===e.currentScreen&&(e.stopClock(),e.view="setting",e.currentScreen="dataset-list")},goToSettingEditor:function(){this.currentScreen="setting-editor"},goToDatasetList:function(){"game"===this.currentScreen&&this.stopClock(),this.currentScreen="dataset-list"},onEditPuzzle:function(e){this.puzzleToBeEdited=this.DataSetHandler.getTangramPuzzle(e),this.goToSettingEditor()},onEditCategory:function(e){this.categoryToBeEdited=this.tangramCategories[0],this.currentScreen="categoryForm"},onSavePuzzle:function(e){this.DataSetHandler.editTangramPuzzle(e.puzzle,e.id)},onPlayPuzzle:function(e){this.puzzleChosen=this.DataSetHandler.getTangramPuzzle(e);let t=this.DataSetHandler.tangramSet.findIndex((t=>t.id===e)),n=this.DataSetHandler.nextArr.findIndex((e=>e===t));-1!==n&&this.DataSetHandler.nextArr.splice(n,1),this.currentScreen="game"},importDataSet:function(e){let t=this;t.DataSetHandler.dataSet=e,t.DataSetHandler.loadTangramSet(),t.newGame()},deserealizePuzzles:function(e){let t=[];for(var n=0;n<e.length;n++){let r=e[n].tangram.tans.map((e=>{let t=e.anchor.x.coeffInt,n=e.anchor.x.coeffSqrt,r=e.anchor.y.coeffInt,a=e.anchor.y.coeffSqrt,o=new Point(new IntAdjoinSqrt2(t,n),new IntAdjoinSqrt2(r,a));return new Tan(e.tanType,o.dup(),e.orientation)})),a={...e[n],targetTans:[],tangram:null,outline:[],outlinePoints:[]};a.tangram=new Tangram(r),t.push(a)}return t},fullscreen:function(){this.$refs.SugarToolbar.hide(),setTimeout((()=>{window.dispatchEvent(new Event("resize"))}),0)},unfullscreen:function(){this.$refs.SugarToolbar.show(),setTimeout((()=>{window.dispatchEvent(new Event("resize"))}),0)},onStop:function(){let e=this,t=[];for(var n=0;n<e.puzzles.length;n++){let a={name:e.puzzles[n].name,targetTans:[]};for(var r=0;r<e.puzzles[n].tangram.tans.length;r++){let t={tanType:e.puzzles[n].tangram.tans[r].tanType,orientation:e.puzzles[n].tangram.tans[r].orientation,anchor:e.puzzles[n].tangram.tans[r].anchor.dup()};a.targetTans.push(t)}t.push(a)}let a=[];for(n=0;n<e.userResponse.length;n++){let t={isSolved:e.userResponse[n].isSolved,score:e.userResponse[n].score,tans:[]};for(r=0;r<e.userResponse[n].tans.length;r++)t.tans.push({...e.userResponse[n].tans[r]});a.push(t)}let o,s,i,l,u,g=[];if("game"===e.currentScreen||"setting-editor"===e.currentScreen){let t=e.$refs[e.currentScreen].tans;for(n=0;n<t.length;n++){let e=t[n];g.push({...e.tanObj,placedAnchor:e.placedAnchor})}s=e.$refs[e.currentScreen].configKonva,o=e.$refs[e.currentScreen].configLayer.scaleX,"game"===e.currentScreen?(i=e.$refs[e.currentScreen].tansPlaced,l=e.$refs[e.currentScreen].tansSnapped):"setting-editor"===e.currentScreen&&(u=e.$refs[e.currentScreen].puzzleCreated)}let c={type:"game-context",currentScreen:e.currentScreen,mode:e.mode,view:e.view,level:e.level,gameLevelBonus:e.gameLevelBonus,tangramCategories:e.tangramCategories,puzzles:t,pNo:e.pNo,score:e.score,clock:e.clock,timeMarks:e.timeMarks,gameOver:e.gameOver,userResponse:a,noOfHintsUsed:e.noOfHintsUsed,hintNumber:e.hintNumber,hintsUsed:e.hintsUsed,gameTans:g,gameTansPlaced:i,gameTansSnapped:l,gameScale:o,gameStage:s,puzzleCreated:u,tangramSet:e.DataSetHandler.tangramSet,dataSet:e.DataSetHandler.dataSet,nextArr:e.DataSetHandler.nextArr,currentCategories:e.DataSetHandler.currentCategories,currentCategories:e.DataSetHandler.currentCategories,puzzleToBeEdited:e.puzzleToBeEdited};e.SugarJournal.saveData(c)},onJournalNewInstance:function(){console.log("New instance"),this.currentScreen="dataset-list"},onJournalDataLoaded:function(e,t){var n=this;if(console.log("Existing instance"),"game-dataset"===e.type)return n.importDataSet(e.dataSet),void(n.currentScreen="dataset-list");n.clock={...e.clock},n.DataSetHandler.dataSet=e.dataSet,n.DataSetHandler.tangramSet=e.tangramSet,n.DataSetHandler.currentCategories=e.currentCategories,n.DataSetHandler.nextArr=e.nextArr,n.DataSetHandler.AllCategories=e.dataSet.map((e=>e.name)),n.tangramCategories=e.tangramCategories,e.clock.active?n.startClock():n.stopClock(),"categoryForm"===e.currentScreen?n.currentScreen="dataset-list":"leaderboard"===e.currentScreen?n.currentScreen="result":n.currentScreen=e.currentScreen,setTimeout((()=>{n.mode=e.mode,n.level=e.level,n.timeMarks=e.timeMarks,n.hintNumber=e.hintNumber,n.hintsUsed=e.hintsUsed,n.noOfHintsUsed=e.noOfHintsUsed,n.gameLevelBonus=n.gameLevelBonus,n.pNo=e.pNo,n.score=e.score,n.gameOver=e.gameOver,n.userResponse=[];for(var t=0;t<e.userResponse.length;t++){let a={isSolved:e.userResponse[t].isSolved,score:e.userResponse[t].score,tans:[]};for(var r=0;r<e.userResponse[t].tans.length;r++){let n=e.userResponse[t].tans[r].anchor.x.coeffInt,o=e.userResponse[t].tans[r].anchor.x.coeffSqrt,s=e.userResponse[t].tans[r].anchor.y.coeffInt,i=e.userResponse[t].tans[r].anchor.y.coeffSqrt,l=new Point(new IntAdjoinSqrt2(n,o),new IntAdjoinSqrt2(s,i));a.tans.push(new Tan(e.userResponse[t].tans[r].tanType,l,e.userResponse[t].tans[r].orientation))}n.userResponse.push(a)}n.clock={...e.clock},e.clock.active||n.stopClock(),n.puzzles=[];for(t=0;t<e.puzzles.length;t++){let r={...e.puzzles[t],tangram:null,outline:[],outlinePoints:[]};r.targetTans=[];let a=[],o=n.populatePuzzles(e.puzzles[t].targetTans);r.targetTans=o.targetTans,a=o.tans,r.tangram=new Tangram(a),r.difficulty=checkDifficultyOfTangram(r.tangram),r.outline=computeOutline(a,!0),n.puzzles.push(r)}if("game"===n.currentScreen)if(n.centerTangram(),"solved"===e.gameOver)for(t=0;t<n.puzzles[n.pNo].targetTans.length;t++)n.$set(n.puzzles[n.pNo].targetTans[t],"shadowEnabled",!0),n.$set(n.puzzles[n.pNo].targetTans[t],"strokeEnabled",!1);else if("passed"===e.gameOver)for(t=0;t<n.puzzles[n.pNo].targetTans.length;t++){n.$set(n.puzzles[n.pNo].targetTans[t],"strokeEnabled",!1);let e=n.tanColors[n.puzzles[n.pNo].targetTans[t].tanType];n.$set(n.puzzles[n.pNo].targetTans[t],"fill",e)}"game"===e.currentScreen&&setTimeout((()=>{n.$refs.game.loadContext({tans:e.gameTans,tansSnapped:e.gameTansSnapped,tansPlaced:e.gameTansPlaced,pScale:e.gameScale,pStage:e.gameStage})}),0),"setting-editor"===e.currentScreen&&setTimeout((()=>{n.puzzleToBeEdited=e.puzzleToBeEdited,n.$refs["setting-editor"].loadContext({tans:e.gameTans,pScale:e.gameScale,pStage:e.gameStage,puzzle:e.puzzleCreated})}),0)}),0),n.selectTangramCategoryItem(n.tangramCategories),n.selectTimerItem(n.clock.type)},onJournalLoadError:function(e){console.log("Error loading from journal"),this.currentScreen="dataset-list"},onActivityShared:function(e,t){this.onMultiplayerGameStarted(),this.SugarPresence.onShared(e,t)},onNetworkDataReceived:function(e){if((r=this).SugarPresence.getUserInfo().networkId!==e.user.networkId)switch(e.content.action){case"start-game":var t=e.content.data;if(!r.multiplayer&&"init"===t.type||r.multiplayer&&"restart"===t.type){r.multiplayer=!0,r.startGameConfig={level:t.level,clockType:t.clockType,clockInitial:t.clockInitial,tangramCategories:t.tangramCategories},r.puzzles=r.deserealizePuzzles(t.puzzles);let e=r.populatePuzzles(r.puzzles[0].tangram.tans);r.puzzles[0].targetTans=e.targetTans,r.puzzles[0].outline=computeOutline(r.puzzles[0].tangram.tans,!0),r.pNo=0,r.level=t.level,r.tangramCategories=t.tangramCategories,r.mode="timer",r.$set(r.clock,"type",t.clockType),r.$set(r.clock,"initial",t.clockInitial),"game"!==r.currentScreen&&(r.currentScreen="game"),r.selectTangramCategoryItem(r.tangramCategories),r.selectTimerItem(r.clock.type),r.disabled=!0,r.newGame(!0)}break;case"game-over":t=e.content.data;for(var n=0;n<r.playersAll.length;n++)if(r.playersAll[n].user.networkId===e.user.networkId&&null===r.playersAll[n].score){r.$set(r.playersAll[n],"score",t.score);break}r.playersPlaying=r.playersPlaying.filter((function(t){return t.networkId!==e.user.networkId})),r.SugarPresence.isHost&&0===r.playersPlaying.length&&(r.disabled=!1);break;case"update-players":t=e.content.data;r.playersAll=t.playersAll,r.playersPlaying=t.playersPlaying,r.connectedPlayers=t.connectedPlayers,r.SugarPresence.isHost&&0===r.playersPlaying.length&&(r.disabled=!1);break;case"add-questions":if(r.SugarPresence.isHost){let e=r.generatePuzzles(10,!0);r.puzzles=r.puzzles.concat(e),r.SugarPresence.sendMessage({user:this.SugarPresence.getUserInfo(),content:{action:"update-questions",data:{puzzles:e}}})}break;case"update-questions":t=e.content.data;let a=r.deserealizePuzzles(t.puzzles);r.puzzles=r.puzzles.concat(a)}else var r=this},onNetworkUserChanged:function(e){var t=this;if(1===e.move){if(t.SugarPresence.isHost){var n={user:e.user,score:null};t.playersAll.push(n),t.playersPlaying.push(e.user),t.connectedPlayers.push(e.user),t.SugarPresence.sendMessage({user:this.SugarPresence.getUserInfo(),content:{action:"update-players",data:{playersAll:t.playersAll,playersPlaying:t.playersPlaying,connectedPlayers:t.connectedPlayers}}}),t.SugarPresence.sendMessage({user:this.SugarPresence.getUserInfo(),content:{action:"start-game",data:{type:"init",puzzles:t.puzzles,clockType:t.startGameConfig.clockType,clockInitial:t.startGameConfig.clockInitial,level:t.startGameConfig.level,tangramCategories:t.startGameConfig.tangramCategories}}})}}else{t.playersPlaying=t.playersPlaying.filter((function(t){return t.networkId!==e.user.networkId}));for(var r=0;r<t.playersAll.length;r++)if(t.playersAll[r].user.networkId===e.user.networkId&&null===t.playersAll[r].score){t.$set(t.playersAll[r],"score",0);break}t.connectedPlayers=t.connectedPlayers.filter((function(t){return t.networkId!==e.user.networkId})),t.SugarPresence.isHost=t.connectedPlayers[0].networkId===t.SugarPresence.getUserInfo().networkId}},onHelp:function(){var e=this,t=[];"leaderboard"===e.currentScreen?t=[{element:".leaderboard-main",position:"top",title:this.l10n.stringTutoLeaderboardMainTitle,intro:this.l10n.stringTutoLeaderboardMainContent},{element:".btn-back",position:"auto top",title:this.l10n.stringTutoGoBackTitle,intro:this.l10n.stringTutoGoBackContent},{element:".page-no",position:"auto top",title:this.l10n.stringTutoLeaderboardPaginationTitle,intro:this.l10n.stringTutoLeaderboardPaginationContent}]:"result"===e.currentScreen?(document.querySelector(".result-panel-primary").scrollTo({top:0}),t=[{title:this.l10n.stringTutoResultTitle,intro:this.l10n.stringTutoResultContent},{element:".result-card:first-child",position:"auto right",title:this.l10n.stringTutoTangramCardTitle,intro:this.l10n.stringTutoTangramCardContent},{element:".result-card:first-child .clock-info-block",position:"auto bottom",title:this.l10n.stringTutoClockInfoTitle,intro:this.l10n.stringTutoClockInfoContent},{element:".result-card:first-child .score-info-block",position:"auto bottom",title:this.l10n.stringTutoScoreInfoTitle,intro:this.l10n.stringTutoScoreInfoContent},{element:".btn-restart",position:"auto top",title:this.l10n.stringTutoRestartTitle,intro:this.l10n.stringTutoRestartContent},{element:".btn-see-leaderboard",position:"auto top",title:this.l10n.stringTutoRestartTitle,intro:this.l10n.stringTutoRestartContent}]):"game"===e.currentScreen?t=[{title:this.l10n.stringTutoExplainTitle,intro:this.l10n.stringTutoExplainContent},{title:this.l10n.stringTutoEachPuzzleTitle,intro:this.l10n.stringTutoEachPuzzleContent},{element:".stage",position:"top",title:this.l10n.stringTutoBoardTitle,intro:this.l10n.stringTutoBoardContent},{element:".stage",position:"top",title:this.l10n.stringTutoKeyBoardTitle,intro:this.l10n.stringTutoKeyBoardContent},{title:this.l10n.stringTutoAboutTitle,intro:this.l10n.stringTutoAboutContent},{element:".footer-actions",position:"top",title:this.l10n.stringTutoGameActionsTitle,intro:this.l10n.stringTutoGameActionsContent},{title:this.l10n.stringTutoScoreTitle,intro:this.l10n.stringTutoScoreContent},{element:"#puzzle-category-button",position:"bottom",title:this.l10n.stringTutoTangramCategoryTitle,intro:this.l10n.stringTutoTangramCategoryContent},{element:"#random-play-button",position:"bottom",title:this.l10n.stringTutoRandomPlayTitle,intro:this.l10n.stringTutoRandomPlayContent},{element:"#level-button",position:"bottom",title:this.l10n.stringTutoLevelTitle,intro:this.l10n.stringTutoLevelContent},{element:"#timer-button",position:"bottom",title:this.l10n.stringTutoTimerTitle,intro:this.l10n.stringTutoTimerContent},{element:"#view-button",position:"bottom",title:this.l10n.stringTutoViewTitle,intro:this.l10n.stringTutoViewContent},{element:"#hint-button",position:"bottom",title:this.l10n.stringTutoHintTitle,intro:this.l10n.stringTutoHintContent}]:"dataset-list"===e.currentScreen&&"play"===e.view?t=[{title:this.l10n.stringTutoExplainTitle,intro:this.l10n.stringTutoExplainContent},{title:this.l10n.stringTutoEachPuzzleTitle,intro:this.l10n.stringTutoEachPuzzleContent},{title:this.l10n.stringTutoPlayViewTitle,intro:this.l10n.stringTutoPlayViewContent},{element:"#puzzle-category-button",position:"bottom",title:this.l10n.stringTutoTangramCategoryTitle,intro:this.l10n.stringTutoTangramCategoryContent},{element:"#view-button",position:"bottom",title:this.l10n.stringTutoViewTitle,intro:this.l10n.stringTutoViewContent}]:"dataset-list"===e.currentScreen&&"setting"===e.view?(document.querySelector(".dataset-list-panel-primary").scrollTo({top:0}),t=[{title:this.l10n.stringTutoExplainTitle,intro:this.l10n.stringTutoExplainContent},{title:this.l10n.stringTutoSettingViewTitle,intro:this.l10n.stringTutoSettingViewContent},{element:".tangram-card:first-child .edit-btn",position:"auto bottom",title:this.l10n.stringTutoEditPuzzleTitle,intro:this.l10n.stringTutoEditPuzzleContent},{element:".tangram-card:first-child .delete-btn",position:"auto bottom",title:this.l10n.stringTutoDeletePuzzleTitle,intro:this.l10n.stringTutoDeletePuzzleContent},{element:".dataset-list-bar-block .edit-btn",position:"auto bottom",title:this.l10n.stringTutoEditCategoryTitle,intro:this.l10n.stringTutoEditCategoryContent},{element:".dataset-list-bar-block .delete-btn",position:"auto bottom",title:this.l10n.stringTutoDeleteCategoryTitle,intro:this.l10n.stringTutoDeleteCategoryContent},{element:"#puzzle-category-button",position:"bottom",title:this.l10n.stringTutoTangramCategoryTitle,intro:this.l10n.stringTutoTangramCategoryContent},{element:"#view-button",position:"bottom",title:this.l10n.stringTutoViewTitle,intro:this.l10n.stringTutoViewContent},{element:"#create-category-button",position:"bottom",title:this.l10n.stringTutoNewCategoryTitle,intro:this.l10n.stringTutoNewCategoryContent},{element:".btn-add-puzzle",position:"auto top",title:this.l10n.stringTutoNewPuzzleTitle,intro:this.l10n.stringTutoNewPuzzleContent}]):t="setting-editor"===e.currentScreen?[{title:this.l10n.stringTutoExplainTitle,intro:this.l10n.stringTutoExplainContent},{element:".stage",position:"auto left",title:this.l10n.stringTutoBoardEditorTitle,intro:this.l10n.stringTutoBoardEditorContent},{title:this.l10n.stringTutoValidPuzzleTitle,intro:this.l10n.stringTutoValidPuzzleContent},{element:".valid-puzzle-indicator",position:"auto left",title:this.l10n.stringTutoValidPuzzleIndicatorTitle,intro:this.l10n.stringTutoValidPuzzleIndicatorContent},{element:".btn-replay",position:"auto top",title:this.l10n.stringTutoRefreshTitle,intro:this.l10n.stringTutoRefreshContent},{element:".btn-random",position:"auto top",title:this.l10n.stringTutoRandomButtonTitle,intro:this.l10n.stringTutoRandomButtonContent},{element:".btn-back",position:"auto top",title:this.l10n.stringTutoGoBackTitle,intro:this.l10n.stringTutoGoBackContent}]:[{title:this.l10n.stringTutoExplainTitle,intro:this.l10n.stringTutoExplainContent}],this.$refs.SugarTutorial.show(t)}}});