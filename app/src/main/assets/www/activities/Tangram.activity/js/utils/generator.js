var range=new IntAdjoinSqrt2(50,0),increaseProbability=50,checkNewTanInSettingMode=function(n,e){for(var t=e.getPoints(),r=t.concat(e.getInsidePoints()),a=0;a<n.length;a++){for(var o=n[a].getPoints(),i=0,g=0;g<r.length;g++){var s=containsPoint(o,r[g]);if(1===s)return!1;0===s&&i++}if(i>=3)return!1;for(i=0,o=o.concat(n[a].getInsidePoints()),g=0;g<o.length;g++){if(1===(s=containsPoint(t,o[g])))return!1;0===s&&i++}if(i>=3)return!1}for(var l=e.getSegments(),f=0;f<l.length;f++)for(a=0;a<n.length;a++)for(var u=n[a].getSegments(),c=0;c<u.length;c++)if(l[f].intersects(u[c]))return!1;return!0},checkNewTan=function(n,e){for(var t=e.getPoints(),r=t.concat(e.getInsidePoints()),a=0;a<n.length;a++){for(var o=n[a].getPoints(),i=0,g=0;g<r.length;g++){var s=containsPoint(o,r[g]);if(1===s)return!1;0===s&&i++}if(i>=3)return!1;for(i=0,o=o.concat(n[a].getInsidePoints()),g=0;g<o.length;g++){if(1===(s=containsPoint(t,o[g])))return!1;0===s&&i++}if(i>=3)return!1}for(var l=e.getSegments(),f=0;f<l.length;f++)for(a=0;a<n.length;a++)for(var u=n[a].getSegments(),c=0;c<u.length;c++)if(l[f].intersects(u[c]))return!1;var m=n.slice(0);m[n.length]=e;var h=computeBoundingBox(m);return!(h[2].dup().subtract(h[0]).compare(range)>0||h[3].dup().subtract(h[1]).compare(range)>0)},generateTangram=function(){var n=[0,0,1,2,2,3,4+Math.floor(2*Math.random())];console.log(n),n=shuffleArray(n);for(var e=[],t=0;t<7;t++)e[t]=Math.floor(Math.random()*numOrientations);var r=[],a=new Point(new IntAdjoinSqrt2(30,0),new IntAdjoinSqrt2(30,0));for(r[0]=new Tan(n[0],a,e[0]),t=1;t<7;t++)for(var o=getAllPoints(r),i=!1,g=0;!i;){a=o[Math.floor(Math.random()*o.length)].dup();var s=0,l=n[t]<3?[0,1,2]:[0,1,2,3];l=shuffleArray(l);do{var f;if(0===l[s])f=new Tan(n[t],a,e[t]);else{var u=a.dup().subtract(Directions[n[t]][e[t]][l[s]-1]);f=new Tan(n[t],u,e[t])}checkNewTan(r,f)&&(r[t]=f,i=!0),s++}while(!i&&s<(n[t]<3?3:4));if(++g>100)return console.log("Infinity loop!"),generateTangram()}for(var c=0,m=0;m<r.length;m++)null!=r[m]&&c++;return 7==c?new Tangram(r):generateTangram()},normalizeProbability=function(n){for(var e=0,t=0;t<n.length;t++)e+=n[t];if(!numberEq(e,0)){for(t=0;t<n.length;t++)n[t]/=e;return n}},computeOrientationProbability=function(n,e,t,r,a){for(var o=[],i=[],g=0;g<a.length;g++)a[g].point1.eq(e)?i.push(a[g].direction()):a[g].point2.eq(e)&&i.push(a[g].direction().neg());for(var s=0;s<numOrientations;s++)for(o.push(1),g=0;g<i.length;g++)i[g].multipleOf(SegmentDirections[t][s][r][0])&&(o[s]+=increaseProbability),i[g].multipleOf(SegmentDirections[t][s][r][1])&&(o[s]+=increaseProbability);return normalizeProbability(o)},sampleOrientation=function(n){var e=Math.random();if(e<(n=n.slice(0))[0])return 0;for(var t=1;t<numOrientations;t++)if(n[t]+=n[t-1],e<=n[t])return t;return numOrientations-1},updatePoints=function(n,e){var t=e.getPoints();return n=n.concat(t),eliminateDuplicates(n,comparePoints,!0)},updateSegments=function(n,e){for(var t=e.getPoints(),r=[],a=0;a<n.length;a++){for(var o=[],i=0;i<t.length;i++)n[a].onSegment(t[i])&&o.push(t[i]);r=r.concat(n[a].split(o))}return r=r.concat(e.getSegments()),r=eliminateDuplicates(r,compareLineSegments,!0)},generateTangramEdges=function(){var n=[0,0,1,2,2,3,4+Math.floor(2*Math.random())];n=shuffleArray(n);var e=Math.floor(Math.random()*numOrientations),t=[],r=new Point(new IntAdjoinSqrt2(30,0),new IntAdjoinSqrt2(30,0));t[0]=new Tan(n[0],r,e);for(var a=t[0].getPoints(),o=t[0].getSegments(),i=1;i<7;i++)for(var g=!1,s=0;!g;){r=a[Math.floor(Math.random()*a.length)].dup();var l=0,f=n[i]<3?[0,1,2]:[0,1,2,3];f=shuffleArray(f);do{for(var u,c=computeOrientationProbability(t,r,n[i],f[l],o);void 0!==c&&!g;){if(e=sampleOrientation(c),0===f[l])u=new Tan(n[i],r,e);else{var m=r.dup().subtract(Directions[n[i]][e][f[l]-1]);u=new Tan(n[i],m,e)}checkNewTan(t,u)&&(t[i]=u,g=!0,a=updatePoints(a,u),o=updateSegments(o,u)),c[e]=0,c=normalizeProbability(c)}l++}while(!g&&l<(n[i]<3?3:4));if(++s>100)return console.log("Infinity loop!"),generateTangramEdges()}return new Tangram(t)},generateTangrams=function(n){generating=!0;for(var e=[],t=0;t<n;t++){e[t]=generateTangramEdges();for(var r=0;r<7;r++)delete e[t].tans[r].points,delete e[t].tans[r].segments,delete e[t].tans[r].insidePoints}return eval||(e=e.sort(compareTangrams)),generating=!1,eval=!1,e};