var SettingEditor={props:["strokeColor","fillColor","dataSetHandler","puzzleToBeEdited","l10n"],template:'\n    <div id="setting-editor-screen"\n      v-bind:style="{backgroundColor: strokeColor}"\n    >\n      <div class="setting-editor-main"\n      >\n        <v-stage class="stage" ref="stage" v-bind:config="configKonva"\n          v-bind:style="{\n            backgroundColor: \'#ffffff\',\n            borderRadius: \'10px\'\n          }"\n        >\n          <v-layer ref="layer" :config="{...configLayer, listening: false}">\n            <v-line :config="workingBox"></v-line>\n            <template>\n              <v-line v-for="tan in konvaTans" :key="tan.id"\n                :config="{\n                  ...tan,\n                  listening: true\n                }"\n                v-on:tap="onTap"\n                v-on:click="onClick"\n                v-on:mouseover="onMouseOver"\n                v-on:mouseout="onMouseOut"\n                v-on:dragstart="onDragStart"\n                v-on:dragend="onDragEnd"\n                v-on:touchend="onTouchEnd"\n              ></v-line>\n            </template>\n          </v-layer>\n        </v-stage>\n        <button id="back-button" v-on:click="goBack"></button>\n        <div class="setting-editor-sidebar box2 sb11"\n          v-bind:style="{\n            backgroundColor: \'#ffffff\',\n            borderRadius: \'10px\',\n            borderColor: fillColor,\n          }"\n        >\n          <div class="setting-editor-sidebar-element"\n            v-bind:style="{backgroundColor: fillColor}"\n          >\n            <div>{{currentCategoryTitle}}</div>\n          </div>\n          <form v-on:submit.prevent=\'\'>\n            <div>\n              <input type=\'text\' name=\'tangram-name\' v-model="puzzleCreated.name" required>\n            </div>\n          </form>\n          <div class="setting-editor-sidebar-element valid-puzzle-indicator"\n            v-bind:style="{\n              backgroundColor: isValidPuzzle===\'Valid Puzzle\' ? \'#81e32b\' : \'red\',\n            }"\n          >\n            <div>{{isValidPuzzle}}</div>\n          </div>\n\n          <div class="setting-editor-sidebar-element valid-shape-difficulty">\n            <div v-if="puzzleCreated.tangram !== null">{{l10n.stringTangramDifficulty}}: {{puzzleCreated.difficulty ? l10n.stringHard : l10n.stringEasy}}</div>\n          </div>\n\n          <div class="setting-editor-sidebar-element valid-shape-display"\n            v-bind:style="{\n              width: validShapeDisplayBox.width+\'px\',\n              height: validShapeDisplayBox.height+\'px\',\n            }"\n          >\n            <svg v-if="puzzleCreated.tangram !== null">\n              <path\n                v-bind:fill="fillColor"\n                v-bind:transform="pathScale"\n                fill-rule=\'evenodd\'\n                v-bind:d="puzzleCreated.tangramSVGdata"\n              >\n              </path>\n            </svg>\n          </div>\n\n        </div>\n\n      </div>\n      <div class="setting-editor-footer">\n          <div class="pagination">\n          </div>\n          <div class="footer-actions">\n            <button\n              class="btn-in-footer btn-random"\n              v-bind:style="{\n                backgroundColor: fillColor,\n                width: actionButtons.width + \'px\',\n                height: actionButtons.height + \'px\',\n              }"\n              v-on:click="onRandom"\n            ></button>\n            <button\n              class="btn-in-footer btn-replay"\n              v-bind:style="{\n                backgroundColor: fillColor,\n                width: actionButtons.width + \'px\',\n                height: actionButtons.height + \'px\',\n              }"\n              v-on:click="onRefresh"\n            ></button>\n          </div>\n      </div>\n    </div>\n  ',data:function(){return{configKonva:{width:300,height:300},configLayer:{scaleX:5,scaleY:5,offsetX:0,offsetY:0},validShapeDisplayBox:{width:60,height:60,scale:1},workingBox:{points:[0,0,60,0,60,60,0,60],stroke:"green",strokeWidth:.8,closed:!0,lineJoin:"round",dash:[2,2]},actionButtons:{width:30,width:30},tanState:0,currentTan:0,flip:5,tans:[],puzzlesSet:[],snapRange:1.5,tanColors:["blue","purple","red","green","yellow","yellow"],puzzleCreated:{id:null,name:"",difficulty:"",category:"",tangram:null,tangramSVGdata:""},initialTangram:null,konvaTans:[]}},created:function(){let t=this;window.addEventListener("resize",t.resize),window.addEventListener("keydown",t.onKeyDown),window.addEventListener("keyup",t.onKeyUp)},destroyed:function(){let t=this;window.removeEventListener("resize",t.resize),window.removeEventListener("keydown",t.onKeyDown),window.removeEventListener("keyup",t.onKeyUp)},mounted:function(){let t=this;t.$set(t.workingBox,"stroke",t.strokeColor),t.resize(),t.puzzleCreated.name=t.l10n.stringMyTangram,t.puzzleCreated.category=t.dataSetHandler.currentCategories[0],setTimeout((()=>{t.puzzleToBeEdited?t.showPuzzle(t.puzzleToBeEdited):(t.onRandom(),this.puzzleCreated.id=this.dataSetHandler.addTangramPuzzle(t.puzzleCreated).id)}),0),document.getElementById("spinner").style.visibility="hidden"},computed:{pathScale:function(){return"scale("+this.validShapeDisplayBox.scale+")"},isValidPuzzle:function(){return null===this.puzzleCreated.tangram?this.l10n.stringInvalidShape:""===this.puzzleCreated.name?this.l10n.stringInvalidName:this.l10n.stringValidPuzzle},currentCategoryTitle:function(){let t=this.$root.SugarL10n.dictionary?this.$root.SugarL10n.dictionary["Data"+this.dataSetHandler.currentCategories[0].replace(/ /g,"")]:null;return t||this.dataSetHandler.currentCategories[0]}},watch:{tans:function(){this.konvaTans=[...this.tans]}},methods:{resize:function(){let t=this,e=document.getElementById("main-toolbar"),n=0!=e.offsetHeight?e.offsetHeight+3:3,a=window.innerHeight-n;window.innerWidth;document.querySelector("#setting-editor-screen").style.height=a+"px";let i,o,r=document.querySelector(".setting-editor-main"),s=.66*r.offsetWidth,l=.97*r.offsetHeight,d=t.configKonva.width,c=t.configKonva.height,u=(Math.min(d,c),s),f=l,h=Math.min(u,f)/70;t.$set(t.configKonva,"width",s),t.$set(t.configKonva,"height",l),s<l?o=i:i=o,t.$set(t.configLayer,"scaleX",h),t.$set(t.configLayer,"scaleY",h),t.$set(t.configLayer,"offsetX",-s/(2*h)+30),t.$set(t.configLayer,"offsetY",-l/(2*h)+30);let g=document.querySelector(".setting-editor-sidebar"),p=Math.min(.3*g.offsetHeight,g.offsetWidth);t.$set(t.validShapeDisplayBox,"width",p),t.$set(t.validShapeDisplayBox,"height",p),t.$set(t.validShapeDisplayBox,"scale",p/60),t.initializeTansPosition();let v=document.querySelector(".setting-editor-footer");t.$set(t.actionButtons,"width",.95*v.offsetHeight),t.$set(t.actionButtons,"height",.95*v.offsetHeight)},initializeTansPosition:function(){let t=this;document.querySelector(".setting-editor-main"),t.configKonva.width,t.configKonva.height,t.configLayer.scaleX;t.initialPositions=[];for(var e=0;e<7;e++)switch(e){case 0:t.initialPositions.push({tanType:0,orientation:7,anchor:{x:{coeffInt:45,coeffSqrt:1},y:{coeffInt:15,coeffSqrt:1}}});break;case 1:t.initialPositions.push({tanType:0,orientation:7,anchor:{x:{coeffInt:45,coeffSqrt:1},y:{coeffInt:45,coeffSqrt:1}}});break;case 2:t.initialPositions.push({tanType:1,orientation:0,anchor:{x:{coeffInt:0,coeffSqrt:1},y:{coeffInt:45,coeffSqrt:1}}});break;case 3:t.initialPositions.push({tanType:2,orientation:5,anchor:{x:{coeffInt:30,coeffSqrt:1},y:{coeffInt:5,coeffSqrt:1}}});break;case 4:t.initialPositions.push({tanType:2,orientation:1,anchor:{x:{coeffInt:30,coeffSqrt:1},y:{coeffInt:50,coeffSqrt:1}}});break;case 5:t.initialPositions.push({tanType:3,orientation:7,anchor:{x:{coeffInt:0,coeffSqrt:1},y:{coeffInt:30,coeffSqrt:1}}});break;case 6:t.initialPositions.push({tanType:5,orientation:0,anchor:{x:{coeffInt:0,coeffSqrt:1},y:{coeffInt:10,coeffSqrt:1}}})}},showPuzzle:function(t){let e=this;e.populateTans(t.tangram.tans),e.puzzleCreated.name=t.category,e.puzzleCreated.name=t.name,e.puzzleCreated.id=t.id,e.checkIfTangramValid()},onRandom:function(t){let e=this;if(t&&0===t.screenX&&0===t.screenY)return;let n=generateTangrams(2)[0];n.positionCentered(),e.initialTangram=n.dup(),e.populateTans(n.tans),e.checkIfTangramValid()},loadContext:function(t){let e=this,n=t.tans;t.pScale,t.pStage.width,t.pStage.height;e.puzzleCreated.id&&e.dataSetHandler.deleteTangramPuzzle(e.puzzleCreated.id),e.puzzleCreated.category=t.puzzle.category,e.puzzleCreated.name=t.puzzle.name,e.puzzleCreated.id=t.puzzle.id,e.dataSetHandler.deleteTangramPuzzle(e.puzzleCreated.id),e.populateTans(n),e.checkIfTangramValid()},populateTans:function(t){let e=this,n=[];for(var a=0;a<7;a++){let i=t[a].orientation,o=t[a].tanType,r=null,s=null,l=t[a].anchor.x.coeffInt,d=t[a].anchor.x.coeffSqrt,c=t[a].anchor.y.coeffInt,u=t[a].anchor.y.coeffSqrt;r=new Point(new IntAdjoinSqrt2(l,d),new IntAdjoinSqrt2(c,u)).roundToNearest(1),t[a].placedAnchor&&(s=t[a].placedAnchor);let f={id:a,x:100,y:100,offsetX:100,offsetY:100,points:[],tanObj:null,placedAnchor:s,stroke:e.strokeColor,strokeEnabled:!1,strokeWidth:.8,closed:!0,draggable:!0,fill:"blue",lineJoin:"round",shadowColor:"black",shadowBlur:4,shadowOpacity:.5,shadowEnabled:!1,perfectDrawEnabled:!1,shadowForStrokeEnabled:!1,hitStrokeWidth:0,transformsEnabled:"position"};f.tanObj=new Tan(o,r,i);let h=[...f.tanObj.getPoints()],g=f.tanObj.center(),p=[];for(let t=0;t<h.length;t++){let e=h[t].dup();p.push(e.toFloatX()),p.push(e.toFloatY())}f.offsetX=g.toFloatX(),f.offsetY=g.toFloatY(),f.x=f.offsetX,f.y=f.offsetY,f.points=p,f.fill=e.tanColors[f.tanObj.tanType],n.push(f)}e.tans=n,e.tanState=0,e.flip=5===n[5].tanObj.tanType?6:5},initializeTans:function(){this.populateTans(this.initialPositions)},goBack:function(){let t=this;null!==this.puzzleCreated.tangram&&""!==this.puzzleCreated.name&&(this.puzzleCreated.id=this.dataSetHandler.editTangramPuzzle(t.puzzleCreated,t.puzzleCreated.id).id),t.$emit("go-to-dataset-list")},checkIfTangramValid:function(){let t=this,e=[];for(let a=0;a<t.tans.length;a++){let i=t.tans[a].tanObj.anchor.dup();var n=new Tan(t.tans[a].tanObj.tanType,i,t.tans[a].tanObj.orientation);e.push(n)}let a=!1,i=null;if(computeOutline(e,!0)&&(i=new Tangram(e),i=i.dup(),a=!!i.evaluation&&(i.evaluation.rangeX<60&&i.evaluation.rangeY<60),a)){let t=computeSegments(getAllPoints(e),e);for(let e=0;e<t.length;e++)for(let n=e+1;n<t.length;n++)if(t[e].intersects(t[n])){a=!1;break}}a?(t.puzzleCreated.tangram=i,t.puzzleCreated.tangram.positionCentered(),t.puzzleCreated.tangramSVGdata=t.puzzleCreated.tangram.toSVGOutline().children[0].getAttribute("d"),t.puzzleCreated.difficulty=checkDifficultyOfTangram(t.puzzleCreated.tangram)):(t.puzzleCreated.tangram=null,t.puzzleCreated.tangramSVGdata="",t.puzzleCreated.difficulty=null)},snapTan:function(t){let e=this,n=this.tans[t],a=(n.x,n.y,n.points),i=n.tanObj.getPoints(),o=!1;for(let r=0;r<7;r++){if(r==t)continue;let s=[...e.tans[r].points],l=[...e.tans[r].tanObj.getPoints()];for(let r=0;r<a.length;r+=2){let d=!1;for(let o=0;o<s.length;o+=2)if(Math.abs(a[r]-s[o])<=e.snapRange&&Math.abs(a[r+1]-s[o+1])<=e.snapRange){let a;a=l[o/2].dup().subtract(i[r/2]),n.tanObj.anchor.add(a),e.updatePoints(t),d=!0;break}if(d){o=!0;break}}if(o)break}o?e.deSelectTan(e.currentTan):(n.tanObj.anchor.roundToNearest(1),e.updatePoints(t))},updatePoints:function(t){let e=this,n=e.tans[t].tanObj.getPoints(),a=e.tans[t].tanObj.center();e.$set(e.tans[t],"points",[]);for(let a=0;a<n.length;a++)e.tans[t].points.push(n[a].toFloatX()),e.tans[t].points.push(n[a].toFloatY());e.$set(e.tans[t],"offsetX",a.toFloatX()),e.$set(e.tans[t],"offsetY",a.toFloatY()),e.$set(e.tans[t],"x",a.toFloatX()),e.$set(e.tans[t],"y",a.toFloatY())},moveTan:function(t,e,n){this.tans[t].tanObj.anchor.add(new Point(new IntAdjoinSqrt2(e,0),new IntAdjoinSqrt2(n,0)).roundToNearest(1)),this.updatePoints(t)},rotateTan:function(t){let e=this,n=e.tans[t].x,a=e.tans[t].y,i=new Point(new IntAdjoinSqrt2(n,0),new IntAdjoinSqrt2(a,0));if(e.tans[t].tanObj.tanType==e.flip&&3==e.tans[t].tanObj.orientation){let n=4==e.flip?5:4,a=0,o=i.dup(),r=InsideDirections[n][a][0];o.x.subtract(new IntAdjoinSqrt2(r.toFloatX(),0)),o.y.subtract(new IntAdjoinSqrt2(r.toFloatY(),0)),e.tans[t].tanObj.anchor=o.dup(),e.tans[t].tanObj.tanType=n,e.tans[t].tanObj.orientation=a,e.updatePoints(t),e.flip=4==e.flip?5:4}else e.tans[t].tanObj.anchor.subtract(i).rotate(45).add(i),e.tans[t].tanObj.orientation=(e.tans[t].tanObj.orientation+1)%8,e.updatePoints(t)},selectTan:function(t){let e=this;e.$set(e.tans[t],"strokeEnabled",!0),e.$set(e.tans[t],"shadowEnabled",!0)},deSelectTan:function(t){let e=this;e.$set(e.tans[t],"strokeEnabled",!1),e.$set(e.tans[t],"shadowEnabled",!1)},updateKonvaTans:function(t){let e=this.konvaTans.findIndex((e=>e.id===t)),n=this.konvaTans[e];this.konvaTans.splice(e,1),this.konvaTans.push(n)},onClick:function(t){let e=this,n=t.target.id();e.tanState=1,e.deSelectTan(e.currentTan),e.currentTan=n,e.selectTan(e.currentTan),e.updateKonvaTans(n),1===e.tanState&&e.rotateTan(n)},onTap:function(t){let e=this,n=t.target.id();e.tanState=1,e.deSelectTan(e.currentTan),e.currentTan=n,e.selectTan(e.currentTan),e.updateKonvaTans(n),1===e.tanState&&e.rotateTan(n)},onDragStart:function(t){let e=this,n=t.target.id();e.deSelectTan(e.currentTan),e.currentTan=n,e.selectTan(e.currentTan),e.updateKonvaTans(n),e.tanState=1},onDragEnd:function(t){let e=this,n=t.target.id(),a=t.target.attrs.x,i=t.target.attrs.y,o={...t.target.getClientRect()};o.width*=.5,o.height*=.5,o.x+=.5*o.width,o.y+=.5*o.height;let r=e.configKonva.width,s=e.configKonva.height,l=e.configLayer.scaleX,d=r/(2*l)-30,c=s/(2*l)-30;if(o.x<0&&(a=o.width/(2*l)-d),o.y<0&&(i=o.height/(2*l)-c),o.y+o.height>e.configKonva.height&&(i=(e.configKonva.height-o.height/2)/l-c),o.x+o.width>e.configKonva.width-0&&o.y<0){let t=(e.configKonva.width-0-o.width/2)/l-d,r=(0+o.height/2)/l-c;Math.abs(t-e.tans[n].x)<=Math.abs(r-e.tans[n].y)?a=t:i=r}o.x+o.width>e.configKonva.width&&(o.y>0||o.y<0)&&(a=(e.configKonva.width-o.width/2)/l-d);let u=a-this.tans[n].x,f=i-this.tans[n].y;e.moveTan(n,u,f),setTimeout((()=>{e.snapTan(n),e.checkIfTangramValid()}),0)},onMouseOver:function(t){let e=this,n=t.target.id();e.deSelectTan(e.currentTan),e.currentTan=n,e.selectTan(n),e.tanState=0},onMouseOut:function(t){let e=this;e.tanState=0,e.deSelectTan(e.currentTan)},onTouchEnd:function(t){let e=this;e.tanState=0,e.deSelectTan(e.currentTan)},onKeyDown:function(t){let e=this;if(0===e.tanState)if(37===t.keyCode||40===t.keyCode){e.deSelectTan(e.currentTan);let t=(e.currentTan-1)%7;e.currentTan=t<0?t+7:t,e.selectTan(e.currentTan)}else 38===t.keyCode||39===t.keyCode?(e.deSelectTan(e.currentTan),e.currentTan=(e.currentTan+1)%7,e.selectTan(e.currentTan)):13===t.keyCode&&(e.updateKonvaTans(e.currentTan),e.tanState=1);else if(1===e.tanState){let n=4;e.selectTan(e.currentTan);let a=e.configLayer.scaleX,i=n/a,o=n/a;37===t.keyCode?(i*=-2,o=0):38===t.keyCode?(i=0,o*=-2):39===t.keyCode?(i*=2,o=0):40===t.keyCode?(i=0,o*=2):(i=0,o=0),16===t.keyCode&&e.rotateTan(e.currentTan),13===t.keyCode&&(e.tanState=0),e.moveTan(e.currentTan,i,o)}},onKeyUp:function(t){let e=this;1===e.tanState&&setTimeout((()=>{e.snapTan(e.currentTan),e.checkIfTangramValid()}),0)},onRefresh:function(t){let e=this;t&&0===t.screenX&&0===t.screenY||setTimeout((()=>{e.initializeTans(),e.checkIfTangramValid()}),0)}}};