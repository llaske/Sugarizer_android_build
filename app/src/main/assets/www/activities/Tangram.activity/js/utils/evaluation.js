var evaluationMode=0,faculty=[1,1,2,6,24,120,720,5040,40320];function Evaluation(e,t){this.outlineVertices=0,this.outerOutlineVertices=0,this.numHoles=0,this.holeArea=0,this.holeVertices=0,this.holeType=0,this.perimeter=0,this.longestEdge=0,this.shortestEdge=0,this.rangeX=0,this.rangeY=0,this.convexPercentage=0,this.convexHullArea=0,this.symmetry=0,this.hangingPieces=0,this.matchedEdges=0,this.matchedVertices=0,this.computeEvaluation(e,t)}Evaluation.prototype.getValue=function(e){var t;switch(void 0===e&&(e=evaluationMode),e){case 0:t=1-this.convexPercentage;break;case 1:t=this.outlineVertices;break;case 2:t=this.outerOutlineVertices;break;case 3:t=this.perimeter;break;case 4:t=-this.matchedVertices;break;case 5:t=(this.outerOutlineVertices-3)/26+1-this.convexPercentage;default:t=0}return t},Evaluation.prototype.computeConvexHullLess3Points=function(e){return e.length<=1||e[0].eq(e[1])&&e.pop(),e},Evaluation.prototype.computeConvexHull=function(e,t){if(e.length<=2)return this.computeConvexHullLess3Points(e);for(var n=[(e=e.sort((function(e,n){var r=clipAngle(e.dup().subtract(t).angle()),s=clipAngle(n.dup().subtract(t).angle()),i=numberEq(r,s),o=e.distance(t),a=n.distance(t);return i&&numberEq(o,a)?0:!i&&r<s||i&&o<a?-1:1})))[0]],r=1;r<e.length-1;r++)n.push(e[r]),numberEq(e[r].dup().subtract(t).angle(),e[r+1].dup().subtract(t).angle())&&n.pop();if(n.push(e[r]),n.length<=2)return this.computeConvexHullLess3Points(n);var s=[];for(s.push(n[0]),s.push(n[1]),r=2;r<n.length;r++){for(;s.length>1&&relativeOrientation(s[s.length-1],n[r],s[s.length-2])<=0;)s.pop();s.push(n[r])}return s};var horizontalCompare=function(e){return function(t,n){var r=t.y.distance(e.y),s=n.y.distance(e.y),i=r.compare(s);return 0===i?t.x.compare(n.x):i}},verticalCompare=function(e){return function(t,n){var r=t.x.distance(e.x),s=n.x.distance(e.x),i=r.compare(s);return 0===i?t.y.compare(n.y):i}};Evaluation.prototype.computeEvaluation=function(e,t){this.outerOutlineVertices=t[0].length,this.numHoles=t.length-1;for(var n=0;n<t.length;n++)0!=n&&(this.holeArea+=outlineArea(t[n]).toFloat(),this.holeVertices+=t[n].length),this.outlineVertices+=t[n].length;var r;this.longestEdge=-1,this.shortestEdge=60;for(var s=0;s<t[0].length;s++)(r=s!=t[0].length-1?t[0][s].distance(t[0][s+1]):t[0][s].distance(t[0][0]))>this.longestEdge&&(this.longestEdge=r),r<this.shortestEdge&&(this.shortestEdge=r),this.perimeter+=r;var i=computeOutline(e,!1)[0];for(s=0;s<i[0].length;s++)i[s].eq(i[s+1])&&this.hangingPieces++;for(n=1;n<i.length;n++){for(var o=!1,a=0;a<i[n].length;a++){for(s=0;s<i[0].length;s++)o=o||i[0][s].eq(i[n][a]);if(o)break}switch(this.holeType){case 0:this.holeType=o?2:1;break;case 1:o&&(this.holeType=3);break;case 2:o||(this.holeType=3)}}var h=computeBoundingBox(e,t);this.rangeX=h[2].dup().subtract(h[0]).toFloat(),this.rangeY=h[3].dup().subtract(h[1]).toFloat();var l=new Point;l.x=h[0].dup().add(h[2]).scale(.5),l.y=h[1].dup().add(h[3]).scale(.5);var c=[],u=[],g=[],p=[];for(s=0;s<t[0].length;s++){var v=t[0][s].x.compare(l.x),m=t[0][s].y.compare(l.y);v<0?g.push(t[0][s]):v>0&&p.push(t[0][s]),m<0?c.push(t[0][s]):m>0&&u.push(t[0][s])}c.sort(horizontalCompare(l)),u.sort(horizontalCompare(l)),g.sort(verticalCompare(l)),p.sort(verticalCompare(l));var d=!1;if(c.length==u.length){for(P=0;P<c.length;P++)if(!c[P].x.eq(u[P].x)||!c[P].y.distance(l.y).eq(u[P].y.distance(l.y))){d=!0;break}}else d=!0;if(d||this.symmetry++,d=!1,g.length==p.length){for(P=0;P<g.length;P++)if(!g[P].y.eq(p[P].y)||!g[P].x.distance(l.x).eq(p[P].x.distance(l.x))){d=!0;break}}else d=!0;d||this.symmetry++;var f=getAllPoints(e),y=[];for(P=0;P<f.length;P++)y.push(0);for(var x,E=[],b=0;b<e.length;b++){x=e[b].getSegments();for(var V=0;V<x.length;V++){for(var q=[],P=0;P<f.length;P++)x[V].onSegment(f[P])&&q.push(f[P]),(x[V].point1.eq(f[P])||x[V].point2.eq(f[P]))&&y[P]++;E=E.concat(x[V].split(q))}}for(P=0;P<f.length;P++)y[P]/=2,y[P]>1&&(this.matchedVertices+=faculty[y[P]-1]);var C=E.length;E=eliminateDuplicates(E,compareLineSegments,!1),this.matchedEdges=(C-E.length)/2;var k=this.computeConvexHull(t[0],f.sort(comparePointsYX)[0]);this.convexHullArea=outlineArea(k).toFloat(),this.convexPercentage=576/this.convexHullArea};