define((function(){"use strict";var e={};function changeColors(e,o,n){var r;return o&&(r=/(<!ENTITY fill_color ")(.*)(">)/,e=e.replace(r,"$1"+o+"$3")),n&&(r=/(<!ENTITY stroke_color ")(.*)(">)/,e=e.replace(r,"$1"+n+"$3")),e}function getBackgroundURL(e){var o=(e.currentStyle||window.getComputedStyle(e,"")).backgroundImage.slice(4,-1),n=o.length-1;return'"'==o[0]&&'"'==o[n]&&(o=o.slice(1,n)),o}return e.load=function(e,o){var n;"uri"in e?n=e.uri:"name"in e&&(n="lib/graphics/icons/"+e.name+".svg");var r=e.fillColor,t=e.strokeColor;if("data"!=n.substring(0,4)){var a=new XMLHttpRequest;a.onload=function(){var e=changeColors(this.responseText,r,t);o("data:image/svg+xml,"+encodeURIComponent(e))},a.open("GET",n),a.send()}else{var l=changeColors(decodeURIComponent(n.slice("data:image/svg+xml,".length)),r,t);o("data:image/svg+xml,"+encodeURI(l))}},e.colorize=function(o,n,r){var t={uri:getBackgroundURL(o),strokeColor:n.stroke,fillColor:n.fill};e.load(t,(function(e){!function setBackgroundURL(e,o){e.style.backgroundImage="url('"+o+"')"}(o,e),r&&r()}))},e}));