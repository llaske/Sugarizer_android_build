define(["sugar-web/activity/activity","webL10n","sugar-web/datastore"],(function(t,e,n){requirejs(["domReady!"],(function(e){t.setup();var d=["insertText","wmd-bold-button-second","wmd-italic-button-second","wmd-heading-button","wmd-hr-button","wmd-olist-button","wmd-ulist-button","wmd-code-button","wmd-quote-button","wmd-link-button","wmd-undo-button","wmd-redo-button","wmd-showHideEditor-button","wmd-showHidePreview-button"];inputTextContent=document.getElementById("wmd-input-second"),inputTextContent.value="#"+l10n_s.get("sample-input");var o=t.getDatastoreObject();for(inputTextContent.onblur=function(){var t=JSON.stringify(inputTextContent.value.toString());o.setDataAsText(t),o.save((function(){}))},markdownParsing(),o.loadAsText((function(t,e,n){markdowntext=JSON.parse(n),inputTextContent.value=markdowntext,markdownParsing()})),i=0;i<d.length;i++)document.getElementById(d[i]).title=l10n_s.get(d[i]);document.getElementById("insertText").onclick=function(){t.showObjectChooser((function(t,e){new n.DatastoreObject(e).loadAsText((function(t,e,n){try{textdata=JSON.parse(n)}catch(t){textdata=n}!function insertAtCursor(t,e){if(document.selection)t.focus(),sel=document.selection.createRange(),sel.text=e;else if(t.selectionStart||"0"==t.selectionStart){var n=t.selectionStart,i=t.selectionEnd;t.value=t.value.substring(0,n)+e+t.value.substring(i,t.value.length)}else t.value+=e}(document.getElementById("wmd-input-second"),textdata)}))}))};var l=document.getElementById("wmd-showHideEditor-button"),s=document.getElementById("wmd-showHidePreview-button"),u=document.getElementById("wmd-panel"),a=document.getElementById("wmd-preview-second");document.getElementById("wmd-input-second");function isElementHidden(t){return"none"===window.getComputedStyle(t,null).getPropertyValue("display")}function markdownParsing(){var t=new Markdown.Converter,e={helpButton:{handler:function(){alert(l10n_s.get("need-help"))}},strings:{quoteexample:l10n_s.get("put-it-right-here")}};new Markdown.Editor(t,"-second",e).run()}l.onclick=function(){isElementHidden(a)&&(a.style.display="inline",a.style.width="97%",u.style.width="1%"),isElementHidden(u)?(u.style.display="inline",u.style.width="47%",a.style.width="47%"):(u.style.display="none",u.style.width="1%",a.style.width="97%")},s.onclick=function(){isElementHidden(u)&&(u.style.display="inline",u.style.width="97%",a.style.width="1%"),isElementHidden(a)?(a.style.display="inline",a.style.width="47%",u.style.width="47%"):(a.style.display="none",a.style.width="1%",u.style.width="94%")}}))}));