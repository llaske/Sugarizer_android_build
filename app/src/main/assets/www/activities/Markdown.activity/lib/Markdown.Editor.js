!function(){var e={},t={},n={},i=window.document,o=window.RegExp,r=window.navigator,a=72,l={isIE:/msie/.test(r.userAgent.toLowerCase()),isIE_5or6:/msie 6/.test(r.userAgent.toLowerCase())||/msie 5/.test(r.userAgent.toLowerCase()),isOpera:/opera/.test(r.userAgent.toLowerCase())},s={bold:"Strong <strong> Ctrl+B",boldexample:"strong text",italic:"Emphasis <em> Ctrl+I",italicexample:"emphasized text",link:"Hyperlink <a> Ctrl+L",linkdescription:"enter link description here",linkdialog:'<p><b>Insert Hyperlink</b></p><p>http://example.com/ "optional title"</p>',quote:"Blockquote <blockquote> Ctrl+Q",quoteexample:"Blockquote",code:"Code Sample <pre><code> Ctrl+K",codeexample:"enter code here",image:"Image <img> Ctrl+G",imagedescription:"enter image description here",imagedialog:"<p><b>Insert Image</b></p><p>http://example.com/images/diagram.jpg \"optional title\"<br><br>Need <a href='http://www.google.com/search?q=free+image+hosting' target='_blank'>free image hosting?</a></p>",olist:"Numbered List <ol> Ctrl+O",ulist:"Bulleted List <ul> Ctrl+U",litem:"List item",heading:"Heading <h1>/<h2> Ctrl+H",headingexample:"Heading",hr:"Horizontal Rule <hr> Ctrl+R",undo:"Undo - Ctrl+Z",redo:"Redo - Ctrl+Y",redomac:"Redo - Ctrl+Shift+Z",help:"Markdown Editing Help"};function Chunks(){}function PanelCollection(e){this.buttonBar=i.getElementById("wmd-button-bar"+e),this.preview=i.getElementById("wmd-preview"+e),this.input=i.getElementById("wmd-input"+e)}function UndoManager(t,n){var i,o,r,a=this,s=[],c=0,d="none",setMode=function(e,t){d!=e&&(d=e,t||saveState()),l.isIE&&"moving"==d?r=null:o=setTimeout(refreshState,1)},refreshState=function(e){r=new TextareaState(n,e),o=void 0};this.setCommandMode=function(){d="command",saveState(),o=setTimeout(refreshState,0)},this.canUndo=function(){return c>1},this.canRedo=function(){return!!s[c+1]},this.undo=function(){a.canUndo()&&(i?(i.restore(),i=null):(s[c]=new TextareaState(n),s[--c].restore(),t&&t())),d="none",n.input.focus(),refreshState()},this.redo=function(){a.canRedo()&&(s[++c].restore(),t&&t()),d="none",n.input.focus(),refreshState()};var saveState=function(){var e=r||new TextareaState(n);if(!e)return!1;"moving"!=d?(i&&(s[c-1].text!=i.text&&(s[c++]=i),i=null),s[c++]=e,s[c+1]=null,t&&t()):i||(i=e)},handleCtrlYZ=function(e){var t=!1;if((e.ctrlKey||e.metaKey)&&!e.altKey){var n=e.charCode||e.keyCode;switch(String.fromCharCode(n).toLowerCase()){case"y":a.redo(),t=!0;break;case"z":e.shiftKey?a.redo():a.undo(),t=!0}}if(t)return e.preventDefault&&e.preventDefault(),void(window.event&&(window.event.returnValue=!1))},handleModeChange=function(e){if(!e.ctrlKey&&!e.metaKey){var t=e.keyCode;t>=33&&t<=40||t>=63232&&t<=63235?setMode("moving"):8==t||46==t||127==t?setMode("deleting"):13==t?setMode("newlines"):27==t?setMode("escape"):(t<16||t>20)&&91!=t&&setMode("typing")}};!function(){e.addEvent(n.input,"keypress",(function(e){!e.ctrlKey&&!e.metaKey||e.altKey||89!=e.keyCode&&90!=e.keyCode||e.preventDefault()}));var handlePaste=function(){(l.isIE||r&&r.text!=n.input.value)&&null==o&&(d="paste",saveState(),refreshState())};e.addEvent(n.input,"keydown",handleCtrlYZ),e.addEvent(n.input,"keydown",handleModeChange),e.addEvent(n.input,"mousedown",(function(){setMode("moving")})),n.input.onpaste=handlePaste,n.input.ondrop=handlePaste}(),refreshState(!0),saveState()}function TextareaState(t,n){var o=this,r=t.input;this.init=function(){e.isVisible(r)&&(!n&&i.activeElement&&i.activeElement!==r||(this.setInputAreaSelectionStartEnd(),this.scrollTop=r.scrollTop,(!this.text&&r.selectionStart||0===r.selectionStart)&&(this.text=r.value)))},this.setInputAreaSelection=function(){if(e.isVisible(r))if(void 0===r.selectionStart||l.isOpera){if(i.selection){if(i.activeElement&&i.activeElement!==r)return;r.focus();var t=r.createTextRange();t.moveStart("character",-r.value.length),t.moveEnd("character",-r.value.length),t.moveEnd("character",o.end),t.moveStart("character",o.start),t.select()}}else r.focus(),r.selectionStart=o.start,r.selectionEnd=o.end,r.scrollTop=o.scrollTop},this.setInputAreaSelectionStartEnd=function(){if(t.ieCachedRange||!r.selectionStart&&0!==r.selectionStart){if(i.selection){o.text=e.fixEolChars(r.value);var n=t.ieCachedRange||i.selection.createRange(),a=e.fixEolChars(n.text),l="",s=l+a+l;n.text=s;var c=e.fixEolChars(r.value);n.moveStart("character",-s.length),n.text=a,o.start=c.indexOf(l),o.end=c.lastIndexOf(l)-l.length;var d=o.text.length-e.fixEolChars(r.value).length;if(d){for(n.moveStart("character",-a.length);d--;)a+="\n",o.end+=1;n.text=a}t.ieCachedRange&&(o.scrollTop=t.ieCachedScrollTop),t.ieCachedRange=null,this.setInputAreaSelection()}}else o.start=r.selectionStart,o.end=r.selectionEnd},this.restore=function(){null!=o.text&&o.text!=r.value&&(r.value=o.text),this.setInputAreaSelection(),r.scrollTop=o.scrollTop},this.getChunks=function(){var t=new Chunks;return t.before=e.fixEolChars(o.text.substring(0,o.start)),t.startTag="",t.selection=e.fixEolChars(o.text.substring(o.start,o.end)),t.endTag="",t.after=e.fixEolChars(o.text.substring(o.end)),t.scrollTop=o.scrollTop,t},this.setChunks=function(e){e.before=e.before+e.startTag,e.after=e.endTag+e.after,this.start=e.before.length,this.end=e.before.length+e.selection.length,this.text=e.before+e.selection+e.after,this.scrollTop=e.scrollTop},this.init()}function PreviewManager(n,o,r){var a,s,c,getDocScrollTop=function(){var e=0;return window.innerHeight?e=window.pageYOffset:i.documentElement&&i.documentElement.scrollTop?e=i.documentElement.scrollTop:i.body&&(e=i.body.scrollTop),e},makePreviewHtml=function(){if(o.preview){var e=o.input.value;if(!e||e!=c){c=e;var t=(new Date).getTime();e=n.makeHtml(e);var i=(new Date).getTime();s=i-t,pushPreviewHtml(e)}}},applyTimeout=function(){a&&(clearTimeout(a),a=void 0);var e=0;(e=s)>3e3&&(e=3e3),a=setTimeout(makePreviewHtml,e)};this.refresh=function(e){e?(c="",makePreviewHtml()):applyTimeout()},this.processingTime=function(){return s};var d,u,f,p=!0,ieSafePreviewSet=function(e){var t=o.preview,n=t.parentNode,i=t.nextSibling;n.removeChild(t),t.innerHTML=e,i?n.insertBefore(t,i):n.appendChild(t)},nonSuckyBrowserPreviewSet=function(e){var t=o.preview.contentWindow.document;t.open(),t.writeln(e),t.close()},pushPreviewHtml=function(e){var n,i=t.getTop(o.input)-getDocScrollTop();if(o.preview&&(!function(e){if(d)return d(e);try{nonSuckyBrowserPreviewSet(e),d=nonSuckyBrowserPreviewSet}catch(t){(d=ieSafePreviewSet)(e)}}(e),r()),o.preview&&(o.preview.scrollTop=(o.preview.scrollHeight-o.preview.clientHeight)*((n=o.preview).scrollHeight<=n.clientHeight?1:n.scrollTop/(n.scrollHeight-n.clientHeight))),p)p=!1;else{var a=t.getTop(o.input)-getDocScrollTop();l.isIE?setTimeout((function(){window.scrollBy(0,a-i)}),0):window.scrollBy(0,a-i)}};u=o.input,f=applyTimeout,e.addEvent(u,"input",f),u.onpaste=f,u.ondrop=f,e.addEvent(u,"keypress",f),e.addEvent(u,"keydown",f),makePreviewHtml(),o.preview&&(o.preview.scrollTop=0)}function UIManager(t,n,o,a,s,c,d){var u=n.input,f={};!function makeSpritedButtonRow(){var e=document.getElementById("main-toolbar"),makeButton=function(t,n,i,o){var r=document.createElement("button");return r.className="toolbutton",r.id=t,r.title=n,o&&(r.textOp=o),e.appendChild(r),r};if(null==i.getElementById("wmd-bold-button-second")){f.bold=makeButton("wmd-bold-button-second",d("bold"),0,bindCommand("doBold")),f.bold.onclick=function(){doClick(f.bold)},f.italic=makeButton("wmd-italic-button-second",d("italic"),0,bindCommand("doItalic")),f.italic.onclick=function(){doClick(f.italic)},f.heading=makeButton("wmd-heading-button",d("heading"),0,bindCommand("doHeading")),f.heading.onclick=function(){doClick(f.heading)},f.hr=makeButton("wmd-hr-button",d("hr"),0,bindCommand("doHorizontalRule")),f.hr.onclick=function(){doClick(f.hr)},f.olist=makeButton("wmd-olist-button",d("olist"),0,bindCommand((function(e,t){this.doList(e,t,!0)}))),f.olist.onclick=function(){doClick(f.olist)},f.ulist=makeButton("wmd-ulist-button",d("ulist"),0,bindCommand((function(e,t){this.doList(e,t,!1)}))),f.ulist.onclick=function(){doClick(f.ulist)},f.code=makeButton("wmd-code-button",d("code"),0,bindCommand("doCode")),f.code.onclick=function(){doClick(f.code)},f.quote=makeButton("wmd-quote-button",d("quote"),0,bindCommand("doBlockquote")),f.quote.onclick=function(){doClick(f.quote)},f.link=makeButton("wmd-link-button",d("link"),0,bindCommand((function(e,t){return this.doLinkOrImage(e,t,!1)}))),f.link.onclick=function(){doClick(f.link)};var n=/win/.test(r.platform.toLowerCase())?d("redo"):d("redomac");f.undo=makeButton("wmd-undo-button",d("undo"),0,null),f.undo.execute=function(e){e&&e.undo()},f.undo.onclick=function(){doClick(f.undo)},f.redo=makeButton("wmd-redo-button",n,0,null),f.redo.execute=function(e){e&&e.redo()},f.redo.onclick=function(){doClick(f.redo)}}if(c){var o=document.createElement("li"),a=document.createElement("span");o.appendChild(a),o.className="wmd-button wmd-help-button",o.id="wmd-help-button"+t,o.XShift="-240px",o.isHelp=!0,o.style.right="0px",o.title=d("help"),o.onclick=c.handler,f.help=o}setUndoRedoButtonStates()}();var p="keydown";function doClick(e){if(u.focus(),e.textOp){o&&o.setCommandMode();var t=new TextareaState(n);if(!t)return;var i=t.getChunks(),fixupInputArea=function(){u.focus(),i&&t.setChunks(i),t.restore(),a.refresh()};e.textOp(i,fixupInputArea)||fixupInputArea()}e.execute&&e.execute(o)}function bindCommand(e){return"string"==typeof e&&(e=s[e]),function(){e.apply(s,arguments)}}function setUndoRedoButtonStates(){}l.isOpera&&(p="keypress"),e.addEvent(u,p,(function(e){if((e.ctrlKey||e.metaKey)&&!e.altKey&&!e.shiftKey){var t=e.charCode||e.keyCode;switch(String.fromCharCode(t).toLowerCase()){case"b":doClick(f.bold);break;case"i":doClick(f.italic);break;case"l":doClick(f.link);break;case"q":doClick(f.quote);break;case"k":doClick(f.code);break;case"g":doClick(f.image);break;case"o":doClick(f.olist);break;case"u":doClick(f.ulist);break;case"h":doClick(f.heading);break;case"r":doClick(f.hr);break;case"y":doClick(f.redo);break;case"z":e.shiftKey?doClick(f.redo):doClick(f.undo);break;default:return}e.preventDefault&&e.preventDefault(),window.event&&(window.event.returnValue=!1)}})),e.addEvent(u,"keyup",(function(e){if(e.shiftKey&&!e.ctrlKey&&!e.metaKey&&13===(e.charCode||e.keyCode)){var t={};t.textOp=bindCommand("doAutoindent"),doClick(t)}})),l.isIE&&e.addEvent(u,"keydown",(function(e){if(27===e.keyCode)return!1})),this.setUndoRedoButtonStates=setUndoRedoButtonStates}function CommandManager(e,t){this.hooks=e,this.getString=t}Markdown.Editor=function(e,t,n){"function"==typeof(n=n||{}).handler&&(n={helpButton:n}),n.strings=n.strings||{},n.helpButton&&(n.strings.help=n.strings.help||n.helpButton.title);var getString=function(e){return n.strings[e]||s[e]};t=t||"";var o=this.hooks=new Markdown.HookCollection;o.addNoop("onPreviewRefresh"),o.addNoop("postBlockquoteCreation"),o.addFalse("insertImageDialog"),this.getConverter=function(){return e};var r,a=this;this.run=function(){if(!r){r=new PanelCollection(t);var l,s,c=new CommandManager(o,getString),d=new PreviewManager(e,r,(function(){o.onPreviewRefresh()}));/\?noundo/.test(i.location.href)||(l=new UndoManager((function(){d.refresh(),s&&s.setUndoRedoButtonStates()}),r),this.textOperation=function(e){l.setCommandMode(),e(),a.refreshPreview()}),(s=new UIManager(t,r,l,d,c,n.helpButton,getString)).setUndoRedoButtonStates(),(a.refreshPreview=function(){d.refresh(!0)})()}}},Chunks.prototype.findTags=function(t,n){var i,o=this;t&&(i=e.extendRegExp(t,"","$"),this.before=this.before.replace(i,(function(e){return o.startTag=o.startTag+e,""})),i=e.extendRegExp(t,"^",""),this.selection=this.selection.replace(i,(function(e){return o.startTag=o.startTag+e,""}))),n&&(i=e.extendRegExp(n,"","$"),this.selection=this.selection.replace(i,(function(e){return o.endTag=e+o.endTag,""})),i=e.extendRegExp(n,"^",""),this.after=this.after.replace(i,(function(e){return o.endTag=e+o.endTag,""})))},Chunks.prototype.trimWhitespace=function(e){var t,n,i=this;e?t=n="":(t=function(e){return i.before+=e,""},n=function(e){return i.after=e+i.after,""}),this.selection=this.selection.replace(/^(\s*)/,t).replace(/(\s*)$/,n)},Chunks.prototype.skipLines=function(e,t,n){var i,r;if(void 0===e&&(e=1),void 0===t&&(t=1),e++,t++,navigator.userAgent.match(/Chrome/)&&"X".match(/()./),this.selection=this.selection.replace(/(^\n*)/,""),this.startTag=this.startTag+o.$1,this.selection=this.selection.replace(/(\n*$)/,""),this.endTag=this.endTag+o.$1,this.startTag=this.startTag.replace(/(^\n*)/,""),this.before=this.before+o.$1,this.endTag=this.endTag.replace(/(\n*$)/,""),this.after=this.after+o.$1,this.before){for(i=r="";e--;)i+="\\n?",r+="\n";n&&(i="\\n*"),this.before=this.before.replace(new o(i+"$",""),r)}if(this.after){for(i=r="";t--;)i+="\\n?",r+="\n";n&&(i="\\n*"),this.after=this.after.replace(new o(i,""),r)}},e.isVisible=function(e){return window.getComputedStyle?"none"!==window.getComputedStyle(e,null).getPropertyValue("display"):e.currentStyle?"none"!==e.currentStyle.display:void 0},e.addEvent=function(e,t,n){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener(t,n,!1)},e.removeEvent=function(e,t,n){e.detachEvent?e.detachEvent("on"+t,n):e.removeEventListener(t,n,!1)},e.fixEolChars=function(e){return e=(e=e.replace(/\r\n/g,"\n")).replace(/\r/g,"\n")},e.extendRegExp=function(e,t,n){null==t&&(t=""),null==n&&(n="");var i,r=e.toString();return r=(r=r.replace(/\/([gim]*)$/,(function(e,t){return i=t,""}))).replace(/(^\/|\/$)/g,""),new o(r=t+r+n,i)},t.getTop=function(e,t){var n=e.offsetTop;if(!t)for(;e=e.offsetParent;)n+=e.offsetTop;return n},t.getHeight=function(e){return e.offsetHeight||e.scrollHeight},t.getWidth=function(e){return e.offsetWidth||e.scrollWidth},t.getPageSize=function(){var e,t,n,o;return self.innerHeight&&self.scrollMaxY?(e=i.body.scrollWidth,t=self.innerHeight+self.scrollMaxY):i.body.scrollHeight>i.body.offsetHeight?(e=i.body.scrollWidth,t=i.body.scrollHeight):(e=i.body.offsetWidth,t=i.body.offsetHeight),self.innerHeight?(n=self.innerWidth,o=self.innerHeight):i.documentElement&&i.documentElement.clientHeight?(n=i.documentElement.clientWidth,o=i.documentElement.clientHeight):i.body&&(n=i.body.clientWidth,o=i.body.clientHeight),[Math.max(e,n),Math.max(t,o),n,o]},n.createBackground=function(){var e=i.createElement("div"),n=e.style;e.className="wmd-prompt-background",n.position="absolute",n.top="0",n.zIndex="1000",l.isIE?n.filter="alpha(opacity=50)":n.opacity="0.5";var o=t.getPageSize();return n.height=o[1]+"px",l.isIE?(n.left=i.documentElement.scrollLeft,n.width=i.documentElement.clientWidth):(n.left="0",n.width="100%"),i.body.appendChild(e),e},n.prompt=function(n,o,r){var a,s;void 0===o&&(o="");var checkEscape=function(e){27===(e.charCode||e.keyCode)&&close(!0)},close=function(t){e.removeEvent(i.body,"keydown",checkEscape);var n=s.value;return t?n=null:(n=n.replace(/^http:\/\/(https?|ftp):\/\//,"$1://"),/^(?:https?|ftp):\/\//.test(n)||(n="http://"+n)),a.parentNode.removeChild(a),r(n),!1};setTimeout((function(){!function(){(a=i.createElement("div")).className="wmd-prompt-dialog",a.style.padding="10px;",a.style.position="fixed",a.style.width="400px",a.style.zIndex="1001";var r=i.createElement("div");r.innerHTML=n,r.style.padding="5px",a.appendChild(r);var c=i.createElement("form"),d=c.style;c.onsubmit=function(){return close(!1)},d.padding="0",d.margin="0",d.cssFloat="left",d.width="100%",d.textAlign="center",d.position="relative",a.appendChild(c),(s=i.createElement("input")).type="text",s.value=o,(d=s.style).display="block",d.width="80%",d.marginLeft=d.marginRight="auto",c.appendChild(s);var u=i.createElement("input");u.type="button",u.onclick=function(){return close(!1)},u.value="OK",(d=u.style).margin="10px",d.display="inline",d.width="7em";var f=i.createElement("input");f.type="button",f.onclick=function(){return close(!0)},f.value="Cancel",(d=f.style).margin="10px",d.display="inline",d.width="7em",c.appendChild(u),c.appendChild(f),e.addEvent(i.body,"keydown",checkEscape),a.style.top="50%",a.style.left="50%",a.style.display="block",l.isIE_5or6&&(a.style.position="absolute",a.style.top=i.documentElement.scrollTop+200+"px",a.style.left="50%"),i.body.appendChild(a),a.style.marginTop=-t.getHeight(a)/2+"px",a.style.marginLeft=-t.getWidth(a)/2+"px"}();var r=o.length;if(void 0!==s.selectionStart)s.selectionStart=0,s.selectionEnd=r;else if(s.createTextRange){var c=s.createTextRange();c.collapse(!1),c.moveStart("character",-r),c.moveEnd("character",r),c.select()}s.focus()}),0)};var c=CommandManager.prototype;c.prefixes="(?:\\s{4,}|\\s*>|\\s*-\\s+|\\s*\\d+\\.|=|\\+|-|_|\\*|#|\\s*\\[[^\n]]+\\]:)",c.unwrap=function(e){var t=new o("([^\\n])\\n(?!(\\n|"+this.prefixes+"))","g");e.selection=e.selection.replace(t,"$1 $2")},c.wrap=function(e,t){this.unwrap(e);var n=new o("(.{1,"+t+"})( +|$\\n?)","gm"),i=this;e.selection=e.selection.replace(n,(function(e,t){return new o("^"+i.prefixes,"").test(e)?e:t+"\n"})),e.selection=e.selection.replace(/\s+$/,"")},c.doBold=function(e,t){return this.doBorI(e,t,2,this.getString("boldexample"))},c.doItalic=function(e,t){return this.doBorI(e,t,1,this.getString("italicexample"))},c.doBorI=function(e,t,n,i){e.trimWhitespace(),e.selection=e.selection.replace(/\n{2,}/g,"\n");var r=/(\**$)/.exec(e.before)[0],a=/(^\**)/.exec(e.after)[0],l=Math.min(r.length,a.length);if(l>=n&&(2!=l||1!=n))e.before=e.before.replace(o("[*]{"+n+"}$",""),""),e.after=e.after.replace(o("^[*]{"+n+"}",""),"");else if(!e.selection&&a){e.after=e.after.replace(/^([*_]*)/,""),e.before=e.before.replace(/(\s?)$/,"");var s=o.$1;e.before=e.before+a+s}else{e.selection||a||(e.selection=i);var c=n<=1?"*":"**";e.before=e.before+c,e.after=c+e.after}},c.stripLinkDefs=function(e,t){return e=e.replace(/^[ ]{0,3}\[(\d+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+|$)/gm,(function(e,n,i,o,r){return t[n]=e.replace(/\s*$/,""),o?(t[n]=e.replace(/["(](.+?)[")]$/,""),o+r):""}))},c.addLinkDef=function(e,t){var n=0,i={};e.before=this.stripLinkDefs(e.before,i),e.selection=this.stripLinkDefs(e.selection,i),e.after=this.stripLinkDefs(e.after,i);var o="",r=/(\[)((?:\[[^\]]*\]|[^\[\]])*)(\][ ]?(?:\n[ ]*)?\[)(\d+)(\])/g,addDefNumber=function(e){n++,e=e.replace(/^[ ]{0,3}\[(\d+)\]:/,"  ["+n+"]:"),o+="\n"+e},getLink=function(e,t,o,a,l,s){return o=o.replace(r,getLink),i[l]?(addDefNumber(i[l]),t+o+a+n+s):e};e.before=e.before.replace(r,getLink),t?addDefNumber(t):e.selection=e.selection.replace(r,getLink);var a=n;return e.after=e.after.replace(r,getLink),e.after&&(e.after=e.after.replace(/\n*$/,"")),e.after||(e.selection=e.selection.replace(/\n*$/,"")),e.after+="\n\n"+o,a},c.doLinkOrImage=function(e,t,i){var o;if(e.trimWhitespace(),e.findTags(/\s*!?\[/,/\][ ]?(?:\n[ ]*)?(\[.*?\])?/),!(e.endTag.length>1&&e.startTag.length>0)){if(e.selection=e.startTag+e.selection+e.endTag,e.startTag=e.endTag="",/\n\n/.test(e.selection))return void this.addLinkDef(e,null);var r=this,linkEnteredCallback=function(n){if(o.parentNode.removeChild(o),null!==n){e.selection=(" "+e.selection).replace(/([^\\](?:\\\\)*)(?=[[\]])/g,"$1\\").substr(1);var a=" [999]: "+function properlyEncoded(e){return e.replace(/^\s*(.*?)(?:\s+"(.+)")?\s*$/,(function(e,t,n){return t=t.replace(/\?.*$/,(function(e){return e.replace(/\+/g," ")})),t=decodeURIComponent(t),t=(t=encodeURI(t).replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")).replace(/\?.*$/,(function(e){return e.replace(/\+/g,"%2b")})),n&&(n=(n=n.trim?n.trim():n.replace(/^\s*/,"").replace(/\s*$/,"")).replace(/"/g,"quot;").replace(/\(/g,"&#40;").replace(/\)/g,"&#41;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),n?t+' "'+n+'"':t}))}(n),l=r.addLinkDef(e,a);e.startTag=i?"![":"[",e.endTag="]["+l+"]",e.selection||(e.selection=i?r.getString("imagedescription"):r.getString("linkdescription"))}t()};return o=n.createBackground(),i?this.hooks.insertImageDialog(linkEnteredCallback)||n.prompt(this.getString("imagedialog"),"http://",linkEnteredCallback):n.prompt(this.getString("linkdialog"),"http://",linkEnteredCallback),!0}e.startTag=e.startTag.replace(/!?\[/,""),e.endTag="",this.addLinkDef(e,null)},c.doAutoindent=function(e,t){var n=this,i=!1;e.before=e.before.replace(/(\n|^)[ ]{0,3}([*+-]|\d+[.])[ \t]*\n$/,"\n\n"),e.before=e.before.replace(/(\n|^)[ ]{0,3}>[ \t]*\n$/,"\n\n"),e.before=e.before.replace(/(\n|^)[ \t]+\n$/,"\n\n"),e.selection||/^[ \t]*(?:\n|$)/.test(e.after)||(e.after=e.after.replace(/^[^\n]*/,(function(t){return e.selection=t,""})),i=!0),/(\n|^)[ ]{0,3}([*+-]|\d+[.])[ \t]+.*\n$/.test(e.before)&&n.doList&&n.doList(e),/(\n|^)[ ]{0,3}>[ \t]+.*\n$/.test(e.before)&&n.doBlockquote&&n.doBlockquote(e),/(\n|^)(\t|[ ]{4,}).*\n$/.test(e.before)&&n.doCode&&n.doCode(e),i&&(e.after=e.selection+e.after,e.selection="")},c.doBlockquote=function(e,t){e.selection=e.selection.replace(/^(\n*)([^\r]+?)(\n*)$/,(function(t,n,i,o){return e.before+=n,e.after=o+e.after,i})),e.before=e.before.replace(/(>[ \t]*)$/,(function(t,n){return e.selection=n+e.selection,""})),e.selection=e.selection.replace(/^(\s|>)+$/,""),e.selection=e.selection||this.getString("quoteexample");var n,i="",o="";if(e.before){for(var r=e.before.replace(/\n$/,"").split("\n"),l=!1,s=0;s<r.length;s++){var c=!1;n=r[s],l=l&&n.length>0,/^>/.test(n)?(c=!0,!l&&n.length>1&&(l=!0)):c=!!/^[ \t]*$/.test(n)||l,c?i+=n+"\n":(o+=i+n,i="\n")}/(^|\n)>/.test(i)||(o+=i,i="")}e.startTag=i,e.before=o,e.after&&(e.after=e.after.replace(/^\n?/,"\n")),e.after=e.after.replace(/^(((\n|^)(\n[ \t]*)*>(.+\n)*.*)+(\n[ \t]*)*)/,(function(t){return e.endTag=t,""}));var replaceBlanksInTags=function(t){var n=t?"> ":"";e.startTag&&(e.startTag=e.startTag.replace(/\n((>|\s)*)\n$/,(function(e,t){return"\n"+t.replace(/^[ ]{0,3}>?[ \t]*$/gm,n)+"\n"}))),e.endTag&&(e.endTag=e.endTag.replace(/^\n((>|\s)*)\n/,(function(e,t){return"\n"+t.replace(/^[ ]{0,3}>?[ \t]*$/gm,n)+"\n"})))};/^(?![ ]{0,3}>)/m.test(e.selection)?(this.wrap(e,a-2),e.selection=e.selection.replace(/^/gm,"> "),replaceBlanksInTags(!0),e.skipLines()):(e.selection=e.selection.replace(/^[ ]{0,3}> ?/gm,""),this.unwrap(e),replaceBlanksInTags(!1),!/^(\n|^)[ ]{0,3}>/.test(e.selection)&&e.startTag&&(e.startTag=e.startTag.replace(/\n{0,2}$/,"\n\n")),!/(\n|^)[ ]{0,3}>.*$/.test(e.selection)&&e.endTag&&(e.endTag=e.endTag.replace(/^\n{0,2}/,"\n\n"))),e.selection=this.hooks.postBlockquoteCreation(e.selection),/\n/.test(e.selection)||(e.selection=e.selection.replace(/^(> *)/,(function(t,n){return e.startTag+=n,""})))},c.doCode=function(e,t){var n=/\S[ ]*$/.test(e.before);if(!/^[ ]*\S/.test(e.after)&&!n||/\n/.test(e.selection)){e.before=e.before.replace(/[ ]{4}$/,(function(t){return e.selection=t+e.selection,""}));var i=1,o=1;/(\n|^)(\t|[ ]{4,}).*\n$/.test(e.before)&&(i=0),/^\n(\t|[ ]{4,})/.test(e.after)&&(o=0),e.skipLines(i,o),e.selection?/^[ ]{0,3}\S/m.test(e.selection)?/\n/.test(e.selection)?e.selection=e.selection.replace(/^/gm,"    "):e.before+="    ":e.selection=e.selection.replace(/^(?:[ ]{4}|[ ]{0,3}\t)/gm,""):(e.startTag="    ",e.selection=this.getString("codeexample"))}else e.trimWhitespace(),e.findTags(/`/,/`/),e.startTag||e.endTag?e.endTag&&!e.startTag?(e.before+=e.endTag,e.endTag=""):e.startTag=e.endTag="":(e.startTag=e.endTag="`",e.selection||(e.selection=this.getString("codeexample")))},c.doList=function(e,t,n){var i=/^\n*(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*/,r="-",l=1,getItemPrefix=function(){var e;return n?(e=" "+l+". ",l++):e=" "+r+" ",e},getPrefixedItem=function(e){return void 0===n&&(n=/^\s*\d/.test(e)),e=e.replace(/^[ ]{0,3}([*+-]|\d+[.])\s/gm,(function(e){return getItemPrefix()}))};if(e.findTags(/(\n|^)*[ ]{0,3}([*+-]|\d+[.])\s+/,null),!e.before||/\n$/.test(e.before)||/^\n/.test(e.startTag)||(e.before+=e.startTag,e.startTag=""),e.startTag){var s=/\d+[.]/.test(e.startTag);if(e.startTag="",e.selection=e.selection.replace(/\n[ ]{4}/g,"\n"),this.unwrap(e),e.skipLines(),s&&(e.after=e.after.replace(i,getPrefixedItem)),n==s)return}var c=1;e.before=e.before.replace(/(\n|^)(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*$/,(function(e){return/^\s*([*+-])/.test(e)&&(r=o.$1),c=/[^\n]\n\n[^\n]/.test(e)?1:0,getPrefixedItem(e)})),e.selection||(e.selection=this.getString("litem"));var d=getItemPrefix(),u=1;e.after=e.after.replace(i,(function(e){return u=/[^\n]\n\n[^\n]/.test(e)?1:0,getPrefixedItem(e)})),e.trimWhitespace(!0),e.skipLines(c,u,!0),e.startTag=d;var f=d.replace(/./g," ");this.wrap(e,a-f.length),e.selection=e.selection.replace(/\n/g,"\n"+f)},c.doHeading=function(e,t){if(e.selection=e.selection.replace(/\s+/g," "),e.selection=e.selection.replace(/(^\s+|\s+$)/g,""),!e.selection)return e.startTag="## ",e.selection=this.getString("headingexample"),void(e.endTag=" ##");var n=0;e.findTags(/#+[ ]*/,/[ ]*#+/),/#+/.test(e.startTag)&&(n=o.lastMatch.length),e.startTag=e.endTag="",e.findTags(null,/\s?(-+|=+)/),/=+/.test(e.endTag)&&(n=1),/-+/.test(e.endTag)&&(n=2),e.startTag=e.endTag="",e.skipLines(1,1);var i=0==n?2:n-1;if(i>0){var r=i>=2?"-":"=",l=e.selection.length;for(l>a&&(l=a),e.endTag="\n";l--;)e.endTag+=r}},c.doHorizontalRule=function(e,t){e.startTag="----------\n",e.selection="",e.skipLines(2,1,!0)}}();