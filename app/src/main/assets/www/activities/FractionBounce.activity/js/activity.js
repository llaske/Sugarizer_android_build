requirejs.config({baseUrl:"lib",paths:{activity:"../js"}});let app=new Vue({el:"#app",components:{"slope-template":SlopeTemplate},data:{currentenv:null,full:!1,context:null,mode:"fractions",img:null,interval:null,touchEvent:null,touchInterval:null,cx:100,cy:500,vx:0,vy:-7,radius:40,gravity:.05,damping:.1,traction:.1,paused:!0,onSlope:!0,SugarL10n:null,isFirstPauseClick:!0,frameInterval:20,launchDelay:1e3,height:100,parts:4,answer:-1,correctAnswers:0,bounceCount:0,stopAfter:10,log:{},userFractions:[],successSound:null,failSound:null,score:0,count:0,l10n:{stringFractionBounceActivity:"",stringTemplate:"",stringRestart:"",stringHelp:"",stringPlay:"",stringPause:"",stringSettings:"",stringBall:"",stringBg:"",stringFullscreen:"",stringFractions:"",stringSectors:"",stringPercents:"",stringHelpClickToStart:"",stringHelpBounceToPosition:"",stringHelpOfTheWay:"",stringHelpGameOver:"",stringPrevShort:"",stringNextShort:"",stringEndShort:"",stringTutoTitle:"",stringTutoContent:"",stringTutoBallTitle:"",stringTutoBallContent:"",stringTutoBallControlsTitle:"",stringTutoBallControlsContent:"",stringTutoSlopeTitle:"",stringTutoSlopeContent:"",stringTutoLogTitle:"",stringTutoLogContent:"",stringTutoPlayTitle:"",stringTutoPlayContent:"",stringTutoSettingsTitle:"",stringTutoSettingsContent:"",stringTutoBallSelectTitle:"",stringTutoBallSelectContent:"",stringTutoBgSelectTitle:"",stringTutoBgSelectContent:"",stringTutoFractionsModeTitle:"",stringTutoFractionsModeContent:"",stringTutoSectorsModeTitle:"",stringTutoSectorsModeContent:"",stringTutoPercentsModeTitle:"",stringTutoPercentsModeContent:""},acceleration:{},accelerationInterval:null},computed:{helpText:function(){return-1==this.answer?this.l10n.stringHelpClickToStart:this.paused&&0==this.bounceCount?this.l10n.stringHelpGameOver:"percents"==this.mode?this.l10n.stringHelpBounceToPosition+" "+Math.floor(this.answer/this.parts*100)+"% "+this.l10n.stringHelpOfTheWay:this.l10n.stringHelpBounceToPosition+" "+this.answer+"/"+this.parts+" "+this.l10n.stringHelpOfTheWay},isPauseAvailable:function(){return!this.onSlope||this.isFirstPauseClick}},mounted:function(){var t=this;window.addEventListener("resize",(function(){t.init()})),this.init(),this.$refs.SugarDevice.isMobile()&&this.$refs.SugarDevice.watchAcceleration(2*this.frameInterval),this.SugarL10n=this.$refs.SugarL10n},watch:{bounceCount:function(t){0===t&&(this.isFirstPauseClick=!0,this.changeGameState(),this.isFirstPauseClick=!0)}},methods:{initialized:function(){this.currentenv=this.$refs.SugarActivity.getEnvironment()},localized:function(){this.$refs.SugarL10n.localize(this.l10n)},onJournalDataLoaded:function(t,i){console.log("Existing instance"),this.userFractions=t.userFractions},onJournalLoadError:function(t){console.log("Error loading from journal")},fullscreen:function(){this.$refs.SugarToolbar.hide(),this.full=!0,this.init()},unfullscreen:function(){this.$refs.SugarToolbar.show(),this.full=!1,this.init()},init:function(){let t=this;mainCanvas.width=window.innerWidth,this.full?mainCanvas.height=window.innerHeight:mainCanvas.height=window.innerHeight-56,this.$refs.slopecanvas.initSlope(),this.context=mainCanvas.getContext("2d"),this.img=document.createElement("img"),this.context.translate(-this.radius,-2*this.radius),this.img.onload=function(){"d"==t.img.getAttribute("src")[0]?(t.context.translate(0,t.radius),t.context.drawImage(t.img,t.cx,t.cy,2*t.radius,2*t.radius),t.context.translate(0,-t.radius),t.createTopRectangle()):t.context.drawImage(t.img,t.cx,t.cy)},this.img.src="images/soccerball.svg",this.img.width=this.radius,this.img.height=this.radius,this.img.style.width=this.radius,this.img.style.height=this.radius,this.cx=mainCanvas.width/2,this.cy=this.calcY(mainCanvas.width/2)-this.radius,null!=this.successSound&&null!=this.failSound||this.initSounds(),document.getElementById("slopeCanvas").addEventListener("click",this.startGame)},initSounds:function(){this.successSound=document.createElement("audio"),this.successSound.src="./audio/success.mp3",this.successSound.setAttribute("preload","auto"),this.successSound.setAttribute("controls","none"),this.successSound.style.display="none",document.body.appendChild(this.successSound),this.failSound=document.createElement("audio"),this.failSound.src="./audio/fail.mp3",this.failSound.setAttribute("preload","auto"),this.failSound.setAttribute("controls","none"),this.failSound.style.display="none",document.body.appendChild(this.failSound)},startGame:function(t){let i=t.pageX,s=t.pageY;i<=this.cx+this.radius&&i>=this.cx-this.radius&&s<=this.cy+5*this.radius/2&&s>=this.cy+this.radius/2&&this.changeGameState()},changeGameState:function(){this.isPauseAvailable&&(this.paused=!this.paused,this.paused||(this.launch(),30==this.count&&(this.score=0,this.count=0,Score.innerHTML=" ")),this.isFirstPauseClick&&(this.isFirstPauseClick=!1),document.getElementById("slopeCanvas").removeEventListener("click",this.startGame))},launch:function(){this.bounceCount==this.stopAfter?(this.changeGameState(),this.bounceCount=0):this.onSlope?(0==this.bounceCount&&(this.log={},this.correctAnswers=0,this.isFirstPauseClick=!0),this.vy=-1*Math.sqrt(window.innerHeight)/3.9,this.cy-=this.cy+this.radius-this.calcY(this.cx)+1,this.onSlope=!1,this.next()):this.interval=setInterval(this.drawBall,this.frameInterval)},next:function(){if(1==Math.floor(2*Math.random())&&this.userFractions.length>0){let t=Math.floor(Math.random()*this.userFractions.length);this.parts=this.userFractions[t].den,this.answer=this.userFractions[t].num}else this.parts=Math.floor(5*Math.random()+3),this.answer=Math.floor(Math.random()*(this.parts-1)+1);this.$refs.slopecanvas.updateSlope(this.parts),document.addEventListener("keydown",this.changeSpeed),slopeCanvas.addEventListener("touchstart",this.onTouchStart),slopeCanvas.addEventListener("mousedown",this.onTouchStart),slopeCanvas.addEventListener("touchend",this.onTouchEnd),slopeCanvas.addEventListener("mouseup",this.onTouchEnd),this.interval=setInterval(this.drawBall,this.frameInterval)},drawBall:function(){let t=this;if(this.clearCanvas(),this.paused&&clearInterval(this.interval),this.cx+this.radius>=mainCanvas.width?(this.vx=-this.vx*this.damping,this.cx=mainCanvas.width-this.radius):this.cx-this.radius<=0&&(this.vx=-this.vx*this.damping,this.cx=this.radius),this.cy+this.radius>=this.calcY(this.cx)){this.vx=0,document.removeEventListener("keydown",this.changeSpeed),slopeCanvas.removeEventListener("touchstart",this.onTouchStart),slopeCanvas.removeEventListener("mousedown",this.onTouchStart),this.onTouchEnd();let i=this.$refs.slopecanvas.checkAnswer();this.count++,i==this.answer?(this.successSound.play(),this.score++):this.failSound.play(),30==this.count&&(Score.innerHTML=this.SugarL10n.get("Score")+" "+Math.round(this.score/3)+"/10"),this.onSlope=!0,this.vy<.5&&(i==this.answer?(this.correctAnswers++,this.log.hasOwnProperty(this.answer+"/"+this.parts)?this.log[this.answer+"/"+this.parts].push(!0):this.log[this.answer+"/"+this.parts]=[!0]):this.log.hasOwnProperty(this.answer+"/"+this.parts)?this.log[this.answer+"/"+this.parts].push(!1):this.log[this.answer+"/"+this.parts]=[!1],clearInterval(this.interval),this.bounceCount++,setTimeout((function(){t.launch(),t.launchDelay-100>0&&(t.launchDelay-=100)}),this.launchDelay)),this.vy=-this.vy*this.damping,this.cy=this.calcY(this.cx)-this.radius,this.vx*=this.traction}else this.cy-this.radius<=0&&(this.vy=-this.vy*this.damping,this.cy=this.radius);this.vy+=this.gravity,this.cx+=this.vx,this.cy+=this.vy,this.context.font="24px Times New Roman";let i="";switch(this.mode){case"percents":i=Math.floor(this.answer/this.parts*100)+"%","d"==this.img.getAttribute("src")[0]?(this.context.translate(0,this.radius),this.context.drawImage(this.img,this.cx,this.cy,2*this.radius,2*this.radius),this.context.translate(0,-this.radius),this.createTopRectangle()):this.context.drawImage(this.img,this.cx,this.cy);break;case"fractions":i=this.answer+"/"+this.parts,"d"==this.img.getAttribute("src")[0]?(this.context.translate(0,this.radius),this.context.drawImage(this.img,this.cx,this.cy,2*this.radius,2*this.radius),this.context.translate(0,-this.radius),this.createTopRectangle()):this.context.drawImage(this.img,this.cx,this.cy);break;case"sectors":i=this.answer+"/"+this.parts,this.context.translate(this.radius,2*this.radius),this.context.fillStyle=this.currentenv.user.colorvalue.fill,this.context.beginPath(),this.context.moveTo(this.cx,this.cy),this.context.arc(this.cx,this.cy,this.radius,0-this.toRadians(90),this.toRadians(this.answer/this.parts*360)-this.toRadians(90)),this.context.lineTo(this.cx,this.cy),this.context.closePath(),this.context.fill(),this.context.fillStyle=this.currentenv.user.colorvalue.stroke,this.context.beginPath(),this.context.moveTo(this.cx,this.cy),this.context.arc(this.cx,this.cy,this.radius,this.toRadians(this.answer/this.parts*360)-this.toRadians(90),0-this.toRadians(90)),this.context.lineTo(this.cx,this.cy),this.context.closePath(),this.context.fill(),this.context.strokeStyle=this.currentenv.user.colorvalue.stroke,this.context.beginPath(),this.context.arc(this.cx,this.cy,this.radius,0,this.toRadians(360)),this.context.closePath(),this.context.stroke(),this.context.translate(-this.radius,-2*this.radius),this.createTopRectangle()}this.context.fillStyle="#000",this.context.textAlign="center",this.context.fillText(i,t.cx+this.radius,t.cy+this.radius-15)},toRadians:function(t){return t*Math.PI/180},createTopRectangle:function(){this.context.fillStyle="#fff",this.context.beginPath(),this.context.moveTo(this.cx+10,this.cy),this.context.lineTo(this.cx+2*this.radius-10,this.cy),this.context.quadraticCurveTo(this.cx+2*this.radius,this.cy,this.cx+2*this.radius,this.cy+10),this.context.lineTo(this.cx+2*this.radius,this.cy+35-10),this.context.quadraticCurveTo(this.cx+2*this.radius,this.cy+35,this.cx+2*this.radius-10,this.cy+35),this.context.lineTo(this.cx+10,this.cy+35),this.context.quadraticCurveTo(this.cx,this.cy+35,this.cx,this.cy+35-10),this.context.lineTo(this.cx,this.cy+10),this.context.quadraticCurveTo(this.cx,this.cy,this.cx+10,this.cy),this.context.closePath(),this.context.fill()},clearCanvas:function(){this.context.translate(this.radius,2*this.radius),this.context.clearRect(0,0,mainCanvas.width,mainCanvas.height),this.context.translate(-this.radius,-2*this.radius)},accelerationChanged:function(t){this.acceleration={x:t.x,y:t.y,z:t.z,type:t.type},this.accelerationUpdate()},accelerationUpdate(){let t=this;this.paused||null==this.acceleration.x?clearInterval(this.accelerationInterval):this.accelerationInterval||(this.accelerationInterval=setInterval((()=>{t.changeSpeed({acceleration:t.acceleration})}),2*this.frameInterval))},onTouchStart:function(t){this.touchEvent=t,this.changeSpeed(),this.touchInterval=setInterval(this.changeSpeed,2*this.frameInterval)},onTouchEnd:function(t){this.touchEvent=null,clearInterval(this.touchInterval)},changeSpeed:function(t){let i=this;if(this.touchEvent)this.touchEvent.touches&&this.touchEvent.touches[0].clientX>this.cx||this.touchEvent.clientX>this.cx?this.vx+=10:this.vx-=10;else if(t.acceleration){if(this.paused||this.onSlope)return;t.acceleration.x<-4.5?t.acceleration.y>4.75?this.vx-=10:t.acceleration.y<-4.75&&(this.vx+=10):(t.acceleration.x<=4.5&&t.acceleration.x>=-4.5||t.acceleration.x>4.5)&&(t.acceleration.y>4.75?this.vx+=10:t.acceleration.y<-4.75&&(this.vx-=10))}else switch(t.keyCode){case 37:this.vx-=10;break;case 39:this.vx+=10}setTimeout((function(){i.vx=0}),this.frameInterval)},calcY:function(t){return-this.height/mainCanvas.width*t+mainCanvas.height},onFractionAdded:function(t){this.userFractions.push({num:t.numerator,den:t.denominator})},onBallSelected:function(t){if(this.clearCanvas(),"journal-ball"!=t.ball)switch(this.img.src="images/"+t.ball+".svg",t.ball){case"rugbyball":case"soccerball":document.body.style.backgroundImage="url(images/grass_background.png)";break;case"bowlingball":case"basketball":document.body.style.backgroundImage="url(images/parquet_background.png)";break;case"feather":document.body.style.backgroundImage="url(images/feather_background.png)";break;case"beachball":document.body.style.backgroundImage="url(images/beach_background.png)"}else this.insertImage("ball")},onBgSelected:function(t){if("journal-bg"!=t.bg)switch(document.body.style.backgroundSize="cover",t.bg){case"grass":document.body.style.backgroundImage="url(images/grass_background.png)";break;case"wood":document.body.style.backgroundImage="url(images/parquet_background.png)";break;case"clouds":document.body.style.backgroundImage="url(images/feather_background.png)";break;case"sand":document.body.style.backgroundImage="url(images/beach_background.png)"}else this.insertImage("bg")},insertImage:function(t){let i=this;requirejs(["sugar-web/datastore","sugar-web/graphics/journalchooser"],(function(s,e){setTimeout((function(){e.show((function(e){e?new s.DatastoreObject(e.objectId).loadAsText((function(s,e,n){"ball"==t?i.img.src=n:"bg"==t&&(document.body.style.backgroundImage="url("+n+")",document.body.style.backgroundSize="contain")})):"ball"==t&&i.img.onload()}),{mimetype:"image/png"},{mimetype:"image/jpeg"})}),0)}))},changeMode:function(t){this.mode=t},onHelp:function(t){var i=[{title:this.l10n.stringTutoTitle,intro:this.l10n.stringTutoContent},{element:"#mainCanvas",position:"top",backdrop:!1,title:this.l10n.stringTutoBallTitle,intro:this.l10n.stringTutoBallContent},{element:"#mainCanvas",position:"top",title:this.l10n.stringTutoBallControlsTitle,intro:this.l10n.stringTutoBallControlsContent},{element:"#slopeCanvas",position:"top",backdrop:!1,title:this.l10n.stringTutoSlopeTitle,intro:this.l10n.stringTutoSlopeContent},{element:".log",position:"right",title:this.l10n.stringTutoLogTitle,intro:this.l10n.stringTutoLogContent},{element:"#play-button",position:"bottom",title:this.l10n.stringTutoPlayTitle,intro:this.l10n.stringTutoPlayContent},{element:"#pause-button",position:"bottom",title:this.l10n.stringTutoPlayTitle,intro:this.l10n.stringTutoPlayContent},{element:"#settings-button",position:"bottom",title:this.l10n.stringTutoSettingsTitle,intro:this.l10n.stringTutoSettingsContent},{element:"#ball-button",position:"bottom",title:this.l10n.stringTutoBallSelectTitle,intro:this.l10n.stringTutoBallSelectContent},{element:"#bg-button",position:"bottom",title:this.l10n.stringTutoBgSelectTitle,intro:this.l10n.stringTutoBgSelectContent},{element:"#fractions-button",position:"bottom",title:this.l10n.stringTutoFractionsModeTitle,intro:this.l10n.stringTutoFractionsModeContent},{element:"#sectors-button",position:"bottom",title:this.l10n.stringTutoSectorsModeTitle,intro:this.l10n.stringTutoSectorsModeContent},{element:"#percents-button",position:"bottom",title:this.l10n.stringTutoPercentsModeTitle,intro:this.l10n.stringTutoPercentsModeContent}];this.$refs.SugarTutorial.show(i)},onStop:function(){var t={userFractions:this.userFractions};this.$refs.SugarJournal.saveData(t),this.$refs.SugarDevice.vibrate(100)}}});