/*!
 * Paper.js v0.9.22 - The Swiss Army Knife of Vector Graphics Scripting.
 * http://paperjs.org/
 *
 * Copyright (c) 2011 - 2014, Juerg Lehni & Jonathan Puckey
 * http://scratchdisk.com/ & http://jonathanpuckey.com/
 *
 * Distributed under the MIT license. See LICENSE file for details.
 *
 * All rights reserved.
 *
 * Date: Sat Feb 28 19:20:48 2015 +0100
 *
 ***
 *
 * Straps.js - Class inheritance library with support for bean-style accessors
 *
 * Copyright (c) 2006 - 2013 Juerg Lehni
 * http://scratchdisk.com/
 *
 * Distributed under the MIT license.
 *
 ***
 *
 * Acorn.js
 * http://marijnhaverbeke.nl/acorn/
 *
 * Acorn is a tiny, fast JavaScript parser written in JavaScript,
 * created by Marijn Haverbeke and released under an MIT license.
 *
 */
var paper=new function(p){var w=new function(){function i(p,M,z,k,A){function o(S,T){"string"==typeof(T=T||(T=I(M,S))&&(T.get?T:T.value))&&"#"===T[0]&&(T=p[T.substring(1)]||T);var L,N="function"==typeof T,B=T,D=A||N?T&&T.get?S in p:p[S]:null;A&&D||(N&&D&&(T.base=D),N&&!1!==k&&(L=S.match(/^([gs]et|is)(([A-Z])(.*))$/))&&(O[L[3].toLowerCase()+L[4]]=L[2]),B&&!N&&B.get&&"function"==typeof B.get&&w.isPlainObject(B)||(B={value:B,writable:!0}),(I(p,S)||{configurable:!0}).configurable&&(B.configurable=!0,B.enumerable=z),c(p,S,B))}var O={};if(M){for(var T in M)M.hasOwnProperty(T)&&!S.test(T)&&o(T);for(var T in O){var L=O[T],N=p["set"+L],B=p["get"+L]||N&&p["is"+L];!B||!0!==k&&0!==B.length||o(T,{get:B,set:N})}}return p}function n(p,w,S){return p&&("length"in p&&!p.getLength&&"number"==typeof p.length?M:o).call(p,w,S=S||p),S}function r(p,w,S){for(var M in w)!w.hasOwnProperty(M)||S&&S[M]||(p[M]=w[M]);return p}var S=/^(statics|enumerable|beans|preserve)$/,M=[].forEach||function(p,w){for(var S=0,M=this.length;M>S;S++)p.call(w,this[S],S,this)},o=function(p,w){for(var S in this)this.hasOwnProperty(S)&&p.call(w,this[S],S,this)},z=Object.create||function(p){return{__proto__:p}},I=Object.getOwnPropertyDescriptor||function(p,w){var S=p.__lookupGetter__&&p.__lookupGetter__(w);return S?{get:S,set:p.__lookupSetter__(w),enumerable:!0,configurable:!0}:p.hasOwnProperty(w)?{value:p[w],enumerable:!0,configurable:!0,writable:!0}:null},k=Object.defineProperty||function(p,w,S){return(S.get||S.set)&&p.__defineGetter__?(S.get&&p.__defineGetter__(w,S.get),S.set&&p.__defineSetter__(w,S.set)):p[w]=S.value,p},c=function(p,w,S){return delete p[w],k(p,w,S)};return i((function(){for(var p=0,w=arguments.length;w>p;p++)r(this,arguments[p])}),{inject:function(p){if(p){var w=!0===p.statics?p:p.statics,S=p.beans,M=p.preserve;w!==p&&i(this.prototype,p,p.enumerable,S,M),i(this,w,!0,S,M)}for(var z=1,I=arguments.length;I>z;z++)this.inject(arguments[z]);return this},extend:function(){for(var p,w=this,S=0,M=arguments.length;M>S&&!(p=arguments[S].initialize);S++);return p=p||function(){w.apply(this,arguments)},p.prototype=z(this.prototype),p.base=w,c(p.prototype,"constructor",{value:p,writable:!0,configurable:!0}),i(p,this,!0),arguments.length?this.inject.apply(p,arguments):p}},!0).inject({inject:function(){for(var p=0,w=arguments.length;w>p;p++){var S=arguments[p];S&&i(this,S,S.enumerable,S.beans,S.preserve)}return this},extend:function(){var p=z(this);return p.inject.apply(p,arguments)},each:function(p,w){return n(this,p,w)},set:function(p){return r(this,p)},clone:function(){return new this.constructor(this)},statics:{each:n,create:z,define:c,describe:I,set:r,clone:function(p){return r(new p.constructor,p)},isPlainObject:function(p){var S=null!=p&&p.constructor;return S&&(S===Object||S===w||"Object"===S.name)},pick:function(w,S){return w!==p?w:S}}})};"undefined"!=typeof module&&(module.exports=w),w.inject({toString:function(){return null!=this._id?(this._class||"Object")+(this._name?" '"+this._name+"'":" @"+this._id):"{ "+w.each(this,(function(p,w){if(!/^_/.test(w)){var S=typeof p;this.push(w+": "+("number"===S?I.instance.number(p):"string"===S?"'"+p+"'":p))}}),[]).join(", ")+" }"},getClassName:function(){return this._class||""},exportJSON:function(p){return w.exportJSON(this,p)},toJSON:function(){return w.serialize(this)},_set:function(S,M,z){if(S&&(z||w.isPlainObject(S))){var I=S._filtering||S;for(var k in I)if(I.hasOwnProperty(k)&&(!M||!M[k])){var A=S[k];A!==p&&(this[k]=A)}return!0}},statics:{exports:{enumerable:!0},extend:function ne(){var p=ne.base.apply(this,arguments),S=p.prototype._class;return S&&!w.exports[S]&&(w.exports[S]=p),p},equals:function(p,S){function n(p,w){for(var S in p)if(p.hasOwnProperty(S)&&!w.hasOwnProperty(S))return!1;return!0}if(p===S)return!0;if(p&&p.equals)return p.equals(S);if(S&&S.equals)return S.equals(p);if(Array.isArray(p)&&Array.isArray(S)){if(p.length!==S.length)return!1;for(var M=0,z=p.length;z>M;M++)if(!w.equals(p[M],S[M]))return!1;return!0}if(p&&"object"==typeof p&&S&&"object"==typeof S){if(!n(p,S)||!n(S,p))return!1;for(var M in p)if(p.hasOwnProperty(M)&&!w.equals(p[M],S[M]))return!1;return!0}return!1},read:function(S,M,z,I){if(this===w){var k=this.peek(S,M);return S.__index++,k}var A=this.prototype._readIndex,O=M||A&&S.__index||0;I||(I=S.length-O);var T=S[O];return T instanceof this||z&&z.readNull&&null==T&&1>=I?(A&&(S.__index=O+1),T&&z&&z.clone?T.clone():T):(T=w.create(this.prototype),A&&(T.__read=!0),T=T.initialize.apply(T,O>0||I<S.length?Array.prototype.slice.call(S,O,O+I):S)||T,A&&(S.__index=O+T.__read,T.__read=p),T)},peek:function(p,w){return p[p.__index=w||p.__index||0]},remain:function(p){return p.length-(p.__index||0)},readAll:function(p,w,S){for(var M,z=[],I=w||0,k=p.length;k>I;I++)z.push(Array.isArray(M=p[I])?this.read(M,0,S):this.read(p,I,S,1));return z},readNamed:function(S,M,z,I,k){var A=this.getNamed(S,M),O=A!==p;if(O){var T=S._filtered;T||((T=S._filtered=w.create(S[0]))._filtering=S[0]),T[M]=p}return this.read(O?[A]:S,z,I,k)},getNamed:function(S,M){var z=S[0];return S._hasObject===p&&(S._hasObject=1===S.length&&w.isPlainObject(z)),S._hasObject?M?z[M]:S._filtered||z:p},hasNamed:function(p,w){return!!this.getNamed(p,w)},isPlainValue:function(p,w){return this.isPlainObject(p)||Array.isArray(p)||w&&"string"==typeof p},serialize:function(p,S,M,z){S=S||{};var k,A=!z;if(A&&(S.formatter=new I(S.precision),z={length:0,definitions:{},references:{},add:function(p,w){var S="#"+p._id,M=this.references[S];if(!M){this.length++;var z=w.call(p),I=p._class;I&&z[0]!==I&&z.unshift(I),this.definitions[S]=z,M=this.references[S]=[S]}return M}}),p&&p._serialize){k=p._serialize(S,z);var O=p._class;!O||M||k._compact||k[0]===O||k.unshift(O)}else if(Array.isArray(p)){k=[];for(var T=0,L=p.length;L>T;T++)k[T]=w.serialize(p[T],S,M,z);M&&(k._compact=!0)}else if(w.isPlainObject(p))for(var T in k={},p)p.hasOwnProperty(T)&&(k[T]=w.serialize(p[T],S,M,z));else k="number"==typeof p?S.formatter.number(p,S.precision):p;return A&&z.length>0?[["dictionary",z.definitions],k]:k},deserialize:function(p,S,M){var z=p,I=!M;if(M=M||{},Array.isArray(p)){var k=p[0],A="dictionary"===k;if(!A){if(M.dictionary&&1==p.length&&/^#/.test(k))return M.dictionary[k];k=w.exports[k]}z=[];for(var O=k?1:0,T=p.length;T>O;O++)z.push(w.deserialize(p[O],S,M));if(A)M.dictionary=z[0];else if(k){var L=z;S?z=S(k,L):(z=w.create(k.prototype),k.apply(z,L))}}else if(w.isPlainObject(p))for(var N in z={},p)z[N]=w.deserialize(p[N],S,M);return I&&p&&p.length&&"dictionary"===p[0][0]?z[1]:z},exportJSON:function(p,S){var M=w.serialize(p,S);return S&&!1===S.asString?M:JSON.stringify(M)},importJSON:function(p,S){return w.deserialize("string"==typeof p?JSON.parse(p):p,(function(p,M){var z=S&&S.constructor===p?S:w.create(p.prototype),I=z===S;if(1===M.length&&z instanceof q&&(I||!(z instanceof Z))){var k=M[0];w.isPlainObject(k)&&(k.insert=!1)}return p.apply(z,M),I&&(S=null),z}))},splice:function(w,S,M,z){var I=S&&S.length,k=M===p;(M=k?w.length:M)>w.length&&(M=w.length);for(var A=0;I>A;A++)S[A]._index=M+A;if(k)return w.push.apply(w,S),[];var O=[M,z];S&&O.push.apply(O,S);for(var T=w.splice.apply(w,O),L=(A=0,T.length);L>A;A++)T[A]._index=p;for(A=M+I,L=w.length;L>A;A++)w[A]._index=A;return T},capitalize:function(p){return p.replace(/\b[a-z]/g,(function(p){return p.toUpperCase()}))},camelize:function(p){return p.replace(/-(.)/g,(function(p,w){return w.toUpperCase()}))},hyphenate:function(p){return p.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}}});var S={on:function(p,S){if("string"!=typeof p)w.each(p,(function(p,w){this.on(w,p)}),this);else{var M=this._eventTypes[p];if(M){var z=this._callbacks=this._callbacks||{};-1===(z=z[p]=z[p]||[]).indexOf(S)&&(z.push(S),M.install&&1==z.length&&M.install.call(this,p))}}return this},off:function(S,M){if("string"!=typeof S)return w.each(S,(function(p,w){this.off(w,p)}),this),p;var z,I=this._eventTypes[S],k=this._callbacks&&this._callbacks[S];return I&&k&&(!M||-1!==(z=k.indexOf(M))&&1===k.length?(I.uninstall&&I.uninstall.call(this,S),delete this._callbacks[S]):-1!==z&&k.splice(z,1)),this},once:function(p,w){return this.on(p,(function(){w.apply(this,arguments),this.off(p,w)}))},emit:function(p,w){var S=this._callbacks&&this._callbacks[p];if(!S)return!1;for(var M=[].slice.call(arguments,1),z=0,I=S.length;I>z;z++)if(!1===S[z].apply(this,M)&&w&&w.stop){w.stop();break}return!0},responds:function(p){return!(!this._callbacks||!this._callbacks[p])},attach:"#on",detach:"#off",fire:"#emit",_installEvents:function(p){var w=this._callbacks,S=p?"install":"uninstall";for(var M in w)if(w[M].length>0){var z=this._eventTypes[M][S];z&&z.call(this,M)}},statics:{inject:function re(p){var S=p._events;if(S){var M={};w.each(S,(function(S,z){var I="string"==typeof S,k=I?S:z,A=w.capitalize(k),O=k.substring(2).toLowerCase();M[O]=I?{}:S,k="_"+k,p["get"+A]=function(){return this[k]},p["set"+A]=function(p){var w=this[k];w&&this.off(O,w),p&&this.on(O,p),this[k]=p}})),p._eventTypes=M}return re.base.apply(this,arguments)}}},M=w.extend({_class:"PaperScope",initialize:function se(){paper=this,this.settings=new w({applyMatrix:!0,handleSize:4,hitTolerance:0}),this.project=null,this.projects=[],this.tools=[],this.palettes=[],this._id=se._id++,se._scopes[this._id]=this;var p=se.prototype;if(!this.support){var S=yt.getContext(1,1);p.support={nativeDash:"setLineDash"in S||"mozDash"in S,nativeBlendModes:wt.nativeModes},yt.release(S)}if(!this.browser){var M=p.browser={};navigator.userAgent.toLowerCase().replace(/(opera|chrome|safari|webkit|firefox|msie|trident|atom)\/?\s*([.\d]+)(?:.*version\/([.\d]+))?(?:.*rv\:([.\d]+))?/g,(function(p,w,S,z,I){if(!M.chrome){var k="opera"===w?z:S;"trident"===w&&(k=I,w="msie"),M.version=k,M.versionNumber=parseFloat(k),M.name=w,M[w]=!0}})),M.chrome&&delete M.webkit,M.atom&&delete M.chrome}},version:"0.9.22",getView:function(){return this.project&&this.project.getView()},getPaper:function(){return this},execute:function(p,w,S){paper.PaperScript.execute(p,this,w,S),ct.updateFocus()},install:function(p){var S=this;for(var M in w.each(["project","view","tool"],(function(M){w.define(p,M,{configurable:!0,get:function(){return S[M]}})})),this)!/^_/.test(M)&&this[M]&&(p[M]=this[M])},setup:function(p){return paper=this,this.project=new R(p),this},activate:function(){paper=this},clear:function(){for(var p=this.projects.length-1;p>=0;p--)this.projects[p].remove();for(p=this.tools.length-1;p>=0;p--)this.tools[p].remove();for(p=this.palettes.length-1;p>=0;p--)this.palettes[p].remove()},remove:function(){this.clear(),delete M._scopes[this._id]},statics:new function(){function t(p){return p+="Attribute",function(w,S){return w[p](S)||w[p]("data-paper-"+S)}}return{_scopes:{},_id:0,get:function(p){return this._scopes[p]||null},getAttribute:t("get"),hasAttribute:t("has")}}}),z=w.extend(S,{initialize:function(p){this._scope=paper,this._index=this._scope[this._list].push(this)-1,(p||!this._scope[this._reference])&&this.activate()},activate:function(){if(!this._scope)return!1;var p=this._scope[this._reference];return p&&p!==this&&p.emit("deactivate"),this._scope[this._reference]=this,this.emit("activate",p),!0},isActive:function(){return this._scope[this._reference]===this},remove:function(){return null!=this._index&&(w.splice(this._scope[this._list],null,this._index,1),this._scope[this._reference]==this&&(this._scope[this._reference]=null),this._scope=null,!0)}}),I=w.extend({initialize:function(p){this.precision=p||5,this.multiplier=Math.pow(10,this.precision)},number:function(p){return Math.round(p*this.multiplier)/this.multiplier},pair:function(p,w,S){return this.number(p)+(S||",")+this.number(w)},point:function(p,w){return this.number(p.x)+(w||",")+this.number(p.y)},size:function(p,w){return this.number(p.width)+(w||",")+this.number(p.height)},rectangle:function(p,w){return this.point(p,w)+(w||",")+this.size(p,w)}});I.instance=new I;var A=new function(){var p=[[.5773502691896257],[0,.7745966692414834],[.33998104358485626,.8611363115940526],[0,.5384693101056831,.906179845938664],[.2386191860831969,.6612093864662645,.932469514203152],[0,.4058451513773972,.7415311855993945,.9491079123427585],[.1834346424956498,.525532409916329,.7966664774136267,.9602898564975363],[0,.3242534234038089,.6133714327005904,.8360311073266358,.9681602395076261],[.14887433898163122,.4333953941292472,.6794095682990244,.8650633666889845,.9739065285171717],[0,.26954315595234496,.5190961292068118,.7301520055740494,.8870625997680953,.978228658146057],[.1252334085114689,.3678314989981802,.5873179542866175,.7699026741943047,.9041172563704749,.9815606342467192],[0,.2304583159551348,.44849275103644687,.6423493394403402,.8015780907333099,.9175983992229779,.9841830547185881],[.10805494870734367,.31911236892788974,.5152486363581541,.6872929048116855,.827201315069765,.9284348836635735,.9862838086968123],[0,.20119409399743451,.3941513470775634,.5709721726085388,.7244177313601701,.8482065834104272,.937273392400706,.9879925180204854],[.09501250983763744,.2816035507792589,.45801677765722737,.6178762444026438,.755404408355003,.8656312023878318,.9445750230732326,.9894009349916499]],w=[[1],[.8888888888888888,.5555555555555556],[.6521451548625461,.34785484513745385],[.5688888888888889,.47862867049936647,.23692688505618908],[.46791393457269104,.3607615730481386,.17132449237917036],[.4179591836734694,.3818300505051189,.27970539148927664,.1294849661688697],[.362683783378362,.31370664587788727,.22238103445337448,.10122853629037626],[.3302393550012598,.31234707704000286,.26061069640293544,.1806481606948574,.08127438836157441],[.29552422471475287,.26926671930999635,.21908636251598204,.1494513491505806,.06667134430868814],[.2729250867779006,.26280454451024665,.23319376459199048,.18629021092773426,.1255803694649046,.05566856711617366],[.24914704581340277,.2334925365383548,.20316742672306592,.16007832854334622,.10693932599531843,.04717533638651183],[.2325515532308739,.22628318026289723,.2078160475368885,.17814598076194574,.13887351021978725,.09212149983772845,.04048400476531588],[.2152638534631578,.2051984637212956,.18553839747793782,.15720316715819355,.12151857068790319,.08015808715976021,.03511946033175186],[.2025782419255613,.19843148532711158,.1861610000155622,.16626920581699392,.13957067792615432,.10715922046717194,.07036604748810812,.03075324199611727],[.1894506104550685,.18260341504492358,.16915651939500254,.14959598881657674,.12462897125553388,.09515851168249279,.062253523938647894,.027152459411754096]],S=Math.abs,M=Math.sqrt,z=Math.pow,I=112e-18;return{TOLERANCE:1e-6,EPSILON:1e-12,MACHINE_EPSILON:I,KAPPA:4*(M(2)-1)/3,isZero:function(p){return S(p)<=1e-12},integrate:function(S,M,z,I){for(var k=p[I-2],A=w[I-2],O=.5*(z-M),T=O+M,L=0,N=I+1>>1,B=1&I?A[L++]*S(T):0;N>L;){var D=O*k[L];B+=A[L++]*(S(T+D)+S(T-D))}return O*B},findRoot:function(p,w,M,z,I,k,A){for(var O=0;k>O;O++){var T=p(M),L=T/w(M),N=M-L;if(S(L)<A)return N;T>0?(I=M,M=z>=N?.5*(z+I):N):(z=M,M=N>=I?.5*(z+I):N)}return M},solveQuadratic:function(p,w,z,k,A,O){var T,L,N=0,B=1/0,D=w;if(S(L=(w/=2)*w-p*z)<I){var j=Math.pow,E=j(S(p*w*z),1/3);if(1e-8>E){var R=j(10,S(Math.floor(Math.log(E)*Math.LOG10E)));isFinite(R)||(R=0),L=(w*=R)*w-(p*=R)*(z*=R)}}if(S(p)<I){if(S(D)<I)return S(z)<I?-1:0;T=-z/D}else if(L>=-I){var F=M(L=0>L?0:L);if(w>=I&&I>=w)B=-(T=S(p)>=S(z)?F/p:-z/F);else{var q=-(w+(0>w?-1:1)*F);T=q/p,B=z/q}}return isFinite(T)&&(null==A||T>=A&&O>=T)&&(k[N++]=T),B!==T&&isFinite(B)&&(null==A||B>=A&&O>=B)&&(k[N++]=B),N},solveCubic:function(p,w,I,k,O,T,L){var N,B,D,j=0;if(0===p)p=w,B=I,D=k,N=1/0;else if(0===k)B=w,D=I,N=0;else{var E,R,F,q,V,Z,H;if(F=((H=p*(N=-w/p/3))+(B=H+w))*N+(D=B*N+I),V=z(S(q=(R=D*N+k)/p),1/3),(E=N-(Z=0>q?-1:1)*(V=(q=-F/p)>0?1.3247179572*Math.max(V,M(q)):V))!==N){do{if(R=(D=(B=(H=p*(N=E))+w)*N+I)*N+k,(E=0===(F=(H+B)*N+D)?N:N-R/F/1.0000000000000002)===N){N=E;break}}while(Z*E>Z*N);S(p)*N*N>S(k/N)&&(B=((D=-k/N)-I)/N)}}j=A.solveQuadratic(p,B,D,O,T,L);return isFinite(N)&&(0===j||N!==O[j-1])&&(null==T||N>=T&&L>=N)&&(O[j++]=N),j}}},O=w.extend({_class:"Point",_readIndex:!0,initialize:function(p,w){var S=typeof p;if("number"===S){var M="number"==typeof w;this.x=p,this.y=M?w:p,this.__read&&(this.__read=M?2:1)}else"undefined"===S||null===p?(this.x=this.y=0,this.__read&&(this.__read=null===p?1:0)):(Array.isArray(p)?(this.x=p[0],this.y=p.length>1?p[1]:p[0]):null!=p.x?(this.x=p.x,this.y=p.y):null!=p.width?(this.x=p.width,this.y=p.height):null!=p.angle?(this.x=p.length,this.y=0,this.setAngle(p.angle)):(this.x=this.y=0,this.__read&&(this.__read=0)),this.__read&&(this.__read=1))},set:function(p,w){return this.x=p,this.y=w,this},equals:function(p){return this===p||p&&(this.x===p.x&&this.y===p.y||Array.isArray(p)&&this.x===p[0]&&this.y===p[1])||!1},clone:function(){return new O(this.x,this.y)},toString:function(){var p=I.instance;return"{ x: "+p.number(this.x)+", y: "+p.number(this.y)+" }"},_serialize:function(p){var w=p.formatter;return[w.number(this.x),w.number(this.y)]},getLength:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},setLength:function(p){if(this.isZero()){var w=this._angle||0;this.set(Math.cos(w)*p,Math.sin(w)*p)}else{var S=p/this.getLength();A.isZero(S)&&this.getAngle(),this.set(this.x*S,this.y*S)}},getAngle:function(){return 180*this.getAngleInRadians.apply(this,arguments)/Math.PI},setAngle:function(p){this.setAngleInRadians.call(this,p*Math.PI/180)},getAngleInDegrees:"#getAngle",setAngleInDegrees:"#setAngle",getAngleInRadians:function(){if(arguments.length){var p=O.read(arguments),w=this.getLength()*p.getLength();if(A.isZero(w))return NaN;var S=this.dot(p)/w;return Math.acos(-1>S?-1:S>1?1:S)}return this.isZero()?this._angle||0:this._angle=Math.atan2(this.y,this.x)},setAngleInRadians:function(p){if(this._angle=p,!this.isZero()){var w=this.getLength();this.set(Math.cos(p)*w,Math.sin(p)*w)}},getQuadrant:function(){return this.x>=0?this.y>=0?1:4:this.y>=0?2:3}},{beans:!1,getDirectedAngle:function(){var p=O.read(arguments);return 180*Math.atan2(this.cross(p),this.dot(p))/Math.PI},getDistance:function(){var p=O.read(arguments),S=p.x-this.x,M=p.y-this.y,z=S*S+M*M;return w.read(arguments)?z:Math.sqrt(z)},normalize:function(w){w===p&&(w=1);var S=this.getLength(),M=0!==S?w/S:0,z=new O(this.x*M,this.y*M);return M>=0&&(z._angle=this._angle),z},rotate:function(p,w){if(0===p)return this.clone();p=p*Math.PI/180;var S=w?this.subtract(w):this,M=Math.sin(p),z=Math.cos(p);return S=new O(S.x*z-S.y*M,S.x*M+S.y*z),w?S.add(w):S},transform:function(p){return p?p._transformPoint(this):this},add:function(){var p=O.read(arguments);return new O(this.x+p.x,this.y+p.y)},subtract:function(){var p=O.read(arguments);return new O(this.x-p.x,this.y-p.y)},multiply:function(){var p=O.read(arguments);return new O(this.x*p.x,this.y*p.y)},divide:function(){var p=O.read(arguments);return new O(this.x/p.x,this.y/p.y)},modulo:function(){var p=O.read(arguments);return new O(this.x%p.x,this.y%p.y)},negate:function(){return new O(-this.x,-this.y)},isInside:function(){return B.read(arguments).contains(this)},isClose:function(p,w){return this.getDistance(p)<w},isColinear:function(p){return Math.abs(this.cross(p))<1e-12},isOrthogonal:function(p){return Math.abs(this.dot(p))<1e-12},isZero:function(){return A.isZero(this.x)&&A.isZero(this.y)},isNaN:function(){return isNaN(this.x)||isNaN(this.y)},dot:function(){var p=O.read(arguments);return this.x*p.x+this.y*p.y},cross:function(){var p=O.read(arguments);return this.x*p.y-this.y*p.x},project:function(){var p=O.read(arguments);if(p.isZero())return new O(0,0);var w=this.dot(p)/p.dot(p);return new O(p.x*w,p.y*w)},statics:{min:function(){var p=O.read(arguments),w=O.read(arguments);return new O(Math.min(p.x,w.x),Math.min(p.y,w.y))},max:function(){var p=O.read(arguments),w=O.read(arguments);return new O(Math.max(p.x,w.x),Math.max(p.y,w.y))},random:function(){return new O(Math.random(),Math.random())}}},w.each(["round","ceil","floor","abs"],(function(p){var w=Math[p];this[p]=function(){return new O(w(this.x),w(this.y))}}),{})),T=O.extend({initialize:function(p,w,S,M){this._x=p,this._y=w,this._owner=S,this._setter=M},set:function(p,w,S){return this._x=p,this._y=w,S||this._owner[this._setter](this),this},getX:function(){return this._x},setX:function(p){this._x=p,this._owner[this._setter](this)},getY:function(){return this._y},setY:function(p){this._y=p,this._owner[this._setter](this)}}),L=w.extend({_class:"Size",_readIndex:!0,initialize:function(p,w){var S=typeof p;if("number"===S){var M="number"==typeof w;this.width=p,this.height=M?w:p,this.__read&&(this.__read=M?2:1)}else"undefined"===S||null===p?(this.width=this.height=0,this.__read&&(this.__read=null===p?1:0)):(Array.isArray(p)?(this.width=p[0],this.height=p.length>1?p[1]:p[0]):null!=p.width?(this.width=p.width,this.height=p.height):null!=p.x?(this.width=p.x,this.height=p.y):(this.width=this.height=0,this.__read&&(this.__read=0)),this.__read&&(this.__read=1))},set:function(p,w){return this.width=p,this.height=w,this},equals:function(p){return p===this||p&&(this.width===p.width&&this.height===p.height||Array.isArray(p)&&this.width===p[0]&&this.height===p[1])||!1},clone:function(){return new L(this.width,this.height)},toString:function(){var p=I.instance;return"{ width: "+p.number(this.width)+", height: "+p.number(this.height)+" }"},_serialize:function(p){var w=p.formatter;return[w.number(this.width),w.number(this.height)]},add:function(){var p=L.read(arguments);return new L(this.width+p.width,this.height+p.height)},subtract:function(){var p=L.read(arguments);return new L(this.width-p.width,this.height-p.height)},multiply:function(){var p=L.read(arguments);return new L(this.width*p.width,this.height*p.height)},divide:function(){var p=L.read(arguments);return new L(this.width/p.width,this.height/p.height)},modulo:function(){var p=L.read(arguments);return new L(this.width%p.width,this.height%p.height)},negate:function(){return new L(-this.width,-this.height)},isZero:function(){return A.isZero(this.width)&&A.isZero(this.height)},isNaN:function(){return isNaN(this.width)||isNaN(this.height)},statics:{min:function(p,w){return new L(Math.min(p.width,w.width),Math.min(p.height,w.height))},max:function(p,w){return new L(Math.max(p.width,w.width),Math.max(p.height,w.height))},random:function(){return new L(Math.random(),Math.random())}}},w.each(["round","ceil","floor","abs"],(function(p){var w=Math[p];this[p]=function(){return new L(w(this.width),w(this.height))}}),{})),N=L.extend({initialize:function(p,w,S,M){this._width=p,this._height=w,this._owner=S,this._setter=M},set:function(p,w,S){return this._width=p,this._height=w,S||this._owner[this._setter](this),this},getWidth:function(){return this._width},setWidth:function(p){this._width=p,this._owner[this._setter](this)},getHeight:function(){return this._height},setHeight:function(p){this._height=p,this._owner[this._setter](this)}}),B=w.extend({_class:"Rectangle",_readIndex:!0,beans:!0,initialize:function(S,M,z,I){var k=typeof S,A=0;if("number"===k?(this.x=S,this.y=M,this.width=z,this.height=I,A=4):"undefined"===k||null===S?(this.x=this.y=this.width=this.height=0,A=null===S?1:0):1===arguments.length&&(Array.isArray(S)?(this.x=S[0],this.y=S[1],this.width=S[2],this.height=S[3],A=1):S.x!==p||S.width!==p?(this.x=S.x||0,this.y=S.y||0,this.width=S.width||0,this.height=S.height||0,A=1):S.from===p&&S.to===p&&(this.x=this.y=this.width=this.height=0,this._set(S),A=1)),!A){var T=O.readNamed(arguments,"from"),N=w.peek(arguments);if(this.x=T.x,this.y=T.y,N&&N.x!==p||w.hasNamed(arguments,"to")){var B=O.readNamed(arguments,"to");this.width=B.x-T.x,this.height=B.y-T.y,this.width<0&&(this.x=B.x,this.width=-this.width),this.height<0&&(this.y=B.y,this.height=-this.height)}else{var D=L.read(arguments);this.width=D.width,this.height=D.height}A=arguments.__index}this.__read&&(this.__read=A)},set:function(p,w,S,M){return this.x=p,this.y=w,this.width=S,this.height=M,this},clone:function(){return new B(this.x,this.y,this.width,this.height)},equals:function(p){var S=w.isPlainValue(p)?B.read(arguments):p;return S===this||S&&this.x===S.x&&this.y===S.y&&this.width===S.width&&this.height===S.height||!1},toString:function(){var p=I.instance;return"{ x: "+p.number(this.x)+", y: "+p.number(this.y)+", width: "+p.number(this.width)+", height: "+p.number(this.height)+" }"},_serialize:function(p){var w=p.formatter;return[w.number(this.x),w.number(this.y),w.number(this.width),w.number(this.height)]},getPoint:function(p){return new(p?O:T)(this.x,this.y,this,"setPoint")},setPoint:function(){var p=O.read(arguments);this.x=p.x,this.y=p.y},getSize:function(p){return new(p?L:N)(this.width,this.height,this,"setSize")},setSize:function(){var p=L.read(arguments);this._fixX&&(this.x+=(this.width-p.width)*this._fixX),this._fixY&&(this.y+=(this.height-p.height)*this._fixY),this.width=p.width,this.height=p.height,this._fixW=1,this._fixH=1},getLeft:function(){return this.x},setLeft:function(p){this._fixW||(this.width-=p-this.x),this.x=p,this._fixX=0},getTop:function(){return this.y},setTop:function(p){this._fixH||(this.height-=p-this.y),this.y=p,this._fixY=0},getRight:function(){return this.x+this.width},setRight:function(w){this._fixX!==p&&1!==this._fixX&&(this._fixW=0),this._fixW?this.x=w-this.width:this.width=w-this.x,this._fixX=1},getBottom:function(){return this.y+this.height},setBottom:function(w){this._fixY!==p&&1!==this._fixY&&(this._fixH=0),this._fixH?this.y=w-this.height:this.height=w-this.y,this._fixY=1},getCenterX:function(){return this.x+.5*this.width},setCenterX:function(p){this.x=p-.5*this.width,this._fixX=.5},getCenterY:function(){return this.y+.5*this.height},setCenterY:function(p){this.y=p-.5*this.height,this._fixY=.5},getCenter:function(p){return new(p?O:T)(this.getCenterX(),this.getCenterY(),this,"setCenter")},setCenter:function(){var p=O.read(arguments);return this.setCenterX(p.x),this.setCenterY(p.y),this},getArea:function(){return this.width*this.height},isEmpty:function(){return 0===this.width||0===this.height},contains:function(w){return w&&w.width!==p||4==(Array.isArray(w)?w:arguments).length?this._containsRectangle(B.read(arguments)):this._containsPoint(O.read(arguments))},_containsPoint:function(p){var w=p.x,S=p.y;return w>=this.x&&S>=this.y&&w<=this.x+this.width&&S<=this.y+this.height},_containsRectangle:function(p){var w=p.x,S=p.y;return w>=this.x&&S>=this.y&&w+p.width<=this.x+this.width&&S+p.height<=this.y+this.height},intersects:function(){var p=B.read(arguments);return p.x+p.width>this.x&&p.y+p.height>this.y&&p.x<this.x+this.width&&p.y<this.y+this.height},touches:function(){var p=B.read(arguments);return p.x+p.width>=this.x&&p.y+p.height>=this.y&&p.x<=this.x+this.width&&p.y<=this.y+this.height},intersect:function(){var p=B.read(arguments),w=Math.max(this.x,p.x),S=Math.max(this.y,p.y),M=Math.min(this.x+this.width,p.x+p.width),z=Math.min(this.y+this.height,p.y+p.height);return new B(w,S,M-w,z-S)},unite:function(){var p=B.read(arguments),w=Math.min(this.x,p.x),S=Math.min(this.y,p.y),M=Math.max(this.x+this.width,p.x+p.width),z=Math.max(this.y+this.height,p.y+p.height);return new B(w,S,M-w,z-S)},include:function(){var p=O.read(arguments),w=Math.min(this.x,p.x),S=Math.min(this.y,p.y),M=Math.max(this.x+this.width,p.x),z=Math.max(this.y+this.height,p.y);return new B(w,S,M-w,z-S)},expand:function(){var p=L.read(arguments),w=p.width,S=p.height;return new B(this.x-w/2,this.y-S/2,this.width+w,this.height+S)},scale:function(w,S){return this.expand(this.width*w-this.width,this.height*(S===p?w:S)-this.height)}},w.each([["Top","Left"],["Top","Right"],["Bottom","Left"],["Bottom","Right"],["Left","Center"],["Top","Center"],["Right","Center"],["Bottom","Center"]],(function(p,w){var S=p.join(""),M=/^[RL]/.test(S);w>=4&&(p[1]+=M?"Y":"X");var z=p[M?0:1],I=p[M?1:0],k="get"+z,A="get"+I,L="set"+z,N="set"+I,B="set"+S;this["get"+S]=function(p){return new(p?O:T)(this[k](),this[A](),this,B)},this[B]=function(){var p=O.read(arguments);this[L](p.x),this[N](p.y)}}),{beans:!0})),D=B.extend({initialize:function(p,w,S,M,z,I){this.set(p,w,S,M,!0),this._owner=z,this._setter=I},set:function(p,w,S,M,z){return this._x=p,this._y=w,this._width=S,this._height=M,z||this._owner[this._setter](this),this}},new function(){var p=B.prototype;return w.each(["x","y","width","height"],(function(p){var S=w.capitalize(p),M="_"+p;this["get"+S]=function(){return this[M]},this["set"+S]=function(p){this[M]=p,this._dontNotify||this._owner[this._setter](this)}}),w.each(["Point","Size","Center","Left","Top","Right","Bottom","CenterX","CenterY","TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],(function(w){var S="set"+w;this[S]=function(){this._dontNotify=!0,p[S].apply(this,arguments),this._dontNotify=!1,this._owner[this._setter](this)}}),{isSelected:function(){return this._owner._boundsSelected},setSelected:function(p){var w=this._owner;w.setSelected&&(w._boundsSelected=p,w.setSelected(p||w._selectedSegmentState>0))}}))}),j=w.extend({_class:"Matrix",initialize:function ae(p){var w=arguments.length,S=!0;if(6===w?this.set.apply(this,arguments):1===w?p instanceof ae?this.set(p._a,p._c,p._b,p._d,p._tx,p._ty):Array.isArray(p)?this.set.apply(this,p):S=!1:0===w?this.reset():S=!1,!S)throw Error("Unsupported matrix parameters")},set:function(p,w,S,M,z,I,k){return this._a=p,this._c=w,this._b=S,this._d=M,this._tx=z,this._ty=I,k||this._changed(),this},_serialize:function(p){return w.serialize(this.getValues(),p)},_changed:function(){var p=this._owner;p&&(p._applyMatrix?p.transform(null,!0):p._changed(9))},clone:function(){return new j(this._a,this._c,this._b,this._d,this._tx,this._ty)},equals:function(p){return p===this||p&&this._a===p._a&&this._b===p._b&&this._c===p._c&&this._d===p._d&&this._tx===p._tx&&this._ty===p._ty||!1},toString:function(){var p=I.instance;return"[["+[p.number(this._a),p.number(this._b),p.number(this._tx)].join(", ")+"], ["+[p.number(this._c),p.number(this._d),p.number(this._ty)].join(", ")+"]]"},reset:function(p){return this._a=this._d=1,this._c=this._b=this._tx=this._ty=0,p||this._changed(),this},apply:function(p,S){var M=this._owner;return!!M&&(M.transform(null,!0,w.pick(p,!0),S),this.isIdentity())},translate:function(){var p=O.read(arguments),w=p.x,S=p.y;return this._tx+=w*this._a+S*this._b,this._ty+=w*this._c+S*this._d,this._changed(),this},scale:function(){var p=O.read(arguments),w=O.read(arguments,0,{readNull:!0});return w&&this.translate(w),this._a*=p.x,this._c*=p.x,this._b*=p.y,this._d*=p.y,w&&this.translate(w.negate()),this._changed(),this},rotate:function(p){p*=Math.PI/180;var w=O.read(arguments,1),S=w.x,M=w.y,z=Math.cos(p),I=Math.sin(p),k=S-S*z+M*I,A=M-S*I-M*z,T=this._a,L=this._b,N=this._c,B=this._d;return this._a=z*T+I*L,this._b=-I*T+z*L,this._c=z*N+I*B,this._d=-I*N+z*B,this._tx+=k*T+A*L,this._ty+=k*N+A*B,this._changed(),this},shear:function(){var p=O.read(arguments),w=O.read(arguments,0,{readNull:!0});w&&this.translate(w);var S=this._a,M=this._c;return this._a+=p.y*this._b,this._c+=p.y*this._d,this._b+=p.x*S,this._d+=p.x*M,w&&this.translate(w.negate()),this._changed(),this},skew:function(){var p=O.read(arguments),w=O.read(arguments,0,{readNull:!0}),S=Math.PI/180,M=new O(Math.tan(p.x*S),Math.tan(p.y*S));return this.shear(M,w)},concatenate:function(p){var w=this._a,S=this._b,M=this._c,z=this._d,I=p._a,k=p._b,A=p._c,O=p._d,T=p._tx,L=p._ty;return this._a=I*w+A*S,this._b=k*w+O*S,this._c=I*M+A*z,this._d=k*M+O*z,this._tx+=T*w+L*S,this._ty+=T*M+L*z,this._changed(),this},preConcatenate:function(p){var w=this._a,S=this._b,M=this._c,z=this._d,I=this._tx,k=this._ty,A=p._a,O=p._b,T=p._c,L=p._d,N=p._tx,B=p._ty;return this._a=A*w+O*M,this._b=A*S+O*z,this._c=T*w+L*M,this._d=T*S+L*z,this._tx=A*I+O*k+N,this._ty=T*I+L*k+B,this._changed(),this},chain:function(p){var w=this._a,S=this._b,M=this._c,z=this._d,I=this._tx,k=this._ty,A=p._a,O=p._b,T=p._c,L=p._d,N=p._tx,B=p._ty;return new j(A*w+T*S,A*M+T*z,O*w+L*S,O*M+L*z,I+N*w+B*S,k+N*M+B*z)},isIdentity:function(){return 1===this._a&&0===this._c&&0===this._b&&1===this._d&&0===this._tx&&0===this._ty},orNullIfIdentity:function(){return this.isIdentity()?null:this},isInvertible:function(){return!!this._getDeterminant()},isSingular:function(){return!this._getDeterminant()},transform:function(p,w,S){return arguments.length<3?this._transformPoint(O.read(arguments)):this._transformCoordinates(p,w,S)},_transformPoint:function(p,w,S){var M=p.x,z=p.y;return w||(w=new O),w.set(M*this._a+z*this._b+this._tx,M*this._c+z*this._d+this._ty,S)},_transformCoordinates:function(p,w,S){for(var M=0,z=0,I=2*S;I>M;){var k=p[M++],A=p[M++];w[z++]=k*this._a+A*this._b+this._tx,w[z++]=k*this._c+A*this._d+this._ty}return w},_transformCorners:function(p){var w=p.x,S=p.y,M=w+p.width,z=S+p.height,I=[w,S,M,S,M,z,w,z];return this._transformCoordinates(I,I,4)},_transformBounds:function(p,w,S){for(var M=this._transformCorners(p),z=M.slice(0,2),I=M.slice(),k=2;8>k;k++){var A=M[k],O=1&k;A<z[O]?z[O]=A:A>I[O]&&(I[O]=A)}return w||(w=new B),w.set(z[0],z[1],I[0]-z[0],I[1]-z[1],S)},inverseTransform:function(){return this._inverseTransform(O.read(arguments))},_getDeterminant:function(){var p=this._a*this._d-this._b*this._c;return isFinite(p)&&!A.isZero(p)&&isFinite(this._tx)&&isFinite(this._ty)?p:null},_inverseTransform:function(p,w,S){var M=this._getDeterminant();if(!M)return null;var z=p.x-this._tx,I=p.y-this._ty;return w||(w=new O),w.set((z*this._d-I*this._b)/M,(I*this._a-z*this._c)/M,S)},decompose:function(){var p=this._a,w=this._b,S=this._c,M=this._d;if(A.isZero(p*M-w*S))return null;var z=Math.sqrt(p*p+w*w),I=(p/=z)*S+(w/=z)*M;S-=p*I,M-=w*I;var k=Math.sqrt(S*S+M*M);return I/=k,w*(S/=k)>p*(M/=k)&&(p=-p,w=-w,I=-I,z=-z),{scaling:new O(z,k),rotation:180*-Math.atan2(w,p)/Math.PI,shearing:I}},getValues:function(){return[this._a,this._c,this._b,this._d,this._tx,this._ty]},getTranslation:function(){return new O(this._tx,this._ty)},getScaling:function(){return(this.decompose()||{}).scaling},getRotation:function(){return(this.decompose()||{}).rotation},inverted:function(){var p=this._getDeterminant();return p&&new j(this._d/p,-this._c/p,-this._b/p,this._a/p,(this._b*this._ty-this._d*this._tx)/p,(this._c*this._tx-this._a*this._ty)/p)},shiftless:function(){return new j(this._a,this._c,this._b,this._d,0,0)},applyToContext:function(p){p.transform(this._a,this._c,this._b,this._d,this._tx,this._ty)}},w.each(["a","c","b","d","tx","ty"],(function(p){var S=w.capitalize(p),M="_"+p;this["get"+S]=function(){return this[M]},this["set"+S]=function(p){this[M]=p,this._changed()}}),{})),E=w.extend({_class:"Line",initialize:function(p,w,S,M,z){var I=!1;arguments.length>=4?(this._px=p,this._py=w,this._vx=S,this._vy=M,I=z):(this._px=p.x,this._py=p.y,this._vx=w.x,this._vy=w.y,I=S),I||(this._vx-=this._px,this._vy-=this._py)},getPoint:function(){return new O(this._px,this._py)},getVector:function(){return new O(this._vx,this._vy)},getLength:function(){return this.getVector().getLength()},intersect:function(p,w){return E.intersect(this._px,this._py,this._vx,this._vy,p._px,p._py,p._vx,p._vy,!0,w)},getSide:function(p){return E.getSide(this._px,this._py,this._vx,this._vy,p.x,p.y,!0)},getDistance:function(p){return Math.abs(E.getSignedDistance(this._px,this._py,this._vx,this._vy,p.x,p.y,!0))},statics:{intersect:function(p,w,S,M,z,I,k,T,L,N){L||(S-=p,M-=w,k-=z,T-=I);var B=S*T-M*k;if(!A.isZero(B)){var D=p-z,j=w-I,E=(k*j-T*D)/B,R=(S*j-M*D)/B;if(N||E>=0&&1>=E&&R>=0&&1>=R)return new O(p+E*S,w+E*M)}},getSide:function(p,w,S,M,z,I,k){k||(S-=p,M-=w);var A=z-p,O=I-w,T=A*M-O*S;return 0===T&&((T=A*S+O*M)>0&&(0>(T=(A-=S)*S+(O-=M)*M)&&(T=0))),0>T?-1:T>0?1:0},getSignedDistance:function(p,w,S,M,z,I,k){return k||(S-=p,M-=w),A.isZero(S)?M>=0?p-z:z-p:A.isZero(M)?S>=0?I-w:w-I:(S*(I-w)-M*(z-p))/Math.sqrt(S*S+M*M)}}}),R=z.extend({_class:"Project",_list:"projects",_reference:"project",initialize:function(p){z.call(this,!0),this.layers=[],this._activeLayer=null,this.symbols=[],this._currentStyle=new ht(null,null,this),this._view=ct.create(this,p||yt.getCanvas(1,1)),this._selectedItems={},this._selectedItemCount=0,this._updateVersion=0},_serialize:function(p,S){return w.serialize(this.layers,p,!0,S)},clear:function(){for(var p=this.layers.length-1;p>=0;p--)this.layers[p].remove();this.symbols=[]},isEmpty:function(){return 0===this.layers.length},remove:function oe(){return!!oe.base.call(this)&&(this._view&&this._view.remove(),!0)},getView:function(){return this._view},getCurrentStyle:function(){return this._currentStyle},setCurrentStyle:function(p){this._currentStyle.initialize(p)},getIndex:function(){return this._index},getOptions:function(){return this._scope.settings},getActiveLayer:function(){return this._activeLayer||new Z({project:this})},getSelectedItems:function(){var p=[];for(var w in this._selectedItems){var S=this._selectedItems[w];S.isInserted()&&p.push(S)}return p},insertChild:function(p,S,M){return S instanceof Z?(S._remove(!1,!0),w.splice(this.layers,[S],p,0),S._setProject(this,!0),this._changes&&S._changed(5),this._activeLayer||(this._activeLayer=S)):S instanceof q?(this._activeLayer||this.insertChild(p,new Z(q.NO_INSERT))).insertChild(p,S,M):S=null,S},addChild:function(w,S){return this.insertChild(p,w,S)},_updateSelection:function(p){var w=p._id,S=this._selectedItems;p._selected?S[w]!==p&&(this._selectedItemCount++,S[w]=p):S[w]===p&&(this._selectedItemCount--,delete S[w])},selectAll:function(){for(var p=this.layers,w=0,S=p.length;S>w;w++)p[w].setFullySelected(!0)},deselectAll:function(){var p=this._selectedItems;for(var w in p)p[w].setFullySelected(!1)},hitTest:function(){for(var p=O.read(arguments),S=U.getOptions(w.read(arguments)),M=this.layers.length-1;M>=0;M--){var z=this.layers[M]._hitTest(p,S);if(z)return z}return null},getItems:function(p){return q._getItems(this.layers,p)},getItem:function(p){return q._getItems(this.layers,p,null,null,!0)[0]||null},importJSON:function(p){this.activate();var S=this._activeLayer;return w.importJSON(p,S&&S.isEmpty()&&S)},draw:function(p,S,M){this._updateVersion++,p.save(),S.applyToContext(p);for(var z=new w({offset:new O(0,0),pixelRatio:M,viewMatrix:S.isIdentity()?null:S,matrices:[new j],updateMatrix:!0}),I=0,k=this.layers,A=k.length;A>I;I++)k[I].draw(p,z);if(p.restore(),this._selectedItemCount>0){p.save(),p.strokeWidth=1;var T=this._selectedItems,L=this._scope.settings.handleSize,N=this._updateVersion;for(var B in T)T[B]._drawSelection(p,S,L,T,N);p.restore()}}}),F=w.extend({_class:"Symbol",initialize:function he(p,w){this._id=he._id=(he._id||0)+1,this.project=paper.project,this.project.symbols.push(this),p&&this.setDefinition(p,w)},_serialize:function(p,S){return S.add(this,(function(){return w.serialize([this._class,this._definition],p,!1,S)}))},_changed:function(p){8&p&&q._clearBoundsCache(this),1&p&&(this.project._needsUpdate=!0)},getDefinition:function(){return this._definition},setDefinition:function(p,w){p._parentSymbol&&(p=p.clone()),this._definition&&(this._definition._parentSymbol=null),this._definition=p,p.remove(),p.setSelected(!1),w||p.setPosition(new O),p._parentSymbol=this,this._changed(9)},place:function(p){return new G(this,p)},clone:function(){return new F(this._definition.clone(!1))},equals:function(p){return p===this||p&&this.definition.equals(p.definition)||!1}}),q=w.extend(S,{statics:{extend:function ue(p){return p._serializeFields&&(p._serializeFields=new w(this.prototype._serializeFields,p._serializeFields)),ue.base.apply(this,arguments)},NO_INSERT:{insert:!1}},_class:"Item",_applyMatrix:!0,_canApplyMatrix:!0,_boundsSelected:!1,_selectChildren:!1,_serializeFields:{name:null,applyMatrix:null,matrix:new j,pivot:null,locked:!1,visible:!0,blendMode:"normal",opacity:1,guide:!1,selected:!1,clipMask:!1,data:{}},initialize:function(){},_initialize:function(p,S){var M=p&&w.isPlainObject(p),z=M&&!0===p.internal,I=this._matrix=new j,k=M&&p.project||paper.project;return z||(this._id=q._id=(q._id||0)+1),this._applyMatrix=this._canApplyMatrix&&paper.settings.applyMatrix,S&&I.translate(S),I._owner=this,this._style=new ht(k._currentStyle,this,k),this._project||(z||M&&!1===p.insert?this._setProject(k):M&&p.parent?this.setParent(p.parent):(k._activeLayer||new Z).addChild(this)),M&&p!==q.NO_INSERT&&this._set(p,{insert:!0,parent:!0},!0),M},_events:new function(){var p={mousedown:{mousedown:1,mousedrag:1,click:1,doubleclick:1},mouseup:{mouseup:1,mousedrag:1,click:1,doubleclick:1},mousemove:{mousedrag:1,mousemove:1,mouseenter:1,mouseleave:1}},S={install:function(w){var S=this.getView()._eventCounters;if(S)for(var M in p)S[M]=(S[M]||0)+(p[M][w]||0)},uninstall:function(w){var S=this.getView()._eventCounters;if(S)for(var M in p)S[M]-=p[M][w]||0}};return w.each(["onMouseDown","onMouseUp","onMouseDrag","onClick","onDoubleClick","onMouseMove","onMouseEnter","onMouseLeave"],(function(p){this[p]=S}),{onFrame:{install:function(){this._animateItem(!0)},uninstall:function(){this._animateItem(!1)}},onLoad:{}})},_animateItem:function(p){this.getView()._animateItem(this,p)},_serialize:function(p,S){function n(I){for(var k in I){var A=z[k];w.equals(A,"leading"===k?1.2*I.fontSize:I[k])||(M[k]=w.serialize(A,p,"data"!==k,S))}}var M={},z=this;return n(this._serializeFields),this instanceof V||n(this._style._defaults),[this._class,M]},_changed:function(w){var S=this._parentSymbol,M=this._parent||S,z=this._project;if(8&w&&(this._bounds=this._position=this._decomposed=this._globalMatrix=this._currentPath=p),M&&40&w&&q._clearBoundsCache(M),2&w&&q._clearBoundsCache(this),z&&(1&w&&(z._needsUpdate=!0),z._changes)){var I=z._changesById[this._id];I?I.flags|=w:(I={item:this,flags:w},z._changesById[this._id]=I,z._changes.push(I))}S&&S._changed(w)},set:function(p){return p&&this._set(p),this},getId:function(){return this._id},getName:function(){return this._name},setName:function(w,S){if(this._name&&this._removeNamed(),w===+w+"")throw Error("Names consisting only of numbers are not supported.");var M=this._parent;if(w&&M){for(var z=M._children,I=M._namedChildren,k=w,A=1;S&&z[w];)w=k+" "+A++;(I[w]=I[w]||[]).push(this),z[w]=this}this._name=w||p,this._changed(128)},getStyle:function(){return this._style},setStyle:function(p){this.getStyle().set(p)}},w.each(["locked","visible","blendMode","opacity","guide"],(function(p){var S=w.capitalize(p);p="_"+p;this["get"+S]=function(){return this[p]},this["set"+S]=function(w){w!=this[p]&&(this[p]=w,this._changed("_locked"===p?128:129))}}),{}),{beans:!0,_locked:!1,_visible:!0,_blendMode:"normal",_opacity:1,_guide:!1,isSelected:function(){if(this._selectChildren)for(var p=this._children,w=0,S=p.length;S>w;w++)if(p[w].isSelected())return!0;return this._selected},setSelected:function(p,w){if(!w&&this._selectChildren)for(var S=this._children,M=0,z=S.length;z>M;M++)S[M].setSelected(p);(p=!!p)^this._selected&&(this._selected=p,this._project._updateSelection(this),this._changed(129))},_selected:!1,isFullySelected:function(){var p=this._children;if(p&&this._selected){for(var w=0,S=p.length;S>w;w++)if(!p[w].isFullySelected())return!1;return!0}return this._selected},setFullySelected:function(p){var w=this._children;if(w)for(var S=0,M=w.length;M>S;S++)w[S].setFullySelected(p);this.setSelected(p,!0)},isClipMask:function(){return this._clipMask},setClipMask:function(p){this._clipMask!=(p=!!p)&&(this._clipMask=p,p&&(this.setFillColor(null),this.setStrokeColor(null)),this._changed(129),this._parent&&this._parent._changed(1024))},_clipMask:!1,getData:function(){return this._data||(this._data={}),this._data},setData:function(p){this._data=p},getPosition:function(p){var w=this._position,S=p?O:T;if(!w){var M=this._pivot;w=this._position=M?this._matrix._transformPoint(M):this.getBounds().getCenter(!0)}return new S(w.x,w.y,this,"setPosition")},setPosition:function(){this.translate(O.read(arguments).subtract(this.getPosition(!0)))},getPivot:function(p){var w=this._pivot;w&&(w=new(p?O:T)(w.x,w.y,this,"setPivot"));return w},setPivot:function(){this._pivot=O.read(arguments),this._position=p},_pivot:null,getRegistration:"#getPivot",setRegistration:"#setPivot"},w.each(["bounds","strokeBounds","handleBounds","roughBounds","internalBounds","internalRoughBounds"],(function(p){var S="get"+w.capitalize(p),M=p.match(/^internal(.*)$/),z=M?"get"+M[1]:null;this[S]=function(w){var M=this._boundsGetter,I=!z&&("string"==typeof M?M:M&&M[S])||S,k=this._getCachedBounds(I,w,this,z);return"bounds"===p?new D(k.x,k.y,k.width,k.height,this,"setBounds"):k}}),{beans:!0,_getBounds:function(p,w,S){var M=this._children;if(!M||0==M.length)return new B;for(var z=1/0,I=-z,k=z,A=I,O=0,T=M.length;T>O;O++){var L=M[O];if(L._visible&&!L.isEmpty()){var N=L._getCachedBounds(p,w&&w.chain(L._matrix),S);z=Math.min(N.x,z),k=Math.min(N.y,k),I=Math.max(N.x+N.width,I),A=Math.max(N.y+N.height,A)}}return isFinite(z)?new B(z,k,I-z,A-k):new B},setBounds:function(){var p=B.read(arguments),w=this.getBounds(),S=new j,M=p.getCenter();S.translate(M),(p.width!=w.width||p.height!=w.height)&&S.scale(0!=w.width?p.width/w.width:1,0!=w.height?p.height/w.height:1),M=w.getCenter(),S.translate(-M.x,-M.y),this.transform(S)},_getCachedBounds:function(p,w,S,M){w=w&&w.orNullIfIdentity();var z=M?null:this._matrix.orNullIfIdentity(),I=(!w||w.equals(z))&&p,k=this._parent||this._parentSymbol;if(k){var A=S._id,O=k._boundsCache=k._boundsCache||{ids:{},list:[]};O.ids[A]||(O.list.push(S),O.ids[A]=S)}if(I&&this._bounds&&this._bounds[I])return this._bounds[I].clone();var T=this._getBounds(M||p,w||z,S);I&&(this._bounds||(this._bounds={}),(this._bounds[I]=T.clone())._internal=!!M);return T},statics:{_clearBoundsCache:function(w){var S=w._boundsCache;if(S){w._bounds=w._position=w._boundsCache=p;for(var M=0,z=S.list,I=z.length;I>M;M++){var k=z[M];k!==w&&(k._bounds=k._position=p,k._boundsCache&&q._clearBoundsCache(k))}}}}}),{beans:!0,_decompose:function(){return this._decomposed=this._matrix.decompose()},getRotation:function(){var p=this._decomposed||this._decompose();return p&&p.rotation},setRotation:function(p){var w=this.getRotation();if(null!=w&&null!=p){var S=this._decomposed;this.rotate(p-w),S.rotation=p,this._decomposed=S}},getScaling:function(p){var w=this._decomposed||this._decompose(),S=w&&w.scaling;return S&&new(p?O:T)(S.x,S.y,this,"setScaling")},setScaling:function(){var p=this.getScaling();if(p){var w=O.read(arguments,0,{clone:!0}),S=this._decomposed;this.scale(w.x/p.x,w.y/p.y),S.scaling=w,this._decomposed=S}},getMatrix:function(){return this._matrix},setMatrix:function(p){this._matrix.initialize(p),this._applyMatrix?this.transform(null,!0):this._changed(9)},getGlobalMatrix:function(p){var w=this._globalMatrix,S=this._project._updateVersion;if(w&&w._updateVersion!==S&&(w=null),!w){w=this._globalMatrix=this._matrix.clone();var M=this._parent;M&&w.preConcatenate(M.getGlobalMatrix(!0)),w._updateVersion=S}return p?w:w.clone()},getApplyMatrix:function(){return this._applyMatrix},setApplyMatrix:function(p){(this._applyMatrix=this._canApplyMatrix&&!!p)&&this.transform(null,!0)},getTransformContent:"#getApplyMatrix",setTransformContent:"#setApplyMatrix"},{getProject:function(){return this._project},_setProject:function(p,w){if(this._project!==p){this._project&&this._installEvents(!1),this._project=p;for(var S=this._children,M=0,z=S&&S.length;z>M;M++)S[M]._setProject(p);w=!0}w&&this._installEvents(!0)},getView:function(){return this._project.getView()},_installEvents:function le(p){le.base.call(this,p);for(var w=this._children,S=0,M=w&&w.length;M>S;S++)w[S]._installEvents(p)},getLayer:function(){for(var p=this;p=p._parent;)if(p instanceof Z)return p;return null},getParent:function(){return this._parent},setParent:function(p){return p.addChild(this)},getChildren:function(){return this._children},setChildren:function(p){this.removeChildren(),this.addChildren(p)},getFirstChild:function(){return this._children&&this._children[0]||null},getLastChild:function(){return this._children&&this._children[this._children.length-1]||null},getNextSibling:function(){return this._parent&&this._parent._children[this._index+1]||null},getPreviousSibling:function(){return this._parent&&this._parent._children[this._index-1]||null},getIndex:function(){return this._index},equals:function(p){return p===this||p&&this._class===p._class&&this._style.equals(p._style)&&this._matrix.equals(p._matrix)&&this._locked===p._locked&&this._visible===p._visible&&this._blendMode===p._blendMode&&this._opacity===p._opacity&&this._clipMask===p._clipMask&&this._guide===p._guide&&this._equals(p)||!1},_equals:function(p){return w.equals(this._children,p._children)},clone:function(p){return this._clone(new this.constructor(q.NO_INSERT),p)},_clone:function(S,M){if(S.setStyle(this._style),this._children)for(var z=0,I=this._children.length;I>z;z++)S.addChild(this._children[z].clone(!1),!0);(M||M===p)&&S.insertAbove(this);var k=["_locked","_visible","_blendMode","_opacity","_clipMask","_guide","_applyMatrix"];for(z=0,I=k.length;I>z;z++){var A=k[z];this.hasOwnProperty(A)&&(S[A]=this[A])}return S._matrix.initialize(this._matrix),S._data=this._data?w.clone(this._data):null,S.setSelected(this._selected),this._name&&S.setName(this._name,!0),S},copyTo:function(p){return p.addChild(this.clone(!1))},rasterize:function(p){var S=this.getStrokeBounds(),M=(p||this.getView().getResolution())/72,z=S.getTopLeft().floor(),I=S.getBottomRight().ceil(),k=new L(I.subtract(z)),A=yt.getCanvas(k.multiply(M)),O=A.getContext("2d"),T=(new j).scale(M).translate(z.negate());O.save(),T.applyToContext(O),this.draw(O,new w({matrices:[T]})),O.restore();var N=new W(q.NO_INSERT);return N.setCanvas(A),N.transform((new j).translate(z.add(k.divide(2))).scale(1/M)),N.insertAbove(this),N},contains:function(){return!!this._contains(this._matrix._inverseTransform(O.read(arguments)))},_contains:function(p){if(this._children){for(var w=this._children.length-1;w>=0;w--)if(this._children[w].contains(p))return!0;return!1}return p.isInside(this.getInternalBounds())},isInside:function(){return B.read(arguments).contains(this.getBounds())},_asPathItem:function(){return new Q.Rectangle({rectangle:this.getInternalBounds(),matrix:this._matrix,insert:!1})},intersects:function(p,w){return p instanceof q&&this._asPathItem().getIntersections(p._asPathItem(),w||p._matrix).length>0},hitTest:function(){return this._hitTest(O.read(arguments),U.getOptions(w.read(arguments)))},_hitTest:function(S,M){function r(M,z){var I=D["get"+z]();return S.subtract(I).divide(O).length<=1?new U(M,B,{name:w.hyphenate(z),point:I}):p}if(this._locked||!this._visible||this._guide&&!M.guides||this.isEmpty())return null;var z=this._matrix,I=M._totalMatrix,k=this.getView(),A=M._totalMatrix=I?I.chain(z):this.getGlobalMatrix().preConcatenate(k._matrix),O=M._tolerancePadding=new L(Q._getPenPadding(1,A.inverted())).multiply(Math.max(M.tolerance,1e-6));if(S=z._inverseTransform(S),!this._children&&!this.getInternalRoughBounds().expand(O.multiply(2))._containsPoint(S))return null;var T,N=!(M.guides&&!this._guide||M.selected&&!this._selected||M.type&&M.type!==w.hyphenate(this._class)||M.class&&!(this instanceof M.class)),B=this;if(N&&(M.center||M.bounds)&&this._parent){var D=this.getInternalBounds();if(M.center&&(T=r("center","Center")),!T&&M.bounds)for(var j=["TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],E=0;8>E&&!T;E++)T=r("bounds",j[E])}var R=!T&&this._children;if(R){var F=this._getChildHitTestOptions(M);for(E=R.length-1;E>=0&&!T;E--)T=R[E]._hitTest(S,F)}return!T&&N&&(T=this._hitTestSelf(S,M)),T&&T.point&&(T.point=z.transform(T.point)),M._totalMatrix=I,T},_getChildHitTestOptions:function(p){return p},_hitTestSelf:function(w,S){return S.fill&&this.hasFill()&&this._contains(w)?new U("fill",this):p},matches:function(p,S){if("object"==typeof p){for(var M in p)if(p.hasOwnProperty(M)&&!this.matches(M,p[M]))return!1}else{var z=/^(empty|editable)$/.test(p)?this["is"+w.capitalize(p)]():"type"===p?w.hyphenate(this._class):this[p];if(/^(constructor|class)$/.test(p)){if(!(this instanceof S))return!1}else if(S instanceof RegExp){if(!S.test(z))return!1}else if("function"==typeof S){if(!S(z))return!1}else if(w.isPlainObject(S)){if(!function n(p,S){for(var M in p)if(p.hasOwnProperty(M)){var z=p[M],I=S[M];if(w.isPlainObject(z)&&w.isPlainObject(I)){if(!n(z,I))return!1}else if(!w.equals(z,I))return!1}return!0}(S,z))return!1}else if(!w.equals(z,S))return!1}return!0},getItems:function(p){return q._getItems(this._children,p,this._matrix)},getItem:function(p){return q._getItems(this._children,p,this._matrix,null,!0)[0]||null},statics:{_getItems:function ce(p,S,M,z,I){if(!z){var k=S.overlapping,A=S.inside,O=(F=k||A)&&B.read([F]);z={items:[],inside:O,overlapping:k&&new Q.Rectangle({rectangle:O,insert:!1})},F&&(S=w.set({},S,{inside:!0,overlapping:!0}))}var T=z.items;A=z.inside,k=z.overlapping;M=A&&(M||new j);for(var L=0,N=p&&p.length;N>L;L++){var D=p[L],E=M&&M.chain(D._matrix),R=!0;if(A){var F=D.getBounds(E);if(!A.intersects(F))continue;A&&A.contains(F)||k&&k.intersects(D,E)||(R=!1)}if(R&&D.matches(S)&&(T.push(D),I))break;if(ce(D._children,S,E,z,I),I&&T.length>0)break}return T}}},{importJSON:function(p){var S=w.importJSON(p,this);return S!==this?this.addChild(S):S},addChild:function(w,S){return this.insertChild(p,w,S)},insertChild:function(p,w,S){var M=w?this.insertChildren(p,[w],S):null;return M&&M[0]},addChildren:function(p,w){return this.insertChildren(this._children.length,p,w)},insertChildren:function(p,S,M,z){var I=this._children;if(I&&S&&S.length>0){for(var k=(S=Array.prototype.slice.apply(S)).length-1;k>=0;k--){var A=S[k];if(!z||A instanceof z){var O=A._parent===this&&A._index<p;A._remove(!1,!0)&&O&&p--}else S.splice(k,1)}w.splice(I,S,p,0);for(var T=this._project,L=T&&T._changes,N=(k=0,S.length);N>k;k++){(A=S[k])._parent=this,A._setProject(this._project,!0),A._name&&A.setName(A._name),L&&this._changed(5)}this._changed(11)}else S=null;return S},_insertSibling:function(p,w,S){return this._parent?this._parent.insertChild(p,w,S):null},insertAbove:function(p,w){return p._insertSibling(p._index+1,this,w)},insertBelow:function(p,w){return p._insertSibling(p._index,this,w)},sendToBack:function(){return(this._parent||this instanceof Z&&this._project).insertChild(0,this)},bringToFront:function(){return(this._parent||this instanceof Z&&this._project).addChild(this)},appendTop:"#addChild",appendBottom:function(p){return this.insertChild(0,p)},moveAbove:"#insertAbove",moveBelow:"#insertBelow",reduce:function(){if(this._children&&1===this._children.length){var p=this._children[0].reduce();return p.insertAbove(this),p.setStyle(this._style),this.remove(),p}return this},_removeNamed:function(){var p=this._parent;if(p){var w=p._children,S=p._namedChildren,M=this._name,z=S[M],I=z?z.indexOf(this):-1;-1!==I&&(w[M]==this&&delete w[M],z.splice(I,1),z.length?w[M]=z[z.length-1]:delete S[M])}},_remove:function(p,S){var M=this._parent;if(M){if(this._name&&this._removeNamed(),null!=this._index&&w.splice(M._children,null,this._index,1),this._installEvents(!1),p){var z=this._project;z&&z._changes&&this._changed(5)}return S&&M._changed(11),this._parent=null,!0}return!1},remove:function(){return this._remove(!0,!0)},replaceWith:function(p){var w=p&&p.insertBelow(this);return w&&this.remove(),w},removeChildren:function(p,S){if(!this._children)return null;p=p||0,S=w.pick(S,this._children.length);for(var M=w.splice(this._children,null,p,S-p),z=M.length-1;z>=0;z--)M[z]._remove(!0,!1);return M.length>0&&this._changed(11),M},clear:"#removeChildren",reverseChildren:function(){if(this._children){this._children.reverse();for(var p=0,w=this._children.length;w>p;p++)this._children[p]._index=p;this._changed(11)}},isEmpty:function(){return!this._children||0===this._children.length},isEditable:function(){for(var p=this;p;){if(!p._visible||p._locked)return!1;p=p._parent}return!0},hasFill:function(){return this.getStyle().hasFill()},hasStroke:function(){return this.getStyle().hasStroke()},hasShadow:function(){return this.getStyle().hasShadow()},_getOrder:function(p){function e(p){var w=[];do{w.unshift(p)}while(p=p._parent);return w}for(var w=e(this),S=e(p),M=0,z=Math.min(w.length,S.length);z>M;M++)if(w[M]!=S[M])return w[M]._index<S[M]._index?1:-1;return 0},hasChildren:function(){return this._children&&this._children.length>0},isInserted:function(){return!!this._parent&&this._parent.isInserted()},isAbove:function(p){return-1===this._getOrder(p)},isBelow:function(p){return 1===this._getOrder(p)},isParent:function(p){return this._parent===p},isChild:function(p){return p&&p._parent===this},isDescendant:function(p){for(var w=this;w=w._parent;)if(w==p)return!0;return!1},isAncestor:function(p){return!!p&&p.isDescendant(this)},isGroupedWith:function(p){for(var w=this._parent;w;){if(w._parent&&/^(Group|Layer|CompoundPath)$/.test(w._class)&&p.isDescendant(w))return!0;w=w._parent}return!1},translate:function(){var p=new j;return this.transform(p.translate.apply(p,arguments))},rotate:function(p){return this.transform((new j).rotate(p,O.read(arguments,1,{readNull:!0})||this.getPosition(!0)))}},w.each(["scale","shear","skew"],(function(p){this[p]=function(){var w=O.read(arguments),S=O.read(arguments,0,{readNull:!0});return this.transform((new j)[p](w,S||this.getPosition(!0)))}}),{}),{transform:function(p,w,S,M){p&&p.isIdentity()&&(p=null);var z=this._matrix,I=(w||this._applyMatrix)&&(!z.isIdentity()||p||w&&S&&this._children);if(!p&&!I)return this;if(p&&z.preConcatenate(p),I=I&&this._transformContent(z,S,M)){var k=this._pivot,A=this._style,O=A.getFillColor(!0),T=A.getStrokeColor(!0);k&&z._transformPoint(k,k,!0),O&&O.transform(z),T&&T.transform(z),z.reset(!0),M&&this._canApplyMatrix&&(this._applyMatrix=!0)}var L=this._bounds,N=this._position;this._changed(9);var B=L&&p&&p.decompose();if(B&&!B.shearing&&0==B.rotation%90){for(var D in L){var j=L[D];(I||!j._internal)&&p._transformBounds(j,j)}var E=this._boundsGetter;(j=L[E&&E.getBounds||E||"getBounds"])&&(this._position=j.getCenter(!0)),this._bounds=L}else p&&N&&(this._position=p._transformPoint(N,N));return this},_transformContent:function(p,w,S){var M=this._children;if(M){for(var z=0,I=M.length;I>z;z++)M[z].transform(p,!0,w,S);return!0}},globalToLocal:function(){return this.getGlobalMatrix(!0)._inverseTransform(O.read(arguments))},localToGlobal:function(){return this.getGlobalMatrix(!0)._transformPoint(O.read(arguments))},parentToLocal:function(){return this._matrix._inverseTransform(O.read(arguments))},localToParent:function(){return this._matrix._transformPoint(O.read(arguments))},fitBounds:function(p,w){p=B.read(arguments);var S=this.getBounds(),M=S.height/S.width,z=p.height/p.width,I=(w?M>z:z>M)?p.width/S.width:p.height/S.height,k=new B(new O,new L(S.width*I,S.height*I));k.setCenter(p.getCenter()),this.setBounds(k)},_setStyles:function(p){var w=this._style,S=w.getFillColor(),M=w.getStrokeColor(),z=w.getShadowColor();if(S&&(p.fillStyle=S.toCanvasStyle(p)),M){var I=w.getStrokeWidth();if(I>0){p.strokeStyle=M.toCanvasStyle(p),p.lineWidth=I;var k=w.getStrokeJoin(),A=w.getStrokeCap(),O=w.getMiterLimit();if(k&&(p.lineJoin=k),A&&(p.lineCap=A),O&&(p.miterLimit=O),paper.support.nativeDash){var T=w.getDashArray(),L=w.getDashOffset();T&&T.length&&("setLineDash"in p?(p.setLineDash(T),p.lineDashOffset=L):(p.mozDash=T,p.mozDashOffset=L))}}}if(z){var N=w.getShadowBlur();if(N>0){p.shadowColor=z.toCanvasStyle(p),p.shadowBlur=N;var B=this.getShadowOffset();p.shadowOffsetX=B.x,p.shadowOffsetY=B.y}}},draw:function(p,w,S){function n(p){return I?I.chain(p):p}var M=this._updateVersion=this._project._updateVersion;if(this._visible&&0!==this._opacity){var z=w.matrices,I=w.viewMatrix,k=this._matrix,A=z[z.length-1].chain(k);if(A.isInvertible()){z.push(A),w.updateMatrix&&(A._updateVersion=M,this._globalMatrix=A);var O,T,L,N=this._blendMode,B=this._opacity,D="normal"===N,j=wt.nativeModes[N],E=D&&1===B||w.dontStart||w.clip||(j||D&&1>B)&&this._canComposite(),R=w.pixelRatio;if(!E){var F=this.getStrokeBounds(n(A));if(!F.width||!F.height)return;L=w.offset,T=w.offset=F.getTopLeft().floor(),O=p,p=yt.getContext(F.getSize().ceil().add(1).multiply(R)),1!==R&&p.scale(R,R)}p.save();var q=S?S.chain(k):!this.getStrokeScaling(!0)&&n(A),V=!E&&w.clipItem,Z=!q||V;if(E?(p.globalAlpha=B,j&&(p.globalCompositeOperation=N)):Z&&p.translate(-T.x,-T.y),Z&&(E?k:n(A)).applyToContext(p),V&&w.clipItem.draw(p,w.extend({clip:!0})),q){p.setTransform(R,0,0,R,0,0);var H=w.offset;H&&p.translate(-H.x,-H.y)}this._draw(p,w,q),p.restore(),z.pop(),w.clip&&!w.dontFinish&&p.clip(),E||(wt.process(N,p,O,B,T.subtract(L).multiply(R)),yt.release(p),w.offset=L)}}},_isUpdated:function(p){var w=this._parent;if(w instanceof tt)return w._isUpdated(p);var S=this._updateVersion===p;return!S&&w&&w._visible&&w._isUpdated(p)&&(this._updateVersion=p,S=!0),S},_drawSelection:function(p,w,S,M,z){if((this._drawSelected||this._boundsSelected)&&this._isUpdated(z)){var I=this.getSelectedColor(!0)||this.getLayer().getSelectedColor(!0),k=w.chain(this.getGlobalMatrix(!0));if(p.strokeStyle=p.fillStyle=I?I.toCanvasStyle(p):"#009dec",this._drawSelected&&this._drawSelected(p,k,M),this._boundsSelected){var A=S/2;coords=k._transformCorners(this.getInternalBounds()),p.beginPath();for(var O=0;8>O;O++)p[0===O?"moveTo":"lineTo"](coords[O],coords[++O]);p.closePath(),p.stroke();for(O=0;8>O;O++)p.fillRect(coords[O]-A,coords[++O]-A,S,S)}}},_canComposite:function(){return!1}},w.each(["down","drag","up","move"],(function(p){this["removeOn"+w.capitalize(p)]=function(){var w={};return w[p]=!0,this.removeOn(w)}}),{removeOn:function(p){for(var w in p)if(p[w]){var S="mouse"+w,M=this._project,z=M._removeSets=M._removeSets||{};z[S]=z[S]||{},z[S][this._id]=this}return this}})),V=q.extend({_class:"Group",_selectChildren:!0,_serializeFields:{children:[]},initialize:function(p){this._children=[],this._namedChildren={},this._initialize(p)||this.addChildren(Array.isArray(p)?p:arguments)},_changed:function de(w){de.base.call(this,w),1026&w&&(this._clipItem=p)},_getClipItem:function(){var w=this._clipItem;if(w===p){w=null;for(var S=0,M=this._children.length;M>S;S++){var z=this._children[S];if(z._clipMask){w=z;break}}this._clipItem=w}return w},isClipped:function(){return!!this._getClipItem()},setClipped:function(p){var w=this.getFirstChild();w&&w.setClipMask(p)},_draw:function(p,w){var S=w.clip,M=!S&&this._getClipItem(),z=!0;if(w=w.extend({clipItem:M,clip:!1}),S?this._currentPath?(p.currentPath=this._currentPath,z=!1):(p.beginPath(),w.dontStart=w.dontFinish=!0):M&&M.draw(p,w.extend({clip:!0})),z)for(var I=0,k=this._children.length;k>I;I++){var A=this._children[I];A!==M&&A.draw(p,w)}S&&(this._currentPath=p.currentPath)}}),Z=V.extend({_class:"Layer",initialize:function(S){var M=w.isPlainObject(S)?new w(S):{children:Array.isArray(S)?S:arguments},z=M.insert;M.insert=!1,V.call(this,M),(z||z===p)&&(this._project.addChild(this),this.activate())},_remove:function _e(p,S){if(this._parent)return _e.base.call(this,p,S);if(null!=this._index){var M=this._project;return M._activeLayer===this&&(M._activeLayer=this.getNextSibling()||this.getPreviousSibling()),w.splice(M.layers,null,this._index,1),this._installEvents(!1),p&&M._changes&&this._changed(5),S&&(M._needsUpdate=!0),!0}return!1},getNextSibling:function fe(){return this._parent?fe.base.call(this):this._project.layers[this._index+1]||null},getPreviousSibling:function ge(){return this._parent?ge.base.call(this):this._project.layers[this._index-1]||null},isInserted:function ve(){return this._parent?ve.base.call(this):null!=this._index},activate:function(){this._project._activeLayer=this},_insertSibling:function me(p,w,S){return this._parent?me.base.call(this,p,w,S):this._project.insertChild(p,w,S)}}),H=q.extend({_class:"Shape",_applyMatrix:!1,_canApplyMatrix:!1,_boundsSelected:!0,_serializeFields:{type:null,size:null,radius:null},initialize:function(p){this._initialize(p)},_equals:function(p){return this._type===p._type&&this._size.equals(p._size)&&w.equals(this._radius,p._radius)},clone:function(p){var w=new H(q.NO_INSERT);return w.setType(this._type),w.setSize(this._size),w.setRadius(this._radius),this._clone(w,p)},getType:function(){return this._type},setType:function(p){this._type=p},getShape:"#getType",setShape:"#setType",getSize:function(){var p=this._size;return new N(p.width,p.height,this,"setSize")},setSize:function(){var p=L.read(arguments);if(this._size){if(!this._size.equals(p)){var w=this._type,S=p.width,M=p.height;if("rectangle"===w){var z=L.min(this._radius,p.divide(2));this._radius.set(z.width,z.height)}else"circle"===w?(S=M=(S+M)/2,this._radius=S/2):"ellipse"===w&&this._radius.set(S/2,M/2);this._size.set(S,M),this._changed(9)}}else this._size=p.clone()},getRadius:function(){var p=this._radius;return"circle"===this._type?p:new N(p.width,p.height,this,"setRadius")},setRadius:function(p){var w=this._type;if("circle"===w){if(p===this._radius)return;var S=2*p;this._radius=p,this._size.set(S,S)}else if(p=L.read(arguments),this._radius){if(this._radius.equals(p))return;if(this._radius.set(p.width,p.height),"rectangle"===w){S=L.max(this._size,p.multiply(2));this._size.set(S.width,S.height)}else"ellipse"===w&&this._size.set(2*p.width,2*p.height)}else this._radius=p.clone();this._changed(9)},isEmpty:function(){return!1},toPath:function(S){var M=new(Q[w.capitalize(this._type)])({center:new O,size:this._size,radius:this._radius,insert:!1});return M.setStyle(this._style),M.transform(this._matrix),(S||S===p)&&M.insertAbove(this),M},_draw:function(p,w,S){var M=this._style,z=M.hasFill(),I=M.hasStroke(),k=w.dontFinish||w.clip,A=!S;if(z||I||k){var O=this._type,T=this._radius,L="circle"===O;if(w.dontStart||p.beginPath(),A&&L)p.arc(0,0,T,0,2*Math.PI,!0);else{var N=L?T:T.width,B=L?T:T.height,D=this._size,j=D.width,E=D.height;if(A&&"rect"===O&&0===N&&0===B)p.rect(-j/2,-E/2,j,E);else{var R=j/2,F=E/2,q=.44771525016920644,V=N*q,Z=B*q,H=[-R,-F+B,-R,-F+Z,-R+V,-F,-R+N,-F,R-N,-F,R-V,-F,R,-F+Z,R,-F+B,R,F-B,R,F-Z,R-V,F,R-N,F,-R+N,F,-R+V,F,-R,F-Z,-R,F-B];S&&S.transform(H,H,32),p.moveTo(H[0],H[1]),p.bezierCurveTo(H[2],H[3],H[4],H[5],H[6],H[7]),R!==N&&p.lineTo(H[8],H[9]),p.bezierCurveTo(H[10],H[11],H[12],H[13],H[14],H[15]),F!==B&&p.lineTo(H[16],H[17]),p.bezierCurveTo(H[18],H[19],H[20],H[21],H[22],H[23]),R!==N&&p.lineTo(H[24],H[25]),p.bezierCurveTo(H[26],H[27],H[28],H[29],H[30],H[31])}}p.closePath()}k||!z&&!I||(this._setStyles(p),z&&(p.fill(M.getWindingRule()),p.shadowColor="rgba(0,0,0,0)"),I&&p.stroke())},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_getBounds:function(p,w){var S=new B(this._size).setCenter(0,0);return"getBounds"!==p&&this.hasStroke()&&(S=S.expand(this.getStrokeWidth())),w?w._transformBounds(S):S}},new function(){function t(p,w,S){var M=p._radius;if(!M.isZero())for(var z=p._size.divide(2),I=0;4>I;I++){var k=new O(1&I?1:-1,I>1?1:-1),A=k.multiply(z),T=A.subtract(k.multiply(M)),L=new B(A,T);if((S?L.expand(S):L).contains(w))return T}}function e(p,w){var S=p.getAngleInRadians(),M=2*w.width,z=2*w.height,I=M*Math.sin(S),k=z*Math.cos(S);return M*z/(2*Math.sqrt(I*I+k*k))}return{_contains:function i(p){if("rectangle"===this._type){var w=t(this,p);return w?p.subtract(w).divide(this._radius).getLength()<=1:i.base.call(this,p)}return p.divide(this.size).getLength()<=.5},_hitTestSelf:function n(p,w){var S=!1;if(this.hasStroke()){var M=this._type,z=this._radius,I=this.getStrokeWidth()+2*w.tolerance;if("rectangle"===M){var k=t(this,p,I);if(k){var A=p.subtract(k);S=2*Math.abs(A.getLength()-e(A,z))<=I}else{var O=new B(this._size).setCenter(0,0),T=O.expand(I),L=O.expand(-I);S=T._containsPoint(p)&&!L._containsPoint(p)}}else"ellipse"===M&&(z=e(p,z)),S=2*Math.abs(p.getLength()-z)<=I}return S?new U("stroke",this):n.base.apply(this,arguments)}}},{statics:new function(){function t(p,S,M,z,I){var k=new H(w.getNamed(I));return k._type=p,k._size=M,k._radius=z,k.translate(S)}return{Circle:function(){var p=O.readNamed(arguments,"center"),S=w.readNamed(arguments,"radius");return t("circle",p,new L(2*S),S,arguments)},Rectangle:function(){var p=B.readNamed(arguments,"rectangle"),w=L.min(L.readNamed(arguments,"radius"),p.getSize(!0).divide(2));return t("rectangle",p.getCenter(!0),p.getSize(!0),w,arguments)},Ellipse:function(){var p=H._readEllipse(arguments),w=p.radius;return t("ellipse",p.center,w.multiply(2),w,arguments)},_readEllipse:function(p){var S,M;if(w.hasNamed(p,"radius"))S=O.readNamed(p,"center"),M=L.readNamed(p,"radius");else{var z=B.readNamed(p,"rectangle");S=z.getCenter(!0),M=z.getSize(!0).divide(2)}return{center:S,radius:M}}}}}),W=q.extend({_class:"Raster",_applyMatrix:!1,_canApplyMatrix:!1,_boundsGetter:"getBounds",_boundsSelected:!0,_serializeFields:{source:null},initialize:function(w,S){this._initialize(w,S!==p&&O.read(arguments,1))||("string"==typeof w?this.setSource(w):this.setImage(w)),this._size||(this._size=new L,this._loaded=!1)},_equals:function(p){return this.getSource()===p.getSource()},clone:function(p){var w=new W(q.NO_INSERT),S=this._image,M=this._canvas;if(S)w.setImage(S);else if(M){var z=yt.getCanvas(this._size);z.getContext("2d").drawImage(M,0,0),w.setImage(z)}return this._clone(w,p)},getSize:function(){var p=this._size;return new N(p?p.width:0,p?p.height:0,this,"setSize")},setSize:function(){var p=L.read(arguments);if(!p.equals(this._size))if(p.width>0&&p.height>0){var w=this.getElement();this.setImage(yt.getCanvas(p)),w&&this.getContext(!0).drawImage(w,0,0,p.width,p.height)}else this._canvas&&yt.release(this._canvas),this._size=p.clone()},getWidth:function(){return this._size?this._size.width:0},setWidth:function(p){this.setSize(p,this.getHeight())},getHeight:function(){return this._size?this._size.height:0},setHeight:function(p){this.setSize(this.getWidth(),p)},isEmpty:function(){var p=this._size;return!p||0===p.width&&0===p.height},getResolution:function(){var p=this._matrix,w=new O(0,0).transform(p),S=new O(1,0).transform(p).subtract(w),M=new O(0,1).transform(p).subtract(w);return new L(72/S.getLength(),72/M.getLength())},getPpi:"#getResolution",getImage:function(){return this._image},setImage:function(p){this._canvas&&yt.release(this._canvas),p&&p.getContext?(this._image=null,this._canvas=p,this._loaded=!0):(this._image=p,this._canvas=null,this._loaded=p&&p.complete),this._size=new L(p?p.naturalWidth||p.width:0,p?p.naturalHeight||p.height:0),this._context=null,this._changed(521)},getCanvas:function(){if(!this._canvas){var p=yt.getContext(this._size);try{this._image&&p.drawImage(this._image,0,0),this._canvas=p.canvas}catch(w){yt.release(p)}}return this._canvas},setCanvas:"#setImage",getContext:function(p){return this._context||(this._context=this.getCanvas().getContext("2d")),p&&(this._image=null,this._changed(513)),this._context},setContext:function(p){this._context=p},getSource:function(){return this._image&&this._image.src||this.toDataURL()},setSource:function(p){function e(){var p=S.getView();p&&(paper=p._scope,S.setImage(w),S.emit("load"),p.update())}var w,S=this;(w=document.getElementById(p)||new Image).naturalWidth&&w.naturalHeight?setTimeout(e,0):(lt.add(w,{load:e}),w.src||(w.src=p)),this.setImage(w)},getElement:function(){return this._canvas||this._loaded&&this._image}},{beans:!1,getSubCanvas:function(){var p=B.read(arguments),w=yt.getContext(p.getSize());return w.drawImage(this.getCanvas(),p.x,p.y,p.width,p.height,0,0,p.width,p.height),w.canvas},getSubRaster:function(){var p=B.read(arguments),w=new W(q.NO_INSERT);return w.setImage(this.getSubCanvas(p)),w.translate(p.getCenter().subtract(this.getSize().divide(2))),w._matrix.preConcatenate(this._matrix),w.insertAbove(this),w},toDataURL:function(){var p=this._image&&this._image.src;if(/^data:/.test(p))return p;var w=this.getCanvas();return w?w.toDataURL():null},drawImage:function(p){var w=O.read(arguments,1);this.getContext(!0).drawImage(p,w.x,w.y)},getAverageColor:function(p){var S,M;p?p instanceof K?(M=p,S=p.getBounds()):p.width?S=new B(p):p.x&&(S=new B(p.x-.5,p.y-.5,1,1)):S=this.getBounds();var z=Math.min(S.width,32),I=Math.min(S.height,32),k=W._sampleContext;k?k.clearRect(0,0,33,33):k=W._sampleContext=yt.getContext(new L(32)),k.save();var A=(new j).scale(z/S.width,I/S.height).translate(-S.x,-S.y);A.applyToContext(k),M&&M.draw(k,new w({clip:!0,matrices:[A]})),this._matrix.applyToContext(k);var O=this.getElement(),T=this._size;O&&k.drawImage(O,-T.width/2,-T.height/2),k.restore();for(var N=k.getImageData(.5,.5,Math.ceil(z),Math.ceil(I)).data,D=[0,0,0],E=0,R=0,F=N.length;F>R;R+=4){var q=N[R+3];E+=q,q/=255,D[0]+=N[R]*q,D[1]+=N[R+1]*q,D[2]+=N[R+2]*q}for(R=0;3>R;R++)D[R]/=E;return E?st.read(D):null},getPixel:function(){var p=O.read(arguments),w=this.getContext().getImageData(p.x,p.y,1,1).data;return new st("rgb",[w[0]/255,w[1]/255,w[2]/255],w[3]/255)},setPixel:function(){var p=O.read(arguments),w=st.read(arguments),S=w._convert("rgb"),M=w._alpha,z=this.getContext(!0),I=z.createImageData(1,1),k=I.data;k[0]=255*S[0],k[1]=255*S[1],k[2]=255*S[2],k[3]=null!=M?255*M:255,z.putImageData(I,p.x,p.y)},createImageData:function(){var p=L.read(arguments);return this.getContext().createImageData(p.width,p.height)},getImageData:function(){var p=B.read(arguments);return p.isEmpty()&&(p=new B(this._size)),this.getContext().getImageData(p.x,p.y,p.width,p.height)},setImageData:function(p){var w=O.read(arguments,1);this.getContext(!0).putImageData(p,w.x,w.y)},_getBounds:function(p,w){var S=new B(this._size).setCenter(0,0);return w?w._transformBounds(S):S},_hitTestSelf:function(p){if(this._contains(p)){var w=this;return new U("pixel",w,{offset:p.add(w._size.divide(2)).round(),color:{get:function(){return w.getPixel(this.offset)}}})}},_draw:function(p){var w=this.getElement();w&&(p.globalAlpha=this._opacity,p.drawImage(w,-this._size.width/2,-this._size.height/2))},_canComposite:function(){return!0}}),G=q.extend({_class:"PlacedSymbol",_applyMatrix:!1,_canApplyMatrix:!1,_boundsGetter:{getBounds:"getStrokeBounds"},_boundsSelected:!0,_serializeFields:{symbol:null},initialize:function(w,S){this._initialize(w,S!==p&&O.read(arguments,1))||this.setSymbol(w instanceof F?w:new F(w))},_equals:function(p){return this._symbol===p._symbol},getSymbol:function(){return this._symbol},setSymbol:function(p){this._symbol=p,this._changed(9)},clone:function(p){var w=new G(q.NO_INSERT);return w.setSymbol(this._symbol),this._clone(w,p)},isEmpty:function(){return this._symbol._definition.isEmpty()},_getBounds:function(p,w,S){var M=this.symbol._definition;return M._getCachedBounds(p,w&&w.chain(M._matrix),S)},_hitTestSelf:function(p,w){var S=this._symbol._definition._hitTest(p,w);return S&&(S.item=this),S},_draw:function(p,w){this.symbol._definition.draw(p,w)}}),U=w.extend({_class:"HitResult",initialize:function(p,w,S){this.type=p,this.item=w,S&&(S.enumerable=!0,this.inject(S))},statics:{getOptions:function(p){return new w({type:null,tolerance:paper.settings.hitTolerance,fill:!p,stroke:!p,segments:!p,handles:!1,ends:!1,center:!1,bounds:!1,guides:!1,selected:!1},p)}}}),J=w.extend({_class:"Segment",beans:!0,initialize:function(w,S,M,z,I,k){var A,O,T,L=arguments.length;0===L||(1===L?w.point?(A=w.point,O=w.handleIn,T=w.handleOut):A=w:2===L&&"number"==typeof w?A=arguments:3>=L?(A=w,O=S,T=M):(A=w!==p?[w,S]:null,O=M!==p?[M,z]:null,T=I!==p?[I,k]:null)),new X(A,this,"_point"),new X(O,this,"_handleIn"),new X(T,this,"_handleOut")},_serialize:function(p){return w.serialize(this.isLinear()?this._point:[this._point,this._handleIn,this._handleOut],p,!0)},_changed:function(p){var w=this._path;if(w){var S,M=w._curves,z=this._index;M&&(p&&p!==this._point&&p!==this._handleIn||!(S=z>0?M[z-1]:w._closed?M[M.length-1]:null)||S._changed(),p&&p!==this._point&&p!==this._handleOut||!(S=M[z])||S._changed()),w._changed(25)}},getPoint:function(){return this._point},setPoint:function(){var p=O.read(arguments);this._point.set(p.x,p.y)},getHandleIn:function(){return this._handleIn},setHandleIn:function(){var p=O.read(arguments);this._handleIn.set(p.x,p.y)},getHandleOut:function(){return this._handleOut},setHandleOut:function(){var p=O.read(arguments);this._handleOut.set(p.x,p.y)},isLinear:function(){return this._handleIn.isZero()&&this._handleOut.isZero()},setLinear:function(p){p&&(this._handleIn.set(0,0),this._handleOut.set(0,0))},isColinear:function(p){var w=this.getNext(),S=p.getNext();return this._handleOut.isZero()&&w._handleIn.isZero()&&p._handleOut.isZero()&&S._handleIn.isZero()&&w._point.subtract(this._point).isColinear(S._point.subtract(p._point))},isOrthogonal:function(){var p=this.getPrevious(),w=this.getNext();return p._handleOut.isZero()&&this._handleIn.isZero()&&this._handleOut.isZero()&&w._handleIn.isZero()&&this._point.subtract(p._point).isOrthogonal(w._point.subtract(this._point))},isArc:function(){var p=this.getNext(),w=this._handleOut,S=p._handleIn,M=.5522847498307936;if(w.isOrthogonal(S)){var z=this._point,I=p._point,k=new E(z,w,!0).intersect(new E(I,S,!0),!0);return k&&A.isZero(w.getLength()/k.subtract(z).getLength()-M)&&A.isZero(S.getLength()/k.subtract(I).getLength()-M)}return!1},_selectionState:0,isSelected:function(p){var w=this._selectionState;return p?p===this._point?!!(4&w):p===this._handleIn?!!(1&w):p===this._handleOut&&!!(2&w):!!(7&w)},setSelected:function(p,w){var S=this._path,M=(p=!!p,this._selectionState),z=M,I=w?w===this._point?4:w===this._handleIn?1:w===this._handleOut?2:0:7;p?M|=I:M&=~I,this._selectionState=M,S&&M!==z&&(S._updateSelection(this,z,M),S._changed(129))},getIndex:function(){return this._index!==p?this._index:null},getPath:function(){return this._path||null},getCurve:function(){var p=this._path,w=this._index;return p?(w>0&&!p._closed&&w===p._segments.length-1&&w--,p.getCurves()[w]||null):null},getLocation:function(){var p=this.getCurve();return p?new $(p,this===p._segment1?0:1):null},getNext:function(){var p=this._path&&this._path._segments;return p&&(p[this._index+1]||this._path._closed&&p[0])||null},getPrevious:function(){var p=this._path&&this._path._segments;return p&&(p[this._index-1]||this._path._closed&&p[p.length-1])||null},reverse:function(){return new J(this._point,this._handleOut,this._handleIn)},remove:function(){return!!this._path&&!!this._path.removeSegment(this._index)},clone:function(){return new J(this._point,this._handleIn,this._handleOut)},equals:function(p){return p===this||p&&this._class===p._class&&this._point.equals(p._point)&&this._handleIn.equals(p._handleIn)&&this._handleOut.equals(p._handleOut)||!1},toString:function(){var p=["point: "+this._point];return this._handleIn.isZero()||p.push("handleIn: "+this._handleIn),this._handleOut.isZero()||p.push("handleOut: "+this._handleOut),"{ "+p.join(", ")+" }"},transform:function(p){this._transformCoordinates(p,Array(6),!0),this._changed()},_transformCoordinates:function(p,w,S){var M=this._point,z=S&&this._handleIn.isZero()?null:this._handleIn,I=S&&this._handleOut.isZero()?null:this._handleOut,k=M._x,A=M._y,O=2;return w[0]=k,w[1]=A,z&&(w[O++]=z._x+k,w[O++]=z._y+A),I&&(w[O++]=I._x+k,w[O++]=I._y+A),p&&(p._transformCoordinates(w,w,O/2),k=w[0],A=w[1],S?(M._x=k,M._y=A,O=2,z&&(z._x=w[O++]-k,z._y=w[O++]-A),I&&(I._x=w[O++]-k,I._y=w[O++]-A)):(z||(w[O++]=k,w[O++]=A),I||(w[O++]=k,w[O++]=A))),w}}),X=O.extend({initialize:function(w,S,M){var z,I,k;if(w)if((z=w[0])!==p)I=w[1];else{var A=w;(z=A.x)===p&&(z=(A=O.read(arguments)).x),I=A.y,k=A.selected}else z=I=0;this._x=z,this._y=I,this._owner=S,S[M]=this,k&&this.setSelected(!0)},set:function(p,w){return this._x=p,this._y=w,this._owner._changed(this),this},_serialize:function(p){var w=p.formatter,S=w.number(this._x),M=w.number(this._y);return this.isSelected()?{x:S,y:M,selected:!0}:[S,M]},getX:function(){return this._x},setX:function(p){this._x=p,this._owner._changed(this)},getY:function(){return this._y},setY:function(p){this._y=p,this._owner._changed(this)},isZero:function(){return A.isZero(this._x)&&A.isZero(this._y)},setSelected:function(p){this._owner.setSelected(p,this)},isSelected:function(){return this._owner.isSelected(this)}}),Y=w.extend({_class:"Curve",initialize:function(p,w,S,M,z,I,k,A){var O=arguments.length;if(3===O)this._path=p,this._segment1=w,this._segment2=S;else if(0===O)this._segment1=new J,this._segment2=new J;else if(1===O)this._segment1=new J(p.segment1),this._segment2=new J(p.segment2);else if(2===O)this._segment1=new J(p),this._segment2=new J(w);else{var T,L,N,B;4===O?(T=p,L=w,N=S,B=M):8===O&&(T=[p,w],B=[k,A],L=[S-p,M-w],N=[z-k,I-A]),this._segment1=new J(T,null,L),this._segment2=new J(B,N,null)}},_changed:function(){this._length=this._bounds=p},getPoint1:function(){return this._segment1._point},setPoint1:function(){var p=O.read(arguments);this._segment1._point.set(p.x,p.y)},getPoint2:function(){return this._segment2._point},setPoint2:function(){var p=O.read(arguments);this._segment2._point.set(p.x,p.y)},getHandle1:function(){return this._segment1._handleOut},setHandle1:function(){var p=O.read(arguments);this._segment1._handleOut.set(p.x,p.y)},getHandle2:function(){return this._segment2._handleIn},setHandle2:function(){var p=O.read(arguments);this._segment2._handleIn.set(p.x,p.y)},getSegment1:function(){return this._segment1},getSegment2:function(){return this._segment2},getPath:function(){return this._path},getIndex:function(){return this._segment1._index},getNext:function(){var p=this._path&&this._path._curves;return p&&(p[this._segment1._index+1]||this._path._closed&&p[0])||null},getPrevious:function(){var p=this._path&&this._path._curves;return p&&(p[this._segment1._index-1]||this._path._closed&&p[p.length-1])||null},isSelected:function(){return this.getPoint1().isSelected()&&this.getHandle2().isSelected()&&this.getHandle2().isSelected()&&this.getPoint2().isSelected()},setSelected:function(p){this.getPoint1().setSelected(p),this.getHandle1().setSelected(p),this.getHandle2().setSelected(p),this.getPoint2().setSelected(p)},getValues:function(p){return Y.getValues(this._segment1,this._segment2,p)},getPoints:function(){for(var p=this.getValues(),w=[],S=0;8>S;S+=2)w.push(new O(p[S],p[S+1]));return w},getLength:function(){return null==this._length&&(this._length=this.isLinear()?this._segment2._point.getDistance(this._segment1._point):Y.getLength(this.getValues(),0,1)),this._length},getArea:function(){return Y.getArea(this.getValues())},getPart:function(p,w){return new Y(Y.getPart(this.getValues(),p,w))},getPartLength:function(p,w){return Y.getLength(this.getValues(),p,w)},isLinear:function(){return this._segment1._handleOut.isZero()&&this._segment2._handleIn.isZero()},getIntersections:function(p){return Y.filterIntersections(Y.getIntersections(this.getValues(),p.getValues(),this,p,[]))},_getParameter:function(w,S){return S?w:w&&w.curve===this?w.parameter:w===p&&S===p?.5:this.getParameterAt(w,0)},divide:function(p,w,S){var M=this._getParameter(p,w),z=1e-6,I=null;if(M>z&&1-z>M){var k=Y.subdivide(this.getValues(),M),A=!S&&this.isLinear(),T=k[0],L=k[1];A||(this._segment1._handleOut.set(T[2]-T[0],T[3]-T[1]),this._segment2._handleIn.set(L[4]-L[6],L[5]-L[7]));var N=T[6],B=T[7],D=new J(new O(N,B),!A&&new O(T[4]-N,T[5]-B),!A&&new O(L[2]-N,L[3]-B));if(this._path)this._segment1._index>0&&0===this._segment2._index?this._path.add(D):this._path.insert(this._segment2._index,D),I=this;else{var j=this._segment2;this._segment2=D,I=new Y(D,j)}}return I},split:function(p,w){return this._path?this._path.split(this._segment1._index,this._getParameter(p,w)):null},reverse:function(){return new Y(this._segment2.reverse(),this._segment1.reverse())},remove:function(){var p=!1;if(this._path){var w=this._segment2,S=w._handleOut;(p=w.remove())&&this._segment1._handleOut.set(S.x,S.y)}return p},clone:function(){return new Y(this._segment1,this._segment2)},toString:function(){var p=["point1: "+this._segment1._point];return this._segment1._handleOut.isZero()||p.push("handle1: "+this._segment1._handleOut),this._segment2._handleIn.isZero()||p.push("handle2: "+this._segment2._handleIn),p.push("point2: "+this._segment2._point),"{ "+p.join(", ")+" }"},statics:{getValues:function(p,w,S){var M=p._point,z=p._handleOut,I=w._handleIn,k=w._point,A=[M._x,M._y,M._x+z._x,M._y+z._y,k._x+I._x,k._y+I._y,k._x,k._y];return S&&S._transformCoordinates(A,A,4),A},evaluate:function(p,w,S){var M,z,I=p[0],k=p[1],A=p[2],T=p[3],L=p[4],N=p[5],B=p[6],D=p[7],j=1e-6;if(0===S&&(j>w||w>1-j)){var E=j>w;M=E?I:B,z=E?k:D}else{var R=3*(A-I),F=3*(L-A)-R,q=B-I-R-F,V=3*(T-k),Z=3*(N-T)-V,H=D-k-V-Z;if(0===S)M=((q*w+F)*w+R)*w+I,z=((H*w+Z)*w+V)*w+k;else if(j>w&&A===I&&T===k||w>1-j&&L===B&&N===D?(M=L-A,z=N-T):j>w?(M=R,z=V):w>1-j?(M=3*(B-L),z=3*(D-N)):(M=(3*q*w+2*F)*w+R,z=(3*H*w+2*Z)*w+V),3===S){return(M*(6*H*w+2*Z)-z*(6*q*w+2*F))/Math.pow(M*M+z*z,1.5)}}return 2===S?new O(z,-M):new O(M,z)},subdivide:function(w,S){var M=w[0],z=w[1],I=w[2],k=w[3],A=w[4],O=w[5],T=w[6],L=w[7];S===p&&(S=.5);var N=1-S,B=N*M+S*I,D=N*z+S*k,j=N*I+S*A,E=N*k+S*O,R=N*A+S*T,F=N*O+S*L,q=N*B+S*j,V=N*D+S*E,Z=N*j+S*R,H=N*E+S*F,W=N*q+S*Z,G=N*V+S*H;return[[M,z,B,D,q,V,W,G],[W,G,Z,H,R,F,T,L]]},solveCubic:function(p,w,S,M,z,I){var k=p[w],O=p[w+2],T=3*(O-k),L=3*(p[w+4]-O)-T,N=p[w+6]-k-T-L,B=A.isZero;return B(N)&&B(L)&&(N=L=0),A.solveCubic(N,L,T,k-S,M,z,I)},getParameterOf:function(p,w,S){var M=1e-6;if(Math.abs(p[0]-w)<M&&Math.abs(p[1]-S)<M)return 0;if(Math.abs(p[6]-w)<M&&Math.abs(p[7]-S)<M)return 1;for(var z,I,k=[],A=[],O=Y.solveCubic(p,0,w,k,0,1),T=Y.solveCubic(p,1,S,A,0,1),L=0;-1==O||O>L;)if(-1==O||(z=k[L++])>=0&&1>=z){for(var N=0;-1==T||T>N;)if((-1==T||(I=A[N++])>=0&&1>=I)&&(-1==O?z=I:-1==T&&(I=z),Math.abs(z-I)<M))return.5*(z+I);if(-1==O)break}return null},getPart:function(p,w,S){return w>0&&(p=Y.subdivide(p,w)[1]),1>S&&(p=Y.subdivide(p,(S-w)/(1-w))[0]),p},isLinear:function(p){var w=A.isZero;return w(p[0]-p[2])&&w(p[1]-p[3])&&w(p[4]-p[6])&&w(p[5]-p[7])},isFlatEnough:function(p,w){var S=p[0],M=p[1],z=p[2],I=p[3],k=p[4],A=p[5],O=p[6],T=p[7],L=3*z-2*S-O,N=3*I-2*M-T,B=3*k-2*O-S,D=3*A-2*T-M;return Math.max(L*L,B*B)+Math.max(N*N,D*D)<10*w*w},getArea:function(p){var w=p[0],S=p[1],M=p[2],z=p[3],I=p[4],k=p[5],A=p[6],O=p[7];return(3*z*w-1.5*z*I-1.5*z*A-3*S*M-1.5*S*I-.5*S*A+1.5*k*w+1.5*k*M-3*k*A+.5*O*w+1.5*O*M+3*O*I)/10},getEdgeSum:function(p){return(p[0]-p[2])*(p[3]+p[1])+(p[2]-p[4])*(p[5]+p[3])+(p[4]-p[6])*(p[7]+p[5])},getBounds:function(p){for(var w=p.slice(0,2),S=w.slice(),M=[0,0],z=0;2>z;z++)Y._addBounds(p[z],p[z+2],p[z+4],p[z+6],z,0,w,S,M);return new B(w[0],w[1],S[0]-w[0],S[1]-w[1])},_addBounds:function(p,w,S,M,z,I,k,O,T){function l(p,w){var S=p-w,M=p+w;S<k[z]&&(k[z]=S),M>O[z]&&(O[z]=M)}var L=3*(w-S)-p+M,N=2*(p+S)-4*w,B=w-p,D=A.solveQuadratic(L,N,B,T),j=1e-6;l(M,0);for(var E=0;D>E;E++){var R=T[E],F=1-R;R>j&&.999999>R&&l(F*F*F*p+3*F*F*R*w+3*F*R*R*S+R*R*R*M,I)}}}},w.each(["getBounds","getStrokeBounds","getHandleBounds","getRoughBounds"],(function(p){this[p]=function(){this._bounds||(this._bounds={});var w=this._bounds[p];return w||(w=this._bounds[p]=Q[p]([this._segment1,this._segment2],!1,this._path.getStyle())),w.clone()}}),{}),w.each(["getPoint","getTangent","getNormal","getCurvature"],(function(p,w){this[p+"At"]=function(p,S){var M=this.getValues();return Y.evaluate(M,S?p:Y.getParameterAt(M,p,0),w)},this[p]=function(p){return Y.evaluate(this.getValues(),p,w)}}),{beans:!1,getParameterAt:function(p,w){return Y.getParameterAt(this.getValues(),p,w)},getParameterOf:function(){var p=O.read(arguments);return Y.getParameterOf(this.getValues(),p.x,p.y)},getLocationAt:function(p,w){return w||(p=this.getParameterAt(p)),p>=0&&1>=p&&new $(this,p)},getLocationOf:function(){return this.getLocationAt(this.getParameterOf(O.read(arguments)),!0)},getOffsetOf:function(){var p=this.getLocationOf.apply(this,arguments);return p?p.getOffset():null},getNearestLocation:function(){function t(z){if(z>=0&&1>=z){var I=p.getDistance(Y.evaluate(w,z,0),!0);if(S>I)return S=I,M=z,!0}}for(var p=O.read(arguments),w=this.getValues(),S=1/0,M=0,z=0;100>=z;z++)t(z/100);for(var I=.005;I>1e-6;)t(M-I)||t(M+I)||(I/=2);var k=Y.evaluate(w,M,0);return new $(this,M,k,null,null,null,p.getDistance(k))},getNearestPoint:function(){return this.getNearestLocation.apply(this,arguments).getPoint()}}),new function(){function e(p){var w=p[0],S=p[1],M=p[2],z=p[3],I=p[4],k=p[5],A=p[6],O=p[7],T=9*(M-I)+3*(A-w),L=6*(w+I)-12*M,N=3*(M-w),B=9*(z-k)+3*(O-S),D=6*(S+k)-12*z,j=3*(z-S);return function(p){var w=(T*p+L)*p+N,S=(B*p+D)*p+j;return Math.sqrt(w*w+S*S)}}function i(p,w){return Math.max(2,Math.min(16,Math.ceil(32*Math.abs(w-p))))}return{statics:!0,getLength:function(w,S,M){S===p&&(S=0),M===p&&(M=1);var z=A.isZero;if(0===S&&1===M&&z(w[0]-w[2])&&z(w[1]-w[3])&&z(w[6]-w[4])&&z(w[7]-w[5])){var I=w[6]-w[0],k=w[7]-w[1];return Math.sqrt(I*I+k*k)}var O=e(w);return A.integrate(O,S,M,i(S,M))},getParameterAt:function(w,S,M){if(M===p&&(M=0>S?1:0),0===S)return M;var z=S>0,I=z?M:0,k=z?1:M,O=e(w),T=A.integrate(O,I,k,i(I,k));if(Math.abs(S)>=T)return z?k:I;var L=S/T,N=0;return A.findRoot((function a(p){return N+=A.integrate(O,M,p,i(M,p)),M=p,N-S}),O,M+L,I,k,16,1e-6)}}},new function(){function t(p,w,S,M,z,I,k,A){var O=new $(S,M,z,I,k,A);(!w||w(O))&&p.push(O)}function e(p,w,S,M,z,I,k,A,O,T,L,N,B){if(!(B>32)){var D,j,R,F=w[0],q=w[1],V=w[6],Z=w[7],H=1e-6,W=E.getSignedDistance,G=W(F,q,V,Z,w[2],w[3])||0,U=W(F,q,V,Z,w[4],w[5])||0,J=G*U>0?.75:4/9,X=J*Math.min(0,G,U),$=J*Math.max(0,G,U),K=W(F,q,V,Z,p[0],p[1]),Q=W(F,q,V,Z,p[2],p[3]),tt=W(F,q,V,Z,p[4],p[5]),et=W(F,q,V,Z,p[6],p[7]);if(F===V&&H>=T-O&&B>3)j=D=(A+k)/2,R=0;else{var it,nt,rt=function i(p,w,S,M){var z,I=[0,p],k=[1/3,w],A=[2/3,S],O=[1,M],T=E.getSignedDistance,L=T(0,p,1,M,1/3,w),N=T(0,p,1,M,2/3,S),B=!1;if(0>L*N)z=[[I,k,O],[I,A,O]],B=0>L;else{var D,j=0,R=0===L||0===N;Math.abs(L)>Math.abs(N)?(D=k,j=(M-S-(M-p)/3)*(2*(M-S)-M+w)/3):(D=A,j=(w-p+(p-M)/3)*(-2*(p-w)+p-S)/3),z=0>j||R?[[I,D,O],[I,O]]:[[I,k,A,O],[I,O]],B=L?0>L:0>N}return B?z.reverse():z}(K,Q,tt,et),st=rt[0],at=rt[1];if(it=n(st,at,X,$),st.reverse(),at.reverse(),nt=n(st,at,X,$),null==it||null==nt)return;p=Y.getPart(p,it,nt),R=nt-it,D=A*it+k*(1-it),j=A*nt+k*(1-nt)}if(L>.5&&R>.5)if(j-D>T-O){var ot=D+(j-D)/2;e(w,(ht=Y.subdivide(p,.5))[0],M,S,z,I,O,T,D,ot,R,!N,++B),e(w,ht[1],M,S,z,I,O,T,ot,j,R,!N,B)}else{var ht;ot=O+(T-O)/2;e((ht=Y.subdivide(w,.5))[0],p,M,S,z,I,O,ot,D,j,R,!N,++B),e(ht[1],p,M,S,z,I,ot,T,D,j,R,!N,B)}else if(Math.max(T-O,j-D)<H){var ut=D+(j-D)/2,lt=O+(T-O)/2;N?t(z,I,M,lt,Y.evaluate(w,lt,0),S,ut,Y.evaluate(p,ut,0)):t(z,I,S,ut,Y.evaluate(p,ut,0),M,lt,Y.evaluate(w,lt,0))}else R>0&&e(w,p,M,S,z,I,O,T,D,j,R,!N,++B)}}function n(p,w,S,M){return p[0][1]<S?r(p,!0,S):w[0][1]>M?r(w,!1,M):p[0][0]}function r(p,w,S){for(var M=p[0][0],z=p[0][1],I=1,k=p.length;k>I;I++){var A=p[I][0],O=p[I][1];if(w?O>=S:S>=O)return M+(S-z)*(A-M)/(O-z);M=A,z=O}return null}function s(p,w,S,M,z,I){for(var k=Y.isLinear(p),A=k?w:p,O=k?p:w,T=O[0],L=O[1],N=O[6]-T,B=O[7]-L,D=Math.atan2(-B,N),j=Math.sin(D),E=Math.cos(D),R=N*E-B*j,F=[0,0,0,0,R,0,R,0],q=[],V=0;8>V;V+=2){var Z=A[V]-T,H=A[V+1]-L;q.push(Z*E-H*j,H*E+Z*j)}var W=[],G=Y.solveCubic(q,1,0,W,0,1);for(V=0;G>V;V++){var U=W[V];if((Z=Y.evaluate(q,U,0).x)>=0&&R>=Z){var J=Y.getParameterOf(F,Z,0),X=k?J:U,$=k?U:J;t(z,I,S,X,Y.evaluate(p,X,0),M,$,Y.evaluate(w,$,0))}}}function a(p,w,S,M,z,I){var k=E.intersect(p[0],p[1],p[6],p[7],w[0],w[1],w[6],w[7]);if(k){var A=k.x,O=k.y;t(z,I,S,Y.getParameterOf(p,A,O),k,M,Y.getParameterOf(w,A,O),k)}}return{statics:{getIntersections:function(p,w,S,M,z,I){var k=Y.isLinear(p),A=Y.isLinear(w),O=S.getPoint1(),T=S.getPoint2(),L=M.getPoint1(),N=M.getPoint2(),B=1e-6;return O.isClose(L,B)&&t(z,I,S,0,O,M,0,O),O.isClose(N,B)&&t(z,I,S,0,O,M,1,O),(k&&A?a:k||A?s:e)(p,w,S,M,z,I,0,1,0,1,0,!1,0),T.isClose(L,B)&&t(z,I,S,1,T,M,0,T),T.isClose(N,B)&&t(z,I,S,1,T,M,1,T),z},filterIntersections:function(p,w){function i(p,w){var S=p.getPath(),M=w.getPath();return S===M?p.getIndex()+p.getParameter()-(w.getIndex()+w.getParameter()):S._id-M._id}for(var S=p.length-1,M=.999999,z=S;z>=0;z--){var I=p[z],k=I._curve.getNext(),A=I._curve2.getNext();k&&I._parameter>=M&&(I._parameter=0,I._curve=k),A&&I._parameter2>=M&&(I._parameter2=0,I._curve2=A)}if(S>0){p.sort(i);for(z=S;z>0;z--)p[z].equals(p[z-1])&&(p.splice(z,1),S--)}if(w){for(z=S;z>=0;z--)p.push(p[z].getIntersection());p.sort(i)}return p}}}}),$=w.extend({_class:"CurveLocation",beans:!0,initialize:function pe(p,w,S,M,z,I,k){this._id=pe._id=(pe._id||0)+1,this._curve=p,this._segment1=p._segment1,this._segment2=p._segment2,this._parameter=w,this._point=S,this._curve2=M,this._parameter2=z,this._point2=I,this._distance=k},getSegment:function(p){if(!this._segment){var w=this.getCurve(),S=this.getParameter();if(1===S)this._segment=w._segment2;else if(0===S||p)this._segment=w._segment1;else{if(null==S)return null;this._segment=w.getPartLength(0,S)<w.getPartLength(S,1)?w._segment1:w._segment2}}return this._segment},getCurve:function(p){return(!this._curve||p)&&(this._curve=this._segment1.getCurve(),null==this._curve.getParameterOf(this._point)&&(this._curve=this._segment2.getPrevious().getCurve())),this._curve},getIntersection:function(){var p=this._intersection;if(!p&&this._curve2){var w=this._parameter2;this._intersection=p=new $(this._curve2,w,this._point2||this._point,this),p._intersection=this}return p},getPath:function(){var p=this.getCurve();return p&&p._path},getIndex:function(){var p=this.getCurve();return p&&p.getIndex()},getOffset:function(){var p=this.getPath();return p?p._getOffset(this):this.getCurveOffset()},getCurveOffset:function(){var p=this.getCurve(),w=this.getParameter();return null!=w&&p&&p.getPartLength(0,w)},getParameter:function(p){if((null==this._parameter||p)&&this._point){var w=this.getCurve(p);this._parameter=w&&w.getParameterOf(this._point)}return this._parameter},getPoint:function(p){if((!this._point||p)&&null!=this._parameter){var w=this.getCurve(p);this._point=w&&w.getPointAt(this._parameter,!0)}return this._point},getDistance:function(){return this._distance},divide:function(){var p=this.getCurve(!0);return p&&p.divide(this.getParameter(!0),!0)},split:function(){var p=this.getCurve(!0);return p&&p.split(this.getParameter(!0),!0)},equals:function(p){var w=Math.abs,S=1e-6;return this===p||p&&this._curve===p._curve&&this._curve2===p._curve2&&w(this._parameter-p._parameter)<=S&&w(this._parameter2-p._parameter2)<=S||!1},toString:function(){var p=[],w=this.getPoint(),S=I.instance;w&&p.push("point: "+w);var M=this.getIndex();null!=M&&p.push("index: "+M);var z=this.getParameter();return null!=z&&p.push("parameter: "+S.number(z)),null!=this._distance&&p.push("distance: "+S.number(this._distance)),"{ "+p.join(", ")+" }"}},w.each(["getTangent","getNormal","getCurvature"],(function(p){var w=p+"At";this[p]=function(){var p=this.getParameter(),S=this.getCurve();return null!=p&&S&&S[w](p,!0)}}),{})),K=q.extend({_class:"PathItem",initialize:function(){},getIntersections:function(w,S,M){this===w&&(w=null);var z=[],I=this.getCurves(),k=w?w.getCurves():I,A=this._matrix.orNullIfIdentity(),O=w?(S||w._matrix).orNullIfIdentity():A,T=I.length,L=w?k.length:T,N=[],B=1e-6,D=1-B;if(w&&!this.getBounds(A).touches(w.getBounds(O)))return[];for(var j=0;L>j;j++)N[j]=k[j].getValues(O);for(j=0;T>j;j++){var R=I[j],F=w?R.getValues(A):N[j];if(!w){var q=R.getSegment1(),V=R.getSegment2(),Z=q._handleOut,H=V._handleIn;if(new E(q._point.subtract(Z),Z.multiply(2),!0).intersect(new E(V._point.subtract(H),H.multiply(2),!0),!1)){var W=Y.subdivide(F);Y.getIntersections(W[0],W[1],R,R,z,(function(w){return w._parameter<=D?(w._parameter/=2,w._parameter2=.5+w._parameter2/2,!0):p}))}}for(var G=w?0:j+1;L>G;G++)Y.getIntersections(F,N[G],R,k[G],z,!w&&(G===j+1||G===L-1&&0===j)&&function(p){var w=p._parameter;return w>=B&&D>=w})}return Y.filterIntersections(z,M)},_asPathItem:function(){return this},setPathData:function(p){function e(p,S){var M=+w[p];return I&&(M+=k[S]),M}function i(p){return new O(e(p,"x"),e(p+1,"y"))}var w,S,M,z=p.match(/[mlhvcsqtaz][^mlhvcsqtaz]*/gi),I=!1,k=new O,A=new O;this.clear();for(var T=0,N=z&&z.length;N>T;T++){var B=z[T],D=B[0],j=D.toLowerCase(),E=(w=B.match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g))&&w.length;switch(I=D===j,"z"!==S||/[mz]/.test(j)||this.moveTo(k=A),j){case"m":case"l":var R="m"===j;R&&S&&"z"!==S&&this.closePath(!0);for(var F=0;E>F;F+=2)this[0===F&&R?"moveTo":"lineTo"](k=i(F));M=k,R&&(A=k);break;case"h":case"v":var q="h"===j?"x":"y";for(F=0;E>F;F++)k[q]=e(F,q),this.lineTo(k);M=k;break;case"c":for(F=0;E>F;F+=6)this.cubicCurveTo(i(F),M=i(F+2),k=i(F+4));break;case"s":for(F=0;E>F;F+=4)this.cubicCurveTo(/[cs]/.test(S)?k.multiply(2).subtract(M):k,M=i(F),k=i(F+2)),S=j;break;case"q":for(F=0;E>F;F+=4)this.quadraticCurveTo(M=i(F),k=i(F+2));break;case"t":for(F=0;E>F;F+=2)this.quadraticCurveTo(M=/[qt]/.test(S)?k.multiply(2).subtract(M):k,k=i(F)),S=j;break;case"a":for(F=0;E>F;F+=7)this.arcTo(k=i(F+5),new L(+w[F],+w[F+1]),+w[F+2],+w[F+4],+w[F+3]);break;case"z":this.closePath(!0)}S=j}},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_contains:function(p){var w=this._getWinding(p,!1,!0);return!!("evenodd"===this.getWindingRule()?1&w:w)}}),Q=K.extend({_class:"Path",_serializeFields:{segments:[],closed:!1},initialize:function(w){this._closed=!1,this._segments=[];var S=Array.isArray(w)?"object"==typeof w[0]?w:arguments:!w||w.size!==p||w.x===p&&w.point===p?null:arguments;S&&S.length>0?this.setSegments(S):(this._curves=p,this._selectedSegmentState=0,S||"string"!=typeof w||(this.setPathData(w),w=null)),this._initialize(!S&&w)},_equals:function(p){return this._closed===p._closed&&w.equals(this._segments,p._segments)},clone:function(w){var S=new Q(q.NO_INSERT);return S.setSegments(this._segments),S._closed=this._closed,this._clockwise!==p&&(S._clockwise=this._clockwise),this._clone(S,w)},_changed:function ye(w){if(ye.base.call(this,w),8&w){var S=this._parent;if(S&&(S._currentPath=p),this._length=this._clockwise=p,this._curves&&!(16&w))for(var M=0,z=this._curves.length;z>M;M++)this._curves[M]._changed();this._monoCurves=p}else 32&w&&(this._bounds=p)},getStyle:function(){var p=this._parent;return(p instanceof tt?p:this)._style},getSegments:function(){return this._segments},setSegments:function(w){var S=this.isFullySelected();this._segments.length=0,this._selectedSegmentState=0,this._curves=p,w&&w.length>0&&this._add(J.readAll(w)),S&&this.setFullySelected(!0)},getFirstSegment:function(){return this._segments[0]},getLastSegment:function(){return this._segments[this._segments.length-1]},getCurves:function(){var p=this._curves,w=this._segments;if(!p){var S=this._countCurves();p=this._curves=Array(S);for(var M=0;S>M;M++)p[M]=new Y(this,w[M],w[M+1]||w[0])}return p},getFirstCurve:function(){return this.getCurves()[0]},getLastCurve:function(){var p=this.getCurves();return p[p.length-1]},isClosed:function(){return this._closed},setClosed:function(p){if(this._closed!=(p=!!p)){if(this._closed=p,this._curves){var w=this._curves.length=this._countCurves();p&&(this._curves[w-1]=new Y(this,this._segments[w-1],this._segments[0]))}this._changed(25)}}},{beans:!0,getPathData:function(p,w){function i(w,I){w._transformCoordinates(p,j,!1),S=j[0],M=j[1],E?(R.push("M"+D.pair(S,M)),E=!1):(A=j[2],O=j[3],A===S&&O===M&&T===z&&L===k?I||R.push("l"+D.pair(S-z,M-k)):R.push("c"+D.pair(T-z,L-k)+" "+D.pair(A-z,O-k)+" "+D.pair(S-z,M-k))),z=S,k=M,T=j[4],L=j[5]}var S,M,z,k,A,O,T,L,N=this._segments,B=N.length,D=new I(w),j=Array(6),E=!0,R=[];if(0===B)return"";for(var F=0;B>F;F++)i(N[F]);return this._closed&&B>0&&(i(N[0],!0),R.push("z")),R.join("")}},{isEmpty:function(){return 0===this._segments.length},isPolygon:function(){for(var p=0,w=this._segments.length;w>p;p++)if(!this._segments[p].isLinear())return!1;return!0},_transformContent:function(p){for(var w=Array(6),S=0,M=this._segments.length;M>S;S++)this._segments[S]._transformCoordinates(p,w,!0);return!0},_add:function(p,w){for(var S=this._segments,M=this._curves,z=p.length,I=null==w,k=(w=I?S.length:w,0);z>k;k++){var A=p[k];A._path&&(A=p[k]=A.clone()),A._path=this,A._index=w+k,A._selectionState&&this._updateSelection(A,0,A._selectionState)}if(I)S.push.apply(S,p);else{S.splice.apply(S,[w,0].concat(p));k=w+z;for(var O=S.length;O>k;k++)S[k]._index=k}if(M||p._curves){M||(M=this._curves=[]);var T=w>0?w-1:w,L=T,N=Math.min(T+z,this._countCurves());p._curves&&(M.splice.apply(M,[T,0].concat(p._curves)),L+=p._curves.length);for(k=L;N>k;k++)M.splice(k,0,new Y(this,null,null));this._adjustCurves(T,N)}return this._changed(25),p},_adjustCurves:function(p,w){for(var S,M=this._segments,z=this._curves,I=p;w>I;I++)(S=z[I])._path=this,S._segment1=M[I],S._segment2=M[I+1]||M[0],S._changed();(S=z[this._closed&&0===p?M.length-1:p-1])&&(S._segment2=M[p]||M[0],S._changed()),(S=z[w])&&(S._segment1=M[w],S._changed())},_countCurves:function(){var p=this._segments.length;return!this._closed&&p>0?p-1:p},add:function(p){return arguments.length>1&&"number"!=typeof p?this._add(J.readAll(arguments)):this._add([J.read(arguments)])[0]},insert:function(p,w){return arguments.length>2&&"number"!=typeof w?this._add(J.readAll(arguments,1),p):this._add([J.read(arguments,1)],p)[0]},addSegment:function(){return this._add([J.read(arguments)])[0]},insertSegment:function(p){return this._add([J.read(arguments,1)],p)[0]},addSegments:function(p){return this._add(J.readAll(p))},insertSegments:function(p,w){return this._add(J.readAll(w),p)},removeSegment:function(p){return this.removeSegments(p,p+1)[0]||null},removeSegments:function(p,S,M){p=p||0,S=w.pick(S,this._segments.length);var z=this._segments,I=this._curves,k=z.length,A=z.splice(p,S-p),O=A.length;if(!O)return A;for(var T=0;O>T;T++){var L=A[T];L._selectionState&&this._updateSelection(L,L._selectionState,0),L._index=L._path=null}T=p;for(var N=z.length;N>T;T++)z[T]._index=T;if(I){var B=p>0&&S===k+(this._closed?1:0)?p-1:p;I=I.splice(B,O);M&&(A._curves=I.slice(1)),this._adjustCurves(B,B)}return this._changed(25),A},clear:"#removeSegments",getLength:function(){if(null==this._length){var p=this.getCurves();this._length=0;for(var w=0,S=p.length;S>w;w++)this._length+=p[w].getLength()}return this._length},getArea:function(){for(var p=this.getCurves(),w=0,S=0,M=p.length;M>S;S++)w+=p[S].getArea();return w},isFullySelected:function(){var p=this._segments.length;return this._selected&&p>0&&this._selectedSegmentState===7*p},setFullySelected:function(p){p&&this._selectSegments(!0),this.setSelected(p)},setSelected:function we(p){p||this._selectSegments(!1),we.base.call(this,p)},_selectSegments:function(p){var w=this._segments.length;this._selectedSegmentState=p?7*w:0;for(var S=0;w>S;S++)this._segments[S]._selectionState=p?7:0},_updateSelection:function(p,w,S){p._selectionState=S,(this._selectedSegmentState+=S-w)>0&&this.setSelected(!0)},flatten:function(p){for(var w=new et(this,64,.1),S=0,M=w.length/Math.ceil(w.length/p),z=w.length+(this._closed?-M:M)/2,I=[];z>=S;)I.push(new J(w.evaluate(S,0))),S+=M;this.setSegments(I)},reduce:function(){for(var p=this.getCurves(),w=p.length-1;w>=0;w--){var S=p[w];S.isLinear()&&0===S.getLength()&&S.remove()}return this},simplify:function(p){if(this._segments.length>2){var w=new it(this,p||2.5);this.setSegments(w.fit())}},split:function(p,w){if(null===w)return null;if(1===arguments.length){var S=p;if("number"==typeof S&&(S=this.getLocationAt(S)),!S)return null;p=S.index,w=S.parameter}var M=1e-6;w>=1-M&&(p++,w--);var z=this.getCurves();if(p>=0&&p<z.length){w>M&&z[p++].divide(w,!0);var I,k=this.removeSegments(p,this._segments.length,!0);return this._closed?(this.setClosed(!1),I=this):I=this._clone((new Q).insertAbove(this,!0)),I._add(k,0),this.addSegment(k[0]),I}return null},isClockwise:function(){return this._clockwise!==p?this._clockwise:Q.isClockwise(this._segments)},setClockwise:function(p){this.isClockwise()!=(p=!!p)&&this.reverse(),this._clockwise=p},reverse:function(){this._segments.reverse();for(var w=0,S=this._segments.length;S>w;w++){var M=this._segments[w],z=M._handleIn;M._handleIn=M._handleOut,M._handleOut=z,M._index=w}this._curves=null,this._clockwise!==p&&(this._clockwise=!this._clockwise),this._changed(9)},join:function(p){if(p){var w=p._segments,S=this.getLastSegment(),M=p.getLastSegment();if(!M)return this;S&&S._point.equals(M._point)&&p.reverse();var z=p.getFirstSegment();if(S&&S._point.equals(z._point))S.setHandleOut(z._handleOut),this._add(w.slice(1));else{var I=this.getFirstSegment();I&&I._point.equals(z._point)&&p.reverse(),M=p.getLastSegment(),I&&I._point.equals(M._point)?(I.setHandleIn(M._handleIn),this._add(w.slice(0,w.length-1),0)):this._add(w.slice())}p.closed&&this._add([w[0]]),p.remove()}var k=this.getFirstSegment(),A=this.getLastSegment();return k!==A&&k._point.equals(A._point)&&(k.setHandleIn(A._handleIn),A.remove(),this.setClosed(!0)),this},toShape:function(w){function i(p,w){return k[p].isColinear(k[w])}function r(p){return k[p].isArc()}function s(p,w){return k[p]._point.getDistance(k[w]._point)}if(!this._closed)return null;var S,M,z,I,k=this._segments;if(this.isPolygon()&&4===k.length&&i(0,2)&&i(1,3)&&function n(p){return k[p].isOrthogonal()}(1)?(S=H.Rectangle,M=new L(s(0,3),s(0,1)),I=k[1]._point.add(k[2]._point).divide(2)):8===k.length&&r(0)&&r(2)&&r(4)&&r(6)&&i(1,5)&&i(3,7)?(S=H.Rectangle,z=(M=new L(s(1,6),s(0,3))).subtract(new L(s(0,7),s(1,2))).divide(2),I=k[3]._point.add(k[4]._point).divide(2)):4===k.length&&r(0)&&r(1)&&r(2)&&r(3)&&(A.isZero(s(0,2)-s(1,3))?(S=H.Circle,z=s(0,2)/2):(S=H.Ellipse,z=new L(s(2,0)/2,s(3,1)/2)),I=k[1]._point),S){var O=this.getPosition(!0),T=new S({center:O,size:M,radius:z,insert:!1});return T.rotate(I.subtract(O).getAngle()+90),T.setStyle(this._style),(w||w===p)&&T.insertAbove(this),T}return null},_hitTestSelf:function(p,w){function i(w,S){return p.subtract(w).divide(S).length<=1}function n(p,S,M){if(!w.selected||S.isSelected()){var z=p._point;if(S!==z&&(S=S.add(z)),i(S,E))return new U(M,T,{segment:p,point:S})}}function r(p,S){return(S||w.segments)&&n(p,p._point,"segment")||!S&&w.handles&&(n(p,p._handleIn,"handle-in")||n(p,p._handleOut,"handle-out"))}function s(p){I.add(p)}function a(w){var k;return"round"===S&&"round"===M||(I=new Q({internal:!0,closed:!0}),D||w._index>0&&w._index<B-1?"round"!==S&&(w._handleIn.isZero()||w._handleOut.isZero())&&Q._addBevelJoin(w,S,V,z,s,!0):"round"!==M&&Q._addSquareCap(w,M,V,s,!0),I.isEmpty())?i(w._point,E):I.contains(p)||(k=I.getNearestLocation(p))&&i(k.getPoint(),j)}var S,M,z,I,k,A,T=this,L=this.getStyle(),N=this._segments,B=N.length,D=this._closed,j=w._tolerancePadding,E=j,R=w.stroke&&L.hasStroke(),F=w.fill&&L.hasFill(),q=w.curves,V=R?L.getStrokeWidth()/2:F&&w.tolerance>0||q?0:null;if(null!==V&&(V>0?(S=L.getStrokeJoin(),M=L.getStrokeCap(),z=V*L.getMiterLimit(),E=j.add(new O(V,V))):S=M="round"),!w.ends||w.segments||D){if(w.segments||w.handles)for(var Z=0;B>Z;Z++)if(A=r(N[Z]))return A}else if(A=r(N[0],!0)||r(N[B-1],!0))return A;if(null!==V){if(k=this.getNearestLocation(p)){var H=k.getParameter();0===H||1===H&&B>1?a(k.getSegment())||(k=null):i(k.getPoint(),E)||(k=null)}if(!k&&"miter"===S&&B>1)for(Z=0;B>Z;Z++){var W=N[Z];if(p.getDistance(W._point)<=z&&a(W)){k=W.getLocation();break}}}return!k&&F&&this._contains(p)||k&&!R&&!q?new U("fill",this):k?new U(R?"stroke":"curve",this,{location:k,point:k.getPoint()}):null}},w.each(["getPoint","getTangent","getNormal","getCurvature"],(function(p){this[p+"At"]=function(w,S){var M=this.getLocationAt(w,S);return M&&M[p]()}}),{beans:!1,_getOffset:function(p){var w=p&&p.getIndex();if(null!=w){for(var S=this.getCurves(),M=0,z=0;w>z;z++)M+=S[z].getLength();var I=S[w],k=p.getParameter();return k>0&&(M+=I.getPartLength(0,k)),M}return null},getLocationOf:function(){for(var p=O.read(arguments),w=this.getCurves(),S=0,M=w.length;M>S;S++){var z=w[S].getLocationOf(p);if(z)return z}return null},getOffsetOf:function(){var p=this.getLocationOf.apply(this,arguments);return p?p.getOffset():null},getLocationAt:function(p,w){var S=this.getCurves(),M=0;if(w){var z=~~p;return S[z].getLocationAt(p-z,!0)}for(var I=0,k=S.length;k>I;I++){var A=M,O=S[I];if((M+=O.getLength())>p)return O.getLocationAt(p-A)}return p<=this.getLength()?new $(S[S.length-1],1):null},getNearestLocation:function(){for(var p=O.read(arguments),w=this.getCurves(),S=1/0,M=null,z=0,I=w.length;I>z;z++){var k=w[z].getNearestLocation(p);k._distance<S&&(S=k._distance,M=k)}return M},getNearestPoint:function(){return this.getNearestLocation.apply(this,arguments).getPoint()}}),new function(){function e(p,w,S){function n(w){if(S)w._transformCoordinates(S,D,!1),M=D[0],z=D[1];else{var N=w._point;M=N._x,z=N._y}if(j)p.moveTo(M,z),j=!1;else{if(S)A=D[2],O=D[3];else{var B=w._handleIn;A=M+B._x,O=z+B._y}A===M&&O===z&&T===I&&L===k?p.lineTo(M,z):p.bezierCurveTo(T,L,A,O,M,z)}if(I=M,k=z,S)T=D[4],L=D[5];else{B=w._handleOut;T=I+B._x,L=k+B._y}}for(var M,z,I,k,A,O,T,L,N=w._segments,B=N.length,D=Array(6),j=!0,E=0;B>E;E++)n(N[E]);w._closed&&B>0&&n(N[0])}return{_draw:function(p,w,S){function r(p){return O[(p%T+T)%T]}var M=w.dontStart,z=w.dontFinish||w.clip,I=this.getStyle(),k=I.hasFill(),A=I.hasStroke(),O=I.getDashArray(),T=!paper.support.nativeDash&&A&&O&&O.length;if(M||p.beginPath(),!M&&this._currentPath?p.currentPath=this._currentPath:(k||A&&!T||z)&&(e(p,this,S),this._closed&&p.closePath(),M||(this._currentPath=p.currentPath)),!z&&(k||A)&&(this._setStyles(p),k&&(p.fill(I.getWindingRule()),p.shadowColor="rgba(0,0,0,0)"),A)){if(T){M||p.beginPath();var L,N=new et(this,32,.25,S),B=N.length,D=-I.getDashOffset(),j=0;for(D%=B;D>0;)D-=r(j--)+r(j--);for(;B>D;)L=D+r(j++),(D>0||L>0)&&N.drawPart(p,Math.max(D,0),Math.max(L,0)),D=L+r(j++)}p.stroke()}},_drawSelected:function(p,w){p.beginPath(),e(p,this,w),p.stroke(),function t(p,w,S,M){function r(w){var S=I[w],M=I[w+1];(L!=S||N!=M)&&(p.beginPath(),p.moveTo(L,N),p.lineTo(S,M),p.stroke(),p.beginPath(),p.arc(S,M,z,0,2*Math.PI,!0),p.fill())}for(var z=M/2,I=Array(6),k=0,A=w.length;A>k;k++){var O=w[k];O._transformCoordinates(S,I,!1);var T=O._selectionState,L=I[0],N=I[1];if(1&T&&r(2),2&T&&r(4),p.fillRect(L-z,N-z,M,M),!(4&T)){var B=p.fillStyle;p.fillStyle="#ffffff",p.fillRect(L-z+1,N-z+1,M-2,M-2),p.fillStyle=B}}}(p,this._segments,w,paper.settings.handleSize)}}},new function(){function t(p){var w=p.length,S=[],M=[],z=2;S[0]=p[0]/z;for(var I=1;w>I;I++)M[I]=1/z,z=(w-1>I?4:2)-M[I],S[I]=(p[I]-S[I-1])/z;for(I=1;w>I;I++)S[w-I-1]-=M[w-I]*S[w-I];return S}return{smooth:function(){var p=this._segments,w=p.length,S=this._closed,M=w,z=0;if(!(2>=w)){S&&(z=Math.min(w,4),M+=2*Math.min(w,z));for(var I=[],k=0;w>k;k++)I[k+z]=p[k]._point;if(S)for(k=0;z>k;k++)I[k]=p[k+w-z]._point,I[k+w+z]=p[k]._point;else M--;var A=[];for(k=1;M-1>k;k++)A[k]=4*I[k]._x+2*I[k+1]._x;A[0]=I[0]._x+2*I[1]._x,A[M-1]=3*I[M-1]._x;var T=t(A);for(k=1;M-1>k;k++)A[k]=4*I[k]._y+2*I[k+1]._y;A[0]=I[0]._y+2*I[1]._y,A[M-1]=3*I[M-1]._y;var L=t(A);if(S){k=0;for(var N=w;z>k;k++,N++){var B=k/z,D=1-B,j=k+z,E=N+z;T[N]=T[k]*B+T[N]*D,L[N]=L[k]*B+L[N]*D,T[E]=T[j]*D+T[E]*B,L[E]=L[j]*D+L[E]*B}M--}var R=null;for(k=z;M-z>=k;k++){var F=p[k-z];R&&F.setHandleIn(R.subtract(F._point)),M>k&&(F.setHandleOut(new O(T[k],L[k]).subtract(F._point)),R=M-1>k?new O(2*I[k+1]._x-T[k+1],2*I[k+1]._y-L[k+1]):new O((I[M]._x+T[M-1])/2,(I[M]._y+L[M-1])/2))}if(S&&R)(F=this._segments[0]).setHandleIn(R.subtract(F._point))}}}},new function(){function t(p){var w=p._segments;if(0===w.length)throw Error("Use a moveTo() command first");return w[w.length-1]}return{moveTo:function(){var p=this._segments;1===p.length&&this.removeSegment(0),p.length||this._add([new J(O.read(arguments))])},moveBy:function(){throw Error("moveBy() is unsupported on Path items.")},lineTo:function(){this._add([new J(O.read(arguments))])},cubicCurveTo:function(){var p=O.read(arguments),w=O.read(arguments),S=O.read(arguments),M=t(this);M.setHandleOut(p.subtract(M._point)),this._add([new J(S,w.subtract(S))])},quadraticCurveTo:function(){var p=O.read(arguments),w=O.read(arguments),S=t(this)._point;this.cubicCurveTo(p.add(S.subtract(p).multiply(1/3)),p.add(w.subtract(p).multiply(1/3)),w)},curveTo:function(){var p=O.read(arguments),S=O.read(arguments),M=w.pick(w.read(arguments),.5),z=1-M,I=t(this)._point,k=p.subtract(I.multiply(z*z)).subtract(S.multiply(M*M)).divide(2*M*z);if(k.isNaN())throw Error("Cannot put a curve through points with parameter = "+M);this.quadraticCurveTo(k,S)},arcTo:function(){var p,S,M,z,I=t(this),k=I._point,A=O.read(arguments),T=w.peek(arguments);if("boolean"==typeof(R=w.pick(T,!0)))var N=(q=k.add(A).divide(2)).add(q.subtract(k).rotate(R?-90:90));else if(w.remain(arguments)<=2)N=A,A=O.read(arguments);else{var B=L.read(arguments);if(B.isZero())return this.lineTo(A);var D=w.read(arguments),R=!!w.read(arguments),F=!!w.read(arguments),q=k.add(A).divide(2),V=(ct=k.subtract(q).rotate(-D)).x,Z=ct.y,H=Math.abs,W=H(B.width),G=H(B.height),U=W*W,X=G*G,Y=V*V,$=Z*Z,K=Math.sqrt(Y/U+$/X);if(K>1&&(U=(W*=K)*W,X=(G*=K)*G),H(K=(U*X-U*$-X*Y)/(U*$+X*Y))<1e-12&&(K=0),0>K)throw Error("Cannot create an arc with the given arguments");p=new O(W*Z/G,-G*V/W).multiply((F===R?-1:1)*Math.sqrt(K)).rotate(D).add(q),S=(M=(z=(new j).translate(p).rotate(D).scale(W,G))._inverseTransform(k)).getDirectedAngle(z._inverseTransform(A)),!R&&S>0?S-=360:R&&0>S&&(S+=360)}if(N){var Q=new E(k.add(N).divide(2),N.subtract(k).rotate(90),!0),tt=new E(N.add(A).divide(2),A.subtract(N).rotate(90),!0),et=new E(k,A),it=et.getSide(N);if(!(p=Q.intersect(tt,!0))){if(!it)return this.lineTo(A);throw Error("Cannot create an arc with the given arguments")}S=(M=k.subtract(p)).getDirectedAngle(A.subtract(p));var nt=et.getSide(p);0===nt?S=it*Math.abs(S):it===nt&&(S+=0>S?360:-360)}for(var rt=Math.abs(S),st=rt>=360?4:Math.ceil(rt/90),at=S/st,ot=at*Math.PI/360,ht=4/3*Math.sin(ot)/(1+Math.cos(ot)),ut=[],lt=0;st>=lt;lt++){var ct=A,dt=null;if(st>lt&&(dt=M.rotate(90).multiply(ht),z?(ct=z._transformPoint(M),dt=z._transformPoint(M.add(dt)).subtract(ct)):ct=p.add(M)),0===lt)I.setHandleOut(dt);else{var _t=M.rotate(-90).multiply(ht);z&&(_t=z._transformPoint(M.add(_t)).subtract(ct)),ut.push(new J(ct,_t,dt))}M=M.rotate(at)}this._add(ut)},lineBy:function(){var p=O.read(arguments),w=t(this)._point;this.lineTo(w.add(p))},curveBy:function(){var p=O.read(arguments),S=O.read(arguments),M=w.read(arguments),z=t(this)._point;this.curveTo(z.add(p),z.add(S),M)},cubicCurveBy:function(){var p=O.read(arguments),w=O.read(arguments),S=O.read(arguments),M=t(this)._point;this.cubicCurveTo(M.add(p),M.add(w),M.add(S))},quadraticCurveBy:function(){var p=O.read(arguments),w=O.read(arguments),S=t(this)._point;this.quadraticCurveTo(S.add(p),S.add(w))},arcBy:function(){var p=t(this)._point,S=p.add(O.read(arguments)),M=w.pick(w.peek(arguments),!0);"boolean"==typeof M?this.arcTo(S,M):this.arcTo(S,p.add(O.read(arguments)))},closePath:function(p){this.setClosed(!0),p&&this.join()}}},{_getBounds:function(p,w){return Q[p](this._segments,this._closed,this.getStyle(),w)},statics:{isClockwise:function(p){for(var w=0,S=0,M=p.length;M>S;S++)w+=Y.getEdgeSum(Y.getValues(p[S],p[M>S+1?S+1:0]));return w>0},getBounds:function(p,w,S,M,z){function s(p){p._transformCoordinates(M,k,!1);for(var w=0;2>w;w++)Y._addBounds(A[w],A[w+4],k[w+2],k[w],w,z?z[w]:0,O,T,L);var S=A;A=k,k=S}var I=p[0];if(!I)return new B;for(var k=Array(6),A=I._transformCoordinates(M,Array(6),!1),O=A.slice(0,2),T=O.slice(),L=Array(2),N=1,D=p.length;D>N;N++)s(p[N]);return w&&s(I),new B(O[0],O[1],T[0]-O[0],T[1]-O[1])},getStrokeBounds:function(p,w,S,M){function r(p){A=A.include(M?M._transformPoint(p,p):p)}function s(p){A=A.unite(D.setCenter(M?M._transformPoint(p._point):p._point))}function a(p,w){var S=p._handleIn,M=p._handleOut;"round"===w||!S.isZero()&&!M.isZero()&&S.isColinear(M)?s(p):Q._addBevelJoin(p,w,I,N,r)}function o(p,w){"round"===w?s(p):Q._addSquareCap(p,w,I,r)}if(!S.hasStroke())return Q.getBounds(p,w,S,M);for(var z=p.length-(w?0:1),I=S.getStrokeWidth()/2,k=Q._getPenPadding(I,M),A=Q.getBounds(p,w,S,M,k),O=S.getStrokeJoin(),T=S.getStrokeCap(),N=I*S.getMiterLimit(),D=new B(new L(k).multiply(2)),j=1;z>j;j++)a(p[j],O);return w?a(p[0],O):z>0&&(o(p[0],T),o(p[p.length-1],T)),A},_getPenPadding:function(p,w){if(!w)return[p,p];var S=w.shiftless(),M=S.transform(new O(p,0)),z=S.transform(new O(0,p)),I=M.getAngleInRadians(),k=M.getLength(),A=z.getLength(),T=Math.sin(I),L=Math.cos(I),N=Math.tan(I),B=-Math.atan(A*N/k),D=Math.atan(A/(N*k));return[Math.abs(k*Math.cos(B)*L-A*Math.sin(B)*T),Math.abs(A*Math.sin(D)*L+k*Math.cos(D)*T)]},_addBevelJoin:function(p,w,S,M,z,I){var k=p.getCurve(),A=k.getPrevious(),T=k.getPointAt(0,!0),L=A.getNormalAt(1,!0),N=k.getNormalAt(0,!0),B=L.getDirectedAngle(N)<0?-S:S;if(L.setLength(B),N.setLength(B),I&&(z(T),z(T.add(L))),"miter"===w){var D=new E(T.add(L),new O(-L.y,L.x),!0).intersect(new E(T.add(N),new O(-N.y,N.x),!0),!0);if(D&&T.getDistance(D)<=M&&(z(D),!I))return}I||z(T.add(L)),z(T.add(N))},_addSquareCap:function(p,w,S,M,z){var I=p._point,k=p.getLocation(),A=k.getNormal().normalize(S);z&&(M(I.subtract(A)),M(I.add(A))),"square"===w&&(I=I.add(A.rotate(0===k.getParameter()?-90:90))),M(I.add(A)),M(I.subtract(A))},getHandleBounds:function(p,w,S,M,z,I){for(var k=Array(6),A=1/0,O=-A,T=A,L=O,N=0,D=p.length;D>N;N++){p[N]._transformCoordinates(M,k,!1);for(var j=0;6>j;j+=2){var E=0===j?I:z,R=E?E[0]:0,F=E?E[1]:0,q=k[j],V=k[j+1],Z=q-R,H=q+R,W=V-F,G=V+F;A>Z&&(A=Z),H>O&&(O=H),T>W&&(T=W),G>L&&(L=G)}}return new B(A,T,O-A,L-T)},getRoughBounds:function(p,w,S,M){var z=S.hasStroke()?S.getStrokeWidth()/2:0,I=z;return z>0&&("miter"===S.getStrokeJoin()&&(I=z*S.getMiterLimit()),"square"===S.getStrokeCap()&&(I=Math.max(I,z*Math.sqrt(2)))),Q.getHandleBounds(p,w,S,M,Q._getPenPadding(z,M),Q._getPenPadding(I,M))}}});Q.inject({statics:new function(){function t(p,S,M){var z=w.getNamed(M),I=new Q(z&&!1===z.insert&&q.NO_INSERT);return I._add(p),I._closed=S,I.set(z)}function i(p,w,M){for(var z=Array(4),I=0;4>I;I++){var k=S[I];z[I]=new J(k._point.multiply(w).add(p),k._handleIn.multiply(w),k._handleOut.multiply(w))}return t(z,!0,M)}var p=.5522847498307936,S=[new J([-1,0],[0,p],[0,-p]),new J([0,-1],[-p,0],[p,0]),new J([1,0],[0,-p],[0,p]),new J([0,1],[p,0],[-p,0])];return{Line:function(){return t([new J(O.readNamed(arguments,"from")),new J(O.readNamed(arguments,"to"))],!1,arguments)},Circle:function(){var p=O.readNamed(arguments,"center"),S=w.readNamed(arguments,"radius");return i(p,new L(S),arguments)},Rectangle:function(){var w,S=B.readNamed(arguments,"rectangle"),M=L.readNamed(arguments,"radius",0,{readNull:!0}),z=S.getBottomLeft(!0),I=S.getTopLeft(!0),k=S.getTopRight(!0),A=S.getBottomRight(!0);if(!M||M.isZero())w=[new J(z),new J(I),new J(k),new J(A)];else{var O=(M=L.min(M,S.getSize(!0).divide(2))).width,T=M.height,N=O*p,D=T*p;w=[new J(z.add(O,0),null,[-N,0]),new J(z.subtract(0,T),[0,D]),new J(I.add(0,T),null,[0,-D]),new J(I.add(O,0),[-N,0],null),new J(k.subtract(O,0),null,[N,0]),new J(k.add(0,T),[0,-D],null),new J(A.subtract(0,T),null,[0,D]),new J(A.subtract(O,0),[N,0])]}return t(w,!0,arguments)},RoundRectangle:"#Rectangle",Ellipse:function(){var p=H._readEllipse(arguments);return i(p.center,p.radius,arguments)},Oval:"#Ellipse",Arc:function(){var p=O.readNamed(arguments,"from"),S=O.readNamed(arguments,"through"),M=O.readNamed(arguments,"to"),z=w.getNamed(arguments),I=new Q(z&&!1===z.insert&&q.NO_INSERT);return I.moveTo(p),I.arcTo(S,M),I.set(z)},RegularPolygon:function(){for(var p=O.readNamed(arguments,"center"),S=w.readNamed(arguments,"sides"),M=w.readNamed(arguments,"radius"),z=360/S,I=!(S%3),k=new O(0,I?-M:M),A=I?-1:.5,T=Array(S),L=0;S>L;L++)T[L]=new J(p.add(k.rotate((L+A)*z)));return t(T,!0,arguments)},Star:function(){for(var p=O.readNamed(arguments,"center"),S=2*w.readNamed(arguments,"points"),M=w.readNamed(arguments,"radius1"),z=w.readNamed(arguments,"radius2"),I=360/S,k=new O(0,-1),A=Array(S),T=0;S>T;T++)A[T]=new J(p.add(k.rotate(I*T).multiply(T%2?z:M)));return t(A,!0,arguments)}}}});var tt=K.extend({_class:"CompoundPath",_serializeFields:{children:[]},initialize:function(p){this._children=[],this._namedChildren={},this._initialize(p)||("string"==typeof p?this.setPathData(p):this.addChildren(Array.isArray(p)?p:arguments))},insertChildren:function xe(w,S,M){S=xe.base.call(this,w,S,M,Q);for(var z=0,I=!M&&S&&S.length;I>z;z++){var k=S[z];k._clockwise===p&&k.setClockwise(0===k._index)}return S},reverse:function(){for(var p=this._children,w=0,S=p.length;S>w;w++)p[w].reverse()},smooth:function(){for(var p=0,w=this._children.length;w>p;p++)this._children[p].smooth()},reduce:function be(){if(0===this._children.length){var p=new Q(q.NO_INSERT);return p.insertAbove(this),p.setStyle(this._style),this.remove(),p}return be.base.call(this)},isClockwise:function(){var p=this.getFirstChild();return p&&p.isClockwise()},setClockwise:function(p){this.isClockwise()!==!!p&&this.reverse()},getFirstSegment:function(){var p=this.getFirstChild();return p&&p.getFirstSegment()},getLastSegment:function(){var p=this.getLastChild();return p&&p.getLastSegment()},getCurves:function(){for(var p=this._children,w=[],S=0,M=p.length;M>S;S++)w.push.apply(w,p[S].getCurves());return w},getFirstCurve:function(){var p=this.getFirstChild();return p&&p.getFirstCurve()},getLastCurve:function(){var p=this.getLastChild();return p&&p.getFirstCurve()},getArea:function(){for(var p=this._children,w=0,S=0,M=p.length;M>S;S++)w+=p[S].getArea();return w}},{beans:!0,getPathData:function(p,w){for(var S=this._children,M=[],z=0,I=S.length;I>z;z++){var k=S[z],A=k._matrix;M.push(k.getPathData(p&&!A.isIdentity()?p.chain(A):A,w))}return M.join(" ")}},{_getChildHitTestOptions:function(p){return p.class===Q||"path"===p.type?p:new w(p,{fill:!1})},_draw:function(p,w,S){var M=this._children;if(0!==M.length){if(this._currentPath)p.currentPath=this._currentPath;else{w=w.extend({dontStart:!0,dontFinish:!0}),p.beginPath();for(var z=0,I=M.length;I>z;z++)M[z].draw(p,w,S);this._currentPath=p.currentPath}if(!w.clip){this._setStyles(p);var k=this._style;k.hasFill()&&(p.fill(k.getWindingRule()),p.shadowColor="rgba(0,0,0,0)"),k.hasStroke()&&p.stroke()}}},_drawSelected:function(p,w,S){for(var M=this._children,z=0,I=M.length;I>z;z++){var k=M[z],A=k._matrix;S[k._id]||k._drawSelected(p,A.isIdentity()?w:w.chain(A))}}},new function(){function t(p,w){var S=p._children;if(w&&0===S.length)throw Error("Use a moveTo() command first");return S[S.length-1]}var p={moveTo:function(){var p=t(this),w=p&&p.isEmpty()?p:new Q;w!==p&&this.addChild(w),w.moveTo.apply(w,arguments)},moveBy:function(){var p=t(this,!0),w=p&&p.getLastSegment(),S=O.read(arguments);this.moveTo(w?S.add(w._point):S)},closePath:function(p){t(this,!0).closePath(p)}};return w.each(["lineTo","cubicCurveTo","quadraticCurveTo","curveTo","arcTo","lineBy","cubicCurveBy","quadraticCurveBy","curveBy","arcBy"],(function(w){p[w]=function(){var p=t(this,!0);p[w].apply(p,arguments)}})),p});K.inject(new function(){function t(w,S,M){function o(p){return p.clone(!1).reduce().reorient().transform(null,!0,!0)}function h(p){for(var w=0,S=p.length;S>w;w++){var M=p[w];T.push.apply(T,M._segments),L.push.apply(L,M._getMonoCurves())}}var z=p[M],I=o(w),A=S&&w!==S&&o(S);A&&/^(subtract|exclude)$/.test(M)^A.isClockwise()!==I.isClockwise()&&A.reverse(),function e(p){function e(){for(var p=0,S=w.length;S>p;p++)w[p].set(0,0)}for(var w,S,M,z=1e-6,I=1-z,k=p.length-1;k>=0;k--){var A,O,T=p[k],L=T._parameter;M&&M._curve===T._curve&&M._parameter>0?L/=M._parameter:(S=T._curve,w&&e(),w=S.isLinear()?[S._segment1._handleOut,S._segment2._handleIn]:null),(A=S.divide(L,!0,!0))?(O=A._segment1,S=A.getPrevious(),w&&w.push(O._handleOut,O._handleIn)):O=z>L?S._segment1:L>I?S._segment2:S.getPartLength(0,L)<S.getPartLength(L,1)?S._segment1:S._segment2,O._intersection=T.getIntersection(),T._segment=O,M=T}w&&e()}(I.getIntersections(A,null,!0));var O=[],T=[],L=[],N=1e-6;h(I._children||[I]),A&&h(A._children||[A]),T.sort((function(p,w){var S=p._intersection,M=w._intersection;return!S&&!M||S&&M?0:S?-1:1}));for(var B=0,D=T.length;D>B;B++){var j=T[B];if(null==j._winding){O.length=0;var E=j,R=0,F=0;do{var V=j.getCurve().getLength();O.push({segment:j,length:V}),R+=V,j=j.getNext()}while(j&&!j._intersection&&j!==E);for(var Z=0;3>Z;Z++){V=R*(Z+1)/4;for(k=0,m=O.length;m>k;k++){var H=O[k],W=H.length;if(W>=V){(N>=V||N>=W-V)&&(V=W/2);var G=H.segment.getCurve(),U=G.getPointAt(V),J=G.isLinear()&&Math.abs(G.getTangentAt(.5,!0).y)<=N,X=G._path;X._parent instanceof tt&&(X=X._parent),F+="subtract"===M&&A&&(X===I&&A._getWinding(U,J)||X===A&&!I._getWinding(U,J))?0:i(U,L,J);break}V-=W}}var Y=Math.round(F/3);for(Z=O.length-1;Z>=0;Z--)O[Z].segment._winding=Y}}var $=new tt(q.NO_INSERT);return $.insertAbove(w),$.addChildren(n(T,z),!0),($=$.reduce()).setStyle(w._style),$}function i(p,w,S,M){var z=1e-6,I=z,k=1-I,T=p.x,L=p.y,N=0,B=0,D=[],j=Math.abs;if(S){for(var E=-1/0,R=1/0,F=L-z,q=L+z,V=0,Z=w.length;Z>V;V++){var H=w[V].values;if(Y.solveCubic(H,0,T,D,0,1)>0)for(var W=D.length-1;W>=0;W--){var G=Y.evaluate(H,D[W],0).y;F>G&&G>E?E=G:G>q&&R>G&&(R=G)}}R=(R+L)/2,(E=(E+L)/2)>-1/0&&(N=i(new O(T,E),w)),1/0>R&&(B=i(new O(T,R),w))}else{var U=T-z,J=T+z;for(V=0,Z=w.length;Z>V;V++){var X,$,K=w[V],Q=(H=K.values,K.winding);if(Q&&(1===Q&&L>=H[1]&&L<=H[7]||L>=H[7]&&L<=H[1])&&1===Y.solveCubic(H,1,L,D,0,1)){var tt=D[0],et=Y.evaluate(H,tt,0).x,it=Y.evaluate(H,tt,1).y;tt>k&&(V===Z-1||K.next!==w[V+1])&&j(Y.evaluate(K.next.values,0,0).x-et)<=z||V>0&&K.previous===w[V-1]&&j($-et)<z&&X>k&&I>tt||(A.isZero(it)&&!Y.isLinear(H)||I>tt&&it*Y.evaluate(K.previous.values,1,1).y<0||tt>k&&it*Y.evaluate(K.next.values,0,1).y<0?M&&et>=U&&J>=et&&(++N,++B):U>=et?N+=Q:et>=J&&(B+=Q)),X=tt,$=et}}}return Math.max(j(N),j(B))}function n(p,w,S){for(var M,z,I=[],k=1e-6,A=1-k,O=0,T=p.length;T>O;O++)if(!(M=z=p[O])._visited&&w(M._winding)){var L=new Q(q.NO_INSERT),N=M._intersection,B=N&&N._segment,D=!1,j=1;do{var E,R=j>0?M._handleIn:M._handleOut,F=j>0?M._handleOut:M._handleIn;if(D&&(!w(M._winding)||S)&&(N=M._intersection)&&(E=N._segment)&&E!==z){if(S)M._visited=E._visited,M=E,j=1;else{var V=M.getCurve();j>0&&(V=V.getPrevious());var Z=V.getTangentAt(1>j?k:A,!0),H=E.getCurve(),W=H.getPrevious(),G=W.getTangentAt(A,!0),U=H.getTangentAt(k,!0),X=Z.cross(G),Y=Z.cross(U);if(0!=X*Y){var $=Y>X?W:H,K=w($._segment1._winding)?$:Y>X?H:W,tt=K._segment1;j=K===W?-1:1,tt._visited&&M._path!==tt._path||!w(tt._winding)?j=1:(M._visited=E._visited,M=E,tt._visited&&(j=1))}else j=1}F=j>0?M._handleOut:M._handleIn}L.add(new J(M._point,D&&R,F)),D=!0,M._visited=!0,M=j>0?M.getNext():M.getPrevious()}while(M&&!M._visited&&M!==z&&M!==B&&(M._intersection||w(M._winding)));!M||M!==z&&M!==B?L.lastSegment._handleOut.set(0,0):(L.firstSegment.setHandleIn((M===B?B:M)._handleIn),L.setClosed(!0)),L._segments.length>(L._closed?L.isPolygon()?2:0:1)&&I.push(L)}return I}var p={unite:function(p){return 1===p||0===p},intersect:function(p){return 2===p},subtract:function(p){return 1===p},exclude:function(p){return 1===p}};return{_getWinding:function(p,w,S){return i(p,this._getMonoCurves(),w,S)},unite:function(p){return t(this,p,"unite")},intersect:function(p){return t(this,p,"intersect")},subtract:function(p){return t(this,p,"subtract")},exclude:function(p){return t(this,p,"exclude")},divide:function(p){return new V([this.subtract(p),this.intersect(p)])}}}),Q.inject({_getMonoCurves:function(){function t(S){var M=S[1],z=S[7],I={values:S,winding:M===z?0:M>z?-1:1,previous:p,next:null};p&&(p.next=I),w.push(I),p=I}function e(p){if(0!==Y.getLength(p)){var w=p[1],S=p[3],M=p[5],z=p[7];if(Y.isLinear(p))t(p);else{var I=3*(S-M)-w+z,k=2*(w+M)-4*S,O=S-w,T=1e-6,L=[],N=A.solveQuadratic(I,k,O,L,T,1-T);if(0===N)t(p);else{L.sort();var B=L[0],D=Y.subdivide(p,B);t(D[0]),N>1&&(B=(L[1]-B)/(1-B),t((D=Y.subdivide(D[1],B))[0])),t(D[1])}}}}var p,w=this._monoCurves;if(!w){w=this._monoCurves=[];for(var S=this.getCurves(),M=this._segments,z=0,I=S.length;I>z;z++)e(S[z].getValues());if(!this._closed&&M.length>1){var k=M[M.length-1]._point,O=M[0]._point,T=k._x,L=k._y,N=O._x,B=O._y;e([T,L,T,L,N,B,N,B])}if(w.length>0){var D=w[0],j=w[w.length-1];D.previous=j,j.next=D}}return w},getInteriorPoint:function(){var p=this.getBounds().getCenter(!0);if(!this.contains(p)){for(var w=this._getMonoCurves(),S=[],M=p.y,z=[],I=0,k=w.length;k>I;I++){var A=w[I].values;if((1===w[I].winding&&M>=A[1]&&M<=A[7]||M>=A[7]&&M<=A[1])&&Y.solveCubic(A,1,M,S,0,1)>0)for(var O=S.length-1;O>=0;O--)z.push(Y.evaluate(A,S[O],0).x);if(z.length>1)break}p.x=(z[0]+z[1])/2}return p},reorient:function(){return this.setClockwise(!0),this}}),tt.inject({_getMonoCurves:function(){for(var p=this._children,w=[],S=0,M=p.length;M>S;S++)w.push.apply(w,p[S]._getMonoCurves());return w},reorient:function(){var p=this.removeChildren().sort((function(p,w){return w.getBounds().getArea()-p.getBounds().getArea()}));if(p.length>0){this.addChildren(p);for(var w=p[0].isClockwise(),S=1,M=p.length;M>S;S++){for(var z=p[S].getInteriorPoint(),I=0,k=S-1;k>=0;k--)p[k].contains(z)&&I++;p[S].setClockwise(0==I%2&&w)}}return this}});var et=w.extend({_class:"PathIterator",initialize:function(p,w,S,M){function r(p,w){var S=Y.getValues(p,w,M);I.push(S),s(S,p._index,0,1)}function s(p,w,M,z){if(z-M>O&&!Y.isFlatEnough(p,S||.25)){var I=Y.subdivide(p),T=(M+z)/2;s(I[0],w,M,T),s(I[1],w,T,z)}else{var L=p[6]-p[0],N=p[7]-p[1],B=Math.sqrt(L*L+N*N);B>1e-6&&(A+=B,k.push({offset:A,value:z,index:w}))}}for(var z,I=[],k=[],A=0,O=1/(w||32),T=p._segments,L=T[0],N=1,B=T.length;B>N;N++)r(L,z=T[N]),L=z;p._closed&&r(z,T[0]),this.curves=I,this.parts=k,this.length=A,this.index=0},getParameterAt:function(p){for(var w,S=this.index;w=S,!(0==S||this.parts[--S].offset<p););for(var M=this.parts.length;M>w;w++){if((A=this.parts[w]).offset>=p){this.index=w;var z=this.parts[w-1],I=z&&z.index==A.index?z.value:0,k=z?z.offset:0;return{value:I+(A.value-I)*(p-k)/(A.offset-k),index:A.index}}}var A;return{value:1,index:(A=this.parts[this.parts.length-1]).index}},evaluate:function(p,w){var S=this.getParameterAt(p);return Y.evaluate(this.curves[S.index],S.value,w)},drawPart:function(p,w,S){w=this.getParameterAt(w),S=this.getParameterAt(S);for(var M=w.index;M<=S.index;M++){var z=Y.getPart(this.curves[M],M==w.index?w.value:0,M==S.index?S.value:1);M==w.index&&p.moveTo(z[0],z[1]),p.bezierCurveTo.apply(p,z.slice(2))}}},w.each(["getPoint","getTangent","getNormal","getCurvature"],(function(p,w){this[p+"At"]=function(p){return this.evaluate(p,w)}}),{})),it=w.extend({initialize:function(p,w){for(var S,M=this.points=[],z=p._segments,I=0,k=z.length;k>I;I++){var A=z[I].point.clone();S&&S.equals(A)||(M.push(A),S=A)}p._closed&&(this.closed=!0,M.unshift(M[M.length-1]),M.push(M[1])),this.error=w},fit:function(){var p=this.points,w=p.length,S=this.segments=w>0?[new J(p[0])]:[];return w>1&&this.fitCubic(0,w-1,p[1].subtract(p[0]).normalize(),p[w-2].subtract(p[w-1]).normalize()),this.closed&&(S.shift(),S.pop()),S},fitCubic:function(w,S,M,z){if(1==S-w){var I=this.points[w],k=this.points[S],A=I.getDistance(k)/3;return this.addCurve([I,I.add(M.normalize(A)),k.add(z.normalize(A)),k]),p}for(var O,T=this.chordLengthParameterize(w,S),L=Math.max(this.error,this.error*this.error),N=0;4>=N;N++){var B=this.generateBezier(w,S,T,M,z),D=this.findMaxError(w,S,B,T);if(D.error<this.error)return this.addCurve(B),p;if(O=D.index,D.error>=L)break;this.reparameterize(w,S,T,B),L=D.error}var j=this.points[O-1].subtract(this.points[O]),E=this.points[O].subtract(this.points[O+1]),R=j.add(E).divide(2).normalize();this.fitCubic(w,O,M,R),this.fitCubic(O,S,R.negate(),z)},addCurve:function(p){this.segments[this.segments.length-1].setHandleOut(p[1].subtract(p[0])),this.segments.push(new J(p[3],p[2].subtract(p[3])))},generateBezier:function(p,w,S,M,z){for(var I=1e-12,k=this.points[p],A=this.points[w],O=[[0,0],[0,0]],T=[0,0],L=0,N=w-p+1;N>L;L++){var B=S[L],D=1-B,j=3*B*D,E=D*D*D,R=j*D,F=j*B,q=B*B*B,V=M.normalize(R),Z=z.normalize(F),H=this.points[p+L].subtract(k.multiply(E+R)).subtract(A.multiply(F+q));O[0][0]+=V.dot(V),O[0][1]+=V.dot(Z),O[1][0]=O[0][1],O[1][1]+=Z.dot(Z),T[0]+=V.dot(H),T[1]+=Z.dot(H)}var W,G,U=O[0][0]*O[1][1]-O[1][0]*O[0][1];if(Math.abs(U)>I){var J=O[0][0]*T[1]-O[1][0]*T[0];W=(T[0]*O[1][1]-T[1]*O[0][1])/U,G=J/U}else{var X=O[0][0]+O[0][1],Y=O[1][0]+O[1][1];W=G=Math.abs(X)>I?T[0]/X:Math.abs(Y)>I?T[1]/Y:0}var $=A.getDistance(k);return((I*=$)>W||I>G)&&(W=G=$/3),[k,k.add(M.normalize(W)),A.add(z.normalize(G)),A]},reparameterize:function(p,w,S,M){for(var z=p;w>=z;z++)S[z-p]=this.findRoot(M,this.points[z],S[z-p])},findRoot:function(p,w,S){for(var M=[],z=[],I=0;2>=I;I++)M[I]=p[I+1].subtract(p[I]).multiply(3);for(I=0;1>=I;I++)z[I]=M[I+1].subtract(M[I]).multiply(2);var k=this.evaluate(3,p,S),A=this.evaluate(2,M,S),O=this.evaluate(1,z,S),T=k.subtract(w),L=A.dot(A)+T.dot(O);return Math.abs(L)<1e-6?S:S-T.dot(A)/L},evaluate:function(p,w,S){for(var M=w.slice(),z=1;p>=z;z++)for(var I=0;p-z>=I;I++)M[I]=M[I].multiply(1-S).add(M[I+1].multiply(S));return M[0]},chordLengthParameterize:function(p,w){for(var S=[0],M=p+1;w>=M;M++)S[M-p]=S[M-p-1]+this.points[M].getDistance(this.points[M-1]);M=1;for(var z=w-p;z>=M;M++)S[M]/=S[z];return S},findMaxError:function(p,w,S,M){for(var z=Math.floor((w-p+1)/2),I=0,k=p+1;w>k;k++){var A=this.evaluate(3,S,M[k-p]).subtract(this.points[k]),O=A.x*A.x+A.y*A.y;O>=I&&(I=O,z=k)}return{error:I,index:z}}}),nt=q.extend({_class:"TextItem",_boundsSelected:!0,_applyMatrix:!1,_canApplyMatrix:!1,_serializeFields:{content:null},_boundsGetter:"getBounds",initialize:function(S){this._content="",this._lines=[];var M=S&&w.isPlainObject(S)&&S.x===p&&S.y===p;this._initialize(M&&S,!M&&O.read(arguments))},_equals:function(p){return this._content===p._content},_clone:function Ce(p,w){return p.setContent(this._content),Ce.base.call(this,p,w)},getContent:function(){return this._content},setContent:function(p){this._content=""+p,this._lines=this._content.split(/\r\n|\n|\r/gm),this._changed(265)},isEmpty:function(){return!this._content},getCharacterStyle:"#getStyle",setCharacterStyle:"#setStyle",getParagraphStyle:"#getStyle",setParagraphStyle:"#setStyle"}),rt=nt.extend({_class:"PointText",initialize:function(){nt.apply(this,arguments)},clone:function(p){return this._clone(new rt(q.NO_INSERT),p)},getPoint:function(){var p=this._matrix.getTranslation();return new T(p.x,p.y,this,"setPoint")},setPoint:function(){var p=O.read(arguments);this.translate(p.subtract(this._matrix.getTranslation()))},_draw:function(p){if(this._content){this._setStyles(p);var w=this._style,S=this._lines,M=w.getLeading(),z=p.shadowColor;p.font=w.getFontStyle(),p.textAlign=w.getJustification();for(var I=0,k=S.length;k>I;I++){p.shadowColor=z;var A=S[I];w.hasFill()&&(p.fillText(A,0,0),p.shadowColor="rgba(0,0,0,0)"),w.hasStroke()&&p.strokeText(A,0,0),p.translate(0,M)}}},_getBounds:function(p,w){var S=this._style,M=this._lines,z=M.length,I=S.getJustification(),k=S.getLeading(),A=this.getView().getTextWidth(S.getFontStyle(),M),O=0;"left"!==I&&(O-=A/("center"===I?2:1));var T=new B(O,z?-.75*k:0,A,z*k);return w?w._transformBounds(T,T):T}}),st=w.extend(new function(){function t(w){var S,M=w.match(/^#(\w{1,2})(\w{1,2})(\w{1,2})$/);if(M){S=[0,0,0];for(var I=0;3>I;I++){var k=M[I+1];S[I]=parseInt(1==k.length?k+k:k,16)/255}}else if(M=w.match(/^rgba?\((.*)\)$/)){I=0;for(var A=(S=M[1].split(",")).length;A>I;I++){k=+S[I];S[I]=3>I?k/255:k}}else{var O=z[w];if(!O){p||((p=yt.getContext(1,1)).globalCompositeOperation="copy"),p.fillStyle="rgba(0,0,0,0)",p.fillStyle=w,p.fillRect(0,0,1,1);var T=p.getImageData(0,0,1,1).data;O=z[w]=[T[0]/255,T[1]/255,T[2]/255]}S=O.slice()}return S}var p,S={gray:["gray"],rgb:["red","green","blue"],hsb:["hue","saturation","brightness"],hsl:["hue","saturation","lightness"],gradient:["gradient","origin","destination","highlight"]},M={},z={},k=[[0,3,1],[2,0,1],[1,0,3],[1,2,0],[3,1,0],[0,1,2]],A={"rgb-hsb":function(p,w,S){var M=Math.max(p,w,S),z=M-Math.min(p,w,S);return[0===z?0:60*(M==p?(w-S)/z+(S>w?6:0):M==w?(S-p)/z+2:(p-w)/z+4),0===M?0:z/M,M]},"hsb-rgb":function(p,w,S){var M,z=(p=(p/60%6+6)%6)-(M=Math.floor(p)),I=[S,S*(1-w),S*(1-w*z),S*(1-w*(1-z))];return[I[(M=k[M])[0]],I[M[1]],I[M[2]]]},"rgb-hsl":function(p,w,S){var M=Math.max(p,w,S),z=Math.min(p,w,S),I=M-z,k=0===I,A=(M+z)/2;return[k?0:60*(M==p?(w-S)/I+(S>w?6:0):M==w?(S-p)/I+2:(p-w)/I+4),k?0:.5>A?I/(M+z):I/(2-M-z),A]},"hsl-rgb":function(p,w,S){if(0===w)return[S,S,S];for(var M=[(p=(p/360%1+1)%1)+1/3,p,p-1/3],z=.5>S?S*(1+w):S+w-S*w,I=2*S-z,k=[],A=0;3>A;A++){var O=M[A];0>O&&(O+=1),O>1&&(O-=1),k[A]=1>6*O?I+6*(z-I)*O:1>2*O?z:2>3*O?I+6*(z-I)*(2/3-O):I}return k},"rgb-gray":function(p,w,S){return[.2989*p+.587*w+.114*S]},"gray-rgb":function(p){return[p,p,p]},"gray-hsb":function(p){return[0,0,p]},"gray-hsl":function(p){return[0,0,p]},"gradient-rgb":function(){return[]},"rgb-gradient":function(){return[]}};return w.each(S,(function(p,z){M[z]=[],w.each(p,(function(p,I){var k=w.capitalize(p),A=/^(hue|saturation)$/.test(p),T=M[z][I]="gradient"===p?function(p){var w=this._components[0];return w!==(p=at.read(Array.isArray(p)?p:arguments,0,{readNull:!0}))&&(w&&w._removeOwner(this),p&&p._addOwner(this)),p}:"gradient"===z?function(){return O.read(arguments,0,{readNull:"highlight"===p,clone:!0})}:function(p){return null==p||isNaN(p)?0:p};this["get"+k]=function(){return this._type===z||A&&/^hs[bl]$/.test(this._type)?this._components[I]:this._convert(z)[I]},this["set"+k]=function(p){this._type===z||A&&/^hs[bl]$/.test(this._type)||(this._components=this._convert(z),this._properties=S[z],this._type=z),null!=(p=T.call(this,p))&&(this._components[I]=p,this._changed())}}),this)}),{_class:"Color",_readIndex:!0,initialize:function l(p){var w,z,I,k,A=Array.prototype.slice,O=arguments,T=0;Array.isArray(p)&&(p=(O=p)[0]);var L=null!=p&&typeof p;if("string"===L&&p in S&&(w=p,p=O[1],Array.isArray(p)?(z=p,I=O[2]):(this.__read&&(T=1),O=A.call(O,1),L=typeof p)),!z){if(k="number"===L?O:"object"===L&&null!=p.length?p:null){w||(w=k.length>=3?"rgb":"gray");var N=S[w].length;I=k[N],this.__read&&(T+=k===arguments?N+(null!=I?1:0):1),k.length>N&&(k=A.call(k,0,N))}else if("string"===L)w="rgb",4===(z=t(p)).length&&(I=z[3],z.length--);else if("object"===L)if(p.constructor===l){if(w=p._type,z=p._components.slice(),I=p._alpha,"gradient"===w)for(var B=1,D=z.length;D>B;B++){var j=z[B];j&&(z[B]=j.clone())}}else if(p.constructor===at)w="gradient",k=O;else{var E=S[w="hue"in p?"lightness"in p?"hsl":"hsb":"gradient"in p||"stops"in p||"radial"in p?"gradient":"gray"in p?"gray":"rgb"];R=M[w],this._components=z=[];for(B=0,D=E.length;D>B;B++){null==(F=p[E[B]])&&0===B&&"gradient"===w&&"stops"in p&&(F={stops:p.stops,radial:p.radial}),null!=(F=R[B].call(this,F))&&(z[B]=F)}I=p.alpha}this.__read&&w&&(T=1)}if(this._type=w||"rgb","gradient"===w&&(this._id=l._id=(l._id||0)+1),!z){this._components=z=[];var R=M[this._type];for(B=0,D=R.length;D>B;B++){var F;null!=(F=R[B].call(this,k&&k[B]))&&(z[B]=F)}}this._components=z,this._properties=S[this._type],this._alpha=I,this.__read&&(this.__read=T)},_serialize:function(p,S){var M=this.getComponents();return w.serialize(/^(gray|rgb)$/.test(this._type)?M:[this._type].concat(M),p,!0,S)},_changed:function(){this._canvasStyle=null,this._owner&&this._owner._changed(65)},_convert:function(p){var w;return this._type===p?this._components.slice():(w=A[this._type+"-"+p])?w.apply(this,this._components):A["rgb-"+p].apply(this,A[this._type+"-rgb"].apply(this,this._components))},convert:function(p){return new st(p,this._convert(p),this._alpha)},getType:function(){return this._type},setType:function(p){this._components=this._convert(p),this._properties=S[p],this._type=p},getComponents:function(){var p=this._components.slice();return null!=this._alpha&&p.push(this._alpha),p},getAlpha:function(){return null!=this._alpha?this._alpha:1},setAlpha:function(p){this._alpha=null==p?null:Math.min(Math.max(p,0),1),this._changed()},hasAlpha:function(){return null!=this._alpha},equals:function(p){var S=w.isPlainValue(p,!0)?st.read(arguments):p;return S===this||S&&this._class===S._class&&this._type===S._type&&this._alpha===S._alpha&&w.equals(this._components,S._components)||!1},toString:function(){for(var p=this._properties,w=[],S="gradient"===this._type,M=I.instance,z=0,k=p.length;k>z;z++){var A=this._components[z];null!=A&&w.push(p[z]+": "+(S?A:M.number(A)))}return null!=this._alpha&&w.push("alpha: "+M.number(this._alpha)),"{ "+w.join(", ")+" }"},toCSS:function(p){function e(p){return Math.round(255*(0>p?0:p>1?1:p))}var w=this._convert("rgb"),S=p||null==this._alpha?1:this._alpha;return w=[e(w[0]),e(w[1]),e(w[2])],1>S&&w.push(0>S?0:S),p?"#"+((1<<24)+(w[0]<<16)+(w[1]<<8)+w[2]).toString(16).slice(1):(4==w.length?"rgba(":"rgb(")+w.join(",")+")"},toCanvasStyle:function(p){if(this._canvasStyle)return this._canvasStyle;if("gradient"!==this._type)return this._canvasStyle=this.toCSS();var w,S=this._components,M=S[0],z=M._stops,I=S[1],k=S[2];if(M._radial){var A=k.getDistance(I),O=S[3];if(O){var T=O.subtract(I);T.getLength()>A&&(O=I.add(T.normalize(A-.1)))}var L=O||I;w=p.createRadialGradient(L.x,L.y,0,I.x,I.y,A)}else w=p.createLinearGradient(I.x,I.y,k.x,k.y);for(var N=0,B=z.length;B>N;N++){var D=z[N];w.addColorStop(D._rampPoint,D._color.toCanvasStyle())}return this._canvasStyle=w},transform:function(p){if("gradient"===this._type){for(var w=this._components,S=1,M=w.length;M>S;S++){var z=w[S];p._transformPoint(z,z,!0)}this._changed()}},statics:{_types:S,random:function(){var p=Math.random;return new st(p(),p(),p())}}})},new function(){return w.each({add:function(p,w){return p+w},subtract:function(p,w){return p-w},multiply:function(p,w){return p*w},divide:function(p,w){return p/w}},(function(p,w){this[w]=function(w){w=st.read(arguments);for(var S=this._type,M=this._components,z=w._convert(S),I=0,k=M.length;k>I;I++)z[I]=p(M[I],z[I]);return new st(S,z,null!=this._alpha?p(this._alpha,w.getAlpha()):null)}}),{})});w.each(st._types,(function(p,S){var M=this[w.capitalize(S)+"Color"]=function(p){var w=null!=p&&typeof p,M="object"===w&&null!=p.length?p:"string"===w?null:arguments;return M?new st(S,M):new st(p)};if(3==S.length){var z=S.toUpperCase();st[z]=this[z+"Color"]=M}}),w.exports);var at=w.extend({_class:"Gradient",initialize:function Se(p,w){this._id=Se._id=(Se._id||0)+1,p&&this._set(p)&&(p=w=null),this._stops||this.setStops(p||["white","black"]),null==this._radial&&this.setRadial("string"==typeof w&&"radial"===w||w||!1)},_serialize:function(p,S){return S.add(this,(function(){return w.serialize([this._stops,this._radial],p,!0,S)}))},_changed:function(){for(var p=0,w=this._owners&&this._owners.length;w>p;p++)this._owners[p]._changed()},_addOwner:function(p){this._owners||(this._owners=[]),this._owners.push(p)},_removeOwner:function(w){var S=this._owners?this._owners.indexOf(w):-1;-1!=S&&(this._owners.splice(S,1),0===this._owners.length&&(this._owners=p))},clone:function(){for(var p=[],w=0,S=this._stops.length;S>w;w++)p[w]=this._stops[w].clone();return new at(p)},getStops:function(){return this._stops},setStops:function(w){if(this.stops)for(var S=0,M=this._stops.length;M>S;S++)this._stops[S]._owner=p;if(w.length<2)throw Error("Gradient stop list needs to contain at least two stops.");this._stops=ot.readAll(w,0,{clone:!0});for(S=0,M=this._stops.length;M>S;S++){var z=this._stops[S];z._owner=this,z._defaultRamp&&z.setRampPoint(S/(M-1))}this._changed()},getRadial:function(){return this._radial},setRadial:function(p){this._radial=p,this._changed()},equals:function(p){if(p===this)return!0;if(p&&this._class===p._class&&this._stops.length===p._stops.length){for(var w=0,S=this._stops.length;S>w;w++)if(!this._stops[w].equals(p._stops[w]))return!1;return!0}return!1}}),ot=w.extend({_class:"GradientStop",initialize:function(w,S){var M,z;w&&(S===p&&Array.isArray(w)?(M=w[0],z=w[1]):w.color?(M=w.color,z=w.rampPoint):(M=w,z=S),this.setColor(M),this.setRampPoint(z))},clone:function(){return new ot(this._color.clone(),this._rampPoint)},_serialize:function(p,S){return w.serialize([this._color,this._rampPoint],p,!0,S)},_changed:function(){this._owner&&this._owner._changed(65)},getRampPoint:function(){return this._rampPoint},setRampPoint:function(p){this._defaultRamp=null==p,this._rampPoint=p||0,this._changed()},getColor:function(){return this._color},setColor:function(p){this._color=st.read(arguments),this._color===p&&(this._color=p.clone()),this._color._owner=this,this._changed()},equals:function(p){return p===this||p&&this._class===p._class&&this._color.equals(p._color)&&this._rampPoint==p._rampPoint||!1}}),ht=w.extend(new function(){var S={fillColor:p,strokeColor:p,strokeWidth:1,strokeCap:"butt",strokeJoin:"miter",strokeScaling:!0,miterLimit:10,dashOffset:0,dashArray:[],windingRule:"nonzero",shadowColor:p,shadowBlur:0,shadowOffset:new O,selectedColor:p,fontFamily:"sans-serif",fontWeight:"normal",fontSize:12,font:"sans-serif",leading:null,justification:"left"},M={strokeWidth:97,strokeCap:97,strokeJoin:97,strokeScaling:105,miterLimit:97,fontFamily:9,fontWeight:9,fontSize:9,font:9,leading:9,justification:9},z={beans:!0},I={_defaults:S,_textDefaults:new w(S,{fillColor:new st}),beans:!0};return w.each(S,(function(S,k){var A=/Color$/.test(k),T="shadowOffset"===k,L=w.capitalize(k),N=M[k],B="set"+L,D="get"+L;I[B]=function(w){var S=this._owner,M=S&&S._children;if(M&&M.length>0&&!(S instanceof tt))for(var z=0,I=M.length;I>z;z++)M[z]._style[B](w);else{var O=this._values[k];O!==w&&(A&&(O&&(O._owner=p),w&&w.constructor===st&&(w._owner&&(w=w.clone()),w._owner=S)),this._values[k]=w,S&&S._changed(N||65))}},I[D]=function(S){var M=this._owner,z=M&&M._children;if(!z||0===z.length||S||M instanceof tt){var I;if((I=this._values[k])===p)(I=this._defaults[k])&&I.clone&&(I=I.clone());else{var L=A?st:T?O:null;!L||I&&I.constructor===L||(this._values[k]=I=L.read([I],0,{readNull:!0,clone:!0}),I&&A&&(I._owner=M))}return I}for(var N=0,B=z.length;B>N;N++){var j=z[N]._style[D]();if(0===N)I=j;else if(!w.equals(I,j))return p}return I},z[D]=function(p){return this._style[D](p)},z[B]=function(p){this._style[B](p)}})),q.inject(z),I},{_class:"Style",initialize:function(p,w,S){this._values={},this._owner=w,this._project=w&&w._project||S||paper.project,w instanceof nt&&(this._defaults=this._textDefaults),p&&this.set(p)},set:function(p){var w=p instanceof ht,S=w?p._values:p;if(S)for(var M in S)if(M in this._defaults){var z=S[M];this[M]=z&&w&&z.clone?z.clone():z}},equals:function(p){return p===this||p&&this._class===p._class&&w.equals(this._values,p._values)||!1},hasFill:function(){return!!this.getFillColor()},hasStroke:function(){return!!this.getStrokeColor()&&this.getStrokeWidth()>0},hasShadow:function(){return!!this.getShadowColor()&&this.getShadowBlur()>0},getView:function(){return this._project.getView()},getFontStyle:function(){var p=this.getFontSize();return this.getFontWeight()+" "+p+(/[a-z]/i.test(p+"")?" ":"px ")+this.getFontFamily()},getFont:"#getFontFamily",setFont:"#setFontFamily",getLeading:function Pe(){var p=Pe.base.call(this),w=this.getFontSize();return/pt|em|%|px/.test(w)&&(w=this.getView().getPixelSize(w)),null!=p?p:1.2*w}}),ut=new function(){function t(p,w,S,M){for(var z=["","webkit","moz","Moz","ms","o"],I=w[0].toUpperCase()+w.substring(1),k=0;6>k;k++){var A=z[k],O=A?A+I:w;if(O in p){if(!S)return p[O];p[O]=M;break}}}return{getStyles:function(p){var w=p&&9!==p.nodeType?p.ownerDocument:p,S=w&&w.defaultView;return S&&S.getComputedStyle(p,"")},getBounds:function(p,w){var S,M=p.ownerDocument,z=M.body,I=M.documentElement;try{S=p.getBoundingClientRect()}catch(p){S={left:0,top:0,width:0,height:0}}var k=S.left-(I.clientLeft||z.clientLeft||0),A=S.top-(I.clientTop||z.clientTop||0);if(!w){var O=M.defaultView;k+=O.pageXOffset||I.scrollLeft||z.scrollLeft,A+=O.pageYOffset||I.scrollTop||z.scrollTop}return new B(k,A,S.width,S.height)},getViewportBounds:function(p){var w=p.ownerDocument,S=w.defaultView,M=w.documentElement;return new B(0,0,S.innerWidth||M.clientWidth,S.innerHeight||M.clientHeight)},getOffset:function(p,w){return ut.getBounds(p,w).getPoint()},getSize:function(p){return ut.getBounds(p,!0).getSize()},isInvisible:function(p){return ut.getSize(p).equals(new L(0,0))},isInView:function(p){return!ut.isInvisible(p)&&ut.getViewportBounds(p).intersects(ut.getBounds(p,!0))},getPrefixed:function(p,w){return t(p,w)},setPrefixed:function(p,w,S){if("object"==typeof w)for(var M in w)t(p,M,!0,w[M]);else t(p,w,!0,S)}}},lt={add:function(p,w){for(var S in w)for(var M=w[S],z=S.split(/[\s,]+/g),I=0,k=z.length;k>I;I++)p.addEventListener(z[I],M,!1)},remove:function(p,w){for(var S in w)for(var M=w[S],z=S.split(/[\s,]+/g),I=0,k=z.length;k>I;I++)p.removeEventListener(z[I],M,!1)},getPoint:function(p){var w=p.targetTouches?p.targetTouches.length?p.targetTouches[0]:p.changedTouches[0]:p;return new O(w.pageX||w.clientX+document.documentElement.scrollLeft,w.pageY||w.clientY+document.documentElement.scrollTop)},getTarget:function(p){return p.target||p.srcElement},getRelatedTarget:function(p){return p.relatedTarget||p.toElement},getOffset:function(p,w){return lt.getPoint(p).subtract(ut.getOffset(w||lt.getTarget(p)))},stop:function(p){p.stopPropagation(),p.preventDefault()}};lt.requestAnimationFrame=new function(){function t(){for(var p=z.length-1;p>=0;p--){var k=z[p],A=k[0],O=k[1];(!O||("true"==M.getAttribute(O,"keepalive")||I)&&ut.isInView(O))&&(z.splice(p,1),A())}w&&(z.length?w(t):S=!1)}var p,w=ut.getPrefixed(window,"requestAnimationFrame"),S=!1,z=[],I=!0;return lt.add(window,{focus:function(){I=!0},blur:function(){I=!1}}),function(M,I){z.push([M,I]),w?S||(w(t),S=!0):p||(p=setInterval(t,1e3/60))}};var ct=w.extend(S,{_class:"View",initialize:function Me(p,w){function i(p){return w[p]||parseInt(w.getAttribute(p),10)}function n(){var p=ut.getSize(w);return p.isNaN()||p.isZero()?new L(i("width"),i("height")):p}var S;this._project=p,this._scope=p._scope,this._element=w,this._pixelRatio||(this._pixelRatio=window.devicePixelRatio||1),this._id=w.getAttribute("id"),null==this._id&&w.setAttribute("id",this._id="view-"+Me._id++),lt.add(w,this._viewEvents);var z="none";if(ut.setPrefixed(w.style,{userSelect:z,touchAction:z,touchCallout:z,contentZooming:z,userDrag:z,tapHighlightColor:"rgba(0,0,0,0)"}),M.hasAttribute(w,"resize")){var I=this;lt.add(window,this._windowEvents={resize:function(){I.setViewSize(n())}})}if(this._setViewSize(S=n()),M.hasAttribute(w,"stats")&&"undefined"!=typeof Stats){this._stats=new Stats;var k=this._stats.domElement,A=k.style,O=ut.getOffset(w);A.position="absolute",A.left=O.x+"px",A.top=O.y+"px",document.body.appendChild(k)}Me._views.push(this),Me._viewsById[this._id]=this,this._viewSize=S,(this._matrix=new j)._owner=this,this._zoom=1,Me._focused||(Me._focused=this),this._frameItems={},this._frameItemCount=0},remove:function(){return!!this._project&&(ct._focused===this&&(ct._focused=null),ct._views.splice(ct._views.indexOf(this),1),delete ct._viewsById[this._id],this._project._view===this&&(this._project._view=null),lt.remove(this._element,this._viewEvents),lt.remove(window,this._windowEvents),this._element=this._project=null,this.off("frame"),this._animate=!1,this._frameItems={},!0)},_events:{onFrame:{install:function(){this.play()},uninstall:function(){this.pause()}},onResize:{}},_animate:!1,_time:0,_count:0,_requestFrame:function(){var p=this;lt.requestAnimationFrame((function(){p._requested=!1,p._animate&&(p._requestFrame(),p._handleFrame())}),this._element),this._requested=!0},_handleFrame:function(){paper=this._scope;var p=Date.now()/1e3,S=this._before?p-this._before:0;this._before=p,this._handlingFrame=!0,this.emit("frame",new w({delta:S,time:this._time+=S,count:this._count++})),this._stats&&this._stats.update(),this._handlingFrame=!1,this.update()},_animateItem:function(p,w){var S=this._frameItems;w?(S[p._id]={item:p,time:0,count:0},1==++this._frameItemCount&&this.on("frame",this._handleFrameItems)):(delete S[p._id],0==--this._frameItemCount&&this.off("frame",this._handleFrameItems))},_handleFrameItems:function(p){for(var S in this._frameItems){var M=this._frameItems[S];M.item.emit("frame",new w(p,{time:M.time+=p.delta,count:M.count++}))}},_update:function(){this._project._needsUpdate=!0,this._handlingFrame||(this._animate?this._handleFrame():this.update())},_changed:function(p){1&p&&(this._project._needsUpdate=!0)},_transform:function(p){this._matrix.concatenate(p),this._bounds=null,this._update()},getElement:function(){return this._element},getPixelRatio:function(){return this._pixelRatio},getResolution:function(){return 72*this._pixelRatio},getViewSize:function(){var p=this._viewSize;return new N(p.width,p.height,this,"setViewSize")},setViewSize:function(){var p=L.read(arguments),w=p.subtract(this._viewSize);w.isZero()||(this._viewSize.set(p.width,p.height),this._setViewSize(p),this._bounds=null,this.emit("resize",{size:p,delta:w}),this._update())},_setViewSize:function(p){var w=this._element;w.width=p.width,w.height=p.height},getBounds:function(){return this._bounds||(this._bounds=this._matrix.inverted()._transformBounds(new B(new O,this._viewSize))),this._bounds},getSize:function(){return this.getBounds().getSize()},getCenter:function(){return this.getBounds().getCenter()},setCenter:function(){var p=O.read(arguments);this.scrollBy(p.subtract(this.getCenter()))},getZoom:function(){return this._zoom},setZoom:function(p){this._transform((new j).scale(p/this._zoom,this.getCenter())),this._zoom=p},isVisible:function(){return ut.isInView(this._element)},scrollBy:function(){this._transform((new j).translate(O.read(arguments).negate()))},play:function(){this._animate=!0,this._requested||this._requestFrame()},pause:function(){this._animate=!1},draw:function(){this.update()},projectToView:function(){return this._matrix._transformPoint(O.read(arguments))},viewToProject:function(){return this._matrix._inverseTransform(O.read(arguments))}},{statics:{_views:[],_viewsById:{},_id:0,create:function(p,w){return"string"==typeof w&&(w=document.getElementById(w)),new dt(p,w)}}},new function(){function t(p){var w=lt.getTarget(p);return w.getAttribute&&ct._viewsById[w.getAttribute("id")]}function e(p,w){return p.viewToProject(lt.getOffset(w,p._element))}function i(){if(!ct._focused||!ct._focused.isVisible())for(var p=0,w=ct._views.length;w>p;p++){var M=ct._views[p];if(M&&M.isVisible()){ct._focused=S=M;break}}}function n(p,w,S){p._handleEvent("mousemove",w,S);var M=p._scope.tool;return M&&M._handleEvent(k&&M.responds("mousedrag")?"mousedrag":"mousemove",w,S),p.update(),M}var p,w,S,M,z,I,k=!1,A=window.navigator;A.pointerEnabled||A.msPointerEnabled?(M="pointerdown MSPointerDown",z="pointermove MSPointerMove",I="pointerup pointercancel MSPointerUp MSPointerCancel"):(M="touchstart",z="touchmove",I="touchend touchcancel","ontouchstart"in window&&A.userAgent.match(/mobile|tablet|ip(ad|hone|od)|android|silk/i)||(M+=" mousedown",z+=" mousemove",I+=" mouseup"));var O={"selectstart dragstart":function(p){k&&p.preventDefault()}},T={mouseout:function(p){var w=ct._focused,S=lt.getRelatedTarget(p);!w||S&&"HTML"!==S.nodeName||n(w,e(w,p),p)},scroll:i};return O[M]=function(w){var S=ct._focused=t(w),M=e(S,w);k=!0,S._handleEvent("mousedown",M,w),(p=S._scope.tool)&&p._handleEvent("mousedown",M,w),S.update()},T[z]=function(M){var z=ct._focused;if(!k){var I=t(M);I?(z!==I&&n(z,e(z,M),M),w=z,z=ct._focused=S=I):S&&S===z&&(z=ct._focused=w,i())}if(z){var A=e(z,M);(k||z.getBounds().contains(A))&&(p=n(z,A,M))}},T[I]=function(w){var S=ct._focused;if(S&&k){var M=e(S,w);k=!1,S._handleEvent("mouseup",M,w),p&&p._handleEvent("mouseup",M,w),S.update()}},lt.add(document,T),lt.add(window,{load:i}),{_viewEvents:O,_handleEvent:function(){},statics:{updateFocus:i}}}),dt=ct.extend({_class:"CanvasView",initialize:function(p,w){if(!(w instanceof HTMLCanvasElement)){var S=L.read(arguments,1);if(S.isZero())throw Error("Cannot create CanvasView with the provided argument: "+[].slice.call(arguments,1));w=yt.getCanvas(S)}if(this._context=w.getContext("2d"),this._eventCounters={},this._pixelRatio=1,!/^off|false$/.test(M.getAttribute(w,"hidpi"))){var z=window.devicePixelRatio||1,I=ut.getPrefixed(this._context,"backingStorePixelRatio")||1;this._pixelRatio=z/I}ct.call(this,p,w)},_setViewSize:function(p){var w=this._element,S=this._pixelRatio,z=p.width,I=p.height;if(w.width=z*S,w.height=I*S,1!==S){if(!M.hasAttribute(w,"resize")){var k=w.style;k.width=z+"px",k.height=I+"px"}this._context.scale(S,S)}},getPixelSize:function(p){var w=this._context,S=w.font;return w.font=p+" serif",p=parseFloat(w.font),w.font=S,p},getTextWidth:function(p,w){var S=this._context,M=S.font,z=0;S.font=p;for(var I=0,k=w.length;k>I;I++)z=Math.max(z,S.measureText(w[I]).width);return S.font=M,z},update:function(){var p=this._project;if(!p||!p._needsUpdate)return!1;var w=this._context,S=this._viewSize;return w.clearRect(0,0,S.width+1,S.height+1),p.draw(w,this._matrix,this._pixelRatio),p._needsUpdate=!1,!0}},new function(){function e(w,S,M,z,I,k){function o(w){return w.responds(S)&&(A||(A=new vt(S,M,z,I,k?z.subtract(k):null)),w.emit(S,A)&&A.isStopped)?(M.preventDefault(),!0):p}for(var A,O=I;O;){if(o(O))return!0;O=O.getParent()}return!!o(w)}var w,S,M,z,I,k,A,O,T;return{_handleEvent:function(p,L,N){if(this._eventCounters[p]){var B=this._project.hitTest(L,{tolerance:0,fill:!0,stroke:!0}),D=B&&B.item,j=!1;switch(p){case"mousedown":for(j=e(this,p,N,L,D),O=I==D&&Date.now()-T<300,z=I=D,w=S=M=L,A=!j&&D;A&&!A.responds("mousedrag");)A=A._parent;break;case"mouseup":j=e(this,p,N,L,D,w),A&&(S&&!S.equals(L)&&e(this,"mousedrag",N,L,A,S),D!==A&&e(this,"mousemove",N,L,D,M=L)),!j&&D&&D===z&&(T=Date.now(),e(this,O&&z.responds("doubleclick")?"doubleclick":"click",N,w,D),O=!1),z=A=null;break;case"mousemove":A&&(j=e(this,"mousedrag",N,L,A,S)),j||(D!==k&&(M=L),j=e(this,p,N,L,D,M)),S=M=L,D!==k&&(e(this,"mouseleave",N,L,k),k=D,e(this,"mouseenter",N,L,D))}return j}}}}),_t=w.extend({_class:"Event",initialize:function(p){this.event=p},isPrevented:!1,isStopped:!1,preventDefault:function(){this.isPrevented=!0,this.event.preventDefault()},stopPropagation:function(){this.isStopped=!0,this.event.stopPropagation()},stop:function(){this.stopPropagation(),this.preventDefault()},getModifiers:function(){return gt.modifiers}}),ft=_t.extend({_class:"KeyEvent",initialize:function(p,w,S,M){_t.call(this,M),this.type=p?"keydown":"keyup",this.key=w,this.character=S},toString:function(){return"{ type: '"+this.type+"', key: '"+this.key+"', character: '"+this.character+"', modifiers: "+this.getModifiers()+" }"}}),gt=new function(){function t(p,M,A,O){var T,L=A?String.fromCharCode(A):"",N=S[M],B=N||L.toLowerCase(),D=p?"keydown":"keyup",j=ct._focused,E=j&&j.isVisible()&&j._scope,R=E&&E.tool;k[B]=p,N&&(T=w.camelize(N))in z&&(z[T]=p),p?I[M]=A:delete I[M],R&&R.responds(D)&&(paper=E,R.emit(D,new ft(p,B,L,O)),j&&j.update())}var p,S={8:"backspace",9:"tab",13:"enter",16:"shift",17:"control",18:"option",19:"pause",20:"caps-lock",27:"escape",32:"space",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",46:"delete",91:"command",93:"command",224:"command"},M={9:!0,13:!0,32:!0},z=new w({shift:!1,control:!1,option:!1,command:!1,capsLock:!1,space:!1}),I={},k={};return lt.add(document,{keydown:function(w){var I=w.which||w.keyCode;I in S||z.command?t(!0,I,I in M||z.command?I:0,w):p=I},keypress:function(w){null!=p&&(t(!0,p,w.which||w.keyCode,w),p=null)},keyup:function(p){var w=p.which||p.keyCode;w in I&&t(!1,w,I[w],p)}}),lt.add(window,{blur:function(p){for(var w in I)t(!1,w,I[w],p)}}),{modifiers:z,isDown:function(p){return!!k[p]}}},vt=_t.extend({_class:"MouseEvent",initialize:function(p,w,S,M,z){_t.call(this,w),this.type=p,this.point=S,this.target=M,this.delta=z},toString:function(){return"{ type: '"+this.type+"', point: "+this.point+", target: "+this.target+(this.delta?", delta: "+this.delta:"")+", modifiers: "+this.getModifiers()+" }"}}),pt=_t.extend({_class:"ToolEvent",_item:null,initialize:function(p,w,S){this.tool=p,this.type=w,this.event=S},_choosePoint:function(p,w){return p||(w?w.clone():null)},getPoint:function(){return this._choosePoint(this._point,this.tool._point)},setPoint:function(p){this._point=p},getLastPoint:function(){return this._choosePoint(this._lastPoint,this.tool._lastPoint)},setLastPoint:function(p){this._lastPoint=p},getDownPoint:function(){return this._choosePoint(this._downPoint,this.tool._downPoint)},setDownPoint:function(p){this._downPoint=p},getMiddlePoint:function(){return!this._middlePoint&&this.tool._lastPoint?this.tool._point.add(this.tool._lastPoint).divide(2):this._middlePoint},setMiddlePoint:function(p){this._middlePoint=p},getDelta:function(){return!this._delta&&this.tool._lastPoint?this.tool._point.subtract(this.tool._lastPoint):this._delta},setDelta:function(p){this._delta=p},getCount:function(){return/^mouse(down|up)$/.test(this.type)?this.tool._downCount:this.tool._count},setCount:function(p){this.tool[/^mouse(down|up)$/.test(this.type)?"downCount":"count"]=p},getItem:function(){if(!this._item){var p=this.tool._scope.project.hitTest(this.getPoint());if(p){for(var w=p.item,S=w._parent;/^(Group|CompoundPath)$/.test(S._class);)w=S,S=S._parent;this._item=w}}return this._item},setItem:function(p){this._item=p},toString:function(){return"{ type: "+this.type+", point: "+this.getPoint()+", count: "+this.getCount()+", modifiers: "+this.getModifiers()+" }"}});z.extend({_class:"Tool",_list:"tools",_reference:"tool",_events:["onActivate","onDeactivate","onEditOptions","onMouseDown","onMouseUp","onMouseDrag","onMouseMove","onKeyDown","onKeyUp"],initialize:function(p){z.call(this),this._firstMove=!0,this._count=0,this._downCount=0,this._set(p)},getMinDistance:function(){return this._minDistance},setMinDistance:function(p){this._minDistance=p,null!=this._minDistance&&null!=this._maxDistance&&this._minDistance>this._maxDistance&&(this._maxDistance=this._minDistance)},getMaxDistance:function(){return this._maxDistance},setMaxDistance:function(p){this._maxDistance=p,null!=this._minDistance&&null!=this._maxDistance&&this._maxDistance<this._minDistance&&(this._minDistance=p)},getFixedDistance:function(){return this._minDistance==this._maxDistance?this._minDistance:null},setFixedDistance:function(p){this._minDistance=p,this._maxDistance=p},_updateEvent:function(p,w,S,M,z,I,k){if(!z){if(null!=S||null!=M){var A=null!=S?S:0,O=w.subtract(this._point),T=O.getLength();if(A>T)return!1;var L=null!=M?M:0;if(0!=L)if(T>L)w=this._point.add(O.normalize(L));else if(k)return!1}if(I&&w.equals(this._point))return!1}switch(this._lastPoint=z&&"mousemove"==p?w:this._point,this._point=w,p){case"mousedown":this._lastPoint=this._downPoint,this._downPoint=this._point,this._downCount++;break;case"mouseup":this._lastPoint=this._downPoint}return this._count=z?0:this._count+1,!0},_fireEvent:function(p,w){var S=paper.project._removeSets;if(S){"mouseup"===p&&(S.mousedrag=null);var M=S[p];if(M){for(var z in M){var I=M[z];for(var k in S){var A=S[k];A&&A!=M&&delete A[I._id]}I.remove()}S[p]=null}}return this.responds(p)&&this.emit(p,new pt(this,p,w))},_handleEvent:function(p,w,S){paper=this._scope;var M=!1;switch(p){case"mousedown":this._updateEvent(p,w,null,null,!0,!1,!1),M=this._fireEvent(p,S);break;case"mousedrag":for(var z=!1,I=!1;this._updateEvent(p,w,this.minDistance,this.maxDistance,!1,z,I);)M=this._fireEvent(p,S)||M,z=!0,I=!0;break;case"mouseup":!w.equals(this._point)&&this._updateEvent("mousedrag",w,this.minDistance,this.maxDistance,!1,!1,!1)&&(M=this._fireEvent("mousedrag",S)),this._updateEvent(p,w,null,this.maxDistance,!1,!1,!1),M=this._fireEvent(p,S)||M,this._updateEvent(p,w,null,null,!0,!1,!1),this._firstMove=!0;break;case"mousemove":for(;this._updateEvent(p,w,this.minDistance,this.maxDistance,this._firstMove,!0,!1);)M=this._fireEvent(p,S)||M,this._firstMove=!1}return M&&S.preventDefault(),M}});var mt={request:function(p,w,S){var M=new(window.ActiveXObject||XMLHttpRequest)("Microsoft.XMLHTTP");return M.open(p.toUpperCase(),w,!0),"overrideMimeType"in M&&M.overrideMimeType("text/plain"),M.onreadystatechange=function(){if(4===M.readyState){var p=M.status;if(0!==p&&200!==p)throw Error("Could not load "+w+" (Error "+p+")");S.call(M,M.responseText)}},M.send(null)}},yt={canvases:[],getCanvas:function(p,w){var S;"object"==typeof p&&(w=p.height,p=p.width);var M=(S=this.canvases.length?this.canvases.pop():document.createElement("canvas")).getContext("2d");return S.width===p&&S.height===w?M.clearRect(0,0,p+1,w+1):(S.width=p,S.height=w),M.save(),S},getContext:function(p,w){return this.getCanvas(p,w).getContext("2d")},release:function(p){var w=p.canvas?p.canvas:p;w.getContext("2d").restore(),this.canvases.push(w)}},wt=new function(){function t(p,w,S){return.2989*p+.587*w+.114*S}function i(p,w,S,M){var z=M-t(p,w,S),I=(M=t(T=p+z,L=w+z,N=S+z),B(T,L,N)),k=D(T,L,N);if(0>I){var A=M-I;T=M+(T-M)*M/A,L=M+(L-M)*M/A,N=M+(N-M)*M/A}if(k>255){var O=255-M,j=k-M;T=M+(T-M)*O/j,L=M+(L-M)*O/j,N=M+(N-M)*O/j}}function n(p,w,S){return D(p,w,S)-B(p,w,S)}function r(p,w,S,M){var z,I=[p,w,S],k=D(p,w,S),A=B(p,w,S);z=0===B(A=A===p?0:A===w?1:2,k=k===p?0:k===w?1:2)?1===D(A,k)?2:1:0,I[k]>I[A]?(I[z]=(I[z]-I[A])*M/(I[k]-I[A]),I[k]=M):I[z]=I[k]=0,I[A]=0,T=I[0],L=I[1],N=I[2]}var p,S,M,z,I,k,A,O,T,L,N,B=Math.min,D=Math.max,j=Math.abs,E={multiply:function(){T=I*p/255,L=k*S/255,N=A*M/255},screen:function(){T=I+p-I*p/255,L=k+S-k*S/255,N=A+M-A*M/255},overlay:function(){T=128>I?2*I*p/255:255-2*(255-I)*(255-p)/255,L=128>k?2*k*S/255:255-2*(255-k)*(255-S)/255,N=128>A?2*A*M/255:255-2*(255-A)*(255-M)/255},"soft-light":function(){var w=p*I/255;T=w+I*(255-(255-I)*(255-p)/255-w)/255,L=(w=S*k/255)+k*(255-(255-k)*(255-S)/255-w)/255,N=(w=M*A/255)+A*(255-(255-A)*(255-M)/255-w)/255},"hard-light":function(){T=128>p?2*p*I/255:255-2*(255-p)*(255-I)/255,L=128>S?2*S*k/255:255-2*(255-S)*(255-k)/255,N=128>M?2*M*A/255:255-2*(255-M)*(255-A)/255},"color-dodge":function(){T=0===I?0:255===p?255:B(255,255*I/(255-p)),L=0===k?0:255===S?255:B(255,255*k/(255-S)),N=0===A?0:255===M?255:B(255,255*A/(255-M))},"color-burn":function(){T=255===I?255:0===p?0:D(0,255-255*(255-I)/p),L=255===k?255:0===S?0:D(0,255-255*(255-k)/S),N=255===A?255:0===M?0:D(0,255-255*(255-A)/M)},darken:function(){T=p>I?I:p,L=S>k?k:S,N=M>A?A:M},lighten:function(){T=I>p?I:p,L=k>S?k:S,N=A>M?A:M},difference:function(){0>(T=I-p)&&(T=-T),0>(L=k-S)&&(L=-L),0>(N=A-M)&&(N=-N)},exclusion:function(){T=I+p*(255-I-I)/255,L=k+S*(255-k-k)/255,N=A+M*(255-A-A)/255},hue:function(){r(p,S,M,n(I,k,A)),i(T,L,N,t(I,k,A))},saturation:function(){r(I,k,A,n(p,S,M)),i(T,L,N,t(I,k,A))},luminosity:function(){i(I,k,A,t(p,S,M))},color:function(){i(p,S,M,t(I,k,A))},add:function(){T=B(I+p,255),L=B(k+S,255),N=B(A+M,255)},subtract:function(){T=D(I-p,0),L=D(k-S,0),N=D(A-M,0)},average:function(){T=(I+p)/2,L=(k+S)/2,N=(A+M)/2},negation:function(){T=255-j(255-p-I),L=255-j(255-S-k),N=255-j(255-M-A)}},R=this.nativeModes=w.each(["source-over","source-in","source-out","source-atop","destination-over","destination-in","destination-out","destination-atop","lighter","darker","copy","xor"],(function(p){this[p]=!0}),{}),F=yt.getContext(1,1);w.each(E,(function(p,w){var S="darken"===w,M=!1;F.save();try{F.fillStyle=S?"#300":"#a00",F.fillRect(0,0,1,1),F.globalCompositeOperation=w,F.globalCompositeOperation===w&&(F.fillStyle=S?"#a00":"#300",F.fillRect(0,0,1,1),M=F.getImageData(0,0,1,1).data[0]!==S?170:51)}catch(p){}F.restore(),R[w]=M})),yt.release(F),this.process=function(w,B,D,j,F){var q=B.canvas,V="normal"===w;if(V||R[w])D.save(),D.setTransform(1,0,0,1,0,0),D.globalAlpha=j,V||(D.globalCompositeOperation=w),D.drawImage(q,F.x,F.y),D.restore();else{var Z=E[w];if(!Z)return;for(var H=D.getImageData(F.x,F.y,q.width,q.height),W=H.data,G=B.getImageData(0,0,q.width,q.height).data,U=0,J=W.length;J>U;U+=4){p=G[U],I=W[U],S=G[U+1],k=W[U+1],M=G[U+2],A=W[U+2],z=G[U+3],O=W[U+3],Z();var X=z*j/255,Y=1-X;W[U]=X*T+Y*I,W[U+1]=X*L+Y*k,W[U+2]=X*N+Y*A,W[U+3]=z*j+Y*O}D.putImageData(H,F.x,F.y)}}},xt=w.each({fillColor:["fill","color"],strokeColor:["stroke","color"],strokeWidth:["stroke-width","number"],strokeCap:["stroke-linecap","string"],strokeJoin:["stroke-linejoin","string"],strokeScaling:["vector-effect","lookup",{true:"none",false:"non-scaling-stroke"},function(p,w){return!w&&(p instanceof K||p instanceof H||p instanceof nt)}],miterLimit:["stroke-miterlimit","number"],dashArray:["stroke-dasharray","array"],dashOffset:["stroke-dashoffset","number"],fontFamily:["font-family","string"],fontWeight:["font-weight","string"],fontSize:["font-size","number"],justification:["text-anchor","lookup",{left:"start",center:"middle",right:"end"}],opacity:["opacity","number"],blendMode:["mix-blend-mode","string"]},(function(p,S){var M=w.capitalize(S),z=p[2];this[S]={type:p[1],property:S,attribute:p[0],toSVG:z,fromSVG:z&&w.each(z,(function(p,w){this[p]=w}),{}),exportFilter:p[3],get:"get"+M,set:"set"+M}}),{}),bt={href:"http://www.w3.org/1999/xlink",xlink:"http://www.w3.org/2000/xmlns"};return new function(){function t(w,S){for(var M in S){var z=S[M],I=bt[M];"number"==typeof z&&(z=p.number(z)),I?w.setAttributeNS(I,M,z):w.setAttribute(M,z)}return w}function n(p,w){return t(document.createElementNS("http://www.w3.org/2000/svg",p),w)}function r(S,M,z){var I=new w,k=S.getTranslation();if(M){var O=(S=S.shiftless())._inverseTransform(k);I[z?"cx":"x"]=O.x,I[z?"cy":"y"]=O.y,k=null}if(!S.isIdentity()){var T=S.decompose();if(T&&!T.shearing){var L=[],N=T.rotation,B=T.scaling;k&&!k.isZero()&&L.push("translate("+p.point(k)+")"),A.isZero(B.x-1)&&A.isZero(B.y-1)||L.push("scale("+p.point(B)+")"),N&&L.push("rotate("+p.number(N)+")"),I.transform=L.join(" ")}else I.transform="matrix("+S.getValues().join(",")+")"}return I}function s(p,w){for(var S=r(p._matrix),M=p._children,z=n("g",S),I=0,k=M.length;k>I;I++){var A=M[I],O=b(A,w);if(O)if(A.isClipMask()){var T=n("clipPath");T.appendChild(O),y(A,T,"clip"),t(z,{"clip-path":"url(#"+T.id+")"})}else z.appendChild(O)}return z}function c(p){var w=p._type,S=p._radius,M=r(p._matrix,!0,"rectangle"!==w);if("rectangle"===w){w="rect";var z=p._size,I=z.width,k=z.height;M.x-=I/2,M.y-=k/2,M.width=I,M.height=k,S.isZero()&&(S=null)}return S&&("circle"===w?M.r=S:(M.rx=S.width,M.ry=S.height)),n(w,M)}function f(p){var w=m(p,"color");if(!w){var S,M=p.getGradient(),z=M._radial,I=p.getOrigin().transform(),k=p.getDestination().transform();if(z){S={cx:I.x,cy:I.y,r:I.getDistance(k)};var A=p.getHighlight();A&&(A=A.transform(),S.fx=A.x,S.fy=A.y)}else S={x1:I.x,y1:I.y,x2:k.x,y2:k.y};S.gradientUnits="userSpaceOnUse",w=n((z?"radial":"linear")+"Gradient",S);for(var O=M._stops,T=0,L=O.length;L>T;T++){var N=O[T],B=N._color,D=B.getAlpha();S={offset:N._rampPoint,"stop-color":B.toCSS(!0)},1>D&&(S["stop-opacity"]=D),w.appendChild(n("stop",S))}y(p,w,"color")}return"url(#"+w.id+")"}function v(S,M,z){var I={},k=!z&&S.getParent();return null!=S._name&&(I.id=S._name),w.each(xt,(function(M){var z=M.get,A=M.type,O=S[z]();if(M.exportFilter?M.exportFilter(S,O):!k||!w.equals(k[z](),O)){if("color"===A&&null!=O){var T=O.getAlpha();1>T&&(I[M.attribute+"-opacity"]=T)}I[M.attribute]=null==O?"none":"number"===A?p.number(O):"color"===A?O.gradient?f(O):O.toCSS(!0):"array"===A?O.join(","):"lookup"===A?M.toSVG[O]:O}})),1===I.opacity&&delete I.opacity,S._visible||(I.visibility="hidden"),t(M,I)}function m(p,w){return S||(S={ids:{},svgs:{}}),p&&S.svgs[w+"-"+p._id]}function y(p,w,M){S||m();var z=S.ids[M]=(S.ids[M]||0)+1;w.id=M+"-"+z,S.svgs[M+"-"+p._id]=w}function x(p,w){var M=p,z=null;if(S){for(var I in M="svg"===p.nodeName.toLowerCase()&&p,S.svgs)z||(M||(M=n("svg")).appendChild(p),z=M.insertBefore(n("defs"),M.firstChild)),z.appendChild(S.svgs[I]);S=null}return w.asString?(new XMLSerializer).serializeToString(M):M}function b(p,w,S){var z=M[p._class],I=z&&z(p,w);if(I){var k=w.onExport;k&&(I=k(p,I,w)||I);var A=JSON.stringify(p._data);A&&"{}"!==A&&"null"!==A&&I.setAttribute("data-paper-data",A)}return I&&v(p,I,S)}function C(w){return w||(w={}),p=new I(w.precision),w}var p,S,M={Group:s,Layer:s,Raster:function h(p){var w=r(p._matrix,!0),S=p.getSize();return w.x-=S.width/2,w.y-=S.height/2,w.width=S.width,w.height=S.height,w.href=p.toDataURL(),n("image",w)},Path:function u(w,S){if(S.matchShapes){var M=w.toShape(!1);if(M)return c(M)}var z,I=w._segments,k=r(w._matrix);if(0===I.length)return null;if(w.isPolygon())if(I.length>=3){z=w._closed?"polygon":"polyline";var A=[];for(i=0,l=I.length;l>i;i++)A.push(p.point(I[i]._point));k.points=A.join(" ")}else{z="line";var O=I[0]._point,T=I[I.length-1]._point;k.set({x1:O.x,y1:O.y,x2:T.x,y2:T.y})}else z="path",k.d=w.getPathData(null,S.precision);return n(z,k)},Shape:c,CompoundPath:function d(p,w){var S=r(p._matrix),M=p.getPathData(null,w.precision);return M&&(S.d=M),n("path",S)},PlacedSymbol:function _(w,S){var M=r(w._matrix,!0),z=w.getSymbol(),I=m(z,"symbol"),k=z.getDefinition(),A=k.getBounds();return I||((I=n("symbol",{viewBox:p.rectangle(A)})).appendChild(b(k,S)),y(z,I,"symbol")),M.href="#"+I.id,M.x+=A.x,M.y+=A.y,M.width=p.number(A.width),M.height=p.number(A.height),M.overflow="visible",n("use",M)},PointText:function g(p){var w=n("text",r(p._matrix,!0));return w.textContent=p._content,w}};q.inject({exportSVG:function(p){return x(b(this,p=C(p),!0),p)}}),R.inject({exportSVG:function(p){p=C(p);var w=this.layers,S=this.getView(),M=S.getViewSize(),z=n("svg",{x:0,y:0,width:M.width,height:M.height,version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}),I=z,k=S._matrix;k.isIdentity()||(I=z.appendChild(n("g",r(k))));for(var A=0,O=w.length;O>A;A++)I.appendChild(b(w[A],p,!0));return x(z,p)}})},new function(){function i(p,w,S,M){var z=bt[w],I=z?p.getAttributeNS(z,w):p.getAttribute(w);return"null"===I&&(I=null),null==I?M?null:S?"":0:S?I:parseFloat(I)}function n(p,w,S,M){return w=i(p,w,!1,M),S=i(p,S,!1,M),!M||null!=w&&null!=S?new O(w,S):null}function r(p,w,S,M){return w=i(p,w,!1,M),S=i(p,S,!1,M),!M||null!=w&&null!=S?new L(w,S):null}function s(p,w,S){return"none"===p?null:"number"===w?parseFloat(p):"array"===w?p?p.split(/[\s,]+/g).map(parseFloat):[]:"color"===w?b(p)||p:"lookup"===w?S[p]:p}function a(p,w,S,M){var z=p.childNodes,I="clippath"===w,k=new V,A=k._project,O=A._currentStyle,T=[];I||(k=m(k,p,M),A._currentStyle=k._style.clone());for(var L=0,N=z.length;N>L;L++){var B,D=z[L];1!==D.nodeType||!(B=P(D,S,!1))||B instanceof F||T.push(B)}return k.addChildren(T),I&&(k=m(k.reduce(),p,M)),A._currentStyle=O,(I||"defs"===w)&&(k.remove(),k=null),k}function o(p,w){for(var S=p.getAttribute("points").match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g),M=[],z=0,I=S.length;I>z;z+=2)M.push(new O(parseFloat(S[z]),parseFloat(S[z+1])));var k=new Q(M);return"polygon"===w&&k.closePath(),k}function l(p,w){var S,M,I,k,A=(i(p,"href",!0)||"").substring(1),O="radialgradient"===w;if(A)S=z[A].getGradient();else{for(var T=p.childNodes,L=[],N=0,B=T.length;B>N;N++){var D=T[N];1===D.nodeType&&L.push(m(new ot,D))}S=new at(L,O)}return O?(I=(M=n(p,"cx","cy")).add(i(p,"r"),0),k=n(p,"fx","fy",!0)):(M=n(p,"x1","y1"),I=n(p,"x2","y2")),m(new st(S,M,I,k),p),null}function d(p,w,S,M){for(var z=(M.getAttribute(S)||"").split(/\)\s*/g),I=new j,k=0,A=z.length;A>k;k++){var O=z[k];if(!O)break;for(var T=O.split(/\(\s*/),L=T[0],N=T[1].split(/[\s,]+/g),B=0,D=N.length;D>B;B++)N[B]=parseFloat(N[B]);switch(L){case"matrix":I.concatenate(new j(N[0],N[1],N[2],N[3],N[4],N[5]));break;case"rotate":I.rotate(N[0],N[1],N[2]);break;case"translate":I.translate(N[0],N[1]);break;case"scale":I.scale(N);break;case"skewX":I.skew(N[0],0);break;case"skewY":I.skew(0,N[0])}}p.transform(I)}function f(p,w,S){var M=p["fill-opacity"===S?"getFillColor":"getStrokeColor"]();M&&M.setAlpha(parseFloat(w))}function v(S,M,z){var I=S.attributes[M],k=I&&I.value;if(!k){var A=w.camelize(M);(k=S.style[A])||z.node[A]===z.parent[A]||(k=z.node[A])}return k?"none"===k?null:k:p}function m(S,z,I){var k={node:ut.getStyles(z)||{},parent:!I&&ut.getStyles(z.parentNode)||{}};return w.each(M,(function(M,I){var A=v(z,I,k);A!==p&&(S=w.pick(M(S,A,I,z,k),S))})),S}function b(p){var w=p&&p.match(/\((?:#|)([^)']+)/);return w&&z[w[1]]}function P(p,w,M){function n(p){paper=k;var S=P(p,w,M),z=w.onLoad,I=k.project&&k.getView();z&&z.call(this,S),I.update()}if(!p)return null;w?"function"==typeof w&&(w={onLoad:w}):w={};var I=p,k=paper;if(M)if("string"!=typeof p||/^.*</.test(p)){if("undefined"!=typeof File&&p instanceof File){var A=new FileReader;return A.onload=function(){n(A.result)},A.readAsText(p)}}else{if(!(I=document.getElementById(p)))return mt.request("get",p,n);p=null}if("string"==typeof p&&(I=(new DOMParser).parseFromString(p,"image/svg+xml")),!I.nodeName)throw Error("Unsupported SVG source: "+p);var O,T=I.nodeName.toLowerCase(),L=S[T],N=I.getAttribute&&I.getAttribute("data-paper-data"),B=k.settings,D=B.applyMatrix;if(B.applyMatrix=!1,O=L&&L(I,T,w,M)||null,B.applyMatrix=D,O){"#document"===T||O instanceof V||(O=m(O,I,M));var j=w.onImport;j&&(O=j(I,O,w)||O),w.expandShapes&&O instanceof H&&(O.remove(),O=O.toPath()),N&&(O._data=JSON.parse(N))}return M&&(z={},D&&O&&O.matrix.apply(!0,!0)),O}var S={"#document":function(p,w,S,M){for(var z=p.childNodes,I=0,k=z.length;k>I;I++){var A=z[I];if(1===A.nodeType){var O=A.nextSibling;document.body.appendChild(A);var T=P(A,S,M);return O?p.insertBefore(A,O):p.appendChild(A),T}}},g:a,svg:a,clippath:a,polygon:o,polyline:o,path:function u(p){var w=p.getAttribute("d"),S={pathData:w};return(w.match(/m/gi)||[]).length>1||/z\S+/i.test(w)?new tt(S):new Q(S)},lineargradient:l,radialgradient:l,image:function(p){var w=new W(i(p,"href",!0));return w.on("load",(function(){var w=r(p,"width","height");this.setSize(w);var S=this._matrix._transformPoint(n(p,"x","y").add(w.divide(2)));this.translate(S)})),w},symbol:function(p,w,S,M){return new F(a(p,w,S,M),!0)},defs:a,use:function(p){var w=(i(p,"href",!0)||"").substring(1),S=z[w],M=n(p,"x","y");return S?S instanceof F?S.place(M):S.clone().translate(M):null},circle:function(p){return new H.Circle(n(p,"cx","cy"),i(p,"r"))},ellipse:function(p){return new H.Ellipse({center:n(p,"cx","cy"),radius:r(p,"rx","ry")})},rect:function(p){var w=n(p,"x","y"),S=r(p,"width","height"),M=r(p,"rx","ry");return new H.Rectangle(new B(w,S),M)},line:function(p){return new Q.Line(n(p,"x1","y1"),n(p,"x2","y2"))},text:function(p){var w=new rt(n(p,"x","y").add(n(p,"dx","dy")));return w.setContent(p.textContent.trim()||""),w}},M=w.each(xt,(function(p){this[p.attribute]=function(w,S){if(w[p.set](s(S,p.type,p.fromSVG)),"color"===p.type&&w instanceof H){var M=w[p.get]();M&&M.transform((new j).translate(w.getPosition(!0).negate()))}}}),{id:function(p,w){z[w]=p,p.setName&&p.setName(w)},"clip-path":function(p,w){var S=b(w);if(S){if((S=S.clone()).setClipMask(!0),!(p instanceof V))return new V(S,p);p.insertChild(0,S)}},gradientTransform:d,transform:d,"fill-opacity":f,"stroke-opacity":f,visibility:function(p,w){p.setVisible("visible"===w)},display:function(p,w){p.setVisible(null!==w)},"stop-color":function(p,w){p.setColor&&p.setColor(w)},"stop-opacity":function(p,w){p._color&&p._color.setAlpha(parseFloat(w))},offset:function(p,w){var S=w.match(/(.*)%$/);p.setRampPoint(S?S[1]/100:parseFloat(w))},viewBox:function(p,w,S,M,z){var I=new B(s(w,"array")),k=r(M,"width","height",!0);if(p instanceof V){var A=k?I.getSize().divide(k):1,O=(new j).translate(I.getPoint()).scale(A);p.transform(O.inverted())}else if(p instanceof F){k&&I.setSize(k);var T="visible"!=v(M,"overflow",z),L=p._definition;T&&!I.contains(L.getBounds())&&((T=new H.Rectangle(I).transform(L._matrix)).setClipMask(!0),L.addChild(T))}}}),z={};q.inject({importSVG:function(p,w){return this.addChild(P(p,w,!0))}}),R.inject({importSVG:function(p,w){return this.activate(),P(p,w,!0)}})},paper=new(M.inject(w.exports,{enumerable:!0,Base:w,Numerical:A,Key:gt})),"function"==typeof define&&define.amd?define("paper",paper):"object"==typeof module&&module&&(module.exports=paper),paper};