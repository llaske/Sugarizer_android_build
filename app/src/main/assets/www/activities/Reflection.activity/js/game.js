function Game(i,t,s,h,r,o){this.margin=0,this.gridwidth=10,this.gridheight=6,this.circleswidth=0,this.circlesheight=0,this.radius=0,console.log(t),this.verticalline=null,this.horizontalline=null,this.mode=null,this.dotsarr=[],this.buddy=["#FFFFFF","#000000",t.fill,t.stroke],this.rainbow=["#FFFFFF","#000000","#FF0000","#FF8000","#FFFF00","#00FF00","#00FFFF","#0000FF","#FF00FF"],this.colours=this.buddy,this.robot=!1,this.gameOver=!1,this.radiusFromX=function(){return this.margin=.02*i.canvas.width,(i.canvas.width-this.margin*(this.gridwidth+1))/this.gridwidth/2},this.radiusFromY=function(){return this.margin=.02*i.canvas.height,(i.canvas.height-this.margin*(this.gridheight+1))/this.gridheight/2},this.canDoFromX=function(){var t=this.radiusFromX();return this.margin=.02*i.canvas.width,2*t*this.gridheight+this.margin*(this.gridheight+1)<=i.canvas.height&&t},this.removeLines=function(){null!=this.verticalline&&(i.removeChild(this.verticalline),this.verticalline=null),null!=this.horizontalline&&(i.removeChild(this.horizontalline),this.horizontalline=null)},this.addVerticalLine=function(){this.verticalline=new createjs.Shape,this.verticalline.graphics.beginFill("#000000").drawRect(0,0,this.margin/3,this.circlesheight-this.margin),this.verticalline.x=i.canvas.width/2-this.margin/6,this.verticalline.y=this.margin/2,i.addChild(this.verticalline)},this.addHorizontalLine=function(){this.horizontalline=new createjs.Shape,this.horizontalline.graphics.beginFill("#000000").drawRect(0,0,this.circleswidth-this.margin,this.margin/3),this.horizontalline.x=(i.canvas.width-this.circleswidth)/2+this.margin/2,this.horizontalline.y=this.circlesheight/2-this.margin/6,i.addChild(this.horizontalline)},this.initHorizontalGame=function(i){void 0===i&&(i=!1),this.gameOver=!1,this.removeLines(),this.addVerticalLine(),this.mode=0,0==i?this.initDots():this.initDotsFromSave(i)},this.initVerticalGame=function(i){void 0===i&&(i=!1),this.gameOver=!1,this.removeLines(),this.addHorizontalLine(),this.mode=1,0==i?this.initDots():this.initDotsFromSave(i)},this.initBilateralGame=function(i){void 0===i&&(i=!1),this.gameOver=!1,this.removeLines(),this.addHorizontalLine(),this.addVerticalLine(),this.mode=2,0==i?this.initDots():this.initDotsFromSave(i)},this.setBuddyStyle=function(){s.getElementById("buddy-button").style.backgroundColor="#808080",s.getElementById("rainbow-button").removeAttribute("style")},this.initBuddy=function(){switch(this.setBuddyStyle(),this.colours=this.buddy,this.mode){case 0:this.initHorizontalGame();break;case 1:this.initVerticalGame();break;case 2:this.initBilateralGame()}},this.setRainbowStyle=function(){s.getElementById("buddy-button").removeAttribute("style"),s.getElementById("rainbow-button").style.backgroundColor="#808080"},this.initRainbow=function(){switch(this.setRainbowStyle(),this.colours=this.rainbow,this.mode){case 0:this.initHorizontalGame();break;case 1:this.initVerticalGame();break;case 2:this.initBilateralGame()}},this.initDots=function(){this.dotsarr=[];for(var t=[],s=2*this.radius+this.margin,h=(i.canvas.width-this.circleswidth)/2+this.margin,r=this.margin,o=0;o<this.gridwidth;o++){t=[],r=this.margin;for(var e=0;e<this.gridheight;e++){var a=new SymmetryDot(i,!0,h+this.radius,r+this.radius,this.radius,this.colours,Math.floor(Math.random()*this.colours.length),this,o,e);a.init(),t.push(a),r+=s}this.dotsarr.push(t),h+=s}},this.initDotsFromSave=function(t){this.dotsarr=[];for(var s=[],h=2*this.radius+this.margin,r=(i.canvas.width-this.circleswidth)/2+this.margin,o=this.margin,e=0;e<this.gridwidth;e++){s=[],o=this.margin;for(var a=0;a<this.gridheight;a++){var n=new SymmetryDot(i,!0,r+this.radius,o+this.radius,this.radius,this.colours,t[e][a],this,e,a);n.init(),s.push(n),o+=h}this.dotsarr.push(s),r+=h}},this.checkHorizontalGame=function(){for(var i=!0,t=0;t<this.gridwidth/2;t++)for(var s=0;s<this.gridheight;s++)this.dotsarr[t][s].colour!=this.dotsarr[this.gridwidth-1-t][s].colour&&(i=!1);if(1==i)for(t=0;t<this.gridwidth;t++)for(s=0;s<this.gridheight;s++)this.gameOver=!0,this.dotsarr[t][s].clickable=!1,this.dotsarr[t][s].showSmile()},this.checkVerticalGame=function(){for(var i=!0,t=0;t<this.gridwidth;t++)for(var s=0;s<this.gridheight/2;s++)this.dotsarr[t][s].colour!=this.dotsarr[t][this.gridheight-1-s].colour&&(i=!1);if(1==i)for(t=0;t<this.gridwidth;t++)for(s=0;s<this.gridheight;s++)this.gameOver=!0,this.dotsarr[t][s].clickable=!1,this.dotsarr[t][s].showSmile()},this.checkBilateralGame=function(){for(var i=!0,t=0;t<this.gridwidth/2;t++)for(var s=0;s<this.gridheight/2;s++)this.dotsarr[t][s].colour==this.dotsarr[this.gridwidth-1-t][s].colour&&this.dotsarr[t][s].colour==this.dotsarr[t][this.gridheight-1-s].colour&&this.dotsarr[t][s].colour==this.dotsarr[this.gridwidth-1-t][this.gridheight-1-s].colour||(i=!1);if(1==i)for(t=0;t<this.gridwidth;t++)for(s=0;s<this.gridheight;s++)this.gameOver=!0,this.dotsarr[t][s].clickable=!1,this.dotsarr[t][s].showSmile()},this.checkColours=function(){switch(this.mode){case 0:this.checkHorizontalGame();break;case 1:this.checkVerticalGame();break;case 2:this.checkBilateralGame()}},this.robotOff=function(){var i=s.getElementById("robot-button");i.title=o.get("robot-button.title"),i.style.backgroundImage="url('./icons/robot-off.svg')",this.robot=!1},this.robotOn=function(){var i=s.getElementById("robot-button");i.title=o.get("robot-button-off.title"),i.style.backgroundImage="url('./icons/robot-on.svg')",this.robot=!0},this.toggleRobot=function(){this.robot?this.robotOff():this.robotOn()},this.robotColours=function(i,t,s){switch(this.mode){case 0:this.horizontalColour(i,t,s);break;case 1:this.verticalColour(i,t,s);break;case 2:this.bilateralColour(i,t,s)}},this.horizontalColour=function(i,t,s){this.dotsarr[this.gridwidth-1-i][t].setColour(s)},this.verticalColour=function(i,t,s){this.dotsarr[i][this.gridheight-1-t].setColour(s)},this.bilateralColour=function(i,t,s){this.dotsarr[this.gridwidth-1-i][t].setColour(s),this.dotsarr[i][this.gridheight-1-t].setColour(s),this.dotsarr[this.gridwidth-1-i][this.gridheight-1-t].setColour(s)},this.stop=function(i){void 0===i&&(i=!1);var t={};t.mode=this.mode;for(var s=[],h=[],o=0;o<this.gridwidth;o++){h=[];for(var e=0;e<this.gridheight;e++)h.push(this.dotsarr[o][e].colour);s.push(h)}t.dots=s,t.robot=this.robot,t.gameOver=this.gameOver,this.colours.length==this.buddy.length?t.buddy=!0:t.buddy=!1,console.log(t);var a=JSON.stringify(t);r.getDatastoreObject().setDataAsText(a),1==i?r.getDatastoreObject().save((function(){location.reload()})):r.getDatastoreObject().save((function(){r.close()}))},this.resize=function(){this.circleswidth=0,this.circlesheight=0,this.radius=0,this.margin=0;var i=this.gameOver,t=this.canDoFromX();0==t&&(t=this.radiusFromY()),this.radius=t,this.circleswidth=2*this.radius*this.gridwidth+this.margin*(this.gridwidth+1),this.circlesheight=2*this.radius*this.gridheight+this.margin*(this.gridheight+1);for(var s=[],h=[],r=0;r<this.gridwidth;r++){h=[];for(var o=0;o<this.gridheight;o++)h.push(this.dotsarr[r][o].colour);s.push(h)}switch(this.mode){case 0:this.initHorizontalGame(s);break;case 1:this.initVerticalGame(s);break;case 2:this.initBilateralGame(s)}if(1==i){this.gameOver=!0;for(r=0;r<this.gridwidth;r++)for(o=0;o<this.gridheight;o++)this.dotsarr[r][o].clickable=!1,this.dotsarr[r][o].showSmile()}},this.init=function(){console.log("init"),console.log(r.getDatastoreObject()),r.getDatastoreObject().getMetadata(this.init_canaccessdatastore.bind(this))},this.init_canaccessdatastore=function(i,t){console.log("datastore check");var s=(new Date).getTime();Math.abs(s-t.creation_time)<2e3?(console.log("Time too short"),this.initActivity(!1,[])):r.getDatastoreObject().loadAsText(this.init_getdatastore.bind(this))},this.init_getdatastore=function(i,t,s){null==i&&null!=s?(s=JSON.parse(s),this.initActivity(!0,s)):this.initActivity(!1,[])},this.initActivity=function(i,t){console.log(i),console.log(t);var s=this.canDoFromX();if(0==s&&(console.log("position based on y"),s=this.radiusFromY()),this.radius=s,console.log(s),this.circleswidth=2*this.radius*this.gridwidth+this.margin*(this.gridwidth+1),this.circlesheight=2*this.radius*this.gridheight+this.margin*(this.gridheight+1),console.log(t),0==i||null==t)this.initHorizontalGame();else{switch(1==t.buddy?this.colours=this.buddy:this.colours=this.rainbow,t.mode){case 0:this.initHorizontalGame(t.dots);break;case 1:this.initVerticalGame(t.dots);break;case 2:this.initBilateralGame(t.dots)}if(1==t.gameOver){this.gameOver=!0;for(var h=0;h<this.gridwidth;h++)for(var r=0;r<this.gridheight;r++)this.dotsarr[h][r].clickable=!1,this.dotsarr[h][r].showSmile()}1==t.robot?this.robotOn():this.robotOff()}this.colours==this.buddy?this.setBuddyStyle():this.setRainbowStyle()}}