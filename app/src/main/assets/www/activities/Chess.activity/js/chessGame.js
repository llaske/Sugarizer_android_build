var xoLogo='<?xml version="1.0" ?><!DOCTYPE svg  PUBLIC \'-//W3C//DTD SVG 1.1//EN\'  \'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\' [<!ENTITY stroke_color "#010101"><!ENTITY fill_color "#FFFFFF">]><svg enable-background="new 0 0 55 55" height="55px" version="1.1" viewBox="0 0 55 55" width="55px" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px"><g display="block" id="stock-xo_1_"><path d="M33.233,35.1l10.102,10.1c0.752,0.75,1.217,1.783,1.217,2.932   c0,2.287-1.855,4.143-4.146,4.143c-1.145,0-2.178-0.463-2.932-1.211L27.372,40.961l-10.1,10.1c-0.75,0.75-1.787,1.211-2.934,1.211   c-2.284,0-4.143-1.854-4.143-4.141c0-1.146,0.465-2.184,1.212-2.934l10.104-10.102L11.409,24.995   c-0.747-0.748-1.212-1.785-1.212-2.93c0-2.289,1.854-4.146,4.146-4.146c1.143,0,2.18,0.465,2.93,1.214l10.099,10.102l10.102-10.103   c0.754-0.749,1.787-1.214,2.934-1.214c2.289,0,4.146,1.856,4.146,4.145c0,1.146-0.467,2.18-1.217,2.932L33.233,35.1z" fill="&fill_color;" stroke="&stroke_color;" stroke-width="3.5"/><circle cx="27.371" cy="10.849" fill="&fill_color;" r="8.122" stroke="&stroke_color;" stroke-width="3.5"/></g></svg>',generateXOLogoWithColor=function(e){var t=xoLogo;return t=(t=t.replace("#010101",e.stroke)).replace("#FFFFFF",e.fill),"data:image/svg+xml;base64,"+btoa(t)},ChessGame={template:'\n  <div id="chess-container">\n    <div id="play-container">\n\n      <div id="board" ></div>\n\n\n\t\t<div id="chess-panel" class="panel">\n      <div v-if="showPromotionDialog" class="promotion-dialog">\n        <div class="promotion-content">\n          <div class="dialog-header">\n            <h3>{{ l10n.stringPromotionTitle }}</h3>\n          </div>\n          <div class="promotion-pieces">\n            <div v-if="playercolor === 0 " class="piece" @click="handlePromotion(\'Q\')"><img src="./img/chesspieces/wikipedia/wQ.png" alt="Queen"></div>\n              <div v-if="playercolor === 0" class="piece" @click="handlePromotion(\'R\')"><img src="./img/chesspieces/wikipedia/wR.png" alt="Rook"></div>\n              <div v-if="playercolor === 0" class="piece" @click="handlePromotion(\'B\')"><img src="./img/chesspieces/wikipedia/wB.png" alt="Bishop"></div>\n              <div v-if="playercolor === 0" class="piece" @click="handlePromotion(\'N\')"><img src="./img/chesspieces/wikipedia/wN.png" alt="Knight"></div>\n              <div v-if="playercolor === 1" class="piece" @click="handlePromotion(\'Q\')"><img src="./img/chesspieces/wikipedia/bQ.png" alt="Queen"></div>\n              <div v-if="playercolor === 1" class="piece" @click="handlePromotion(\'R\')"><img src="./img/chesspieces/wikipedia/bR.png" alt="Rook"></div>\n              <div v-if="playercolor === 1" class="piece" @click="handlePromotion(\'B\')"><img src="./img/chesspieces/wikipedia/bB.png" alt="Bishop"></div>\n              <div v-if="playercolor === 1" class="piece" @click="handlePromotion(\'N\')"><img src="./img/chesspieces/wikipedia/bN.png" alt="Knight"></div>\n            </div>\n          </div>\n      </div>\n\n\t\t\t<div id="info-container">\n        <div id="opponent-clock">\n          <div class="usrlogo">\n          </div>\n          <div class="usrtime">\n            <div v-if="!opponentuser">PC</div>\n            <div v-else-if="!clock">_:_</div>\n            <div v-else>{{parsedOpponentClockTime}}</div>\n          </div>\n\n        </div>\n        <div id="flagDiv">\n          <div>{{infotext}}</div>\n        </div>\n        <div id="player-clock">\n          <div class="usrlogo">\n          </div>\n          <div class="usrtime">\n          <div v-if="!clock">_:_</div>\n          <div v-else>{{parsedClockTime}}</div>\n            </div>\n        </div>\n\n\t\t\t</div>\n\t\t\t<div id="moves-container">\n        <ol id="ordered-moves" v-if="moves.length!=0">\n          <template v-for="(move, index) in moves" v-bind:key="index">\n          <li v-bind:class="{\n            bB: move.piece == \'b\',\n            bK: move.piece == \'k\',\n            bN: move.piece == \'n\',\n            bP: move.piece == \'p\',\n            bQ: move.piece == \'q\',\n            bR: move.piece == \'r\',\n            wB: move.piece == \'B\',\n            wK: move.piece == \'K\',\n            wN: move.piece == \'N\',\n            wP: move.piece == \'P\',\n            wQ: move.piece == \'Q\',\n            wR: move.piece == \'R\',\n          }"\n          > {{move.from}}-{{move.to}}</li>\n          </template>\n        </ol>\n\t\t\t</div>\n\t\t</div>\n    </div>\n\t</div>\n  ',props:["currentuser","opponentuser","presence","ishost","humane"],data:function(){return{state:null,board:null,whiteSquareGrey:"#7b98ed",blackSquareGrey:"#476bd6",inCheckColor:"#db3a2c",wonColor:"#a3e84f",drawColor:"#ffffff",normalColor:"#f0d9b5",game_won:!1,game_lost:!1,game_draw:!1,game_check:!1,other_check:!1,timeexpired:!1,playercolor:0,level:1,moves:[],infotext:"Vs",clock:0,stopClock:!0,timer:null,stopOpponentClock:!0,clockTime:30,opponentClockTime:30,clockTotalTime:30,showPromotionDialog:!1,pendingMove:{source:null,target:null,piece:null,turn:null},l10n:{stringYouWon:"",stringYouCheck:"",stringYouLost:"",stringMatchDraw:"",stringVs:"",stringTimeExpired:"",stringPromotionTitle:""}}},watch:{currentuser:function(){$("#player-clock .usrlogo").css("background-image","url("+generateXOLogoWithColor(this.currentuser.colorvalue)+")")},opponentuser:function(){if(this.opponentuser)$("#opponent-clock .usrlogo").css("background-image","url("+generateXOLogoWithColor(this.opponentuser.colorvalue)+")"),$("#opponent-clock .usrtime").css("background-color",this.opponentuser.colorvalue.fill);else{$("#opponent-clock .usrtime").css("background-color",this.normalColor),$("#opponent-clock .usrlogo").css("background-image","url(./icons/computer-icon.svg)")}},game_check:function(){var e="<img style='height:30px;' src='"+generateXOLogoWithColor(this.currentuser.colorvalue)+"'>";this.game_check?($("#flagDiv").css("background-color",this.inCheckColor),this.infotext=this.l10n.stringYouCheck,this.humane.log(e+this.l10n.stringYouCheck)):($("#flagDiv").css("background-color",this.normalColor),this.infotext=this.l10n.stringVs)},game_won:function(){this.game_won?($("#flagDiv").css("background-color",this.wonColor),this.infotext=this.l10n.stringYouWon,this.stopClock=!0,this.stopOpponentClock=!0,$("#player-clock").css("border-style","none"),$("#opponent-clock").css("border-style","none")):($("#flagDiv").css("background-color",this.normalColor),this.infotext=this.l10n.stringVs)},game_lost:function(){this.game_lost?($("#flagDiv").css("background-color",this.inCheckColor),this.infotext=this.l10n.stringYouLost,this.stopClock=!0,this.stopOpponentClock=!0,$("#player-clock").css("border-style","none"),$("#opponent-clock").css("border-style","none")):($("#flagDiv").css("background-color",this.normalColor),this.infotext=this.l10n.stringVs)},game_draw:function(){this.game_draw?($("#flagDiv").css("background-color",this.drawColor),this.infotext=this.l10n.stringMatchDraw,this.stopClock=!0,this.stopOpponentClock=!0,$("#player-clock").css("border-style","none"),$("#opponent-clock").css("border-style","none")):($("#flagDiv").css("background-color",this.normalColor),this.infotext=this.l10n.stringVs)}},computed:{parsedClockTime:function(){var e=this.clockTime,pad=function(e,t){return("000"+e).slice(-1*t)},t=parseFloat(e).toFixed(3),o=(Math.floor(t/60/60),Math.floor(t/60)%60),s=Math.floor(t-60*o);t.slice(-3);return pad(o,2)+":"+pad(s,2)},parsedOpponentClockTime:function(){var e=this.opponentClockTime,pad=function(e,t){return("000"+e).slice(-1*t)},t=parseFloat(e).toFixed(3),o=(Math.floor(t/60/60),Math.floor(t/60)%60),s=Math.floor(t-60*o);t.slice(-3);return pad(o,2)+":"+pad(s,2)}},created:function(){this.state=new p4_new_game},updated:function(){const e=$("#ordered-moves li:last-child");null!=e.offset()&&document.getElementById("moves-container").scrollTo(0,e.offset().top+e.height())},mounted:function(){let e=this;this.board=Chessboard("board",{draggable:!0,position:"start",onDragStart:this.onDragStart,onDrop:this.onDrop,onSnapEnd:this.onSnapEnd,onMouseoverSquare:this.onMouseoverSquare,onMouseoutSquare:this.onMouseoutSquare}),$("#player-clock .usrlogo").css("background-image","url("+generateXOLogoWithColor(this.currentuser.colorvalue)+")"),window.addEventListener("resize",(function(){var t=document.getElementById("main-toolbar"),o=1==t.style.opacity?t.offsetHeight+3:0,s=window.innerHeight-o,i=window.innerWidth/window.innerHeight;i<1?(0!=o?($("#board").css("width","60vw"),$("#chess-panel").css("width","60vw")):($("#board").css("width","65vw"),$("#chess-panel").css("width","65vw")),$("#chess-panel").css("height","30%")):i>1&&i<1.3?(0!=o?($("#board").css("width",.75*s+"px"),$("#chess-panel").css("height",.75*s+"px")):($("#board").css("width",.8*s+"px"),$("#chess-panel").css("height",.8*s+"px")),$("#chess-panel").css("width","35%")):($("#board").css("width",.95*s+"px"),$("#chess-panel").css("height",.95*s+"px"),$("#chess-panel").css("width","35%")),e.board.resize()}))},methods:{localized:function(e){e.localize(this.l10n)},startClockTimer:function(){var e=this;e.clockTime=this.clockTotalTime,e.opponentClockTime=this.clockTotalTime,e.timer||e.tick()},stopClockTimer:function(){var e=this;e.timer&&clearInterval(e.timer),e.timer=null},tick:function(){var e=this;e.timer=setInterval((function(){(e.opponentuser&&e.ishost||!e.opponentuser)&&e.clock&&(e.stopClock||(0==e.clockTime?(e.game_lost=!0,e.stopClock=!0,e.stopOpponentClock=!0,e.timeexpired=!0,e.$emit("timeexpired",{data:{player:0}})):e.clockTime--),e.opponentuser&&e.ishost&&(e.stopOpponentClock||(0==e.opponentClockTime?(e.game_won=!0,e.stopClock=!0,e.stopOpponentClock=!0,e.timeexpired=!0,e.$emit("timeexpired",{data:{player:1}})):e.opponentClockTime--),e.$emit("sendclock",{data:{clockTime:e.clockTime,opponentClockTime:e.opponentClockTime}})))}),1e3)},onSnapEnd:function(){this.board.position(p4_state2fen(this.state,!0))},removeGreySquares:function(e){$("#board .square-55d63").css("background","")},greySquare:function(e){var t=$("#board .square-"+e),o="#a9a9a9";t.hasClass("black-3c85d")&&(o="#696969"),t.css("background",o)},updateMoves:function(){var e=this.state.history,t=e.length;0!=e.length&&this.moves.push({piece:"  PpRrNnBbKkQq".charAt(this.state.board[e[t-1][1]]),from:p4_stringify_point(e[t-1][0]),to:p4_stringify_point(e[t-1][1]),check:this.game_check})},onDragStart:function(e,t,o,s){if(this.game_won||this.game_lost||this.game_draw||this.timeexpired)return!1;if(this.state.to_play){if(-1!==t.search(/^w/)&&1==this.state.to_play)return!1}else if(-1!==t.search(/^b/)&&0==this.state.to_play)return!1},makeRandomMove:function(){var e=Date.now(),t=this.state.findmove(this.level),o=Date.now()-e,s=this.state.move(t[0],t[1]);if(!(1&s.flags)){var i=this.level;if(++i>2)for(var n=25*i;o<n;)i++,t=state.findmove(i),o=Date.now()-e;if(0===t.length&&2&flags)return void(this.game_won=!0);s=this.state.move(t[0],t[1])}if(1&s.flags&&2&s.flags&&4&s.flags)return this.board.position(p4_state2fen(this.state,!0)),this.updateMoves(),void(this.game_lost=!0);if(2&s.flags&&!(4&s.flags))this.game_check=!0;else{if(!(2&s.flags)&&(1&s.flags&&4&s.flags||64&s.flags))return this.board.position(p4_state2fen(this.state,!0)),this.updateMoves(),void(this.game_draw=!0);this.game_check=!1}this.board.position(p4_state2fen(this.state,!0)),this.clock&&(this.stopClock=!1),$("#player-clock").css("border-style","solid"),$("#opponent-clock").css("border-style","none"),this.updateMoves(),this.infotext=this.l10n.stringVs},onDrop:function(e,t){var o=this.playercolor?this.state.moveno%2!=0:this.state.moveno%2==0;if(!this.opponentuser||this.opponentuser&&o){this.removeGreySquares();const i=this.board.position()[e],n="wP"===i,c="bP"===i,l="8"===t[1],a="1"===t[1];if(n&&l||c&&a)return this.pendingMove={source:e,target:t,piece:i,turn:o},void(this.showPromotionDialog=!0);var s=this.state.move(e,t);if(0===s.flags)return"snapback";if(7===s.flags||15===s.flags||23===s.flags||39===s.flags)return void(this.game_won=!0);if(!(2&s.flags)&&(1&s.flags&&4&s.flags||64&s.flags))return void(this.game_draw=!0);this.game_check=!1,2&s.flags&&!(4&s.flags)?this.other_check=!0:this.other_check=!1,this.opponentuser?this.ishost&&(this.stopClock=!0,this.stopOpponentClock=!1):(this.stopClock=!0,this.stopOpponentClock=!1),$("#player-clock").css("border-style","none"),$("#opponent-clock").css("border-style","solid"),this.opponentuser&&this.$emit("sendmove",{data:{chessColor:this.playercolor,state:this.state,game_won:this.game_lost,game_lost:this.game_won,game_draw:this.game_draw,game_check:this.other_check}}),$("#canvas").css("background-color",this.currentuser.colorvalue.fill),this.updateMoves(),this.opponentuser||window.setTimeout(this.makeRandomMove,250)}},onMouseoverSquare:function(e,t){var o=[];p4_prepare(this.state);for(var s=p4_parse(this.state,this.state.to_play,this.state.enpassant,0),i=0;i<s.length;i++)p4_stringify_point(s[i][1])==e&&o.push(p4_stringify_point(s[i][2]));if(0!==o.length&&this.state.to_play==this.playercolor&&!(this.game_won||this.game_draw||this.game_lost)){this.greySquare(e);for(i=0;i<o.length;i++)this.greySquare(o[i])}},onMouseoutSquare:function(e,t){this.removeGreySquares()},newGame:function(){this.board.start(),p4_jump_to_moveno(this.state,0),this.game_won=!1,this.game_lost=!1,this.game_draw=!1,this.game_check=!1,this.other_check=!1,this.timeexpired=!1,this.stopClock=!0,this.stopOpponentClock=!0,this.stopClockTimer(),this.moves=[],this.playercolor?($("#player-clock").css("border-style","none"),$("#opponent-clock").css("border-style","solid"),this.clock&&(this.stopOpponentClock=!1,this.stopClock=!0,this.startClockTimer()),this.presence||this.makeRandomMove()):($("#player-clock").css("border-style","solid"),$("#opponent-clock").css("border-style","none"),this.clock&&(this.stopClock=!1,this.stopOpponentClock=!0,this.startClockTimer())),this.presence&&this.$emit("restart")},undo:function(){this.opponentuser||(!this.playercolor&&this.state.moveno>0||this.playercolor&&this.state.moveno>1)&&(this.game_won?(this.game_won=!1,p4_jump_to_moveno(this.state,this.state.moveno-1),this.moves.pop()):this.game_draw?(this.game_draw=!1,p4_jump_to_moveno(this.state,this.state.moveno-1),this.moves.pop()):this.game_lost?(this.game_lost=!1,p4_jump_to_moveno(this.state,this.state.moveno-1),this.moves.pop()):(p4_jump_to_moveno(this.state,this.state.moveno-2),this.moves.pop(),this.moves.pop()),this.board.position(p4_state2fen(this.state,!0)),this.moves.length>0?this.game_check=this.moves[this.moves.length-1].check:this.game_check=!1)},changeColor:function(e){e?0==this.state.moveno&&(this.playercolor?(this.board.orientation("white"),this.playercolor=0,this.newGame()):(this.board.orientation("black"),this.playercolor=1,this.newGame())):0==this.state.moveno?(this.board.orientation("black"),this.playercolor=1,this.newGame()):1==this.state.moveno&&(this.board.start(!1),this.board.orientation("white"),this.playercolor=0,this.newGame())},onComputerlevelChanged:function(e){this.level=e},onClockSelected:function(e,t){switch(e){case 0:this.clockTotalTime=0,this.stopClock=!0,this.stopOpponentClock=!0,this.stopClockTimer(),document.getElementById("disabled-clock").classList.add("selected"),document.getElementById("lightning-clock").classList.remove("selected"),document.getElementById("blitz-clock").classList.remove("selected"),document.getElementById("tournament-clock").classList.remove("selected");break;case 1:this.clockTotalTime=30,this.stopClockTimer(),this.state.to_play==this.playercolor?(this.stopClock=!1,this.stopOpponentClock=!0):(this.stopClock=!0,this.stopOpponentClock=!1),this.startClockTimer(),document.getElementById("lightning-clock").classList.add("selected"),document.getElementById("disabled-clock").classList.remove("selected"),document.getElementById("blitz-clock").classList.remove("selected"),document.getElementById("tournament-clock").classList.remove("selected");break;case 2:this.clockTotalTime=180,this.stopClockTimer(),this.state.to_play==this.playercolor?(this.stopClock=!1,this.stopOpponentClock=!0):(this.stopClock=!0,this.stopOpponentClock=!1),this.startClockTimer(),document.getElementById("blitz-clock").classList.add("selected"),document.getElementById("disabled-clock").classList.remove("selected"),document.getElementById("lightning-clock").classList.remove("selected"),document.getElementById("tournament-clock").classList.remove("selected");break;case 3:this.clockTotalTime=600,this.stopClockTimer(),this.state.to_play==this.playercolor?(this.stopClock=!1,this.stopOpponentClock=!0):(this.stopClock=!0,this.stopOpponentClock=!1),this.startClockTimer(),document.getElementById("tournament-clock").classList.add("selected"),document.getElementById("disabled-clock").classList.remove("selected"),document.getElementById("blitz-clock").classList.remove("selected"),document.getElementById("lightning-clock").classList.remove("selected");break;default:this.clockTotalTime=0,this.stopClock=!0,this.stopOpponentClock=!0,this.stopClockTimer(),document.getElementById("disabled-clock").classList.remove("selected"),document.getElementById("lightning-clock").classList.remove("selected"),document.getElementById("blitz-clock").classList.remove("selected"),document.getElementById("tournament-clock").classList.remove("selected")}this.clock=e,this.clockTime=null!=t?t:this.clockTotalTime,this.opponentClockTime=this.clockTotalTime},handlePromotion:function(e){if(!this.pendingMove.source||!this.pendingMove.target)return void(this.showPromotionDialog=!1);this.showPromotionDialog=!1;const{source:t,target:o}=this.pendingMove;var s=this.state.move(t,o,P4_PIECE_LUT[e]);if(0!==s.flags){if(7===s.flags||15===s.flags||23===s.flags||39===s.flags)return this.game_won=!0,void this.board.position(p4_state2fen(this.state,!0));if(!(2&s.flags)&&(1&s.flags&&4&s.flags||64&s.flags))return this.game_draw=!0,void this.board.position(p4_state2fen(this.state,!0));this.game_check=!1,2&s.flags&&!(4&s.flags)?this.other_check=!0:this.other_check=!1,this.board.position(p4_state2fen(this.state,!0)),this.opponentuser?this.ishost&&(this.stopClock=!0,this.stopOpponentClock=!1):(this.stopClock=!0,this.stopOpponentClock=!1),$("#player-clock").css("border-style","none"),$("#opponent-clock").css("border-style","solid"),this.opponentuser&&this.$emit("sendmove",{data:{chessColor:this.playercolor,state:this.state,game_won:this.game_lost,game_lost:this.game_won,game_draw:this.game_draw,game_check:this.other_check}}),this.updateMoves(),this.pendingMove={source:null,target:null,piece:null,turn:null},this.opponentuser||window.setTimeout(this.makeRandomMove,250)}else this.board.position(p4_state2fen(this.state,!0))}}};