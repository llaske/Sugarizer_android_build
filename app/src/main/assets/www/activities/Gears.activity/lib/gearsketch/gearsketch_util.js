(function(){"use strict";var t,n,i,e,r=[].indexOf||function(t){for(var n=0,i=this.length;n<i;n++)if(n in this&&this[n]===t)return n;return-1},s={}.hasOwnProperty,o=[].slice;window.gearsketch={},i=function(){function Point(t,n){this.x=t,this.y=n}return Point.prototype.plus=function(t){return new Point(this.x+t.x,this.y+t.y)},Point.prototype.minus=function(t){return new Point(this.x-t.x,this.y-t.y)},Point.prototype.times=function(t){return new Point(t*this.x,t*this.y)},Point.prototype.distance=function(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))},Point.prototype.cross=function(t){return this.x*t.y-this.y*t.x},Point.prototype.clone=function(){return new Point(this.x,this.y)},Point.polar=function(t,n){return new Point(n*Math.cos(t),n*Math.sin(t))},Point.fromObject=function(t){return new Point(t.x,t.y)},Point}(),window.gearsketch.Point=i,t=function(){function ArcSegment(t,n,i,e,r){this.center=t,this.radius=n,this.startAngle=i,this.endAngle=e,this.direction=r,this.start=this.pointOnCircle(i),this.end=this.pointOnCircle(e)}return ArcSegment.prototype.getLength=function(){return(this.direction===e.Direction.CLOCKWISE?e.mod(this.endAngle-this.startAngle,2*Math.PI):e.mod(this.startAngle-this.endAngle,2*Math.PI))*this.radius},ArcSegment.prototype.findPoint=function(t){var n,r;return r=t/this.radius,n=this.startAngle+(this.direction===e.Direction.CLOCKWISE?r:-r),this.center.plus(i.polar(n,this.radius))},ArcSegment.prototype.pointOnCircle=function(t){return this.center.plus(i.polar(t,this.radius))},ArcSegment.prototype.containsAngle=function(t){return this.direction===e.Direction.CLOCKWISE?e.mod(this.endAngle-this.startAngle,2*Math.PI)>e.mod(t-this.startAngle,2*Math.PI):e.mod(this.startAngle-this.endAngle,2*Math.PI)>e.mod(this.startAngle-t,2*Math.PI)},ArcSegment.prototype.distanceToPoint=function(t){var n;return n=Math.atan2(t.y-this.center.y,t.x-this.center.x),this.containsAngle(n)?Math.abs(t.distance(this.center)-this.radius):Math.min(t.distance(this.start),t.distance(this.end))},ArcSegment.prototype.intersectsLineSegment=function(t){var n,r,s,o,a,c,h,u,l,d,f,g,m;return g=t.start.minus(this.center),o=(m=t.end.minus(this.center)).x-g.x,a=m.y-g.y,0!==(s=Math.sqrt(Math.pow(o,2)+Math.pow(a,2)))&&(n=g.x*m.y-m.x*g.y,!((r=Math.pow(this.radius,2)*Math.pow(s,2)-Math.pow(n,2))<0)&&(h=(n*a+e.sign(a)*o*Math.sqrt(r))/Math.pow(s,2),u=(-n*o+Math.abs(a)*Math.sqrt(r))/Math.pow(s,2),c=new i(h,u).plus(this.center),t.distanceToPoint(c)<e.EPSILON&&this.distanceToPoint(c)<e.EPSILON||(d=(n*a-e.sign(a)*o*Math.sqrt(r))/Math.pow(s,2),f=(-n*o-Math.abs(a)*Math.sqrt(r))/Math.pow(s,2),l=new i(d,f).plus(this.center),t.distanceToPoint(l)<e.EPSILON&&this.distanceToPoint(l)<e.EPSILON)))},ArcSegment.prototype.distanceToSegment=function(t){var n,i,r,s;return t instanceof ArcSegment?this.center.distance(t.center)>e.EPSILON&&(n=Math.atan2(t.center.y-this.center.y,t.center.x-this.center.x),i=e.mod(n+Math.PI,2*Math.PI),this.containsAngle(n)&&t.containsAngle(i))?(r=this.center.distance(t.center),Math.max(0,r-this.radius-t.radius)):Math.min(this.distanceToPoint(t.start),this.distanceToPoint(t.end),t.distanceToPoint(this.start),t.distanceToPoint(this.end)):this.intersectsLineSegment(t)?0:(s=t.findNearestPoint(this.center),Math.min(this.distanceToPoint(s),this.distanceToPoint(t.start),this.distanceToPoint(t.end),t.distanceToPoint(this.start),t.distanceToPoint(this.end)))},ArcSegment.prototype.clone=function(){return new ArcSegment(this.center.clone(),this.radius,this.startAngle,this.endAngle,this.direction)},ArcSegment.fromObject=function(t){return new ArcSegment(i.fromObject(t.center),t.radius,t.startAngle,t.endAngle,t.direction)},ArcSegment}(),window.gearsketch.ArcSegment=t,n=function(){function LineSegment(t,n){this.start=t,this.end=n}return LineSegment.prototype.getLength=function(){return this.start.distance(this.end)},LineSegment.prototype.findPoint=function(t){var n;return n=t/this.start.distance(this.end),this.start.plus(this.end.minus(this.start).times(n))},LineSegment.prototype.findNearestPoint=function(t){var n,i;return 0===(n=this.getLength())||(i=((t.x-this.start.x)*(this.end.x-this.start.x)+(t.y-this.start.y)*(this.end.y-this.start.y))/Math.pow(n,2))<0?this.start:i>1?this.end:this.start.plus(this.end.minus(this.start).times(i))},LineSegment.prototype.distanceToPoint=function(t){return t.distance(this.findNearestPoint(t))},LineSegment.prototype.findIntersection=function(t){var n,i,r,s,o,a,c;return i=this.start,s=this.end.minus(i),r=t.start,o=t.end.minus(r),n=s.cross(o),a=r.minus(i).cross(o)/n,c=r.minus(i).cross(s)/n,Math.abs(n)>e.EPSILON&&0<=a&&a<=1&&0<=c&&c<=1?i.plus(s.times(a)):null},LineSegment.prototype.distanceToSegment=function(t){return t instanceof LineSegment?this.findIntersection(t)?0:Math.min(this.distanceToPoint(t.start),this.distanceToPoint(t.end),t.distanceToPoint(this.start),t.distanceToPoint(this.end)):t.distanceToSegment(this)},LineSegment.prototype.clone=function(){return new LineSegment(this.start.clone(),this.end.clone())},LineSegment.fromObject=function(t){return new LineSegment(i.fromObject(t.start),i.fromObject(t.end))},LineSegment}(),window.gearsketch.LineSegment=n,e=function(){function Util(){}return i=window.gearsketch.Point,Util.MODULE=6,Util.AXIS_RADIUS=1.5*Util.MODULE,Util.MIN_STACKED_GEARS_TEETH_DIFFERENCE=4,Util.SNAPPING_DISTANCE=2*Util.MODULE,Util.EPSILON=1e-6,Util.Direction={CLOCKWISE:"clockwise",COUNTER_CLOCKWISE:"counterclockwise"},Util.Side={LEFT:"left",RIGHT:"right"},Util.clone=function(t){var n,i,e,o,a,c,h;if(null==t||"object"!=typeof t)return t;if(o=["Point","Gear","ArcSegment","LineSegment","Chain"],c=t.constructor.name,r.call(o,c)>=0)return t.clone();if(t instanceof Array){for(n=[],i=a=0,h=t.length;0<=h?a<h:a>h;i=0<=h?++a:--a)n[i]=this.clone(t[i]);return n}if(t instanceof Object){for(e in n={},t)s.call(t,e)&&(n[e]=this.clone(t[e]));return n}throw new Error("Unable to clone object. Its type is not supported.")},Util.createUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n;return n=16*Math.random()|0,("x"===t?n:3&n|8).toString(16)}))},Util.mod=function(t,n){return(t%n+n)%n},Util.sign=function(t){return t<0?-1:1},Util.addAll=function(t,n){var i,e;for(i=0,e=n.length;i<e;i++)t[n[i]]=!0;return t},Util.makeSetFromList=function(t){return this.addAll({},t)},Util.makeSet=function(){var t;return t=1<=arguments.length?o.call(arguments,0):[],this.makeSetFromList(t)},Util.findPointOnPath=function(t,i){var e,r,s,o,a,c;for(e=i,r=0,o=t.length;e>0;){if(s=(r+1)%o,e<=(c=(a=new n(t[r],t[s])).getLength()))return a.findPoint(e);r=s,e-=c}return null},Util.getLength=function(t,n){var i,e,r,s,o,a;for(null==n&&(n=!0),s=0,i=(o=t.length)-(n?0:1),e=a=0;0<=i?a<i:a>i;e=0<=i?++a:--a)r=(e+1)%o,s+=t[e].distance(t[r]);return s},Util.isPointInsidePolygon=function(t,n){var i,e,r,s,o,a,c,h,u,l,d;for(e=!1,u=t.x,l=t.y,r=(s=n.length)-1,i=d=0;0<=s?d<s:d>s;i=0<=s?++d:--d)o=n[i].x,a=n[i].y,c=n[r].x,a>l!=(h=n[r].y)>l&&u<(c-o)*(l-a)/(h-a)+o&&(e=!e),r=i;return e},Util.isGearInsidePolygon=function(t,n){var e,r,s=this;return e=function(n){return t.location.plus(i.polar(n,t.innerRadius))},function(){var t,n;for(n=[],r=t=0;t<8;r=++t)n.push(e(.25*Math.PI*r));return n}().every((function(t){return s.isPointInsidePolygon(t,n)}))},Util.findGearsInsidePolygon=function(t,n){var i,e,r;for(e in r=[],n)s.call(n,e)&&(i=n[e],this.isGearInsidePolygon(i,t)&&r.push(i));return r},Util.doesGearIntersectLineSegment=function(t,n){return n.distanceToPoint(t.location)<t.pitchRadius+Util.EPSILON},Util.findGearsIntersectingSegment=function(t,n){var i,e,r;for(e in r=[],t)s.call(t,e)&&(i=t[e],this.doesGearIntersectLineSegment(i,n)&&r.push(i));return r},Util.pointPathDistance=function(t,i,e){var r,s,o,a,c,h,u,l;for(null==e&&(e=!0),s=Number.MAX_VALUE,o=(h=i.length)-(e?0:1),a=l=0;0<=o?l<o:l>o;a=0<=o?++l:--l)c=(a+1)%h,u=new n(i[a],i[c]),r=Math.max(0,u.distanceToPoint(t)),s=Math.min(s,r);return s},Util.findNearestIntersectingGear=function(t,n,i){var e,r,s,o;for(null==i&&(i={}),(r=this.findGearsIntersectingSegment(t,n)).sort((function(t,i){return t.distanceToPoint(n.start)-i.distanceToPoint(n.start)})),s=0,o=r.length;s<o;s++)if(!((e=r[s]).id in i))return e;return null},Util.findDirection=function(t){var n,i,e,r,s;for(r=t.length,n=0,i=s=0;0<=r?s<r:s>r;i=0<=r?++s:--s)e=(i+1)%r,n+=t[i].x*t[e].y,n-=t[i].y*t[e].x;return n>0?this.Direction.CLOCKWISE:this.Direction.COUNTER_CLOCKWISE},Util.findTangentPoints=function(t,n,e){var r,s,o,a,c;return c={},o=t.distance(n),Math.abs(o-e)<Util.EPSILON?(c[this.Side.RIGHT]=t.clone(),c[this.Side.LEFT]=t.clone()):(a=Math.sqrt(o*o-e*e),r=Math.atan2(n.y-t.y,n.x-t.x),s=Math.asin(e/o),c[this.Side.RIGHT]=t.plus(i.polar(r+s,a)),c[this.Side.LEFT]=t.plus(i.polar(r-s,a))),c},Util.findGearTangentPoints=function(t,n){return this.findTangentPoints(t,n.location,n.pitchRadius)},Util.findExternalTangents=function(t,e){var r,s,o,a,c,h,u,l,d,f,g,m,p,S,P,w;return o=t[s=e[0]>=e[1]?0:1],a=t[1-s],0===(d=(u=e[s])-(l=e[1-s]))?((S={})[this.Side.LEFT]=o,S[this.Side.RIGHT]=o,r=Math.atan2(a.y-o.y,a.x-o.x),c=i.polar(r+.5*Math.PI,u),h=i.polar(r-.5*Math.PI,u)):(f=l/d,P=(S=this.findTangentPoints(a,o,d))[this.Side.LEFT],w=S[this.Side.RIGHT],c=P.minus(o).times(f),h=w.minus(o).times(f)),g=[S[this.Side.LEFT].plus(c),a.plus(c)],m=[S[this.Side.RIGHT].plus(h),a.plus(h)],p={},o===t[0]?(p[this.Side.RIGHT]=new n(g[0],g[1]),p[this.Side.LEFT]=new n(m[0],m[1])):(p[this.Side.RIGHT]=new n(m[1],m[0]),p[this.Side.LEFT]=new n(g[1],g[0])),p},Util.findInternalTangents=function(t,i){var e,r,s,o,a,c,h,u,l,d,f,g,m,p,S;return r=t[e=i[0]>=i[1]?0:1],s=t[1-e],c=i[e],l=(h=i[1-e])/(u=c+h),p=(m=this.findTangentPoints(s,r,u))[this.Side.LEFT],S=m[this.Side.RIGHT],o=r.minus(p).times(l),a=r.minus(S).times(l),d=[p.plus(o),s.plus(o)],f=[S.plus(a),s.plus(a)],g={},r===t[0]?(g[this.Side.RIGHT]=new n(d[0],d[1]),g[this.Side.LEFT]=new n(f[0],f[1])):(g[this.Side.RIGHT]=new n(d[1],d[0]),g[this.Side.LEFT]=new n(f[1],f[0])),g},Util.findExternalTangentsOfGears=function(t,n){return this.findExternalTangents([t.location,n.location],[t.pitchRadius,n.pitchRadius])},Util.findInternalTangentsOfGears=function(t,n){return this.findInternalTangents([t.location,n.location],[t.pitchRadius,n.pitchRadius])},Util.findTangentLine=function(t,n,i,e){var r,s;return s=(r=t.id in i)===(e===this.Direction.CLOCKWISE)?this.Side.LEFT:this.Side.RIGHT,r===n.id in i?this.findExternalTangentsOfGears(t,n)[s]:this.findInternalTangentsOfGears(t,n)[s]},Util.findAllSimplePathsForNodes=function(t,n,i){var e,o,a,c,h;for(o in a=[],h=i[i.length-1].connections)s.call(h,o)&&(e=t[o],r.call(i,e)<0&&((c=i.slice(0)).push(e),e===n?a.push(c):a=a.concat(this.findAllSimplePathsForNodes(t,n,c))));return a},Util.findAllSimplePathsBetweenNeighbors=function(t){var n,i,e,r,o,a,c,h,u,l,d,f,g;if(o=[],(r=function(){var n;for(i in n=[],t)s.call(t,i)&&(a=t[i],n.push(a));return n}()).length<2)return[];for(n=c=0,l=r.length-1;0<=l?c<l:c>l;n=0<=l?++c:--c)for(e=h=d=n+1,f=r.length;d<=f?h<f:h>f;e=d<=f?++h:--h)null!=r[n].connections[r[e].id]&&(o=o.concat(this.findAllSimplePathsForNodes(t,r[e],[r[n]])));for(n=u=0,g=o.length;0<=g?u<g:u>g;n=0<=g?++u:--u)o.push(o[n].slice(0).reverse());return o},Util.sendGetRequest=function(t){var n;return(n=new XMLHttpRequest).open("GET",t,!1),n.send(null),n.responseText},Util.sendPostRequest=function(t,n,i){var e;return(e=new XMLHttpRequest).open("POST",n,!0),e.setRequestHeader("Content-type","application/json; charset=UTF-8"),e.onload=i,e.send(t)},Util}(),window.gearsketch.Util=e,function(){var t,n,i,e,r;for(t=0,e=0,r=(i=["ms","moz","webkit","o"]).length;e<r;e++)n=i[e],window.requestAnimationFrame||(window.requestAnimationFrame=window[n+"RequestAnimationFrame"],window.cancelAnimationFrame=window[n+"CancelAnimationFrame"]||window[n+"CancelRequestAnimationFrame"]);if(window.requestAnimationFrame||(window.requestAnimationFrame=function(n){var i,e,r;return i=(new Date).getTime(),r=Math.max(0,16-(i-t)),e=window.setTimeout((function(){return n(i+r)}),r),t=i+r,e}),!window.cancelAnimationFrame)window.cancelAnimationFrame=function(t){return clearTimeout(t)}}(),function(){if(null==Function.prototype.name&&null!=Object.defineProperty)Object.defineProperty(Function.prototype,"name",{get:function(){var t;return null!=(t=/function\s([^(]{1,})\(/.exec(this.toString()))&&t.length>1?t[1].trim():""},set:function(t){}})}()}).call(this);