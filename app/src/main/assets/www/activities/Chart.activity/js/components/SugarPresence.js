Vue.component("sugar-presence",{data:function(){return{activity:null,LZString:null,bundleId:"",palette:null,presence:null,isHost:!1}},mounted(){var e=this;requirejs(["sugar-web/activity/activity","sugar-web/env","lz-string"],(function(n,t,r){e.activity=n,e.LZString=r,t.getEnvironment((function(t,r){e.bundleId=r.bundleId,r.sharedId&&console.log("Shared instance"),e.presence=n.getPresenceObject((function(n,t){n&&console.log(n),t.onDataReceived(e.onNetworkDataReceived),t.onSharedActivityUserChanged(e.onNetworkUserChanged)}))}))}))},methods:{isConnected:function(){return null!=this.presence&&this.presence.isConnected()},isShared(){return null!=this.presence&&null!=this.presence.getSharedInfo()},getSharedInfo:function(){return this.presence.getSharedInfo()},getUserInfo:function(){return this.presence.getUserInfo()},sendMessage:function(e){var n=this.LZString.compressToUTF16(JSON.stringify(e));this.presence.sendMessage(this.presence.getSharedInfo().id,n)},onShared:function(e,n){n.popDown();var t=this;console.log("Want to share"),this.presence.createSharedActivity(this.bundleId,(function(e){console.log("Activity shared"),t.isHost=!0}))},onNetworkDataReceived:function(e){var n=JSON.parse(this.LZString.decompressFromUTF16(e));this.getUserInfo().networkId!==n.user.networkId&&this.$emit("data-received",n)},onNetworkUserChanged:function(e){if(this.getUserInfo().networkId===e.user.networkId)return;this.$emit("user-changed",e),console.log("User "+e.user.name+" "+(1==e.move?"joined":"left"));let n=this;if(this.$root.$refs.SugarPopup){let t="";if(this.$root.$refs.SugarL10n){let n="User"+(1==e.move?"Joined":"Left");t=this.$root.$refs.SugarL10n.get(n,{name:e.user.name})}else t="User "+e.user.name+" "+(1==e.move?"joined":"left");this.$root.$refs.SugarIcon?this.$root.$refs.SugarIcon.generateIconWithColors("../icons/owner-icon.svg",e.user.colorvalue).then((e=>{let r='<div style="display: flex; align-items:center;">';r+=`${"<img style='height:40px; margin:10px; vertical-align: middle;' src='"+e+"'>"}`,r+=`<span>${t}</span>`,r+="</div>",n.$root.$refs.SugarPopup.log(r)})):this.$root.$refs.SugarPopup.log(t)}}}});