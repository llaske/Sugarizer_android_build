var thumbframe,mode,tl,thumbcnvs=[],selected=0;function thumbsInit(){tl={x0:20,y0:100,xd:200,yd:200,xn:5},thumbframe.style.width="1024px",thumbframe.style.height="748px",newThumbCanvases(),select(selected)}function newThumbCanvases(){var e,t=tl.y0;for(i=0;i<15;i++){i%tl.xn==0&&(e=tl.x0);var l=newThumbCanvas(e,t);drawThumb(l,gallery[i]),thumbframe.appendChild(l),thumbcnvs.push(l),e+=tl.xd,i%tl.xn==tl.xn-1&&(t+=tl.yd)}}function newThumbCanvas(e,t){var l=document.createElement("canvas");return l.style.position="absolute",l.style.width="176px",l.style.height="147px",l.style.left=e+"px",l.style.top=t+"px",l.width=176,l.height=147,l}function drawThumb(e,t){var l=e.getContext("2d");l.save(),l.fillStyle="lightblue",l.scale(176/720,176/720),l.strokeStyle="#404040",l.lineWidth=1;for(var r=0;r<shapes.length;r++)l.fillStyle=fromColorLetter(t[r]),shapePath(r,l),l.fill();for(r=0;r<shapes.length;r++)shapePath(r,l),l.stroke();l.restore()}function handleThumbStart(e,t){var l=Math.floor((t-tl.y0)/tl.yd)*tl.xn+Math.floor((e-tl.x0)/tl.xd);l<0||l>=15||(select(l),editMode(!0))}function handleRotate(e){var t=window.orientation;90==t||-90==t?(frame.style.width="1024px",frame.style.height="748px",editMode(!0)):(frame.style.width="768px",frame.style.height="1004px",selectorMode(!0))}function editMode(e){mode="edit",thumbframe.style.visibility="hidden",onStart=handleStart,loadPos(selected),changed=!1,e&&saveGallery(),clearbtn.style.display="inline"}function selectorMode(e){mode="selector",thumbframe.style.visibility="visible",onStart=handleThumbStart,changed&&savePos(selected),e&&saveGallery(),clearbtn.style.display="none"}function select(e){thumbcnvs[selected].style.border="0px",thumbcnvs[e].style.border="3px solid black",selected=e}function loadPos(e){for(var t=gallery[e],l=0;l<colors.length;l++)colors[l]=fromColorLetter(t[l]);for(l=0;l<shapes.length;l++)fillPiece(l);for(l=0;l<shapes.length;l++)strokePiece(l)}function savePos(e){var t=posString();drawThumb(thumbcnvs[e],t),gallery[e]=t,saveGallery()}function storedPos(e){for(var t="",l=0;l<colors.length;l++)t+="w";return t}function posString(){for(var e="",t=0;t<colors.length;t++)e+=toColorLetter(colors[t]);return e}function timestamp(){return Math.floor(Date.now()/1e3)}function fromColorLetter(e){return cnames[cletters.indexOf(e)]}function toColorLetter(e){return cletters[cnames.indexOf(e)]}