var Family={template:'\n\t\t<div class="family-detail">\n\t\t\t<div>\n\t\t\t\t<div class="family-goback" id="family-goback" v-on:click="goBack()"></div>\n\t\t\t\t<div class="family-image-container" v-on:click="showImage(place)">\n\t\t\t\t\t<img :src="place.images.full512" class="family-image"/>\n\t\t\t\t</div>\n\t\t\t\t<div id="family-description" class="family-description">\n\t\t\t\t\t<div class="family-income">{{formattedIncome}}</div><div class="family-bymonth">{{"/"+app.$refs.SugarL10n.get("Months_one")}}</div>\n\t\t\t\t\t<div class="family-name">{{capitalizeName}}, {{place.country.name}}</div>\n\t\t\t\t\t<div class="family-content">{{""}}</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div id="family-things" class="family-things">\n\t\t\t\t<div class="flex-container">\n\t\t\t\t\t<street-place ref="things" v-for="(place,index) in things" :place="place" :size="1" :topicMode="true" @place-clicked="showImage(place,index)"></street-place>\n\t\t\t\t</div>\n\t\t\t\t<img id="family-spinner" src="images/spinner-light.gif"/>\n\t\t\t</div>\n\t\t\t<popup ref="imageDialog"></popup>\n\t\t</div>\n\t',components:{"street-place":StreetPlace,popup:Popup},props:{place:{type:Object},things:{type:Array,default:[]}},data:function(){return{}},mounted:function(){let t=this;t.computeSize(),document.getElementById("family-spinner").style.visibility="visible",app.$refs.api.getThingsForPlace(t.place).then((function(e){let i=document.getElementById("family-spinner");if(!i)return;let n=[];for(let t=0;t<e.length;t++)n.push(e[t]);i.style.visibility="hidden",t.things=n,setTimeout((function(){let e=t.$refs.things;if(e){for(let t=0;t<e.length;t++)e[t].visible=!0;_all_things=t.things}}),500)}))},computed:{formattedIncome:function(){return new Intl.NumberFormat(app.$refs.api.language,{style:"currency",currency:"USD",maximumFractionDigits:0,minimumFractionDigits:0}).format(Math.floor(this.place.place.income)).replace("$US","$")},capitalizeName:function(){return _capitalize(this.place.place.slug)}},methods:{computeSize:function(){let t=document.getElementById("body"),e=t.offsetWidth<750;document.getElementById("family-description").style.width=t.offsetWidth-(e?256:512)-100-19+"px",document.getElementById("family-things").style.height=t.offsetHeight-(e?170:341)-20-(app.$refs.SugarToolbar&&app.$refs.SugarToolbar.isHidden()?0:55)+"px"},goBack:function(){let t=this;document.getElementById("family-goback").style.visibility="hidden",setTimeout((function(){t.$emit("back-clicked",t.place)}),0)},showImage:function(t,e=-1){let i=t.images.full2048;_place_to_export=t,_current_index=e;app.$refs.SugarL10n.get("Close");this.$refs.imageDialog.show({content:'\n\t\t\t\t\t<div id=\'popup-container\'>\n\t\t\t\t\t\t<div id="popup-image" class="popup-image" style="background-image:url('+i+')"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<img id="export-image" class="popup-hidden-image" src="'+i+'"/>\n\t\t\t\t\t\t<div id="popup-export" onclick="_image_export()"></div>\n\t\t\t\t\t\t<div id="left" class="place-left" onclick="previousPlace()" style="visibility: hidden;"></div>\n\t\t\t\t\t\t<div id="right" class="place-right" onclick="nextPlace()" style="visibility: hidden;"></div>\n\t\t\t\t\t\t<div class="popup-credit">Photo DollarStreet - licensed under CC BY 4.0</div>\n\t\t\t\t\t</div>',closeHtml:"",closeStyles:{outline:"none",backgroundImage:"url(lib/sugar-web/graphics/icons/actions/dialog-cancel.svg)",backgroundSize:"contain",width:"40px",height:"40px",position:"absolute",top:"5px",right:"5px"},modalStyles:{backgroundColor:"white",maxHeight:"90%",height:"90%",width:"90%",maxWidth:"90%"}})}}};function _capitalize(t){return t.replace(/-/g," ").replace(/\b\w/g,(function(t){return t.toUpperCase()}))}var _current_index=null,_all_things=null;function previousPlace(){_current_index==_all_things.length-1&&(document.getElementById("right").style.visibility="visible");let t=_current_index-=1,e=_all_things[t].images.full2048;0==t&&(document.getElementById("left").style.visibility="hidden"),document.getElementById("popup-image").style.backgroundImage="url("+e+")"}function nextPlace(){0==_current_index&&(document.getElementById("left").style.visibility="visible");let t=_current_index+=1,e=_all_things[t].images.full2048;t==_all_things.length-1&&(document.getElementById("right").style.visibility="hidden"),document.getElementById("popup-image").style.backgroundImage="url("+e+")"}var _place_to_export=null;function _image_export(){let t=_place_to_export,e=app.$refs.api.getThingByTopic(t.topics[0]),i=_capitalize(t.place.slug)+" - "+e.thingName;var n=document.getElementById("export-image"),l=document.createElement("canvas"),a=l.getContext("2d");l.width=2048,l.height=1365,a.drawImage(n,0,0,l.width,l.height);var c=l.toDataURL("image/jpg"),o={mimetype:"image/jpg",title:i,activity:"org.olpcfrance.MediaViewerActivity",timestamp:(new Date).getTime(),creation_time:(new Date).getTime(),file_size:0};app.$refs.SugarJournal.createEntry(c,o).then((function(){app.$refs.popup.log(app.$refs.SugarL10n.get("ImageExported"))}))}