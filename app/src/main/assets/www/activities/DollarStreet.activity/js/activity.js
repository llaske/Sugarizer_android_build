requirejs.config({baseUrl:"lib",paths:{activity:"../js"}});const viewList=1,viewDetail=2;var app=new Vue({el:"#app",components:{"street-place":StreetPlace,"family-detail":Family},data:{places:[],currentView:1,currentPlace:null,currentThing:"families",currentRegion:null,currentMinIncome:0,currentMaxIncome:0,placeSize:2,timerId:null,timerData:null,scroll:{top:0,left:0},SugarL10n:null,l10n:{stringIncomePalette:"",stringWorldButton:"",stringFamilyButton:"",stringThingsButton:"",stringClose:"",stringImageExported:"",stringNoDescription:"",stringNoMatchingPlace:"",stringWorld:"",stringAsia:"",stringEurope:"",stringAfrica:"",stringTheAmericas:"",stringbedrooms:"",stringfloors:"",stringhands:"",stringpets:"",stringtoilets:"",stringteeth:"",stringtoys:"",stringhomes:"",stringstoves:"",stringTutoListWelcomeTitle:"",stringTutoListWelcomeContent:"",stringTutoListIncomeTitle:"",stringTutoListIncomeContent:"",stringTutoListFamilyTitle:"",stringTutoListFamilyContent:"",stringTutoListThingsTitle:"",stringTutoListThingsContent:"",stringTutoListRegionTitle:"",stringTutoListRegionContent:"",stringTutoListPlaceTitle:"",stringTutoListPlaceContent:"",stringTutoDetailViewTitle:"",stringTutoDetailViewContent:"",stringTutoDetailImageTitle:"",stringTutoDetailImageContent:"",stringTutoDetailDescriptionTitle:"",stringTutoDetailDescriptionContent:"",stringTutoDetailThingsTitle:"",stringTutoDetailThingsContent:"",stringTutoDetailBackTitle:"",stringTutoDetailBackContent:""}},created(){this.computeSize(),window.addEventListener("resize",this.computeSize)},mounted:function(){this.SugarL10n=this.$refs.SugarL10n},updated:function(){this.updateVisibility()},methods:{localized:function(){this.SugarL10n.localize(this.l10n)},fullscreen:function(){this.$refs.SugarToolbar.hide(),this.computeSize()},unfullscreen:function(){this.$refs.SugarToolbar.show(),this.computeSize()},displayThings:function(){let t=this;t.places=[],document.getElementById("spinner").style.visibility="visible",t.$refs.api.getStreetPlaces(t.currentThing,t.currentRegion,t.currentMinIncome,t.currentMaxIncome).then((function(e){document.getElementById("spinner").style.visibility="hidden",t.places=e,document.getElementById("nomatchingplace").style.visibility=t.places.length?"hidden":"visible",document.getElementById("nomatchingtext").style.visibility=t.places.length?"hidden":"visible"}))},familyClicked:function(){this.currentThing="families",this.displayThings()},onThingSelected:function(t){let e=this,i=t.detail.value,n=e.$refs.api.encodeTopic(i.originPlural);e.currentThing=n,e.displayThings()},onScrolled:function(){this.updateVisibility()},onRegionSelected:function(t){this.currentRegion=t.detail.value,this.displayThings()},onIncomeChanged:function(t){let e=this;e.timerId&&clearTimeout(e.timerId),e.timerId=setTimeout((function(){e.currentMinIncome=t.detail.min,e.currentMaxIncome=t.detail.max,e.displayThings(),e.timerId=null}),1e3)},onPlaceClicked:function(t){let e=this;e.currentView=2,e.currentPlace=t;let i=document.getElementById("content");e.scroll={left:i.scrollLeft,top:i.scrollTop}},onBackClicked:function(t){let e=this;e.currentView=1,e.currentPlace=null,setTimeout((function(){let t=document.getElementById("content");t.scrollLeft=e.scroll.left,t.scrollTop=e.scroll.top}),500)},onStop:function(){let t=this,e={currentMinIncome:t.currentMinIncome,currentMaxIncome:t.currentMaxIncome,currentThing:t.currentThing,currentRegion:t.currentRegion};t.$refs.SugarJournal.saveData(e)},onJournalDataLoaded:function(t,e){let i=this;this.$refs.api.initialize().then((function(){console.log("Dollar Street API connected");i.$refs.api.getStreetSettings();i.currentMinIncome=t.currentMinIncome,i.currentMaxIncome=t.currentMaxIncome,i.currentThing=t.currentThing,i.currentRegion=t.currentRegion,i.displayThings(),i.updateVisibility()})).catch((function(){console.log("Dollar Street API Error !"),document.getElementById("spinner").style.visibility="hidden",document.getElementById("cloudwarning").style.visibility="visible"}))},onJournalNewInstance:function(){let t=this;this.$refs.api.initialize().then((function(){console.log("Dollar Street API connected");let e=t.$refs.api.getStreetSettings();t.currentMinIncome=e.poor,t.currentMaxIncome=e.rich,t.displayThings(),t.updateVisibility()})).catch((function(){console.log("Dollar Street API Error !"),document.getElementById("spinner").style.visibility="hidden",document.getElementById("cloudwarning").style.visibility="visible"}))},onHelp:function(){let t=this,e=[];e=1==t.currentView?e.concat([{orphan:!0,position:"bottom",title:t.l10n.stringTutoListWelcomeTitle,intro:t.l10n.stringTutoListWelcomeContent},{element:"#street-button",position:"bottom",title:t.l10n.stringTutoListIncomeTitle,intro:t.l10n.stringTutoListIncomeContent},{element:"#family-button",position:"bottom",title:t.l10n.stringTutoListFamilyTitle,intro:t.l10n.stringTutoListFamilyContent},{element:"#things-button",position:"bottom",title:t.l10n.stringTutoListThingsTitle,intro:t.l10n.stringTutoListThingsContent},{element:"#world-button",position:"bottom",title:t.l10n.stringTutoListRegionTitle,intro:t.l10n.stringTutoListRegionContent},{element:".place-padding",position:"right",title:t.l10n.stringTutoListPlaceTitle,intro:t.l10n.stringTutoListPlaceContent}]):e.concat([{orphan:!0,position:"bottom",title:t.l10n.stringTutoDetailViewTitle,intro:t.l10n.stringTutoDetailViewContent},{element:".family-image-container",position:"right",title:t.l10n.stringTutoDetailImageTitle,intro:t.l10n.stringTutoDetailImageContent},{element:"#family-description",position:"left",title:t.l10n.stringTutoDetailDescriptionTitle,intro:t.l10n.stringTutoDetailDescriptionContent},{element:".place-padding",position:"top",title:t.l10n.stringTutoDetailThingsTitle,intro:t.l10n.stringTutoDetailThingsContent},{element:"#family-goback",position:"right",title:t.l10n.stringTutoDetailBackTitle,intro:t.l10n.stringTutoDetailBackContent}]),app.$refs.SugarTutorial.show(e)},updateVisibility:function(){let t=this;if(2!=t.currentView)for(let e=0;e<t.places.length;e++){let i=t.$refs.places[e];i.isVisible()&&(i.visible=!0)}},computeSize:function(){let t=this,e=document.getElementById("body"),i=e.offsetHeight-(t.$refs.SugarToolbar&&t.$refs.SugarToolbar.isHidden()?0:55);if(document.getElementById("content").style.height=i+"px",1==t.currentView){t.placeSize=e.offsetWidth<700||e.offsetHeight<700?1:2;for(let e=0;e<t.places.length;e++){let i=t.$refs.places[e];i.size=t.placeSize,i.isVisible()&&(i.visible=!0)}}else this.$refs.family.computeSize()}}});