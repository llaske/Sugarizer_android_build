requirejs.config({baseUrl:"lib",paths:{activity:"../js"}});const viewList=1,viewDetail=2;var app=new Vue({el:"#app",components:{"street-place":StreetPlace,"family-detail":Family},data:{places:[],currentView:1,currentPlace:null,currentThing:"families",currentRegion:null,currentMinIncome:0,currentMaxIncome:0,placeSize:2,timerId:null,timerData:null,scroll:{top:0,left:0},SugarL10n:null,l10n:{stringIncomePalette:"",stringWorldButton:"",stringFamilyButton:"",stringThingsButton:"",stringClose:"",stringImageExported:"",stringNoDescription:"",stringNoMatchingPlace:"",stringTutoListWelcomeTitle:"",stringTutoListWelcomeContent:"",stringTutoListIncomeTitle:"",stringTutoListIncomeContent:"",stringTutoListFamilyTitle:"",stringTutoListFamilyContent:"",stringTutoListThingsTitle:"",stringTutoListThingsContent:"",stringTutoListRegionTitle:"",stringTutoListRegionContent:"",stringTutoListPlaceTitle:"",stringTutoListPlaceContent:"",stringTutoDetailViewTitle:"",stringTutoDetailViewContent:"",stringTutoDetailImageTitle:"",stringTutoDetailImageContent:"",stringTutoDetailDescriptionTitle:"",stringTutoDetailDescriptionContent:"",stringTutoDetailThingsTitle:"",stringTutoDetailThingsContent:"",stringTutoDetailBackTitle:"",stringTutoDetailBackContent:""}},created(){this.computeSize(),window.addEventListener("resize",this.computeSize)},mounted:function(){this.SugarL10n=this.$refs.SugarL10n},updated:function(){this.updateVisibility()},methods:{localized:function(){this.SugarL10n.localize(this.l10n)},fullscreen:function(){this.$refs.SugarToolbar.hide(),this.computeSize()},unfullscreen:function(){this.$refs.SugarToolbar.show(),this.computeSize()},displayThings:function(){let t=this;t.places=[],document.getElementById("spinner").style.visibility="visible",t.$refs.api.getStreetPlaces(t.currentThing,t.currentRegion,t.currentMinIncome,t.currentMaxIncome).then((function(e){document.getElementById("spinner").style.visibility="hidden",t.places=e,document.getElementById("nomatchingplace").style.visibility=t.places.length?"hidden":"visible",document.getElementById("nomatchingtext").style.visibility=t.places.length?"hidden":"visible"}))},familyClicked:function(){this.currentThing="families",this.displayThings()},onThingSelected:function(t){let e=t.detail.value,n=this.$refs.api.encodeTopic(e.originPlural);this.currentThing=n,this.displayThings()},onScrolled:function(){this.updateVisibility()},onRegionSelected:function(t){this.currentRegion=t.detail.value,this.displayThings()},onIncomeChanged:function(t){let e=this;e.timerId&&clearTimeout(e.timerId),e.timerId=setTimeout((function(){e.currentMinIncome=t.detail.min,e.currentMaxIncome=t.detail.max,e.displayThings(),e.timerId=null}),1e3)},onPlaceClicked:function(t){this.currentView=2,this.currentPlace=t;let e=document.getElementById("content");this.scroll={left:e.scrollLeft,top:e.scrollTop}},onBackClicked:function(t){let e=this;e.currentView=1,e.currentPlace=null,setTimeout((function(){let t=document.getElementById("content");t.scrollLeft=e.scroll.left,t.scrollTop=e.scroll.top}),500)},onStop:function(){let t=this,e={currentMinIncome:t.currentMinIncome,currentMaxIncome:t.currentMaxIncome,currentThing:t.currentThing,currentRegion:t.currentRegion};t.$refs.SugarJournal.saveData(e)},onJournalDataLoaded:function(t,e){let n=this;this.$refs.api.initialize().then((function(){console.log("Dollar Street API connected");n.$refs.api.getStreetSettings();n.currentMinIncome=t.currentMinIncome,n.currentMaxIncome=t.currentMaxIncome,n.currentThing=t.currentThing,n.currentRegion=t.currentRegion,n.displayThings(),n.updateVisibility()})).catch((function(){console.log("Dollar Street API Error !"),document.getElementById("spinner").style.visibility="hidden",document.getElementById("cloudwarning").style.visibility="visible"}))},onJournalNewInstance:function(){let t=this;this.$refs.api.initialize().then((function(){console.log("Dollar Street API connected");let e=t.$refs.api.getStreetSettings();t.currentMinIncome=e.poor,t.currentMaxIncome=e.rich,t.displayThings(),t.updateVisibility()})).catch((function(){console.log("Dollar Street API Error !"),document.getElementById("spinner").style.visibility="hidden",document.getElementById("cloudwarning").style.visibility="visible"}))},onHelp:function(){let t=this,e=[],n=document.getElementsByClassName("place-padding"),i=n&&n[0]?n[0]:"";e=1==t.currentView?e.concat([{element:"",orphan:!0,placement:"bottom",title:t.l10n.stringTutoListWelcomeTitle,content:t.l10n.stringTutoListWelcomeContent},{element:"#street-button",placement:"bottom",title:t.l10n.stringTutoListIncomeTitle,content:t.l10n.stringTutoListIncomeContent},{element:"#family-button",placement:"bottom",title:t.l10n.stringTutoListFamilyTitle,content:t.l10n.stringTutoListFamilyContent},{element:"#things-button",placement:"bottom",title:t.l10n.stringTutoListThingsTitle,content:t.l10n.stringTutoListThingsContent},{element:"#world-button",placement:"bottom",title:t.l10n.stringTutoListRegionTitle,content:t.l10n.stringTutoListRegionContent},{element:i,placement:"right",title:t.l10n.stringTutoListPlaceTitle,content:t.l10n.stringTutoListPlaceContent}]):e.concat([{element:"",orphan:!0,placement:"bottom",title:t.l10n.stringTutoDetailViewTitle,content:t.l10n.stringTutoDetailViewContent},{element:".family-image-container",placement:"right",title:t.l10n.stringTutoDetailImageTitle,content:t.l10n.stringTutoDetailImageContent},{element:"#family-description",placement:"left",title:t.l10n.stringTutoDetailDescriptionTitle,content:t.l10n.stringTutoDetailDescriptionContent},{element:i,placement:"top",title:t.l10n.stringTutoDetailThingsTitle,content:t.l10n.stringTutoDetailThingsContent},{element:"#family-goback",placement:"right",title:t.l10n.stringTutoDetailBackTitle,content:t.l10n.stringTutoDetailBackContent}]),app.$refs.SugarTutorial.show(e)},updateVisibility:function(){let t=this;if(2!=t.currentView)for(let e=0;e<t.places.length;e++){let n=t.$refs.places[e];n.isVisible()&&(n.visible=!0)}},computeSize:function(){let t=this,e=document.getElementById("body"),n=e.offsetHeight-(t.$refs.SugarToolbar&&t.$refs.SugarToolbar.isHidden()?0:55);if(document.getElementById("content").style.height=n+"px",1==t.currentView){t.placeSize=e.offsetWidth<700||e.offsetHeight<700?1:2;for(let e=0;e<t.places.length;e++){let n=t.$refs.places[e];n.size=t.placeSize,n.isVisible()&&(n.visible=!0)}}else this.$refs.family.computeSize()}}});