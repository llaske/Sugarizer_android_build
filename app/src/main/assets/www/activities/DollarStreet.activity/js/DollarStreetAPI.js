const dsUrl="https://ds-dev.dollarstreet.org/dollar-street/v1/",dsApi="https://api.dollarstreet.org/v1/",dsLanguages="languagesList",dsLanguage="language?lang=",dsStreetSettings="street-settings",dsRegions="countries-filter?thing=Families&countries=World&regions=World&lang=",dsThings="things-filter?thing=Families&countries=World&regions=World&lang=",dsFamilies="search/families?featuredOnly=false&pageSize=1000&lng=";function _dsAPIGet(t){return new Promise((function(e,n){axios.get(dsUrl+t).then((function(t){e(t.data.data)})).catch((function(t){n(t)}))}))}function _loadIcon(t){return new Promise((function(e,n){axios.get("https:"+t).then((function(t){e(t.data.replace(/#2C4351/g,"#FFFFFF"))})).catch((function(t){n(t)}))}))}Vue.component("dollarstreet-api",{name:"DollarStreetAPI",data:function(){return{language:"en",l10n:{},streetSettings:{},regions:[],things:[],popularThings:[],familyThing:{}}},methods:{initialize:function(){let t=this;return new Promise((function(e,n){_dsAPIGet(dsLanguages).then((function(i){requirejs(["sugar-web/env"],(function(s){s.getEnvironment((function(s,o){var g=navigator.language,l=o.user?o.user.language:g;for(let e=0;e<i.length;e++)if(0==i[e].code.indexOf(l)){t.language=i[e].code;break}Promise.all([_dsAPIGet(dsLanguage+t.language),_dsAPIGet(dsStreetSettings),_dsAPIGet(dsRegions+t.language),_dsAPIGet(dsThings+t.language)]).then((function(n){t.l10n=n[0],t.streetSettings=n[1],t.regions=n[2],t.things=n[3].otherThings,t.familyThing=n[3].thing,t.popularThings=n[3].popularThings;let i=[];for(let e=0;e<t.things.length;e++){let n=t.things[e];i.push(_loadIcon(n.icon))}Promise.all(i).then((function(n){for(let e=0;e<t.things.length;e++)t.things[e].svg=n[e];e()}))})).catch((function(t){n()}))}))}))})).catch((function(t){n()}))}))},encodeTopic:function(t){return t.toLowerCase().replace(/ /g,"-").replace(/,/g,"")},getL10n:function(t){return this.l10n[t]},getRegions:function(){return this.regions},getThings:function(){return this.things},getPopularThings:function(){return this.popularThings},getStreetSettings:function(){return this.streetSettings},getThingById:function(t){let e=this;for(let n=0;n<e.things.length;n++){let i=e.things[n];if(i._id==t)return i}return null},getThingByTopic:function(t){let e=this,n=e.encodeTopic(t);for(let t=0;t<e.things.length;t++){let i=e.things[t];if(e.encodeTopic(i.originPlural)==n)return i}return null},getFamily:function(){return this.familyThing},getStreetPlaces:function(t="families",e=null,n=0,i=0){let s=this.language;return"en"==s&&(s="cs"),new Promise((function(o,g){let l=e?"&regions="+e:"",r=n?"&min="+n:"",a=i?"&max="+i:"";axios.get(dsApi+dsFamilies+s+"&topic="+t+l+r+a).then((function(t){let e=t.data.hits[4],n=[];for(let t=0;t<e.length;t++){let i=e[t];i.media_type&&"video"==i.media_type||n.push(i)}o(n)})).catch((function(t){g(t)}))}))},getThingsForPlace:function(t){let e=this,n=e.language;"en"==n&&(n="cs");let i=t.place.id,s=Math.floor(t.place.income),o="&regions="+t.region.id,g="&min="+(s-1),l="&max="+(s+1),r=[];for(let t=0;t<e.things.length;t++){let s=e.encodeTopic(e.things[t].originPlural);r.push(new Promise((function(t,e){axios.get(dsApi+dsFamilies+n+"&topic="+s+o+g+l).then((function(e){let n=e.data.hits[4],s=[];for(let t=0;t<n.length;t++){let e=n[t];e.place.id!=i||e.media_type&&"video"==e.media_type||s.push(e)}t(s)})).catch((function(t){e(t)}))})))}return new Promise((function(t,e){Promise.all(r).then((function(e){let n=[];for(let t=0;t<e.length;t++){let i=e[t];for(let t=0;t<i.length;t++)n.push(i[t])}t(n)})).catch((function(t){e(t)}))})).catch((function(t){reject(t)}))}}});