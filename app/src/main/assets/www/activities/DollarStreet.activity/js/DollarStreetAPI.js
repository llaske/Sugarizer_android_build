const dsApi="https://api.dollarstreet.org/v1/",dsLanguages="data/languages.json",dsStreetSettings="data/street-settings.json",dsThings="data/things.json",dsFamilies="search/families?featuredOnly=false&pageSize=1000&lng=";function _dsAPIGet(t){return new Promise((function(n,e){axios.get(t).then((function(t){n(t.data)})).catch((function(t){e(t)}))}))}function _loadIcon(t){return new Promise((function(n,e){axios.get("icons/"+t+".svg").then((function(t){n(t.data)})).catch((function(t){e(t)}))}))}Vue.component("dollarstreet-api",{name:"DollarStreetAPI",data:function(){return{language:"en",streetSettings:{},things:[],popularThings:[],familyThing:{}}},methods:{initialize:function(){let t=this;return new Promise((function(n,e){_dsAPIGet(dsLanguages).then((function(i){requirejs(["sugar-web/env"],(function(o){o.getEnvironment((function(o,s){var a=navigator.language,l=s.user?s.user.language:a;for(let n=0;n<i.length;n++)if(0==i[n].code.indexOf(l)){t.language=i[n].code;break}Promise.all([_dsAPIGet(dsStreetSettings),_dsAPIGet(dsThings)]).then((function(e){t.streetSettings=e[0],t.things=e[1].otherThings,t.familyThing=e[1].thing,t.popularThings=e[1].popularThings;let i=[];for(let n=0;n<t.things.length;n++){let e=t.things[n];i.push(_loadIcon(e.originPlural))}Promise.all(i).then((function(e){for(let n=0;n<t.things.length;n++)t.things[n].svg=e[n];n()}))})).catch((function(t){e()}))}))}))})).catch((function(t){e()}))}))},encodeTopic:function(t){return t.toLowerCase().replace(/ /g,"-").replace(/,/g,"")},getThings:function(){return this.things},getPopularThings:function(){return this.popularThings},getStreetSettings:function(){return this.streetSettings},getThingById:function(t){let n=this;for(let e=0;e<n.things.length;e++){let i=n.things[e];if(i._id==t)return i}return null},getThingByTopic:function(t){let n=this,e=n.encodeTopic(t);for(let t=0;t<n.things.length;t++){let i=n.things[t];if(n.encodeTopic(i.originPlural)==e)return i}return null},getFamily:function(){return this.familyThing},getStreetPlaces:function(t="families",n=null,e=0,i=0){let o=this.language;return new Promise((function(s,a){let l=n?"&regions="+n:"",r=e?"&min="+e:"",g=i?"&max="+i:"";axios.get(dsApi+dsFamilies+o+"&topic="+t+l+r+g).then((function(t){let n=t.data.hits[4],e=[];for(let t=0;t<n.length;t++){let i=n[t];i.media_type&&"video"==i.media_type||e.push(i)}s(e)})).catch((function(t){a(t)}))}))},getThingsForPlace:function(t){let n=this,e=t.place.id,i=Math.floor(t.place.income),o="&regions="+t.region.id,s="&min="+(i-1),a="&max="+(i+1),l=[];for(let t=0;t<n.things.length;t++){let i=n.encodeTopic(n.things[t].originPlural);l.push(new Promise((function(t,l){axios.get(dsApi+dsFamilies+n.language+"&topic="+i+o+s+a).then((function(n){let i=n.data.hits[4],o=[];for(let t=0;t<i.length;t++){let n=i[t];n.place.id!=e||n.media_type&&"video"==n.media_type||o.push(n)}t(o)})).catch((function(t){l(t)}))})))}return new Promise((function(t,n){Promise.all(l).then((function(n){let e=[];for(let t=0;t<n.length;t++){let i=n[t];for(let t=0;t<i.length;t++)e.push(i[t])}t(e)})).catch((function(t){n(t)}))})).catch((function(t){reject(t)}))}}});