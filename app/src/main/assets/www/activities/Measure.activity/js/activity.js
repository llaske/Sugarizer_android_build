requirejs.config({baseUrl:"lib",paths:{activity:"../js"}});var app=new Vue({el:"#app",data:{currentenv:null,SugarL10n:null,SugarPresence:null,canvas:"",context:"",analyser:"",processor:"",webAudio_mediaStreamSource:"",time_domain:!0,timeDomainData:[],play:!0,time_div:5e-4,num_of_samples_time:1024,num_of_divs:20,freq_div:500,fftSize:4096,freqDomainData:[],num_of_samples_freq:4096,existing_instance_time_data:[],existing_instance_freq_data:[],fullscreen:!1,time_int_arr:[],invert_waveform:!1,amp_value:1,log_interval:.1,is_recording:!1,setInterval_id:null,log_data:[],log_session_obj:{mode:"",interval:0,date:"",data:[]},trigEdge:0,instrument_data:{guitar:{notes:{E1:82.4069,A2:110,D2:146.832,G2:195.998,B3:246.942,E3:329.628}},violin:{notes:{G2:195.998,D3:293.665,A4:440,E4:659.255}},viola:{notes:{C2:130.813,G2:195.998,D3:293.665,A4:440}},cello:{notes:{C1:65.4064,G1:97.9989,D2:146.832,A3:220}},bass:{notes:{E0:41.2034,A1:55,D1:73.4162,G1:97.9989}},charango:{notes:{E3:329.63,G3:392,A4:440,C4:523.25,E4:659.26}},cavaquinho:{notes:{D3:293.665,G3:391.995,B4:493.883,D4:587.33}},ukulele:{notes:{C3:261.626,E3:329.628,G3:391.995,A4:440}},sitar:{notes:{F2:174.614,C2:130.813,G2:195.998,C1:65.4064,G3:391.995,C3:261.626,C4:523.251}},mandolin:{notes:{G2:195.998,D3:293.665,A4:440,E4:659.255}}},draw_note:!1,note_index:-2,note_freq:0,instrument_name:"none",note_name:"all",notes_arr:["A","A♯/B♭","B","C","C♯/D♭","D","D♯/E♭","E","F","F♯/G♭","G","G♯/A♭"],colors:["#B20008","#00588C","#F8E800","#7F00BF","#4BFF3A","#FFA109","#00A0FF","#BCCEFF","#008009","#F8E800","#AC32FF","#FFFFFF"],harmonic_colors:["#b54e52","#4a7187","#d4cc63","#a568c4","#89ed80","#edbd6f","#8ac8ed","#d7e0f7","#558558","#f2ed9b","#d4a4f5","#e6e3e3"],show_harmonics:!1,show_tuning_line:!1,play_note:!1,tone_osc:null,freq_input_note_index:0,freq_input_octave:4,A0:27.5,TWELTHROOT2:1.05946309435929,C8:4186.01,existing_instance:!1,existing_instrument_settings:{},shared_instance:!1,shared_mode_initialised:!1,l10n:{stringPlay:"",stringPause:"",stringTimeDomain:"",stringFreqDomain:"",stringZoomInOut:"",stringFullScreen:"",stringUnFullScreen:"",stringWaveformSettings:"",stringExportSettings:"",stringLoggingInterval:"",stringRecordOff:"",stringRecordOn:"",stringCaptureImage:"",stringSelectInstrument:"",stringSelectNote:"",stringSelectOctave:"",stringTuningSettings:"",stringTutoExplainTitle:"",stringTutoExplainContent:"",stringTutoTimeFreqTitle:"",stringTutoTimeFreqContent:"",stringTutoZoomSettingsTitle:"",stringTutoZoomSettingsContent:"",stringTutoPlayPauseTitle:"",stringTutoPlayPauseContent:"",stringTutoAmplitudeTitle:"",stringTutoAmplitudeContent:"",stringTutoWaveformInversionTitle:"",stringTutoWaveformInversionContent:"",stringTutoTriggeringEdgeTitle:"",stringTutoTriggeringEdgeContent:"",stringTutoLoggingExplainTitle:"",stringTutoLoggingExplainContent:"",stringTutoLoggingIntervalTitle:"",stringTutoLoggingIntervalContent:"",stringTutoStartStopTitle:"",stringTutoStartStopContent:"",stringTutoExportLoggingPDFTitle:"",stringTutoExportLoggingPDFContent:"",stringTutoExportLoggingCSVTitle:"",stringTutoExportLoggingCSVContent:"",stringTutoInstrumentExplainTitle:"",stringTutoInstrumentExplainContent:"",stringTutoInstrumentSelectTitle:"",stringTutoInstrumentSelectContent:"",stringTutoNoteSelectTitle:"",stringTutoNoteSelectContent:"",stringTutoOctaveSelectTitle:"",stringTutoOctaveSelectContent:"",stringTutoShowHarmonicsTitle:"",stringTutoShowHarmonicsContent:"",stringTutoTuningFreqInputTitle:"",stringTutoTuningFreqInputContent:"",stringTutoTuningLineTitle:"",stringTutoTuningLineContent:"",stringTutoPlayStopNoteTitle:"",stringTutoPlayStopNoteContent:"",stringTutoCaptureWaveformTitle:"",stringTutoCaptureWaveformContent:""}},methods:{initialized:function(){this.currentenv=this.$refs.SugarActivity.getEnvironment()},localized:function(){for(var t in this.freq_base_string=this.SugarL10n.get("FrequencyBase"),this.time_base_string=this.SugarL10n.get("TimeBase"),document.getElementById("axis").innerText=this.SugarL10n.get("axisString"),document.getElementById("scale").innerText=this.SugarL10n.get("scaleString"),document.getElementById("division").innerText=this.SugarL10n.get("divisionString"),this.time_domain?(document.getElementById("domainName").innerText=this.time_base_string,document.getElementById("scaleValue").innerText=(1e3*this.time_div).toFixed(2)+" ms",this.setZoomSlider()):(document.getElementById("domainName").innerText=this.freq_base_string,document.getElementById("scaleValue").innerText=this.freq_div+" Hz",this.setZoomSlider()),document.getElementById("zoom-in-button").title=this.SugarL10n.get("zoomIn"),document.getElementById("zoom-out-button").title=this.SugarL10n.get("zoomOut"),document.getElementById("amp-low-button").title=this.SugarL10n.get("decreaseAmp"),document.getElementById("amp-high-button").title=this.SugarL10n.get("increaseAmp"),document.getElementById("invert-on-button").title=this.SugarL10n.get("InvertWaveform"),document.getElementById("invert-off-button").title=this.SugarL10n.get("NormalWaveform"),document.getElementById("AmpTitle").innerText=this.SugarL10n.get("AmpTitle"),document.getElementById("WaveformTitle").innerText=this.SugarL10n.get("WaveformTitle"),document.getElementById("csv-export").title=this.SugarL10n.get("exportAsCSV"),document.getElementById("pdf-export").title=this.SugarL10n.get("exportAsPDF"),document.getElementById("harmonics-on-button").title=this.SugarL10n.get("ShowHarmonicsTitle"),document.getElementById("harmonics-off-button").title=this.SugarL10n.get("HideHarmonicsTitle"),document.getElementById("triggering-edge-none-button").title=this.SugarL10n.get("None"),document.getElementById("triggering-edge-rising-button").title=this.SugarL10n.get("RisingEdge"),document.getElementById("triggering-edge-falling-button").title=this.SugarL10n.get("FallingEdge"),document.getElementById("TriggeringEdgeTitle").innerText=this.SugarL10n.get("TriggeringEdge"),0==this.trigEdge?document.getElementById("TrigEdgeType").innerText=this.SugarL10n.get("None"):1==this.trigEdge?document.getElementById("TrigEdgeType").innerText=this.SugarL10n.get("RisingEdge"):document.getElementById("TrigEdgeType").innerText=this.SugarL10n.get("FallingEdge"),app.instrument_data)document.getElementById(`${t}_instrument`).innerText=this.SugarL10n.get(t);document.getElementById("none").innerText=this.SugarL10n.get("None");for(var e=this.notes_arr.length,i=0;i<e;i++)document.getElementById(`note_${i}`).innerText=this.SugarL10n.get(this.notes_arr[i]);document.getElementById("tuning-line-on-button").title=this.SugarL10n.get("ShowTuningLine"),document.getElementById("tuning-line-off-button").title=this.SugarL10n.get("HideTuningLine"),document.getElementById("play-note-button").title=this.SugarL10n.get("playTitle"),document.getElementById("stop-note-button").title=this.SugarL10n.get("stopTitle"),document.getElementById("interval-0.1").innerText=this.SugarL10n.get("IntervalSecond",{interval:"1/10"}),document.getElementById("interval-1").innerText=this.SugarL10n.get("IntervalSecond",{interval:1}),document.getElementById("interval-30").innerText=this.SugarL10n.get("IntervalSecond",{interval:30}),document.getElementById("interval-300").innerText=this.SugarL10n.get("IntervalMinute",{interval:5}),this.SugarL10n.localize(this.l10n)},init:function(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight-55-document.getElementById("axisScale").clientHeight,window.addEventListener("resize",(()=>{this.resizeCanvas()})),this.drawGrid()},resizeCanvas:function(t=55){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight-t-document.getElementById("axisScale").clientHeight,this.calcTimeDomainData(),this.calcFreqDomainData()},fullscreenOrUnfullscreen:function(){this.fullscreen=!this.fullscreen,this.fullscreen?(document.getElementById("main-toolbar").style.height="0px",document.getElementById("unfullscreen-button").style.display="initial",document.getElementById("fullscreen-button").style.display="none",this.resizeCanvas(0)):(document.getElementById("main-toolbar").style.height="55px",document.getElementById("unfullscreen-button").style.display="none",document.getElementById("fullscreen-button").style.display="initial",this.resizeCanvas())},createAnalyserNode:function(t,e){this.context=new(window.AudioContext||window.webkitAudioContext),this.source=this.context.createMediaStreamSource(t),this.analyser=this.context.createAnalyser(),this.analyser.smoothingTimeConstant=0,this.analyser.fftSize=e,this.processor=this.context.createScriptProcessor(this.analyser.fftSize,1,1),this.timeDomainData=new Float32Array(this.analyser.fftSize),this.time_int_arr=new Uint8Array(this.analyser.fftSize),this.source.connect(this.analyser),this.analyser.connect(this.processor),this.processor.connect(this.context.destination)},calcTimeDomainData:function(){this.num_of_divs=this.canvas.width/50;var t=this.time_div*this.num_of_divs;this.num_of_samples_time=Math.ceil(48e3*t),this.drawWaveform()},calcFreqDomainData:function(){this.num_of_divs=this.canvas.width/50;var t=this.freq_div*this.num_of_divs;this.freqDomainData=[];for(var e=0;e<this.fftSize;e++)this.timeDomainData[e]?this.freqDomainData.push(this.timeDomainData[e]):this.freqDomainData.push(0);var i=[];for(e=0;e<this.fftSize;e++)i.push(0);transform(this.freqDomainData,i);for(e=0;e<this.fftSize;e++)this.freqDomainData[e]=Math.min(100,Math.sqrt(Math.pow(this.freqDomainData[e],2)+Math.pow(i[e],2)));window.cordova||window.PhoneGap?this.num_of_samples_freq=t/44:this.num_of_samples_freq=t/12,this.drawWaveform()},getWebAudioTimeData:function(){if(this.analyser.getFloatTimeDomainData)this.analyser.getFloatTimeDomainData(this.timeDomainData);else{this.analyser.getByteTimeDomainData(this.time_int_arr),this.timeDomainData=[];for(var t=0;t<this.fftSize;t++){var e=.0078125*(this.time_int_arr[t]-128);this.timeDomainData.push(e)}}},setTimeDomain:function(){this.processor.addEventListener("audioprocess",(t=>{this.play&&(this.getWebAudioTimeData(),this.calcTimeDomainData())}))},setFreqDomain:function(){this.processor.addEventListener("audioprocess",(t=>{this.play&&(this.getWebAudioTimeData(),this.calcFreqDomainData())}))},drawWaveform:function(){var t=this.canvas.getContext("2d");this.drawGrid(),t.lineWidth=3,t.strokeStyle="red",t.beginPath();var e=0,i=this.time_domain?this.num_of_samples_time:this.num_of_samples_freq,n=0,s=1*this.canvas.width/(i-1),o=!1;if(!this.time_domain&&this.draw_note)if(-1==this.note_index){var a=this.instrument_data[this.instrument_name].notes,r=0;for(var l in a){var d=a[l],m=50/this.freq_div*d;if(t.fillStyle=this.colors[r],t.fillRect(m,this.canvas.height,2,-1*this.canvas.height),this.show_harmonics){t.fillStyle=this.harmonic_colors[r];for(var g=0;g<3;g++){var u=(g+2)*m;t.fillRect(u,this.canvas.height,2,-1*(this.canvas.height-50*(g+1)))}}r++}}else{var h=50/this.freq_div*this.note_freq;if(t.fillStyle=this.colors[this.note_index],t.fillRect(h,this.canvas.height,2,-1*this.canvas.height),this.show_harmonics){t.fillStyle=this.harmonic_colors[this.note_index];for(l=0;l<3;l++){m=(l+2)*h;t.fillRect(m,this.canvas.height,2,-1*(this.canvas.height-50*(l+1)))}}}if(!this.time_domain&&this.show_tuning_line){var c=parseFloat(document.getElementById("tuning-freq").value),_=50/this.freq_div*c;t.fillStyle="red",t.fillRect(_,this.canvas.height,2,-1*this.canvas.height);var f=this.freqDomainData.slice(0,i+1).reduce(((t,e,i,n)=>e>n[t]?i:t),0),v=f*s*this.freq_div/50,y="",p="";for(l=0;l<88;l++){var S=this.A0*Math.pow(this.TWELTHROOT2,l);if(v<1.03*S&&v>.97*S){y=this.SugarL10n.get(this.notes_arr[l%12])+parseInt(l/12).toString(),p="white",v<.98*S?(y="♭ "+y+" ♭",p="red"):v<.99*S?(y="♭ "+y+" ♭",p="yellow"):v>1.02*S?(y="# "+y+" #",p="red"):v>1.01*S?(y="# "+y+" #",p="yellow"):p="white";break}}t.font="20px Georgia",t.fillStyle=p,t.fillText(y,this.canvas.width-200,30)}if(this.time_domain&&(1==this.trigEdge||2==this.trigEdge)){if(o=!0,1==this.trigEdge){for(l=0;l<i;l++)if(this.timeDomainData[l]>0){n=l;break}}else for(l=0;l<i;l++)if(this.timeDomainData[l]<0){n=l;break}e+=s=1*this.canvas.width/(i-n),t.moveTo(0,this.canvas.height/2)}for(l=n;l<i;l++){var I=this.timeDomainData[l];this.invert_waveform&&(I*=-1);let i=this.time_domain?this.mapCoords(-1*this.amp_value*I,-1,1,0,this.canvas.height):this.mapCoords(-1*this.amp_value*this.freqDomainData[l],0,100,this.canvas.height/1.01,2*this.canvas.height);0!=l||o?t.lineTo(e,i):t.moveTo(e,i),e+=s}t.stroke()},drawGrid:function(){var t=this.canvas.getContext("2d");t.fillStyle="black",t.fillRect(0,0,this.canvas.width,this.canvas.height),t.fillStyle="grey";for(var e=0;e<this.canvas.width;e+=50)t.fillRect(e,0,1,this.canvas.height);for(e=0;e<this.canvas.height;e+=50)t.fillRect(0,e,this.canvas.width,1)},mapCoords:function(t,e,i,n,s){return n+(t=(t-e)/(i-e))*(s-n)},playOrPause:function(){this.play=!this.play,this.play?(document.getElementById("play-button").style.display="initial",document.getElementById("pause-button").style.display="none"):(document.getElementById("play-button").style.display="none",document.getElementById("pause-button").style.display="initial")},TimeOrFreq_switch:function(){this.time_domain?(this.show_harmonics&&this.harmonics_button_display(),this.show_tuning_line&&this.tuning_line_button_display(),document.getElementById("time-domain-button").style.display="initial",document.getElementById("freq-domain-button").style.display="none",document.getElementById("domainName").innerText=this.time_base_string,document.getElementById("scaleValue").innerText=(1e3*this.time_div).toFixed(2)+" ms",this.setZoomSlider(),this.calcTimeDomainData(),window.cordova||window.PhoneGap||this.setTimeDomain()):(document.getElementById("time-domain-button").style.display="none",document.getElementById("freq-domain-button").style.display="initial",document.getElementById("domainName").innerText=this.freq_base_string,document.getElementById("scaleValue").innerText=this.freq_div+" Hz",this.setZoomSlider(),this.calcFreqDomainData(),window.cordova||window.PhoneGap||this.setFreqDomain())},TimeOrFreq:function(){if(this.setInterval_id&&this.stopRecord(),this.time_domain=!this.time_domain,this.SugarPresence.isShared()&&this.shared_mode_initialised){var t={user:this.SugarPresence.getUserInfo(),content:{action:"UpdateTimeOrFreq",data:this.time_domain}};this.SugarPresence.sendMessage(t)}this.TimeOrFreq_switch()},setZoomSlider:function(){var t=document.getElementById("zoomSlider");if(null!=t)if(this.time_domain){t.min="0",t.max="95",t.step="0.00001";var e=(this.time_div-5e-5)/1e-5;e=Math.round(1e5*e)/1e5,t.value=e}else t.min="50",t.max="1000",t.step="10",t.value=this.freq_div},ZoomInOut:function(){var t=document.getElementById("zoomSlider").value;if(this.time_domain){var e=5e-5+1e-5*parseFloat(t);this.time_div=Math.round(1e5*e)/1e5,this.calcTimeDomainData(),document.getElementById("scaleValue").innerText=(1e3*this.time_div).toFixed(2)+" ms"}else{var i=parseInt(t);this.freq_div=i,this.calcFreqDomainData(),document.getElementById("scaleValue").innerText=this.freq_div+" Hz"}if(this.SugarPresence.isShared()&&this.shared_mode_initialised){var n={user:this.SugarPresence.getUserInfo(),content:{action:"UpdateZoomSettings",data:{time_div:this.time_div,freq_div:this.freq_div}}};this.SugarPresence.sendMessage(n)}},decrementZoom:function(){if(this.time_domain?this.time_div=this.time_div-1e-5:this.freq_div=this.freq_div-10,this.setZoomSlider(),this.ZoomInOut(),this.SugarPresence.isShared()&&this.shared_mode_initialised){var t={user:this.SugarPresence.getUserInfo(),content:{action:"UpdateZoomSettings",data:{time_div:this.time_div,freq_div:this.freq_div}}};this.SugarPresence.sendMessage(t)}},incrementZoom:function(){if(this.time_domain?this.time_div=this.time_div+1e-5:this.freq_div=this.freq_div+10,this.setZoomSlider(),this.ZoomInOut(),this.SugarPresence.isShared()&&this.shared_mode_initialised){var t={user:this.SugarPresence.getUserInfo(),content:{action:"UpdateZoomSettings",data:{time_div:this.time_div,freq_div:this.freq_div}}};this.SugarPresence.sendMessage(t)}},invertWaveform_change_button:function(){this.invert_waveform=!this.invert_waveform,this.invert_waveform?(document.getElementById("invert-on-button").style.display="initial",document.getElementById("invert-off-button").style.display="none",document.getElementById("waveformStatus").innerText="Inverted"):(document.getElementById("invert-on-button").style.display="none",document.getElementById("invert-off-button").style.display="initial",document.getElementById("waveformStatus").innerText="Normal")},invertWaveform:function(){if(this.time_domain&&(this.invertWaveform_change_button(),this.drawWaveform(),this.SugarPresence.isShared()&&this.shared_mode_initialised)){var t={user:this.SugarPresence.getUserInfo(),content:{action:"UpdateWaveformInversion",data:this.invert_waveform}};this.SugarPresence.sendMessage(t)}},decreaseAmp:function(){var t=parseInt(document.getElementById("ampSlider").value);if(document.getElementById("ampSlider").value=t-1,this.ampSettings(),this.SugarPresence.isShared()&&this.shared_mode_initialised){var e={user:this.SugarPresence.getUserInfo(),content:{action:"UpdateAmplitude",data:document.getElementById("ampSlider").value}};this.SugarPresence.sendMessage(e)}},increaseAmp:function(){var t=parseInt(document.getElementById("ampSlider").value);if(document.getElementById("ampSlider").value=t+1,this.ampSettings(),this.SugarPresence.isShared()&&this.shared_mode_initialised){var e={user:this.SugarPresence.getUserInfo(),content:{action:"UpdateAmplitude",data:document.getElementById("ampSlider").value}};this.SugarPresence.sendMessage(e)}},ampSettings:function(){var t=parseInt(document.getElementById("ampSlider").value);if(this.amp_value=.1*t,this.drawWaveform(),this.SugarPresence.isShared()&&this.shared_mode_initialised){var e={user:this.SugarPresence.getUserInfo(),content:{action:"UpdateAmplitude",data:document.getElementById("ampSlider").value}};this.SugarPresence.sendMessage(e)}},exportFile:function(t){t.format;"csv"==t.format?this.generateCSV():"pdf"==t.format&&this.generatePDF()},generateCSV:function(){var t=this.SugarL10n.get("Session")+";";t+=this.SugarL10n.get("Mode")+";",t+=this.SugarL10n.get("Date")+";",t+=this.SugarL10n.get("Interval")+";",t+="S.No;",t+=this.SugarL10n.get("Value")+"\n";var e=1;for(var i of this.log_data){for(var n=i.data.length,s=0;s<n;s++)t+=e+";",t+=i.mode+";",t+=i.date+";",t+=i.interval+";",t+=s+";"+i.data[s]+"\n";0==n&&(t+=e+";",t+=i.mode+";",t+=i.date+";",t+=i.interval+";",t+=s+";-\n"),e+=1}var o=this,a={mimetype:"text/csv",title:this.SugarL10n.get("MeasureLoggingBy",{name:o.currentenv.user.name})+".csv",activity:"org.sugarlabs.ChartActivity",timestamp:(new Date).getTime(),creation_time:(new Date).getTime(),file_size:0};o.$root.$refs.SugarJournal.createEntry(t,a).then((()=>{o.$root.$refs.SugarPopup.log(this.SugarL10n.get("exportedLogAsCSV"))}))},canvasToImage:t=>-1!=t.indexOf("data:image/png")?Promise.resolve(t):new Promise(((e,i)=>{var n=new Image;n.src=t,n.onload=()=>{var t=document.createElement("canvas");t.width=n.width,t.height=n.height,t.getContext("2d").drawImage(n,0,0),e({dataURL:t.toDataURL("image/png"),width:n.width,height:n.height})}})),addCoverToPDF:function(t){let e=this;return new Promise(((i,n)=>{t.setFontStyle("bold"),t.setFontSize(20),t.text(105,100,this.SugarL10n.get("TimeLoggingDetails"),{align:"center"}),e.$root.$refs.SugarIcon.generateIconWithColors("../icons/owner-icon.svg",e.currentenv.user.colorvalue).then((n=>{e.canvasToImage(n).then((e=>{t.addImage(e.dataURL,90,110,30,30),i()}))})),t.text(105,150,e.currentenv.user.name,{align:"center"}),t.setFontSize(16),t.setFontStyle("normal")}))},generatePDF:function(){let t=this;var e=new jsPDF;this.addCoverToPDF(e).then((()=>{var i=10,n=15,s=1;for(var o of this.log_data){e.addPage(),n=15,e.setFontSize(18),e.setFontStyle("bold"),e.text(i,n,this.SugarL10n.get("Session")+": "+s),e.setFontStyle("normal"),e.text(this.SugarL10n.get("Mode")+":     "+o.mode,i,n+14),300==o.interval?e.text(this.SugarL10n.get("Interval")+":   "+this.SugarL10n.get("IntervalMinute",{interval:5}),i,n+21):e.text(this.SugarL10n.get("Interval")+":   "+this.SugarL10n.get("IntervalSecond",{interval:o.interval}),i,n+21),e.text(this.SugarL10n.get("Date")+":       "+o.date,i,n+28),n+=42,e.line(i,n-5,100,n-5),e.text("S.No",20,n+1),e.text(this.SugarL10n.get("Value"),75,n+1),e.line(i,n+3,100,n+3),e.line(i,n-5,i,n+3),e.line(60,n-5,60,n+3),e.line(100,n-5,100,n+3);var a=o.data.length;0!=a&&(e.line(i,n+3,i,n+9),e.line(60,n+3,60,n+9),e.line(100,n+3,100,n+9)),n+=8,e.setFontSize(14);for(var r=0;r<a;r++)n>285&&(e.addPage(),n=15,e.line(i,n-7,i,n+7),e.line(60,n-7,60,n+7),e.line(100,n-7,100,n+7)),e.text(r+"",20,n),e.text(""+o.data[r],75,n),e.line(i,n+1,100,n+1),r<a-1&&(e.line(i,n+1,i,n+8),e.line(60,n+1,60,n+8),e.line(100,n+1,100,n+8)),n+=7;n+=7,s+=1}metadata={mimetype:"application/pdf",title:this.SugarL10n.get("MeasureLoggingBy",{name:t.currentenv.user.name})+".pdf",activity:"org.olpcfrance.Measure",timestamp:(new Date).getTime(),creation_time:(new Date).getTime(),file_size:0},t.$root.$refs.SugarJournal.createEntry(e.output("dataurlstring"),metadata).then((()=>{t.$root.$refs.SugarPopup.log(this.SugarL10n.get("exportedLogAsPDF"))}))}))},logInterval:function(t){if(document.getElementById(`interval-${this.log_interval}`).style.backgroundColor="",this.log_interval=t.secondVal,document.getElementById(`interval-${this.log_interval}`).style.backgroundColor="darkgray",this.SugarPresence.isShared()&&this.shared_mode_initialised){var e={user:this.SugarPresence.getUserInfo(),content:{action:"UpdateLogInterval",data:this.log_interval}};this.SugarPresence.sendMessage(e)}},getSessionDate:function(){var t=new Date;return t.getFullYear()+"-"+t.getMonth()+"-"+t.getDate()+" "+(t.getHours()+":"+t.getMinutes()+":"+t.getSeconds())},startRecord:function(){this.is_recording=!0,document.getElementById("record-off-button").style.display="none",document.getElementById("record-on-button").style.display="initial",document.getElementById("logging-interval-button").disabled=!0,this.$root.$refs.SugarPopup.log(this.SugarL10n.get("recordingStarted")),this.log_session_obj.interval=this.log_interval,this.log_session_obj.date=this.getSessionDate(),this.log_session_obj.data=[],this.time_domain?(this.log_session_obj.mode="Time",this.setInterval_id=setInterval((()=>{for(var t=this.timeDomainData.length,e=0,i=0;i<t;i++)e+=Math.abs(this.timeDomainData[i]);var n=e/t;this.log_session_obj.data.push(n.toFixed(2))}),1e3*this.log_interval)):(this.log_session_obj.mode="Frequency",this.setInterval_id=setInterval((()=>{var t=this.amp_value*Math.max(...this.freqDomainData);this.log_session_obj.data.push(t.toFixed(2))}),1e3*this.log_interval))},stopRecord:function(){this.is_recording=!1,document.getElementById("record-off-button").style.display="initial",document.getElementById("record-on-button").style.display="none",document.getElementById("logging-interval-button").disabled=!1,this.$root.$refs.SugarPopup.log(this.SugarL10n.get("recordingEnded")),clearInterval(this.setInterval_id),this.log_data.push({...this.log_session_obj}),this.setInterval_id=null},captureImage:function(){var t="image/jpeg",e=this.canvas.toDataURL(t,1),i={mimetype:t,title:this.SugarL10n.get("WaveformImage"),activity:"org.olpcfrance.MediaViewerActivity",timestamp:(new Date).getTime(),creation_time:(new Date).getTime(),file_size:0},n=this;n.$root.$refs.SugarJournal.createEntry(e,i).then((()=>{n.$root.$refs.SugarPopup.log(this.SugarL10n.get("CaptureImageDone"))}))},triggeringEdge:function(){if(this.trigEdge+=1,this.trigEdge>2&&(this.trigEdge=0),1==this.trigEdge?(document.getElementById("triggering-edge-none-button").style.display="none",document.getElementById("triggering-edge-rising-button").style.display="initial",document.getElementById("triggering-edge-falling-button").style.display="none",document.getElementById("TrigEdgeType").innerText=this.SugarL10n.get("RisingEdge")):2==this.trigEdge?(document.getElementById("triggering-edge-none-button").style.display="none",document.getElementById("triggering-edge-rising-button").style.display="none",document.getElementById("triggering-edge-falling-button").style.display="initial",document.getElementById("TrigEdgeType").innerText=this.SugarL10n.get("FallingEdge")):(document.getElementById("triggering-edge-none-button").style.display="initial",document.getElementById("triggering-edge-rising-button").style.display="none",document.getElementById("triggering-edge-falling-button").style.display="none",document.getElementById("TrigEdgeType").innerText=this.SugarL10n.get("None")),this.drawWaveform(),this.SugarPresence.isShared()&&this.shared_mode_initialised){var t={user:this.SugarPresence.getUserInfo(),content:{action:"UpdateTriggeringEdge",data:this.trigEdge}};this.SugarPresence.sendMessage(t)}},selectInstrument:function(t){if("none"==this.instrument_name?document.getElementById("none").style.backgroundColor="":document.getElementById(`${this.instrument_name}_instrument`).style.backgroundColor="",this.instrument_name=t.instrument_name,"none"==this.instrument_name?(document.getElementById("none").style.backgroundColor="darkgray",this.draw_note=!1,this.note_index=-2,this.note_freq=0):(document.getElementById(`${this.instrument_name}_instrument`).style.backgroundColor="darkgray",this.draw_note=!0,this.note_index=-1,this.note_freq=0),this.time_domain&&this.TimeOrFreq(),this.drawWaveform(),this.SugarPresence.isShared()&&this.shared_mode_initialised){var e={user:this.SugarPresence.getUserInfo(),content:{action:"UpdateInstrument",data:{instrument_name:t.instrument_name,freq_input_note_index:this.freq_input_note_index,freq_input_octave:this.freq_input_octave,note_idx:this.note_index,note_freq:this.note_freq,note_name:this.note_name,show_harmonics:this.show_harmonics}}};this.SugarPresence.sendMessage(e)}},drawNote:function(t,e,i){if(document.getElementById(`${this.instrument_name}_note_${this.note_name}`).style.backgroundColor="",document.getElementById(`${this.instrument_name}_note_${i}`).style.backgroundColor="darkgray",this.draw_note=!0,this.note_index=t,this.note_freq=e,this.note_name=i,this.time_domain&&this.TimeOrFreq(),this.drawWaveform(),this.SugarPresence.isShared()&&this.shared_mode_initialised){var n={user:this.SugarPresence.getUserInfo(),content:{action:"UpdateNoteForNotNone",data:{note_idx:this.note_index,note_freq:this.note_freq,note_name:this.note_name}}};this.SugarPresence.sendMessage(n)}},harmonics_button_display:function(){this.show_harmonics=!this.show_harmonics,this.show_harmonics?(document.getElementById("harmonics-on-button").style.display="initial",document.getElementById("harmonics-off-button").style.display="none"):(document.getElementById("harmonics-on-button").style.display="none",document.getElementById("harmonics-off-button").style.display="initial")},handleHarmonics:function(){if("none"!=this.instrument_name&&(this.harmonics_button_display(),this.drawWaveform(),this.SugarPresence.isShared()&&this.shared_mode_initialised)){var t={user:this.SugarPresence.getUserInfo(),content:{action:"UpdateHarmonics",data:this.show_harmonics}};this.SugarPresence.sendMessage(t)}},tuning_line_button_display:function(){this.show_tuning_line=!this.show_tuning_line,this.show_tuning_line?(document.getElementById("tuning-line-on-button").style.display="initial",document.getElementById("tuning-line-off-button").style.display="none"):(document.getElementById("tuning-line-on-button").style.display="none",document.getElementById("tuning-line-off-button").style.display="initial")},showTuningLine:function(){if(!this.time_domain&&(this.tuning_line_button_display(),this.drawWaveform(),this.SugarPresence.isShared()&&this.shared_mode_initialised)){var t={user:this.SugarPresence.getUserInfo(),content:{action:"UpdateTuningLineDisplay",data:{show_tuning_line:this.show_tuning_line,tuning_freq_value:document.getElementById("tuning-freq").value}}};this.SugarPresence.sendMessage(t)}},playStopNote:function(){if(this.play_note=!this.play_note,this.play_note){document.getElementById("play-note-button").style.display="initial",document.getElementById("stop-note-button").style.display="none";var t=parseFloat(document.getElementById("tuning-freq").value);t>=0&&t<=2e4&&(this.tone_osc=new Tone.Oscillator(t,"sine").toDestination().start())}else document.getElementById("play-note-button").style.display="none",document.getElementById("stop-note-button").style.display="initial",null!=this.tone_osc&&(this.tone_osc.stop(),this.tone_osc=null)},setNote:function(t){if(document.getElementById(`note_${this.freq_input_note_index}`).style.backgroundColor="",this.freq_input_note_index=t,document.getElementById(`note_${this.freq_input_note_index}`).style.backgroundColor="darkgray",this.updateFreqInput(),this.SugarPresence.isShared()&&this.shared_mode_initialised){var e={user:this.SugarPresence.getUserInfo(),content:{action:"UpdateNoteForNone",data:this.freq_input_note_index}};this.SugarPresence.sendMessage(e)}},setOctave:function(t){if(document.getElementById(`octave_${this.freq_input_octave}`).style.backgroundColor="",this.freq_input_octave=t,document.getElementById(`octave_${this.freq_input_octave}`).style.backgroundColor="darkgray",this.updateFreqInput(),this.SugarPresence.isShared()&&this.shared_mode_initialised){var e={user:this.SugarPresence.getUserInfo(),content:{action:"UpdateOctave",data:this.freq_input_octave}};this.SugarPresence.sendMessage(e)}},tuningFreqInputUpdate:function(){if(this.SugarPresence.isShared()&&this.shared_mode_initialised){var t={user:this.SugarPresence.getUserInfo(),content:{action:"UpdateTuningFrequency",data:document.getElementById("tuning-freq").value}};this.SugarPresence.sendMessage(t)}},updateFreqInput:function(){var t=12*this.freq_input_octave+this.freq_input_note_index,e=this.A0*Math.pow(this.TWELTHROOT2,t);document.getElementById("tuning-freq").value=e.toFixed(3)},getActivityData:function(){for(var t=[],e=[],i=0;i<this.fftSize;i++)t.push(this.timeDomainData[i]),e.push(this.freqDomainData[i]);return{time_domain:this.time_domain,time_div:this.time_div,freq_div:this.freq_div,play:this.play,num_of_samples_time:this.num_of_samples_time,num_of_samples_freq:this.num_of_samples_freq,timeDomainData:t,freqDomainData:e,amp_slider_val:document.getElementById("ampSlider").value,invert_waveform:this.invert_waveform,trigEdge:this.trigEdge,log_data:this.log_data,log_interval:this.log_interval,instrument_name:this.instrument_name,existing_instrument_settings:{instrument_name:this.instrument_name,note_index:this.note_index,note_freq:this.note_freq,note_name:this.note_name,freq_input_note_index:this.freq_input_note_index,freq_input_octave:this.freq_input_octave,show_harmonics:this.show_harmonics,show_tuning_line:this.show_tuning_line,tuning_freq_value:document.getElementById("tuning-freq").value}}},onActivityStop:function(){this.setInterval_id&&this.stopRecord();var t=this.getActivityData();this.$refs.SugarJournal.saveData(t)},onJournalNewInstance:function(){console.log("New instance")},onJournalDataLoaded:function(t,e){console.log("Existing instance"),this.time_domain=t.time_domain,this.time_div=t.time_div,this.freq_div=t.freq_div,this.setZoomSlider(),this.play=!t.play,this.playOrPause(),this.num_of_samples_time=t.num_of_samples_time,this.num_of_samples_freq=t.num_of_samples_freq,this.existing_instance_time_data=t.timeDomainData,this.existing_instance_freq_data=t.freqDomainData,document.getElementById("ampSlider").value=t.amp_slider_val,this.ampSettings(),this.invert_waveform=!t.invert_waveform,this.invertWaveform_change_button(),this.trigEdge=t.trigEdge-1,this.triggeringEdge(),this.log_data=t.log_data,document.getElementById(`interval-${this.log_interval}`).style.backgroundColor="",this.log_interval=t.log_interval,document.getElementById(`interval-${this.log_interval}`).style.backgroundColor="darkgray",this.existing_instrument_settings=t.existing_instrument_settings,this.existing_instance=!0,this.timeDomainData.length>0&&this.initDataForExisiting()},onJournalLoadError:function(t){console.log("Error loading from journal")},setInstrumentSettingsFromData:function(){var t=this.time_domain,e=this.existing_instrument_settings;"none"==e.instrument_name?(document.getElementById("none").click(),this.setNote(e.freq_input_note_index),this.setOctave(e.freq_input_octave)):(document.getElementById(`${e.instrument_name}_instrument`).click(),this.drawNote(e.note_index,e.note_freq,e.note_name),this.show_harmonics=!e.show_harmonics,this.handleHarmonics()),document.getElementById("tuning-freq").value=e.tuning_freq_value,this.show_tuning_line=!e.show_tuning_line,this.showTuningLine(),this.time_domain=t,this.shared_mode_initialised=!0},initDataForExisiting:function(){if(!this.play){this.freqDomainData=[];for(var t=0;t<this.fftSize;t++)this.timeDomainData[t]=this.existing_instance_time_data[t],this.freqDomainData.push(this.existing_instance_freq_data[t]);this.drawWaveform()}this.setInstrumentSettingsFromData(),this.time_domain=!this.time_domain,this.TimeOrFreq(),this.existing_instance=!1},initSharedInstance:function(t){this.time_domain=t.time_domain,this.time_div=t.time_div,this.freq_div=t.freq_div,this.setZoomSlider(),this.num_of_samples_time=t.num_of_samples_time,this.num_of_samples_freq=t.num_of_samples_freq,document.getElementById("ampSlider").value=t.amp_slider_val,this.ampSettings(),this.invert_waveform=!t.invert_waveform,this.invertWaveform_change_button(),this.trigEdge=t.trigEdge-1,this.triggeringEdge(),document.getElementById(`interval-${this.log_interval}`).style.backgroundColor="",this.log_interval=t.log_interval,document.getElementById(`interval-${this.log_interval}`).style.backgroundColor="darkgray",this.existing_instrument_settings=t.existing_instrument_settings,this.shared_instance=!0,this.timeDomainData.length>0&&(this.setInstrumentSettingsFromData(),this.time_domain=!t.time_domain,this.TimeOrFreq(),this.shared_instance=!1)},onJournalSharedInstance:function(){console.log("Shared instance")},onNetworkDataReceived(t){switch(t.content.action){case"init":this.initSharedInstance(t.content.data);break;case"UpdateTimeOrFreq":this.time_domain=t.content.data,this.TimeOrFreq_switch();break;case"UpdateZoomSettings":this.time_div=t.content.data.time_div,this.freq_div=t.content.data.freq_div,this.setZoomSlider(),this.shared_mode_initialised=!1,this.ZoomInOut(),this.shared_mode_initialised=!0;break;case"UpdateAmplitude":document.getElementById("ampSlider").value=t.content.data,this.shared_mode_initialised=!1,this.ampSettings(),this.shared_mode_initialised=!0;break;case"UpdateWaveformInversion":this.invert_waveform=!t.content.data,this.shared_mode_initialised=!1,this.invertWaveform(),this.shared_mode_initialised=!0;break;case"UpdateTriggeringEdge":this.trigEdge=t.content.data-1,this.shared_mode_initialised=!1,this.triggeringEdge(),this.shared_mode_initialised=!0;break;case"UpdateLogInterval":document.getElementById(`interval-${this.log_interval}`).style.backgroundColor="",this.log_interval=t.content.data,document.getElementById(`interval-${this.log_interval}`).style.backgroundColor="darkgray";break;case"UpdateInstrument":this.shared_mode_initialised=!1;var e=this.time_domain,i=t.content.data;"none"==i.instrument_name?(document.getElementById("none").click(),this.setNote(i.freq_input_note_index),this.setOctave(i.freq_input_octave)):(document.getElementById(`${i.instrument_name}_instrument`).click(),this.drawNote(i.note_idx,i.note_freq,i.note_name),this.show_harmonics=!i.show_harmonics,this.handleHarmonics()),this.time_domain=e,this.TimeOrFreq_switch(),this.shared_mode_initialised=!0;break;case"UpdateNoteForNone":this.shared_mode_initialised=!1,"none"==this.instrument_name&&this.setNote(t.content.data),this.shared_mode_initialised=!0;break;case"UpdateOctave":this.shared_mode_initialised=!1,this.setOctave(t.content.data),this.shared_mode_initialised=!0;break;case"UpdateNoteForNotNone":this.shared_mode_initialised=!1;var n=t.content.data;"none"!=this.instrument_name&&this.drawNote(n.note_idx,n.note_freq,n.note_name),this.shared_mode_initialised=!0;break;case"UpdateHarmonics":this.shared_mode_initialised=!1,this.show_harmonics=!t.content.data,this.harmonics_button_display(),this.drawWaveform(),this.shared_mode_initialised=!0;break;case"UpdateTuningFrequency":this.shared_mode_initialised=!1,document.getElementById("tuning-freq").value=t.content.data,this.shared_mode_initialised=!0;break;case"UpdateTuningLineDisplay":this.shared_mode_initialised=!1,document.getElementById("tuning-freq").value=t.content.data.tuning_freq_value,this.show_tuning_line=!t.content.data.show_tuning_line,this.showTuningLine(),this.drawWaveform(),this.shared_mode_initialised=!0}},onNetworkUserChanged(t){this.SugarPresence.isHost&&(this.SugarPresence.sendMessage({user:this.SugarPresence.getUserInfo(),content:{action:"init",data:this.getActivityData()}}),this.shared_mode_initialised=!0)},tutorialGifContent:function(t,e){return`<div><img src='tutorial_gifs/${t}' style='width: 100%;height: 100%;'><p>`+e+"</p></div>"},onHelp:function(){var t=[{title:this.l10n.stringTutoExplainTitle,intro:this.l10n.stringTutoExplainContent},{element:"#time-domain-button",position:"bottom",title:this.l10n.stringTutoTimeFreqTitle,intro:this.tutorialGifContent("time_freq_switch_demo.gif",this.l10n.stringTutoTimeFreqContent)},{onHide:function(t){"visible"==document.getElementById("zoomSettingsPalette").offsetParent.style.visibility&&document.getElementById("zoom-button").click()},onShow:function(t){"hidden"==document.getElementById("zoomSettingsPalette").offsetParent.style.visibility&&document.getElementById("zoom-button").click()},element:"#zoomSettingsPalette",position:"bottom",title:this.l10n.stringTutoZoomSettingsTitle,intro:this.tutorialGifContent("zoom_settings_demo.gif",this.l10n.stringTutoZoomSettingsContent)},{element:"#play-button",position:"bottom",title:this.l10n.stringTutoPlayPauseTitle,intro:this.tutorialGifContent("play_pause_demo.gif",this.l10n.stringTutoPlayPauseContent)},{onHide:function(t){"visible"==document.getElementById("amplitudeSettings").offsetParent.style.visibility&&document.getElementById("settings-button").click()},onShow:function(t){"hidden"==document.getElementById("amplitudeSettings").offsetParent.style.visibility&&document.getElementById("settings-button").click()},element:"#amplitudeSettings",position:"right",title:this.l10n.stringTutoAmplitudeTitle,intro:this.tutorialGifContent("amplitude_demo.gif",this.l10n.stringTutoAmplitudeContent)},{onHide:function(t){"visible"==document.getElementById("amplitudeSettings").offsetParent.style.visibility&&document.getElementById("settings-button").click()},onShow:function(t){"hidden"==document.getElementById("amplitudeSettings").offsetParent.style.visibility&&document.getElementById("settings-button").click()},element:"#waveformInversionSettings",position:"right",title:this.l10n.stringTutoWaveformInversionTitle,intro:this.tutorialGifContent("waveform_invert_demo.gif",this.l10n.stringTutoWaveformInversionContent)},{onHide:function(t){"visible"==document.getElementById("amplitudeSettings").offsetParent.style.visibility&&document.getElementById("settings-button").click()},onShow:function(t){"hidden"==document.getElementById("amplitudeSettings").offsetParent.style.visibility&&document.getElementById("settings-button").click()},element:"#triggeringEdgeSettings",position:"right",title:this.l10n.stringTutoTriggeringEdgeTitle,intro:this.tutorialGifContent("triggering_edge_demo.gif",this.l10n.stringTutoTriggeringEdgeContent)},{title:this.l10n.stringTutoLoggingExplainTitle,intro:this.l10n.stringTutoLoggingExplainContent},{onHide:function(t){"visible"==document.getElementById("loggingPalette").offsetParent.style.visibility&&document.getElementById("logging-interval-button").click()},onShow:function(t){"hidden"==document.getElementById("loggingPalette").offsetParent.style.visibility&&document.getElementById("logging-interval-button").click()},element:"#loggingPalette",position:"bottom",title:this.l10n.stringTutoLoggingIntervalTitle,intro:this.l10n.stringTutoLoggingIntervalContent},{onShow:function(t){app.setInterval_id&&app.stopRecord()},element:"#record-off-button",position:"bottom",title:this.l10n.stringTutoStartStopTitle,intro:this.l10n.stringTutoStartStopContent},{onHide:function(t){"visible"==document.getElementById("export-formats").offsetParent.style.visibility&&document.getElementById("export-button").click()},onShow:function(t){"hidden"==document.getElementById("export-formats").offsetParent.style.visibility&&document.getElementById("export-button").click()},element:"#csv-export",position:"bottom",title:this.l10n.stringTutoExportLoggingCSVTitle,intro:this.l10n.stringTutoExportLoggingCSVContent},{onHide:function(t){"visible"==document.getElementById("export-formats").offsetParent.style.visibility&&document.getElementById("export-button").click()},onShow:function(t){"hidden"==document.getElementById("export-formats").offsetParent.style.visibility&&document.getElementById("export-button").click()},element:"#pdf-export",position:"bottom",title:this.l10n.stringTutoExportLoggingPDFTitle,intro:this.l10n.stringTutoExportLoggingPDFContent},{title:this.l10n.stringTutoInstrumentExplainTitle,intro:this.l10n.stringTutoInstrumentExplainContent},{onHide:function(t){"visible"==document.getElementById("instrumentPalette").offsetParent.style.visibility&&document.getElementById("instrument-select-button").click()},onShow:function(t){"hidden"==document.getElementById("instrumentPalette").offsetParent.style.visibility&&document.getElementById("instrument-select-button").click()},element:"#instrumentPalette",position:"left",title:this.l10n.stringTutoInstrumentSelectTitle,intro:this.l10n.stringTutoInstrumentSelectContent},{onHide:function(t){"visible"==document.getElementById("notePalette").offsetParent.style.visibility&&document.getElementById("note-select-button").click()},onShow:function(t){"hidden"==document.getElementById("notePalette").offsetParent.style.visibility&&document.getElementById("note-select-button").click()},element:"#notePalette",position:"left",title:this.l10n.stringTutoNoteSelectTitle,intro:this.tutorialGifContent("select_note_demo.gif",this.l10n.stringTutoNoteSelectContent)},{onHide:function(t){"visible"==document.getElementById("octavePalette").offsetParent.style.visibility&&document.getElementById("octave-select-button").click()},onShow:function(t){"hidden"==document.getElementById("octavePalette").offsetParent.style.visibility&&document.getElementById("octave-select-button").click()},element:"#octavePalette",position:"left",title:this.l10n.stringTutoOctaveSelectTitle,intro:this.l10n.stringTutoOctaveSelectContent},{onHide:function(t){"visible"==document.getElementById("tuningPalette").offsetParent.style.visibility&&document.getElementById("tuning-palette-button").click()},onShow:function(t){"hidden"==document.getElementById("tuningPalette").offsetParent.style.visibility&&document.getElementById("tuning-palette-button").click(),app.show_harmonics&&app.handleHarmonics()},element:"#harmonics-off-button",position:"left",title:this.l10n.stringTutoShowHarmonicsTitle,intro:this.tutorialGifContent("show_harmonics_demo.gif",this.l10n.stringTutoShowHarmonicsContent)},{onHide:function(t){"visible"==document.getElementById("tuningPalette").offsetParent.style.visibility&&document.getElementById("tuning-palette-button").click()},onShow:function(t){"hidden"==document.getElementById("tuningPalette").offsetParent.style.visibility&&document.getElementById("tuning-palette-button").click()},element:"#tuning-freq",position:"bottom",title:this.l10n.stringTutoTuningFreqInputTitle,intro:this.l10n.stringTutoTuningFreqInputContent},{onHide:function(t){"visible"==document.getElementById("tuningPalette").offsetParent.style.visibility&&document.getElementById("tuning-palette-button").click()},onShow:function(t){"hidden"==document.getElementById("tuningPalette").offsetParent.style.visibility&&document.getElementById("tuning-palette-button").click(),app.show_tuning_line&&app.showTuningLine()},element:"#tuning-line-off-button",position:"bottom",title:this.l10n.stringTutoTuningLineTitle,intro:this.tutorialGifContent("show_tuning_line_demo.gif",this.l10n.stringTutoTuningLineContent)},{onHide:function(t){"visible"==document.getElementById("tuningPalette").offsetParent.style.visibility&&document.getElementById("tuning-palette-button").click()},onShow:function(t){"hidden"==document.getElementById("tuningPalette").offsetParent.style.visibility&&document.getElementById("tuning-palette-button").click(),app.play_note&&app.playStopNote()},element:"#stop-note-button",position:"bottom",title:this.l10n.stringTutoPlayStopNoteTitle,intro:this.l10n.stringTutoPlayStopNoteContent},{element:"#capture-image-button",position:"bottom",title:this.l10n.stringTutoCaptureWaveformTitle,intro:this.l10n.stringTutoCaptureWaveformContent}];this.$refs.SugarTutorial.show(t)},onAudioInput:function(t){this.existing_instance&&this.initDataForExisiting(),this.shared_instance&&(this.setInstrumentSettingsFromData(),this.time_domain=!data.time_domain,this.TimeOrFreq(),this.shared_instance=!1),this.play&&(this.timeDomainData=t.data,this.time_domain?this.calcTimeDomainData():this.calcFreqDomainData())},onDeviceReady:function(){window.addEventListener("audioinput",this.onAudioInput,!1),this.init(),audioinput.start({bufferSize:4096,streamToWebAudio:!1})}},mounted(){this.SugarL10n=this.$refs.SugarL10n,this.SugarPresence=this.$refs.SugarPresence,this.canvas=document.getElementById("mainCanvas"),window.cordova||window.PhoneGap?document.addEventListener("deviceready",this.onDeviceReady,!1):(this.init(),navigator.mediaDevices.getUserMedia({audio:!0}).then((t=>{if(this.fftSize=4096,this.createAnalyserNode(t,this.fftSize),this.webAudio_mediaStreamSource=t,!this.play&&this.existing_instance)for(var e=0;e<this.fftSize;e++)this.timeDomainData[e]=this.existing_instance_time_data[e],this.freqDomainData[e]=this.existing_instance_freq_data[e];(this.existing_instance||this.shared_instance)&&this.setInstrumentSettingsFromData(),this.shared_instance=!1,this.time_domain=!this.time_domain,this.TimeOrFreq()})).catch((t=>{console.log(t),alert("Please allow microphone access")})))}});