const SYNTHSVG='<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" y="0px" xml:space="preserve" x="0px" width="SVGWIDTHpx" viewBox="0 0 SVGWIDTH 55" version="1.1" height="55px" enable-background="new 0 0 SVGWIDTH 55"><g transform="scale(XSCALE,1)"><path d="m 1.5,27.5 c 0,0 2.2,-17.5 6.875,-17.5 4.7,0.0 6.25,11.75 6.875,17.5 0.75,6.67 2.3,17.5 6.875,17.5 4.1,0.0 6.25,-13.6 6.875,-17.5 C 29.875,22.65 31.1,10 35.875,10 c 4.1,0.0 5.97,13.0 6.875,17.5 1.15,5.7 1.75,17.5 6.875,17.5 4.65,0.0 6.875,-17.5 6.875,-17.5" style="stroke:#90c100;fill-opacity:1;fill:none;stroke-width:STROKEWIDTHpx;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" /></g></svg>',WHOLENOTE='<svg xmlns="http://www.w3.org/2000/svg" version="1.1" id="svg6468" viewBox="0 0 5.1680003 12.432" height="12.432" width="5.1680002"> <g transform="translate(-375.23523,-454.37592)"> <g transform="translate(7.9606,5.6125499)" style="fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"> <path d="m 369.80263,457.99537 q 1.104,0 1.872,0.432 0.768,0.416 0.768,1.2 0,0.752 -0.752,1.168 -0.752,0.4 -1.808,0.4 -1.104,0 -1.856,-0.416 -0.752,-0.416 -0.752,-1.232 0,-0.576 0.464,-0.944 0.48,-0.368 1.008,-0.48 0.528,-0.128 1.056,-0.128 z m -0.864,1.136 q 0,0.672 0.304,1.184 0.304,0.512 0.784,0.512 0.736,0 0.736,-0.8 0,-0.64 -0.304,-1.136 -0.288,-0.512 -0.8,-0.512 -0.72,0 -0.72,0.752 z" /> </g> </g> </svg>',HALFNOTE='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 3.84 12.432" height="3.5085866mm" width="1.0837333mm"> <g transform="translate(-375.23523,-454.37592)"> <g style="fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"> <path d="m 375.23523,465.70392 q 0,-0.832 0.816,-1.472 0.816,-0.656 1.728,-0.656 0.528,0 0.944,0.272 l 0,-9.472 0.352,0 0,10.352 q 0,0.896 -0.784,1.488 -0.784,0.592 -1.728,0.592 -0.528,0 -0.928,-0.304 -0.4,-0.32 -0.4,-0.8 z m 0.736,0.48 q 0.848,0 1.712,-0.72 0.88,-0.72 0.88,-1.072 0,-0.224 -0.192,-0.224 -0.592,0 -1.632,0.688 -1.024,0.672 -1.024,1.12 0,0.208 0.256,0.208 z" /> </g> </g> </svg>',QUARTERNOTE='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 4.0859801 11.74224" height="3.313921mm" width="1.1531544mm"> <g transform="translate(-226.1339,-457.841)"> <g style="fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"> <path d="m 229.60268,457.841 0.5625,0 0.0547,0.0625 0,10.02344 q 0,1.27344 -1.53125,1.625 l -0.375,0.0313 -0.27343,0 q -1.65625,0 -1.875,-1.03906 l -0.0313,-0.24219 q 0,-1.01562 1.64843,-1.20312 l 0.25782,-0.0391 q 0.77343,0 1.47656,0.5 l 0.0313,0 0,-9.65625 0.0547,-0.0625 z" /> </g> </g> </svg>',EIGHTHNOTE='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 7.5234898 11.7422" height="3.3139098mm" width="2.123296mm"> <g transform="translate(-244.80575,-403.5553)"> <g style="fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"> <path d="m 248.14955,403.5553 0.67969,0 0.0625,0.0547 0,0.30468 q 0.21094,0.42188 1.5625,0.91407 1.875,0.54687 1.875,1.625 0,1.14062 -0.95313,1.89062 l -0.0313,0 -0.23437,-0.25 q 0.47656,-0.38281 0.47656,-1.03906 0,-0.54688 -1.78125,-1.10156 -0.71875,-0.32813 -0.91406,-0.53125 l 0,8.32812 q 0,1.19531 -1.75,1.54688 l -0.44531,0 q -1.89063,0 -1.89063,-1.3125 0,-1.02344 1.65625,-1.20313 l 0.17969,0 q 0.75,0 1.44531,0.5 l 0,-9.67187 0.0625,-0.0547 z" /> </g> </g> </svg>',SIXTEENTHNOTE='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 7.0080001 12.432" height="3.5085866mm" width="1.9778134mm"> <g transform="translate(-182.21292,-431.51877)"> <g style="fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"> <path d="m 182.21292,442.84677 q 0,-0.832 0.816,-1.472 0.816,-0.656 1.728,-0.656 0.528,0 0.944,0.272 l 0,-9.472 0.336,0 q 0.064,0.56 0.4,1.088 0.352,0.512 0.8,0.944 0.448,0.416 0.88,0.864 0.448,0.432 0.752,1.024 0.304,0.576 0.304,1.232 0,0.544 -0.256,1.104 0.304,0.448 0.304,1.184 0,1.232 -0.608,2.24 l -0.384,0 q 0.56,-1.12 0.56,-2.032 0,-0.512 -0.256,-0.96 -0.24,-0.448 -0.752,-0.816 -0.496,-0.368 -0.832,-0.56 -0.32,-0.192 -0.896,-0.48 l 0,5.52 q 0,0.896 -0.784,1.488 -0.784,0.592 -1.728,0.592 -0.528,0 -0.928,-0.304 -0.4,-0.32 -0.4,-0.8 z m 6.464,-5.904 q 0,-1.648 -2.624,-3.072 0,0.464 0.192,0.88 0.192,0.416 0.512,0.752 0.32,0.32 0.656,0.592 0.336,0.272 0.688,0.608 0.352,0.32 0.544,0.608 0.032,-0.256 0.032,-0.368 z" /> </g> </g> </svg>',THIRTYSECONDNOTE='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 7.0080001 14.496001" height="4.0910935mm" width="1.9778134mm"> <g transform="translate(-630.78433,-240.88335)">  <g  style="fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1">  <path  d="m 630.78433,254.27535 q 0,-0.832 0.816,-1.472 0.816,-0.656 1.728,-0.656 0.528,0 0.944,0.272 l 0,-11.536 0.352,0 q 0.048,0.56 0.384,1.072 0.336,0.496 0.768,0.912 0.432,0.4 0.864,0.848 0.432,0.448 0.72,1.104 0.304,0.656 0.304,1.456 0,0.48 -0.16,1.056 0.224,0.416 0.224,0.912 0,0.512 -0.24,0.976 0.304,0.448 0.304,1.168 0,1.232 -0.608,2.24 l -0.384,0 q 0.56,-1.12 0.56,-2.032 0,-0.512 -0.256,-0.96 -0.24,-0.448 -0.752,-0.816 -0.496,-0.368 -0.832,-0.56 -0.32,-0.192 -0.896,-0.48 l 0,5.52 q 0,0.896 -0.784,1.488 -0.784,0.592 -1.728,0.592 -0.528,0 -0.928,-0.304 -0.4,-0.32 -0.4,-0.8 z m 6.448,-7.872 q 0,-0.496 -0.208,-0.928 -0.192,-0.432 -0.64,-0.832 -0.432,-0.416 -0.784,-0.672 -0.352,-0.256 -0.976,-0.656 0.032,0.448 0.352,0.896 0.32,0.432 0.704,0.752 0.4,0.32 0.848,0.8 0.464,0.464 0.704,0.912 l 0,-0.272 z m 0,2.096 q 0,-0.4 -0.16,-0.768 -0.144,-0.368 -0.32,-0.608 -0.16,-0.256 -0.592,-0.608 -0.416,-0.352 -0.672,-0.528 -0.256,-0.176 -0.848,-0.576 0.064,0.48 0.4,0.976 0.336,0.48 0.72,0.816 0.4,0.336 0.832,0.784 0.448,0.432 0.64,0.784 l 0,-0.272 z" /> </g> </g> </svg>',SIXTYFOURTHNOTE='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 7.0080001 14.528" height="4.1001244mm" width="1.9778134mm"> <g transform="translate(-345.3223,-325.39492)"> <g transform="translate(3.1093785,1.6864426)" style="fill:#000000;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"> <path d="m 342.21292,337.13248 q 0,-0.832 0.816,-1.472 0.816,-0.656 1.728,-0.656 0.528,0 0.944,0.272 l 0,-11.568 0.336,0 q 0.064,0.64 0.384,1.104 0.336,0.464 0.752,0.768 0.416,0.304 0.832,0.656 0.416,0.336 0.688,0.928 0.288,0.592 0.288,1.44 0,0.24 -0.144,0.768 0.256,0.608 0.256,1.376 0,0.32 -0.16,0.896 0.224,0.416 0.224,0.912 0,0.496 -0.24,0.96 0.304,0.448 0.304,1.024 0,0.384 -0.08,0.688 -0.08,0.304 -0.16,0.448 -0.08,0.144 -0.368,0.608 l -0.384,0 q 0.08,-0.16 0.192,-0.368 0.112,-0.224 0.16,-0.32 0.064,-0.096 0.112,-0.24 0.064,-0.144 0.08,-0.288 0.016,-0.144 0.016,-0.32 0,-0.272 -0.096,-0.512 -0.08,-0.256 -0.176,-0.432 -0.096,-0.192 -0.32,-0.4 -0.224,-0.208 -0.368,-0.32 -0.144,-0.128 -0.464,-0.304 -0.304,-0.192 -0.432,-0.256 -0.128,-0.064 -0.48,-0.224 -0.336,-0.176 -0.4,-0.208 l 0,4.064 q 0,0.896 -0.784,1.488 -0.784,0.592 -1.728,0.592 -0.528,0 -0.928,-0.304 -0.4,-0.32 -0.4,-0.8 z m 6.352,-8.384 q 0,-0.352 -0.144,-0.688 -0.128,-0.352 -0.288,-0.576 -0.16,-0.224 -0.48,-0.496 -0.32,-0.272 -0.512,-0.4 -0.192,-0.144 -0.592,-0.384 -0.384,-0.24 -0.496,-0.32 0.032,0.432 0.352,0.832 0.32,0.384 0.704,0.656 0.4,0.272 0.816,0.72 0.432,0.432 0.624,0.912 0.016,-0.176 0.016,-0.256 z m 0.016,2.128 q 0,-0.208 -0.048,-0.4 -0.032,-0.192 -0.08,-0.336 -0.048,-0.16 -0.176,-0.336 -0.128,-0.176 -0.208,-0.288 -0.08,-0.112 -0.272,-0.272 -0.192,-0.176 -0.288,-0.256 -0.096,-0.08 -0.352,-0.256 -0.24,-0.176 -0.336,-0.224 -0.096,-0.064 -0.384,-0.24 -0.288,-0.192 -0.384,-0.256 0.032,0.464 0.368,0.88 0.336,0.416 0.736,0.704 0.4,0.272 0.816,0.688 0.416,0.416 0.576,0.864 0.032,-0.192 0.032,-0.272 z m -0.016,1.936 q 0,-0.848 -0.624,-1.504 -0.608,-0.672 -1.872,-1.392 0.064,0.464 0.384,0.896 0.336,0.416 0.72,0.688 0.4,0.272 0.8,0.704 0.4,0.416 0.576,0.88 0.016,-0.064 0.016,-0.272 z" /> </g> </g> </svg>',SHARP="♯",FLAT="♭",BTOFLAT={Eb:"E♭",Gb:"G♭",Ab:"A♭",Bb:"B♭",Db:"D♭",Cb:"B",Fb:"E",eb:"E♭",gb:"G♭",ab:"A♭",bb:"B♭",db:"D♭",cb:"B",fb:"E"},STOSHARP={"E#":"F","G#":"G♯","A#":"A♯","B#":"C","D#":"D♯","C#":"C♯","F#":"F♯","e#":"F","g#":"G♯","a#":"A♯","b#":"C","d#":"D♯","c#":"C♯","f#":"F♯"},NOTESSHARP=["C","C♯","D","D♯","E","F","F♯","G","G♯","A","A♯","B"],NOTESFLAT=["C","D♭","D","E♭","E","F","G♭","G","A♭","A","B♭","B"],NOTESFLAT2=["c","d♭","d","e♭","e","f","g♭","g","a♭","a","b♭","b"],EQUIVALENTNOTES={"C♯":"D♭","D♯":"E♭","F♯":"G♭","G♯":"A♭","A♯":"B♭","D♭":"C♯","E♭":"D♯","G♭":"F♯","A♭":"G♯","B♭":"A♯"},EXTRATRANSPOSITIONS={"E♯":["F",0],"B♯":["C",1],"C♭":["B",-1],"F♭":["E",0],"e♯":["F",0],"b♯":["C",1],"c♭":["B",-1],"f♭":["E",0]},SOLFEGENAMES=["do","re","mi","fa","sol","la","ti"],SOLFEGECONVERSIONTABLE={C:"do","C♯":"do♯",D:"re","D♯":"re♯",E:"mi",F:"fa","F♯":"fa♯",G:"sol","G♯":"sol♯",A:"la","A♯":"la♯",B:"ti","D♭":"re♭","E♭":"mi♭","G♭":"sol♭","A♭":"la♭","B♭":"ti♭",R:_("rest")},WESTERN2EISOLFEGENAMES={do:"sa",re:"re",mi:"ga",fa:"ma",sol:"pa",la:"dha",ti:"ni"},PITCHES=["C","D♭","D","E♭","E","F","G♭","G","A♭","A","B♭","B"],PITCHES1=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],PITCHES2=["C","C♯","D","D♯","E","F","F♯","G","G♯","A","A♯","B"],PITCHES3=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],NOTESTABLE={1:"do",2:"do♯",3:"re",4:"re♯",5:"mi",6:"fa",7:"fa♯",8:"sol",9:"sol♯",10:"la",11:"la♯",0:"ti"},NOTESTEP={C:1,D:3,E:5,F:6,G:8,A:10,B:12},AUGMENTED={1:1,2:2,3:5,4:6,5:8,6:9,7:11,8:13},PERFECT={1:0,4:5,5:7,8:12},DIMINISHED={1:-1,2:0,3:2,4:4,5:6,6:7,7:9,8:11},MAJOR={2:2,3:4,6:9,7:11},MINOR={2:1,3:3,6:8,7:10},SOLFNOTES=["ti","la","sol","fa","mi","re","do"],EASTINDIANSOLFNOTES=["ni","dha","pa","ma","ga","re","sa"],SOLFATTRS=["♯♯","♯","♮","♭","♭♭"];function mod12(e){for(;e<0;)e+=12;return e%12}function calcAugmented(e){var t=e[0],n=e[1];return t<0?12*n-AUGMENTED[-t]:AUGMENTED[t]+12*n}function calcPerfect(e){var t=e[0],n=e[1];return t<0?12*n-PERFECT[-t]:PERFECT[t]+12*n}function calcDiminished(e){var t=e[0],n=e[1];return t<0?12*n-DIMINISHED[-t]:DIMINISHED[t]+12*n}function calcMajor(e){var t=e[0],n=e[1];return t<0?12*n-MAJOR[-t]:MAJOR[t]+12*n}function calcMinor(e){var t=e[0],n=e[1];return t<0?12*n-MINOR[-t]:MINOR[t]+12*n}const SEMITONES=12,POWER2=[1,2,4,8,16,32,64,128],TWELTHROOT2=1.0594630943592953,TWELVEHUNDRETHROOT2=1.0005777895065548,A0=27.5,C8=4186.01,RHYTHMRULERHEIGHT=100,SLIDERHEIGHT=200,SLIDERWIDTH=50,MATRIXBUTTONCOLOR="#c374e9",MATRIXLABELCOLOR="#90c100",MATRIXNOTECELLCOLOR="#b1db00",MATRIXTUPLETCELLCOLOR="#57e751",MATRIXRHYTHMCELLCOLOR="#c8c8c8",MATRIXBUTTONCOLORHOVER="#c894e0",MATRIXNOTECELLCOLORHOVER="#c2e820",MATRIXSOLFEWIDTH=52,EIGHTHNOTEWIDTH=24,MATRIXBUTTONHEIGHT=40,MATRIXBUTTONHEIGHT2=66,MATRIXSOLFEHEIGHT=30,wholeNoteImg="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(WHOLENOTE))),halfNoteImg="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(HALFNOTE))),quarterNoteImg="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(QUARTERNOTE))),eighthNoteImg="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(EIGHTHNOTE))),sixteenthNoteImg="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(SIXTEENTHNOTE))),thirtysecondNoteImg="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(THIRTYSECONDNOTE))),sixtyfourthNoteImg="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(SIXTYFOURTHNOTE))),NOTESYMBOLS={1:wholeNoteImg,2:halfNoteImg,4:quarterNoteImg,8:eighthNoteImg,16:sixteenthNoteImg,32:thirtysecondNoteImg,64:sixtyfourthNoteImg},MUSICALMODES={chromatic:[1,1,1,1,1,1,1,1,1,1,1,1],algerian:[2,1,2,1,1,1,3,1],diminished:[2,1,2,1,2,1,2,1],spanish:[1,2,1,1,1,2,2,2],ocatonic:[1,2,1,2,1,2,1,2],major:[2,2,1,2,2,2,1],ionian:[2,2,1,2,2,2,1],dorian:[2,1,2,2,2,1,2],phrygian:[1,2,2,2,1,2,2],lydian:[2,2,2,1,2,2,1],mixolydian:[2,2,1,2,2,1,2],minor:[2,1,2,2,1,2,2],aeolian:[2,1,2,2,1,2,2],locrian:[1,2,2,1,2,2,2],"jazz minor":[2,1,2,2,2,2,1],bebop:[1,1,1,2,2,1,2],arabic:[2,2,1,1,2,2,2],byzantine:[1,3,1,2,1,3,1],enigmatic:[1,3,2,2,2,1,1],ethiopian:[2,1,2,2,1,2,2],geez:[2,1,2,2,1,2,2],hindu:[2,2,1,2,1,2,2],hungarian:[2,1,3,1,1,3,1],maqam:[1,3,1,2,1,3,1],"romanian minor":[2,1,3,1,2,1,2],"spanish gypsy":[1,3,1,2,1,2,2],blues:[3,2,1,1,3,2],"major blues":[2,1,1,3,2,2],"whole tone":[2,2,2,2,2,2],pentatonic:[3,2,2,3,2],chinese:[4,2,1,4,1],egyptian:[2,3,2,3,2],hirajoshi:[1,4,1,4,2],japanese:[1,4,2,3,2],fibonacci:[1,1,2,3,5],custom:[1,1,1,1,1,1,1,1,1,1,1,1]},MAQAMTABLE={"hijaz kar":"C maqam","hijaz kar maqam":"C maqam",shahnaz:"D maqam","maqam mustar":"Eb maqam","maqam jiharkah":"F maqam","shadd araban":"G maqam",suzidil:"A maqam",ajam:"Bb maqam","ajam maqam":"Bb maqam"};var MODENAMES=[[_("chromatic"),"chromatic"],[_("algerian"),"algerian"],[_("diminished"),"diminished"],[_("spanish"),"spanish"],[_("octatonic"),"octatonic"],[_("major"),"major"],[_("ionian"),"ionian"],[_("dorian"),"dorian"],[_("phrygian"),"phrygian"],[_("lydian"),"lydian"],[_("mixolydian"),"mixolydian"],[_("minor"),"minor"],[_("aeolian"),"aeolian"],[_("locrian"),"locrian"],[_("jazz minor"),"jazz minor"],[_("bebop"),"bebop"],[_("arabic"),"arabic"],[_("byzantine"),"byzantine"],[_("enigmatic"),"enigmatic"],[_("ethiopian"),"ethiopian"],[_("geez"),"geez"],[_("hindu"),"hindu"],[_("hungarian"),"hungarian"],[_("romanian minor"),"romanian minor"],[_("spanish gypsy"),"spanish gypsy"],[_("maqam"),"maqam"],[_("blues"),"blues"],[_("major blues"),"major blues"],[_("whole tone"),"whole tone"],[_("pentatonic"),"pentatonic"],[_("chinese"),"chinese"],[_("egyptian"),"egyptian"],[_("hirajoshi"),"hirajoshi"],[_("japanese"),"japanese"],[_("fibonacci"),"fibonacci"],[_("custom"),"custom"]],VOICENAMES=[[_("violin"),"violin","images/voices.svg"],[_("cello"),"cello","images/voices.svg"],[_("poly"),"poly","images/synth.svg"],[_("sine"),"sine","images/synth.svg"],[_("square"),"square","images/synth.svg"],[_("sawtooth"),"sawtooth","images/synth.svg"],[_("triangle"),"triangle","images/synth.svg"]],DRUMNAMES=[[_("snare drum"),"snare drum","images/snaredrum.svg"],[_("kick drum"),"kick drum","images/kick.svg"],[_("tom tom"),"tom tom","images/tom.svg"],[_("floor tom tom"),"floor tom tom","images/floortom.svg"],[_("cup drum"),"cup drum","images/cup.svg"],[_("darbuka drum"),"darbuka drum","images/darbuka.svg"],[_("hi hat"),"hi hat","images/hihat.svg"],[_("ride bell"),"ride bell","images/ridebell.svg"],[_("cow bell"),"cow bell","images/cowbell.svg"],[_("triangle bell"),"trianglebell","images/trianglebell.svg"],[_("finger cymbals"),"finger cymbals","images/fingercymbals.svg"],[_("chine"),"chine","images/chine.svg"],[_("clang"),"clang","images/clang.svg"],[_("crash"),"crash","images/crash.svg"],[_("bottle"),"bottle","images/bottle.svg"],[_("clap"),"clap","images/clap.svg"],[_("slap"),"slap","images/slap.svg"],[_("splash"),"splash","images/splash.svg"],[_("bubbles"),"bubbles","images/bubbles.svg"],[_("cat"),"cat","images/cat.svg"],[_("cricket"),"cricket","images/cricket.svg"],[_("dog"),"dog","images/dog.svg"],[_("duck"),"duck","images/duck.svg"]];const DEFAULTVOICE="sine",DEFAULTDRUM="kick drum",DEFAULTMODE="major";var customMode=MUSICALMODES.custom;const SAMPLECENTERNO={violin:63,cello:39,basse:15};function getModeName(e){for(var t in MODENAMES)if(MODENAMES[t][0]===e||MODENAMES[t][1].toLowerCase()===e.toLowerCase())return""!=MODENAMES[t][0]?MODENAMES[t][0]:(console.log("I18n for mode name is misbehaving."),console.log(e+" "+e.toLowerCase()+" "+MODENAMES[t][0].toLowerCase()+" "+MODENAMES[t][1].toLowerCase()),MODENAMES[t][1]);return console.log(e+" not found in MODENAMES"),e}function initModeI18N(){for(var e=0;e<MODENAMES.length;e++)null==MODENAMES[e][0]&&(MODENAMES[e][0]=_(MODENAMES[e][1])),null==MODENAMES[e][0]&&(MODENAMES[e][0]=MODENAMES[e][1])}function initVoiceI18N(){for(var e=0;e<VOICENAMES.length;e++)null==VOICENAMES[e][0]&&(VOICENAMES[e][0]=_(VOICENAMES[e][1])),null==VOICENAMES[e][0]&&(VOICENAMES[e][0]=VOICENAMES[e][1])}function initDrumI18N(){for(var e=0;e<DRUMNAMES.length;e++)null!=DRUMNAMES[e][0]&&""!==DRUMNAMES[e][0]||(DRUMNAMES[e][0]=_(DRUMNAMES[e][1])),null==DRUMNAMES[e][0]&&(DRUMNAMES[e][0]=DRUMNAMES[e][1])}function getDrumName(e){if(""===e)console.log("getDrumName passed blank name. Returning kick drum"),e="kick drum";else if("http"==e.slice(0,4))return null;for(var t=0;t<DRUMNAMES.length;t++)if(DRUMNAMES[t][0].toLowerCase()===e.toLowerCase()||DRUMNAMES[t][1].toLowerCase()===e.toLowerCase())return""!=DRUMNAMES[t][0]?DRUMNAMES[t][0]:(console.log("I18n is misbehaving when parsing drum name: "+e),DRUMNAMES[t][1]);return null}function getDrumIcon(e){if(""===e)console.log("getDrumIcon passed blank name. Returning kick drum"),e="kick drum";else if("http"==e.slice(0,4))return"images/drum.svg";for(var t=0;t<DRUMNAMES.length;t++)if(DRUMNAMES[t][0]===e||DRUMNAMES[t][1].toLowerCase()===e.toLowerCase())return DRUMNAMES[t][2];return"images/drum.svg"}function getDrumSynthName(e){if(null==e||null==e)return console.log("getDrumSynthName passed null name. Returning null"),null;if(""===e)console.log("getDrumSynthName passed blank name. Returning kick drum"),e="kick drum";else if("http"==e.slice(0,4))return e;for(var t=0;t<DRUMNAMES.length;t++)if(DRUMNAMES[t][0]===e||DRUMNAMES[t][1].toLowerCase()===e.toLowerCase())return DRUMNAMES[t][1];return null}function getVoiceName(e){if(""===e)console.log("getVoiceName passed blank name. Returning sine"),e="sine";else if("http"==e.slice(0,4))return null;for(var t=0;t<VOICENAMES.length;t++)if(VOICENAMES[t][0]===e||VOICENAMES[t][1]===e)return""!=VOICENAMES[t][0]?VOICENAMES[t][0]:(console.log("I18n is misbehaving when parsing voice name: "+e),VOICENAMES[t][1]);return null}function getVoiceIcon(e){if(""===e)console.log("getVoiceIcon passed blank name. Returning sine"),e="sine";else if("http"==e.slice(0,4))return"images/voices.svg";for(var t=0;t<VOICENAMES.length;t++)if(VOICENAMES[t][0]===e||VOICENAMES[t][1]===e)return VOICENAMES[t][2];return"images/voices.svg"}function getVoiceSynthName(e){if(null==e||null==e)return console.log("getVoiceSynthName passed null name. Returning null"),null;if(""===e)console.log("getVoiceSynthName passed blank name. Returning sine"),e="sine";else if("http"==e.slice(0,4))return e;for(var t=0;t<VOICENAMES.length;t++)if(VOICENAMES[t][0]===e||VOICENAMES[t][1]===e)return VOICENAMES[t][1];return null}function keySignatureToMode(e){if(""===e)return console.log("No key signature provided; reverting to C major."),["C","major"];e.toLowerCase()in MAQAMTABLE&&(e=MAQAMTABLE[e.toLowerCase()]);var t=!1;if(1===(i=e.split(" ")).length&&"m"===i[0][i[0].length-1]&&(t=!0,i[0]=i[0].slice(0,i[0].length-1)),i[0]in BTOFLAT)var n=BTOFLAT[i[0]];else if(i[0]in STOSHARP)n=STOSHARP[i[0]];else n=i[0];if(-1===NOTESSHARP.indexOf(n)&&-1===NOTESFLAT.indexOf(n)){console.log("Invalid key or missing name; reverting to C.");var i=(e="C "+e).split(" ");n="C"}if(t)return[n,"minor"];for(var a="",o=1;o<i.length;o++)""!==i[o]&&(""===a?a=i[o]:a+=" "+i[o]);a=getModeName(a=""===a?"major":a.toLowerCase());for(o=0;o<MODENAMES.length;o++)if(MODENAMES[o][0]===a){a=MODENAMES[o][1];break}return a in MUSICALMODES?[n,a]:(console.log("Invalid mode name: "+a+" reverting to major."),[n,"major"])}function getStepSizeUp(e,t){return _getStepSize(e,t,"up")}function getStepSizeDown(e,t){return _getStepSize(e,t,"down")}function _getStepSize(e,t,n){var i=_buildScale(e),a=i[0],o=i[1];return t in BTOFLAT?t=BTOFLAT[t]:t in STOSHARP&&(t=STOSHARP[t]),ii=a.indexOf(t),-1!==ii?"up"===n?o[ii]:ii>0?-o[ii-1]:-last(o):(t in EQUIVALENTNOTES&&(t=EQUIVALENTNOTES[t]),ii=a.indexOf(t),-1!==ii?"up"===n?o[ii]:ii>0?-o[ii-1]:-last(o):(console.log(t+" not found in key of "+e),1))}function _buildScale(e){var t=keySignatureToMode(e),n=t[0];if("CUSTOM"===t[1])var i=customMode;else i=MUSICALMODES[t[1]];if(-1!==NOTESFLAT.indexOf(n))var a=NOTESFLAT;else a=NOTESSHARP;var o=a.indexOf(n);-1===o&&(o=0);for(var s=[n],r=o,l=0;l<i.length;l++)r+=i[l],s.push(a[r%12]);return[s,i]}function scaleDegreeToPitch(e,t){var n=_buildScale(e)[0];return t-=1,n[t%=n.length-1]}function getScaleAndHalfSteps(e){var t=keySignatureToMode(e),n=t[0];if("CUSTOM"===t[1])var i=customMode;else i=MUSICALMODES[t[1]];for(var a=[],o=0;o<i.length;o++){a.push(SOLFEGENAMES[o]);for(var s=1;s<i[o];s++)a.push("")}if(-1!==NOTESFLAT.indexOf(n))var r=NOTESFLAT;else r=NOTESSHARP;return n in EXTRATRANSPOSITIONS&&(n=EXTRATRANSPOSITIONS[n][0]),[r,a,n,t[1]]}function getInterval(e,t,n){var i=_buildScale(t),a=i[0],o=i[1];if(n in BTOFLAT)n=BTOFLAT[n],s=a.indexOf(n);else if(n in STOSHARP)n=STOSHARP[n],s=a.indexOf(n);else if(-1!==a.indexOf(n))s=a.indexOf(n);else if(n in EQUIVALENTNOTES)n=EQUIVALENTNOTES[n],-1!==a.indexOf(n)?s=a.indexOf(n):(console.log("Note "+n+" not in scale "+t),s=0);else var s=SOLFEGENAMES.indexOf(n);if(e>0){for(var r=Math.floor(e/12),l=Math.floor(e)%12,c=0,u=0;u<l-1;u++)c+=o[(s+u)%o.length];return c+12*r}for(r=Math.ceil(e/12),l=Math.ceil(e)%12,c=0,u=0;u>l+1;u--){for(var g=(s+u-1)%o.length;g<0;)g+=o.length;c-=o[g]}return c+12*r}function calcNoteValueToDisplay(e,t){var n=e/t,i=null;return i=null!=NOTESYMBOLS&&n in NOTESYMBOLS?"1<br>&mdash;<br>"+n.toString()+'<br><img src="'+NOTESYMBOLS[n]+'" height='+20*this.cellScale+">":reducedFraction(t,e),parseInt(n)<n&&(i=parseInt(1.5*n),null!=NOTESYMBOLS&&i in NOTESYMBOLS?i="1.5<br>&mdash;<br>"+i.toString()+'<br><img src="'+NOTESYMBOLS[i]+'" height='+20*this.cellScale+"> .":(i=parseInt(1.75*n),i=null!=NOTESYMBOLS&&i in NOTESYMBOLS?"1.75<br>&mdash;<br>"+i.toString()+'<br><img src="'+NOTESYMBOLS[i]+'" height='+20*this.cellScale+"> ..":reducedFraction(t,e))),i}function durationToNoteValue(e){for(var t=0;t<3;t++){var n=e*(2-1/Math.pow(2,t));if(-1!==POWER2.indexOf(n))return[n,t,null]}for(var i=e,a=1;a<POWER2.length;a++)if(i<POWER2[a]){i=POWER2[a-1];break}-1===POWER2.indexOf(i)&&(i=128);for(var o=1,s=e;2*Math.floor(s/2)===s;)o*=2,s/=2;return o>1?[e,0,s,i]:[1,0,e,i]}function toFraction(e){if(e>1){var t=!0;e=1/e}else t=!1;for(var n=1,i=1,a=1;Math.abs(n-e)>1e-8;)n<e?i+=1:(a+=1,i=parseInt(e*a)),n=i/a;if(t){var o=i;i=a,a=o}return[i,a]}function frequencyToPitch(e){if(e<A0)return["A",0];if(e>C8)return["C",8];for(var t=0,n=0;n<8800;n++){var i=A0*Math.pow(1.0005777895065548,n);if(e<1.0003*i&&e>.9997*i){t=n%100;var a=Math.floor(n/100);return[PITCHES[(a+PITCHES.indexOf("A"))%12],Math.floor((a+PITCHES.indexOf("A"))/12),t]}}return console.log("Could not find note/octave/cents for "+e),["?",-1,0]}function numberToPitch(e){if(e<0){for(var t=0;e<0;)e+=12,t+=1;return[PITCHES[(e+PITCHES.indexOf("A"))%12],Math.floor((e+PITCHES.indexOf("A"))/12)-t]}return[PITCHES[(e+PITCHES.indexOf("A"))%12],Math.floor((e+PITCHES.indexOf("A"))/12)]}function noteToPitchOctave(e){var t=e.length,n=last(e);return[e.substring(0,t-1),Number(n)]}function noteToFrequency(e,t){var n=noteToPitchOctave(e);return pitchToFrequency(n[0],n[1],0,t)}function pitchToFrequency(e,t,n,i){var a=pitchToNumber(e,t,i);return 0===n?A0*Math.pow(TWELTHROOT2,a):A0*Math.pow(1.0005777895065548,100*a+n)}function pitchToNumber(e,t,n){if("R"===e.toUpperCase())return 0;var i=0,a=e.length;if(a>1){if(a>2){var o=e.slice(a-2);"bb"===o||"♭♭"===o?(e=e.slice(0,a-2),i-=2):"##"===o||"♯♯"===o?(e=e.slice(0,a-2),i+=2):"#b"!==o&&"♯♭"!==o&&"b#"!==o&&"♭♯"!==o||(e=e.slice(0,a-2))}if(e.length>1){var s=e.slice(a-1);"b"===s||"♭"===s?(e=e.slice(0,a-1),i-=1):"#"!==s&&"♯"!==s||(e=e.slice(0,a-1),i+=1)}}var r=0;if(-1!==PITCHES.indexOf(e))r=PITCHES.indexOf(e.toUpperCase());else{var l=getScaleAndHalfSteps(n);-1!==l[1].indexOf(e.toLowerCase())?r=l[1].indexOf(e.toLowerCase()):(console.log("pitch "+e+" not found."),r=0)}return 12*t+r-PITCHES.indexOf("A")+i}function noteIsSolfege(e){return null==SOLFEGECONVERSIONTABLE[e]}function getSolfege(e){return noteIsSolfege(e)?e:SOLFEGECONVERSIONTABLE[e]}function i18nSolfege(e){var t=_("ti la sol fa mi re do").split(" "),n=splitSolfege(e),i=SOLFNOTES.indexOf(n[0]);return-1!==i?t[i]+n[1]:(console.log(e+" not found."),e)}function splitSolfege(e){if(null!=e)if(-1!==SOLFNOTES.indexOf(e))var t=e,n="";else if("sol"===e.slice(0,3)){t="sol";if(4===e.length)n=e[3];else n=e[3]+e[3]}else{t=e.slice(0,2);if(3===e.length)n=e[2];else n=e[2]+e[2]}else t="sol",n="";return[t,n]}function getNumber(e,t){if(t<0)var n=0;else if(t>10)n=108;else n=12*(t-1);if((e=String(e)).substring(0,1)in NOTESTEP&&(n+=NOTESTEP[e.substring(0,1)],e.length>=1)){var i=e.substring(1);"bb"===i||"♭♭"===i?n-=2:"##"===i||"♯♯"===i?n+=2:"b"===i||"♭"===i?n-=1:"#"!==i&&"♯"!==i||(n+=1)}return n}function getNumNote(e,t){var n=e+t,i=Math.floor(n/12),a=NOTESTABLE[n%=12];return"ti"===a[n]&&(i-=1),[a,i+1]}function isInt(e){return!isNaN(e)&&parseInt(Number(e))==e&&!isNaN(parseInt(e,10))}function reducedFraction(e,t){greatestCommonMultiple=function(e,t){return 0===t?e:greatestCommonMultiple(t,e%t)};var n=greatestCommonMultiple(e,t);return null!=NOTESYMBOLS&&-1!==[1,2,4,8,16,32,64].indexOf(t/n)?e/n+"<br>&mdash;<br>"+t/n+"<br><img src="+NOTESYMBOLS[t/n]+">":e/n+"<br>&mdash;<br>"+t/n+"<br><br>"}function Synth(){_THIS_IS_MUSIC_BLOCKS_&&(this.tone=new Tone),this.synthset={poly:[null,null],sine:[null,null],triangle:[null,null],sawtooth:[null,null],square:[null,null],pluck:[null,null],violin:[VIOLINSOUNDSAMPLE,null],cello:[CELLOSOUNDSAMPLE,null],basse:[BASSESOUNDSAMPLE,null],bottle:[BOTTLESOUNDSAMPLE,null],clap:[CLAPSOUNDSAMPLE,null],"darbuka drum":[DARBUKASOUNDSAMPLE,null],"hi hat":[HIHATSOUNDSAMPLE,null],splash:[SPLASHSOUNDSAMPLE,null],bubbles:[BUBBLESSOUNDSAMPLE,null],"cow bell":[COWBELLSOUNDSAMPLE,null],dog:[DOGSOUNDSAMPLE,null],"kick drum":[KICKSOUNDSAMPLE,null],"tom tom":[TOMSOUNDSAMPLE,null],cat:[CATSOUNDSAMPLE,null],crash:[CRASHSOUNDSAMPLE,null],duck:[DUCKSOUNDSAMPLE,null],"ride bell":[RIDEBELLSOUNDSAMPLE,null],"triangle bell":[TRIANGLESOUNDSAMPLE,null],chine:[CHINESOUNDSAMPLE,null],cricket:[CRICKETSOUNDSAMPLE,null],"finger cymbals":[FINGERCYMBALSSOUNDSAMPLE,null],slap:[SLAPSOUNDSAMPLE,null],clang:[CLANGSOUNDSAMPLE,null],"cup drum":[CUPSOUNDSAMPLE,null],"floor tom tom":[FLOORTOMSOUNDSAMPLE,null],"snare drum":[SNARESOUNDSAMPLE,null]},_THIS_IS_MUSIC_BLOCKS_&&(Tone.Buffer.onload=function(){console.log("drum loaded")}),this.getSynthByName=function(e){if(null==e||null==e)return this.synthset.poly[1];switch(e){case"pluck":case"triangle":case"square":case"sawtooth":case"sine":return this.synthset[e][1];case"violin":case"cello":case"basse":return this.synthset[e][1];case"default":case"poly":return this.synthset.poly[1];default:var t=getDrumSynthName(e);if("http"==e.slice(0,4))return e in this.synthset?this.synthset[e][1]:(console.log("no synth by that name"),null);if(null!=t)return this.synthset[t][1];if("drum"===e)return this.synthset["kick drum"][1]}return this.synthset.poly[1]},this.loadSynth=function(e){if(null==this.getSynthByName(e))switch(console.log("loading synth for "+e),e){case"pluck":this.synthset.pluck[1]=new Tone.PluckSynth;break;case"triangle":case"square":case"sawtooth":case"sine":var t={oscillator:{type:e},envelope:{attack:.03,decay:0,sustain:1,release:.03}};this.synthset[e][1]=new Tone.Synth(t);break;case"poly":case"default":this.synthset.poly[1]=new Tone.PolySynth(6,Tone.AMSynth);break;case"violin":case"cello":case"basse":this.synthset[e][1]=new Tone.Sampler(this.synthset[e][0]);break;default:"http"==e.slice(0,4)||"file"==e.slice(0,4)?this.synthset[e]=[e,new Tone.Sampler(e)]:this.synthset[e][1]=new Tone.Sampler(this.synthset[e][0])}this.getSynthByName(e).toMaster()},this.performNotes=function(e,t,n,i,a,o){if(i){var s=new Tone.Vibrato(1/o,a);e.chain(s,Tone.Master),e.triggerAttackRelease(t,n),setTimeout((function(){s.dispose()}),1e3*n)}else e.triggerAttackRelease(t,n)},this.trigger=function(e,t,n,i){var a=!1,o=0,s=0;switch(2==i.length&&0!=i[0]&&(a=!0,o=i[0],s=i[1]),n){case"pluck":case"triangle":case"square":case"sawtooth":case"sine":if("object"==typeof e)var r=e[0];else r=e;this.performNotes(this.synthset[n][1],r,t,a,o,s);break;case"violin":case"cello":case"basse":var l=SAMPLECENTERNO[n],c=noteToPitchOctave(e),u=pitchToNumber(c[0],c[1],"C Major");this.performNotes(this.synthset[n][1],u-l,t,a,o,s);break;case"default":case"poly":this.performNotes(this.synthset.poly[1],e,t,a,o,s);break;default:var g=getDrumSynthName(n);null!=g?""===g&&n in this.synthset?this.synthset[n][1].triggerAttack(0,t):g in this.synthset?null==this.synthset[g][1]?console.log("Something has gone terribly wrong: "+n+", "+g):this.synthset[g][1].triggerAttack(0):"http"==n.slice(0,4)||"file"==n.slice(0,4)?this.synthset[n][1].triggerAttack(0,t):console.log("Something has gone terribly wrong: "+n+", "+g):"drum"===n?this.synthset["kick drum"][1].triggerAttack(0,t,1):"http"==n.slice(0,4)||"file"==n.slice(0,4)?this.synthset[n][1].triggerAttack(0,t,1):this.performNotes(this.synthset.poly[1],e,t,a,o,s)}},this.stopSound=function(e){this.getSynthByName(e).triggerRelease()},this.start=function(){Tone.Transport.start()},this.stop=function(){Tone.Transport.stop()},this.setVolume=function(e){var t=this.tone.gainToDb(e/100);Tone.Master.volume.rampTo(t,.01)},this.getOscillator=function(e,t){return new Tone.Oscillator(e,t).toMaster()}}calcOctave=function(e,t){switch(t){case _("next"):case"next":return Math.min(e+1,10);case _("previous"):case"previous":return Math.max(e-1,1);case _("current"):case"current":return e;default:return Math.floor(t)}},calcOctaveInterval=function(e){var t=0;switch(e){case 1:case _("next"):case"next":t=1;break;case-1:case _("previous"):case"previous":t=-1;break;case _("current"):case"current":case 0:t=0;break;case 2:t=2;break;case-2:t=-2;break;default:console.log("Interval octave must be between -2 and 2."),t=0}return t};