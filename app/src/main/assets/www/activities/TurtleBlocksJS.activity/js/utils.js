function format(e,t){return(e=e.replace(/{([a-zA-Z0-9.]*)}/g,(function(o,n){return x=t,n.split(".").forEach((function(t){void 0===x&&console.log("Undefined value in template string",e,n,x,t),x=x[t]})),x}))).replace(/{_([a-zA-Z0-9]+)}/g,(function(e,t){return _(t)}))}function canvasPixelRatio(){var e=window.devicePixelRatio||1,t=document.querySelector("#myCanvas").getContext("2d");return e/(t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1)}function windowHeight(){return/Android/i.test(navigator.userAgent)?window.outerHeight:window.innerHeight}function windowWidth(){return/Android/i.test(navigator.userAgent)?window.outerWidth:window.innerWidth}function httpGet(e){var t=null;if(t=new XMLHttpRequest,null===e?(t.open("GET",window.server,!1),t.setRequestHeader("x-api-key","3tgTzMXbbw6xEKX7")):(t.open("GET",window.server+e,!1),t.setRequestHeader("x-api-key","3tgTzMXbbw6xEKX7")),t.send(),t.status>299)throw"Error from server";return t.responseText}function httpPost(e,t){var o=null;return(o=new XMLHttpRequest).open("POST",window.server+e,!1),o.setRequestHeader("x-api-key","3tgTzMXbbw6xEKX7"),o.send(t),"https://apps.facebook.com/turtleblocks/?file="+e}function HttpRequest(e,t,o){var n=this.request=new XMLHttpRequest;this.handler=t,this.url=e,this.localmode=Boolean(0===self.location.href.search(/^file:/i)),this.userCallback=o;var a=this;try{n.open("GET",e),n.onreadystatechange=function(){a.handler()},n.send("")}catch(t){self.console&&console.log("Failed to load resource from "+e+": Network error."),"function"==typeof o&&o(!1,"network error"),this.request=this.handler=this.userCallback=null}}function docByTagName(e){document.getElementsByTagName(e)}function docById(e){return document.getElementById(e)}function last(e){var t=e.length;return 0===t?null:e[t-1]}function doSVG(e,t,o,n,a,r){var i="";for(var l in o.turtleList)o.turtleList[l].closeSVG(),i+=o.turtleList[l].svgOutput;var s='<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg xmlns="http://www.w3.org/2000/svg" width="'+n+'" height="'+a+'">\n';return s+='<g transform="scale('+r+","+r+')">\n',s+=t.svgOutput,s+="</g>",s+=""===i?'<g transform="matrix(20,0,0,20,-2500,-200)"> <g style="font-size:20px;font-family:Sans;text-anchor:end;fill:#000000" transform="translate(0.32906,-0.2)"> <path d="m 138.47094,26.82 q 0,-1.16 1.24,-2.02 0.96,-0.64 1.94,-0.64 0.68,0.02 1.18,0.34 l 0,-11.84 0.44,0 0,12.94 q 0,1.32 -1.34,2.1 -0.86,0.5 -1.8,0.5 -0.98,0 -1.44,-0.7 -0.22,-0.32 -0.22,-0.68 z" /> </g> <g transform="translate(-12.52094,4.8)" style="font-size:20px;font-family:Sans;text-anchor:end;fill:#000000"> <path d="m 138.47094,26.82 q 0,-1.16 1.24,-2.02 0.96,-0.64 1.94,-0.64 0.68,0.02 1.18,0.34 l 0,-11.84 0.44,0 0,12.94 q 0,1.32 -1.34,2.1 -0.86,0.5 -1.8,0.5 -0.98,0 -1.44,-0.7 -0.22,-0.32 -0.22,-0.68 z" /> </g> <path style="fill:#000000;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" d="m 130.81346,17 12.29007,-5 0,2 -12.29007,5 z" /> </g>':i,s+="</svg>"}function isSVGEmpty(e){for(var t in e.turtleList)if(e.turtleList[t].closeSVG(),""!==e.turtleList[t].svgOutput)return!1;return!0}function fileExt(e){var t=e.split(".");return 1===t.length||""===t[0]&&2===t.length?"":t.pop()}function fileBasename(e){var t=e.split(".");return 1===t.length?t[0]:""===t[0]&&2===t.length?e:(t.pop(),t.join("."))}function _(e){replaced=e,replace=[",","(",")","?","¿","<",">",".",'"\n','"',":","%s","%d","/","'",";","×","!","¡"];for(var t=0;t<replace.length;t++)replaced=replaced.replace(replace[t],"");replaced=replaced.replace(/ /g,"-");try{return translation=document.webL10n.get(replaced),""===translation&&(translation=e),translation}catch(t){return console.log("i18n error: "+e),e}}function toTitleCase(e){if("string"==typeof e){var t="";return e.length>1&&(t=e.substring(1)),e.toUpperCase()[0]+t}}function processRawPluginData(e,t,o,n,a,r,i,l,s,c){for(var u=e.split("\n"),d="",L=0;L<u.length;L++)0!==u[L].length&&"/"!==u[L][0]&&(d+=u[L]);try{var g=processPluginData(d.replace(/\n/g,""),t,o,a,r,i,l,s,c)}catch(e){g=null;n("Error loading plugin: "+e)}return g}function processPluginData(pluginData,palettes,blocks,evalFlowDict,evalArgDict,evalParameterDict,evalSetterDict,evalOnStartList,evalOnStopList){var obj=JSON.parse(pluginData),newPalette=!1;if("PALETTEPLUGINS"in obj)for(var name in obj.PALETTEPLUGINS){PALETTEICONS[name]=obj.PALETTEPLUGINS[name];var fillColor="#ff0066";if("PALETTEFILLCOLORS"in obj&&name in obj.PALETTEFILLCOLORS)var fillColor=obj.PALETTEFILLCOLORS[name];PALETTEFILLCOLORS[name]=fillColor;var strokeColor="#ef003e";if("PALETTESTROKECOLORS"in obj&&name in obj.PALETTESTROKECOLORS)var strokeColor=obj.PALETTESTROKECOLORS[name];PALETTESTROKECOLORS[name]=strokeColor;var highlightColor="#ffb1b3";if("PALETTEHIGHLIGHTCOLORS"in obj&&name in obj.PALETTEHIGHLIGHTCOLORS)var highlightColor=obj.PALETTEHIGHLIGHTCOLORS[name];PALETTEHIGHLIGHTCOLORS[name]=highlightColor;var strokeHighlightColor="#404040";if("HIGHLIGHTSTROKECOLORS"in obj&&name in obj.HIGHLIGHTSTROKECOLORS)var strokeHighlightColor=obj.HIGHLIGHTSTROKECOLORS[name];HIGHLIGHTSTROKECOLORS[name]=strokeHighlightColor,name in palettes.buttons?console.log("palette "+name+" already exists"):(console.log("adding palette "+name),palettes.add(name),newPalette=!0)}if(newPalette)try{palettes.makePalettes()}catch(e){console.log("makePalettes: "+e)}if("IMAGES"in obj)for(var blkName in obj.IMAGES)pluginsImages[blkName]=obj.IMAGES[blkName];if("FLOWPLUGINS"in obj)for(var flow in obj.FLOWPLUGINS)evalFlowDict[flow]=obj.FLOWPLUGINS[flow];if("ARGPLUGINS"in obj)for(var arg in obj.ARGPLUGINS)evalArgDict[arg]=obj.ARGPLUGINS[arg];if("SETTERPLUGINS"in obj)for(var setter in obj.SETTERPLUGINS)evalSetterDict[setter]=obj.SETTERPLUGINS[setter];if("BLOCKPLUGINS"in obj)for(var block in obj.BLOCKPLUGINS){console.log("adding plugin block "+block);try{eval(obj.BLOCKPLUGINS[block])}catch(e){console.log("Failed to load plugin for "+block+": "+e)}}if("GLOBALS"in obj&&eval(obj.GLOBALS),"PARAMETERPLUGINS"in obj)for(var parameter in obj.PARAMETERPLUGINS)evalParameterDict[parameter]=obj.PARAMETERPLUGINS[parameter];if("ONLOAD"in obj)for(var arg in obj.ONLOAD)eval(obj.ONLOAD[arg]);if("ONSTART"in obj)for(var arg in obj.ONSTART)evalOnStartList[arg]=obj.ONSTART[arg];if("ONSTOP"in obj)for(var arg in obj.ONSTOP)evalOnStopList[arg]=obj.ONSTOP[arg];for(var protoblock in blocks.protoBlockDict)void 0===blocks.protoBlockDict[protoblock].palette?console.log("Cannot find palette for protoblock "+protoblock):blocks.protoBlockDict[protoblock].palette.add(blocks.protoBlockDict[protoblock]);return palettes.updatePalettes(),blocks.findBlockTypes(),obj}function updatePluginObj(e){for(var t in e.PALETTEPLUGINS)pluginObjs.PALETTEPLUGINS[t]=e.PALETTEPLUGINS[t];for(var t in e.PALETTEFILLCOLORS)pluginObjs.PALETTEFILLCOLORS[t]=e.PALETTEFILLCOLORS[t];for(var t in e.PALETTESTROKECOLORS)pluginObjs.PALETTESTROKECOLORS[t]=e.PALETTESTROKECOLORS[t];for(var t in e.PALETTEHIGHLIGHTCOLORS)pluginObjs.PALETTEHIGHLIGHTCOLORS[t]=e.PALETTEHIGHLIGHTCOLORS[t];for(var o in e.FLOWPLUGINS)pluginObjs.FLOWPLUGINS[o]=e.FLOWPLUGINS[o];for(var n in e.ARGPLUGINS)pluginObjs.ARGPLUGINS[n]=e.ARGPLUGINS[n];for(var a in e.BLOCKPLUGINS)pluginObjs.BLOCKPLUGINS[a]=e.BLOCKPLUGINS[a];for(var t in"GLOBALS"in e&&("GLOBALS"in pluginObjs||(pluginObjs.GLOBALS=""),pluginObjs.GLOBALS+=e.GLOBALS),"IMAGES"in e&&(pluginObjs.IMAGES=e.IMAGES),e.ONLOAD)pluginObjs.ONLOAD[t]=e.ONLOAD[t];for(var t in e.ONSTART)pluginObjs.ONSTART[t]=e.ONSTART[t];for(var t in e.ONSTOP)pluginObjs.ONSTOP[t]=e.ONSTOP[t]}function preparePluginExports(e){return updatePluginObj(e),JSON.stringify(pluginObjs)}function processMacroData(e,t,o,n){if("{}"!==e){var a=JSON.parse(e);for(var r in t.add("myblocks","black","#a0a0a0"),a)console.log("adding "+r+" to macroDict"),n[r]=a[r],o.addToMyPalette(r,n[r]);t.makePalettes()}}function prepareMacroExports(e,t,o){return null!==e&&(o[e]=t),JSON.stringify(o)}function doSaveSVG(e,t){download(t,"data:image/svg+xml;utf8,"+doSVG(e.canvas,e,e.turtles,e.canvas.width,e.canvas.height,1),t,'"width='+e.canvas.width+", height="+e.canvas.height+'"')}function doSaveLilypond(e,t){download(t,"data:text;utf8,"+encodeURIComponent(e.lilypondOutput),t,'"width='+e.canvas.width+", height="+e.canvas.height+'"')}function download(e,t){var o=document.createElement("a");o.setAttribute("href",t),o.setAttribute("download",e),document.body.appendChild(o),o.click(),document.body.removeChild(o)}function doPublish(e){var t=doSave();console.log("push "+t+" to FB");var o=e+" "+docById("description").value+" "+t;console.log("comment: "+o);FB.login((function(){FB.api("/me/feed","post",{message:o})}),{scope:"publish_actions"})}var hasSetupCamera=!1;function doUseCamera(e,t,o,n,a,r,i){var l=320,s=240,c=!1,u=document.querySelector("#camVideo"),d=document.querySelector("#camCanvas");function draw(){d.width=l,d.height=s,d.getContext("2d").drawImage(u,0,0,l,s);var n=d.toDataURL("image/png");t.turtleList[o].doShowImage(e[0],n)}navigator.getMedia=navigator.getUserMedia||navigator.mozGetUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia,void 0===navigator.getMedia&&i("Your browser does not support the webcam"),hasSetupCamera?(c=!0,u.play(),n?(a=window.setInterval(draw,100),r(a)):draw()):navigator.getMedia({video:!0,audio:!1},(function(e){if(navigator.mozGetUserMedia)u.mozSrcObject=e;else{var t=window.URL||window.webkitURL;u.src=t.createObjectURL(e)}u.play(),hasSetupCamera=!0}),(function(e){i("Could not connect to camera"),console.log("Could not connect to camera",e)})),u.addEventListener("canplay",(function(e){console.log("canplay",c,hasSetupCamera),c||(u.setAttribute("width",l),u.setAttribute("height",s),d.setAttribute("width",l),d.setAttribute("height",s),c=!0,n?(a=window.setInterval(draw,100),r(a)):draw())}),!1)}function doStopVideoCam(e,t){null!==e&&window.clearInterval(e),t(null),document.querySelector("#camVideo").pause()}function hideDOMLabel(){var e=docById("textLabel");null!==e&&(e.style.display="none");var t=docById("numberLabel");null!==t&&(t.style.display="none");var o=docById("solfegeLabel");null!==o&&(o.style.display="none");var n=docById("notenameLabel");null!==n&&(n.style.display="none");var a=docById("noteattrLabel");null!==a&&(a.style.display="none");var r=docById("drumnameLabel");null!==r&&(r.style.display="none");var i=docById("voicenameLabel");null!==i&&(i.style.display="none");var l=docById("modenameLabel");null!==l&&(l.style.display="none")}function displayMsg(e,t){}function toFixed2(e){return e!==Math.floor(e)?e.toFixed(2).toString():e.toString()}function mixedNumber(e){var t=Math.floor(e);if(e>t){var o=rationalToFraction(e-t);return 0===t?o[0]+"/"+o[1]:1===o[0]&&1===o[1]?t+1:o[1]>99?e.toFixed(2):t+" "+o[0]+"/"+o[1]}return e.toString()}function LCD(e,t){return Math.abs(e*t/GCD(e,t))}function GCD(e,t){for(e=Math.abs(e),t=Math.abs(t);t;){var o=t;t=e%t,e=o}return e}function rationalToFraction(e){if(e>1){var t=!0;e=1/e}else t=!1;for(var o=1,n=1,a=1;Math.abs(o-e)>1e-8;)o<e?n+=1:(a+=1,n=Math.floor(e*a)),o=n/a;return 0===a||0===n?[0,1]:t?[a,n]:[n,a]}