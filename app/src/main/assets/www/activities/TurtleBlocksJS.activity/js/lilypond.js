const LILYPONDHEADER='\\version "2.18.2"\n\n% ****************************************************************\n% \n% WHAT IS THIS? -- This is a LilyPond file generated from Music\n% Blocks software (Read about it at www.musicblocks.net).\n% \n% DOWNLOAD LILYPOND -- In order to create notation with this file,\n% you will need to download and install LilyPond software onto your\n% computer (http://lilypond.org/download.html). Frescobaldi\n% software is also handy for editing LilyPond files\n% (http://frescobaldi.org/download).\n% \n% LILYPOND INSTRUCTIONS -- For instructions on how to further\n% manipulate musical notation using LilyPond software, please\n% read the Introduction (http://lilypond.org/text-input.html) and\n% the Manual\n% (http://lilypond.org/doc/v2.18/Documentation/learning/index.html).\n% \n% GLOSSARY -- A glossary with helpful examples may be found here\n% (http://www.lilypond.org/doc/v2.19/Documentation/music-glossary/).\n% \n% MUTOPIA -- You may also benefit from studying scores from the\n% Mutopia Project website, which has freely sharable music notation\n% generated with LilyPond (http://www.mutopiaproject.org/).\n% \n% LILYBIN -- You can explore your Lilypond output in a web browser at\n% (http://lilybin.com/).\n% \n% COMMENTS -- Some of the code below is commented out. You can\n% enable it by deleting the % that precedes the text or, in the\n% case of a commented section, deleting the %{ and %} that surrounds\n% the section.\n% \n% ****************************************************************\n\n% Please add your own name, the title of your musical creation,\n% and the intended copyright below.\n% The copyright is great for sharing (and re-sharing)!\n% Read more about it here (http://creativecommons.org/licenses/by-sa/4.0/).\n% Of course, you can use any copyright you like -- you made it!\n\\header {\n   dedication = \\markup {\n      \\abs-fontsize #8 \\sans "Made with LilyPond and Music Blocks" \\with-url #"http://walterbender.github.io/musicblocks/" {\n         \\abs-fontsize #8 \\sans "(http://walterbender.github.io/musicblocks/)"\n      }\n   }\n   title = "My Music Blocks Creation"\n%   subtitle = "Subtitle"\n%   instrument = "Instrument"\n   composer = "Mr. Mouse"\n%   arranger = "Arranger"\n   copyright = "Mr. Mouse (c) 2015 -- CC-BY-SA"\n   tagline = "Made from Music Blocks v.0.9"\n   footer = \\markup {\n      \\with-url #"http://walterbender.github.io/musicblocks/" "Made with Music Blocks Software v.0.9." Engraved on \\simple #(strftime "%Y-%m-%d" (localtime (current-time)))\n   }\n   currentYear = \\markup {\n      \\simple #(strftime "%Y" (localtime (current-time)))\n   }\n   copyTag =  " free to distribute, modify, and perform"\n   copyType = \\markup {\n      \\with-url #"http://creativecommons.org/licenses/by-sa/3.0/" "Creative Commons Attribution ShareAlike 3.0 (Unported) License "\n   }\n   copyright = \\markup {\n      \\override #\'(baseline-skip . 0 ) \\right-column {\n         \\sans \\bold \\with-url #"http://musicblocks.net" {\n            \\abs-fontsize #9  "Music " \\concat {\n               \\abs-fontsize #12 \\with-color #white \\char ##x01C0 \\abs-fontsize #9 "Blocks "\n            }\n         }\n      }\n      \\override #\'(baseline-skip . 0 ) \\center-column {\n         \\abs-fontsize #11.9 \\with-color #grey \\bold {\n            \\char ##x01C0 \\char ##x01C0\n         }\n      }\n      \\override #\'(baseline-skip . 0 ) \\column {\n         \\abs-fontsize #8 \\sans \\concat {\n            " Typeset using " \\with-url #"http://www.lilypond.org" "LilyPond software " \\char ##x00A9 " " \\currentYear " by " \\composer " " \\char ##x2014 " " \\footer\n         }\n         \\concat {\n            \\concat {\n               \\abs-fontsize #8 \\sans {\n                  " " \\copyType \\char ##x2014 \\copyTag\n               }\n            }\n            \\abs-fontsize #13 \\with-color #white \\char ##x01C0\n         }\n      }\n   }\n   tagline = ##f\n}\n\n% To change the meter make adjustments in the following section.\n% You must also delete the % before \\meter everywhere it appears below.\nmeter = {\n   \\time 3/4\n   \\key c \\minor\n   \\numericTimeSignature\n   \\partial 4 \n   \\tempo "Andante" 4=90\n}\n\n',RODENTS=[_("mouse"),_("brown rat"),_("mole"),_("chipmunk"),_("red squirrel"),_("guinea pig"),_("capybara"),_("coypu"),_("black rat"),_("grey squirrel"),_("flying squirrel"),_("bat")],RODENTSEN=["mouse","brown rat","mole","chipmunk","red squirrel","guinea pig","capybara","coypu","black rat","grey squirrel","flying squirrel","bat"],RODENTSSHORT=[_("m"),_("br"),_("ml"),_("ch"),_("rs"),_("gp"),_("cb"),_("cp"),_("bk"),_("gs"),_("fs"),_("bt")],RODENTSSHORTEN=["m","br","ml","ch","rs","gp","cb","cp","bk","gs","fs","bt"],LYNOTE=0,LYDURATION=1,LYDOTCOUNT=2,LYTUPLETVALUE=3,LYROUNDDOWN=4,LYINSIDECHORD=5,LYSTACCATO=6,CLEFS=["treble","bass","bass_8","percussion"];getLilypondHeader=function(){return LILYPONDHEADER},updateLilypondNotation=function(n,t,o,e,l){var i=durationToNoteValue(o);e in n.lilypondStaging||(n.lilypondStaging[e]=[]),n.turtles.turtleList[e].drum&&(t="c'"),n.lilypondStaging[e].push([t,i[0],i[1],i[2],i[3],l,n.staccato[e].length>0&&last(n.staccato[e])>0])},processLilypondNotes=function(n,t){function __toLilynote(n){if("number"==typeof n){var t=frequencyToPitch(n);n=t[0]+t[1]}return n.replace(/♯/g,"is").replace(/♭/g,"es").replace(/10/g,"''''''''").replace(/1/g,",,").replace(/2/g,",").replace(/3/g,"").replace(/4/g,"'").replace(/5/g,"''").replace(/6/g,"'''").replace(/7/g,"''''").replace(/8/g,"''''''").replace(/9/g,"'''''''").toLowerCase()}n.lilypondNotes[t]="";for(var o=0,e=!1,l=!1,i=0,a=0,r=0;r<n.lilypondStaging[t].length;r++)if(obj=n.lilypondStaging[t][r],"string"==typeof obj)"break"===obj?(r>0&&(n.lilypondNotes[t]+="\n"),o=0):"("===obj?e=!0:"begin articulation"===obj?l=!0:"end articulation"===obj?l=!1:n.lilypondNotes[t]+=obj;else{o%8==0&&o>0&&(n.lilypondNotes[t]+="\n"),o+=1;var s=__toLilynote(obj[0]),p=0;if(null!=obj[3]){i=1/n.lilypondStaging[t][r][1],a=1/n.lilypondStaging[t][r][4];for(var u=1,d=1;d<obj[3];){if(r+u>=n.lilypondStaging[t].length){p=u;break}if(n.lilypondStaging[t][r+u][5]>0&&n.lilypondStaging[t][r+u][5]===n.lilypondStaging[t][r+u-1][5])u++;else{if(n.lilypondStaging[t][r+u][3]!==obj[3]){p=u;break}i+=1/n.lilypondStaging[t][r+u][1],a+=1/n.lilypondStaging[t][r+u][4],u++,d++}}}function __processTuplet(n,t,o,e){for(var l=0,i=0;i<e;){n.lilypondStaging[t][o+l][1];n.lilypondStaging[t][o+l][5]>0?((0===o&&0===l||n.lilypondStaging[t][o+l-1][5]!==n.lilypondStaging[t][o+l][5])&&(n.lilypondNotes[t]+="<"),n.lilypondNotes[t]+=__toLilynote(n.lilypondStaging[t][o+l][0]),obj[6]&&(n.lilypondNotes[t]+="\\staccato"),n.lilypondNotes[t]+=" ",o+l!==n.lilypondStaging[t].length-1&&n.lilypondStaging[t][o+l+1][5]===n.lilypondStaging[t][o+l][5]||(n.lilypondNotes[t]+=">"+n.lilypondStaging[t][o+l+1][4]+" ",i++),l++):(n.lilypondNotes[t]+=__toLilynote(n.lilypondStaging[t][o+l][0])+n.lilypondStaging[t][o+l][4],obj[6]&&(n.lilypondNotes[t]+="\\staccato"),n.lilypondNotes[t]+=" ",l++,i++)}if(o+l-1<n.lilypondStaging[t].length-1){var a=n.lilypondStaging[t][o+l];"string"==typeof a&&")"===a?(n.lilypondNotes[t]+=")} ",o+=1):n.lilypondNotes[t]+="} "}else n.lilypondNotes[t]+="} ";return l}if(obj[3]>0){if(0===p){var g=toFraction(a/i);n.lilypondNotes[t]+="\\tuplet "+g[0]+"/"+g[1]+" { ",r+=__processTuplet(n,t,r,obj[3])-1}else{g=toFraction(obj[3]/p);n.lilypondNotes[t]+="\\tuplet "+g[0]+"/"+g[1]+" { ",r+=__processTuplet(n,t,r,p)-1}i=0,a=0}else{if(obj[5]>0){if(0!==r&&n.lilypondStaging[t][r-1][5]===obj[5]||(n.lilypondNotes[t]+="<"),n.lilypondNotes[t]+=s,r===n.lilypondStaging[t].length-1||n.lilypondStaging[t][r+1][5]!==obj[5]){n.lilypondNotes[t]+=">",n.lilypondNotes[t]+=obj[1];for(var c=0;c<obj[2];c++)n.lilypondNotes[t]+=".";l&&(n.lilypondNotes[t]+="->"),n.lilypondNotes[t]+=" "}}else{n.lilypondNotes[t]+=s+obj[1];for(c=0;c<obj[2];c++)n.lilypondNotes[t]+=".";l&&(n.lilypondNotes[t]+="->")}obj[6]&&(n.lilypondNotes[t]+="\\staccato"),i=0,a=0}n.lilypondNotes[t]+=" ",e&&(e=!1,n.lilypondNotes[t]+="(")}},lilypondLineBreak=function(n,t){null==n.lilypondStaging[t]&&(n.lilypondStaging[t]=[]),n.lilypondStaging[t].push("break")},lilypondBeginArticulation=function(n,t){null==n.lilypondStaging[t]&&(n.lilypondStaging[t]=[]),n.lilypondStaging[t].push("begin articulation")},lilypondEndArticulation=function(n,t){n.lilypondStaging[t].push("end articulation")},lilypondBeginCrescendo=function(n,t,o){null==n.lilypondStaging[t]&&(n.lilypondStaging[t]=[]),o>0?n.lilypondStaging[t].push("\\< "):n.lilypondStaging[t].push("\\> ")},lilypondEndCrescendo=function(n,t){n.lilypondStaging[t].push("\\! ")},lilypondBeginSlur=function(n,t){null==n.lilypondStaging[t]&&(n.lilypondStaging[t]=[]),n.lilypondStaging[t].push("(")},lilypondEndSlur=function(n,t){n.lilypondStaging[t].push(") ")},lilypondInsertTie=function(n,t){null==n.lilypondStaging[t]&&(n.lilypondStaging[t]=[]),n.lilypondStaging[t].push("~")},lilypondRemoveTie=function(n,t){n.lilypondStaging[t].pop()},saveLilypondOutput=function(n,t){var o=0,e=[];for(var l in n.lilypondStaging)o+=1;console.log("saving as lilypond: "+o),n.lilypondOutput+="% You can change the MIDI instruments below to anything on logo list:\n% (http://lilypond.org/doc/v2.18/documentation/notation/midi-instruments)\n\n";var i=0;for(var l in n.lilypondStaging){if(n.lilypondStaging[l].length>0){for(var a=0,r=0,s=0;s<n.lilypondStaging[l].length;s++)if(obj=n.lilypondStaging[l][s],"object"==typeof obj)if(obj[0].length<2);else{if("string"==typeof obj[0])a+=Number(obj[0].substr(-1));else a+=frequencyToPitch(obj[0])[1];r+=1}if(n.turtles.turtleList[l].drum)e.push("percussion");else if(r>0)switch(Math.floor(a/r)){case 0:case 1:case 2:e.push("bass_8");break;case 3:e.push("bass");break;default:e.push("treble")}else e.push("treble");processLilypondNotes(n,l),((u=n.turtles.turtleList[l].name)===_("start")||u===_("start drum")||u===l.toString())&&(u=RODENTS[l%12]),""===u&&(u=RODENTSEN[l%12]),u=u.replace(/ /g,"_"),n.lilypondOutput+=u+" = {\n",n.lilypondOutput+="% \\meter\n",n.lilypondOutput+=n.lilypondNotes[l],i===o-1&&(n.lilypondOutput+=' \\bar "|."'),n.lilypondOutput+="\n}\n\n";var p=RODENTSSHORT[l%12];""===p&&(p=RODENTSSHORTEN[l%12]),n.lilypondOutput+=u.replace(/ /g,"_")+"Voice = ",n.turtles.turtleList[l].drum?n.lilypondOutput+="\\new DrumStaff \\with {\n":n.lilypondOutput+="\\new Staff \\with {\n",n.lilypondOutput+='   \\clef "'+last(e)+'"\n',n.lilypondOutput+='   instrumentName = "'+u+'"\n',n.lilypondOutput+='   shortInstrumentName = "'+p+'"\n',n.lilypondOutput+='   midiInstrument = "acoustic grand"\n',n.lilypondOutput+='\n   \\remove "Note_heads_engraver"\n   \\consists "Completion_heads_engraver"\n   \\remove "Rest_engraver"\n   \\consists "Completion_rest_engraver"\n',n.lilypondOutput+='} { \\clef "'+last(e)+'" \\'+u.replace(/ /g,"_")+" }\n\n"}i+=1}n.lilypondOutput+="\n\\score {\n",n.lilypondOutput+="   <<\n";for(i=0;i<CLEFS.length;i++){s=0;for(var l in n.lilypondNotes){if(e[s]===CLEFS[i])if(n.lilypondStaging[l].length>0)((u=n.turtles.turtleList[l].name)===_("start")||u===_("start drum")||u===l.toString())&&(u=RODENTS[l%12]),u=u.replace(/ /g,"_"),n.lilypondOutput+="      \\"+u+"Voice\n"}}n.lilypondOutput+='\n\n% GUITAR TAB SECTION\n% Delete the %{ and %} below to include guitar tablature output.\n%{\n      \\new TabStaff = "guitar tab" \n      <<\n         \\clef moderntab\n';for(i=0;i<CLEFS.length;i++){s=0;for(var l in n.lilypondNotes){var u;if(e[s]===CLEFS[i])if(n.lilypondStaging[l].length>0)((u=n.turtles.turtleList[l].name)===_("start")||u===_("start drum")||u===l.toString())&&(u=RODENTS[l%12]),u=u.replace(/ /g,"_"),n.lilypondOutput+='         \\context TabVoice = "'+u+'" \\'+u.replace(/ /g,"_")+"\n"}}n.lilypondOutput+="      >>\n%}\n",n.lilypondOutput+="\n   >>\n   \\layout {}\n\n",n.lilypondOutput+="% MIDI SECTION\n% Delete the %{ and %} below to include MIDI output.\n%{\n\\midi {\n   \\tempo 4=90\n}\n%}\n\n}\n\n",n.lilypondOutput+="% MUSIC BLOCKS CODE\n",n.lilypondOutput+="% Below is the code for the Music Blocks project that generated logo Lilypond file.\n%{\n\n";var d=prepareExport();n.lilypondOutput+=d.replace(/]],/g,"]],\n"),n.lilypondOutput+="\n%}\n\n",doSaveLilypond(n,t)};