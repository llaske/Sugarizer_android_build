const SAVEBOXSVG='<svg xmlns="http://www.w3.org/2000/svg" height="133" width="360" version="1.1"> <rect style="fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:none" y="0" x="0" height="133" width="360" /> <g style="fill:#000000;display:block" transform="translate(306.943,-1.053)"> <path style="fill:#000000;display:inline" d="m 27.557,5.053 c -12.43,0 -22.5,10.076 -22.5,22.497 0,12.432 10.07,22.503 22.5,22.503 12.431,0 22.5,-10.071 22.5,-22.503 0,-12.421 -10.07,-22.497 -22.5,-22.497 z m 10.199,28.159 c 1.254,1.256 1.257,3.291 0,4.545 -0.628,0.629 -1.451,0.943 -2.274,0.943 -0.822,0 -1.644,-0.314 -2.27,-0.94 l -5.76,-5.761 -5.76,5.761 c -0.627,0.626 -1.449,0.94 -2.271,0.94 -0.823,0 -1.647,-0.314 -2.275,-0.943 -1.254,-1.254 -1.254,-3.289 0.004,-4.545 l 5.758,-5.758 -5.758,-5.758 c -1.258,-1.254 -1.258,-3.292 -0.004,-4.546 1.255,-1.254 3.292,-1.259 4.546,0 l 5.76,5.759 5.76,-5.759 c 1.252,-1.259 3.288,-1.254 4.544,0 1.257,1.254 1.254,3.292 0,4.546 l -5.758,5.758 5.758,5.758 z" /> </g> <rect style="fill:#92b5c8;fill-opacity:1;stroke:none" y="51" x="0" height="82" width="360" /> <rect y="0.76763773" x="0.76764059" height="131.46472" width="358.46472" style="display:inline;visibility:visible;opacity:1;fill:none;fill-opacity:1;stroke:#000000;stroke-width:1.5;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-opacity:1;" /></svg>';function SaveBox(){this._canvas=null,this._stage=null,this._refreshCanvas=null,this._doSaveTB=null,this._doSaveSVG=null,this._doSavePNG=null,this._doUploadToPlanet=null,this._doShareOnFacebook=null,this._container=null,this._bounds=null,this.save=null,this.close=null,this._scale=1,this.setCanvas=function(i){return this._canvas=i,this},this.setStage=function(i){return this._stage=i,this},this.setSaveTB=function(i){return this._doSaveTB=i,this},this.setSaveSVG=function(i){return this._doSaveSVG=i,this},this.setSavePNG=function(i){return this._doSavePNG=i,this},this.setSaveFB=function(i){return this._doShareOnFacebook=i,this},this.setSavePlanet=function(i){return this._doUploadToPlanet=i,this},this.setRefreshCanvas=function(i){return this._refreshCanvas=i,this},this.init=function(i,t,e,s){if(null===this._container){this.createBox(i,t,e);var n=this;this.saveTB=s("save-tb",_("Save as .tb"),this._container.x+50,this._container.y+85,55,0,this._stage),this.saveTB.visible=!0,this.positionHoverText(this.saveTB),this.saveTB.on("click",(function(i){n.hide(),n._doSaveTB()})),this.saveSVG=s("save-svg",_("Save as .svg"),this._container.x+115,this._container.y+85,55,0,this._stage),this.saveSVG.visible=!0,this.positionHoverText(this.saveSVG),this.saveSVG.on("click",(function(i){n.hide(),n._doSaveSVG()})),this.savePNG=s("save-png-inactive",_("Save as .png"),this._container.x+180,this._container.y+85,55,0,this._stage),this.savePNG.visible=!0,this.positionHoverText(this.savePNG),this.savePNG.on("click",(function(i){n.hide(),n._doSavePNG()})),this.uploadToPlanet=s("upload-planet",_("Upload to Planet"),this._container.x+245,this._container.y+85,55,0,this._stage),this.uploadToPlanet.visible=!0,this.positionHoverText(this.uploadToPlanet),this.uploadToPlanet.on("click",(function(i){n.hide(),n._doUploadToPlanet()})),this.shareOnFb=s("fb-inactive",_("Share on Facebook"),this._container.x+310,this._container.y+85,55,0,this._stage),this.shareOnFb.visible=!0,this.positionHoverText(this.shareOnFb),this.shareOnFb.on("click",(function(i){n.hide(),n._doShareOnFacebook()}))}else this.show()},this.positionHoverText=function(i){for(var t=0;t<i.children.length;t++)if(null!=i.children[t].text){i.children[t].textAlign="left",i.children[t].x=-27,i.children[t].y=27;break}},this.hide=function(){null!==this._container&&(this.saveTB.visible=!1,this.saveSVG.visible=!1,this.savePNG.visible=!1,this.uploadToPlanet.visible=!1,this.shareOnFb.visible=!1,this._container.visible=!1,this._refreshCanvas())},this.show=function(){null!==this._container&&(this.saveTB.visible=!0,this.saveSVG.visible=!0,this.savePNG.visible=!0,this.uploadToPlanet.visible=!0,this.shareOnFb.visible=!0,this._container.visible=!0,this._refreshCanvas())},this.createBox=function(i,t,e){this._scale=i,null==this._container&&(this._container=new createjs.Container,this._stage.addChild(this._container),this._container.x=Math.floor((this._canvas.width/i-180)/2),this._container.y=27,this._makeBoxBitmap(SAVEBOXSVG,"box",(function __processBackground(i,t,e,s){i._container.addChild(e),i._loadUtilityContainerHandler();var n=new createjs.Shape;i._bounds=i._container.getBounds(),i._container.cache(i._bounds.x,i._bounds.y,i._bounds.width,i._bounds.height),n.graphics.beginFill("#FFF").drawRect(i._bounds.x,i._bounds.y,i._bounds.width,i._bounds.height),n.x=0,n.y=0,i._container.hitArea=n}),null))},this._makeBoxBitmap=function(i,t,e,s){var n=new Image,a=this;n.onload=function(){var i=new createjs.Bitmap(n);e(a,t,i,s)},n.src="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(i)))},this._loadUtilityContainerHandler=function(){var i=!1,t=this;this._container.on("click",(function(e){if(i)console.log("debouncing click");else{i=!0,setTimeout((function(){i=!1}),500);e.stageX,t._scale,t._container.x;e.stageY/t._scale-t._container.y<55&&t.hide()}}))}}