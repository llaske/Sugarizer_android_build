function PluginsViewer(e,i,n,t,s){this.canvas=e,this.stage=i,this.refreshCanvas=n,this.closeViewer=t,this.loadPlugin=s,this.dict={},this.pluginFiles=[],this.container=null,this.prev=null,this.next=null,this.page=0,this.server=!0,this.setServer=function(e){this.server=e},this.hide=function(){null!==this.container&&(this.container.visible=!1,this.refreshCanvas())},this.show=function(e){if(this.scale=e,this.page=0,this.server)try{var i=httpGet(),n=JSON.parse(i);for(var t in n)if("svg"===fileExt(n[t])){var s=fileBasename(n[t]);-1===this.pluginFiles.indexOf(s)&&this.pluginFiles.push(s)}for(var t in this.pluginFiles){!(this.pluginFiles[t]+".json")in n&&this.pluginFiles.remove(this.pluginFiles[t])}}catch(e){return console.log(e),!1}else this.pluginFiles=SAMPLEPLUGINS;if(console.log("found these projects: "+this.pluginFiles.sort()),null!==this.container)return this.container.visible=!0,this.refreshCanvas(),this.completeInit(),!0;this.container=new createjs.Container,this.stage.addChild(this.container),this.container.x=Math.floor((this.canvas.width/e-650)/2),this.container.y=27,makeViewerBitmap(this,BACKGROUND,"viewer",(function processBackground(e,i,n,t){e.container.addChild(n),makeViewerBitmap(e,PREVBUTTON,"viewer",(function processPrev(e,i,n,t){e.prev=n,e.container.addChild(e.prev),e.prev.x=270,e.prev.y=535,makeViewerBitmap(e,NEXTBUTTON,"viewer",(function processNext(e,i,n,t){return e.next=n,e.container.addChild(e.next),e.next.x=325,e.next.y=535,e.container.visible=!0,e.refreshCanvas(),e.completeInit(),loadThumbnailContainerHandler(e),!0}),null)}),null)}),null)},this.downloadImage=function(e,i){var n="data:image/svg+xml;utf8,",t=this.pluginFiles[e]+".svg";if(this.server)var s=n+httpGet(t);else s=n+SAMPLESSVG[t];var a=new Image,l=this;a.onload=function(){bitmap=new createjs.Bitmap(s),bitmap.scaleX=.5,bitmap.scaleY=.5,l.container.addChild(bitmap),lastChild=last(l.container.children),l.container.swapChildren(bitmap,lastChild),l.dict[l.pluginFiles[e]]=bitmap,x=5+e%4*160,y=55+120*Math.floor(e%16/4),l.dict[l.pluginFiles[e]].x=x,l.dict[l.pluginFiles[e]].y=y,l.dict[l.pluginFiles[e]].visible=!0,l.refreshCanvas(),null!==i&&i(l,e+1)},a.src=s},this.completeInit=function(){this.prepareNextImage(this,0)},this.prepareNextImage=function(e,i){i<e.pluginFiles.length&&i<16*e.page+16?e.pluginFiles[i]in e.dict?(x=5+i%4*160,y=55+120*Math.floor(i%16/4),e.dict[e.pluginFiles[i]].x=x,e.dict[e.pluginFiles[i]].y=y,e.dict[e.pluginFiles[i]].visible=!0,e.prepareNextImage(e,i+1)):e.downloadImage(i,e.prepareNextImage):(0===e.page&&(e.prev.visible=!1),16*(e.page+1)<e.pluginFiles.length&&(e.next.visible=!0),e.refreshCanvas())}}function hideCurrentPage(e){for(var i=16*e.page,n=Math.min(e.pluginFiles.length,16*(e.page+1)),t=i;t<n;t++)e.dict[e.pluginFiles[t]].visible=!1;e.page-=1,0===e.page&&(e.prev.visible=!1),16*(e.page+1)<e.pluginFiles.length&&(e.next.visible=!0);for(i=16*e.page,n=Math.min(e.pluginFiles.length,16*(e.page+1)),t=i;t<n;t++)e.dict[e.pluginFiles[t]].visible=!0;e.refreshCanvas()}function showNextPage(e){for(var i=16*e.page,n=Math.min(e.pluginFiles.length,16*(e.page+1)),t=i;t<n;t++)e.dict[e.pluginFiles[t]].visible=!1;e.page+=1,e.prev.visible=!0,16*(e.page+1)+1>e.pluginFiles.length&&(e.next.visible=!1),e.prepareNextImage(e,n),e.refreshCanvas()}function viewerClicked(e,i){var n=i.stageX/e.scale-e.container.x,t=i.stageY/e.scale-e.container.y;if(n>600&&t<55)e.hide(),e.closeViewer();else if(t>535)e.prev.visible&&n<325?hideCurrentPage(e):e.next.visible&&n>325&&showNextPage(e);else{var s=Math.floor((n-5)/160),a=4*Math.floor((t-55)/120)+s+16*e.page;a<e.pluginFiles.length&&(e.hide(),e.closeViewer(),e.loadPlugin(e.pluginFiles[a]+".json"))}}function loadThumbnailContainerHandler(e){var i,n,t,s,a=new createjs.Shape;a.graphics.beginFill("#FFF").drawRect(0,0,650,590),a.x=0,a.y=0,e.container.hitArea=a;var l=!1;e.container.on("click",(function(i){l?console.log("debouncing click"):(l=!0,setTimeout((function(){l=!1}),500),viewerClicked(e,i))})),e.container.on("mousedown",(function(e){i=e.stageX,n=e.stageY,l=!0})),e.container.on("pressup",(function(a){t=a.stageX,(s=a.stageY)>n+30||t>i+30?e.next.visible&&showNextPage(e):s<n-30||t<i-30?e.prev.visible&&hideCurrentPage(e):(l=!1,viewerClicked(e,a))}))}function makeViewerBitmap(e,i,n,t,s){var a=new Image;a.onload=function(){bitmap=new createjs.Bitmap(a),t(e,n,bitmap,s)},a.src="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(i)))}