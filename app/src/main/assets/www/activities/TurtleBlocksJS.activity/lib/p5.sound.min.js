/*! p5.sound.min.js v0.3.2 2016-11-01 */
!function(r,s){"function"==typeof define&&define.amd?define("p5.sound",["p5"],(function(r){s(r)})):s("object"==typeof exports?require("../p5"):r.p5)}(this,(function(p5){var sndcore,master,helpers,errorHandler,panner,soundfile,amplitude,fft,Tone_core_Tone,Tone_signal_SignalBase,Tone_signal_WaveShaper,Tone_core_Type,Tone_core_Param,Tone_core_Gain,Tone_signal_Signal,Tone_signal_Add,Tone_signal_Multiply,Tone_signal_Scale,signal,oscillator,Tone_core_Timeline,Tone_signal_TimelineSignal,env,pulse,noise,audioin,filter,delay,reverb,Tone_core_TimelineState,Tone_core_Clock,metro,looper,soundRecorder,peakdetect,gain,distortion,src_app;sndcore=function(){"use strict";!function(r,s,a){function o(r){r&&(r.setTargetAtTime||(r.setTargetAtTime=r.setTargetValueAtTime))}s=s||{},window.hasOwnProperty("webkitAudioContext")&&!window.hasOwnProperty("AudioContext")&&(window.AudioContext=webkitAudioContext,"function"!=typeof AudioContext.prototype.createGain&&(AudioContext.prototype.createGain=AudioContext.prototype.createGainNode),"function"!=typeof AudioContext.prototype.createDelay&&(AudioContext.prototype.createDelay=AudioContext.prototype.createDelayNode),"function"!=typeof AudioContext.prototype.createScriptProcessor&&(AudioContext.prototype.createScriptProcessor=AudioContext.prototype.createJavaScriptNode),"function"!=typeof AudioContext.prototype.createPeriodicWave&&(AudioContext.prototype.createPeriodicWave=AudioContext.prototype.createWaveTable),AudioContext.prototype.internal_createGain=AudioContext.prototype.createGain,AudioContext.prototype.createGain=function(){var r=this.internal_createGain();return o(r.gain),r},AudioContext.prototype.internal_createDelay=AudioContext.prototype.createDelay,AudioContext.prototype.createDelay=function(r){var s=r?this.internal_createDelay(r):this.internal_createDelay();return o(s.delayTime),s},AudioContext.prototype.internal_createBufferSource=AudioContext.prototype.createBufferSource,AudioContext.prototype.createBufferSource=function(){var r=this.internal_createBufferSource();return r.start?(r.internal_start=r.start,r.start=function(s,a,c){void 0!==c?r.internal_start(s||0,a,c):r.internal_start(s||0,a||0)}):r.start=function(r,s,a){s||a?this.noteGrainOn(r||0,s,a):this.noteOn(r||0)},r.stop?(r.internal_stop=r.stop,r.stop=function(s){r.internal_stop(s||0)}):r.stop=function(r){this.noteOff(r||0)},o(r.playbackRate),r},AudioContext.prototype.internal_createDynamicsCompressor=AudioContext.prototype.createDynamicsCompressor,AudioContext.prototype.createDynamicsCompressor=function(){var r=this.internal_createDynamicsCompressor();return o(r.threshold),o(r.knee),o(r.ratio),o(r.reduction),o(r.attack),o(r.release),r},AudioContext.prototype.internal_createBiquadFilter=AudioContext.prototype.createBiquadFilter,AudioContext.prototype.createBiquadFilter=function(){var r=this.internal_createBiquadFilter();return o(r.frequency),o(r.detune),o(r.Q),o(r.gain),r},"function"!=typeof AudioContext.prototype.createOscillator&&(AudioContext.prototype.internal_createOscillator=AudioContext.prototype.createOscillator,AudioContext.prototype.createOscillator=function(){var r=this.internal_createOscillator();return r.start?(r.internal_start=r.start,r.start=function(s){r.internal_start(s||0)}):r.start=function(r){this.noteOn(r||0)},r.stop?(r.internal_stop=r.stop,r.stop=function(s){r.internal_stop(s||0)}):r.stop=function(r){this.noteOff(r||0)},r.setPeriodicWave||(r.setPeriodicWave=r.setWaveTable),o(r.frequency),o(r.detune),r})),window.hasOwnProperty("webkitOfflineAudioContext")&&!window.hasOwnProperty("OfflineAudioContext")&&(window.OfflineAudioContext=webkitOfflineAudioContext)}(window);var r=new window.AudioContext;p5.prototype.getAudioContext=function(){return r},navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;var s=document.createElement("audio");p5.prototype.isSupported=function(){return!!s.canPlayType};if(p5.prototype.isFileSupported=function(r){switch(r.toLowerCase()){case"mp3":return!!s.canPlayType&&s.canPlayType("audio/mpeg;");case"wav":return!!s.canPlayType&&s.canPlayType('audio/wav; codecs="1"');case"ogg":return!!s.canPlayType&&s.canPlayType('audio/ogg; codecs="vorbis"');case"mp4":return!!s.canPlayType&&(s.canPlayType("audio/x-m4a;")||s.canPlayType("audio/aac;"));case"aiff":return!!s.canPlayType&&s.canPlayType("audio/x-aiff;");default:return!1}},!!navigator.userAgent.match(/(iPad|iPhone|iPod)/g)){var a=!1,p=function(){if(!a){var s=r.createBuffer(1,1,22050),c=r.createBufferSource();c.buffer=s,c.connect(r.destination),c.start(0),console.log("start ios!"),"running"===r.state&&(a=!0)}};document.addEventListener("touchend",p,!1),document.addEventListener("touchstart",p,!1)}}(),master=function(){"use strict";var r=new function(){var r=p5.prototype.getAudioContext();this.input=r.createGain(),this.output=r.createGain(),this.limiter=r.createDynamicsCompressor(),this.limiter.threshold.value=0,this.limiter.ratio.value=20,this.audiocontext=r,this.output.disconnect(),this.inputSources=[],this.input.connect(this.limiter),this.limiter.connect(this.output),this.meter=r.createGain(),this.fftMeter=r.createGain(),this.output.connect(this.meter),this.output.connect(this.fftMeter),this.output.connect(this.audiocontext.destination),this.soundArray=[],this.parts=[],this.extensions=[]};return p5.prototype.getMasterVolume=function(){return r.output.gain.value},p5.prototype.masterVolume=function(s,a,c){if("number"==typeof s){a=a||0,c=c||0;var l=r.audiocontext.currentTime,f=r.output.gain.value;r.output.gain.cancelScheduledValues(l+c),r.output.gain.linearRampToValueAtTime(f,l+c),r.output.gain.linearRampToValueAtTime(s,l+c+a)}else{if(!s)return r.output.gain;s.connect(r.output.gain)}},p5.prototype.soundOut=p5.soundOut=r,p5.soundOut._silentNode=r.audiocontext.createGain(),p5.soundOut._silentNode.gain.value=0,p5.soundOut._silentNode.connect(r.audiocontext.destination),r}(),helpers=function(){"use strict";var r=master;p5.prototype.sampleRate=function(){return r.audiocontext.sampleRate},p5.prototype.freqToMidi=function(r){var s=Math.log(r/440)/Math.log(2);return Math.round(12*s)+57},p5.prototype.midiToFreq=function(r){return 440*Math.pow(2,(r-69)/12)},p5.prototype.soundFormats=function(){r.extensions=[];for(var s=0;s<arguments.length;s++){if(arguments[s]=arguments[s].toLowerCase(),!(["mp3","wav","ogg","m4a","aac"].indexOf(arguments[s])>-1))throw arguments[s]+" is not a valid sound format!";r.extensions.push(arguments[s])}},p5.prototype.disposeSound=function(){for(var s=0;s<r.soundArray.length;s++)r.soundArray[s].dispose()},p5.prototype.registerMethod("remove",p5.prototype.disposeSound),p5.prototype._checkFileFormats=function(s){var a;if("string"==typeof s){var c=(a=s).split(".").pop();if(["mp3","wav","ogg","m4a","aac"].indexOf(c)>-1)if(p5.prototype.isFileSupported(c))a=a;else for(var l=a.split("."),f=l[l.length-1],d=0;d<r.extensions.length;d++){var m=r.extensions[d];if(p5.prototype.isFileSupported(m)){f="",2===l.length&&(f+=l[0]);for(d=1;d<=l.length-2;d++){f+="."+l[d]}a=f+=".",a=a+=m;break}}else for(d=0;d<r.extensions.length;d++){m=r.extensions[d];if(p5.prototype.isFileSupported(m)){a=a+"."+m;break}}}else if("object"==typeof s)for(d=0;d<s.length;d++){m=s[d].split(".").pop();if(p5.prototype.isFileSupported(m)){a=s[d];break}}return a},p5.prototype._mathChain=function(r,s,a,c,l){for(var f in r.mathOps)r.mathOps[f]instanceof l&&(r.mathOps[f].dispose(),(a=f)<r.mathOps.length-1&&(c=r.mathOps[f+1]));return r.mathOps[a-1].disconnect(),r.mathOps[a-1].connect(s),s.connect(c),r.mathOps[a]=s,r}}(),errorHandler=function(){"use strict";return function(r,s,a){var c,l,f=new Error;return f.name=r,f.originalStack=f.stack+s,c=f.stack+s,f.failedPath=a,l=(l=c.split("\n")).filter((function(r){return!r.match(/(p5.|native code|globalInit)/g)})),f.stack=l.join("\n"),f}}(),panner=function(){"use strict";var r=master.audiocontext;void 0!==r.createStereoPanner?(p5.Panner=function(s,a,c){this.stereoPanner=this.input=r.createStereoPanner(),s.connect(this.stereoPanner),this.stereoPanner.connect(a)},p5.Panner.prototype.pan=function(s,a){var c=a||0,l=r.currentTime+c;this.stereoPanner.pan.linearRampToValueAtTime(s,l)},p5.Panner.prototype.inputChannels=function(r){},p5.Panner.prototype.connect=function(r){this.stereoPanner.connect(r)},p5.Panner.prototype.disconnect=function(r){this.stereoPanner.disconnect()}):(p5.Panner=function(s,a,c){this.input=r.createGain(),s.connect(this.input),this.left=r.createGain(),this.right=r.createGain(),this.left.channelInterpretation="discrete",this.right.channelInterpretation="discrete",c>1?(this.splitter=r.createChannelSplitter(2),this.input.connect(this.splitter),this.splitter.connect(this.left,1),this.splitter.connect(this.right,0)):(this.input.connect(this.left),this.input.connect(this.right)),this.output=r.createChannelMerger(2),this.left.connect(this.output,0,1),this.right.connect(this.output,0,0),this.output.connect(a)},p5.Panner.prototype.pan=function(s,a){var c=a||0,l=r.currentTime+c,f=(s+1)/2,d=Math.cos(f*Math.PI/2),m=Math.sin(f*Math.PI/2);this.left.gain.linearRampToValueAtTime(m,l),this.right.gain.linearRampToValueAtTime(d,l)},p5.Panner.prototype.inputChannels=function(s){1===s?(this.input.disconnect(),this.input.connect(this.left),this.input.connect(this.right)):2===s&&(this.splitter=r.createChannelSplitter(2),this.input.disconnect(),this.input.connect(this.splitter),this.splitter.connect(this.left,1),this.splitter.connect(this.right,0))},p5.Panner.prototype.connect=function(r){this.output.connect(r)},p5.Panner.prototype.disconnect=function(r){this.output.disconnect()}),p5.Panner3D=function(s,a){var c=r.createPanner();return c.panningModel="HRTF",c.distanceModel="linear",c.setPosition(0,0,0),s.connect(c),c.connect(a),c.pan=function(r,s,a){c.setPosition(r,s,a)},c}}(),soundfile=function(){"use strict";function t(r,s){for(var a={},c=r.length,l=0;c>l;l++){if(r[l]>s){var f=r[l],d=new p(f,l);a[l]=d,l+=6e3}l++}return a}function i(r,s){var a=[];return r.forEach((function(r,c){try{var l=Math.abs(60/(r.interval/s));if(l=n(l),!a.some((function(s){return s.tempo===l?s.count+=r.count:void 0}))){if(isNaN(l))return;a.push({tempo:Math.round(l),count:r.count})}}catch(r){throw r}})),a}function o(r,s,a,c){for(var l=[],f=Object.keys(r).sort(),d=0;d<f.length;d++)for(var m=r[f[d]],y=0;y<m.intervals.length;y++){var v=Math.round(Math.abs(60/(m.intervals[y]/a)));v=n(v),Math.abs(v-s)<c&&l.push(m.sampleIndex/44100)}return l.filter((function(r,s,a){return a[s+1]-r>.01||void 0}))}function n(r){if(isFinite(r)&&0!=r){for(;90>r;)r*=2;for(;r>180&&r>90;)r/=2;return r}}var r=errorHandler,s=master,a=s.audiocontext;p5.SoundFile=function(r,a,c,l){if(void 0!==r){if("string"==typeof r||"string"==typeof r[0]){var f=p5.prototype._checkFileFormats(r);this.url=f}else if("object"==typeof r&&!(window.File&&window.FileReader&&window.FileList&&window.Blob))throw"Unable to load file because the File API is not supported";r.file&&(r=r.file),this.file=r}this._onended=function(){},this._looping=!1,this._playing=!1,this._paused=!1,this._pauseTime=0,this._cues=[],this._lastPos=0,this._counterNode,this._scopeNode,this.bufferSourceNodes=[],this.bufferSourceNode=null,this.buffer=null,this.playbackRate=1,this.gain=1,this.input=s.audiocontext.createGain(),this.output=s.audiocontext.createGain(),this.reversed=!1,this.startTime=0,this.endTime=null,this.pauseTime=0,this.mode="sustain",this.startMillis=null,this.panPosition=0,this.panner=new p5.Panner(this.output,s.input,2),(this.url||this.file)&&this.load(a,c),s.soundArray.push(this),this._whileLoading="function"==typeof l?l:function(){}},p5.prototype.registerPreloadMethod("loadSound",p5.prototype),p5.prototype.loadSound=function(r,s,a,c){return window.location.origin.indexOf("file://")>-1&&"undefined"===window.cordova&&alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS"),new p5.SoundFile(r,s,a,c)},p5.SoundFile.prototype.load=function(s,c){var l=this,f=(new Error).stack;if(null!=this.url&&""!=this.url){var d=new XMLHttpRequest;d.addEventListener("progress",(function(r){l._updateProgress(r)}),!1),d.open("GET",this.url,!0),d.responseType="arraybuffer",d.onload=function(){if(200==d.status)a.decodeAudioData(d.response,(function(r){l.buffer=r,l.panner.inputChannels(r.numberOfChannels),s&&s(l)}),(function(s){var a=new r("decodeAudioData",f,l.url),d="AudioContext error at decodeAudioData for "+l.url;c?(a.msg=d,c(a)):console.error(d+"\n The error stack trace includes: \n"+a.stack)}));else{var m=new r("loadSound",f,l.url),y="Unable to load "+l.url+". The request status was: "+d.status+" ("+d.statusText+")";c?(m.message=y,c(m)):console.error(y+"\n The error stack trace includes: \n"+m.stack)}},d.onerror=function(s){var a=new r("loadSound",f,l.url),d="There was no response from the server at "+l.url+". Check the url and internet connectivity.";c?(a.message=d,c(a)):console.error(d+"\n The error stack trace includes: \n"+a.stack)},d.send()}else if(null!=this.file){var m=new FileReader;l=this;m.onload=function(){a.decodeAudioData(m.result,(function(r){l.buffer=r,l.panner.inputChannels(r.numberOfChannels),s&&s(l)}))},m.onerror=function(r){onerror&&onerror(r)},m.readAsArrayBuffer(this.file)}},p5.SoundFile.prototype._updateProgress=function(r){if(r.lengthComputable){var s=r.loaded/r.total*.99;this._whileLoading(s,r)}else this._whileLoading("size unknown")},p5.SoundFile.prototype.isLoaded=function(){return!!this.buffer},p5.SoundFile.prototype.play=function(r,a,c,l,f){var d,m=this;if(0>(r=r||0)&&(r=0),r+=s.audiocontext.currentTime,!this.buffer)throw"not ready to play file, buffer has yet to load. Try preload()";if(this._pauseTime=0,"restart"===this.mode&&this.buffer&&this.bufferSourceNode){s.audiocontext.currentTime;this.bufferSourceNode.stop(r),this._counterNode.stop(r)}if(a&&(this.playbackRate=a),this.bufferSourceNode=this._initSourceNode(),this._counterNode&&(this._counterNode=void 0),this._counterNode=this._initCounterNode(),l){if(!(l>=0&&l<this.buffer.duration))throw"start time out of range";d=l}else d=0;f=f?f<=this.buffer.duration-d?f:this.buffer.duration:this.buffer.duration-d;var y=c||1;this.bufferSourceNode.connect(this.output),this.output.gain.value=y,this._paused?(this.bufferSourceNode.start(r,this.pauseTime,f),this._counterNode.start(r,this.pauseTime,f)):(this.bufferSourceNode.start(r,d,f),this._counterNode.start(r,d,f)),this._playing=!0,this._paused=!1,this.bufferSourceNodes.push(this.bufferSourceNode),this.bufferSourceNode._arrayIndex=this.bufferSourceNodes.length-1;var h=function(r){this._playing=!1,this.removeEventListener("ended",h,!1),m._onended(m),m.bufferSourceNodes.forEach((function(r,s){!1===r._playing&&m.bufferSourceNodes.splice(s)})),0===m.bufferSourceNodes.length&&(m._playing=!1)};if(this.bufferSourceNode.onended=h,this.bufferSourceNode.loop=this._looping,this._counterNode.loop=this._looping,!0===this._looping){var v=d+f;this.bufferSourceNode.loopStart=d,this.bufferSourceNode.loopEnd=v,this._counterNode.loopStart=d,this._counterNode.loopEnd=v}},p5.SoundFile.prototype.playMode=function(r){var a=r.toLowerCase();if("restart"===a&&this.buffer&&this.bufferSourceNode)for(var c=0;c<this.bufferSourceNodes.length-1;c++){var l=s.audiocontext.currentTime;this.bufferSourceNodes[c].stop(l)}if("restart"!==a&&"sustain"!==a)throw'Invalid play mode. Must be either "restart" or "sustain"';this.mode=a},p5.SoundFile.prototype.pause=function(r){var a=(r=r||0)+s.audiocontext.currentTime;this.isPlaying()&&this.buffer&&this.bufferSourceNode?(this.pauseTime=this.currentTime(),this.bufferSourceNode.stop(a),this._counterNode.stop(a),this._paused=!0,this._playing=!1,this._pauseTime=this.currentTime()):this._pauseTime=0},p5.SoundFile.prototype.loop=function(r,s,a,c,l){this._looping=!0,this.play(r,s,a,c,l)},p5.SoundFile.prototype.setLoop=function(r){if(!0===r)this._looping=!0;else{if(!1!==r)throw"Error: setLoop accepts either true or false";this._looping=!1}this.bufferSourceNode&&(this.bufferSourceNode.loop=this._looping,this._counterNode.loop=this._looping)},p5.SoundFile.prototype.isLooping=function(){return!(!this.bufferSourceNode||!0!==this._looping||!0!==this.isPlaying())},p5.SoundFile.prototype.isPlaying=function(){return this._playing},p5.SoundFile.prototype.isPaused=function(){return this._paused},p5.SoundFile.prototype.stop=function(r){var a=r||0;if("sustain"==this.mode)this.stopAll(a),this._playing=!1,this.pauseTime=0,this._paused=!1;else if(this.buffer&&this.bufferSourceNode){var c=s.audiocontext.currentTime,l=a||0;this.pauseTime=0,this.bufferSourceNode.stop(c+l),this._counterNode.stop(c+l),this._playing=!1,this._paused=!1}},p5.SoundFile.prototype.stopAll=function(r){var a=s.audiocontext.currentTime,c=r||0;if(this.buffer&&this.bufferSourceNode){for(var l=0;l<this.bufferSourceNodes.length;l++)if(null!=typeof this.bufferSourceNodes[l])try{this.bufferSourceNodes[l].onended=function(){},this.bufferSourceNodes[l].stop(a+c)}catch(r){}this._counterNode.stop(a+c),this._onended(this)}},p5.SoundFile.prototype.setVolume=function(r,a,c){if("number"==typeof r){a=a||0,c=c||0;var l=s.audiocontext.currentTime,f=this.output.gain.value;this.output.gain.cancelScheduledValues(l+c),this.output.gain.linearRampToValueAtTime(f,l+c),this.output.gain.linearRampToValueAtTime(r,l+c+a)}else{if(!r)return this.output.gain;r.connect(this.output.gain)}},p5.SoundFile.prototype.amp=p5.SoundFile.prototype.setVolume,p5.SoundFile.prototype.fade=p5.SoundFile.prototype.setVolume,p5.SoundFile.prototype.getVolume=function(){return this.output.gain.value},p5.SoundFile.prototype.pan=function(r,s){this.panPosition=r,this.panner.pan(r,s)},p5.SoundFile.prototype.getPan=function(){return this.panPosition},p5.SoundFile.prototype.rate=function(r){if(this.playbackRate!==r||!this.bufferSourceNode||this.bufferSourceNode.playbackRate.value!==r){this.playbackRate=r;var a=r;if(0===this.playbackRate&&this._playing&&this.pause(),this.playbackRate<0&&!this.reversed){var c=this.currentTime();this.bufferSourceNode.playbackRate.value,this.reverseBuffer(),a=Math.abs(r);var l=(c-this.duration())/a;this.pauseTime=l}else this.playbackRate>0&&this.reversed&&this.reverseBuffer();if(this.bufferSourceNode){var f=s.audiocontext.currentTime;this.bufferSourceNode.playbackRate.cancelScheduledValues(f),this.bufferSourceNode.playbackRate.linearRampToValueAtTime(Math.abs(a),f),this._counterNode.playbackRate.cancelScheduledValues(f),this._counterNode.playbackRate.linearRampToValueAtTime(Math.abs(a),f)}}},p5.SoundFile.prototype.setPitch=function(r){var s=midiToFreq(r)/midiToFreq(60);this.rate(s)},p5.SoundFile.prototype.getPlaybackRate=function(){return this.playbackRate},p5.SoundFile.prototype.duration=function(){return this.buffer?this.buffer.duration:0},p5.SoundFile.prototype.currentTime=function(){return this._pauseTime>0?this._pauseTime:this._lastPos/a.sampleRate},p5.SoundFile.prototype.jump=function(r,s){if(0>r||r>this.buffer.duration)throw"jump time out of range";if(s>this.buffer.duration-r)throw"end time out of range";var a=r||0,c=s||this.buffer.duration-r;this.isPlaying()&&this.stop(),this.play(0,this.playbackRate,this.output.gain.value,a,c)},p5.SoundFile.prototype.channels=function(){return this.buffer.numberOfChannels},p5.SoundFile.prototype.sampleRate=function(){return this.buffer.sampleRate},p5.SoundFile.prototype.frames=function(){return this.buffer.length},p5.SoundFile.prototype.getPeaks=function(r){if(!this.buffer)throw"Cannot load peaks yet, buffer is not loaded";if(r||(r=5*window.width),this.buffer){for(var s=this.buffer,a=s.length/r,c=~~(a/10)||1,l=s.numberOfChannels,f=new Float32Array(Math.round(r)),d=0;l>d;d++)for(var m=s.getChannelData(d),y=0;r>y;y++){for(var v=~~(y*a),g=~~(v+a),T=0,_=v;g>_;_+=c){var S=m[_];(S>T||-S>T)&&(T=S)}(0===d||Math.abs(T)>f[y])&&(f[y]=T)}return f}},p5.SoundFile.prototype.reverseBuffer=function(){var r=this.getVolume();if(this.setVolume(0,.01,0),this.pause(),!this.buffer)throw"SoundFile is not done loading";for(var s=0;s<this.buffer.numberOfChannels;s++)Array.prototype.reverse.call(this.buffer.getChannelData(s));this.reversed=!this.reversed,this.setVolume(r,.01,.0101),this.play()},p5.SoundFile.prototype.onended=function(r){return this._onended=r,this},p5.SoundFile.prototype.add=function(){},p5.SoundFile.prototype.dispose=function(){var r=s.audiocontext.currentTime,a=s.soundArray.indexOf(this);if(s.soundArray.splice(a,1),this.stop(r),this.buffer&&this.bufferSourceNode){for(var c=0;c<this.bufferSourceNodes.length-1;c++)if(null!==this.bufferSourceNodes[c]){this.bufferSourceNodes[c].disconnect();try{this.bufferSourceNodes[c].stop(r)}catch(r){}this.bufferSourceNodes[c]=null}if(this.isPlaying()){try{this._counterNode.stop(r)}catch(r){console.log(r)}this._counterNode=null}}this.output&&(this.output.disconnect(),this.output=null),this.panner&&(this.panner.disconnect(),this.panner=null)},p5.SoundFile.prototype.connect=function(r){r?r.hasOwnProperty("input")?this.panner.connect(r.input):this.panner.connect(r):this.panner.connect(s.input)},p5.SoundFile.prototype.disconnect=function(){this.panner.disconnect()},p5.SoundFile.prototype.getLevel=function(r){console.warn("p5.SoundFile.getLevel has been removed from the library. Use p5.Amplitude instead")},p5.SoundFile.prototype.setPath=function(r,s){var a=p5.prototype._checkFileFormats(r);this.url=a,this.load(s)},p5.SoundFile.prototype.setBuffer=function(r){var s=r.length,c=r[0].length,l=a.createBuffer(s,c,a.sampleRate);!r[0]instanceof Float32Array&&(r[0]=new Float32Array(r[0]));for(var f=0;s>f;f++){l.getChannelData(f).set(r[f])}this.buffer=l,this.panner.inputChannels(s)},p5.SoundFile.prototype._initCounterNode=function(){var r=this,s=a.currentTime,c=a.createBufferSource();return r._scopeNode&&(r._scopeNode.disconnect(),r._scopeNode.onaudioprocess=void 0,r._scopeNode=null),r._scopeNode=a.createScriptProcessor(256,1,1),c.buffer=u(r.buffer),c.playbackRate.setValueAtTime(r.playbackRate,s),c.connect(r._scopeNode),r._scopeNode.connect(p5.soundOut._silentNode),r._scopeNode.onaudioprocess=function(s){var a=s.inputBuffer.getChannelData(0);r._lastPos=a[a.length-1]||0,r._onTimeUpdate(r._lastPos)},c},p5.SoundFile.prototype._initSourceNode=function(){var r=(a.currentTime,a.createBufferSource());return r.buffer=this.buffer,r.playbackRate.value=this.playbackRate,r};var u=function(r){for(var s=new Float32Array(r.length),c=a.createBuffer(1,r.length,44100),l=0;l<r.length;l++)s[l]=l;return c.getChannelData(0).set(s),c};p5.SoundFile.prototype.processPeaks=function(r,s,a,l){var f=this.buffer.length,d=this.buffer.sampleRate,m=this.buffer,y=s||.9,v=a||.22,g=l||200,T=new OfflineAudioContext(1,f,d),_=T.createBufferSource();_.buffer=m;var S=T.createBiquadFilter();S.type="lowpass",_.connect(S),S.connect(T.destination),_.start(0),T.startRendering(),T.oncomplete=function(s){var a=s.renderedBuffer,l=a.getChannelData(0);do{c=t(l,y),y-=.005}while(Object.keys(c).length<g&&y>=v);var f=i(function e(r){for(var s=[],a=Object.keys(r).sort(),c=0;c<a.length;c++)for(var l=0;10>l;l++){var f=r[a[c]],d=r[a[c+l]];if(f&&d){var m=f.sampleIndex,y=d.sampleIndex-m;y>0&&f.intervals.push(y),s.some((function(r,s){return r.interval===y?(r.count++,r):void 0}))||s.push({interval:y,count:1})}}return s}(c),a.sampleRate).sort((function(r,s){return s.count-r.count})).splice(0,5);this.tempo=f[0].tempo;var d=o(c,f[0].tempo,a.sampleRate,5);r(d)}};var p=function(r,s){this.sampleIndex=s,this.amplitude=r,this.tempos=[],this.intervals=[]},c=[];p5.SoundFile.prototype.addCue=function(r,s,a){var c=this._cueIDCounter++,l=new h(s,r,c,a);return this._cues.push(l),c},p5.SoundFile.prototype.removeCue=function(r){for(var s=this._cues.length,a=0;s>a;a++){this._cues[a].id===r&&this.cues.splice(a,1)}this._cues.length},p5.SoundFile.prototype.clearCues=function(){this._cues=[]},p5.SoundFile.prototype._onTimeUpdate=function(r){for(var s=r/this.buffer.sampleRate,a=this._cues.length,c=0;a>c;c++){var l=this._cues[c],f=l.time,d=l.val;this._prevTime<f&&s>=f&&l.callback(d)}this._prevTime=s};var h=function(r,s,a,c){this.callback=r,this.time=s,this.id=a,this.val=c}}(),amplitude=function(){"use strict";var r=master;p5.Amplitude=function(s){this.bufferSize=2048,this.audiocontext=r.audiocontext,this.processor=this.audiocontext.createScriptProcessor(this.bufferSize,2,1),this.input=this.processor,this.output=this.audiocontext.createGain(),this.smoothing=s||0,this.volume=0,this.average=0,this.stereoVol=[0,0],this.stereoAvg=[0,0],this.stereoVolNorm=[0,0],this.volMax=.001,this.normalize=!1,this.processor.onaudioprocess=this._audioProcess.bind(this),this.processor.connect(this.output),this.output.gain.value=0,this.output.connect(this.audiocontext.destination),r.meter.connect(this.processor),r.soundArray.push(this)},p5.Amplitude.prototype.setInput=function(s,a){r.meter.disconnect(),a&&(this.smoothing=a),null==s?(console.log("Amplitude input source is not ready! Connecting to master output instead"),r.meter.connect(this.processor)):s instanceof p5.Signal?s.output.connect(this.processor):s?(s.connect(this.processor),this.processor.disconnect(),this.processor.connect(this.output)):r.meter.connect(this.processor)},p5.Amplitude.prototype.connect=function(s){s?s.hasOwnProperty("input")?this.output.connect(s.input):this.output.connect(s):this.output.connect(this.panner.connect(r.input))},p5.Amplitude.prototype.disconnect=function(r){this.output.disconnect()},p5.Amplitude.prototype._audioProcess=function(r){for(var s=0;s<r.inputBuffer.numberOfChannels;s++){for(var a,c=r.inputBuffer.getChannelData(s),l=c.length,f=0,d=0,m=0;l>m;m++)a=c[m],this.normalize?(f+=Math.max(Math.min(a/this.volMax,1),-1),d+=Math.max(Math.min(a/this.volMax,1),-1)*Math.max(Math.min(a/this.volMax,1),-1)):(f+=a,d+=a*a);var y=f/l,v=Math.sqrt(d/l);this.stereoVol[s]=Math.max(v,this.stereoVol[s]*this.smoothing),this.stereoAvg[s]=Math.max(y,this.stereoVol[s]*this.smoothing),this.volMax=Math.max(this.stereoVol[s],this.volMax)}var g=this,T=this.stereoVol.reduce((function(r,s,a){return g.stereoVolNorm[a-1]=Math.max(Math.min(g.stereoVol[a-1]/g.volMax,1),0),g.stereoVolNorm[a]=Math.max(Math.min(g.stereoVol[a]/g.volMax,1),0),r+s}));this.volume=T/this.stereoVol.length,this.volNorm=Math.max(Math.min(this.volume/this.volMax,1),0)},p5.Amplitude.prototype.getLevel=function(r){return void 0!==r?this.normalize?this.stereoVolNorm[r]:this.stereoVol[r]:this.normalize?this.volNorm:this.volume},p5.Amplitude.prototype.toggleNormalize=function(r){this.normalize="boolean"==typeof r?r:!this.normalize},p5.Amplitude.prototype.smooth=function(r){r>=0&&1>r?this.smoothing=r:console.log("Error: smoothing must be between 0 and 1")},p5.Amplitude.prototype.dispose=function(){var s=r.soundArray.indexOf(this);r.soundArray.splice(s,1),this.input.disconnect(),this.output.disconnect(),this.input=this.processor=void 0,this.output=void 0}}(),fft=function(){"use strict";var r=master;p5.FFT=function(s,a){this.smoothing=s||.8,this.bins=a||1024;var c=2*a||2048;this.input=this.analyser=r.audiocontext.createAnalyser(),r.fftMeter.connect(this.analyser),this.analyser.smoothingTimeConstant=this.smoothing,this.analyser.fftSize=c,this.freqDomain=new Uint8Array(this.analyser.frequencyBinCount),this.timeDomain=new Uint8Array(this.analyser.frequencyBinCount),this.bass=[20,140],this.lowMid=[140,400],this.mid=[400,2600],this.highMid=[2600,5200],this.treble=[5200,14e3],r.soundArray.push(this)},p5.FFT.prototype.setInput=function(s){s?(s.output?s.output.connect(this.analyser):s.connect&&s.connect(this.analyser),r.fftMeter.disconnect()):r.fftMeter.connect(this.analyser)},p5.FFT.prototype.waveform=function(){for(var r,s,a=0;a<arguments.length;a++)"number"==typeof arguments[a]&&(r=arguments[a],this.analyser.fftSize=2*r),"string"==typeof arguments[a]&&(s=arguments[a]);if(s&&!p5.prototype._isSafari())return o(this,this.timeDomain),this.analyser.getFloatTimeDomainData(this.timeDomain),this.timeDomain;n(this,this.timeDomain),this.analyser.getByteTimeDomainData(this.timeDomain);var c=new Array;for(a=0;a<this.timeDomain.length;a++){var l=p5.prototype.map(this.timeDomain[a],0,255,-1,1);c.push(l)}return c},p5.FFT.prototype.analyze=function(){for(var r,s=0;s<arguments.length;s++)"number"==typeof arguments[s]&&(this.bins=arguments[s],this.analyser.fftSize=2*this.bins),"string"==typeof arguments[s]&&(r=arguments[s]);if(r&&"db"===r.toLowerCase())return e(this),this.analyser.getFloatFrequencyData(this.freqDomain),this.freqDomain;i(this,this.freqDomain),this.analyser.getByteFrequencyData(this.freqDomain);var a=Array.apply([],this.freqDomain);return a.length,this.analyser.fftSize,a.constructor,a},p5.FFT.prototype.getEnergy=function(s,a){var c=r.audiocontext.sampleRate/2;if("bass"===s?(s=this.bass[0],a=this.bass[1]):"lowMid"===s?(s=this.lowMid[0],a=this.lowMid[1]):"mid"===s?(s=this.mid[0],a=this.mid[1]):"highMid"===s?(s=this.highMid[0],a=this.highMid[1]):"treble"===s&&(s=this.treble[0],a=this.treble[1]),"number"!=typeof s)throw"invalid input for getEnergy()";if(a){if(s&&a){if(s>a){var l=a;a=s,s=l}for(var f=Math.round(s/c*this.freqDomain.length),d=Math.round(a/c*this.freqDomain.length),m=0,y=0,v=f;d>=v;v++)m+=this.freqDomain[v],y+=1;return m/y}throw"invalid input for getEnergy()"}var g=Math.round(s/c*this.freqDomain.length);return this.freqDomain[g]},p5.FFT.prototype.getFreq=function(r,s){return console.log("getFreq() is deprecated. Please use getEnergy() instead."),this.getEnergy(r,s)},p5.FFT.prototype.getCentroid=function(){for(var s=r.audiocontext.sampleRate/2,a=0,c=0,l=0;l<this.freqDomain.length;l++)a+=l*this.freqDomain[l],c+=this.freqDomain[l];var f=0;return 0!=c&&(f=a/c),f*(s/this.freqDomain.length)},p5.FFT.prototype.smooth=function(r){r&&(this.smoothing=r),this.analyser.smoothingTimeConstant=r},p5.FFT.prototype.dispose=function(){var s=r.soundArray.indexOf(this);r.soundArray.splice(s,1),this.analyser.disconnect(),this.analyser=void 0},p5.FFT.prototype.linAverages=function(r){r=r||16;for(var s=this.freqDomain,a=s.length,c=Math.floor(a/r),l=new Array(r),f=0,d=0;a>d;d++)l[f]=void 0!==l[f]?(l[f]+s[d])/2:s[d],d%c==c-1&&f++;return l},p5.FFT.prototype.logAverages=function(s){for(var a=r.audiocontext.sampleRate/2,c=this.freqDomain,l=c.length,f=new Array(s.length),d=0,m=0;l>m;m++){Math.round(m*a/this.freqDomain.length)>s[d].hi&&d++,f[d]=void 0!==f[d]?(f[d]+c[m])/2:c[m]}return f},p5.FFT.prototype.getOctaveBands=function(s,a){s=s||3;var c=[],l={lo:(a=a||15.625)/Math.pow(2,1/(2*s)),ctr:a,hi:a*Math.pow(2,1/(2*s))};c.push(l);for(var f=r.audiocontext.sampleRate/2;l.hi<f;){var d={};d.lo=l.hi,d.ctr=l.ctr*Math.pow(2,1/s),d.hi=d.ctr*Math.pow(2,1/(2*s)),c.push(d),l=d}return c};var e=function(r){r.freqDomain instanceof Float32Array==0&&(r.freqDomain=new Float32Array(r.analyser.frequencyBinCount))},i=function(r){r.freqDomain instanceof Uint8Array==0&&(r.freqDomain=new Uint8Array(r.analyser.frequencyBinCount))},o=function(r){r.timeDomain instanceof Float32Array==0&&(r.timeDomain=new Float32Array(r.analyser.frequencyBinCount))},n=function(r){r.timeDomain instanceof Uint8Array==0&&(r.timeDomain=new Uint8Array(r.analyser.frequencyBinCount))}}(),Tone_core_Tone=function(){"use strict";function t(r){return void 0===r}function e(r){return"function"==typeof r}var r;if(t(window.AudioContext)&&(window.AudioContext=window.webkitAudioContext),t(window.OfflineAudioContext)&&(window.OfflineAudioContext=window.webkitOfflineAudioContext),t(AudioContext))throw new Error("Web Audio is not supported in this browser");r=new AudioContext,e(AudioContext.prototype.createGain)||(AudioContext.prototype.createGain=AudioContext.prototype.createGainNode),e(AudioContext.prototype.createDelay)||(AudioContext.prototype.createDelay=AudioContext.prototype.createDelayNode),e(AudioContext.prototype.createPeriodicWave)||(AudioContext.prototype.createPeriodicWave=AudioContext.prototype.createWaveTable),e(AudioBufferSourceNode.prototype.start)||(AudioBufferSourceNode.prototype.start=AudioBufferSourceNode.prototype.noteGrainOn),e(AudioBufferSourceNode.prototype.stop)||(AudioBufferSourceNode.prototype.stop=AudioBufferSourceNode.prototype.noteOff),e(OscillatorNode.prototype.start)||(OscillatorNode.prototype.start=OscillatorNode.prototype.noteOn),e(OscillatorNode.prototype.stop)||(OscillatorNode.prototype.stop=OscillatorNode.prototype.noteOff),e(OscillatorNode.prototype.setPeriodicWave)||(OscillatorNode.prototype.setPeriodicWave=OscillatorNode.prototype.setWaveTable),AudioNode.prototype._nativeConnect=AudioNode.prototype.connect,AudioNode.prototype.connect=function(r,s,a){if(r.input)Array.isArray(r.input)?(t(a)&&(a=0),this.connect(r.input[a])):this.connect(r.input,s,a);else try{r instanceof AudioNode?this._nativeConnect(r,s,a):this._nativeConnect(r,s)}catch(s){throw new Error("error connecting to node: "+r)}};var o=function(r,s){t(r)||1===r?this.input=this.context.createGain():r>1&&(this.input=new Array(r)),t(s)||1===s?this.output=this.context.createGain():s>1&&(this.output=new Array(r))};o.prototype.set=function(r,s,a){if(this.isObject(r))a=s;else if(this.isString(r)){var c={};c[r]=s,r=c}for(var l in r){s=r[l];var f=this;if(-1!==l.indexOf(".")){for(var d=l.split("."),m=0;m<d.length-1;m++)f=f[d[m]];l=d[d.length-1]}var y=f[l];t(y)||(o.Signal&&y instanceof o.Signal||o.Param&&y instanceof o.Param?y.value!==s&&(t(a)?y.value=s:y.rampTo(s,a)):y instanceof AudioParam?y.value!==s&&(y.value=s):y instanceof o?y.set(s):y!==s&&(f[l]=s))}return this},o.prototype.get=function(r){t(r)?r=this._collectDefaults(this.constructor):this.isString(r)&&(r=[r]);for(var s={},a=0;a<r.length;a++){var c=r[a],l=this,f=s;if(-1!==c.indexOf(".")){for(var d=c.split("."),m=0;m<d.length-1;m++){var y=d[m];f[y]=f[y]||{},f=f[y],l=l[y]}c=d[d.length-1]}var v=l[c];this.isObject(r[c])?f[c]=v.get():o.Signal&&v instanceof o.Signal||o.Param&&v instanceof o.Param||v instanceof AudioParam?f[c]=v.value:v instanceof o?f[c]=v.get():e(v)||t(v)||(f[c]=v)}return s},o.prototype._collectDefaults=function(r){var s=[];if(t(r.defaults)||(s=Object.keys(r.defaults)),!t(r._super))for(var a=this._collectDefaults(r._super),c=0;c<a.length;c++)-1===s.indexOf(a[c])&&s.push(a[c]);return s},o.prototype.toString=function(){for(var r in o){var s=r[0].match(/^[A-Z]$/),a=o[r]===this.constructor;if(e(o[r])&&s&&a)return r}return"Tone"},o.context=r,o.prototype.context=o.context,o.prototype.bufferSize=2048,o.prototype.blockTime=128/o.context.sampleRate,o.prototype.dispose=function(){return this.isUndef(this.input)||(this.input instanceof AudioNode&&this.input.disconnect(),this.input=null),this.isUndef(this.output)||(this.output instanceof AudioNode&&this.output.disconnect(),this.output=null),this};var s=null;o.prototype.noGC=function(){return this.output.connect(s),this},AudioNode.prototype.noGC=function(){return this.connect(s),this},o.prototype.connect=function(r,s,a){return Array.isArray(this.output)?(s=this.defaultArg(s,0),this.output[s].connect(r,0,a)):this.output.connect(r,s,a),this},o.prototype.disconnect=function(r){return Array.isArray(this.output)?(r=this.defaultArg(r,0),this.output[r].disconnect()):this.output.disconnect(),this},o.prototype.connectSeries=function(){if(arguments.length>1)for(var r=arguments[0],s=1;s<arguments.length;s++){var a=arguments[s];r.connect(a),r=a}return this},o.prototype.connectParallel=function(){var r=arguments[0];if(arguments.length>1)for(var s=1;s<arguments.length;s++){var a=arguments[s];r.connect(a)}return this},o.prototype.chain=function(){if(arguments.length>0)for(var r=this,s=0;s<arguments.length;s++){var a=arguments[s];r.connect(a),r=a}return this},o.prototype.fan=function(){if(arguments.length>0)for(var r=0;r<arguments.length;r++)this.connect(arguments[r]);return this},AudioNode.prototype.chain=o.prototype.chain,AudioNode.prototype.fan=o.prototype.fan,o.prototype.defaultArg=function(r,s){if(this.isObject(r)&&this.isObject(s)){var a={};for(var c in r)a[c]=this.defaultArg(s[c],r[c]);for(var l in s)a[l]=this.defaultArg(r[l],s[l]);return a}return t(r)?s:r},o.prototype.optionsObject=function(r,s,a){var c={};if(1===r.length&&this.isObject(r[0]))c=r[0];else for(var l=0;l<s.length;l++)c[s[l]]=r[l];return this.isUndef(a)?c:this.defaultArg(c,a)},o.prototype.isUndef=t,o.prototype.isFunction=e,o.prototype.isNumber=function(r){return"number"==typeof r},o.prototype.isObject=function(r){return"[object Object]"===Object.prototype.toString.call(r)&&r.constructor===Object},o.prototype.isBoolean=function(r){return"boolean"==typeof r},o.prototype.isArray=function(r){return Array.isArray(r)},o.prototype.isString=function(r){return"string"==typeof r},o.noOp=function(){},o.prototype._readOnly=function(r){if(Array.isArray(r))for(var s=0;s<r.length;s++)this._readOnly(r[s]);else Object.defineProperty(this,r,{writable:!1,enumerable:!0})},o.prototype._writable=function(r){if(Array.isArray(r))for(var s=0;s<r.length;s++)this._writable(r[s]);else Object.defineProperty(this,r,{writable:!0})},o.State={Started:"started",Stopped:"stopped",Paused:"paused"},o.prototype.equalPowerScale=function(r){var s=.5*Math.PI;return Math.sin(r*s)},o.prototype.dbToGain=function(r){return Math.pow(2,r/6)},o.prototype.gainToDb=function(r){return Math.log(r)/Math.LN10*20},o.prototype.now=function(){return this.context.currentTime},o.extend=function(r,s){function n(){}t(s)&&(s=o),n.prototype=s.prototype,r.prototype=new n,r.prototype.constructor=r,r._super=s};var a=[];return o._initAudioContext=function(r){r(o.context),a.push(r)},o.setContext=function(r){o.prototype.context=r,o.context=r;for(var s=0;s<a.length;s++)a[s](r)},o.startMobile=function(){var r=o.context.createOscillator(),s=o.context.createGain();s.gain.value=0,r.connect(s),s.connect(o.context.destination);var a=o.context.currentTime;r.start(a),r.stop(a+1)},o._initAudioContext((function(r){o.prototype.blockTime=128/r.sampleRate,(s=r.createGain()).gain.value=0,s.connect(r.destination)})),o.version="r7-dev",o}(),Tone_signal_SignalBase=function(r){"use strict";return r.SignalBase=function(){},r.extend(r.SignalBase),r.SignalBase.prototype.connect=function(s,a,c){return r.Signal&&r.Signal===s.constructor||r.Param&&r.Param===s.constructor||r.TimelineSignal&&r.TimelineSignal===s.constructor?(s._param.cancelScheduledValues(0),s._param.value=0,s.overridden=!0):s instanceof AudioParam&&(s.cancelScheduledValues(0),s.value=0),r.prototype.connect.call(this,s,a,c),this},r.SignalBase}(Tone_core_Tone),Tone_signal_WaveShaper=function(r){"use strict";return r.WaveShaper=function(r,s){this._shaper=this.input=this.output=this.context.createWaveShaper(),this._curve=null,Array.isArray(r)?this.curve=r:isFinite(r)||this.isUndef(r)?this._curve=new Float32Array(this.defaultArg(r,1024)):this.isFunction(r)&&(this._curve=new Float32Array(this.defaultArg(s,1024)),this.setMap(r))},r.extend(r.WaveShaper,r.SignalBase),r.WaveShaper.prototype.setMap=function(r){for(var s=0,a=this._curve.length;a>s;s++){var c=s/a*2-1;this._curve[s]=r(c,s)}return this._shaper.curve=this._curve,this},Object.defineProperty(r.WaveShaper.prototype,"curve",{get:function(){return this._shaper.curve},set:function(r){this._curve=new Float32Array(r),this._shaper.curve=this._curve}}),Object.defineProperty(r.WaveShaper.prototype,"oversample",{get:function(){return this._shaper.oversample},set:function(r){if(-1===["none","2x","4x"].indexOf(r))throw new Error("invalid oversampling: "+r);this._shaper.oversample=r}}),r.WaveShaper.prototype.dispose=function(){return r.prototype.dispose.call(this),this._shaper.disconnect(),this._shaper=null,this._curve=null,this},r.WaveShaper}(Tone_core_Tone),Tone_core_Type=function(Tone){"use strict";function getTransportBpm(){return Tone.Transport&&Tone.Transport.bpm?Tone.Transport.bpm.value:120}function getTransportTimeSignature(){return Tone.Transport&&Tone.Transport.timeSignature?Tone.Transport.timeSignature:4}function toNotationHelper(r,s,a,c){for(var l=this.toSeconds(r),f=this.notationToSeconds(c[c.length-1],s,a),d="",m=0;m<c.length;m++){var y=this.notationToSeconds(c[m],s,a),v=l/y,g=1e-6;if(g>1-v%1&&(v+=g),(v=Math.floor(v))>0){if(d+=1===v?c[m]:v.toString()+"*"+c[m],f>(l-=v*y))break;d+=" + "}}return""===d&&(d="0"),d}var t;Tone.Type={Default:"number",Time:"time",Frequency:"frequency",NormalRange:"normalRange",AudioRange:"audioRange",Decibels:"db",Interval:"interval",BPM:"bpm",Positive:"positive",Cents:"cents",Degrees:"degrees",MIDI:"midi",TransportTime:"transportTime",Ticks:"tick",Note:"note",Milliseconds:"milliseconds",Notation:"notation"},Tone.prototype.isNowRelative=(t=new RegExp(/^\s*\+(.)+/i),function(r){return t.test(r)}),Tone.prototype.isTicks=function(){var r=new RegExp(/^\d+i$/i);return function(s){return r.test(s)}}(),Tone.prototype.isNotation=function(){var r=new RegExp(/^[0-9]+[mnt]$/i);return function(s){return r.test(s)}}(),Tone.prototype.isTransportTime=function(){var r=new RegExp(/^(\d+(\.\d+)?\:){1,2}(\d+(\.\d+)?)?$/i);return function(s){return r.test(s)}}(),Tone.prototype.isNote=function(){var r=new RegExp(/^[a-g]{1}(b|#|x|bb)?-?[0-9]+$/i);return function(s){return r.test(s)}}(),Tone.prototype.isFrequency=function(){var r=new RegExp(/^\d*\.?\d+hz$/i);return function(s){return r.test(s)}}(),Tone.prototype.notationToSeconds=function(r,s,a){s=this.defaultArg(s,getTransportBpm()),a=this.defaultArg(a,getTransportTimeSignature());var c=60/s;"1n"===r&&(r="1m");var l=parseInt(r,10);var f=r.slice(-1);return c*("t"===f?4/l*2/3:"n"===f?4/l:"m"===f?l*a:0)},Tone.prototype.transportTimeToSeconds=function(r,s,a){s=this.defaultArg(s,getTransportBpm()),a=this.defaultArg(a,getTransportTimeSignature());var c=0,l=0,f=0,d=r.split(":");return 2===d.length?(c=parseFloat(d[0]),l=parseFloat(d[1])):1===d.length?l=parseFloat(d[0]):3===d.length&&(c=parseFloat(d[0]),l=parseFloat(d[1]),f=parseFloat(d[2])),(c*a+l+f/4)*(60/s)},Tone.prototype.ticksToSeconds=function(r,s){return this.isUndef(Tone.Transport)?0:(r=parseFloat(r),60/(s=this.defaultArg(s,getTransportBpm()))/Tone.Transport.PPQ*r)},Tone.prototype.frequencyToSeconds=function(r){return 1/parseFloat(r)},Tone.prototype.samplesToSeconds=function(r){return r/this.context.sampleRate},Tone.prototype.secondsToSamples=function(r){return r*this.context.sampleRate},Tone.prototype.secondsToTransportTime=function(r,s,a){s=this.defaultArg(s,getTransportBpm()),a=this.defaultArg(a,getTransportTimeSignature());var c=r/(60/s),l=c%1*4;return[Math.floor(c/a),c=Math.floor(c)%a,l].join(":")},Tone.prototype.secondsToFrequency=function(r){return 1/r},Tone.prototype.toTransportTime=function(r,s,a){var c=this.toSeconds(r);return this.secondsToTransportTime(c,s,a)},Tone.prototype.toFrequency=function(r,s){return this.isFrequency(r)?parseFloat(r):this.isNotation(r)||this.isTransportTime(r)?this.secondsToFrequency(this.toSeconds(r,s)):this.isNote(r)?this.noteToFrequency(r):r},Tone.prototype.toTicks=function(r){if(this.isUndef(Tone.Transport))return 0;var s=Tone.Transport.bpm.value,a=0;if(this.isNowRelative(r))r=r.replace("+",""),a=Tone.Transport.ticks;else if(this.isUndef(r))return Tone.Transport.ticks;var c=this.toSeconds(r)/(60/s)*Tone.Transport.PPQ;return Math.round(c+a)},Tone.prototype.toSamples=function(r){var s=this.toSeconds(r);return Math.round(s*this.context.sampleRate)},Tone.prototype.toSeconds=function(time,now){if(now=this.defaultArg(now,this.now()),this.isNumber(time))return time;if(this.isString(time)){var plusTime=0;this.isNowRelative(time)&&(time=time.replace("+",""),plusTime=now);var betweenParens=time.match(/\(([^)(]+)\)/g);if(betweenParens)for(var j=0;j<betweenParens.length;j++){var symbol=betweenParens[j].replace(/[\(\)]/g,""),symbolVal=this.toSeconds(symbol);time=time.replace(betweenParens[j],symbolVal)}if(-1!==time.indexOf("@")){var quantizationSplit=time.split("@");if(this.isUndef(Tone.Transport))throw new Error("quantization requires Tone.Transport");var toQuantize=quantizationSplit[0].trim();""===toQuantize&&(toQuantize=void 0),plusTime>0&&(toQuantize="+"+toQuantize,plusTime=0);var subdivision=quantizationSplit[1].trim();time=Tone.Transport.quantize(toQuantize,subdivision)}else{var components=time.split(/[\(\)\-\+\/\*]/);if(components.length>1){for(var originalTime=time,i=0;i<components.length;i++){var symb=components[i].trim();if(""!==symb){var val=this.toSeconds(symb);time=time.replace(symb,val)}}try{time=eval(time)}catch(r){throw new EvalError("cannot evaluate Time: "+originalTime)}}else time=this.isNotation(time)?this.notationToSeconds(time):this.isTransportTime(time)?this.transportTimeToSeconds(time):this.isFrequency(time)?this.frequencyToSeconds(time):this.isTicks(time)?this.ticksToSeconds(time):parseFloat(time)}return time+plusTime}return now},Tone.prototype.toNotation=function(r,s,a){var c=toNotationHelper.call(this,r,s,a,["1m","2n","4n","8n","16n","32n","64n","128n"]),l=toNotationHelper.call(this,r,s,a,["1m","2n","2t","4n","4t","8n","8t","16n","16t","32n","32t","64n","64t","128n"]);return l.split("+").length<c.split("+").length?l:c},Tone.prototype.fromUnits=function(r,s){if(!this.convert&&!this.isUndef(this.convert))return r;switch(s){case Tone.Type.Time:return this.toSeconds(r);case Tone.Type.Frequency:return this.toFrequency(r);case Tone.Type.Decibels:return this.dbToGain(r);case Tone.Type.NormalRange:return Math.min(Math.max(r,0),1);case Tone.Type.AudioRange:return Math.min(Math.max(r,-1),1);case Tone.Type.Positive:return Math.max(r,0);default:return r}},Tone.prototype.toUnits=function(r,s){if(!this.convert&&!this.isUndef(this.convert))return r;switch(s){case Tone.Type.Decibels:return this.gainToDb(r);default:return r}};var noteToScaleIndex={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},scaleIndexToNote=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return Tone.A4=440,Tone.prototype.noteToFrequency=function(r){var s=r.split(/(-?\d+)/);if(3===s.length){var a=noteToScaleIndex[s[0].toLowerCase()],c=s[1],l=a+12*(parseInt(c,10)+1);return this.midiToFrequency(l)}return 0},Tone.prototype.frequencyToNote=function(r){var s=Math.log(r/Tone.A4)/Math.LN2,a=Math.round(12*s)+57,c=Math.floor(a/12);return 0>c&&(a+=-12*c),scaleIndexToNote[a%12]+c.toString()},Tone.prototype.intervalToFrequencyRatio=function(r){return Math.pow(2,r/12)},Tone.prototype.midiToNote=function(r){var s=Math.floor(r/12)-1;return scaleIndexToNote[r%12]+s},Tone.prototype.noteToMidi=function(r){var s=r.split(/(\d+)/);if(3===s.length){var a=noteToScaleIndex[s[0].toLowerCase()],c=s[1];return a+12*(parseInt(c,10)+1)}return 0},Tone.prototype.midiToFrequency=function(r){return Tone.A4*Math.pow(2,(r-69)/12)},Tone}(Tone_core_Tone),Tone_core_Param=function(r){"use strict";return r.Param=function(){var s=this.optionsObject(arguments,["param","units","convert"],r.Param.defaults);this._param=this.input=s.param,this.units=s.units,this.convert=s.convert,this.overridden=!1,this.isUndef(s.value)||(this.value=s.value)},r.extend(r.Param),r.Param.defaults={units:r.Type.Default,convert:!0,param:void 0},Object.defineProperty(r.Param.prototype,"value",{get:function(){return this._toUnits(this._param.value)},set:function(r){var s=this._fromUnits(r);this._param.value=s}}),r.Param.prototype._fromUnits=function(s){if(!this.convert&&!this.isUndef(this.convert))return s;switch(this.units){case r.Type.Time:return this.toSeconds(s);case r.Type.Frequency:return this.toFrequency(s);case r.Type.Decibels:return this.dbToGain(s);case r.Type.NormalRange:return Math.min(Math.max(s,0),1);case r.Type.AudioRange:return Math.min(Math.max(s,-1),1);case r.Type.Positive:return Math.max(s,0);default:return s}},r.Param.prototype._toUnits=function(s){if(!this.convert&&!this.isUndef(this.convert))return s;switch(this.units){case r.Type.Decibels:return this.gainToDb(s);default:return s}},r.Param.prototype._minOutput=1e-5,r.Param.prototype.setValueAtTime=function(r,s){return r=this._fromUnits(r),this._param.setValueAtTime(r,this.toSeconds(s)),this},r.Param.prototype.setRampPoint=function(r){r=this.defaultArg(r,this.now());var s=this._param.value;return this._param.setValueAtTime(s,r),this},r.Param.prototype.linearRampToValueAtTime=function(r,s){return r=this._fromUnits(r),this._param.linearRampToValueAtTime(r,this.toSeconds(s)),this},r.Param.prototype.exponentialRampToValueAtTime=function(r,s){return r=this._fromUnits(r),r=Math.max(this._minOutput,r),this._param.exponentialRampToValueAtTime(r,this.toSeconds(s)),this},r.Param.prototype.exponentialRampToValue=function(r,s){var a=this.now(),c=this.value;return this.setValueAtTime(Math.max(c,this._minOutput),a),this.exponentialRampToValueAtTime(r,a+this.toSeconds(s)),this},r.Param.prototype.linearRampToValue=function(r,s){var a=this.now();return this.setRampPoint(a),this.linearRampToValueAtTime(r,a+this.toSeconds(s)),this},r.Param.prototype.setTargetAtTime=function(r,s,a){return r=this._fromUnits(r),r=Math.max(this._minOutput,r),a=Math.max(this._minOutput,a),this._param.setTargetAtTime(r,this.toSeconds(s),a),this},r.Param.prototype.setValueCurveAtTime=function(r,s,a){for(var c=0;c<r.length;c++)r[c]=this._fromUnits(r[c]);return this._param.setValueCurveAtTime(r,this.toSeconds(s),this.toSeconds(a)),this},r.Param.prototype.cancelScheduledValues=function(r){return this._param.cancelScheduledValues(this.toSeconds(r)),this},r.Param.prototype.rampTo=function(s,a){return a=this.defaultArg(a,0),this.units===r.Type.Frequency||this.units===r.Type.BPM?this.exponentialRampToValue(s,a):this.linearRampToValue(s,a),this},r.Param.prototype.dispose=function(){return r.prototype.dispose.call(this),this._param=null,this},r.Param}(Tone_core_Tone),Tone_core_Gain=function(r){"use strict";return r.Gain=function(){var s=this.optionsObject(arguments,["gain","units"],r.Gain.defaults);this.input=this.output=this._gainNode=this.context.createGain(),this.gain=new r.Param({param:this._gainNode.gain,units:s.units,value:s.gain,convert:s.convert}),this._readOnly("gain")},r.extend(r.Gain),r.Gain.defaults={gain:1,convert:!0},r.Gain.prototype.dispose=function(){r.Param.prototype.dispose.call(this),this._gainNode.disconnect(),this._gainNode=null,this._writable("gain"),this.gain.dispose(),this.gain=null},r.Gain}(Tone_core_Tone),Tone_signal_Signal=function(r){"use strict";return r.Signal=function(){var s=this.optionsObject(arguments,["value","units"],r.Signal.defaults);this.output=this._gain=this.context.createGain(),s.param=this._gain.gain,r.Param.call(this,s),this.input=this._param=this._gain.gain,r.Signal._constant.chain(this._gain)},r.extend(r.Signal,r.Param),r.Signal.defaults={value:0,units:r.Type.Default,convert:!0},r.Signal.prototype.connect=r.SignalBase.prototype.connect,r.Signal.prototype.dispose=function(){return r.Param.prototype.dispose.call(this),this._param=null,this._gain.disconnect(),this._gain=null,this},r.Signal._constant=null,r._initAudioContext((function(s){for(var a=s.createBuffer(1,128,s.sampleRate),c=a.getChannelData(0),l=0;l<c.length;l++)c[l]=1;r.Signal._constant=s.createBufferSource(),r.Signal._constant.channelCount=1,r.Signal._constant.channelCountMode="explicit",r.Signal._constant.buffer=a,r.Signal._constant.loop=!0,r.Signal._constant.start(0),r.Signal._constant.noGC()})),r.Signal}(Tone_core_Tone),Tone_signal_Add=function(r){"use strict";return r.Add=function(s){r.call(this,2,0),this._sum=this.input[0]=this.input[1]=this.output=this.context.createGain(),this._param=this.input[1]=new r.Signal(s),this._param.connect(this._sum)},r.extend(r.Add,r.Signal),r.Add.prototype.dispose=function(){return r.prototype.dispose.call(this),this._sum.disconnect(),this._sum=null,this._param.dispose(),this._param=null,this},r.Add}(Tone_core_Tone),Tone_signal_Multiply=function(r){"use strict";return r.Multiply=function(s){r.call(this,2,0),this._mult=this.input[0]=this.output=this.context.createGain(),this._param=this.input[1]=this.output.gain,this._param.value=this.defaultArg(s,0)},r.extend(r.Multiply,r.Signal),r.Multiply.prototype.dispose=function(){return r.prototype.dispose.call(this),this._mult.disconnect(),this._mult=null,this._param=null,this},r.Multiply}(Tone_core_Tone),Tone_signal_Scale=function(r){"use strict";return r.Scale=function(s,a){this._outputMin=this.defaultArg(s,0),this._outputMax=this.defaultArg(a,1),this._scale=this.input=new r.Multiply(1),this._add=this.output=new r.Add(0),this._scale.connect(this._add),this._setRange()},r.extend(r.Scale,r.SignalBase),Object.defineProperty(r.Scale.prototype,"min",{get:function(){return this._outputMin},set:function(r){this._outputMin=r,this._setRange()}}),Object.defineProperty(r.Scale.prototype,"max",{get:function(){return this._outputMax},set:function(r){this._outputMax=r,this._setRange()}}),r.Scale.prototype._setRange=function(){this._add.value=this._outputMin,this._scale.value=this._outputMax-this._outputMin},r.Scale.prototype.dispose=function(){return r.prototype.dispose.call(this),this._add.dispose(),this._add=null,this._scale.dispose(),this._scale=null,this},r.Scale}(Tone_core_Tone),signal=function(){"use strict";var r=Tone_signal_Signal,s=Tone_signal_Add,a=Tone_signal_Multiply,c=Tone_signal_Scale,l=master;Tone_core_Tone.setContext(l.audiocontext),p5.Signal=function(s){return new r(s)},r.prototype.fade=r.prototype.linearRampToValueAtTime,a.prototype.fade=r.prototype.fade,s.prototype.fade=r.prototype.fade,c.prototype.fade=r.prototype.fade,r.prototype.setInput=function(r){r.connect(this)},a.prototype.setInput=r.prototype.setInput,s.prototype.setInput=r.prototype.setInput,c.prototype.setInput=r.prototype.setInput,r.prototype.add=function(r){var a=new s(r);return this.connect(a),a},a.prototype.add=r.prototype.add,s.prototype.add=r.prototype.add,c.prototype.add=r.prototype.add,r.prototype.mult=function(r){var s=new a(r);return this.connect(s),s},a.prototype.mult=r.prototype.mult,s.prototype.mult=r.prototype.mult,c.prototype.mult=r.prototype.mult,r.prototype.scale=function(r,s,a,l){var f,d;4===arguments.length?(f=p5.prototype.map(a,r,s,0,1)-.5,d=p5.prototype.map(l,r,s,0,1)-.5):(f=arguments[0],d=arguments[1]);var m=new c(f,d);return this.connect(m),m},a.prototype.scale=r.prototype.scale,s.prototype.scale=r.prototype.scale,c.prototype.scale=r.prototype.scale}(),oscillator=function(){"use strict";var r=master,s=Tone_signal_Add,a=Tone_signal_Multiply,c=Tone_signal_Scale;p5.Oscillator=function(s,a){if("string"==typeof s){var c=a;a=s,s=c}if("number"==typeof a){c=a;a=s,s=c}this.started=!1,this.phaseAmount=void 0,this.oscillator=r.audiocontext.createOscillator(),this.f=s||440,this.oscillator.type=a||"sine",this.oscillator.frequency.setValueAtTime(this.f,r.audiocontext.currentTime),this.oscillator,this.output=r.audiocontext.createGain(),this._freqMods=[],this.output.gain.value=.5,this.output.gain.setValueAtTime(.5,r.audiocontext.currentTime),this.oscillator.connect(this.output),this.panPosition=0,this.connection=r.input,this.panner=new p5.Panner(this.output,this.connection,1),this.mathOps=[this.output],r.soundArray.push(this)},p5.Oscillator.prototype.start=function(s,a){if(this.started){var c=r.audiocontext.currentTime;this.stop(c)}if(!this.started){var l=a||this.f,f=this.oscillator.type;for(var d in this.oscillator&&(this.oscillator.disconnect(),this.oscillator=void 0),this.oscillator=r.audiocontext.createOscillator(),this.oscillator.frequency.exponentialRampToValueAtTime(Math.abs(l),r.audiocontext.currentTime),this.oscillator.type=f,this.oscillator.connect(this.output),s=s||0,this.oscillator.start(s+r.audiocontext.currentTime),this.freqNode=this.oscillator.frequency,this._freqMods)void 0!==this._freqMods[d].connect&&this._freqMods[d].connect(this.oscillator.frequency);this.started=!0}},p5.Oscillator.prototype.stop=function(s){if(this.started){var a=s||0,c=r.audiocontext.currentTime;this.oscillator.stop(a+c),this.started=!1}},p5.Oscillator.prototype.amp=function(s,a,c){if("number"==typeof s){a=a||0,c=c||0;var l=r.audiocontext.currentTime,f=this.output.gain.value;this.output.gain.cancelScheduledValues(l),this.output.gain.linearRampToValueAtTime(f,l+c),this.output.gain.linearRampToValueAtTime(s,l+c+a)}else{if(!s)return this.output.gain;s.connect(this.output.gain)}},p5.Oscillator.prototype.fade=p5.Oscillator.prototype.amp,p5.Oscillator.prototype.getAmp=function(){return this.output.gain.value},p5.Oscillator.prototype.freq=function(s,a,c){if("number"!=typeof s||isNaN(s)){if(!s)return this.oscillator.frequency;s.output&&(s=s.output),s.connect(this.oscillator.frequency),this._freqMods.push(s)}else{this.f=s;var l=r.audiocontext.currentTime;c=c||0;0==(a=a||0)?(this.oscillator.frequency.cancelScheduledValues(l),this.oscillator.frequency.setValueAtTime(s,c+l)):s>0?this.oscillator.frequency.exponentialRampToValueAtTime(s,c+a+l):this.oscillator.frequency.linearRampToValueAtTime(s,c+a+l),this.phaseAmount&&this.phase(this.phaseAmount)}},p5.Oscillator.prototype.getFreq=function(){return this.oscillator.frequency.value},p5.Oscillator.prototype.setType=function(r){this.oscillator.type=r},p5.Oscillator.prototype.getType=function(){return this.oscillator.type},p5.Oscillator.prototype.connect=function(s){s?s.hasOwnProperty("input")?(this.panner.connect(s.input),this.connection=s.input):(this.panner.connect(s),this.connection=s):this.panner.connect(r.input)},p5.Oscillator.prototype.disconnect=function(r){this.output.disconnect(),this.panner.disconnect(),this.output.connect(this.panner),this.oscMods=[]},p5.Oscillator.prototype.pan=function(r,s){this.panPosition=r,this.panner.pan(r,s)},p5.Oscillator.prototype.getPan=function(){return this.panPosition},p5.Oscillator.prototype.dispose=function(){var s=r.soundArray.indexOf(this);if(r.soundArray.splice(s,1),this.oscillator){var a=r.audiocontext.currentTime;this.stop(a),this.disconnect(),this.panner=null,this.oscillator=null}this.osc2&&this.osc2.dispose()},p5.Oscillator.prototype.phase=function(s){var a=p5.prototype.map(s,0,1,0,1/this.f),c=r.audiocontext.currentTime;this.phaseAmount=s,this.dNode||(this.dNode=r.audiocontext.createDelay(),this.oscillator.disconnect(),this.oscillator.connect(this.dNode),this.dNode.connect(this.output)),this.dNode.delayTime.setValueAtTime(a,c)};var n=function(r,s,a,c,l){var f=r.oscillator;for(var d in r.mathOps)r.mathOps[d]instanceof l&&(f.disconnect(),r.mathOps[d].dispose(),(a=d)<r.mathOps.length-2&&(c=r.mathOps[d+1]));return a==r.mathOps.length-1&&r.mathOps.push(c),d>0&&(f=r.mathOps[d-1]),f.disconnect(),f.connect(s),s.connect(c),r.mathOps[a]=s,r};p5.Oscillator.prototype.add=function(r){var a=new s(r),c=this.mathOps.length-1,l=this.output;return n(this,a,c,l,s)},p5.Oscillator.prototype.mult=function(r){var s=new a(r),c=this.mathOps.length-1,l=this.output;return n(this,s,c,l,a)},p5.Oscillator.prototype.scale=function(r,s,a,l){var f,d;4===arguments.length?(f=p5.prototype.map(a,r,s,0,1)-.5,d=p5.prototype.map(l,r,s,0,1)-.5):(f=arguments[0],d=arguments[1]);var m=new c(f,d),y=this.mathOps.length-1,v=this.output;return n(this,m,y,v,c)},p5.SinOsc=function(r){p5.Oscillator.call(this,r,"sine")},p5.SinOsc.prototype=Object.create(p5.Oscillator.prototype),p5.TriOsc=function(r){p5.Oscillator.call(this,r,"triangle")},p5.TriOsc.prototype=Object.create(p5.Oscillator.prototype),p5.SawOsc=function(r){p5.Oscillator.call(this,r,"sawtooth")},p5.SawOsc.prototype=Object.create(p5.Oscillator.prototype),p5.SqrOsc=function(r){p5.Oscillator.call(this,r,"square")},p5.SqrOsc.prototype=Object.create(p5.Oscillator.prototype)}(),Tone_core_Timeline=function(r){"use strict";return r.Timeline=function(){var s=this.optionsObject(arguments,["memory"],r.Timeline.defaults);this._timeline=[],this._toRemove=[],this._iterating=!1,this.memory=s.memory},r.extend(r.Timeline),r.Timeline.defaults={memory:1/0},Object.defineProperty(r.Timeline.prototype,"length",{get:function(){return this._timeline.length}}),r.Timeline.prototype.addEvent=function(r){if(this.isUndef(r.time))throw new Error("events must have a time attribute");if(r.time=this.toSeconds(r.time),this._timeline.length){var s=this._search(r.time);this._timeline.splice(s+1,0,r)}else this._timeline.push(r);if(this.length>this.memory){var a=this.length-this.memory;this._timeline.splice(0,a)}return this},r.Timeline.prototype.removeEvent=function(r){if(this._iterating)this._toRemove.push(r);else{var s=this._timeline.indexOf(r);-1!==s&&this._timeline.splice(s,1)}return this},r.Timeline.prototype.getEvent=function(r){r=this.toSeconds(r);var s=this._search(r);return-1!==s?this._timeline[s]:null},r.Timeline.prototype.getEventAfter=function(r){r=this.toSeconds(r);var s=this._search(r);return s+1<this._timeline.length?this._timeline[s+1]:null},r.Timeline.prototype.getEventBefore=function(r){r=this.toSeconds(r);var s=this._search(r);return s-1>=0?this._timeline[s-1]:null},r.Timeline.prototype.cancel=function(r){if(this._timeline.length>1){r=this.toSeconds(r);var s=this._search(r);this._timeline=s>=0?this._timeline.slice(0,s):[]}else 1===this._timeline.length&&this._timeline[0].time>=r&&(this._timeline=[]);return this},r.Timeline.prototype.cancelBefore=function(r){if(this._timeline.length){r=this.toSeconds(r);var s=this._search(r);s>=0&&(this._timeline=this._timeline.slice(s+1))}return this},r.Timeline.prototype._search=function(r){for(var s=0,a=this._timeline.length,c=a;c>=s&&a>s;){var l=Math.floor(s+(c-s)/2),f=this._timeline[l];if(f.time===r){for(var d=l;d<this._timeline.length;d++){this._timeline[d].time===r&&(l=d)}return l}f.time>r?c=l-1:f.time<r&&(s=l+1)}return s-1},r.Timeline.prototype._iterate=function(r,s,a){this._iterating=!0,s=this.defaultArg(s,0),a=this.defaultArg(a,this._timeline.length-1);for(var c=s;a>=c;c++)r(this._timeline[c]);if(this._iterating=!1,this._toRemove.length>0){for(var l=0;l<this._toRemove.length;l++){var f=this._timeline.indexOf(this._toRemove[l]);-1!==f&&this._timeline.splice(f,1)}this._toRemove=[]}},r.Timeline.prototype.forEach=function(r){return this._iterate(r),this},r.Timeline.prototype.forEachBefore=function(r,s){r=this.toSeconds(r);var a=this._search(r);return-1!==a&&this._iterate(s,0,a),this},r.Timeline.prototype.forEachAfter=function(r,s){r=this.toSeconds(r);var a=this._search(r);return this._iterate(s,a+1),this},r.Timeline.prototype.forEachFrom=function(r,s){r=this.toSeconds(r);for(var a=this._search(r);a>=0&&this._timeline[a].time>=r;)a--;return this._iterate(s,a+1),this},r.Timeline.prototype.forEachAtTime=function(r,s){r=this.toSeconds(r);var a=this._search(r);return-1!==a&&this._iterate((function(a){a.time===r&&s(a)}),0,a),this},r.Timeline.prototype.dispose=function(){r.prototype.dispose.call(this),this._timeline=null,this._toRemove=null},r.Timeline}(Tone_core_Tone),Tone_signal_TimelineSignal=function(r){"use strict";return r.TimelineSignal=function(){var s=this.optionsObject(arguments,["value","units"],r.Signal.defaults);r.Signal.apply(this,s),s.param=this._param,r.Param.call(this,s),this._events=new r.Timeline(10),this._initial=this._fromUnits(this._param.value)},r.extend(r.TimelineSignal,r.Param),r.TimelineSignal.Type={Linear:"linear",Exponential:"exponential",Target:"target",Set:"set"},Object.defineProperty(r.TimelineSignal.prototype,"value",{get:function(){return this._toUnits(this._param.value)},set:function(r){var s=this._fromUnits(r);this._initial=s,this._param.value=s}}),r.TimelineSignal.prototype.setValueAtTime=function(s,a){return s=this._fromUnits(s),a=this.toSeconds(a),this._events.addEvent({type:r.TimelineSignal.Type.Set,value:s,time:a}),this._param.setValueAtTime(s,a),this},r.TimelineSignal.prototype.linearRampToValueAtTime=function(s,a){return s=this._fromUnits(s),a=this.toSeconds(a),this._events.addEvent({type:r.TimelineSignal.Type.Linear,value:s,time:a}),this._param.linearRampToValueAtTime(s,a),this},r.TimelineSignal.prototype.exponentialRampToValueAtTime=function(s,a){return s=this._fromUnits(s),s=Math.max(this._minOutput,s),a=this.toSeconds(a),this._events.addEvent({type:r.TimelineSignal.Type.Exponential,value:s,time:a}),this._param.exponentialRampToValueAtTime(s,a),this},r.TimelineSignal.prototype.setTargetAtTime=function(s,a,c){return s=this._fromUnits(s),s=Math.max(this._minOutput,s),c=Math.max(this._minOutput,c),a=this.toSeconds(a),this._events.addEvent({type:r.TimelineSignal.Type.Target,value:s,time:a,constant:c}),this._param.setTargetAtTime(s,a,c),this},r.TimelineSignal.prototype.cancelScheduledValues=function(r){return this._events.cancel(r),this._param.cancelScheduledValues(this.toSeconds(r)),this},r.TimelineSignal.prototype.setRampPoint=function(s){s=this.toSeconds(s);var a=this.getValueAtTime(s),c=this._searchAfter(s);return c&&(this.cancelScheduledValues(s),c.type===r.TimelineSignal.Type.Linear?this.linearRampToValueAtTime(a,s):c.type===r.TimelineSignal.Type.Exponential&&this.exponentialRampToValueAtTime(a,s)),this.setValueAtTime(a,s),this},r.TimelineSignal.prototype.linearRampToValueBetween=function(r,s,a){return this.setRampPoint(s),this.linearRampToValueAtTime(r,a),this},r.TimelineSignal.prototype.exponentialRampToValueBetween=function(r,s,a){return this.setRampPoint(s),this.exponentialRampToValueAtTime(r,a),this},r.TimelineSignal.prototype._searchBefore=function(r){return this._events.getEvent(r)},r.TimelineSignal.prototype._searchAfter=function(r){return this._events.getEventAfter(r)},r.TimelineSignal.prototype.getValueAtTime=function(s){var a=this._searchAfter(s),c=this._searchBefore(s),l=this._initial;if(null===c)l=this._initial;else if(c.type===r.TimelineSignal.Type.Target){var f,d=this._events.getEventBefore(c.time);f=null===d?this._initial:d.value,l=this._exponentialApproach(c.time,f,c.value,c.constant,s)}else l=null===a?c.value:a.type===r.TimelineSignal.Type.Linear?this._linearInterpolate(c.time,c.value,a.time,a.value,s):a.type===r.TimelineSignal.Type.Exponential?this._exponentialInterpolate(c.time,c.value,a.time,a.value,s):c.value;return l},r.TimelineSignal.prototype.connect=r.SignalBase.prototype.connect,r.TimelineSignal.prototype._exponentialApproach=function(r,s,a,c,l){return a+(s-a)*Math.exp(-(l-r)/c)},r.TimelineSignal.prototype._linearInterpolate=function(r,s,a,c,l){return s+(l-r)/(a-r)*(c-s)},r.TimelineSignal.prototype._exponentialInterpolate=function(r,s,a,c,l){return(s=Math.max(this._minOutput,s))*Math.pow(c/s,(l-r)/(a-r))},r.TimelineSignal.prototype.dispose=function(){r.Signal.prototype.dispose.call(this),r.Param.prototype.dispose.call(this),this._events.dispose(),this._events=null},r.TimelineSignal}(Tone_core_Tone),env=function(){"use strict";var r=master,s=Tone_signal_Add,a=Tone_signal_Multiply,c=Tone_signal_Scale,l=Tone_signal_TimelineSignal;Tone_core_Tone.setContext(r.audiocontext),p5.Env=function(s,a,c,f,d,m){r.audiocontext.currentTime,this.aTime=s||.1,this.aLevel=a||1,this.dTime=c||.5,this.dLevel=f||0,this.rTime=d||0,this.rLevel=m||0,this._rampHighPercentage=.98,this._rampLowPercentage=.02,this.output=r.audiocontext.createGain(),this.control=new l,this._init(),this.control.connect(this.output),this.connection=null,this.mathOps=[this.control],this.isExponential=!1,this.sourceToClear=null,this.wasTriggered=!1,r.soundArray.push(this)},p5.Env.prototype._init=function(){var s=r.audiocontext.currentTime;this.control.setTargetAtTime(1e-5,s,.001),this._setRampAD(this.aTime,this.dTime)},p5.Env.prototype.set=function(r,s,a,c,l,f){this.aTime=r,this.aLevel=s,this.dTime=a||0,this.dLevel=c||0,this.rTime=l||0,this.rLevel=f||0,this._setRampAD(r,a)},p5.Env.prototype.setADSR=function(r,s,a,c){this.aTime=r,this.dTime=s||0,this.sPercent=a||0,this.dLevel=void 0!==a?a*(this.aLevel-this.rLevel)+this.rLevel:0,this.rTime=c||0,this._setRampAD(r,s)},p5.Env.prototype.setRange=function(r,s){this.aLevel=r||1,this.rLevel=s||0},p5.Env.prototype._setRampAD=function(r,s){this._rampAttackTime=this.checkExpInput(r),this._rampDecayTime=this.checkExpInput(s);var a=1;a=Math.log(1/this.checkExpInput(1-this._rampHighPercentage)),this._rampAttackTC=r/this.checkExpInput(a),a=Math.log(1/this._rampLowPercentage),this._rampDecayTC=s/this.checkExpInput(a)},p5.Env.prototype.setRampPercentages=function(r,s){this._rampHighPercentage=this.checkExpInput(r),this._rampLowPercentage=this.checkExpInput(s);var a=1;a=Math.log(1/this.checkExpInput(1-this._rampHighPercentage)),this._rampAttackTC=this._rampAttackTime/this.checkExpInput(a),a=Math.log(1/this._rampLowPercentage),this._rampDecayTC=this._rampDecayTime/this.checkExpInput(a)},p5.Env.prototype.setInput=function(r){for(var s=0;s<arguments.length;s++)this.connect(arguments[s])},p5.Env.prototype.setExp=function(r){this.isExponential=r},p5.Env.prototype.checkExpInput=function(r){return 0>=r&&(r=1e-8),r},p5.Env.prototype.play=function(s,a,c){var l=(r.audiocontext.currentTime,a||0);c=c||0;s&&this.connection!==s&&this.connect(s),this.triggerAttack(s,l),this.triggerRelease(s,l+this.aTime+this.dTime+c)},p5.Env.prototype.triggerAttack=function(s,a){var c=r.audiocontext.currentTime+(a||0);this.lastAttack=c,this.wasTriggered=!0,s&&this.connection!==s&&this.connect(s);var l=this.control.getValueAtTime(c);this.control.cancelScheduledValues(c),1==this.isExponential?this.control.exponentialRampToValueAtTime(this.checkExpInput(l),c):this.control.linearRampToValueAtTime(l,c),c+=this.aTime,1==this.isExponential?(this.control.exponentialRampToValueAtTime(this.checkExpInput(this.aLevel),c),l=this.checkExpInput(this.control.getValueAtTime(c)),this.control.cancelScheduledValues(c),this.control.exponentialRampToValueAtTime(l,c)):(this.control.linearRampToValueAtTime(this.aLevel,c),l=this.control.getValueAtTime(c),this.control.cancelScheduledValues(c),this.control.linearRampToValueAtTime(l,c)),c+=this.dTime,1==this.isExponential?(this.control.exponentialRampToValueAtTime(this.checkExpInput(this.dLevel),c),l=this.checkExpInput(this.control.getValueAtTime(c)),this.control.cancelScheduledValues(c),this.control.exponentialRampToValueAtTime(l,c)):(this.control.linearRampToValueAtTime(this.dLevel,c),l=this.control.getValueAtTime(c),this.control.cancelScheduledValues(c),this.control.linearRampToValueAtTime(l,c))},p5.Env.prototype.triggerRelease=function(s,a){if(this.wasTriggered){var c=r.audiocontext.currentTime+(a||0);s&&this.connection!==s&&this.connect(s);var l=this.control.getValueAtTime(c);this.control.cancelScheduledValues(c),1==this.isExponential?this.control.exponentialRampToValueAtTime(this.checkExpInput(l),c):this.control.linearRampToValueAtTime(l,c),c+=this.rTime,1==this.isExponential?(this.control.exponentialRampToValueAtTime(this.checkExpInput(this.rLevel),c),l=this.checkExpInput(this.control.getValueAtTime(c)),this.control.cancelScheduledValues(c),this.control.exponentialRampToValueAtTime(l,c)):(this.control.linearRampToValueAtTime(this.rLevel,c),l=this.control.getValueAtTime(c),this.control.cancelScheduledValues(c),this.control.linearRampToValueAtTime(l,c)),this.wasTriggered=!1}},p5.Env.prototype.ramp=function(s,a,c,l){var f=r.audiocontext.currentTime+(a||0),d=this.checkExpInput(c),m=void 0!==l?this.checkExpInput(l):void 0;s&&this.connection!==s&&this.connect(s);var y=this.checkExpInput(this.control.getValueAtTime(f));this.control.cancelScheduledValues(f),d>y?(this.control.setTargetAtTime(d,f,this._rampAttackTC),f+=this._rampAttackTime):y>d&&(this.control.setTargetAtTime(d,f,this._rampDecayTC),f+=this._rampDecayTime),void 0!==m&&(m>d?this.control.setTargetAtTime(m,f,this._rampAttackTC):d>m&&this.control.setTargetAtTime(m,f,this._rampDecayTC))},p5.Env.prototype.connect=function(s){this.connection=s,(s instanceof p5.Oscillator||s instanceof p5.SoundFile||s instanceof p5.AudioIn||s instanceof p5.Reverb||s instanceof p5.Noise||s instanceof p5.Filter||s instanceof p5.Delay)&&(s=s.output.gain),s instanceof AudioParam&&s.setValueAtTime(0,r.audiocontext.currentTime),s instanceof p5.Signal&&s.setValue(0),this.output.connect(s)},p5.Env.prototype.disconnect=function(r){this.output.disconnect()},p5.Env.prototype.add=function(r){var a=new s(r),c=this.mathOps.length,l=this.output;return p5.prototype._mathChain(this,a,c,l,s)},p5.Env.prototype.mult=function(r){var s=new a(r),c=this.mathOps.length,l=this.output;return p5.prototype._mathChain(this,s,c,l,a)},p5.Env.prototype.scale=function(r,s,a,l){var f=new c(r,s,a,l),d=this.mathOps.length,m=this.output;return p5.prototype._mathChain(this,f,d,m,c)},p5.Env.prototype.dispose=function(){var s=r.soundArray.indexOf(this);r.soundArray.splice(s,1),r.audiocontext.currentTime,this.disconnect();try{this.control.dispose(),this.control=null}catch(r){}for(var a=1;a<this.mathOps.length;a++)mathOps[a].dispose()}}(),pulse=function(){"use strict";function t(){for(var s=r.audiocontext,a=s.createBuffer(1,2048,s.sampleRate),c=a.getChannelData(0),l=0;2048>l;l++)c[l]=1;var f=s.createBufferSource();return f.buffer=a,f.loop=!0,f}var r=master;p5.Pulse=function(s,a){p5.Oscillator.call(this,s,"sawtooth"),this.w=a||0,this.osc2=new p5.SawOsc(s),this.dNode=r.audiocontext.createDelay(),this.dcOffset=t(),this.dcGain=r.audiocontext.createGain(),this.dcOffset.connect(this.dcGain),this.dcGain.connect(this.output),this.f=s||440;var c=this.w/this.oscillator.frequency.value;this.dNode.delayTime.value=c,this.dcGain.gain.value=1.7*(.5-this.w),this.osc2.disconnect(),this.osc2.panner.disconnect(),this.osc2.amp(-1),this.osc2.output.connect(this.dNode),this.dNode.connect(this.output),this.output.gain.value=1,this.output.connect(this.panner)},p5.Pulse.prototype=Object.create(p5.Oscillator.prototype),p5.Pulse.prototype.width=function(r){if("number"==typeof r){if(1>=r&&r>=0){this.w=r;var s=this.w/this.oscillator.frequency.value;this.dNode.delayTime.value=s}this.dcGain.gain.value=1.7*(.5-this.w)}else{r.connect(this.dNode.delayTime);var a=new p5.SignalAdd(-.5);a.setInput(r),(a=(a=a.mult(-1)).mult(1.7)).connect(this.dcGain.gain)}},p5.Pulse.prototype.start=function(s,a){var c=r.audiocontext.currentTime,l=a||0;if(!this.started){var f=s||this.f,d=this.oscillator.type;this.oscillator=r.audiocontext.createOscillator(),this.oscillator.frequency.setValueAtTime(f,c),this.oscillator.type=d,this.oscillator.connect(this.output),this.oscillator.start(l+c),this.osc2.oscillator=r.audiocontext.createOscillator(),this.osc2.oscillator.frequency.setValueAtTime(f,l+c),this.osc2.oscillator.type=d,this.osc2.oscillator.connect(this.osc2.output),this.osc2.start(l+c),this.freqNode=[this.oscillator.frequency,this.osc2.oscillator.frequency],this.dcOffset=t(),this.dcOffset.connect(this.dcGain),this.dcOffset.start(l+c),void 0!==this.mods&&void 0!==this.mods.frequency&&(this.mods.frequency.connect(this.freqNode[0]),this.mods.frequency.connect(this.freqNode[1])),this.started=!0,this.osc2.started=!0}},p5.Pulse.prototype.stop=function(s){if(this.started){var a=s||0,c=r.audiocontext.currentTime;this.oscillator.stop(a+c),this.osc2.oscillator.stop(a+c),this.dcOffset.stop(a+c),this.started=!1,this.osc2.started=!1}},p5.Pulse.prototype.freq=function(s,a,c){if("number"==typeof s){this.f=s;var l=r.audiocontext.currentTime,f=(a=a||0,c=c||0,this.oscillator.frequency.value);this.oscillator.frequency.cancelScheduledValues(l),this.oscillator.frequency.setValueAtTime(f,l+c),this.oscillator.frequency.exponentialRampToValueAtTime(s,c+a+l),this.osc2.oscillator.frequency.cancelScheduledValues(l),this.osc2.oscillator.frequency.setValueAtTime(f,l+c),this.osc2.oscillator.frequency.exponentialRampToValueAtTime(s,c+a+l),this.freqMod&&(this.freqMod.output.disconnect(),this.freqMod=null)}else s.output&&(s.output.disconnect(),s.output.connect(this.oscillator.frequency),s.output.connect(this.osc2.oscillator.frequency),this.freqMod=s)}}(),noise=function(){"use strict";var r=master;p5.Noise=function(r){var l;p5.Oscillator.call(this),delete this.f,delete this.freq,delete this.oscillator,l="brown"===r?c:"pink"===r?a:s,this.buffer=l},p5.Noise.prototype=Object.create(p5.Oscillator.prototype);var s=function(){for(var s=2*r.audiocontext.sampleRate,a=r.audiocontext.createBuffer(1,s,r.audiocontext.sampleRate),c=a.getChannelData(0),l=0;s>l;l++)c[l]=2*Math.random()-1;return a.type="white",a}(),a=function(){var s,a,c,l,f,d,m,y=2*r.audiocontext.sampleRate,v=r.audiocontext.createBuffer(1,y,r.audiocontext.sampleRate),g=v.getChannelData(0);s=a=c=l=f=d=m=0;for(var T=0;y>T;T++){var _=2*Math.random()-1;s=.99886*s+.0555179*_,a=.99332*a+.0750759*_,c=.969*c+.153852*_,l=.8665*l+.3104856*_,f=.55*f+.5329522*_,d=-.7616*d-.016898*_,g[T]=s+a+c+l+f+d+m+.5362*_,g[T]*=.11,m=.115926*_}return v.type="pink",v}(),c=function(){for(var s=2*r.audiocontext.sampleRate,a=r.audiocontext.createBuffer(1,s,r.audiocontext.sampleRate),c=a.getChannelData(0),l=0,f=0;s>f;f++){var d=2*Math.random()-1;c[f]=(l+.02*d)/1.02,l=c[f],c[f]*=3.5}return a.type="brown",a}();p5.Noise.prototype.setType=function(l){switch(l){case"white":this.buffer=s;break;case"pink":this.buffer=a;break;case"brown":this.buffer=c;break;default:this.buffer=s}if(this.started){var f=r.audiocontext.currentTime;this.stop(f),this.start(f+.01)}},p5.Noise.prototype.getType=function(){return this.buffer.type},p5.Noise.prototype.start=function(){this.started&&this.stop(),this.noise=r.audiocontext.createBufferSource(),this.noise.buffer=this.buffer,this.noise.loop=!0,this.noise.connect(this.output);var s=r.audiocontext.currentTime;this.noise.start(s),this.started=!0},p5.Noise.prototype.stop=function(){var s=r.audiocontext.currentTime;this.noise&&(this.noise.stop(s),this.started=!1)},p5.Noise.prototype.dispose=function(){var s=r.audiocontext.currentTime,a=r.soundArray.indexOf(this);r.soundArray.splice(a,1),this.noise&&(this.noise.disconnect(),this.stop(s)),this.output&&this.output.disconnect(),this.panner&&this.panner.disconnect(),this.output=null,this.panner=null,this.buffer=null,this.noise=null}}(),audioin=function(){"use strict";var r=master;p5.AudioIn=function(s){this.input=r.audiocontext.createGain(),this.output=r.audiocontext.createGain(),this.stream=null,this.mediaStream=null,this.currentSource=0,this.enabled=!1,this.amplitude=new p5.Amplitude,this.output.connect(this.amplitude.input),void 0===window.MediaStreamTrack?s?s():console.log("This browser does not support AudioIn"):"function"==typeof window.MediaStreamTrack.getSources&&window.MediaStreamTrack.getSources(this._gotSources),r.soundArray.push(this)},p5.AudioIn.prototype.start=function(s,a){var c=this;if(r.inputSources[c.currentSource]){var l={audio:{optional:[{sourceId:r.inputSources[c.currentSource].id}]}};window.navigator.getUserMedia(l,this._onStream=function(a){c.stream=a,c.enabled=!0,c.mediaStream=r.audiocontext.createMediaStreamSource(a),c.mediaStream.connect(c.output),s&&s(),c.amplitude.setInput(c.output)},this._onStreamError=function(r){a?a(r):console.error(r)})}else window.navigator.getUserMedia({audio:!0},this._onStream=function(a){c.stream=a,c.enabled=!0,c.mediaStream=r.audiocontext.createMediaStreamSource(a),c.mediaStream.connect(c.output),c.amplitude.setInput(c.output),s&&s()},this._onStreamError=function(r){a?a(r):console.error(r)})},p5.AudioIn.prototype.stop=function(){this.stream&&this.stream.getTracks()[0].stop()},p5.AudioIn.prototype.connect=function(s){s?s.hasOwnProperty("input")?this.output.connect(s.input):s.hasOwnProperty("analyser")?this.output.connect(s.analyser):this.output.connect(s):this.output.connect(r.input)},p5.AudioIn.prototype.disconnect=function(){this.output.disconnect(),this.output.connect(this.amplitude.input)},p5.AudioIn.prototype.getLevel=function(r){return r&&(this.amplitude.smoothing=r),this.amplitude.getLevel()},p5.AudioIn.prototype._gotSources=function(r){for(var s=0;s<r.length;s++){var a=r[s];if("audio"===a.kind)return a}},p5.AudioIn.prototype.amp=function(s,a){if(a){var c=a||0,l=this.output.gain.value;this.output.gain.cancelScheduledValues(r.audiocontext.currentTime),this.output.gain.setValueAtTime(l,r.audiocontext.currentTime),this.output.gain.linearRampToValueAtTime(s,c+r.audiocontext.currentTime)}else this.output.gain.cancelScheduledValues(r.audiocontext.currentTime),this.output.gain.setValueAtTime(s,r.audiocontext.currentTime)},p5.AudioIn.prototype.listSources=function(){return console.log("listSources is deprecated - please use AudioIn.getSources"),console.log("input sources: "),r.inputSources.length>0?r.inputSources:"This browser does not support MediaStreamTrack.getSources()"},p5.AudioIn.prototype.getSources=function(s){"function"==typeof window.MediaStreamTrack.getSources?window.MediaStreamTrack.getSources((function(a){for(var c=0,l=a.length;l>c;c++){var f=a[c];"audio"===f.kind&&r.inputSources.push(f)}s(r.inputSources)})):console.log("This browser does not support MediaStreamTrack.getSources()")},p5.AudioIn.prototype.setSource=function(s){r.inputSources.length>0&&s<r.inputSources.length?(this.currentSource=s,console.log("set source to "+r.inputSources[this.currentSource].id)):console.log("unable to set input source")},p5.AudioIn.prototype.dispose=function(){var s=r.soundArray.indexOf(this);r.soundArray.splice(s,1),this.stop(),this.output&&this.output.disconnect(),this.amplitude&&this.amplitude.disconnect(),this.amplitude=null,this.output=null}}(),filter=function(){"use strict";var r=master;p5.Filter=function(s){this.ac=r.audiocontext,this.input=this.ac.createGain(),this.output=this.ac.createGain(),this.biquad=this.ac.createBiquadFilter(),this.input.connect(this.biquad),this.biquad.connect(this.output),this.connect(),s&&this.setType(s),r.soundArray.push(this)},p5.Filter.prototype.process=function(r,s,a){r.connect(this.input),this.set(s,a)},p5.Filter.prototype.set=function(r,s,a){r&&this.freq(r,a),s&&this.res(s,a)},p5.Filter.prototype.freq=function(r,s){var a=this,c=s||0;return 0>=r&&(r=1),"number"==typeof r?(a.biquad.frequency.value=r,a.biquad.frequency.cancelScheduledValues(this.ac.currentTime+.01+c),a.biquad.frequency.exponentialRampToValueAtTime(r,this.ac.currentTime+.02+c)):r&&r.connect(this.biquad.frequency),a.biquad.frequency.value},p5.Filter.prototype.res=function(r,s){var a=this,c=s||0;return"number"==typeof r?(a.biquad.Q.value=r,a.biquad.Q.cancelScheduledValues(a.ac.currentTime+.01+c),a.biquad.Q.linearRampToValueAtTime(r,a.ac.currentTime+.02+c)):r&&freq.connect(this.biquad.Q),a.biquad.Q.value},p5.Filter.prototype.setType=function(r){this.biquad.type=r},p5.Filter.prototype.amp=function(s,a,c){a=a||0,c=c||0;var l=r.audiocontext.currentTime,f=this.output.gain.value;this.output.gain.cancelScheduledValues(l),this.output.gain.linearRampToValueAtTime(f,l+c+.001),this.output.gain.linearRampToValueAtTime(s,l+c+a+.001)},p5.Filter.prototype.connect=function(r){var s=r||p5.soundOut.input;this.output.connect(s)},p5.Filter.prototype.disconnect=function(){this.output.disconnect()},p5.Filter.prototype.dispose=function(){var s=r.soundArray.indexOf(this);r.soundArray.splice(s,1),this.input.disconnect(),this.input=void 0,this.output.disconnect(),this.output=void 0,this.biquad.disconnect(),this.biquad=void 0},p5.LowPass=function(){p5.Filter.call(this,"lowpass")},p5.LowPass.prototype=Object.create(p5.Filter.prototype),p5.HighPass=function(){p5.Filter.call(this,"highpass")},p5.HighPass.prototype=Object.create(p5.Filter.prototype),p5.BandPass=function(){p5.Filter.call(this,"bandpass")},p5.BandPass.prototype=Object.create(p5.Filter.prototype)}(),delay=function(){"use strict";var r=master;p5.Delay=function(){this.ac=r.audiocontext,this.input=this.ac.createGain(),this.output=this.ac.createGain(),this._split=this.ac.createChannelSplitter(2),this._merge=this.ac.createChannelMerger(2),this._leftGain=this.ac.createGain(),this._rightGain=this.ac.createGain(),this.leftDelay=this.ac.createDelay(),this.rightDelay=this.ac.createDelay(),this._leftFilter=new p5.Filter,this._rightFilter=new p5.Filter,this._leftFilter.disconnect(),this._rightFilter.disconnect(),this._leftFilter.biquad.frequency.setValueAtTime(1200,this.ac.currentTime),this._rightFilter.biquad.frequency.setValueAtTime(1200,this.ac.currentTime),this._leftFilter.biquad.Q.setValueAtTime(.3,this.ac.currentTime),this._rightFilter.biquad.Q.setValueAtTime(.3,this.ac.currentTime),this.input.connect(this._split),this.leftDelay.connect(this._leftGain),this.rightDelay.connect(this._rightGain),this._leftGain.connect(this._leftFilter.input),this._rightGain.connect(this._rightFilter.input),this._merge.connect(this.output),this.output.connect(p5.soundOut.input),this._leftFilter.biquad.gain.setValueAtTime(1,this.ac.currentTime),this._rightFilter.biquad.gain.setValueAtTime(1,this.ac.currentTime),this.setType(0),this._maxDelay=this.leftDelay.delayTime.maxValue,r.soundArray.push(this)},p5.Delay.prototype.process=function(r,s,a,c){var l=a||0,f=s||0;if(l>=1)throw new Error("Feedback value will force a positive feedback loop.");if(f>=this._maxDelay)throw new Error("Delay Time exceeds maximum delay time of "+this._maxDelay+" second.");r.connect(this.input),this.leftDelay.delayTime.setValueAtTime(f,this.ac.currentTime),this.rightDelay.delayTime.setValueAtTime(f,this.ac.currentTime),this._leftGain.gain.setValueAtTime(l,this.ac.currentTime),this._rightGain.gain.setValueAtTime(l,this.ac.currentTime),c&&(this._leftFilter.freq(c),this._rightFilter.freq(c))},p5.Delay.prototype.delayTime=function(r){"number"!=typeof r?(r.connect(this.leftDelay.delayTime),r.connect(this.rightDelay.delayTime)):(this.leftDelay.delayTime.cancelScheduledValues(this.ac.currentTime),this.rightDelay.delayTime.cancelScheduledValues(this.ac.currentTime),this.leftDelay.delayTime.linearRampToValueAtTime(r,this.ac.currentTime),this.rightDelay.delayTime.linearRampToValueAtTime(r,this.ac.currentTime))},p5.Delay.prototype.feedback=function(r){if("number"!=typeof r)r.connect(this._leftGain.gain),r.connect(this._rightGain.gain);else{if(r>=1)throw new Error("Feedback value will force a positive feedback loop.");this._leftGain.gain.exponentialRampToValueAtTime(r,this.ac.currentTime),this._rightGain.gain.exponentialRampToValueAtTime(r,this.ac.currentTime)}},p5.Delay.prototype.filter=function(r,s){this._leftFilter.set(r,s),this._rightFilter.set(r,s)},p5.Delay.prototype.setType=function(r){switch(1===r&&(r="pingPong"),this._split.disconnect(),this._leftFilter.disconnect(),this._rightFilter.disconnect(),this._split.connect(this.leftDelay,0),this._split.connect(this.rightDelay,1),r){case"pingPong":this._rightFilter.setType(this._leftFilter.biquad.type),this._leftFilter.output.connect(this._merge,0,0),this._rightFilter.output.connect(this._merge,0,1),this._leftFilter.output.connect(this.rightDelay),this._rightFilter.output.connect(this.leftDelay);break;default:this._leftFilter.output.connect(this._merge,0,0),this._leftFilter.output.connect(this._merge,0,1),this._leftFilter.output.connect(this.leftDelay),this._leftFilter.output.connect(this.rightDelay)}},p5.Delay.prototype.amp=function(s,a,c){a=a||0,c=c||0;var l=r.audiocontext.currentTime,f=this.output.gain.value;this.output.gain.cancelScheduledValues(l),this.output.gain.linearRampToValueAtTime(f,l+c+.001),this.output.gain.linearRampToValueAtTime(s,l+c+a+.001)},p5.Delay.prototype.connect=function(r){var s=r||p5.soundOut.input;this.output.connect(s)},p5.Delay.prototype.disconnect=function(){this.output.disconnect()},p5.Delay.prototype.dispose=function(){var s=r.soundArray.indexOf(this);r.soundArray.splice(s,1),this.input.disconnect(),this.output.disconnect(),this._split.disconnect(),this._leftFilter.disconnect(),this._rightFilter.disconnect(),this._merge.disconnect(),this._leftGain.disconnect(),this._rightGain.disconnect(),this.leftDelay.disconnect(),this.rightDelay.disconnect(),this.input=void 0,this.output=void 0,this._split=void 0,this._leftFilter=void 0,this._rightFilter=void 0,this._merge=void 0,this._leftGain=void 0,this._rightGain=void 0,this.leftDelay=void 0,this.rightDelay=void 0}}(),reverb=function(){"use strict";var r=master,s=errorHandler;p5.Reverb=function(){this.ac=r.audiocontext,this.convolverNode=this.ac.createConvolver(),this.input=this.ac.createGain(),this.output=this.ac.createGain(),this.input.gain.value=.5,this.input.connect(this.convolverNode),this.convolverNode.connect(this.output),this._seconds=3,this._decay=2,this._reverse=!1,this._buildImpulse(),this.connect(),r.soundArray.push(this)},p5.Reverb.prototype.process=function(r,s,a,c){r.connect(this.input);var l=!1;s&&(this._seconds=s,l=!0),a&&(this._decay=a),c&&(this._reverse=c),l&&this._buildImpulse()},p5.Reverb.prototype.set=function(r,s,a){var c=!1;r&&(this._seconds=r,c=!0),s&&(this._decay=s),a&&(this._reverse=a),c&&this._buildImpulse()},p5.Reverb.prototype.amp=function(s,a,c){a=a||0,c=c||0;var l=r.audiocontext.currentTime,f=this.output.gain.value;this.output.gain.cancelScheduledValues(l),this.output.gain.linearRampToValueAtTime(f,l+c+.001),this.output.gain.linearRampToValueAtTime(s,l+c+a+.001)},p5.Reverb.prototype.connect=function(r){var s=r||p5.soundOut.input;this.output.connect(s.input?s.input:s)},p5.Reverb.prototype.disconnect=function(){this.output.disconnect()},p5.Reverb.prototype._buildImpulse=function(){var r,s,a=this.ac.sampleRate,c=a*this._seconds,l=this._decay,f=this.ac.createBuffer(2,c,a),d=f.getChannelData(0),m=f.getChannelData(1);for(s=0;c>s;s++)r=this.reverse?c-s:s,d[s]=(2*Math.random()-1)*Math.pow(1-r/c,l),m[s]=(2*Math.random()-1)*Math.pow(1-r/c,l);this.convolverNode.buffer=f},p5.Reverb.prototype.dispose=function(){var s=r.soundArray.indexOf(this);r.soundArray.splice(s,1),this.convolverNode&&(this.convolverNode.buffer=null,this.convolverNode=null),void 0!==this.output&&(this.output.disconnect(),this.output=null),void 0!==this.panner&&(this.panner.disconnect(),this.panner=null)},p5.Convolver=function(s,a,c){this.ac=r.audiocontext,this.convolverNode=this.ac.createConvolver(),this.input=this.ac.createGain(),this.output=this.ac.createGain(),this.input.gain.value=.5,this.input.connect(this.convolverNode),this.convolverNode.connect(this.output),s?(this.impulses=[],this._loadBuffer(s,a,c)):(this._seconds=3,this._decay=2,this._reverse=!1,this._buildImpulse()),this.connect(),r.soundArray.push(this)},p5.Convolver.prototype=Object.create(p5.Reverb.prototype),p5.prototype.registerPreloadMethod("createConvolver",p5.prototype),p5.prototype.createConvolver=function(r,s,a){window.location.origin.indexOf("file://")>-1&&"undefined"===window.cordova&&alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS");var c=new p5.Convolver(r,s,a);return c.impulses=[],c},p5.Convolver.prototype._loadBuffer=function(r,a,c){r=p5.prototype._checkFileFormats(r);var l=this,f=(new Error).stack,d=p5.prototype.getAudioContext(),m=new XMLHttpRequest;m.open("GET",r,!0),m.responseType="arraybuffer",m.onload=function(){if(200==m.status)d.decodeAudioData(m.response,(function(s){var c={},f=r.split("/");c.name=f[f.length-1],c.audioBuffer=s,l.impulses.push(c),l.convolverNode.buffer=c.audioBuffer,a&&a(c)}),(function(r){var a=new s("decodeAudioData",f,l.url),d="AudioContext error at decodeAudioData for "+l.url;c?(a.msg=d,c(a)):console.error(d+"\n The error stack trace includes: \n"+a.stack)}));else{var y=new s("loadConvolver",f,l.url),v="Unable to load "+l.url+". The request status was: "+m.status+" ("+m.statusText+")";c?(y.message=v,c(y)):console.error(v+"\n The error stack trace includes: \n"+y.stack)}},m.onerror=function(r){var a=new s("loadConvolver",f,l.url),d="There was no response from the server at "+l.url+". Check the url and internet connectivity.";c?(a.message=d,c(a)):console.error(d+"\n The error stack trace includes: \n"+a.stack)},m.send()},p5.Convolver.prototype.set=null,p5.Convolver.prototype.process=function(r){r.connect(this.input)},p5.Convolver.prototype.impulses=[],p5.Convolver.prototype.addImpulse=function(r,s,a){window.location.origin.indexOf("file://")>-1&&"undefined"===window.cordova&&alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS"),this._loadBuffer(r,s,a)},p5.Convolver.prototype.resetImpulse=function(r,s,a){window.location.origin.indexOf("file://")>-1&&"undefined"===window.cordova&&alert("This sketch may require a server to load external files. Please see http://bit.ly/1qcInwS"),this.impulses=[],this._loadBuffer(r,s,a)},p5.Convolver.prototype.toggleImpulse=function(r){if("number"==typeof r&&r<this.impulses.length&&(this.convolverNode.buffer=this.impulses[r].audioBuffer),"string"==typeof r)for(var s=0;s<this.impulses.length;s++)if(this.impulses[s].name===r){this.convolverNode.buffer=this.impulses[s].audioBuffer;break}},p5.Convolver.prototype.dispose=function(){for(var r in this.impulses)this.impulses[r]=null;this.convolverNode.disconnect(),this.concolverNode=null,void 0!==this.output&&(this.output.disconnect(),this.output=null),void 0!==this.panner&&(this.panner.disconnect(),this.panner=null)}}(),Tone_core_TimelineState=function(r){"use strict";return r.TimelineState=function(s){r.Timeline.call(this),this._initial=s},r.extend(r.TimelineState,r.Timeline),r.TimelineState.prototype.getStateAtTime=function(r){var s=this.getEvent(r);return null!==s?s.state:this._initial},r.TimelineState.prototype.setStateAtTime=function(r,s){this.addEvent({state:r,time:this.toSeconds(s)})},r.TimelineState}(Tone_core_Tone),Tone_core_Clock=function(r){"use strict";return r.Clock=function(){var s=this.optionsObject(arguments,["callback","frequency"],r.Clock.defaults);this.callback=s.callback,this._lookAhead="auto",this._computedLookAhead=1/60,this._threshold=.5,this._nextTick=-1,this._lastUpdate=0,this._loopID=-1,this.frequency=new r.TimelineSignal(s.frequency,r.Type.Frequency),this.ticks=0,this._state=new r.TimelineState(r.State.Stopped),this._boundLoop=this._loop.bind(this),this._readOnly("frequency"),this._loop()},r.extend(r.Clock),r.Clock.defaults={callback:r.noOp,frequency:1,lookAhead:"auto"},Object.defineProperty(r.Clock.prototype,"state",{get:function(){return this._state.getStateAtTime(this.now())}}),Object.defineProperty(r.Clock.prototype,"lookAhead",{get:function(){return this._lookAhead},set:function(r){this._lookAhead="auto"===r?"auto":this.toSeconds(r)}}),r.Clock.prototype.start=function(s,a){return s=this.toSeconds(s),this._state.getStateAtTime(s)!==r.State.Started&&this._state.addEvent({state:r.State.Started,time:s,offset:a}),this},r.Clock.prototype.stop=function(s){return s=this.toSeconds(s),this._state.getStateAtTime(s)!==r.State.Stopped&&this._state.setStateAtTime(r.State.Stopped,s),this},r.Clock.prototype.pause=function(s){return s=this.toSeconds(s),this._state.getStateAtTime(s)===r.State.Started&&this._state.setStateAtTime(r.State.Paused,s),this},r.Clock.prototype._loop=function(s){if(this._loopID=requestAnimationFrame(this._boundLoop),"auto"===this._lookAhead){if(!this.isUndef(s)){var a=(s-this._lastUpdate)/1e3;this._lastUpdate=s,a<this._threshold&&(this._computedLookAhead=(9*this._computedLookAhead+a)/10)}}else this._computedLookAhead=this._lookAhead;var c=this.now(),l=2*this._computedLookAhead,f=this._state.getEvent(c+l),d=r.State.Stopped;if(f&&(d=f.state,-1===this._nextTick&&d===r.State.Started&&(this._nextTick=f.time,this.isUndef(f.offset)||(this.ticks=f.offset))),d===r.State.Started)for(;c+l>this._nextTick;){c>this._nextTick+this._threshold&&(this._nextTick=c);var m=this._nextTick;this._nextTick+=1/this.frequency.getValueAtTime(this._nextTick),this.callback(m),this.ticks++}else d===r.State.Stopped&&(this._nextTick=-1,this.ticks=0)},r.Clock.prototype.getStateAtTime=function(r){return this._state.getStateAtTime(r)},r.Clock.prototype.dispose=function(){cancelAnimationFrame(this._loopID),r.TimelineState.prototype.dispose.call(this),this._writable("frequency"),this.frequency.dispose(),this.frequency=null,this._boundLoop=r.noOp,this._nextTick=1/0,this.callback=null,this._state.dispose(),this._state=null},r.Clock}(Tone_core_Tone),metro=function(){"use strict";var r=master,s=Tone_core_Clock;r.audiocontext,p5.Metro=function(){this.clock=new s({callback:this.ontick.bind(this)}),this.syncedParts=[],this.bpm=120,this._init(),this.tickCallback=function(){}};var a=0,c=0;p5.Metro.prototype.ontick=function(s){var l=s-a,f=s-r.audiocontext.currentTime;if(!(-.02>=l-c)){for(var d in a=s,this.syncedParts){var m=this.syncedParts[d];if(!m.isPlaying)return;for(var y in m.incrementStep(f),m.phrases){var v=m.phrases[y],g=v.sequence,T=this.metroTicks%g.length;0!==g[T]&&(this.metroTicks<g.length||!v.looping)&&v.callback(f,g[T])}}this.metroTicks+=1,this.tickCallback(f)}},p5.Metro.prototype.setBPM=function(s,a){var l=60/(s*this.tatums),f=r.audiocontext.currentTime;c=l;a=a||0;this.clock.frequency.setValueAtTime(this.clock.frequency.value,f),this.clock.frequency.linearRampToValueAtTime(s,f+a),this.bpm=s},p5.Metro.prototype.getBPM=function(r){return this.clock.getRate()/this.tatums*60},p5.Metro.prototype._init=function(){this.metroTicks=0},p5.Metro.prototype.resetSync=function(r){this.syncedParts=[r]},p5.Metro.prototype.pushSync=function(r){this.syncedParts.push(r)},p5.Metro.prototype.start=function(s){var a=s||0,c=r.audiocontext.currentTime;this.clock.start(c+a),this.setBPM(this.bpm)},p5.Metro.prototype.stop=function(s){var a=s||0,c=r.audiocontext.currentTime;this.clock._oscillator&&this.clock.stop(c+a)},p5.Metro.prototype.beatLength=function(r){this.tatums=1/r/4}}(),looper=function(){"use strict";function t(r){r.currentPart++,r.currentPart>=r.parts.length?(r.scoreStep=0,r.onended()):(r.scoreStep=0,r.parts[r.currentPart-1].stop(),r.parts[r.currentPart].start())}var r=master,s=120;p5.prototype.setBPM=function(a,c){for(var l in s=a,r.parts)r.parts[l].setBPM(s,c)},p5.Phrase=function(r,s,a){this.phraseStep=0,this.name=r,this.callback=s,this.sequence=a},p5.Part=function(a,c){this.length=a||0,this.partStep=0,this.phrases=[],this.isPlaying=!1,this.noLoop(),this.tatums=c||.0625,this.metro=new p5.Metro,this.metro._init(),this.metro.beatLength(this.tatums),this.metro.setBPM(s),r.parts.push(this),this.callback=function(){}},p5.Part.prototype.setBPM=function(r,s){this.metro.setBPM(r,s)},p5.Part.prototype.getBPM=function(){return this.metro.getBPM()},p5.Part.prototype.start=function(r){if(!this.isPlaying){this.isPlaying=!0,this.metro.resetSync(this);var s=r||0;this.metro.start(s)}},p5.Part.prototype.loop=function(r){this.looping=!0,this.onended=function(){this.partStep=0};var s=r||0;this.start(s)},p5.Part.prototype.noLoop=function(){this.looping=!1,this.onended=function(){this.stop()}},p5.Part.prototype.stop=function(r){this.partStep=0,this.pause(r)},p5.Part.prototype.pause=function(r){this.isPlaying=!1;var s=r||0;this.metro.stop(s)},p5.Part.prototype.addPhrase=function(r,s,a){var c;if(3===arguments.length)c=new p5.Phrase(r,s,a);else{if(!(arguments[0]instanceof p5.Phrase))throw"invalid input. addPhrase accepts name, callback, array or a p5.Phrase";c=arguments[0]}this.phrases.push(c),c.sequence.length>this.length&&(this.length=c.sequence.length)},p5.Part.prototype.removePhrase=function(r){for(var s in this.phrases)this.phrases[s].name===r&&this.phrases.splice(s,1)},p5.Part.prototype.getPhrase=function(r){for(var s in this.phrases)if(this.phrases[s].name===r)return this.phrases[s]},p5.Part.prototype.replaceSequence=function(r,s){for(var a in this.phrases)this.phrases[a].name===r&&(this.phrases[a].sequence=s)},p5.Part.prototype.incrementStep=function(r){this.partStep<this.length-1?(this.callback(r),this.partStep+=1):this.looping||this.partStep!=this.length-1||(console.log("done"),this.onended())},p5.Part.prototype.onStep=function(r){this.callback=r},p5.Score=function(){this.parts=[],this.currentPart=0;var r=this;for(var s in arguments)this.parts[s]=arguments[s],this.parts[s].nextPart=this.parts[s+1],this.parts[s].onended=function(){r.resetPart(s),t(r)};this.looping=!1},p5.Score.prototype.onended=function(){this.looping?this.parts[0].start():this.parts[this.parts.length-1].onended=function(){this.stop(),this.resetParts()},this.currentPart=0},p5.Score.prototype.start=function(){this.parts[this.currentPart].start(),this.scoreStep=0},p5.Score.prototype.stop=function(){this.parts[this.currentPart].stop(),this.currentPart=0,this.scoreStep=0},p5.Score.prototype.pause=function(){this.parts[this.currentPart].stop()},p5.Score.prototype.loop=function(){this.looping=!0,this.start()},p5.Score.prototype.noLoop=function(){this.looping=!1},p5.Score.prototype.resetParts=function(){for(var r in this.parts)this.resetPart(r)},p5.Score.prototype.resetPart=function(r){for(var s in this.parts[r].stop(),this.parts[r].partStep=0,this.parts[r].phrases)this.parts[r].phrases[s].phraseStep=0},p5.Score.prototype.setBPM=function(r,s){for(var a in this.parts)this.parts[a].setBPM(r,s)}}(),soundRecorder=function(){"use strict";function e(r,s,a){for(var c=a.length,l=0;c>l;l++)r.setUint8(s+l,a.charCodeAt(l))}var r=master,s=r.audiocontext;p5.SoundRecorder=function(){this.input=s.createGain(),this.output=s.createGain(),this.recording=!1,this.bufferSize=1024,this._channels=2,this._clear(),this._jsNode=s.createScriptProcessor(this.bufferSize,this._channels,2),this._jsNode.onaudioprocess=this._audioprocess.bind(this),this._callback=function(){},this._jsNode.connect(p5.soundOut._silentNode),this.setInput(),r.soundArray.push(this)},p5.SoundRecorder.prototype.setInput=function(r){this.input.disconnect(),this.input=null,this.input=s.createGain(),this.input.connect(this._jsNode),this.input.connect(this.output),r?r.connect(this.input):p5.soundOut.output.connect(this.input)},p5.SoundRecorder.prototype.record=function(r,a,c){this.recording=!0,a&&(this.sampleLimit=Math.round(a*s.sampleRate)),r&&c?this._callback=function(){this.buffer=this._getBuffer(),r.setBuffer(this.buffer),c()}:r&&(this._callback=function(){this.buffer=this._getBuffer(),r.setBuffer(this.buffer)})},p5.SoundRecorder.prototype.stop=function(){this.recording=!1,this._callback(),this._clear()},p5.SoundRecorder.prototype._clear=function(){this._leftBuffers=[],this._rightBuffers=[],this.recordedSamples=0,this.sampleLimit=null},p5.SoundRecorder.prototype._audioprocess=function(r){if(!1!==this.recording&&!0===this.recording)if(this.sampleLimit&&this.recordedSamples>=this.sampleLimit)this.stop();else{var s=r.inputBuffer.getChannelData(0),a=r.inputBuffer.getChannelData(1);this._leftBuffers.push(new Float32Array(s)),this._rightBuffers.push(new Float32Array(a)),this.recordedSamples+=this.bufferSize}},p5.SoundRecorder.prototype._getBuffer=function(){var r=[];return r.push(this._mergeBuffers(this._leftBuffers)),r.push(this._mergeBuffers(this._rightBuffers)),r},p5.SoundRecorder.prototype._mergeBuffers=function(r){for(var s=new Float32Array(this.recordedSamples),a=0,c=r.length,l=0;c>l;l++){var f=r[l];s.set(f,a),a+=f.length}return s},p5.SoundRecorder.prototype.dispose=function(){this._clear();var s=r.soundArray.indexOf(this);r.soundArray.splice(s,1),this._callback=function(){},this.input&&this.input.disconnect(),this.input=null,this._jsNode=null},p5.prototype.saveSound=function(r,s){var a,c=function t(r,s){for(var a=r.length+s.length,c=new Float32Array(a),l=0,f=0;a>f;)c[f++]=r[l],c[f++]=s[l],l++;return c}(a=r.buffer.getChannelData(0),r.buffer.numberOfChannels>1?r.buffer.getChannelData(1):a),l=new ArrayBuffer(44+2*c.length),f=new DataView(l);e(f,0,"RIFF"),f.setUint32(4,36+2*c.length,!0),e(f,8,"WAVE"),e(f,12,"fmt "),f.setUint32(16,16,!0),f.setUint16(20,1,!0),f.setUint16(22,2,!0),f.setUint32(24,44100,!0),f.setUint32(28,176400,!0),f.setUint16(32,4,!0),f.setUint16(34,16,!0),e(f,36,"data"),f.setUint32(40,2*c.length,!0);for(var d=c.length,m=44,y=0;d>y;y++)f.setInt16(m,32767*c[y],!0),m+=2;p5.prototype.writeFile([f],s,"wav")}}(),peakdetect=function(){"use strict";p5.PeakDetect=function(r,s,a,c){this.framesPerPeak=c||20,this.framesSinceLastPeak=0,this.decayRate=.95,this.threshold=a||.35,this.cutoff=0,this.cutoffMult=1.5,this.energy=0,this.penergy=0,this.currentValue=0,this.isDetected=!1,this.f1=r||40,this.f2=s||2e4,this._onPeak=function(){}},p5.PeakDetect.prototype.update=function(r){var s=this.energy=r.getEnergy(this.f1,this.f2)/255;s>this.cutoff&&s>this.threshold&&s-this.penergy>0?(this._onPeak(),this.isDetected=!0,this.cutoff=s*this.cutoffMult,this.framesSinceLastPeak=0):(this.isDetected=!1,this.framesSinceLastPeak<=this.framesPerPeak?this.framesSinceLastPeak++:(this.cutoff*=this.decayRate,this.cutoff=Math.max(this.cutoff,this.threshold))),this.currentValue=s,this.penergy=s},p5.PeakDetect.prototype.onPeak=function(r,s){var a=this;a._onPeak=function(){r(a.energy,s)}}}(),gain=function(){"use strict";var r=master;p5.Gain=function(){this.ac=r.audiocontext,this.input=this.ac.createGain(),this.output=this.ac.createGain(),this.input.gain.value=.5,this.input.connect(this.output),r.soundArray.push(this)},p5.Gain.prototype.setInput=function(r){r.connect(this.input)},p5.Gain.prototype.connect=function(r){var s=r||p5.soundOut.input;this.output.connect(s.input?s.input:s)},p5.Gain.prototype.disconnect=function(){this.output.disconnect()},p5.Gain.prototype.amp=function(s,a,c){a=a||0,c=c||0;var l=r.audiocontext.currentTime,f=this.output.gain.value;this.output.gain.cancelScheduledValues(l),this.output.gain.linearRampToValueAtTime(f,l+c),this.output.gain.linearRampToValueAtTime(s,l+c+a)},p5.Gain.prototype.dispose=function(){var s=r.soundArray.indexOf(this);r.soundArray.splice(s,1),this.output.disconnect(),this.input.disconnect(),this.output=void 0,this.input=void 0}}(),distortion=function(){"use strict";function t(r){for(var s,a="number"==typeof r?r:50,c=44100,l=new Float32Array(c),f=Math.PI/180,d=0;c>d;++d)s=2*d/c-1,l[d]=(3+a)*s*20*f/(Math.PI+a*Math.abs(s));return l}var r=master;p5.Distortion=function(s,a){if(void 0===s&&(s=.25),"number"!=typeof s)throw new Error("amount must be a number");if(void 0===a&&(a="2x"),"string"!=typeof a)throw new Error("oversample must be a String");var c=p5.prototype.map(s,0,1,0,2e3);this.ac=r.audiocontext,this.input=this.ac.createGain(),this.output=this.ac.createGain(),this.waveShaperNode=this.ac.createWaveShaper(),this.amount=c,this.waveShaperNode.curve=t(c),this.waveShaperNode.oversample=a,this.input.connect(this.waveShaperNode),this.waveShaperNode.connect(this.output),this.connect(),r.soundArray.push(this)},p5.Distortion.prototype.process=function(r,s,a){r.connect(this.input),this.set(s,a)},p5.Distortion.prototype.set=function(r,s){if(r){var a=p5.prototype.map(r,0,1,0,2e3);this.amount=a,this.waveShaperNode.curve=t(a)}s&&(this.waveShaperNode.oversample=s)},p5.Distortion.prototype.getAmount=function(){return this.amount},p5.Distortion.prototype.getOversample=function(){return this.waveShaperNode.oversample},p5.Distortion.prototype.connect=function(r){var s=r||p5.soundOut.input;this.output.connect(s)},p5.Distortion.prototype.disconnect=function(){this.output.disconnect()},p5.Distortion.prototype.dispose=function(){var s=r.soundArray.indexOf(this);r.soundArray.splice(s,1),this.input.disconnect(),this.waveShaperNode.disconnect(),this.input=null,this.waveShaperNode=null,void 0!==this.output&&(this.output.disconnect(),this.output=null)}}(),src_app=function(){"use strict";return sndcore}()}));