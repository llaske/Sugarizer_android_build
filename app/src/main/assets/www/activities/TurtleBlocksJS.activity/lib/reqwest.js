/*!
  * Reqwest! A general purpose XHR connection manager
  * license MIT (c) Dustin Diaz 2014
  * https://github.com/ded/reqwest
  */
!function(e,t,s){"undefined"!=typeof module&&module.exports?module.exports=s():"function"==typeof define&&define.amd?define(s):t.reqwest=s()}(0,this,(function(){var win=window,doc=document,httpsRe=/^http/,protocolRe=/(^\w+):\/\//,twoHundo=/^(20\d|1223)$/,byTag="getElementsByTagName",readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",head=doc[byTag]("head")[0],uniqid=0,callbackPrefix="reqwest_"+ +new Date,lastValue,xmlHttpRequest="XMLHttpRequest",xDomainRequest="XDomainRequest",noop=function(){},isArray="function"==typeof Array.isArray?Array.isArray:function(e){return e instanceof Array},defaultHeaders={contentType:"application/x-www-form-urlencoded",requestedWith:xmlHttpRequest,accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"}},xhr=function(e){if(!0===e.crossOrigin){var t=win[xmlHttpRequest]?new XMLHttpRequest:null;if(t&&"withCredentials"in t)return t;if(win[xDomainRequest])return new XDomainRequest;throw new Error("Browser does not support cross-origin requests")}return win[xmlHttpRequest]?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")},globalSetupOptions={dataFilter:function(e){return e}};function succeed(e){var t=protocolRe.exec(e.url);return t=t&&t[1]||window.location.protocol,httpsRe.test(t)?twoHundo.test(e.request.status):!!e.request.response}function handleReadyState(e,t,s){return function(){return e._aborted?s(e.request):e._timedOut?s(e.request,"Request is aborted: timeout"):void(e.request&&4==e.request[readyState]&&(e.request.onreadystatechange=noop,succeed(e)?t(e.request):s(e.request)))}}function setHeaders(e,t){var s,n=t.headers||{};n.Accept=n.Accept||defaultHeaders.accept[t.type]||defaultHeaders.accept["*"];var a="function"==typeof FormData&&t.data instanceof FormData;for(s in t.crossOrigin||n[requestedWith]||(n[requestedWith]=defaultHeaders.requestedWith),n[contentType]||a||(n[contentType]=t.contentType||defaultHeaders.contentType),n)n.hasOwnProperty(s)&&"setRequestHeader"in e&&e.setRequestHeader(s,n[s])}function setCredentials(e,t){void 0!==t.withCredentials&&void 0!==e.withCredentials&&(e.withCredentials=!!t.withCredentials)}function generalCallback(e){lastValue=e}function urlappend(e,t){return e+(/\?/.test(e)?"&":"?")+t}function handleJsonp(e,t,s,n){var a=uniqid++,i=e.jsonpCallback||"callback",l=e.jsonpCallbackName||reqwest.getcallbackPrefix(a),u=new RegExp("((^|\\?|&)"+i+")=([^&]+)"),p=n.match(u),c=doc.createElement("script"),d=0,f=-1!==navigator.userAgent.indexOf("MSIE 10.0");return p?"?"===p[3]?n=n.replace(u,"$1="+l):l=p[3]:n=urlappend(n,i+"="+l),win[l]=generalCallback,c.type="text/javascript",c.src=n,c.async=!0,void 0===c.onreadystatechange||f||(c.htmlFor=c.id="_reqwest_"+a),c.onload=c.onreadystatechange=function(){if(c[readyState]&&"complete"!==c[readyState]&&"loaded"!==c[readyState]||d)return!1;c.onload=c.onreadystatechange=null,c.onclick&&c.onclick(),t(lastValue),lastValue=void 0,head.removeChild(c),d=1},head.appendChild(c),{abort:function(){c.onload=c.onreadystatechange=null,s({},"Request is aborted: timeout",{}),lastValue=void 0,head.removeChild(c),d=1}}}function getRequest(e,t){var s,n=this.o,a=(n.method||"GET").toUpperCase(),i="string"==typeof n?n:n.url,l=!1!==n.processData&&n.data&&"string"!=typeof n.data?reqwest.toQueryString(n.data):n.data||null,u=!1;return"jsonp"!=n.type&&"GET"!=a||!l||(i=urlappend(i,l),l=null),"jsonp"==n.type?handleJsonp(n,e,t,i):((s=n.xhr&&n.xhr(n)||xhr(n)).open(a,i,!1!==n.async),setHeaders(s,n),setCredentials(s,n),win[xDomainRequest]&&s instanceof win[xDomainRequest]?(s.onload=e,s.onerror=t,s.onprogress=function(){},u=!0):s.onreadystatechange=handleReadyState(this,e,t),n.before&&n.before(s),u?setTimeout((function(){s.send(l)}),200):s.send(l),s)}function Reqwest(e,t){this.o=e,this.fn=t,init.apply(this,arguments)}function setType(e){return e.match("json")?"json":e.match("javascript")?"js":e.match("text")?"html":e.match("xml")?"xml":void 0}function init(o,fn){this.url="string"==typeof o?o:o.url,this.timeout=null,this._fulfilled=!1,this._successHandler=function(){},this._fulfillmentHandlers=[],this._errorHandlers=[],this._completeHandlers=[],this._erred=!1,this._responseArgs={};var self=this;function complete(e){for(o.timeout&&clearTimeout(self.timeout),self.timeout=null;self._completeHandlers.length>0;)self._completeHandlers.shift()(e)}function success(resp){var type=o.type||resp&&setType(resp.getResponseHeader("Content-Type"));resp="jsonp"!==type?self.request:resp;var filteredResponse=globalSetupOptions.dataFilter(resp.responseText,type),r=filteredResponse;try{resp.responseText=r}catch(e){}if(r)switch(type){case"json":try{resp=win.JSON?win.JSON.parse(r):eval("("+r+")")}catch(e){return error(resp,"Could not parse JSON in response",e)}break;case"js":resp=eval(r);break;case"html":resp=r;break;case"xml":resp=resp.responseXML&&resp.responseXML.parseError&&resp.responseXML.parseError.errorCode&&resp.responseXML.parseError.reason?null:resp.responseXML}for(self._responseArgs.resp=resp,self._fulfilled=!0,fn(resp),self._successHandler(resp);self._fulfillmentHandlers.length>0;)resp=self._fulfillmentHandlers.shift()(resp);complete(resp)}function timedOut(){self._timedOut=!0,self.request.abort()}function error(e,t,s){for(e=self.request,self._responseArgs.resp=e,self._responseArgs.msg=t,self._responseArgs.t=s,self._erred=!0;self._errorHandlers.length>0;)self._errorHandlers.shift()(e,t,s);complete(e)}fn=fn||function(){},o.timeout&&(this.timeout=setTimeout((function(){timedOut()}),o.timeout)),o.success&&(this._successHandler=function(){o.success.apply(o,arguments)}),o.error&&this._errorHandlers.push((function(){o.error.apply(o,arguments)})),o.complete&&this._completeHandlers.push((function(){o.complete.apply(o,arguments)})),this.request=getRequest.call(this,success,error)}function reqwest(e,t){return new Reqwest(e,t)}function normalize(e){return e?e.replace(/\r?\n/g,"\r\n"):""}function serial(e,t){var s,n,a,i,l=e.name,u=e.tagName.toLowerCase(),optCb=function(e){e&&!e.disabled&&t(l,normalize(e.attributes.value&&e.attributes.value.specified?e.value:e.text))};if(!e.disabled&&l)switch(u){case"input":/reset|button|image|file/i.test(e.type)||(s=/checkbox/i.test(e.type),n=/radio/i.test(e.type),a=e.value,(!s&&!n||e.checked)&&t(l,normalize(s&&""===a?"on":a)));break;case"textarea":t(l,normalize(e.value));break;case"select":if("select-one"===e.type.toLowerCase())optCb(e.selectedIndex>=0?e.options[e.selectedIndex]:null);else for(i=0;e.length&&i<e.length;i++)e.options[i].selected&&optCb(e.options[i])}}function eachFormElement(){var e,t,s=this,serializeSubtags=function(e,t){var n,a,i;for(n=0;n<t.length;n++)for(i=e[byTag](t[n]),a=0;a<i.length;a++)serial(i[a],s)};for(t=0;t<arguments.length;t++)/input|select|textarea/i.test((e=arguments[t]).tagName)&&serial(e,s),serializeSubtags(e,["input","select","textarea"])}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function serializeHash(){var e={};return eachFormElement.apply((function(t,s){t in e?(e[t]&&!isArray(e[t])&&(e[t]=[e[t]]),e[t].push(s)):e[t]=s}),arguments),e}function buildParams(e,t,s,n){var a,i,l,u=/\[\]$/;if(isArray(t))for(i=0;t&&i<t.length;i++)l=t[i],s||u.test(e)?n(e,l):buildParams(e+"["+("object"==typeof l?i:"")+"]",l,s,n);else if(t&&"[object Object]"===t.toString())for(a in t)buildParams(e+"["+a+"]",t[a],s,n);else n(e,t)}return Reqwest.prototype={abort:function(){this._aborted=!0,this.request.abort()},retry:function(){init.call(this,this.o,this.fn)},then:function(e,t){return e=e||function(){},t=t||function(){},this._fulfilled?this._responseArgs.resp=e(this._responseArgs.resp):this._erred?t(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):(this._fulfillmentHandlers.push(e),this._errorHandlers.push(t)),this},always:function(e){return this._fulfilled||this._erred?e(this._responseArgs.resp):this._completeHandlers.push(e),this},fail:function(e){return this._erred?e(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):this._errorHandlers.push(e),this},catch:function(e){return this.fail(e)}},reqwest.serializeArray=function(){var e=[];return eachFormElement.apply((function(t,s){e.push({name:t,value:s})}),arguments),e},reqwest.serialize=function(){if(0===arguments.length)return"";var e,t=Array.prototype.slice.call(arguments,0);return(e=t.pop())&&e.nodeType&&t.push(e)&&(e=null),e&&(e=e.type),("map"==e?serializeHash:"array"==e?reqwest.serializeArray:serializeQueryString).apply(null,t)},reqwest.toQueryString=function(e,t){var s,n,a=t||!1,i=[],l=encodeURIComponent,add=function(e,t){t="function"==typeof t?t():null==t?"":t,i[i.length]=l(e)+"="+l(t)};if(isArray(e))for(n=0;e&&n<e.length;n++)add(e[n].name,e[n].value);else for(s in e)e.hasOwnProperty(s)&&buildParams(s,e[s],a,add);return i.join("&").replace(/%20/g,"+")},reqwest.getcallbackPrefix=function(){return callbackPrefix},reqwest.compat=function(e,t){return e&&(e.type&&(e.method=e.type)&&delete e.type,e.dataType&&(e.type=e.dataType),e.jsonpCallback&&(e.jsonpCallbackName=e.jsonpCallback)&&delete e.jsonpCallback,e.jsonp&&(e.jsonpCallback=e.jsonp)),new Reqwest(e,t)},reqwest.ajaxSetup=function(e){for(var t in e=e||{})globalSetupOptions[t]=e[t]},reqwest}));