enyo.kind({name:"TamTam.Simon",components:[{classes:"Simon-info",components:[{name:"SimonLevel",id:"SimonLevel",classes:"Simon-level",content:""},{name:"SimonScroe",id:"SimonScroe",classes:"Simon-scroe",content:""}]},{classes:"Simon",id:"Simon-board",components:[{classes:"Simon-game",components:[{name:"Red",id:"Red",classes:"Simon-button red",ontap:"handlePlayNote"},{name:"Green",id:"Green",classes:"Simon-button green",ontap:"handlePlayNote"},{name:"Yellow",id:"Yellow",classes:"Simon-button yellow",ontap:"handlePlayNote"},{name:"Blue",id:"Blue",classes:"Simon-button blue",ontap:"handlePlayNote"},{classes:"Simon-centre Simon-centre-black",components:[{classes:"Simon-centre Simon-centre-white",components:[{name:"SimonStart",id:"SimonStart",classes:"Simon-start",content:"",ontap:"startGame"}]}]}]}]}],handlePlayNote:function(e){if(!e.repeat&&simonMode){var t=!1;"keydown"==e.type&&(t=!0);var n={ArrowUp:"Red",ArrowDown:"Blue",ArrowRight:"Green",ArrowLeft:"Yellow"};t?(this.clickColor(n[e.key]),this.userSequence.push(n[e.key])):(this.clickColor(e.name),this.userSequence.push(e.name)),this.$.SimonStart.setContent(this.userSequence.length);var s=this.userSequence[this.userSequence.length-1]===this.correctSequence[this.userSequence.length-1];s||(this.correctSequence=[],this.userSequence=[],this.level=1,this.keysEnabled=!1,this.$.SimonStart.show(),this.$.SimonStart.setContent(this.WRONG_MSG),this.$.SimonStart.addRemoveClass("wrongRed",!0),this.addRemoveAll(["Red","Green","Yellow","Blue"],"disableElement",!0),this.showPlayAgain()),s&&this.correctSequence.length===this.userSequence.length&&(this.score+=this.level*(this.level+1)/2,this.userSequence=[],this.level++,this.keysEnabled=!1,this.$.SimonScroe.setContent(this.SCORE_MSG+" : "+this.score),this.$.SimonStart.setContent(this.RIGHT_MSG),this.$.SimonStart.addRemoveClass("rightGreen",!0),this.addRemoveAll(["Red","Green","Yellow","Blue"],"disableElement",!0),this.timeouts.push(setTimeout(function(){this.startGame()}.bind(this),2e3)))}},showPlayAgain:function(){this.timeouts.push(setTimeout(function(){this.$.SimonStart.addRemoveClass("disableElement",!1),this.$.SimonStart.addRemoveClass("wrongRed",!1),this.$.SimonStart.setContent(this.PLAY_AGAIN)}.bind(this),2e3))},clickColor(e,t){["Red","Green","Blue","Yellow"].forEach(e=>{this.$[e].addRemoveClass("darkenElement",!1)}),this.$[e].addRemoveClass("darkenElement",!0),this.timeouts.push(setTimeout(function(){this.$[e].addRemoveClass("darkenElement",!1)}.bind(this),t?t-100:1e3));var n={Red:"A",Green:"E",Blue:"E",Yellow:"C-s"}[e];tonePlayer.play({"C-s":1,E:4,A:9}[n])},handlePlayNoteListener:function(e){this.keysEnabled&&-1!==["ArrowUp","ArrowDown","ArrowRight","ArrowLeft"].indexOf(e.key)&&this.handlePlayNote(e)},create:function(){this.inherited(arguments),this.collection=0,this.level=1,this.correctSequence=[],this.userSequence=[],this.score=0,this.keysEnabled=!1,this.timeouts=[];var e=this;requirejs(["webL10n"],(function(t){e.START_MSG=t.get("SimonStartMsg"),e.SCORE_MSG=t.get("SimonScoreMsg"),e.LEVEL_MSG=t.get("SimonLevelMsg"),e.WRONG_MSG=t.get("SimonWrongMsg"),e.RIGHT_MSG=t.get("SimonRightMsg"),e.PLAY_AGAIN=t.get("SimonPlayAgain"),e.$.SimonStart.setContent(e.START_MSG),e.$.SimonLevel.setContent(e.LEVEL_MSG+" : "+e.level),e.$.SimonScroe.setContent(e.SCORE_MSG+" : "+e.score)})),e.handlePlayNoteListener=e.handlePlayNoteListener.bind(this),document.addEventListener("keydown",e.handlePlayNoteListener,!1),tonePlayer.load("audio/database/"+currentSimonMode+".mp3"),this.addRemoveAll(["Red","Green","Yellow","Blue"],"disableElement",!0)},startGame:function(){1===this.level&&(this.score=0,this.$.SimonScroe.setContent(this.SCORE_MSG+" : "+this.score)),this.$.SimonStart.setContent(" "),this.keysEnabled=!1;var e=["Red","Green","Yellow","Blue"];this.addRemoveAll(["SimonStart"].concat(e),"disableElement",!0);var t=e[Math.floor(4*Math.random())];this.correctSequence.push(t);var n=1e3;for(let e=0;e<this.level;e++)this.timeouts.push(setTimeout(function(){this.$.SimonStart.addRemoveClass("rightGreen",!1),this.clickColor(this.correctSequence[e],1500-50*this.level),this.$.SimonLevel.setContent(this.LEVEL_MSG+" : "+this.level),this.$.SimonStart.setContent(e+1)}.bind(this),n)),n+=1500-50*this.level;this.timeouts.push(setTimeout(function(){this.addRemoveAll(e,"disableElement",!1),this.keysEnabled=!0,this.$.SimonStart.setContent("")}.bind(this),n))},destroy:function(){var e=this;e.timeouts.forEach(e=>clearTimeout(e)),e.inherited(arguments),document.removeEventListener("keydown",e.handlePlayNoteListener,!1)},addRemoveAll:function(e,t,n){e.forEach(function(e){this.$[e].addRemoveClass(t,n)}.bind(this))}});