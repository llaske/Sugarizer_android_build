THREE.TrackballControls=function(e,t){void 0===t&&console.warn('THREE.TrackballControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.TrackballControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.');var o=this,n={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=e,this.domElement=t,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.mouseButtons={LEFT:THREE.MOUSE.ROTATE,MIDDLE:THREE.MOUSE.ZOOM,RIGHT:THREE.MOUSE.PAN},this.target=new THREE.Vector3;var a=1e-6,c=new THREE.Vector3,s=1,i=n.NONE,r=n.NONE,p=new THREE.Vector3,m=new THREE.Vector2,u=new THREE.Vector2,d=new THREE.Vector3,h=0,E=new THREE.Vector2,l=new THREE.Vector2,g=0,y=0,v=new THREE.Vector2,b=new THREE.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.zoom0=this.object.zoom;var T={type:"change"},w={type:"start"},O={type:"end"};this.handleResize=function(){var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height};var R,f,j,H,k,N,C,L,M,P,V,A=(R=new THREE.Vector2,function getMouseOnScreen(e,t){return R.set((e-o.screen.left)/o.screen.width,(t-o.screen.top)/o.screen.height),R}),D=function(){var e=new THREE.Vector2;return function getMouseOnCircle(t,n){return e.set((t-.5*o.screen.width-o.screen.left)/(.5*o.screen.width),(o.screen.height+2*(o.screen.top-n))/o.screen.width),e}}();function keydown(e){!1!==o.enabled&&(window.removeEventListener("keydown",keydown),r===n.NONE&&(e.keyCode!==o.keys[n.ROTATE]||o.noRotate?e.keyCode!==o.keys[n.ZOOM]||o.noZoom?e.keyCode!==o.keys[n.PAN]||o.noPan||(r=n.PAN):r=n.ZOOM:r=n.ROTATE))}function keyup(){!1!==o.enabled&&(r=n.NONE,window.addEventListener("keydown",keydown,!1))}function mousedown(e){if(!1!==o.enabled){if(e.preventDefault(),e.stopPropagation(),i===n.NONE)switch(e.button){case o.mouseButtons.LEFT:i=n.ROTATE;break;case o.mouseButtons.MIDDLE:i=n.ZOOM;break;case o.mouseButtons.RIGHT:i=n.PAN;break;default:i=n.NONE}var t=r!==n.NONE?r:i;t!==n.ROTATE||o.noRotate?t!==n.ZOOM||o.noZoom?t!==n.PAN||o.noPan||(v.copy(A(e.pageX,e.pageY)),b.copy(v)):(E.copy(A(e.pageX,e.pageY)),l.copy(E)):(u.copy(D(e.pageX,e.pageY)),m.copy(u)),document.addEventListener("mousemove",mousemove,!1),document.addEventListener("mouseup",mouseup,!1),o.dispatchEvent(w)}}function mousemove(e){if(!1!==o.enabled){e.preventDefault(),e.stopPropagation();var t=r!==n.NONE?r:i;t!==n.ROTATE||o.noRotate?t!==n.ZOOM||o.noZoom?t!==n.PAN||o.noPan||b.copy(A(e.pageX,e.pageY)):l.copy(A(e.pageX,e.pageY)):(m.copy(u),u.copy(D(e.pageX,e.pageY)))}}function mouseup(e){!1!==o.enabled&&(e.preventDefault(),e.stopPropagation(),i=n.NONE,document.removeEventListener("mousemove",mousemove),document.removeEventListener("mouseup",mouseup),o.dispatchEvent(O))}function mousewheel(e){if(!1!==o.enabled&&!0!==o.noZoom){switch(e.preventDefault(),e.stopPropagation(),e.deltaMode){case 2:E.y-=.025*e.deltaY;break;case 1:E.y-=.01*e.deltaY;break;default:E.y-=25e-5*e.deltaY}o.dispatchEvent(w),o.dispatchEvent(O)}}function touchstart(e){if(!1!==o.enabled){if(e.preventDefault(),1===e.touches.length)i=n.TOUCH_ROTATE,u.copy(D(e.touches[0].pageX,e.touches[0].pageY)),m.copy(u);else{i=n.TOUCH_ZOOM_PAN;var t=e.touches[0].pageX-e.touches[1].pageX,a=e.touches[0].pageY-e.touches[1].pageY;y=g=Math.sqrt(t*t+a*a);var c=(e.touches[0].pageX+e.touches[1].pageX)/2,s=(e.touches[0].pageY+e.touches[1].pageY)/2;v.copy(A(c,s)),b.copy(v)}o.dispatchEvent(w)}}function touchmove(e){if(!1!==o.enabled)if(e.preventDefault(),e.stopPropagation(),1===e.touches.length)m.copy(u),u.copy(D(e.touches[0].pageX,e.touches[0].pageY));else{var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;y=Math.sqrt(t*t+n*n);var a=(e.touches[0].pageX+e.touches[1].pageX)/2,c=(e.touches[0].pageY+e.touches[1].pageY)/2;b.copy(A(a,c))}}function touchend(e){if(!1!==o.enabled){switch(e.touches.length){case 0:i=n.NONE;break;case 1:i=n.TOUCH_ROTATE,u.copy(D(e.touches[0].pageX,e.touches[0].pageY)),m.copy(u)}o.dispatchEvent(O)}}function contextmenu(e){!1!==o.enabled&&e.preventDefault()}this.rotateCamera=(j=new THREE.Vector3,H=new THREE.Quaternion,k=new THREE.Vector3,N=new THREE.Vector3,C=new THREE.Vector3,L=new THREE.Vector3,function rotateCamera(){L.set(u.x-m.x,u.y-m.y,0),(f=L.length())?(p.copy(o.object.position).sub(o.target),k.copy(p).normalize(),N.copy(o.object.up).normalize(),C.crossVectors(N,k).normalize(),N.setLength(u.y-m.y),C.setLength(u.x-m.x),L.copy(N.add(C)),j.crossVectors(L,p).normalize(),f*=o.rotateSpeed,H.setFromAxisAngle(j,f),p.applyQuaternion(H),o.object.up.applyQuaternion(H),d.copy(j),h=f):!o.staticMoving&&h&&(h*=Math.sqrt(1-o.dynamicDampingFactor),p.copy(o.object.position).sub(o.target),H.setFromAxisAngle(d,h),p.applyQuaternion(H),o.object.up.applyQuaternion(H)),m.copy(u)}),this.zoomCamera=function(){var e;i===n.TOUCH_ZOOM_PAN?(e=g/y,g=y,o.object.isPerspectiveCamera?p.multiplyScalar(e):o.object.isOrthographicCamera?(o.object.zoom*=e,o.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(1!==(e=1+(l.y-E.y)*o.zoomSpeed)&&e>0&&(o.object.isPerspectiveCamera?p.multiplyScalar(e):o.object.isOrthographicCamera?(o.object.zoom/=e,o.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),o.staticMoving?E.copy(l):E.y+=(l.y-E.y)*this.dynamicDampingFactor)},this.panCamera=(M=new THREE.Vector2,P=new THREE.Vector3,V=new THREE.Vector3,function panCamera(){if(M.copy(b).sub(v),M.lengthSq()){if(o.object.isOrthographicCamera){var e=(o.object.right-o.object.left)/o.object.zoom/o.domElement.clientWidth,t=(o.object.top-o.object.bottom)/o.object.zoom/o.domElement.clientWidth;M.x*=e,M.y*=t}M.multiplyScalar(p.length()*o.panSpeed),V.copy(p).cross(o.object.up).setLength(M.x),V.add(P.copy(o.object.up).setLength(M.y)),o.object.position.add(V),o.target.add(V),o.staticMoving?v.copy(b):v.add(M.subVectors(b,v).multiplyScalar(o.dynamicDampingFactor))}}),this.checkDistances=function(){o.noZoom&&o.noPan||(p.lengthSq()>o.maxDistance*o.maxDistance&&(o.object.position.addVectors(o.target,p.setLength(o.maxDistance)),E.copy(l)),p.lengthSq()<o.minDistance*o.minDistance&&(o.object.position.addVectors(o.target,p.setLength(o.minDistance)),E.copy(l)))},this.update=function(){p.subVectors(o.object.position,o.target),o.noRotate||o.rotateCamera(),o.noZoom||o.zoomCamera(),o.noPan||o.panCamera(),o.object.position.addVectors(o.target,p),o.object.isPerspectiveCamera?(o.checkDistances(),o.object.lookAt(o.target),c.distanceToSquared(o.object.position)>a&&(o.dispatchEvent(T),c.copy(o.object.position))):o.object.isOrthographicCamera?(o.object.lookAt(o.target),(c.distanceToSquared(o.object.position)>a||s!==o.object.zoom)&&(o.dispatchEvent(T),c.copy(o.object.position),s=o.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type")},this.reset=function(){i=n.NONE,r=n.NONE,o.target.copy(o.target0),o.object.position.copy(o.position0),o.object.up.copy(o.up0),o.object.zoom=o.zoom0,o.object.updateProjectionMatrix(),p.subVectors(o.object.position,o.target),o.object.lookAt(o.target),o.dispatchEvent(T),c.copy(o.object.position),s=o.object.zoom},this.dispose=function(){this.domElement.removeEventListener("contextmenu",contextmenu,!1),this.domElement.removeEventListener("mousedown",mousedown,!1),this.domElement.removeEventListener("wheel",mousewheel,!1),this.domElement.removeEventListener("touchstart",touchstart,!1),this.domElement.removeEventListener("touchend",touchend,!1),this.domElement.removeEventListener("touchmove",touchmove,!1),document.removeEventListener("mousemove",mousemove,!1),document.removeEventListener("mouseup",mouseup,!1),window.removeEventListener("keydown",keydown,!1),window.removeEventListener("keyup",keyup,!1)},this.domElement.addEventListener("contextmenu",contextmenu,!1),this.domElement.addEventListener("mousedown",mousedown,!1),this.domElement.addEventListener("wheel",mousewheel,!1),this.domElement.addEventListener("touchstart",touchstart,!1),this.domElement.addEventListener("touchend",touchend,!1),this.domElement.addEventListener("touchmove",touchmove,!1),window.addEventListener("keydown",keydown,!1),window.addEventListener("keyup",keyup,!1),this.handleResize(),this.update()},THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.TrackballControls.prototype.constructor=THREE.TrackballControls;