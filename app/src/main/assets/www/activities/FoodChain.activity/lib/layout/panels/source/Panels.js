enyo.kind({name:"enyo.Panels",classes:"enyo-panels",published:{index:0,draggable:!0,animate:!0,wrap:!1,arrangerKind:"CardArranger",narrowFit:!0},events:{onTransitionStart:"",onTransitionFinish:""},handlers:{ondragstart:"dragstart",ondrag:"drag",ondragfinish:"dragfinish"},tools:[{kind:"Animator",onStep:"step",onEnd:"completed"}],fraction:0,create:function(){this.transitionPoints=[],this.inherited(arguments),this.arrangerKindChanged(),this.avoidFitChanged(),this.indexChanged()},initComponents:function(){this.createChrome(this.tools),this.inherited(arguments)},arrangerKindChanged:function(){this.setLayoutKind(this.arrangerKind)},avoidFitChanged:function(){this.addRemoveClass("enyo-panels-fit-narrow",this.narrowFit)},removeControl:function(t){this.inherited(arguments),this.controls.length>1&&this.isPanel(t)&&(this.setIndex(Math.max(this.index-1,0)),this.flow(),this.reflow())},isPanel:function(){return!0},flow:function(){this.arrangements=[],this.inherited(arguments)},reflow:function(){this.arrangements=[],this.inherited(arguments),this.refresh()},getPanels:function(){return(this.controlParent||this).children},getActive:function(){return this.getPanels()[this.index]},getAnimator:function(){return this.$.animator},setIndex:function(t){this.setPropertyValue("index",t,"indexChanged")},setIndexDirect:function(t){this.setIndex(t),this.completed()},previous:function(){this.setIndex(this.index-1)},next:function(){this.setIndex(this.index+1)},clamp:function(t){var i=this.getPanels().length-1;return this.wrap?t:Math.max(0,Math.min(t,i))},indexChanged:function(t){this.lastIndex=t,this.index=this.clamp(this.index),this.dragging||(this.$.animator.isAnimating()&&this.completed(),this.$.animator.stop(),this.hasNode()&&(this.animate?(this.startTransition(),this.$.animator.play({startValue:this.fraction})):this.refresh()))},step:function(t){this.fraction=t.value,this.stepTransition()},completed:function(){this.$.animator.isAnimating()&&this.$.animator.stop(),this.fraction=1,this.stepTransition(),this.finishTransition()},dragstart:function(t,i){if(this.draggable&&this.layout&&this.layout.canDragEvent(i))return i.preventDefault(),this.dragstartTransition(i),this.dragging=!0,this.$.animator.stop(),!0},drag:function(t,i){this.dragging&&(i.preventDefault(),this.dragTransition(i))},dragfinish:function(t,i){this.dragging&&(this.dragging=!1,i.preventTap(),this.dragfinishTransition(i))},dragstartTransition:function(t){if(this.$.animator.isAnimating())this.verifyDragTransition(t);else{var i=this.fromIndex=this.index;this.toIndex=i-(this.layout?this.layout.calcDragDirection(t):0)}this.fromIndex=this.clamp(this.fromIndex),this.toIndex=this.clamp(this.toIndex),this.fireTransitionStart(),this.layout&&this.layout.start()},dragTransition:function(t){var i=this.layout?this.layout.calcDrag(t):0,n=this.transitionPoints,s=n[0],r=n[n.length-1],a=this.fetchArrangement(s),e=this.fetchArrangement(r),o=this.layout?this.layout.drag(i,s,a,r,e):0,h=i&&!o;this.fraction+=o;var d=this.fraction;(d>1||d<0||h)&&((d>0||h)&&this.dragfinishTransition(t),this.dragstartTransition(t),this.fraction=0),this.stepTransition()},dragfinishTransition:function(t){this.verifyDragTransition(t),this.setIndex(this.toIndex),this.dragging&&this.fireTransitionFinish()},verifyDragTransition:function(t){var i=this.layout?this.layout.calcDragDirection(t):0,n=Math.min(this.fromIndex,this.toIndex),s=Math.max(this.fromIndex,this.toIndex);if(i>0){var r=n;n=s,s=r}n!=this.fromIndex&&(this.fraction=1-this.fraction),this.fromIndex=n,this.toIndex=s},refresh:function(){this.$.animator.isAnimating()&&this.$.animator.stop(),this.startTransition(),this.fraction=1,this.stepTransition(),this.finishTransition()},startTransition:function(){this.fromIndex=null!=this.fromIndex?this.fromIndex:this.lastIndex||0,this.toIndex=null!=this.toIndex?this.toIndex:this.index,this.layout&&this.layout.start(),this.fireTransitionStart()},finishTransition:function(){this.layout&&this.layout.finish(),this.transitionPoints=[],this.fraction=0,this.fromIndex=this.toIndex=null,this.fireTransitionFinish()},fireTransitionStart:function(){var t=this.startTransitionInfo;!this.hasNode()||t&&t.fromIndex==this.fromIndex&&t.toIndex==this.toIndex||(this.startTransitionInfo={fromIndex:this.fromIndex,toIndex:this.toIndex},this.doTransitionStart(enyo.clone(this.startTransitionInfo)))},fireTransitionFinish:function(){var t=this.finishTransitionInfo;!this.hasNode()||t&&t.fromIndex==this.lastIndex&&t.toIndex==this.index||(this.finishTransitionInfo={fromIndex:this.lastIndex,toIndex:this.index},this.doTransitionFinish(enyo.clone(this.finishTransitionInfo))),this.lastIndex=this.index},stepTransition:function(){if(this.hasNode()){var t=this.transitionPoints,i=(this.fraction||0)*(t.length-1),n=Math.floor(i);i-=n;var s=t[n],r=t[n+1],a=this.fetchArrangement(s),e=this.fetchArrangement(r);this.arrangement=a&&e?enyo.Panels.lerp(a,e,i):a||e,this.arrangement&&this.layout&&this.layout.flowArrangement()}},fetchArrangement:function(t){return null!=t&&!this.arrangements[t]&&this.layout&&(this.layout._arrange(t),this.arrangements[t]=this.readArrangement(this.getPanels())),this.arrangements[t]},readArrangement:function(t){for(var i,n=[],s=0,r=t;i=r[s];s++)n.push(enyo.clone(i._arranger));return n},statics:{isScreenNarrow:function(){return enyo.dom.getWindowWidth()<=800},lerp:function(t,i,n){for(var s,r=[],a=0,e=enyo.keys(t);s=e[a];a++)r.push(this.lerpObject(t[s],i[s],n));return r},lerpObject:function(t,i,n){var s,r,a=enyo.clone(t);if(i)for(var e in t)(s=t[e])!=(r=i[e])&&(a[e]=s-(s-r)*n);return a}}});