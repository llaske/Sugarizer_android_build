enyo.kind({name:"enyo.List",kind:"Scroller",classes:"enyo-list",published:{count:0,rowsPerPage:50,bottomUp:!1,multiSelect:!1,toggleSelected:!1,fixedHeight:!1},events:{onSetupItem:""},handlers:{onAnimateFinish:"animateFinish"},rowHeight:0,listTools:[{name:"port",classes:"enyo-list-port enyo-border-box",components:[{name:"generator",kind:"FlyweightRepeater",canGenerate:!1,components:[{tag:null,name:"client"}]},{name:"page0",allowHtml:!0,classes:"enyo-list-page"},{name:"page1",allowHtml:!0,classes:"enyo-list-page"}]}],create:function(){this.pageHeights=[],this.inherited(arguments),this.getStrategy().translateOptimized=!0,this.bottomUpChanged(),this.multiSelectChanged(),this.toggleSelectedChanged()},createStrategy:function(){this.controlParentName="strategy",this.inherited(arguments),this.createChrome(this.listTools),this.controlParentName="client",this.discoverControlParent()},rendered:function(){this.inherited(arguments),this.$.generator.node=this.$.port.hasNode(),this.$.generator.generated=!0,this.reset()},resizeHandler:function(){this.inherited(arguments),this.refresh()},bottomUpChanged:function(){this.$.generator.bottomUp=this.bottomUp,this.$.page0.applyStyle(this.pageBound,null),this.$.page1.applyStyle(this.pageBound,null),this.pageBound=this.bottomUp?"bottom":"top",this.hasNode()&&this.reset()},multiSelectChanged:function(){this.$.generator.setMultiSelect(this.multiSelect)},toggleSelectedChanged:function(){this.$.generator.setToggleSelected(this.toggleSelected)},countChanged:function(){this.hasNode()&&this.updateMetrics()},updateMetrics:function(){this.defaultPageHeight=this.rowsPerPage*(this.rowHeight||100),this.pageCount=Math.ceil(this.count/this.rowsPerPage),this.portSize=0;for(var t=0;t<this.pageCount;t++)this.portSize+=this.getPageHeight(t);this.adjustPortSize()},generatePage:function(t,e){this.page=t;var i=this.$.generator.rowOffset=this.rowsPerPage*this.page,o=this.$.generator.count=Math.min(this.count-i,this.rowsPerPage),s=this.$.generator.generateChildHtml();e.setContent(s);var n=e.getBounds().height;if(!this.rowHeight&&n>0&&(this.rowHeight=Math.floor(n/o),this.updateMetrics()),!this.fixedHeight){var h=this.getPageHeight(t);h!=n&&n>0&&(this.pageHeights[t]=n,this.portSize+=n-h)}},update:function(t){var e=!1,i=this.positionToPageInfo(t),o=i.pos+this.scrollerHeight/2,s=Math.floor(o/Math.max(i.height,this.scrollerHeight)+.5)+i.no,n=s%2==0?s:s-1;this.p0!=n&&this.isPageInRange(n)&&(this.generatePage(n,this.$.page0),this.positionPage(n,this.$.page0),this.p0=n,e=!0),n=s%2==0?Math.max(1,s-1):s,this.p1!=n&&this.isPageInRange(n)&&(this.generatePage(n,this.$.page1),this.positionPage(n,this.$.page1),this.p1=n,e=!0),e&&!this.fixedHeight&&(this.adjustBottomPage(),this.adjustPortSize())},updateForPosition:function(t){this.update(this.calcPos(t))},calcPos:function(t){return this.bottomUp?this.portSize-this.scrollerHeight-t:t},adjustBottomPage:function(){var t=this.p0>=this.p1?this.$.page0:this.$.page1;this.positionPage(t.pageNo,t)},adjustPortSize:function(){this.scrollerHeight=this.getBounds().height;var t=Math.max(this.scrollerHeight,this.portSize);this.$.port.applyStyle("height",t+"px")},positionPage:function(t,e){e.pageNo=t;var i=this.pageToPosition(t);e.applyStyle(this.pageBound,i+"px")},pageToPosition:function(t){for(var e=0,i=t;i>0;)i--,e+=this.getPageHeight(i);return e},positionToPageInfo:function(t){for(var e=-1,i=this.calcPos(t),o=this.defaultPageHeight;i>=0;)e++,i-=o=this.getPageHeight(e);return{no:e,height:o,pos:i+o}},isPageInRange:function(t){return t==Math.max(0,Math.min(this.pageCount-1,t))},getPageHeight:function(t){return this.pageHeights[t]||this.defaultPageHeight},invalidatePages:function(){this.p0=this.p1=null,this.$.page0.setContent(""),this.$.page1.setContent("")},invalidateMetrics:function(){this.pageHeights=[],this.rowHeight=0,this.updateMetrics()},scroll:function(t,e){var i=this.inherited(arguments);return this.update(this.getScrollTop()),i},scrollToBottom:function(){this.update(this.getScrollBounds().maxTop),this.inherited(arguments)},setScrollTop:function(t){this.update(t),this.inherited(arguments),this.twiddle()},getScrollPosition:function(){return this.calcPos(this.getScrollTop())},setScrollPosition:function(t){this.setScrollTop(this.calcPos(t))},scrollToRow:function(t){var e=Math.floor(t/this.rowsPerPage),i=(this.rowsPerPage,this.pageToPosition(e));if(this.updateForPosition(i),i=this.pageToPosition(e),this.setScrollPosition(i),e==this.p0||e==this.p1){var o=this.$.generator.fetchRowNode(t);if(o){var s=o.offsetTop;this.bottomUp&&(s=this.getPageHeight(e)-o.offsetHeight-s);var n=this.getScrollPosition()+s;this.setScrollPosition(n)}}},scrollToStart:function(){this[this.bottomUp?"scrollToBottom":"scrollToTop"]()},scrollToEnd:function(){this[this.bottomUp?"scrollToTop":"scrollToBottom"]()},refresh:function(){this.invalidatePages(),this.update(this.getScrollTop()),this.stabilize(),4===enyo.platform.android&&this.twiddle()},reset:function(){this.getSelection().clear(),this.invalidateMetrics(),this.invalidatePages(),this.stabilize(),this.scrollToStart()},getSelection:function(){return this.$.generator.getSelection()},select:function(t,e){return this.getSelection().select(t,e)},isSelected:function(t){return this.$.generator.isSelected(t)},renderRow:function(t){this.$.generator.renderRow(t)},prepareRow:function(t){this.$.generator.prepareRow(t)},lockRow:function(){this.$.generator.lockRow()},performOnRow:function(t,e,i){this.$.generator.performOnRow(t,e,i)},animateFinish:function(t){return this.twiddle(),!0},twiddle:function(){var t=this.getStrategy();enyo.call(t,"twiddle")}});