define(["sugar-web/activity/activity","sugar-web/env","webL10n","tutorial"],(function(e,t,n,o){requirejs(["domReady!"],(function(c){e.setup(),t.getEnvironment((function(e,t){var o="undefined"!=typeof chrome&&chrome.app&&chrome.app.runtime?chrome.i18n.getUILanguage():navigator.language,c=t.user?t.user.language:o;n.language.code=c}));var i=0;loadHighScore();var a=$("#canvas").blockrain({speed:20,theme:"candy",autoplay:!1,autoplayRestart:!0,autoBlockWidth:!0,autoBlockSize:24,touchControls:!0,highestScore:i,onStart:function(){},onRestart:function(){loadHighScore()},onGameOver:function(e){saveHighestScore()},onLine:function(e,t,n){n>i&&(i=n)}});function saveHighestScore(){console.log("writing...");var t=JSON.stringify(i);e.getDatastoreObject().setDataAsText(t),e.getDatastoreObject().save((function(e){null===e?console.log("write done."):console.log("write failed.")}))}function loadHighScore(){e.getDatastoreObject().loadAsText((function(e,t,n){null==e&&null!=n&&(i=JSON.parse(n),console.log(i))}))}document.getElementById("fullscreen-button").addEventListener("click",(function(){document.getElementById("main-toolbar").style.display="none",document.getElementById("canvas").style.top="0px",document.getElementById("unfullscreen-button").style.visibility="visible"})),document.getElementById("unfullscreen-button").addEventListener("click",(function(){document.getElementById("main-toolbar").style.display="block",document.getElementById("canvas").style.top="55px",document.getElementById("unfullscreen-button").style.visibility="hidden"})),document.getElementById("stop-button").addEventListener("click",(function(e){saveHighestScore()})),document.getElementById("btn-next").onclick=function(){!function switchTheme(e){var t=Object.keys(BlockrainThemes),n=a.blockrain("theme"),o=t.indexOf(n);e?o++:o--,o>=t.length&&(o=0),o<0&&(o=t.length-1),a.blockrain("theme",t[o])}(!0)},document.getElementById("help-button").addEventListener("click",(function(e){o.start()}))}))}));