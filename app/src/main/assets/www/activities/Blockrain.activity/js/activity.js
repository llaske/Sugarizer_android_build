define(["sugar-web/activity/activity","sugar-web/env","l10n","tutorial"],(function(e,t,n,o){requirejs(["domReady!"],(function(a){e.setup(),t.getEnvironment((function(e,t){var o="undefined"!=typeof chrome&&chrome.app&&chrome.app.runtime?chrome.i18n.getUILanguage():navigator.language,a=t.user?t.user.language:o;n.init(a)}));var l=0;loadHighScore();var c=!0,i=!1,s=$("#canvas").blockrain({speed:20,theme:"candy",autoplay:!1,autoplayRestart:!0,autoBlockWidth:!0,autoBlockSize:24,touchControls:!0,highestScore:l,onStart:function(){i=!0,handlePausePlay()},onRestart:function(){loadHighScore(),i=!0,handlePausePlay()},onGameOver:function(e){saveHighestScore(),i=!1,c=!0;var t=document.getElementById("play-button");t.classList.remove("pause"),t.classList.add("play")},onLine:function(e,t,n){n>l&&(l=n)}});function saveHighestScore(){console.log("writing...");var t=JSON.stringify(l);e.getDatastoreObject().setDataAsText(t),e.getDatastoreObject().save((function(e){null===e?console.log("write done."):console.log("write failed.")}))}function loadHighScore(){e.getDatastoreObject().loadAsText((function(e,t,n){null==e&&null!=n&&(l=JSON.parse(n),console.log(l))}))}function handlePausePlay(){var e=document.getElementById("play-button");i?(c?(s.blockrain("resume"),s.blockrain("controls",!0),e.classList.remove("play"),e.classList.add("pause")):(s.blockrain("pause"),s.blockrain("controls",!1),e.classList.remove("pause"),e.classList.add("play")),c=!c):s.blockrain("start")}document.getElementById("fullscreen-button").addEventListener("click",(function(){document.getElementById("main-toolbar").style.display="none",document.getElementById("canvas").style.top="0px",document.getElementById("unfullscreen-button").style.visibility="visible"})),document.getElementById("unfullscreen-button").addEventListener("click",(function(){document.getElementById("main-toolbar").style.display="block",document.getElementById("canvas").style.top="55px",document.getElementById("unfullscreen-button").style.visibility="hidden"})),document.getElementById("stop-button").addEventListener("click",(function(e){saveHighestScore()})),document.getElementById("btn-next").onclick=function(){!function switchTheme(e){var t=Object.keys(BlockrainThemes),n=s.blockrain("theme"),o=t.indexOf(n);e?o++:o--,o>=t.length&&(o=0),o<0&&(o=t.length-1),s.blockrain("theme",t[o])}(!0)},document.getElementById("play-button").addEventListener("click",(function(){handlePausePlay()})),document.getElementById("help-button").addEventListener("click",(function(e){o.start()}))}))}));