define(["sugar-web/activity/activity","messages","print","jquery.min","activity/ol","activity/hammer.min","webL10n","config","colormyworld","map","roll_up_div","util","languagepalette","sugar-web/graphics/colorpalette","filterpalette","modepalette","tutorial","sugar-web/env"],(function(e,t,n,o,a,i,l,r,c,u,d,s,m,g,y,v,p,b){requirejs(["domReady!"],(function(t){e.setup(),n(c.test()),n(u.test()),u.setup_map(),document.webL10n.getLanguage(),document.getElementById("stop-button").addEventListener("click",(function(t){console.log("writing...");var n=e.getDatastoreObject(),o=c.saveStateCB();n.setDataAsText(o),n.save((function(e){null===e?console.log("write done."):console.log("write failed.")}))}));var o=window.onresize=function(){e.getDatastoreObject().getMetadata((function(t,n){var o=(new Date).getTime();Math.abs(o-n.creation_time)>=2e3&&e.getDatastoreObject().loadAsText((function(e,t,n){c.loadStateCB(n)}))}));var t=document.webL10n.get("appname");"{{appname}}"==t&&(t="");var n=t.split(""),o=document.getElementById("persistent_title_div");html="";for(var a=0;a<n.length;a++){var i=c.mkBrightRGBA();html+="<span style='text-shadow:none;font-family:Mickey;color:"+i+";'>"+n[a]+"</span>"}o.innerHTML=html,s.resize()};window.setTimeout(o,1e3),document.getElementById("run-button").onclick=function(){c.toggleRunning()},c.setRGBColorString("rgb(0, 150, 0)");var a=document.getElementById("color-button"),i=new g.ColorPalette(a);i.setColor(c.getRGBColorString()),i.addEventListener("colorChange",(function(e){n(e.detail.color),c.setRGBColorString(e.detail.color)}));var l=document.getElementById("mode-button");v=new v.ModePalette(l,void 0),c.change_areaCB(!0,"World")})),document.getElementById("fullscreen-button").addEventListener("click",(function(){document.getElementById("main-toolbar").style.opacity=0,document.getElementById("canvas").style.top="0px",document.getElementById("unfullscreen-button").style.visibility="visible"})),document.getElementById("unfullscreen-button").addEventListener("click",(function(){document.getElementById("main-toolbar").style.opacity=1,document.getElementById("canvas").style.top="55px",document.getElementById("unfullscreen-button").style.visibility="hidden"})),document.getElementById("help-button").addEventListener("click",(function(e){p.start()})),b.getEnvironment((function(e,t){currentenv=t;var n="undefined"!=typeof chrome&&chrome.app&&chrome.app.runtime?chrome.i18n.getUILanguage():navigator.language,o=t.user?t.user.language:n;document.webL10n.setLanguage(o)}))}));