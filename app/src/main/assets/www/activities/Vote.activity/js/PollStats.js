var FooterItem={template:'\n\t\t<div class="footer-item" :class="{ answered: user.answer != null }">\n\t\t\t<div ref="hand" class="hand" v-show="user.handRaised"></div>\n\t\t\t<div ref="owner" class="owner" v-show="!user.handRaised"></div>\n\t\t\t<p class="username">{{ user.name }}</p>\n\t\t</div>\n\t',props:["user"],mounted(){this.$root.$refs.SugarIcon.colorizeIcon(this.$refs.hand,this.user.colorvalue),this.$root.$refs.SugarIcon.colorizeIcon(this.$refs.owner,this.user.colorvalue)}},ImageURL={template:'\n\t\t<img :src="imageURL" v-bind="$attrs">\n\t',props:["path"],data:()=>({imageURL:""}),created(){let t=this;this.canvasToImage(this.path).then((s=>{t.imageURL=s.dataURL,t.$emit("loaded")}))},methods:{canvasToImage:t=>new Promise(((s,e)=>{var a=new Image;a.src=t,a.onload=()=>{if(-1==t.indexOf("data:image/png")){var e=document.createElement("canvas");e.width=a.width,e.height=a.height,e.getContext("2d").drawImage(a,0,0),s({dataURL:e.toDataURL("image/png")})}else s({dataURL:t})}}))}},PollStats={template:'\n\t\t<div class="poll-stats" :id="id" :class="{ \'is-result\': isResult, \'is-thumbnail\': isThumbnail, fullscreen: $root.$refs.SugarToolbar ? $root.$refs.SugarToolbar.isHidden() : false }">\n\t\t\t<div class="poll-header" v-if="!isThumbnail">\n\t\t\t\t<button id="go-back" @click="goBack" v-if="!isResult && activePollStatus != \'running\'"></button>\n\t\t\t\t<h2>{{ activePoll.question }}</h2>\n\t\t\t\t<button id="stop-poll" @click="stopPoll" v-if="!isResult && activePollStatus == \'running\'"></button>\n\t\t\t</div>\n\t\t\n\t\t\t<div class="poll-stats-container">\n\t\t\t\t<div class="stats-container">\n\t\t\t\t\t<p class="wait-text" v-show="activePoll.typeVariable == \'Text\' && answers.length == 0  && !isThumbnail">{{ $root.$refs.SugarL10n.get(\'WaitingVotes\') }}</p>\n\t\t\t\t\t<canvas \n\t\t\t\t\t\tid="stats" \n\t\t\t\t\t\twidth="700" \n\t\t\t\t\t\theight="500" \n\t\t\t\t\t\tv-show="(exportingDoc && !canvasLoaded) || (!exportingDoc && (activePoll.typeVariable != \'Text\' || answers.length != 0))"\n\t\t\t\t\t></canvas>\n\t\t\t\t\t<ImageURL v-if="exportingDoc && canvasLoaded" :path="canvasURL" @loaded="loadedImages++" />\n\t\t\t\t\t<div class="text-popup" v-if="canvasInfoItem && !isThumbnail">{{ canvasInfoItem[0] }}: {{ canvasInfoItem[1] }}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="stats-legends" v-if="!isThumbnail && activePoll.typeVariable == \'ImageMCQ\'">\n\t\t\t\t\t<div class="legend-item" v-for="(option, i) in activePoll.options" :key="i">\n\t\t\t\t\t\t<div class="color" :style="{ backgroundColor: statsData.datasets[0].backgroundColor[i] }"></div>\n\t\t\t\t\t\t<span>{{ i+1 }}</span>\n\t\t\t\t\t\t<div class="legend-image">\n\t\t\t\t\t\t\t<ImageURL :path="option" @loaded="loadedImages++" v-if="exportingDoc" />\n\t\t\t\t\t\t\t<img :src="option" v-else>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="stats-cards" v-if="!isThumbnail">\n\t\t\t\t\t<div \n\t\t\t\t\t\tclass="stats-card" \n\t\t\t\t\t\tv-if="activePoll.typeVariable == \'Rating\' && answers.length > 0" \n\t\t\t\t\t\t:style="{ border: \'solid 2px \' + currentUser.colorvalue.fill }"\n\t\t\t\t\t>\n\t\t\t\t\t\t<p class="number" :style="{ color: currentUser.colorvalue.fill }">{{ averageRating }}</p>\n\t\t\t\t\t\t<h3 class="title" :style="{ color: currentUser.colorvalue.stroke }">{{ l10n.stringAvgRating }}</h3>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="stats-card"  v-if="isResult" :style="{ border: \'solid 2px \' + currentUser.colorvalue.fill }">\n\t\t\t\t\t\t<p class="number" :style="{ color: currentUser.colorvalue.fill }">{{ activePoll.results.counts.answersCount }}</p>\n\t\t\t\t\t\t<h3 class="title" :style="{ color: currentUser.colorvalue.stroke }">{{ l10n.stringVotes }}</h3>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="stats-card"  v-if="isResult" :style="{ border: \'solid 2px \' + currentUser.colorvalue.fill }">\n\t\t\t\t\t\t<p class="number" :style="{ color: currentUser.colorvalue.fill }">{{ activePoll.results.counts.usersCount }}</p>\n\t\t\t\t\t\t<h3 class="title" :style="{ color: currentUser.colorvalue.stroke }">{{ l10n.stringUsers }}</h3>\n\t\t\t\t\t</div>\n\t\t\t\t\t<p class="date" v-if="isResult && isHistory && !exportingDoc">{{ $root.$refs.SugarL10n.localizeTimestamp(activePoll.endTime) }}</p>\n\t\t\t\t\t<p class="date" v-if="isResult && isHistory && exportingDoc">{{ new Date(activePoll.endTime).toLocaleString() }}</p>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<hr v-if="exportingDoc">\n\t\t\t\n\t\t\t<div class="poll-footer" v-if="!isResult && !isThumbnail">\n\t\t\t\t<div class="footer-list">\n\t\t\t\t\t<div class="vote-progress">{{ answers.length }}/{{ Object.keys(connectedUsers).length }}</div>\n\t\t\t\t\t<footer-item\n\t\t\t\t\t\tv-for="user in connectedUsers"\n\t\t\t\t\t\tv-if="user.handRaised"\n\t\t\t\t\t\t:key="user.networkId"\n\t\t\t\t\t\t:user="user"\n\t\t\t\t\t></footer-item>\n\t\t\t\t\t<footer-item\n\t\t\t\t\t\tv-for="user in connectedUsers"\n\t\t\t\t\t\tv-if="!user.handRaised && user.answer != null"\n\t\t\t\t\t\t:key="user.networkId"\n\t\t\t\t\t\t:user="user"\n\t\t\t\t\t></footer-item>\n\t\t\t\t\t<footer-item\n\t\t\t\t\t\tv-for="user in connectedUsers"\n\t\t\t\t\t\tv-if="!user.handRaised && user.answer == null"\n\t\t\t\t\t\t:key="user.networkId"\n\t\t\t\t\t\t:user="user"\n\t\t\t\t\t></footer-item>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t',components:{"footer-item":FooterItem,ImageURL:ImageURL},props:{id:{type:String,default:"stats-poll"},activePoll:Object,activePollStatus:String,connectedUsers:Object,currentUser:Object,isResult:Boolean,isThumbnail:Boolean,isHistory:Boolean,realTimeResults:Boolean,autoStop:Boolean,exportingDoc:Boolean},data:()=>({statsChart:null,statsData:{labels:[],datasets:[{label:"Votes",data:[],backgroundColor:[],hoverBackgroundColor:[]}]},statsOptions:{responsive:!0,maintainAspectRatio:!1,plugins:{datalabels:{display:!1}}},statsBarOptions:{scales:{yAxes:[{ticks:{beginAtZero:!0,precision:0}}]}},colorIndex:0,canvasInfoItem:null,l10n:{stringYes:"",stringNo:"",stringVotes:"",stringUsers:"",stringAvgRating:""},totalImages:0,loadedImages:0,canvasLoaded:!1}),computed:{answers(){if(!this.isResult&&!this.isThumbnail){let t=[];for(let s in this.connectedUsers)null!=this.connectedUsers[s].answer&&t.push(this.connectedUsers[s].answer);return t}return this.activePoll.results.answers},averageRating(){let t=0;for(let s of this.answers)t+=s;return Math.round(t/this.answers.length*10)/10},imagesLoaded(){return this.totalImages==this.loadedImages},canvasURL(){return document.querySelector(`#${this.id} #stats`).toDataURL("image/png")}},watch:{answers:function(t,s){this.updateChart(),this.isResult||this.isThumbnail||(this.updateCounts(),this.autoStop&&this.answers.length==Object.keys(this.connectedUsers).length&&this.stopPoll(),this.realTimeResults&&this.$emit("update-results",this.answers))},realTimeResults:function(t,s){t&&this.$emit("update-results",this.answers)},connectedUsers:function(t,s){this.isResult||this.isThumbnail||this.updateCounts()},imagesLoaded:function(t,s){t&&this.$emit("animation-complete")}},created(){this.totalImages=1,"ImageMCQ"==this.activePoll.typeVariable&&(this.totalImages+=this.activePoll.options.length),this.statsOptions.legend={display:!this.isThumbnail},this.statsOptions.animation={onComplete:()=>{this.exportingDoc?this.canvasLoaded=!0:this.$emit("animation-complete")}}},mounted(){this.$root.$refs.SugarL10n.localize(this.l10n);let t,s=document.querySelector(`#${this.id} #stats`),e=[],a={label:"Votes",data:[],backgroundColor:[],hoverBackgroundColor:[]};switch(this.activePoll.typeVariable){case"Text":let o=this.getWordsList(this.answers);WordCloud(s,{list:o,weightFactor:40-this.answers.length,shrinkToFit:!0,hover:this.showWordCount});let i=0;s.addEventListener("wordclouddrawn",(()=>{i++,i==o.length&&(this.exportingDoc?this.canvasLoaded=!0:this.$emit("animation-complete"))}));break;case"MCQ":for(let s of this.activePoll.options)e.push(s),a.data.push(0),t=this.getColor(),a.backgroundColor.push(t.background),a.hoverBackgroundColor.push(t.hover);this.$set(this.statsData,"labels",e),this.$set(this.statsData.datasets,0,a),this.statsChart=new Chart(s,{type:"pie",data:this.statsData,options:{...this.statsOptions,plugins:{datalabels:{formatter:(t,s)=>{if(0==t)return"";{let e=s.chart.data.datasets[0].data.reduce(((t,s)=>t+s),0);return Math.round(t/e*100)+"%"}},color:"#000000",font:{size:this.isThumbnail?"12":"16",weight:this.isThumbnail?"normal":"bold"}}}}});break;case"ImageMCQ":for(let s in this.activePoll.options)e.push(parseInt(s)+1),a.data.push(0),t=this.getColor(),a.backgroundColor.push(t.background),a.hoverBackgroundColor.push(t.hover);this.$set(this.statsData,"labels",e),this.$set(this.statsData.datasets,0,a),this.statsChart=new Chart(s,{type:"bar",data:this.statsData,options:{...this.statsOptions,...this.statsBarOptions,legend:{display:!1}}});break;case"Rating":for(let s=1;s<=5;s++)e.push(s),a.data.push(0),t=this.getColor(),a.backgroundColor.push(t.background),a.hoverBackgroundColor.push(t.hover);this.$set(this.statsData,"labels",e),this.$set(this.statsData.datasets,0,a),this.statsChart=new Chart(s,{type:"bar",data:this.statsData,options:{...this.statsOptions,...this.statsBarOptions,legend:{display:!this.isThumbnail,labels:{generateLabels:t=>t.data.labels.map(((s,e)=>{let a=t.getDatasetMeta(0);return{text:s,fillStyle:t.data.datasets[0].backgroundColor[e],strokeStyle:"#000000",lineWidth:0,hidden:isNaN(t.data.datasets[0].data[e])||a.data[e].hidden,index:e}}))}}}});break;case"YesNo":e.push(this.l10n.stringNo),a.data.push(0),t=this.getColor(),a.backgroundColor.push(t.background),a.hoverBackgroundColor.push(t.hover),e.push(this.l10n.stringYes),a.data.push(0),t=this.getColor(),a.backgroundColor.push(t.background),a.hoverBackgroundColor.push(t.hover),this.$set(this.statsData,"labels",e),this.$set(this.statsData.datasets,0,a),this.statsChart=new Chart(s,{type:"pie",data:this.statsData,options:{...this.statsOptions,plugins:{datalabels:{formatter:(t,s)=>{if(0==t)return"";{let e=s.chart.data.datasets[0].data.reduce(((t,s)=>t+s),0);return Math.round(t/e*100)+"%"}},color:"#000000",font:{size:this.isThumbnail?"12":"16",weight:this.isThumbnail?"normal":"bold"}}}}})}(this.isResult||this.isThumbnail)&&"Text"!=this.activePoll.typeVariable&&this.updateChart()},methods:{getColor(t){let s,e=["rgba(255, 74, 112, 0.8)","rgba(74, 95, 255, 0.8)","rgba(74, 255, 83, 0.8)","rgba(255, 249, 74, 0.8)","rgba(74, 255, 237, 0.8)","rgba(255, 74, 249, 0.8)","rgba(171, 74, 255, 0.8)","rgba(195, 255, 74, 0.8)","rgba(255, 193, 128, 0.8)","rgba(128, 198, 255, 0.8)","rgba(91, 181, 116, 0.8)"],a=["rgba(255, 74, 112, 1)","rgba(74, 95, 255, 1)","rgba(74, 255, 83, 1)","rgba(255, 249, 74, 1)","rgba(74, 255, 237, 1)","rgba(255, 74, 249, 1)","rgba(171, 74, 255, 1)","rgba(195, 255, 74, 1)","rgba(255, 193, 128, 1)","rgba(128, 198, 255, 1)","rgba(91, 181, 116, 1)"];if(this.colorIndex<e.length){let o=this.colorIndex;t&&(o=t.random?Math.floor(Math.random()*e.length):this.colorIndex),s={background:e[o],hover:a[o]},this.colorIndex++}else{let t=360*Math.random(),e=80+15*Math.random(),a=50+20*Math.random();s={background:`hsla(${t}, ${e}%, ${a}%, 0.8)`,hover:`hsla(${t}, ${e}%, ${a}%, 1)`}}return s},updateCounts(){let t={answersCount:this.answers.length,usersCount:Object.keys(this.connectedUsers).length};this.$emit("update-counts",t),this.$root.$refs.SugarPresence.sendMessage({user:this.$root.$refs.SugarPresence.getUserInfo(),content:{action:"update-counts",data:{counts:t}}})},updateChart(){let t=[];switch(this.activePoll.typeVariable){case"Text":let s=document.querySelector(`#${this.id} #stats`);WordCloud(s,{list:this.getWordsList(this.answers),weightFactor:40-this.answers.length,shrinkToFit:!0,hover:this.showWordCount});break;case"MCQ":case"ImageMCQ":for(let s in this.activePoll.options)t.push(0);for(let s of this.answers)t[s]++;this.$set(this.statsData.datasets[0],"data",t);break;case"Rating":for(let s=1;s<=5;s++)t.push(0);for(let s of this.answers)t[s-1]++;this.$set(this.statsData.datasets[0],"data",t);break;case"YesNo":t.push(0),t.push(0);for(let s of this.answers){t[s?1:0]++}this.$set(this.statsData.datasets[0],"data",t)}"Text"!=this.activePoll.typeVariable&&this.statsChart.update()},getWordsList(t){let s={};for(let e of t){let t=e.split(",");for(let e of t){let t=e.trim().toLowerCase();s[t]?s[t]++:s[t]=1}}let e=[];for(let t in s)e.push([t,s[t]]);return e},showWordCount(t,s,e){this.canvasInfoItem=t},stopPoll(){this.$emit("update-results",this.answers),this.$emit("save-to-history"),this.$emit("stop-poll")},goBack(){this.$emit("go-back-to","polls-grid")}}};