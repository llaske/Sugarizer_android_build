function main(e,t,n,o,a,r,i,s,l){var d=new t({boardState:[],generation:0,playPauseIcon:"play",shouldPlay:!1,generationTimeInterval:235,gridCols:40,gridRows:20,showTrails:!1}),c=n[0],u=n[1],g=n[2],y=n[3],m=document.querySelector(".main canvas"),f=new e(d.state.boardState,o.fill,"#FBF6F5","#C0C0C0",a(o.stroke,10),o.stroke,12,12,2,2,m),b=document.getElementById("speed-button"),w=(new s.ActivityPalette(b,d),document.getElementById("size-button"));new l.ActivityPalette(w,d,f);document.querySelector(".generation-count").style.color=o.fill,document.querySelector(".generation-status").style.color=o.fill,f.draw(d);var v=function storeLocally(e){i.setDataAsText({boardState:e.boardState,generation:e.generation,gridCols:e.gridCols,gridRows:e.gridRows,showTrails:e.showTrails}),console.log(e),console.log("writing"),i.save((function(e){e?(console.log("writing failed."),console.error(e)):console.log("writing saved.")}))},h=function generateGeneration(){if(!d.state.shouldPlay)return 0;var e=d.state.boardState.map((function(e,t){return e.map((function(e,n){return S(e,p(n,t))}))}));d.set((function(t){return{boardState:e,generation:t.generation+1}})),setTimeout(generateGeneration,d.state.generationTimeInterval)},S=function transformCellByRule(e,t){var n=1===e||2===e,o=t.filter((function(e){return 1===e||2===e})),a=o.length;return n?a<2?3:2===a||3===a?1:3:3===a?2:e},p=function findNeighbours(e,t){var n=e-1==-1?d.state.gridCols-1:e-1,o=e+1===d.state.gridCols?0:e+1,a=t-1==-1?d.state.gridRows-1:t-1,r=t+1===d.state.gridRows?0:t+1,i=d.state.boardState;return[i[t][n],i[t][o],i[a][e],i[r][e],i[a][n],i[r][n],i[a][o],i[r][o]]};d.subscribe({boardState:[".fake-selector",function(e,t,n){f.update(t)}],generation:[".generation-count","innerText"],playPauseIcon:["#play-pause",function(e,t,n){e.className=t+" toolbutton"}],shouldPlay:[".fake-selector",function(e,t,n){t&&h()}],gridCols:[".fake-selector",function(e,t,n){document.getElementById("sizevalue").value=t/20,f.handleResize(window.innerWidth,d.state.boardState,d)}],gridRows:[".fake-selector",function(e,t,n){document.getElementById("sizevalue").value=t/10,f.handleResize(window.innerWidth,d.state.boardState,d)}],showTrails:["#deadCells-button",function(e,t,n){t?(e.className="toolbutton active",f.showTrails=!0):(e.className="toolbutton",f.showTrails=!1),f.update(d.state.boardState)}]}),i.loadAsText((function(e,t,n){var o=n?n.boardState:c(d),a=n?n.generation:0,r=n?n.gridCols:40,i=n?n.gridRows:20,s=!!n&&n.showTrails;console.log(n),d.set({boardState:o,generation:parseInt(a),gridCols:parseInt(r),gridRows:parseInt(i),showTrails:s})})),f.onClick((function(e,t){d.set((function(n){var o=[].concat(n.boardState),a=o[t][e];return o[t][e]=1===a||2===a?3:2,{boardState:o}}))})),document.querySelector("#play-pause").addEventListener("click",(function(){d.set((function(e){var t="play"===e.playPauseIcon?"pause":"play",n=!0!==e.shouldPlay;return e.shouldPlay&&v({boardState:d.state.boardState,generation:d.state.generation,gridCols:d.state.gridCols,gridRows:d.state.gridRows,showTrails:d.state.showTrails}),{playPauseIcon:t,shouldPlay:n}}))})),document.querySelector("#deadCells-button").addEventListener("click",(function(){f.showTrails?d.set({showTrails:!1}):d.set({showTrails:!0})})),document.querySelector("#stop-button").addEventListener("click",(function(){v({boardState:d.state.boardState,generation:d.state.generation,gridCols:d.state.gridCols,gridRows:d.state.gridRows,showTrails:d.state.showTrails})})),document.getElementById("fullscreen-button").addEventListener("click",(function(){document.getElementById("main-toolbar").style.opacity=0,document.getElementById("canvas").style.top="0px",document.getElementById("unfullscreen-button").style.visibility="visible",f.handleResize(window.innerWidth,d.state.boardState,d)})),document.getElementById("unfullscreen-button").addEventListener("click",(function(){document.getElementById("main-toolbar").style.opacity=1,document.getElementById("canvas").style.top="55px",document.getElementById("unfullscreen-button").style.visibility="hidden",f.handleResize(window.innerWidth,d.state.boardState,d)})),document.querySelector("#random").addEventListener("click",(function(){d.set({boardState:c(d),generation:0})})),document.querySelector("#glider").addEventListener("click",(function(){d.set({boardState:u(d),generation:0})})),document.querySelector("#no").addEventListener("click",(function(){d.set({boardState:g(d),generation:0})})),document.querySelector("#clear").addEventListener("click",(function(){d.set({boardState:y(d),generation:0,playPauseIcon:"play",shouldPlay:!1})})),window.addEventListener("resize",(function(e){f.handleResize(window.innerWidth,d.state.boardState,d)})),f.handleResize(window.innerWidth,d.state.boardState,d)}define(["sugar-web/activity/activity","webL10n","activity/Board","activity/vanilla-state","activity/patterns","activity/shadeColor","sugar-web/env","genSpeedPalette","gridSizePalette","tutorial"],(function(e,t,n,o,a,r,i,s,l,d){requirejs(["domReady!"],(function(d){e.setup(),i.getEnvironment((function(i,d){var c="undefined"!=typeof chrome&&chrome.app&&chrome.app.runtime?chrome.i18n.getUILanguage():navigator.language,u=d.user?d.user.language:c;t.language.code=u,window.addEventListener("localized",(function(){document.querySelector(".generation-status").innerText=t.get("Generation"),document.querySelector("#speedlabel").innerText=t.get("speed"),document.querySelector("#sizelabel").innerText=t.get("size")})),e.getXOColor((function(i,d){var c=e.getDatastoreObject();main(n,o,a,d,r,t,c,s,l)}))}))})),document.querySelector("#help-button").addEventListener("click",(function(e){d.start()}))}));