function OneColumnAbacus(t,i,s,h,e,o,a,n,l,r){void 0===o&&(o=i),void 0===a&&(a=!1),void 0===n&&(n=!1),void 0===l&&(l=!1),void 0===r&&(r=!1),this.blockScaleYFromX=25/33,this.topBottomBarScale=1.6,this.leftRightBarScale=1.6*this.blockScaleYFromX,this.middleBarScale=1,this.horizontalMargin=1/3,this.verticalMargin=.05,this.extraBeads=2,this.rods=i,this.blockHeight=0,this.blockWidth=0,this.abacusHeight=0,this.abacusWidth=0,this.upperBlockHeight=0,this.lowerBlockHeight=0,this.colHeight=0,this.stage=t,this.columns=[],this.rodtext=[],this.answertext=null,this.trix=null,this.startx=null,this.schetyColumns=[1e9,1e8,1e7,1e6,1e5,1e4,1e3,100,10,1,.25,.1,.01,.001,1e-4],this.fractionColumns=[1e5,1e4,1e3,100,10,1,[1,2],[1,3],[1,4],[1,5],[1,6],[1,8],[1,9],[1,10],[1,12]],this.rodsColumns=[[1,1],[1,2],[1,3],[1,4],[1,5],[1,6],[1,7],[1,8],[1,9],[1,10]],this.rodsColours=["#FFFFFF","#FC0D1B","#88FD31","#FC28FC","#FFFD38","#1FCC23","#000000","#AA6717","#23CCFC","#FD8824"],this.blockGivenWidth=function(t){return t/(2*this.leftRightBarScale+i+this.horizontalMargin*i)},this.blockGivenHeight=function(t){return t/(2*this.topBottomBarScale+(s+this.extraBeads)+this.verticalMargin*(s+this.extraBeads))},this.heightGivenBlockWidth=function(t){return this.blockScaleYFromX*t*(2*this.topBottomBarScale+(s+this.extraBeads)+this.verticalMargin*(s+this.extraBeads))},this.widthGivenBlockWidth=function(t){return t*(2*this.leftRightBarScale+i+this.horizontalMargin*i)},this.initValues=function(){var i=.85*t.canvas.height,h=.9*t.canvas.width,e=this.blockGivenWidth(h),o=this.blockScaleYFromX*e;this.heightGivenBlockWidth(e)>i&&(e=(o=this.blockGivenHeight(i))/this.blockScaleYFromX,console.log("Using height")),this.blockHeight=o,this.blockWidth=e,this.abacusHeight=this.heightGivenBlockWidth(this.blockWidth),this.abacusWidth=this.widthGivenBlockWidth(this.blockWidth),this.colHeight=this.blockHeight*(s+this.extraBeads+this.verticalMargin*(s+this.extraBeads)),console.log(this.blockHeight),console.log(this.blockWidth),console.log(this.abacusHeight),console.log(this.abacusWidth),this.startx=(t.canvas.width-this.abacusWidth)/2+this.leftRightBarScale*this.blockWidth+this.horizontalMargin*this.blockWidth/2+this.blockWidth/2},this.initRectangle=function(){var i=new createjs.Shape;i.graphics.beginStroke("#000000"),i.graphics.setStrokeStyle(this.leftRightBarScale*this.blockWidth),i.graphics.beginFill("#C0C0C0").drawRoundRect(this.leftRightBarScale*this.blockWidth/2,this.leftRightBarScale*this.blockWidth/2,this.abacusWidth-this.leftRightBarScale*this.blockWidth,this.abacusHeight-this.leftRightBarScale*this.blockWidth,2/3*this.blockWidth),i.x=(t.canvas.width-this.abacusWidth)/2,i.y=t.canvas.height/10,t.addChild(i)},this.initTriangle=function(){this.tri=new createjs.Shape;var s=this.blockWidth/4*3,h=t.canvas.height/10+this.leftRightBarScale*this.blockWidth*2/3,e=(t.canvas.width-this.abacusWidth)/2+this.leftRightBarScale*this.blockWidth+this.horizontalMargin*this.blockWidth/2+this.blockWidth/2,o=this.horizontalMargin*this.blockWidth+this.blockWidth,a=e+o*(i-1);this.tri.graphics.moveTo(0-s/2,0).beginFill("#FC0D1B").lineTo(0+s/2,0).lineTo(0,0+this.leftRightBarScale*this.blockWidth/3).lineTo(0-s/2,0).closePath(),this.tri.x=a-this.blockWidth/2,this.tri.y=h,this.trix=this.tri.x-this.startx,t.addChild(this.tri);var n=this.tri,l=this;this.tri.on("mousedown",(function(t){this.offset={x:n.x-t.stageX,y:n.y-t.stageY}})),this.tri.on("pressmove",(function(t){t.stageX+this.offset.x<e-l.blockWidth/2?n.x=e-l.blockWidth/2:t.stageX+this.offset.x>a+l.blockWidth/2?n.x=a+l.blockWidth/2:n.x=t.stageX+this.offset.x,l.trix=n.x-l.startx}))},this.initColumns=function(){var c,d=(t.canvas.width-this.abacusWidth)/2+this.leftRightBarScale*this.blockWidth+this.horizontalMargin*this.blockWidth/2+this.blockWidth/2,g=this.horizontalMargin*this.blockWidth+this.blockWidth,u=t.canvas.height/10+this.leftRightBarScale*this.blockWidth,x=u+this.colHeight,b=["#A0A0A0","#6B6B6B"],w=["#000000","#000000"];console.log(e);var f,k,v=e.fill,W=e.stroke;if(0==a&&0==n&&0==l&&0==r)for(var m=0;m<i;m++){if(m%2==0?(c=w,f=v):(c=b,f=W),o-m-1<0){var B=new window.Fraction(1);k=new window.Fraction(Math.pow(h,Math.abs(o-m-1))),k=B.div(k)}else k=new window.Fraction(Math.pow(h,o-m-1));(S=new StandardAbacusColumn(d,u,x,0,s,s+this.extraBeads,f,c,this,k,!1)).init(),this.columns.push(S),d+=g}else if(1==a){var F=s+this.extraBeads;for(m=0;m<i;m++){m%2==0?(c=w,f=v):(c=b,f=W),k=new window.Fraction(this.schetyColumns[m]),console.log(k),p=10==m?4:s,(S=new StandardAbacusColumn(d,u,x,0,p,F,f,c,this,k,!1,!1,!0)).init(),this.columns.push(S),d+=g}}else if(1==l||1==n)for(F=s+this.extraBeads,m=0;m<i;m++){if(m%2==0?(c=w,f=v):(c=b,f=W),m>5&&(f="#000000"),k=new window.Fraction(this.fractionColumns[m]),console.log(k),p=m>5?this.fractionColumns[m][1]:10,1==l)var S=new PosNegColumn(d,u,x,p,F,f,c,this,k,!1,!1);else S=new StandardAbacusColumn(d,u,x,0,p,F,f,c,this,k,!1,!1);S.init(),this.columns.push(S),d+=g}else{console.log("rods");var p;for(F=s+this.extraBeads,m=0;m<i;m++){c=m%2==0?w:b,f=this.rodsColours[m],k=new window.Fraction(this.rodsColumns[m]),console.log(k),p=this.rodsColumns[m][1],(S=new PosNegColumn(d,u,x,p,F,f,c,this,k,!1,!0)).init(),this.columns.push(S),console.log(S),d+=g}}},this.restore=function(t){for(var i=0;i<t.length;i++)this.columns[i].restore(t[i]);for(i=0;i<t.length;i++)this.columns[i].restoreAge(t[i])},this.save=function(){for(var t=[],i=0;i<this.columns.length;i++)t.push(this.columns[i].save());return t},this.saveTri=function(){return console.log(this.trix),this.trix/this.abacusWidth},this.restoreTri=function(t){console.log(t),this.tri.x=this.startx+t*this.abacusWidth,this.trix=this.tri.x-this.startx,console.log(this.tri.x)},this.initTextItems=function(){for(var s=(t.canvas.width-this.abacusWidth)/2+this.leftRightBarScale*this.blockWidth+this.horizontalMargin*this.blockWidth/2+this.blockWidth/2,h=this.horizontalMargin*this.blockWidth+this.blockWidth,e=0;e<i;e++){(o=new createjs.Text("",(t.canvas.width/70).toString()+"px Arial","#FFF")).set({textAlign:"center"}),o.x=s,o.y=t.canvas.height/10+this.abacusHeight-this.leftRightBarScale*this.blockWidth/2,t.addChild(o),this.rodtext.push(o),s+=h}var o;(o=new createjs.Text("",this.blockWidth.toString()+"px Arial","#000")).set({textAlign:"center"}),o.x=t.canvas.width/2,o.y=t.canvas.height/40,t.addChild(o),this.answertext=o},this.updatePosNegTextItems=function(){if(this.columns.length==i){for(var t=[],s=new window.Fraction(0,1),h=0;h<i;h++){this.columns[h].updateAges();var e=this.columns[h].howManyInUse(),o=e[0],a=e[1],n=o.length-a.length;this.rodtext[h].text=0!=n?n.toString():"";var l=this.columns[h].value.mul(o.length),r=this.columns[h].value.mul(a.length),c=l.sub(r),d=new window.Fraction(0);c.equals(d)||(t.push(c.toFraction(!0)),s=s.add(c))}d=new window.Fraction(0);if(1==t.length){var g=s.toFraction(!0);this.answertext.text=g}else if(s.equals(d))this.answertext.text="";else{for(g="",h=0;h<t.length-1;h++)g+=t[h]+" + ";g+=t[t.length-1]+" = "+s.toFraction(!0),this.answertext.text=g}this.answertext.text.length>=40?this.answertext.font=parseInt(this.blockWidth/this.answertext.text.length*40)+"px Arial":this.answertext.font=this.blockWidth.toString()+"px Arial"}},this.updateTextItems=function(){if(1==l||1==r)this.updatePosNegTextItems();else if(this.columns.length==i){for(var t=[],s=new window.Fraction(0,1),h=0;h<i;h++){this.columns[h].updateAges();var e=this.columns[h].howManyInUse(),o=e.length;this.rodtext[h].text=0!=o?o.toString():"";var a=this.columns[h].value.mul(e.length),n=new window.Fraction(0);a.equals(n)||(t.push(a.toFraction(!0)),s=s.add(a))}n=new window.Fraction(0);if(1==t.length){var c=s.toFraction(!0);this.answertext.text=c}else if(s.equals(n))this.answertext.text="";else{for(c="",h=0;h<t.length-1;h++)c+=t[h]+" + ";c+=t[t.length-1]+" = "+s.toFraction(!0),this.answertext.text=c}this.answertext.text.length>=40?this.answertext.font=parseInt(this.blockWidth/this.answertext.text.length*40)+"px Arial":this.answertext.font=this.blockWidth.toString()+"px Arial"}},this.init=function(){this.initValues(),this.initRectangle(),this.initColumns(),this.initTextItems(),this.initTriangle()}}