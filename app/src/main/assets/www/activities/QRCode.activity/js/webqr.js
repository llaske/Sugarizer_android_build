var gCtx=null,gCanvas=null,c=0,stype=0,gUM=!1,_webkit=!1,moz=!1,v=null,qrSize=0,margin=0,scannedCallback=null,vidhtml='<video id="video-stream" autoplay></video>';function handleFiles(e){for(var a=0;a<e.length;a++){var t=new FileReader;t.onload=(e[a],function(e){gCtx.clearRect(0,0,gCanvas.width,gCanvas.height),qrcode.decode(e.target.result)}),t.readAsDataURL(e[a])}}function initCanvas(e,a){(gCanvas=document.getElementById("qr-canvas")).style.width=e+"px",gCanvas.style.height=a+"px",gCanvas.width=e,gCanvas.height=a,(gCtx=gCanvas.getContext("2d")).clearRect(0,0,e,a)}function captureToCanvas(){if(1==stype&&gUM)try{gCtx.drawImage(v,0,0);try{qrcode.decode()}catch(e){console.log(e),setTimeout(captureToCanvas,500)}}catch(e){console.log(e),setTimeout(captureToCanvas,500)}}function htmlEntities(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function read(e){scannedCallback&&scannedCallback(e)}function isCanvasSupported(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))}function success(e){v.srcObject=e,v.play(),gUM=!0,setTimeout(captureToCanvas,500)}function error(e){gUM=!1}function load(e,a,t){qrSize=e,margin=a,scannedCallback=t,isCanvasSupported()&&window.File&&window.FileReader?(initCanvas(800,600),qrcode.callback=read,setwebcam()):console.log("Sorry your browser is not supported")}function setwebcam(){var e=!0;if(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices)try{navigator.mediaDevices.enumerateDevices().then((function(a){a.forEach((function(a){"videoinput"===a.kind&&a.label.toLowerCase().search("back")>-1&&(e={deviceId:{exact:a.deviceId},facingMode:"environment"}),console.log(a.kind+": "+a.label+" id = "+a.deviceId)})),setwebcam2(e)}))}catch(e){console.log(e)}else console.log("no navigator.mediaDevices.enumerateDevices"),setwebcam2(e)}function setwebcam2(e){if(console.log(e),1!=stype){var a=navigator;document.getElementById("outdiv").innerHTML=vidhtml,(v=document.getElementById("video-stream")).style.width=qrSize+"px",v.style.marginLeft=margin+"px",a.mediaDevices.getUserMedia?a.mediaDevices.getUserMedia({video:e,audio:!1}).then((function(e){success(e)})).catch((function(e){e(e)})):a.getUserMedia?(_webkit=!0,a.getUserMedia({video:e,audio:!1},success,error)):a.webkitGetUserMedia&&(_webkit=!0,a.webkitGetUserMedia({video:e,audio:!1},success,error)),stype=1,setTimeout(captureToCanvas,500)}else setTimeout(captureToCanvas,500)}