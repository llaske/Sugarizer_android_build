function Game(t,i,s,e,h,r){this.margin=0,this.radius=0,this.circleswidth=0,this.circlesheight=0,this.colours=[i.stroke,i.fill],this.level=4,this.turns=1,this.gridwidth=7,this.gridheight=7,this.numFlips=14,this.startgridwidth=4,this.startgridheight=4,this.dots=[],this.stack=[],this.solveTimeout,this.newGameTimeout,this.radiusFromX=function(){return this.margin=.02*t.canvas.width,(t.canvas.width-this.margin*(this.gridwidth+1))/this.gridwidth/2},this.radiusFromY=function(){return this.margin=.02*t.canvas.height,(t.canvas.height-this.margin*(this.gridheight+1))/this.gridheight/2},this.canDoFromX=function(){var i=this.radiusFromX();return this.margin=.02*t.canvas.width,2*i*this.gridheight+this.margin*(this.gridheight+1)<=t.canvas.height&&i},this.checkGameOver=function(){for(var t=!0,i=!0,s=0;s<this.startgridwidth;s++)for(var e=0;e<this.startgridheight;e++)0!=this.dots[s][e].colour&&(i=!1),1!=this.dots[s][e].colour&&(t=!1);return!(!i&&!t)},this.flip=function(t,i,s,e){this.turns=this.turns+1,document.getElementById("turnno").innerHTML=" "+this.turns,this.drawIndicator(),void 0===s&&(s=!0),void 0===e&&(e=!0),e&&this.stack.push([t,i]),this.dots[t][i].flipSelf(),0<i&&this.dots[t][i-1].flipSelf(),0<t&&this.dots[t-1][i].flipSelf(),i<this.startgridheight-1&&this.dots[t][i+1].flipSelf(),t<this.startgridwidth-1&&this.dots[t+1][i].flipSelf(),s&&this.checkGameOver()&&this.gameOver()},this.drawIndicator=function(){switch(diffind=this.turns-3*this.level,console.log(diffind),diffind){case 40:document.getElementById("fliptext").style.borderBottom="5px solid #f00";break;case 30:document.getElementById("fliptext").style.borderBottom="5px solid #ff410b";break;case 20:document.getElementById("fliptext").style.borderBottom="5px solid #ff7e00";break;case 10:document.getElementById("fliptext").style.borderBottom="5px solid #c7ff00";break;case 5:document.getElementById("fliptext").style.borderBottom="5px solid #00ff1b",console.log("12")}},this.getRandomInt=function(t,i){return Math.floor(Math.random()*(i-t+1))+t},this.flipRandomDot=function(){this.flip(this.getRandomInt(0,this.startgridwidth-1),this.getRandomInt(0,this.startgridheight-1),!1)},this.solve=function(){if(0!=this.stack.length){var t=this.stack.pop();this.flip(t[0],t[1],!1,!1),this.checkGameOver()&&this.gameOver()}},this.gameOver=function(){for(var t=0;t<this.startgridwidth;t++)for(var i=0;i<this.startgridheight;i++)this.dots[t][i].showSmile(),this.dots[t][i].clickable=!1;this.startgridwidth<this.gridwidth&&(this.startgridwidth++,this.startgridheight++),this.palette.setUsed();var s=this;this.newGameTimeout=setTimeout((function(){s.newGame()}),2e3),this.setGridDimension(this.startgridwidth)},this.stop=function(){var t={};t.stack=this.stack,t.startgridwidth=this.startgridwidth,t.startgridheight=this.startgridheight,t.level=this.level,t.dots=[],t.turns=this.turns,t.indcolour=document.getElementById("fliptext").style.borderBottom;for(var i=0;i<this.startgridwidth;i++){temparr=[];for(var s=0;s<this.startgridheight;s++)temparr.push(this.dots[i][s].colour);t.dots.push(temparr)}var e=JSON.stringify(t);h.getDatastoreObject().setDataAsText(e),h.getDatastoreObject().save((function(){h.close()}))},this.initialiseFromArray=function(){clearTimeout(this.newGameTimeout),clearTimeout(this.solveTimeout),t.removeAllChildren(),this.calculateDimensions();for(var i=2*this.radius+this.margin,s=(t.canvas.width-this.circleswidth)/2+this.margin,e=this.margin,h=0;h<this.startgridwidth;h++){e=this.margin;for(var r=0;r<this.startgridheight;r++)this.dots[h][r].radius=this.radius,this.dots[h][r].x=s+this.radius,this.dots[h][r].y=e+this.radius,this.dots[h][r].init(),e+=i;s+=i}},this.initDots=function(i){this.dots=[];for(var s=[],e=2*this.radius+this.margin,h=(t.canvas.width-this.circleswidth)/2+this.margin,r=this.margin,a=0;a<this.startgridwidth;a++){s=[],r=this.margin;for(var o=0;o<this.startgridheight;o++){var n=0;null!=i&&(n=i[a][o]);var d=new Dot(t,h+this.radius,r+this.radius,this.colours,n,this.radius,this,a,o);d.init(),s.push(d),r+=e}this.dots.push(s),h+=e}},this.calculateDimensions=function(){var t=this.canDoFromX();!1===t&&(t=this.radiusFromY()),this.radius=t,this.circleswidth=2*this.radius*this.startgridwidth+this.margin*(this.startgridwidth+1),this.circlesheight=2*this.radius*this.startgridheight+this.margin*(this.startgridheight+1)},this.newGame=function(){clearTimeout(this.newGameTimeout),clearTimeout(this.solveTimeout),t.removeAllChildren(),this.calculateDimensions(),this.initDots(),this.stack=[];for(var i=0;i<14;i++)this.flipRandomDot();this.turns=1,document.getElementById("turnno").innerHTML=" "+this.turns,document.getElementById("fliptext").style.borderBottom="5px solid #00ff1b"},this.setSize=function(t){this.startgridwidth=t,this.startgridheight=t,this.setGridDimension(t),this.newGame(),this.level=t},this.setGridDimension=function(t){this.gridwidth=1.5*t,this.gridheight=1.5*t},this.init=function(){this.palette=new r.SizePalette(this,s.getElementById("size-button"),void 0),l10n.updateDocument(),h.getDatastoreObject().getMetadata(this.init_canaccessdatastore.bind(this)),document.getElementById("turnno").innerHTML=" "+this.turns,this.drawIndicator(),this.palette.setUsed()},this.init_canaccessdatastore=function(t,i){var s=(new Date).getTime();Math.abs(s-i.creation_time)<2e3?this.newGame():h.getDatastoreObject().loadAsText(this.init_getdatastore.bind(this))},this.init_getdatastore=function(i,s,e){null==i&&null!=e?(e=JSON.parse(e),this.restoreFromDatastore(e),this.stack=e.stack,this.startgridwidth=e.startgridwidth,this.startgridheight=e.startgridheight,this.setSize(e.startgridheight),this.turns=e.turns,document.getElementById("turnno").innerHTML=" "+this.turns,document.getElementById("fliptext").style.borderBottom=e.indcolour,clearTimeout(this.newGameTimeout),clearTimeout(this.solveTimeout),t.removeAllChildren(),this.calculateDimensions(),this.initDots(e.dots)):this.newGame()},this.restoreFromDatastore=function(i){this.stack=i.stack,this.startgridwidth=i.startgridwidth,this.startgridheight=i.startgridheight,this.turns=i.turns,document.getElementById("fliptext").style.borderBottom=i.indcolour,clearTimeout(this.newGameTimeout),clearTimeout(this.solveTimeout),t.removeAllChildren(),this.calculateDimensions(),this.initDots(i.dots)}}