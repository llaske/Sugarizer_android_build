enyo.kind({name:"Sugar.Password",kind:enyo.Control,published:{label:""},events:{onEnter:""},classes:"password-class",components:[{name:"line",classes:"password-line",components:[{name:"text",content:"xxx",classes:"password-label"},{classes:"password-input",components:[{name:"pass",kind:"Input",classes:"password-value",content:"",onkeydown:"onKeyDown",oninput:"refreshCancel"},{name:"cancel",classes:"password-iconcancel",showing:!1,ontap:"cancelClicked"}]},{components:[{name:"emojis",classes:"password-emojis",components:[{components:[{name:"emoji0",kind:"Sugar.Emoji",index:0,ontap:"emojiClicked",selected:!0},{name:"emoji1",kind:"Sugar.Emoji",index:1,ontap:"emojiClicked",selected:!0},{name:"emoji2",kind:"Sugar.Emoji",index:2,ontap:"emojiClicked",selected:!0},{name:"emoji3",kind:"Sugar.Emoji",index:3,ontap:"emojiClicked",selected:!0},{name:"emoji4",kind:"Sugar.Emoji",index:4,ontap:"emojiClicked",selected:!0}]},{components:[{name:"emoji5",kind:"Sugar.Emoji",index:5,ontap:"emojiClicked",selected:!0},{name:"emoji6",kind:"Sugar.Emoji",index:6,ontap:"emojiClicked",selected:!0},{name:"emoji7",kind:"Sugar.Emoji",index:7,ontap:"emojiClicked",selected:!0},{name:"emoji8",kind:"Sugar.Emoji",index:8,ontap:"emojiClicked",selected:!0},{name:"emoji9",kind:"Sugar.Emoji",index:9,ontap:"emojiClicked",selected:!0}]}]},{classes:"password-emojis-category",components:[{name:"category0",kind:"Sugar.Emoji",classes:"emoji-category",ontap:"category0Clicked",index:0,letter:!1,size:15,selected:!0},{name:"category1",kind:"Sugar.Emoji",classes:"emoji-category",ontap:"category1Clicked",index:10,letter:!1,size:15},{name:"category2",kind:"Sugar.Emoji",classes:"emoji-category",ontap:"category2Clicked",index:20,letter:!1,size:15}]}]}]}],create:function(){this.inherited(arguments),this.labelChanged()},rendered:function(){this.inherited(arguments);var e=this.$.pass.hasNode();e.autocomplete="off",this.isAndroid=util.platform.android,this.isAndroid&&(this.savedValue="",e.addEventListener("beforeinput",enyo.bind(this,"onBeforeInput")))},labelChanged:function(){this.$.text.setContent(this.label)},getPassword:function(){var e=this.$.pass.getValue(),t="";split=e.split(/([\uD800-\uDBFF][\uDC00-\uDFFF])/);for(var s=0;s<split.length;s++)char=split[s],""!==char&&(t+=this.convertToChar(char));return t},setPassword:function(e){for(var t="",s=0;s<e.length;s++)t+=convertToEmoji(e[s]);this.$.pass.setValue(t)},onKeyDown:function(e,t){if(this.isAndroid)t.stopPropagation();else{var s=this.convertToEmoji(t.key);s?(this.$.pass.setValue(this.$.pass.getValue()+String.fromCodePoint(s)),t.preventDefault()):13==t.keyCode?this.doEnter():8!=t.keyCode&&t.preventDefault(),this.$.cancel.setShowing(this.$.pass.getValue().length>0)}},onBeforeInput:function(e){this.$.pass.setValue(this.savedValue),"insertText"==e.inputType||"insertCompositionText"==e.inputType?(this.addCharacter(e.data[e.data.length-1]),this.$.cancel.setShowing(this.$.pass.getValue().length>0),this.savedValue=this.$.pass.getValue()):"deleteContentBackward"==e.inputType?this.savedValue.length>=2&&(this.savedValue=this.savedValue.substr(0,this.savedValue.length-2),this.$.cancel.setShowing(this.savedValue.length>0),this.$.pass.setValue(this.savedValue)):"insertLineBreak"==e.inputType&&this.doEnter(),e.stopPropagation()},emojiClicked:function(e){e.animate(),this.addCharacter(constant.emojis[e.getIndex()].letter),this.$.pass.focus(),this.$.cancel.setShowing(this.$.pass.getValue().length>0),this.isAndroid&&(this.savedValue=this.$.pass.getValue())},category0Clicked:function(e){if(!e.getSelected()){var t=e.index;t-10>=0&&(this.$.category0.setIndex(t-10),this.$.category1.setIndex(t),this.$.category2.setIndex(t+10),e=this.$.category1),this.changeCategory(e)}},category1Clicked:function(e){e.getSelected()||this.changeCategory(e)},category2Clicked:function(e){if(!e.getSelected()){var t=e.index;t+10<constant.emojis.length&&(this.$.category0.setIndex(t-10),this.$.category1.setIndex(t),this.$.category2.setIndex(t+10),e=this.$.category1),this.changeCategory(e)}},changeCategory:function(e){this.$.category0.setSelected(!1),this.$.category1.setSelected(!1),this.$.category2.setSelected(!1),e.setSelected(!0);var t=e.index;this.$.emoji0.setIndex(t++),this.$.emoji1.setIndex(t++),this.$.emoji2.setIndex(t++),this.$.emoji3.setIndex(t++),this.$.emoji4.setIndex(t++),this.$.emoji5.setIndex(t++),this.$.emoji6.setIndex(t++),this.$.emoji7.setIndex(t++),this.$.emoji8.setIndex(t++),this.$.emoji9.setIndex(t++)},cancelClicked:function(){this.$.pass.setValue(""),this.isAndroid&&(this.savedValue=""),this.$.cancel.setShowing(this.$.pass.getValue().length>0),this.$.pass.focus()},refreshCancel:function(e,t){if(this.isAndroid)return this.$.pass.setValue(this.savedValue),void t.stopPropagation();this.$.cancel.setShowing(this.$.pass.getValue().length>0)},convertToEmoji:function(e){for(var t=0;t<constant.emojis.length;t++){var s=constant.emojis[t];if(s.letter==e)return"0x"+s.value}return""},convertToChar:function(e){for(var t=0;t<constant.emojis.length;t++){var s=constant.emojis[t];if(String.fromCodePoint("0x"+s.value)==e)return s.letter}return""},giveFocus:function(){this.$.pass.focus()},addCharacter:function(e){var t=this.convertToEmoji(e);t&&this.$.pass.setValue(this.$.pass.getValue()+String.fromCodePoint(t))}}),enyo.kind({name:"Sugar.Emoji",kind:enyo.Control,published:{index:null,letter:!0,size:null,selected:!1},classes:"emoji",components:[{name:"icon",content:"",allowHtml:!0,classes:"emoji-icon"},{name:"letter",content:"",showing:!0,classes:"emoji-letter"}],create:function(){this.inherited(arguments),this.indexChanged(),this.letterChanged(),this.sizeChanged(),this.selectedChanged()},rendered:function(){this.inherited(arguments),this.size&&(document.getElementById(this.$.icon.id).style="font-size: "+this.size+"pt")},indexChanged:function(){if(this.index>=0&&this.index<constant.emojis.length){var e=constant.emojis[this.index];this.$.icon.setContent("&#x"+e.value+";"),this.$.letter.setContent(e.letter)}},letterChanged:function(){this.$.letter.setShowing(this.letter)},sizeChanged:function(){},selectedChanged:function(){this.removeClass("emoji-selected"),this.removeClass("emoji-unselected"),this.selected?this.addClass("emoji-selected"):this.addClass("emoji-unselected")},animate:function(){var e=this;e.addClass("emoji-flash"),window.setTimeout((function(){e.removeClass("emoji-flash")}),500)}});