enyo.kind({name:"HTML5.Audio",kind:enyo.Control,tag:"audio",published:{src:"",crossorigin:"",preload:"auto",mediagroup:"",loop:!1,muted:"",controlsbar:!1},events:{onSoundEnded:"",onSoundTimeupdate:""},create:function(){this.inherited(arguments),this.isCordova=(util.platform.android||util.platform.ios)&&"http"!=document.location.protocol.substr(0,4),this.startPlay=!1,this.srcChanged(),this.crossoriginChanged(),this.preloadChanged(),this.loopChanged(),this.mutedChanged(),this.controlsbarChanged(),this.handleVolumeButtons()},handleVolumeButtons:function(){if(this.isCordova&&!util.platform.ios){var emptyf=function(){};document.addEventListener("volumeupbutton",(function(){cordova.plugins.VolumeControl.getVolume((function(t){var n=parseInt(t);n<100&&cordova.plugins.VolumeControl.setVolume(n+10,emptyf,emptyf)}),emptyf)}),!1),document.addEventListener("volumedownbutton",(function(){cordova.plugins.VolumeControl.getVolume((function(t){var n=parseInt(t);n>0&&cordova.plugins.VolumeControl.setVolume(n-1,emptyf,emptyf)}),emptyf)}),!1)}},rendered:function(){if(this.inherited(arguments),this.hasNode()){var t=this;enyo.dispatcher.listen(t.hasNode(),"ended",(function(){t.doSoundEnded()})),enyo.dispatcher.listen(t.hasNode(),"timeupdate",(function(n){t.doSoundTimeupdate({timeStamp:n.timeStamp})}))}},srcChanged:function(){this.setAttribute("src",this.src)},crossoriginChanged:function(){this.setAttribute("crossorigin",this.crossorigin)},preloadChanged:function(){this.setAttribute("preload",this.preload)},loopChanged:function(){this.setAttribute("loop",this.loop)},mutedChanged:function(){0!=this.muted.length&&this.setAttribute("muted",this.muted)},controlsbarChanged:function(){this.setAttribute("controls",this.controlsbar)},canPlayType:function(t){var n=this.hasNode();return!!n&&n.canPlayType(t)},play:function(){if(this.isCordova){var t=location.pathname.substring(0,1+location.pathname.lastIndexOf("/"))+this.src,n=this;return this.media&&(this.media.src="",this.media.pause(),this.media.release()),this.media=new Media(t,(function(){}),(function(){}),(function(t){4==t&&""!=this.src&&n.doSoundEnded()})),void this.media.play()}var o=this.hasNode();if(o){this.started=!1;var e=o.play();if(e){n=this;e.then((function(){n.started=!0})).catch((function(){}))}else this.started=!0}},pause:function(){if(this.isCordova){if(!this.media)return;return this.media.src="",this.media.pause(),void this.media.release()}var t=this.hasNode();t&&this.started&&t.pause()},paused:function(){var t=this.hasNode();return!!t&&t.paused},ended:function(){var t=this.hasNode();return!!t&&t.ended}}),enyo.kind({name:"Sugar.Audio",kind:enyo.Control,components:[{name:"sound",kind:"HTML5.Audio",preload:"auto",autobuffer:!0,controlsbar:!1,onSoundEnded:"broadcastEnd",onSoundTimeupdate:"broadcastUpdate"}],create:function(){this.inherited(arguments),this.format=null},rendered:function(){this.inherited(arguments),this.format=".mp3"},play:function(t,n){null!=this.format&&(this.$.sound.setSrc(t+this.format),this.$.sound.setLoop(!0===n),this.timeStamp=(new Date).getTime(),this.render(),this.$.sound.play())},pause:function(){null!=this.format&&this.$.sound.pause()},broadcastEnd:function(){enyo.Signals.send("onEndOfSound",{sound:this.$.sound.src.substring(0,this.$.sound.src.length-4)})},broadcastUpdate:function(t,n){enyo.Signals.send("onSoundTimeupdate",{timestamp:n.timeStamp-this.timeStamp})}});