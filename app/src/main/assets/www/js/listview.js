function sorted(t){var i=[];for(var e in t)i.push(t[e]);return i.sort((function(t,i){return t.name==i.name?0:t.name>i.name?1:-1})),i}enyo.kind({name:"Sugar.DesktopListView",kind:"Scroller",published:{activities:[]},components:[{name:"nomatch",classes:"listview-nomatch",showing:!1},{name:"message",classes:"listview-message",showing:!1},{name:"nofilter",kind:"Sugar.IconButton",icon:{directory:"icons",icon:"dialog-cancel.svg"},classes:"listview-button",ontap:"nofilter",showing:!1},{name:"activityPopup",kind:"Sugar.Popup",showing:!1},{name:"activityList",classes:"activity-list",kind:"Repeater",onSetupItem:"setupItem",onresize:"resize",components:[{name:"item",classes:"activity-list-item",components:[{name:"favorite",kind:"Sugar.Icon",x:0,y:4,size:constant.iconSizeLargeFavorite,ontap:"doSwitchFavorite"},{name:"activity",kind:"Sugar.Icon",x:60,y:5,size:constant.iconSizeList,ontap:"doRunNewActivity"},{name:"name",classes:"activity-name"},{name:"version",classes:"activity-version"},{name:"help",kind:"Sugar.Icon",classes:"activity-help",x:800,y:4,showing:!1,size:constant.iconSizeList,ontap:"doHelp"}]}]}],handlers:{onScroll:"onscroll"},create:function(){if(this.inherited(arguments),this.realLength=0,this.scrollbarTop=0,this.scrollbarMaxTop=0,this.move_scrollbar=!0,this.scrollbar_session_value=0,this.scroll_count=0,this.favoriteActivityButton=null,this.forbiddenActivity=null,window.sugarizerOS){var t=this;sugarizerOS.initActivitiesPreferences((function(){t.activitiesChanged(),t.computeSize(),t.draw()}))}else this.activitiesChanged(),this.computeSize(),this.draw()},rendered:function(){this.inherited(arguments),this.scrollbar_session_value=preferences.getScrollValue(),this.scrollbar_session_value||(this.scrollbar_session_value=0),this.scrollTo(0,this.scrollbar_session_value)},localize:function(){this.activitiesChanged()},computeSize:function(){document.getElementById("toolbar");var t=document.getElementById("canvas").offsetHeight;this.applyStyle("height",t+"px")},resize:function(){this.computeSize(),app.resize()},beforeHelp:function(){tutorial.setElement("owner",app.$.owner.getAttribute("id")),tutorial.setElement("journal",app.$.journal.getAttribute("id")),this.favoriteActivityButton&&tutorial.setElement("favoriteitembutton",this.favoriteActivityButton.getAttribute("id"))},getToolbar:function(){return app.getToolbar()},draw:function(){var t=util.getCanvasCenter();this.$.nomatch.applyStyle("margin-left",t.x-constant.sizeEmpty/4+"px");var i=t.y-constant.sizeEmpty/4;this.$.nomatch.applyStyle("margin-top",i+"px"),this.$.message.setContent(l10n.get("NoMatchingActivities")),this.$.nofilter.setText(l10n.get("ClearSearch"))},activitiesChanged:function(){var t=0==app.getToolbar().getSearchText().length&&this.activities.length>constant.listInitCount?constant.listInitCount:this.activities.length;this.realLength=this.activities.length,this.$.activityList.set("count",t,!0),0==this.activities.length?(this.$.nomatch.show(),this.$.message.show(),this.$.nofilter.show()):(this.$.nomatch.hide(),this.$.message.hide(),this.$.nofilter.hide())},setupItem:function(t,i){var e=sorted(this.activities);"undefined"!==e[i.index].type&&"native"==e[i.index].type&&(e[i.index].isNative=!0),0==i.index&&(this.favoriteActivityButton=i.item.$.favorite),i.item.$.activity.setIcon(e[i.index]),i.item.$.activity.setPopupShow(enyo.bind(this,"showActivityPopup")),i.item.$.activity.setPopupHide(enyo.bind(this,"hideActivityPopup")),i.item.$.favorite.setIcon({directory:"icons",icon:"emblem-favorite-large.svg"}),i.item.$.favorite.setColorized(-1!=activities.getFavoritesName().indexOf(e[i.index].id)),i.item.$.name.setContent(e[i.index].name),i.item.$.version.setContent(l10n.get("VersionNumber",{number:e[i.index].version})),i.item.$.help.setIcon({directory:"icons",icon:"help-rev.svg"}),i.item.$.help.setColorized(!1),i.item.$.help.setShowing(!e[i.index].isNative),"rtl"==l10n.language.direction&&(i.item.$.name.addClass("rtl-14"),i.item.$.version.addClass("rtl-14"))},onscroll:function(t,i){var e=i.scrollBounds;if(null!=e&&(this.scrollbarTop=Math.ceil(e.top),this.scrollbarMaxTop=Math.ceil(e.maxTop),!this.move_scrollbar)){var s=this.scrollbarTop-this.scrollbarMaxTop;s>0?preferences.setScrollValue(this.scrollbarTop-s):preferences.setScrollValue(this.scrollbarTop),preferences.save()}var o=this.$.activityList.get("count");if(0==app.getToolbar().getSearchText().length&&e&&e.maxTop-e.top<constant.listScrollLimit&&this.realLength>o){var n=Math.min(o+constant.listStepCount,this.activities.length);humane.log(l10n.get("Loading")),this.$.activityList.set("count",n,!0)}this.scrollbarTop<=this.scrollbar_session_value&&this.move_scrollbar&&this.scrollTo(0,this.scrollbar_session_value),this.scrollbarTop==this.scrollbar_session_value&&this.move_scrollbar&&(this.scroll_count=this.scroll_count+1),(this.scrollbarTop>this.scrollbar_session_value||2==this.scroll_count)&&(this.move_scrollbar=!1)},doSwitchFavorite:function(t,i){var e=sorted(this.activities);this.switchFavorite(i.dispatchTarget.container,e[i.index])},switchFavorite:function(t,i){stats.trace(constant.viewNames[app.getView()],"switch_favorite",i.id,null),util.vibrate(),t.setColorized(activities.switchFavoriteActivity(i)),t.container.render(),preferences.save(),preferences.saveToServer(myserver),this.getToolbar().askRedraw(),this.$.activityPopup.hidePopup()},doRunNewActivity:function(t,i){var e=sorted(this.activities);this.runNewActivity(e[i.index])},runNewActivity:function(t){util.vibrate(),this.$.activityPopup.hidePopup(),this.forbiddenActivity=t.id,preferences.runActivity(t,null)},showActivityPopup:function(t){if(!window.sugarizerOS||!this.forbiddenActivity||this.forbiddenActivity!=t.icon.id){this.forbiddenActivity=null;var i=t.icon;this.$.activityPopup.setHeader({icon:i,colorized:!0,name:i.name,title:null,action:enyo.bind(this,"runNewActivity"),data:[i,null]});var e=[];e.push({icon:i,colorized:!1,name:l10n.get("StartNew"),action:enyo.bind(this,"runNewActivity"),data:[i,null]}),e.push({icon:t.parent.container.$.favorite.icon,colorized:!i.favorite,name:i.favorite?l10n.get("RemoveFavorite"):l10n.get("MakeFavorite"),action:enyo.bind(this,"switchFavorite"),data:[t.parent.container.$.favorite,t.icon]}),this.$.activityPopup.setFooter(e),this.$.activityPopup.setMargin({left:0,top:60*t.owner.index+20-mouse.position.y}),this.$.activityPopup.showPopup()}},hideActivityPopup:function(t){return!this.$.activityPopup||!this.$.activityPopup.cursorIsInside()&&!t.cursorIsInside()&&(this.$.activityPopup.hidePopup(),!0)},nofilter:function(){app.getToolbar().setSearchText(""),app.filterActivities()},doHelp:function(t,i){for(var e=sorted(this.activities),s=[],o=0;o<e.length;o++){var n=e[o];if(!n.isNative&&"native"!=n.type){var a=l10n.get("NameActivity",{name:n.name}),r={icon:n.icon,directory:n.directory,size:constant.sizeEmpty},c=l10n.get("TutoActivity"+n.directory.substr(n.directory.indexOf("/")+1).replace(".",""));o==i.index&&tutorial.setElement("step",s.length),s.push({title:a,icon:r,description:c,step:o})}}tutorial.setElement("activities",s),stats.trace(constant.viewNames[app.getView()],"tutorial","start",null),tutorial.start()}});